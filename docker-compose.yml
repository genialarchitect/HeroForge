# HeroForge Docker Compose Configuration
#
# This file provides a standalone deployment configuration for HeroForge.
# For production, you may want to add a reverse proxy (Traefik, nginx) for SSL.

services:
  heroforge:
    build: .
    container_name: heroforge
    restart: unless-stopped
    # Required for UDP scanning with ICMP detection and VPN connections
    cap_add:
      - NET_RAW
      - NET_ADMIN
    # Required for VPN tunnel devices
    devices:
      - /dev/net/tun:/dev/net/tun
    # Required for VPN routing
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1
    ports:
      - "8080:8080"
    environment:
      # Optional: Set admin username for first-run setup
      # ADMIN_USERNAME: "admin"
      # Database path inside container
      DATABASE_URL: "sqlite:///data/heroforge.db"
      # VPN configuration directory
      VPN_CONFIGS_DIR: "/data/vpn_configs"
      # Optional: VPN credential encryption key (generate with: openssl rand -hex 32)
      # VPN_ENCRYPTION_KEY: "your-64-character-hex-key"
    volumes:
      # Persist database, scan data, and VPN configurations
      - heroforge_data:/data

volumes:
  heroforge_data:
