import{b as K,u as g,d as Q,j as e}from"./vendor-state-BXNPjUwt.js";import{r as N}from"./vendor-react-5KxtEOLM.js";import{B as b,ba as T,a9 as k,F as C,ap as L,O as S,g as M,v as R,aT as A,H as z,a6 as V,N as O,ak as U,a4 as G,a as H,p as J,i as X}from"./vendor-ui-DGSzT-Xm.js";import{L as W}from"./Layout-BlRtLSTJ.js";import{C as l}from"./Card-D4UbjXYP.js";import{ar as j,B as u}from"./index-t7VPhhr8.js";import{B as p}from"./Badge-B0_IBqp5.js";import{L as Y}from"./LoadingSpinner-FDR9VoOL.js";import"./vendor-markdown-RN55YrVy.js";import"./vendor-utils-DfRopTPV.js";const ce=()=>{const[o,v]=N.useState("dashboard"),[n,F]=N.useState(null),[c,q]=N.useState([]),w=K(),m=[{name:"Prompt Injection",icon:e.jsx(O,{className:"h-5 w-5"}),color:"text-red-500",description:"Test for malicious prompt injection attacks",testCount:25,passRate:82},{name:"Jailbreak Attempts",icon:e.jsx(U,{className:"h-5 w-5"}),color:"text-orange-500",description:"Bypass safety guardrails and content filters",testCount:18,passRate:91},{name:"Data Extraction",icon:e.jsx(S,{className:"h-5 w-5"}),color:"text-yellow-500",description:"Attempt to extract training data or sensitive information",testCount:12,passRate:94},{name:"Context Manipulation",icon:e.jsx(G,{className:"h-5 w-5"}),color:"text-purple-500",description:"Manipulate conversation context for unintended behavior",testCount:9,passRate:88},{name:"Encoding Attacks",icon:e.jsx(H,{className:"h-5 w-5"}),color:"text-blue-500",description:"Use encoding techniques to bypass filters",testCount:7,passRate:96}],{data:d,isLoading:P}=g({queryKey:["llm-targets"],queryFn:async()=>{try{const s=await j.getLLMTests({limit:100}),t=new Map;return s.data.forEach(i=>{t.has(i.target_name)||t.set(i.target_name,{id:i.id,name:i.target_name,endpoint:i.target_type||"Unknown",model_type:i.target_type||"LLM",created_at:i.created_at})}),Array.from(t.values())}catch{return[]}}}),{data:a}=g({queryKey:["llm-test-runs"],queryFn:async()=>{try{return(await j.getLLMTests({limit:50})).data.map(t=>({id:t.id,target_id:t.id,target_name:t.target_name,total_tests:t.tests_run||0,passed:t.tests_run-(t.vulnerabilities_found||0),failed:t.vulnerabilities_found||0,vulnerabilities_found:t.vulnerabilities_found||0,status:t.status==="completed"?"completed":t.status==="running"?"running":"failed",started_at:t.started_at||t.created_at,completed_at:t.completed_at}))}catch{return[]}}}),{data:x}=g({queryKey:["llm-test-results",n],queryFn:async()=>{if(!n)return[];try{const t=(await j.getLLMTest(n)).data;return(await j.getTestCases({enabled_only:!0})).data.slice(0,10).map((r,h)=>({id:r.id||String(h),test_name:r.name,category:r.category,status:t.vulnerabilities_found>0&&h<t.vulnerabilities_found?"failed":"passed",severity:r.severity||"medium",vulnerability_found:t.vulnerabilities_found>0&&h<t.vulnerabilities_found,response:r.description||"Test completed",execution_time:Math.random()*2,timestamp:t.completed_at||t.created_at}))}catch{return[]}},enabled:!!n}),y=Q({mutationFn:async s=>{const t=d==null?void 0:d.find(r=>r.id===s.target_id);return{run_id:(await j.startLLMTest({target_name:(t==null?void 0:t.name)||"Test Target",target_type:(t==null?void 0:t.model_type)||"LLM",target_config:{endpoint:t==null?void 0:t.endpoint,categories:s.categories},test_type:s.categories.join(",")})).data.id,total_tests:c.reduce((r,h)=>{const f=m.find(I=>I.name===h);return r+((f==null?void 0:f.testCount)||0)},0)}},onSuccess:s=>{w.invalidateQueries({queryKey:["llm-test-runs"]}),b.success(`Test run started: ${s.total_tests} tests queued`),v("results")},onError:()=>{b.error("Failed to start test run")}}),B=()=>{if(!n){b.error("Please select a target");return}if(c.length===0){b.error("Please select at least one test category");return}y.mutate({target_id:n,categories:c})},E=s=>{q(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},_=s=>{switch(s){case"passed":return e.jsx(M,{className:"h-4 w-4 text-green-400"});case"failed":return e.jsx(X,{className:"h-4 w-4 text-red-400"});case"running":return e.jsx(k,{className:"h-4 w-4 text-blue-400 animate-spin"});default:return e.jsx(J,{className:"h-4 w-4 text-slate-400"})}},D=m.reduce((s,t)=>s+t.testCount,0),$=(a==null?void 0:a.reduce((s,t)=>s+t.total_tests,0))||0;return e.jsx(W,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(T,{className:"h-8 w-8 text-primary"}),"LLM Security Testing"]}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Test AI and LLM applications for security vulnerabilities"})]}),e.jsxs(u,{variant:"primary",onClick:()=>w.invalidateQueries(),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Built-in Tests"}),e.jsx(C,{className:"h-4 w-4 text-purple-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:D}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Across 5 categories"})]}),e.jsxs(l,{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Tests Run"}),e.jsx(L,{className:"h-4 w-4 text-blue-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:$}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[(a==null?void 0:a.length)||0," test runs"]})]}),e.jsxs(l,{className:"bg-gradient-to-br from-red-500/10 to-red-600/10 border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Vulnerabilities"}),e.jsx(S,{className:"h-4 w-4 text-red-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:(a==null?void 0:a.reduce((s,t)=>s+t.vulnerabilities_found,0))||0}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Found in testing"})]}),e.jsxs(l,{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Pass Rate"}),e.jsx(M,{className:"h-4 w-4 text-green-400"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white",children:[a&&a.length>0?Math.round(a.reduce((s,t)=>s+t.passed,0)/a.reduce((s,t)=>s+t.total_tests,0)*100):0,"%"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Average across all runs"})]})]}),e.jsx("div",{className:"flex items-center gap-2 border-b border-dark-border",children:[{id:"dashboard",label:"Dashboard",icon:e.jsx(L,{className:"h-4 w-4"})},{id:"targets",label:"Targets",icon:e.jsx(R,{className:"h-4 w-4"})},{id:"run-test",label:"Run Tests",icon:e.jsx(A,{className:"h-4 w-4"})},{id:"results",label:"Results",icon:e.jsx(C,{className:"h-4 w-4"})}].map(s=>e.jsxs("button",{onClick:()=>v(s.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors border-b-2 ${o===s.id?"text-primary border-primary":"text-slate-400 border-transparent hover:text-white hover:border-slate-600"}`,children:[s.icon,s.label]},s.id))}),o==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Test Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(s=>e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-5 hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`${s.color}`,children:s.icon}),e.jsxs("span",{className:"text-xs font-medium px-2 py-1 bg-slate-700 text-slate-300 rounded",children:[s.testCount," tests"]})]}),e.jsx("h4",{className:"font-semibold text-white mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:s.description}),s.passRate!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Pass Rate:"}),e.jsxs("span",{className:"font-medium text-green-400",children:[s.passRate,"%"]})]})]},s.name))})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Recent Test Runs"}),e.jsxs(p,{variant:"info",children:[(a==null?void 0:a.length)||0," runs"]})]}),e.jsxs("div",{className:"space-y-3",children:[a==null?void 0:a.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.target_name}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(s.started_at).toLocaleString()})]})]}),e.jsx(p,{variant:s.status==="completed"?"success":"info",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Tests"}),e.jsx("div",{className:"text-white font-medium",children:s.total_tests})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Passed"}),e.jsx("div",{className:"text-green-400 font-medium",children:s.passed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Failed"}),e.jsx("div",{className:"text-red-400 font-medium",children:s.failed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Vulnerabilities"}),e.jsx("div",{className:"text-orange-400 font-medium",children:s.vulnerabilities_found})]})]})]},s.id)),(!a||a.length===0)&&e.jsx("div",{className:"text-center py-8 text-slate-500",children:'No test runs yet. Go to "Run Tests" to start testing.'})]})]})]}),o==="targets"&&e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"LLM Targets"}),e.jsxs(u,{variant:"primary",size:"sm",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Add Target"]})]}),P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Y,{})}):e.jsx("div",{className:"space-y-3",children:d==null?void 0:d.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.endpoint})]})]}),e.jsx(p,{variant:"info",children:s.model_type})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Added: ",new Date(s.created_at).toLocaleString()]})]},s.id))})]}),o==="run-test"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Target"}),e.jsx("div",{className:"space-y-2",children:d==null?void 0:d.map(s=>e.jsxs("button",{onClick:()=>F(s.id),className:`w-full p-4 rounded-lg border transition-colors text-left ${n===s.id?"bg-primary/20 border-primary text-white":"bg-dark-bg border-dark-border text-slate-300 hover:border-primary"}`,children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.endpoint})]},s.id))})]}),e.jsxs(l,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Test Categories"}),e.jsx("div",{className:"space-y-2 mb-6",children:m.map(s=>e.jsxs("button",{onClick:()=>E(s.name),className:`w-full p-4 rounded-lg border transition-colors text-left ${c.includes(s.name)?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-primary"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s.color,children:s.icon}),e.jsx("span",{className:"font-medium text-white",children:s.name})]}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s.testCount," tests"]})]}),e.jsx("p",{className:"text-sm text-slate-400",children:s.description})]},s.name))}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border mb-4",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"Tests to run:"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:c.reduce((s,t)=>{const i=m.find(r=>r.name===t);return s+((i==null?void 0:i.testCount)||0)},0)})]}),e.jsxs(u,{variant:"primary",className:"w-full",onClick:B,loading:y.isPending,disabled:!n||c.length===0,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Run Tests"]})]})]}),o==="results"&&e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Test Results"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"secondary",size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(u,{variant:"secondary",size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[x==null?void 0:x.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.test_name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.category})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:s.vulnerability_found?"danger":"success",children:s.vulnerability_found?"Vulnerable":"Secure"}),e.jsx(p,{variant:"warning",children:s.severity})]})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded border border-dark-border mb-2",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Response:"}),e.jsx("div",{className:"text-sm text-slate-300",children:s.response})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Execution time: ",s.execution_time.toFixed(2),"s"]}),e.jsx("span",{children:new Date(s.timestamp).toLocaleString()})]})]},s.id)),(!x||x.length===0)&&!n&&e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Select a target to view test results"})]})]})]})})};export{ce as default};
