import{e as W,u as $,j as e}from"./vendor-state-oFDmcCcB.js";import{r as n}from"./vendor-react-5KxtEOLM.js";import{an as R,aZ as q,z as B,aO as K,i as w,a7 as U,p as F,g as L,aa as G,B as N,l as M,$ as z}from"./vendor-ui-7EurIAWU.js";import{W as u}from"./index-MDkiA-RQ.js";import{L as H}from"./Layout-B2BPZquP.js";import{A as Q}from"./AcasNavigation-BRn00Uou.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BwTKtS0m.js";const v={listScans:()=>u.get("/api/windows-audit/scans").then(s=>s.data),getScan:s=>u.get(`/api/windows-audit/scans/${s}`).then(t=>t.data),getStigResults:s=>u.get(`/api/windows-audit/scans/${s}/stig`).then(t=>t.data),startScan:s=>u.post("/api/windows-audit/scan",s).then(t=>t.data),exportCkl:s=>u.get(`/api/windows-audit/scans/${s}/ckl`,{responseType:"blob"}).then(t=>t.data),testConnection:s=>u.post("/api/windows-audit/test",s).then(t=>t.data)},Z=({category:s})=>{const t={CatI:"bg-red-900/50 text-red-400",CatII:"bg-amber-900/50 text-amber-400",CatIII:"bg-yellow-900/50 text-yellow-400"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t[s]||"bg-gray-700"}`,children:s})},C=({status:s})=>{const t={pending:{bg:"bg-gray-700 text-gray-300",icon:e.jsx(F,{className:"w-3 h-3"})},running:{bg:"bg-blue-900/50 text-blue-400",icon:e.jsx(G,{className:"w-3 h-3 animate-spin"})},completed:{bg:"bg-green-900/50 text-green-400",icon:e.jsx(L,{className:"w-3 h-3"})},failed:{bg:"bg-red-900/50 text-red-400",icon:e.jsx(w,{className:"w-3 h-3"})},NotAFinding:{bg:"bg-green-900/50 text-green-400",icon:e.jsx(L,{className:"w-3 h-3"})},Open:{bg:"bg-red-900/50 text-red-400",icon:e.jsx(w,{className:"w-3 h-3"})},NotApplicable:{bg:"bg-gray-600 text-gray-400",icon:null},NotReviewed:{bg:"bg-gray-700 text-gray-300",icon:e.jsx(F,{className:"w-3 h-3"})}},i=t[s]||t.pending;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs ${i.bg}`,children:[i.icon,s.replace(/([A-Z])/g," $1").trim()]})},V=({isOpen:s,onClose:t,onSuccess:i})=>{const[d,x]=n.useState(""),[o,m]=n.useState(""),[c,p]=n.useState(""),[h,a]=n.useState(""),[r,y]=n.useState("ntlm"),[g,D]=n.useState(!0),[S,O]=n.useState(!1),[I,_]=n.useState(!1),[k,A]=n.useState(!1),T={username:o,password:c,domain:h,auth_type:r},P=async()=>{var l,j;A(!0);try{await v.testConnection({target:d,credentials:T}),N.success("Connection successful!")}catch(f){N.error(((j=(l=f.response)==null?void 0:l.data)==null?void 0:j.error)||"Connection failed")}finally{A(!1)}},E=async()=>{var l,j;_(!0);try{await v.startScan({target:d,credentials:T,run_stig_checks:g,include_cat3:S}),N.success("Windows audit scan started"),i(),t()}catch(f){N.error(((j=(l=f.response)==null?void 0:l.data)==null?void 0:j.error)||"Failed to start scan")}finally{_(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100 mb-4",children:"New Windows Audit Scan"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Target Host"}),e.jsx("input",{type:"text",value:d,onChange:l=>x(l.target.value),placeholder:"192.168.1.100 or hostname",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:o,onChange:l=>m(l.target.value),placeholder:"Administrator",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:c,onChange:l=>p(l.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Domain (optional)"}),e.jsx("input",{type:"text",value:h,onChange:l=>a(l.target.value),placeholder:"CORP",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Auth Type"}),e.jsxs("select",{value:r,onChange:l=>y(l.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"ntlm",children:"NTLM"}),e.jsx("option",{value:"kerberos",children:"Kerberos"}),e.jsx("option",{value:"basic",children:"Basic"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:l=>D(l.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-gray-700"}),"Run STIG compliance checks"]}),g&&e.jsxs("label",{className:"flex items-center gap-2 text-gray-300 ml-6",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:l=>O(l.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-gray-700"}),"Include CAT III checks (low severity)"]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("button",{onClick:P,disabled:k||!d||!o||!c,className:"px-4 py-2 bg-gray-600 text-gray-200 rounded hover:bg-gray-500 disabled:opacity-50",children:k?"Testing...":"Test Connection"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:I||!d||!o||!c,className:"px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 disabled:opacity-50",children:I?"Starting...":"Start Scan"})]})]})]})]})}):null},X=({scan:s,onClose:t})=>{const[i,d]=n.useState("overview"),[x,o]=n.useState(""),[m,c]=n.useState(""),{data:p=[]}=$({queryKey:["windows-audit-stig",s==null?void 0:s.id],queryFn:()=>s?v.getStigResults(s.id):Promise.resolve([]),enabled:!!s&&i==="stig"}),h=async()=>{if(s)try{const r=await v.exportCkl(s.id),y=window.URL.createObjectURL(r),g=document.createElement("a");g.href=y,g.download=`${s.target}_stig_results.ckl`,g.click(),window.URL.revokeObjectURL(y)}catch{N.error("Failed to export CKL")}},a=p.filter(r=>{const y=!x||r.category===x,g=!m||r.status===m;return y&&g});return s?e.jsxs("div",{className:"fixed inset-y-0 right-0 w-[600px] bg-gray-800 border-l border-gray-700 shadow-xl z-40 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:s.target}),s.system_info&&e.jsxs("p",{className:"text-sm text-gray-400",children:[s.system_info.os_name," ",s.system_info.os_version]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-200",children:e.jsx(w,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(C,{status:s.status})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("button",{onClick:h,disabled:s.status!=="completed",className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500 disabled:opacity-50",children:[e.jsx(U,{className:"w-4 h-4"}),"Export CKL"]})}),e.jsxs("div",{className:"flex border-b border-gray-700 px-4",children:[e.jsx("button",{onClick:()=>d("overview"),className:`px-4 py-2 text-sm ${i==="overview"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-gray-200"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>d("stig"),className:`px-4 py-2 text-sm ${i==="stig"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-gray-200"}`,children:["STIG Results (",s.total_checks,")"]})]}),e.jsxs("div",{className:"p-4",children:[i==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"STIG Findings"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-red-900/20 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:s.cat1_findings}),e.jsx("div",{className:"text-xs text-red-300",children:"CAT I (High)"})]}),e.jsxs("div",{className:"bg-amber-900/20 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:s.cat2_findings}),e.jsx("div",{className:"text-xs text-amber-300",children:"CAT II (Med)"})]}),e.jsxs("div",{className:"bg-yellow-900/20 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:s.cat3_findings}),e.jsx("div",{className:"text-xs text-yellow-300",children:"CAT III (Low)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"Compliance Rate"}),e.jsx("div",{className:"bg-gray-700 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"bg-green-500 h-full",style:{width:`${s.total_checks>0?s.pass_count/s.total_checks*100:0}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsxs("span",{className:"text-green-400",children:[s.pass_count," Pass"]}),e.jsxs("span",{className:"text-red-400",children:[s.fail_count," Fail"]})]})]}),s.system_info&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"System Information"}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsx(b,{label:"Hostname",value:s.system_info.hostname}),e.jsx(b,{label:"OS",value:`${s.system_info.os_name} ${s.system_info.os_version}`}),e.jsx(b,{label:"Build",value:s.system_info.os_build||"N/A"}),e.jsx(b,{label:"Architecture",value:s.system_info.architecture}),e.jsx(b,{label:"Domain",value:s.system_info.domain||"Not joined"})]})]})]}),i==="stig"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:x,onChange:r=>o(r.target.value),className:"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-sm text-gray-200",children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"CatI",children:"CAT I"}),e.jsx("option",{value:"CatII",children:"CAT II"}),e.jsx("option",{value:"CatIII",children:"CAT III"})]}),e.jsxs("select",{value:m,onChange:r=>c(r.target.value),className:"px-3 py-1 bg-gray-700 border border-gray-600 rounded text-sm text-gray-200",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Open",children:"Open"}),e.jsx("option",{value:"NotAFinding",children:"Not a Finding"}),e.jsx("option",{value:"NotApplicable",children:"Not Applicable"})]})]}),e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No STIG results"}):a.map(r=>e.jsx(J,{result:r},r.stig_id))})]})]})]}):null},b=({label:s,value:t})=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:s}),e.jsx("span",{className:"text-gray-200",children:t})]}),J=({result:s})=>{const[t,i]=n.useState(!1);return e.jsxs("div",{className:"bg-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-3 flex items-center justify-between cursor-pointer hover:bg-gray-600/50",onClick:()=>i(!t),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t?e.jsx(M,{className:"w-4 h-4 text-gray-400"}):e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-200 font-medium",children:s.stig_id}),e.jsx(Z,{category:s.category})]}),e.jsx("p",{className:"text-sm text-gray-400 truncate",children:s.title})]})]}),e.jsx(C,{status:s.status})]}),t&&e.jsxs("div",{className:"p-4 pt-0 border-t border-gray-600 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Rule ID"}),e.jsx("p",{className:"text-sm text-gray-300",children:s.rule_id})]}),s.finding_details&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Finding Details"}),e.jsx("p",{className:"text-sm text-gray-300",children:s.finding_details})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Expected"}),e.jsx("p",{className:"text-sm text-gray-300",children:s.expected})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Actual"}),e.jsx("p",{className:"text-sm text-gray-300",children:s.actual})]})]}),s.remediation&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Remediation"}),e.jsx("p",{className:"text-sm text-gray-300",children:s.remediation})]})]})]})},ie=()=>{const s=W(),[t,i]=n.useState(!1),[d,x]=n.useState(null),[o,m]=n.useState(""),{data:c=[],isLoading:p}=$({queryKey:["windows-audit-scans"],queryFn:v.listScans,refetchInterval:1e4}),h=c.filter(a=>a.target.toLowerCase().includes(o.toLowerCase()));return e.jsx(H,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-8 h-8 text-cyan-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"Windows Audit Scanner"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Credentialed Windows security assessment with STIG compliance"})]})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500",children:[e.jsx(q,{className:"w-4 h-4"}),"New Scan"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-100",children:c.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Scans"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:c.reduce((a,r)=>a+r.cat1_findings,0)}),e.jsx("div",{className:"text-sm text-gray-400",children:"CAT I Findings"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:c.reduce((a,r)=>a+r.cat2_findings,0)}),e.jsx("div",{className:"text-sm text-gray-400",children:"CAT II Findings"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:c.filter(a=>a.status==="completed").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Completed"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o,onChange:a=>m(a.target.value),placeholder:"Search scans...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),p?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading..."}):h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 text-gray-600"}),e.jsx("p",{className:"text-gray-400",children:"No scans found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Start a new Windows audit scan"})]}):e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Target"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"CAT I"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"CAT II"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"CAT III"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Started"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:h.map(a=>e.jsxs("tr",{className:"hover:bg-gray-700/50 cursor-pointer",onClick:()=>x(a),children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-gray-200",children:a.target}),a.system_info&&e.jsx("div",{className:"text-xs text-gray-500",children:a.system_info.os_name})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(C,{status:a.status})}),e.jsx("td",{className:"px-4 py-3 text-red-400",children:a.cat1_findings}),e.jsx("td",{className:"px-4 py-3 text-amber-400",children:a.cat2_findings}),e.jsx("td",{className:"px-4 py-3 text-yellow-400",children:a.cat3_findings}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(a.started_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx("button",{onClick:r=>{r.stopPropagation(),x(a)},className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"View Details",children:e.jsx(K,{className:"w-4 h-4"})})})})]},a.id))})]})}),e.jsx(V,{isOpen:t,onClose:()=>i(!1),onSuccess:()=>s.invalidateQueries({queryKey:["windows-audit-scans"]})}),e.jsx(X,{scan:d,onClose:()=>x(null)})]})})};export{ie as default};
