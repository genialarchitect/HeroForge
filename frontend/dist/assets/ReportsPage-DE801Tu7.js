import{b as L,u as v,d as w,j as e}from"./vendor-state-DdX3IZQk.js";import{r as i}from"./vendor-react-Da1CiaFS.js";import{F as b,b0 as _,P as C,aR as g,aD as B,aN as M,aQ as q,B as l,at as z,aG as O,aH as Q,aO as H,aP as U,bK as J,ae as V}from"./vendor-ui-wM19Qo8C.js";import{d as X,b as S,a6 as j,w as R,q as Y}from"./index-lpqdgxD1.js";import"./vendor-charts-CCbxmwBt.js";const W=a=>{switch(a.toLowerCase()){case"completed":return e.jsx(Q,{className:"w-4 h-4 text-green-400"});case"failed":return e.jsx(O,{className:"w-4 h-4 text-red-400"});case"generating":return e.jsx(g,{className:"w-4 h-4 text-cyan-400 animate-spin"});default:return e.jsx(z,{className:"w-4 h-4 text-yellow-400"})}},$=a=>{switch(a.toLowerCase()){case"pdf":return e.jsx(J,{className:"w-4 h-4 text-red-400"});case"html":return e.jsx(U,{className:"w-4 h-4 text-orange-400"});case"json":return e.jsx(H,{className:"w-4 h-4 text-blue-400"});default:return e.jsx(b,{className:"w-4 h-4 text-slate-400"})}},Z=a=>a?a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`:"-";function ee({onReportCreated:a}){const[n,d]=i.useState(""),[u,h]=i.useState(""),[m,r]=i.useState(""),[N,f]=i.useState("pdf"),[t,x]=i.useState("technical"),[o,p]=i.useState([]),[c,A]=i.useState(!0),[k,P]=i.useState(""),{data:I,isLoading:T}=v({queryKey:["scans-for-report"],queryFn:async()=>(await Y.getAll()).data}),{data:te}=v({queryKey:["report-templates"],queryFn:async()=>(await j.getTemplates()).data}),F=w({mutationFn:s=>j.create(s),onSuccess:()=>{l.success("Report generation started"),a(),h(""),r(""),d("")},onError:s=>{var y,D;l.error(((D=(y=s.response)==null?void 0:y.data)==null?void 0:D.error)||"Failed to create report")}}),E=s=>{if(s.preventDefault(),!n){l.error("Please select a scan");return}F.mutate({scan_id:n,name:u||`Report - ${new Date().toLocaleDateString()}`,description:m||void 0,format:N,template_id:t,sections:o,options:{include_branding:c,company_name:k||void 0}})},K=(I||[]).filter(s=>s.status==="completed"),G=[{id:"toc",label:"Table of Contents"},{id:"executive",label:"Executive Summary"},{id:"risk",label:"Risk Overview"},{id:"hosts",label:"Host Inventory"},{id:"ports",label:"Port Analysis"},{id:"vulns",label:"Vulnerability Findings"},{id:"enumeration",label:"Service Enumeration"},{id:"remediation",label:"Remediation Recommendations"},{id:"appendix",label:"Appendix"}];return e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-cyan-400"}),"Generate Report"]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Scan *"}),e.jsxs("select",{value:n,onChange:s=>d(s.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0,children:[e.jsx("option",{value:"",children:"Choose a completed scan..."}),K.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",new Date(s.created_at).toLocaleDateString(),")"]},s.id))]}),T&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Loading scans..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Name"}),e.jsx("input",{type:"text",value:u,onChange:s=>h(s.target.value),placeholder:"Monthly Security Assessment",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"}),e.jsx("textarea",{value:m,onChange:s=>r(s.target.value),placeholder:"Optional description...",rows:2,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Template"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"executive",label:"Executive",desc:"High-level summary"},{id:"technical",label:"Technical",desc:"Detailed findings"},{id:"compliance",label:"Compliance",desc:"Audit-ready"}].map(s=>e.jsxs("button",{type:"button",onClick:()=>x(s.id),className:`p-3 rounded-lg border text-left transition-colors ${t===s.id?"bg-cyan-500/20 border-cyan-500/50 text-cyan-400":"bg-slate-700 border-slate-600 text-slate-300 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-slate-400",children:s.desc})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Output Format"}),e.jsx("div",{className:"flex gap-2",children:["pdf","html","json"].map(s=>e.jsxs("button",{type:"button",onClick:()=>f(s),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${N===s?"bg-cyan-500/20 border-cyan-500/50 text-cyan-400":"bg-slate-700 border-slate-600 text-slate-300 hover:border-slate-500"}`,children:[$(s),e.jsx("span",{className:"uppercase",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Include Sections (leave empty for template defaults)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(s=>e.jsx("button",{type:"button",onClick:()=>{p(o.includes(s.id)?o.filter(y=>y!==s.id):[...o,s.id])},className:`px-2 py-1 rounded text-xs font-medium transition-colors ${o.includes(s.id)?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"bg-slate-700 text-slate-400 border border-slate-600 hover:border-slate-500"}`,children:s.label},s.id))})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-slate-700",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:s=>A(s.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Include company branding"})]}),c&&e.jsx("input",{type:"text",value:k,onChange:s=>P(s.target.value),placeholder:"Company name for branding",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsx(S,{type:"submit",disabled:F.isPending||!n,className:"w-full",children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4 animate-spin mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Generate Report"]})})]})]})}function se(){const a=L(),{data:n,isLoading:d}=v({queryKey:["scheduled-reports"],queryFn:async()=>(await R.getAll()).data}),u=w({mutationFn:r=>R.delete(r),onSuccess:()=>{l.success("Scheduled report deleted"),a.invalidateQueries({queryKey:["scheduled-reports"]})},onError:()=>l.error("Failed to delete scheduled report")}),h=w({mutationFn:r=>R.runNow(r),onSuccess:()=>{l.success("Report generation started"),a.invalidateQueries({queryKey:["reports"]})},onError:()=>l.error("Failed to run report")});if(d)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(g,{className:"w-8 h-8 text-cyan-400 animate-spin"})});const m=n||[];return e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Scheduled Reports"}),e.jsxs(S,{variant:"secondary",size:"sm",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"New Schedule"]})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:m.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No scheduled reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Create a schedule to automatically generate reports"})]}):m.map(r=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.is_active?"bg-green-500":"bg-slate-500"}`}),e.jsx("span",{className:"text-white font-medium",children:r.name}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${r.is_active?"bg-green-500/20 text-green-400":"bg-slate-600 text-slate-400"}`,children:r.is_active?"Active":"Disabled"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-slate-400",children:[e.jsx("span",{children:r.schedule}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"uppercase",children:r.format}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"capitalize",children:r.report_type})]}),r.last_run_at&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Last run: ",new Date(r.last_run_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h.mutate(r.id),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Run now",children:e.jsx(V,{className:"w-4 h-4 text-cyan-400"})}),e.jsx("button",{onClick:()=>{confirm("Delete this scheduled report?")&&u.mutate(r.id)},className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",children:e.jsx(q,{className:"w-4 h-4 text-slate-400 hover:text-red-400"})})]})]})},r.id))})]})}function oe(){const[a,n]=i.useState("reports"),d=L(),{data:u,isLoading:h,refetch:m}=v({queryKey:["reports"],queryFn:async()=>(await j.getAll()).data,refetchInterval:t=>{const x=t.state.data;return(x==null?void 0:x.some(p=>p.status==="generating"))?5e3:!1}}),r=w({mutationFn:t=>j.delete(t),onSuccess:()=>{l.success("Report deleted"),d.invalidateQueries({queryKey:["reports"]})},onError:()=>l.error("Failed to delete report")}),N=async t=>{try{const o=(await j.download(t.id)).data,p=window.URL.createObjectURL(o),c=document.createElement("a");c.href=p,c.download=`${t.name}.${t.format}`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(p),document.body.removeChild(c),l.success("Report downloaded")}catch{l.error("Failed to download report")}},f=u||[];return e.jsxs(X,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(b,{className:"w-7 h-7 text-cyan-400"}),"Report Generator"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Generate professional PDF, HTML, and JSON reports from scan results"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 border-b border-slate-700",children:[e.jsx("button",{onClick:()=>n("reports"),className:`pb-3 px-1 border-b-2 transition-colors ${a==="reports"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:"Reports"})]})}),e.jsx("button",{onClick:()=>n("scheduled"),className:`pb-3 px-1 border-b-2 transition-colors ${a==="scheduled"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:"Scheduled"})]})}),e.jsx("button",{onClick:()=>n("create"),className:`pb-3 px-1 border-b-2 transition-colors ${a==="create"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Create"})]})})]}),a==="reports"&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generated Reports"}),e.jsx(S,{variant:"secondary",size:"sm",onClick:()=>m(),children:e.jsx(g,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:h?e.jsx("div",{className:"p-8 text-center",children:e.jsx(g,{className:"w-8 h-8 text-cyan-400 animate-spin mx-auto"})}):f.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No reports generated yet"}),e.jsxs(S,{variant:"secondary",className:"mt-4",onClick:()=>n("create"),children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Create Your First Report"]})]}):f.map(t=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[W(t.status),$(t.format),e.jsx("span",{className:"text-white font-medium",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-slate-400",children:[e.jsx("span",{children:new Date(t.created_at).toLocaleString()}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"capitalize",children:t.template_id}),t.file_size&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"|"}),e.jsx("span",{children:Z(t.file_size)})]})]}),t.error_message&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-sm text-red-400",children:[e.jsx(B,{className:"w-3 h-3"}),t.error_message]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="completed"&&e.jsx("button",{onClick:()=>N(t),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Download",children:e.jsx(M,{className:"w-4 h-4 text-cyan-400"})}),e.jsx("button",{onClick:()=>{confirm("Delete this report?")&&r.mutate(t.id)},className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",children:e.jsx(q,{className:"w-4 h-4 text-slate-400 hover:text-red-400"})})]})]})},t.id))})]}),a==="scheduled"&&e.jsx(se,{}),a==="create"&&e.jsx("div",{className:"max-w-2xl",children:e.jsx(ee,{onReportCreated:()=>{n("reports"),d.invalidateQueries({queryKey:["reports"]})}})})]})}export{oe as default};
