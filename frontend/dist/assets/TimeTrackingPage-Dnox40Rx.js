import{j as e}from"./vendor-state-DdX3IZQk.js";import{r as l,L as H}from"./vendor-react-Da1CiaFS.js";import{S as b,d as C}from"./index-BPYi--Yq.js";import"./vendor-ui-D0INE3me.js";import"./vendor-charts-4MaU3c_5.js";function A(){const[m,w]=l.useState([]),[h,N]=l.useState([]),[a,c]=l.useState([]),[j,p]=l.useState(!0),[f,o]=l.useState(null),[x,g]=l.useState(""),[u,s]=l.useState(""),[i,n]=l.useState(!1);l.useEffect(()=>{v()},[x,u]);const v=async()=>{try{p(!0);const[t,r,d]=await Promise.all([b.timeEntries.getAll(x||void 0,u||void 0),b.engagements.getAll(),b.customers.getAll()]);w(t.data),N(r.data),c(d.data)}catch(t){const r=t instanceof Error?t.message:"Failed to load time entries";o(r)}finally{p(!1)}},k=t=>h.find(r=>r.id===t),E=t=>{const r=k(t);if(!r)return"Unknown";const d=a.find(F=>F.id===r.customer_id);return(d==null?void 0:d.name)||"Unknown"},T=t=>{const r=k(t);return(r==null?void 0:r.name)||"Unknown"},L=t=>new Date(t).toLocaleDateString(),y=t=>t.toFixed(2),D=m.reduce((t,r)=>t+r.hours,0),S=m.filter(t=>t.billable).reduce((t,r)=>t+r.hours,0),M=D-S;return l.useEffect(()=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1),d=new Date(t.getFullYear(),t.getMonth()+1,0);x||g(r.toISOString().split("T")[0]),u||s(d.toISOString().split("T")[0])},[]),j?e.jsx(C,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})})}):e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Track billable and non-billable hours"})]}),e.jsx("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:"+ Log Time"})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:f})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-indigo-100 text-indigo-600",children:e.jsx("svg",{className:"h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y(D)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:e.jsx("svg",{className:"h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Billable Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-green-600",children:y(S)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-gray-100 text-gray-600",children:e.jsx("svg",{className:"h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Non-Billable Hours"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-600",children:y(M)})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"From:"}),e.jsx("input",{type:"date",value:x,onChange:t=>g(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"To:"}),e.jsx("input",{type:"date",value:u,onChange:t=>s(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white"})]}),e.jsx("button",{onClick:()=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1),d=new Date(t.getFullYear(),t.getMonth()+1,0);g(r.toISOString().split("T")[0]),s(d.toISOString().split("T")[0])},className:"px-4 py-2 text-sm text-indigo-600 hover:text-indigo-800",children:"This Month"}),e.jsx("button",{onClick:()=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth()-1,1),d=new Date(t.getFullYear(),t.getMonth(),0);g(r.toISOString().split("T")[0]),s(d.toISOString().split("T")[0])},className:"px-4 py-2 text-sm text-indigo-600 hover:text-indigo-800",children:"Last Month"})]}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Engagement"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Billable"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:"No time entries for this period. Log your first entry!"})}):m.map(t=>{const r=k(t.engagement_id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:L(t.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r&&e.jsx(H,{to:`/crm/customers/${r.customer_id}`,className:"text-indigo-600 hover:text-indigo-900 text-sm",children:E(t.engagement_id)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:T(t.engagement_id)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",children:t.description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:y(t.hours)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.billable?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",children:"Billable"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800",children:"Non-billable"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:async()=>{if(window.confirm("Delete this time entry?"))try{await b.timeEntries.delete(t.id),v()}catch{o("Failed to delete time entry")}},className:"text-red-600 hover:text-red-900",children:"Delete"})})]},t.id)})})]})}),i&&e.jsx(_,{engagements:h,customers:a,onClose:()=>n(!1),onCreated:()=>{n(!1),v()}})]})})}function _({engagements:m,customers:w,onClose:h,onCreated:N}){const[a,c]=l.useState({engagement_id:"",description:"",hours:0,billable:!0,date:new Date().toISOString().split("T")[0]}),[j,p]=l.useState(!1),[f,o]=l.useState(null),x=s=>{const i=w.find(n=>n.id===s);return(i==null?void 0:i.name)||"Unknown"},g=m.reduce((s,i)=>{const n=i.customer_id;return s[n]||(s[n]=[]),s[n].push(i),s},{}),u=async s=>{if(s.preventDefault(),!a.description.trim()){o("Description is required");return}if(!a.engagement_id){o("Please select an engagement");return}if(a.hours<=0){o("Hours must be greater than 0");return}try{p(!0),o(null);const{engagement_id:i,...n}=a;await b.timeEntries.create(i,n),N()}catch(i){const n=i instanceof Error?i.message:"Failed to log time";o(n)}finally{p(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:h}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Log Time"}),f&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded p-3 text-red-800 text-sm",children:f}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Engagement *"}),e.jsxs("select",{value:a.engagement_id,onChange:s=>c({...a,engagement_id:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",required:!0,children:[e.jsx("option",{value:"",children:"Select an engagement"}),Object.entries(g).map(([s,i])=>e.jsx("optgroup",{label:x(s),children:i.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date *"}),e.jsx("input",{type:"date",value:a.date,onChange:s=>c({...a,date:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Hours *"}),e.jsx("input",{type:"number",value:a.hours||"",onChange:s=>c({...a,hours:parseFloat(s.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"0.00",step:"0.25",min:"0.25",required:!0})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.billable,onChange:s=>c({...a,billable:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Billable"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("textarea",{value:a.description,onChange:s=>c({...a,description:s.target.value}),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"What did you work on?",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 disabled:opacity-50",children:j?"Saving...":"Log Time"})]})]})]})]})})}export{A as default};
