import{j as e}from"./vendor-state-BjT_zREg.js";import{u as W,r as n,L as k}from"./vendor-react-5KxtEOLM.js";import{L as A}from"./Layout-DQwy8A8G.js";import{c as v}from"./index-RI0GBk2h.js";import"./vendor-ui-C4nf_tR6.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";function I(){const h=W(),[m,p]=n.useState([]),[f,a]=n.useState([]),[i,y]=n.useState([]),[b,u]=n.useState(!0),[l,j]=n.useState(null),[x,s]=n.useState(""),[d,o]=n.useState(""),[g,D]=n.useState(""),[E,w]=n.useState(!1);n.useEffect(()=>{L()},[x]);const L=async()=>{try{u(!0);const[t,r,c]=await Promise.all([v.contracts.getAll(x||void 0),v.customers.getAll(),v.engagements.getAll()]);p(t.data),a(r.data),y(c.data)}catch(t){const r=t instanceof Error?t.message:"Failed to load contracts";j(r)}finally{u(!1)}},N=t=>{const r=f.find(c=>c.id===t);return(r==null?void 0:r.name)||"Unknown"},F=t=>{if(!t)return"-";const r=i.find(c=>c.id===t);return(r==null?void 0:r.name)||"Unknown"},P=t=>{switch(t){case"active":return"bg-green-100 text-green-800";case"pending_signature":return"bg-yellow-100 text-yellow-800";case"draft":return"bg-gray-100 text-gray-800";case"expired":return"bg-orange-100 text-orange-800";case"terminated":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=t=>{switch(t){case"msa":return"MSA";case"sow":return"SOW";case"nda":return"NDA";case"amendment":return"Amendment";default:return t}},T=t=>t?new Date(t).toLocaleDateString():"-",_=t=>t===null?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(t),S=m.filter(t=>{const r=t.name.toLowerCase().includes(g.toLowerCase())||N(t.customer_id).toLowerCase().includes(g.toLowerCase()),c=!d||t.contract_type===d;return r&&c}),M=m.filter(t=>t.status==="active").reduce((t,r)=>t+(r.value||0),0);return b?e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})})}):e.jsx(A,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contracts"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Active contract value: ",_(M)]})]}),e.jsx("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:"+ New Contract"})]}),l&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:l})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search contracts...",value:g,onChange:t=>D(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white"})}),e.jsxs("select",{value:x,onChange:t=>s(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"pending_signature",children:"Pending Signature"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"terminated",children:"Terminated"})]}),e.jsxs("select",{value:d,onChange:t=>o(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"msa",children:"MSA"}),e.jsx("option",{value:"sow",children:"SOW"}),e.jsx("option",{value:"nda",children:"NDA"}),e.jsx("option",{value:"amendment",children:"Amendment"})]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contract"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Engagement"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:m.length===0?"No contracts yet. Create your first contract!":"No contracts match your filters."})}):S.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>h(`/crm/customers/${t.customer_id}`),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx("span",{className:"text-yellow-600 font-medium",children:C(t.contract_type)})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),t.notes&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:t.notes})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(k,{to:`/crm/customers/${t.customer_id}`,className:"text-indigo-600 hover:text-indigo-900",onClick:r=>r.stopPropagation(),children:N(t.customer_id)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:F(t.engagement_id)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:C(t.contract_type)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:_(t.value)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${P(t.status)}`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:T(t.end_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(k,{to:`/crm/customers/${t.customer_id}`,className:"text-indigo-600 hover:text-indigo-900",onClick:r=>r.stopPropagation(),children:"View"})})]},t.id))})]})}),E&&e.jsx($,{customers:f,engagements:i,onClose:()=>w(!1),onCreated:t=>{w(!1),h(`/crm/customers/${t.customer_id}`)}})]})})}function $({customers:h,engagements:m,onClose:p,onCreated:f}){const[a,i]=n.useState({customer_id:"",name:"",contract_type:"sow",engagement_id:void 0,value:void 0,start_date:"",end_date:"",status:"draft",notes:""}),[y,b]=n.useState(!1),[u,l]=n.useState(null),j=m.filter(s=>s.customer_id===a.customer_id),x=async s=>{if(s.preventDefault(),!a.name.trim()){l("Contract name is required");return}if(!a.customer_id){l("Please select a customer");return}try{b(!0),l(null);const{customer_id:d,...o}=a,g=await v.contracts.create(d,{...o,start_date:o.start_date||void 0,end_date:o.end_date||void 0,engagement_id:o.engagement_id||void 0});f(g.data)}catch(d){const o=d instanceof Error?d.message:"Failed to create contract";l(o)}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:p}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"New Contract"}),u&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded p-3 text-red-800 text-sm",children:u}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Customer *"}),e.jsxs("select",{value:a.customer_id,onChange:s=>i({...a,customer_id:s.target.value,engagement_id:void 0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",required:!0,children:[e.jsx("option",{value:"",children:"Select a customer"}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>i({...a,name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"e.g., Q1 2024 Pentest SOW",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Type"}),e.jsxs("select",{value:a.contract_type,onChange:s=>i({...a,contract_type:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"msa",children:"MSA - Master Service Agreement"}),e.jsx("option",{value:"sow",children:"SOW - Statement of Work"}),e.jsx("option",{value:"nda",children:"NDA - Non-Disclosure Agreement"}),e.jsx("option",{value:"amendment",children:"Amendment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:a.status||"draft",onChange:s=>i({...a,status:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"pending_signature",children:"Pending Signature"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"terminated",children:"Terminated"})]})]})]}),a.customer_id&&j.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Link to Engagement (optional)"}),e.jsxs("select",{value:a.engagement_id||"",onChange:s=>i({...a,engagement_id:s.target.value||void 0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"No engagement"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Value"}),e.jsx("input",{type:"number",value:a.value||"",onChange:s=>i({...a,value:s.target.value?parseFloat(s.target.value):void 0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"0.00",step:"0.01"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),e.jsx("input",{type:"date",value:a.start_date||"",onChange:s=>i({...a,start_date:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Date"}),e.jsx("input",{type:"date",value:a.end_date||"",onChange:s=>i({...a,end_date:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{value:a.notes||"",onChange:s=>i({...a,notes:s.target.value}),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"Additional contract notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 disabled:opacity-50",children:y?"Creating...":"Create Contract"})]})]})]})]})})}export{I as default};
