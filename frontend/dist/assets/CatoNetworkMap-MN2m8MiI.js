import{j as e}from"./vendor-state-BjT_zREg.js";import{r as n}from"./vendor-react-5KxtEOLM.js";import{e as Ze,u as Me,a as Le,f as Fe,M as r,g as Re,i as ze,B as We,b as _e,C as He,c as Oe,P as $e,R as Ve,H as G,d as J}from"./RedTeamAdvisorPanel-DoUQ2Mf-.js";import{b1 as K,X as Y,F as Be,C as Ue,h as Ge,L as Je,B as N,af as ge,au as Ke,be as Ye,z as Xe,m as ue,a6 as Qe,a7 as qe,bw as es,g as te,O as $,i as ae,a4 as ye,a5 as ss,aN as ts,E as as,a as rs,G as os,w as pe,ah as ns,ai as ls,n as is,W as cs,aj as ds,ak as ps,al as ms,am as me,an as xs,ao as gs,x as he,ap as us,S as be,s as ys,ab as hs}from"./vendor-ui-C4nf_tR6.js";import{B as A,N as O}from"./index-RI0GBk2h.js";import{L as xe}from"./Layout-DQwy8A8G.js";import{L as bs}from"./LoadingSpinner-CV5u9ki8.js";import{u as ws}from"./index-LAAdDKNL.js";import"./vendor-viz-B1vW2Pis.js";import"./vendor-charts-KBIe6Y3a.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const vs=({isOpen:s,onClose:l,onImportComplete:g,engagementId:m})=>{var D;const[c,y]=n.useState(null),[E,C]=n.useState([]),[k,j]=n.useState("auto"),[F,I]=n.useState("merge"),[Z,R]=n.useState(!1),[w,z]=n.useState(null),[W,P]=n.useState(null);n.useEffect(()=>{s&&(async()=>{try{const f=await O.get("/api/network-topology/import/formats");C(f.data.formats||[])}catch(f){console.error("Failed to fetch formats:",f)}})()},[s]);const p=n.useCallback(i=>{if(i.length>0){y(i[0]),P(null),z(null);const f=i[0].name.toLowerCase();f.endsWith(".xml")?j("nmap_xml"):f.endsWith(".gnmap")?j("nmap_grepable"):f.endsWith(".json")?j("masscan_json"):j("auto")}},[]),{getRootProps:_,getInputProps:Q,isDragActive:V}=ws({onDrop:p,accept:{"text/xml":[".xml"],"application/xml":[".xml"],"application/json":[".json"],"text/plain":[".txt",".log",".gnmap",".greppable"]},maxFiles:1,maxSize:10*1024*1024}),T=async()=>{var i,f;if(!c){P("Please select a file to import");return}R(!0),P(null);try{const M=new FormData;M.append("file",c);const v=new URLSearchParams;k!=="auto"&&v.append("format",k),v.append("mergeMode",F),m&&v.append("engagementId",m);const S=await O.post(`/api/network-topology/import/tool?${v.toString()}`,M,{headers:{"Content-Type":"multipart/form-data"}});S.data.success?(g(S.data.nodes,S.data.edges,S.data.stats),N.success(`Imported ${S.data.stats.hostsImported} hosts with ${S.data.stats.portsDiscovered} ports`),l()):P(S.data.error||"Import failed")}catch(M){const v=((f=(i=M.response)==null?void 0:i.data)==null?void 0:f.error)||M.message||"Import failed";P(v),N.error(v)}finally{R(!1)}},B=()=>{y(null),z(null),P(null),j("auto"),I("merge"),l()};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(K,{className:"w-6 h-6 text-cyan-400"}),"Import Network Topology"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Upload scan results from nmap, masscan, netcat, or rustscan"})]}),e.jsx("button",{onClick:B,className:"text-gray-400 hover:text-white",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{..._(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${V?"border-cyan-500 bg-cyan-500/10":c?"border-green-500 bg-green-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx("input",{...Q()}),c?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(Be,{className:"w-10 h-10 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-white font-medium",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:[(c.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),y(null),z(null)},className:"ml-4 text-gray-400 hover:text-red-400",children:e.jsx(Y,{className:"w-5 h-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-12 h-12 text-gray-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-300",children:V?"Drop the file here...":"Drag & drop a scan file, or click to select"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Supports: .xml, .gnmap, .json, .txt, .log (max 10MB)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"File Format"}),e.jsxs("select",{value:k,onChange:i=>j(i.target.value),className:"w-full p-2.5 bg-gray-900 border border-gray-600 rounded-lg text-white",children:[e.jsx("option",{value:"auto",children:"Auto-detect"}),E.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),k!=="auto"&&E.find(i=>i.id===k)&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(D=E.find(i=>i.id===k))==null?void 0:D.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Import Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"merge",label:"Merge",desc:"Add new hosts, update existing"},{value:"replace",label:"Replace",desc:"Replace all existing nodes"},{value:"append",label:"Append",desc:"Add all nodes (may duplicate)"}].map(i=>e.jsxs("button",{onClick:()=>I(i.value),className:`p-3 rounded-lg border text-left transition-colors ${F===i.value?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx("div",{className:"font-medium text-white",children:i.label}),e.jsx("div",{className:"text-xs text-gray-400",children:i.desc})]},i.value))})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ue,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Supported Tool Commands"})]}),e.jsxs("div",{className:"space-y-2 text-xs font-mono text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-cyan-400",children:"nmap:"})," ","nmap -sV -oX output.xml <target>"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-cyan-400",children:"nmap (grep):"})," ","nmap -sV -oG output.gnmap <target>"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-cyan-400",children:"masscan:"})," ","masscan -p1-65535 -oJ output.json <target>"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-cyan-400",children:"netcat:"})," ","nc -zv <host> 1-1000 2>&1 | tee output.txt"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-cyan-400",children:"rustscan:"})," ","rustscan -a <target> --greppable > output.txt"]})]})]}),W&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[e.jsx(Ge,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-400",children:W})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:[e.jsx(A,{variant:"secondary",onClick:B,children:"Cancel"}),e.jsx(A,{onClick:T,disabled:!c||Z,children:Z?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Import"]})})]})]})}):null},re={router:us,switch:ge,firewall:ye,server:he,database:gs,cloud:xs,workstation:me,laptop:me,mobile:ms,iot:pe,printer:ps,camera:ds,wireless_ap:cs,load_balancer:is,storage:ls,container:ns,virtual_machine:pe,internet:os,vpn:rs},we={router:"Router",switch:"Switch",firewall:"Firewall",server:"Server",database:"Database",cloud:"Cloud Service",workstation:"Workstation",laptop:"Laptop",mobile:"Mobile Device",iot:"IoT Device",printer:"Printer",camera:"Camera",wireless_ap:"Wireless AP",load_balancer:"Load Balancer",storage:"Storage",container:"Container",virtual_machine:"Virtual Machine",internet:"Internet",vpn:"VPN Gateway"},X={external:{bg:"bg-red-500/10",border:"border-red-500",text:"text-red-400"},dmz:{bg:"bg-yellow-500/10",border:"border-yellow-500",text:"text-yellow-400"},internal:{bg:"bg-blue-500/10",border:"border-blue-500",text:"text-blue-400"},restricted:{bg:"bg-purple-500/10",border:"border-purple-500",text:"text-purple-400"},management:{bg:"bg-green-500/10",border:"border-green-500",text:"text-green-400"}},fs={compliant:"ring-green-500",non_compliant:"ring-red-500",partial:"ring-yellow-500",not_assessed:"ring-gray-500"},js=({data:s,selected:l})=>{const g=re[s.deviceType]||he,m=X[s.securityZone],c=fs[s.complianceStatus],y=()=>{switch(s.complianceStatus){case"compliant":return e.jsx(te,{className:"w-3 h-3 text-green-400"});case"non_compliant":return e.jsx(ae,{className:"w-3 h-3 text-red-400"});case"partial":return e.jsx($,{className:"w-3 h-3 text-yellow-400"});default:return e.jsx(be,{className:"w-3 h-3 text-gray-400"})}};return e.jsxs("div",{className:`relative px-4 py-3 rounded-lg border-2 ${m.bg} ${m.border} ${l?"ring-2 ring-cyan-400":""} transition-all shadow-lg hover:shadow-xl`,children:[e.jsx(G,{type:"target",position:J.Top,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx(G,{type:"source",position:J.Bottom,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx(G,{type:"target",position:J.Left,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx(G,{type:"source",position:J.Right,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx("div",{className:`absolute -top-2 -right-2 p-1 rounded-full bg-gray-900 ring-2 ${c}`,children:e.jsx(y,{})}),e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[100px]",children:[e.jsx("div",{className:`p-3 rounded-lg bg-gray-800/80 ${m.border} border`,children:e.jsx(g,{className:`w-8 h-8 ${m.text}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-white text-sm",children:s.label}),s.ipAddress&&e.jsx("div",{className:"text-xs text-gray-400 font-mono",children:s.ipAddress}),s.hostname&&e.jsx("div",{className:"text-xs text-gray-500",children:s.hostname})]}),s.vulnerabilities&&s.vulnerabilities>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-400 bg-red-500/20 px-2 py-0.5 rounded",children:[e.jsx($,{className:"w-3 h-3"}),s.vulnerabilities," vuln"]})]})]})},Ns=({data:s})=>{const l=X[s.zone];return e.jsx("div",{className:`px-6 py-4 rounded-xl border-2 border-dashed ${l.border} ${l.bg} min-w-[200px] min-h-[150px]`,style:{pointerEvents:"none"},children:e.jsx("div",{className:`text-sm font-bold ${l.text} uppercase tracking-wider`,children:s.label})})},ks={networkDevice:js,securityZone:Ns},ee=()=>{const s=[{id:"internet",type:"networkDevice",position:{x:450,y:0},data:{label:"Internet",deviceType:"internet",securityZone:"external",complianceStatus:"not_assessed",description:"AT&T Fiber 500Mbps"}},{id:"cloud-ehr",type:"networkDevice",position:{x:150,y:80},data:{label:"Epic MyChart Cloud",deviceType:"cloud",securityZone:"external",complianceStatus:"compliant",controlsAssessed:150,controlsPassing:148,description:"Epic Systems hosted EHR cloud services"}},{id:"telehealth-cloud",type:"networkDevice",position:{x:750,y:80},data:{label:"Teladoc Health",deviceType:"cloud",securityZone:"external",complianceStatus:"compliant",controlsAssessed:85,controlsPassing:82,description:"Telehealth platform for rural patients"}},{id:"perimeter-fw",type:"networkDevice",position:{x:450,y:180},data:{label:"Palo Alto PA-820",deviceType:"firewall",securityZone:"dmz",ipAddress:"10.0.0.1",hostname:"fw-perimeter-01",complianceStatus:"compliant",controlsAssessed:65,controlsPassing:63,description:"Next-gen firewall with threat prevention"}},{id:"dmz-switch",type:"networkDevice",position:{x:450,y:280},data:{label:"DMZ Switch",deviceType:"switch",securityZone:"dmz",ipAddress:"10.0.1.1",hostname:"sw-dmz-01",os:"Cisco IOS",complianceStatus:"compliant",controlsAssessed:25,controlsPassing:25}},{id:"patient-portal",type:"networkDevice",position:{x:250,y:380},data:{label:"Patient Portal",deviceType:"server",securityZone:"dmz",ipAddress:"10.0.1.10",hostname:"portal-01",os:"Windows Server 2019",complianceStatus:"compliant",controlsAssessed:95,controlsPassing:92,description:"Patient records access & appointment scheduling"}},{id:"vpn-gateway",type:"networkDevice",position:{x:450,y:380},data:{label:"Cisco ASA VPN",deviceType:"vpn",securityZone:"dmz",ipAddress:"10.0.1.11",hostname:"vpn-01",complianceStatus:"compliant",controlsAssessed:45,controlsPassing:44,description:"Remote physician & staff access"}},{id:"telehealth-server",type:"networkDevice",position:{x:650,y:380},data:{label:"Telehealth Gateway",deviceType:"server",securityZone:"dmz",ipAddress:"10.0.1.12",hostname:"telehealth-01",os:"Ubuntu 22.04",complianceStatus:"partial",controlsAssessed:70,controlsPassing:62,vulnerabilities:2,description:"Video conferencing for remote consultations"}},{id:"internal-fw",type:"networkDevice",position:{x:450,y:500},data:{label:"Internal Firewall",deviceType:"firewall",securityZone:"internal",ipAddress:"10.1.0.1",hostname:"fw-internal-01",complianceStatus:"compliant",controlsAssessed:55,controlsPassing:54}},{id:"core-switch",type:"networkDevice",position:{x:450,y:600},data:{label:"Core Switch Stack",deviceType:"switch",securityZone:"internal",ipAddress:"10.1.1.1",hostname:"sw-core-01",os:"Cisco Catalyst 9300",complianceStatus:"compliant",controlsAssessed:30,controlsPassing:30}},{id:"ehr-server",type:"networkDevice",position:{x:200,y:720},data:{label:"Epic EHR Server",deviceType:"server",securityZone:"internal",ipAddress:"10.1.2.10",hostname:"ehr-prod-01",os:"Windows Server 2019",complianceStatus:"compliant",controlsAssessed:120,controlsPassing:118,description:"Primary Electronic Health Records system"}},{id:"ad-server",type:"networkDevice",position:{x:350,y:720},data:{label:"Active Directory",deviceType:"server",securityZone:"internal",ipAddress:"10.1.2.11",hostname:"dc-01",os:"Windows Server 2022",complianceStatus:"compliant",controlsAssessed:85,controlsPassing:83,description:"Identity management & authentication"}},{id:"pharmacy-server",type:"networkDevice",position:{x:500,y:720},data:{label:"Pharmacy System",deviceType:"server",securityZone:"internal",ipAddress:"10.1.2.12",hostname:"pharmacy-01",os:"Windows Server 2016",complianceStatus:"partial",controlsAssessed:75,controlsPassing:65,vulnerabilities:4,description:"McKesson Pharmacy - legacy system"}},{id:"lab-server",type:"networkDevice",position:{x:650,y:720},data:{label:"Lab Info System",deviceType:"server",securityZone:"internal",ipAddress:"10.1.2.13",hostname:"lis-01",os:"Windows Server 2019",complianceStatus:"compliant",controlsAssessed:80,controlsPassing:77,description:"Sunquest LIS - Laboratory management"}},{id:"clinical-ap-1",type:"networkDevice",position:{x:100,y:850},data:{label:"Nurses Station AP",deviceType:"wireless_ap",securityZone:"internal",ipAddress:"10.1.3.10",hostname:"ap-nurses-01",complianceStatus:"compliant",controlsAssessed:25,controlsPassing:24,description:"2nd Floor Nurses Station"}},{id:"clinical-ap-2",type:"networkDevice",position:{x:250,y:850},data:{label:"ER AP",deviceType:"wireless_ap",securityZone:"internal",ipAddress:"10.1.3.11",hostname:"ap-er-01",complianceStatus:"compliant",controlsAssessed:25,controlsPassing:25,description:"Emergency Room wireless"}},{id:"nursing-cow",type:"networkDevice",position:{x:100,y:960},data:{label:"Nursing COW",deviceType:"workstation",securityZone:"internal",ipAddress:"DHCP",hostname:"cow-nursing-01",os:"Windows 10 LTSC",complianceStatus:"compliant",controlsAssessed:55,controlsPassing:53,description:"Computer on Wheels - Patient bedside"}},{id:"er-workstation",type:"networkDevice",position:{x:250,y:960},data:{label:"ER Workstation",deviceType:"workstation",securityZone:"internal",ipAddress:"10.1.4.50",hostname:"ws-er-01",os:"Windows 10",complianceStatus:"compliant",controlsAssessed:55,controlsPassing:52}},{id:"meddev-fw",type:"networkDevice",position:{x:800,y:600},data:{label:"Medical Device FW",deviceType:"firewall",securityZone:"restricted",ipAddress:"10.2.0.1",hostname:"fw-meddev-01",complianceStatus:"compliant",controlsAssessed:50,controlsPassing:50,description:"Isolates medical devices per FDA guidance"}},{id:"meddev-switch",type:"networkDevice",position:{x:900,y:720},data:{label:"Med Device Switch",deviceType:"switch",securityZone:"restricted",ipAddress:"10.2.1.1",hostname:"sw-meddev-01",complianceStatus:"compliant",controlsAssessed:25,controlsPassing:25}},{id:"ct-scanner",type:"networkDevice",position:{x:800,y:850},data:{label:"GE CT Scanner",deviceType:"iot",securityZone:"restricted",ipAddress:"10.2.1.10",hostname:"ct-radiology-01",os:"Windows Embedded",complianceStatus:"partial",controlsAssessed:40,controlsPassing:28,vulnerabilities:6,description:"GE Revolution CT - Legacy Windows"}},{id:"mri-scanner",type:"networkDevice",position:{x:950,y:850},data:{label:"Siemens MRI",deviceType:"iot",securityZone:"restricted",ipAddress:"10.2.1.11",hostname:"mri-01",os:"Linux",complianceStatus:"compliant",controlsAssessed:45,controlsPassing:42,description:"Siemens MAGNETOM Aera 1.5T"}},{id:"patient-monitors",type:"networkDevice",position:{x:1050,y:720},data:{label:"Patient Monitors",deviceType:"iot",securityZone:"restricted",ipAddress:"10.2.1.20-30",hostname:"pmonitor-*",complianceStatus:"partial",controlsAssessed:35,controlsPassing:30,vulnerabilities:3,description:"Philips IntelliVue bedside monitors (12 units)"}},{id:"infusion-pumps",type:"networkDevice",position:{x:1050,y:850},data:{label:"Infusion Pumps",deviceType:"iot",securityZone:"restricted",ipAddress:"10.2.1.40-60",hostname:"pump-*",complianceStatus:"non_compliant",controlsAssessed:30,controlsPassing:18,vulnerabilities:8,description:"BD Alaris pumps - Known vulnerabilities"}},{id:"pacs-server",type:"networkDevice",position:{x:875,y:960},data:{label:"PACS Server",deviceType:"storage",securityZone:"restricted",ipAddress:"10.2.2.10",hostname:"pacs-01",os:"Windows Server 2019",complianceStatus:"compliant",controlsAssessed:70,controlsPassing:68,description:"Hologic PACS - Medical imaging storage"}},{id:"db-firewall",type:"networkDevice",position:{x:450,y:850},data:{label:"Database Firewall",deviceType:"firewall",securityZone:"restricted",ipAddress:"10.2.10.1",hostname:"fw-db-01",complianceStatus:"compliant",controlsAssessed:55,controlsPassing:55}},{id:"ehr-database",type:"networkDevice",position:{x:380,y:980},data:{label:"EHR Database",deviceType:"database",securityZone:"restricted",ipAddress:"10.2.10.10",hostname:"db-ehr-01",os:"SQL Server 2019",complianceStatus:"compliant",controlsAssessed:90,controlsPassing:88,description:"Primary patient data - Encrypted at rest"}},{id:"backup-server",type:"networkDevice",position:{x:520,y:980},data:{label:"Backup Server",deviceType:"storage",securityZone:"restricted",ipAddress:"10.2.10.20",hostname:"backup-01",os:"Veeam B&R",complianceStatus:"compliant",controlsAssessed:50,controlsPassing:49,description:"Encrypted backups with off-site replication"}},{id:"mgmt-switch",type:"networkDevice",position:{x:50,y:600},data:{label:"IT Mgmt Switch",deviceType:"switch",securityZone:"management",ipAddress:"10.3.0.1",hostname:"sw-mgmt-01",complianceStatus:"compliant",controlsAssessed:20,controlsPassing:20}},{id:"it-workstation",type:"networkDevice",position:{x:-50,y:720},data:{label:"IT Admin PC",deviceType:"workstation",securityZone:"management",ipAddress:"10.3.1.10",hostname:"it-admin-01",os:"Windows 11 Pro",complianceStatus:"compliant",controlsAssessed:60,controlsPassing:58,description:"Hospital IT Administrator workstation"}},{id:"siem-server",type:"networkDevice",position:{x:50,y:720},data:{label:"SIEM (LogRhythm)",deviceType:"server",securityZone:"management",ipAddress:"10.3.1.20",hostname:"siem-01",os:"CentOS 7",complianceStatus:"compliant",controlsAssessed:65,controlsPassing:62,description:"Security monitoring & HIPAA audit logging"}},{id:"av-server",type:"networkDevice",position:{x:150,y:720},data:{label:"Symantec EPP",deviceType:"server",securityZone:"management",ipAddress:"10.3.1.21",hostname:"av-mgmt-01",os:"Windows Server 2019",complianceStatus:"compliant",controlsAssessed:45,controlsPassing:44,description:"Endpoint protection management"}},{id:"admin-switch",type:"networkDevice",position:{x:600,y:600},data:{label:"Admin Switch",deviceType:"switch",securityZone:"internal",ipAddress:"10.1.10.1",hostname:"sw-admin-01",complianceStatus:"compliant",controlsAssessed:20,controlsPassing:20}},{id:"billing-server",type:"networkDevice",position:{x:550,y:500},data:{label:"Billing/Revenue",deviceType:"server",securityZone:"internal",ipAddress:"10.1.10.10",hostname:"billing-01",os:"Windows Server 2019",complianceStatus:"compliant",controlsAssessed:75,controlsPassing:72,description:"Cerner Revenue Cycle Management"}},{id:"hr-workstation",type:"networkDevice",position:{x:700,y:500},data:{label:"HR/Payroll",deviceType:"workstation",securityZone:"internal",ipAddress:"10.1.10.50",hostname:"ws-hr-01",os:"Windows 10",complianceStatus:"compliant",controlsAssessed:50,controlsPassing:48,description:"ADP Workforce access"}},{id:"print-server",type:"networkDevice",position:{x:650,y:850},data:{label:"Print Server",deviceType:"server",securityZone:"internal",ipAddress:"10.1.10.30",hostname:"print-01",os:"Windows Server 2016",complianceStatus:"partial",controlsAssessed:35,controlsPassing:28,vulnerabilities:3,description:"Manages 15 network printers"}}],l=[{id:"e-internet-fw",source:"internet",target:"perimeter-fw",animated:!0,style:{stroke:"#ef4444"},markerEnd:{type:r.ArrowClosed,color:"#ef4444"},label:"HTTPS/443",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"public"}},{id:"e-ehr-cloud",source:"cloud-ehr",target:"perimeter-fw",animated:!0,style:{stroke:"#ef4444"},markerEnd:{type:r.ArrowClosed,color:"#ef4444"},label:"TLS/443",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"restricted"}},{id:"e-telehealth-cloud",source:"telehealth-cloud",target:"perimeter-fw",animated:!0,style:{stroke:"#ef4444"},markerEnd:{type:r.ArrowClosed,color:"#ef4444"},label:"WebRTC/HTTPS",data:{protocol:"WebRTC",encrypted:!0,dataClassification:"confidential"}},{id:"e-fw-dmz",source:"perimeter-fw",target:"dmz-switch",style:{stroke:"#eab308"},markerEnd:{type:r.ArrowClosed,color:"#eab308"}},{id:"e-dmz-portal",source:"dmz-switch",target:"patient-portal",style:{stroke:"#eab308"},markerEnd:{type:r.ArrowClosed,color:"#eab308"},label:"HTTPS/443",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"confidential"}},{id:"e-dmz-vpn",source:"dmz-switch",target:"vpn-gateway",style:{stroke:"#eab308"},markerEnd:{type:r.ArrowClosed,color:"#eab308"},label:"IPSec/500",data:{protocol:"IPSec",port:500,encrypted:!0}},{id:"e-dmz-telehealth",source:"dmz-switch",target:"telehealth-server",style:{stroke:"#eab308"},markerEnd:{type:r.ArrowClosed,color:"#eab308"},label:"HTTPS/443",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"confidential"}},{id:"e-dmz-internal",source:"dmz-switch",target:"internal-fw",style:{stroke:"#3b82f6",strokeWidth:2},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-intfw-core",source:"internal-fw",target:"core-switch",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-core-ehr",source:"core-switch",target:"ehr-server",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"HL7/FHIR",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"restricted"}},{id:"e-core-ad",source:"core-switch",target:"ad-server",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"LDAP/636",data:{protocol:"LDAPS",port:636,encrypted:!0}},{id:"e-core-pharmacy",source:"core-switch",target:"pharmacy-server",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-core-lab",source:"core-switch",target:"lab-server",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"HL7/2575",data:{protocol:"HL7",port:2575,dataClassification:"confidential"}},{id:"e-core-ap1",source:"core-switch",target:"clinical-ap-1",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-core-ap2",source:"core-switch",target:"clinical-ap-2",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-ap1-cow",source:"clinical-ap-1",target:"nursing-cow",style:{stroke:"#3b82f6",strokeDasharray:"5,5"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"WPA3",data:{protocol:"WiFi",encrypted:!0}},{id:"e-ap2-er",source:"clinical-ap-2",target:"er-workstation",style:{stroke:"#3b82f6",strokeDasharray:"5,5"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"WPA3",data:{protocol:"WiFi",encrypted:!0}},{id:"e-core-medfw",source:"core-switch",target:"meddev-fw",style:{stroke:"#a855f7",strokeWidth:2},markerEnd:{type:r.ArrowClosed,color:"#a855f7"}},{id:"e-medfw-sw",source:"meddev-fw",target:"meddev-switch",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"}},{id:"e-medsw-ct",source:"meddev-switch",target:"ct-scanner",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"DICOM/104",data:{protocol:"DICOM",port:104,dataClassification:"restricted"}},{id:"e-medsw-mri",source:"meddev-switch",target:"mri-scanner",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"DICOM/104",data:{protocol:"DICOM",port:104,dataClassification:"restricted"}},{id:"e-medsw-monitors",source:"meddev-switch",target:"patient-monitors",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"HL7/2575",data:{protocol:"HL7",port:2575,dataClassification:"confidential"}},{id:"e-medsw-pumps",source:"meddev-switch",target:"infusion-pumps",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"Proprietary",data:{dataClassification:"restricted"}},{id:"e-medsw-pacs",source:"meddev-switch",target:"pacs-server",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"DICOM/104",data:{protocol:"DICOM",port:104,dataClassification:"restricted"}},{id:"e-ct-pacs",source:"ct-scanner",target:"pacs-server",style:{stroke:"#a855f7",strokeDasharray:"3,3"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"Image Transfer"},{id:"e-mri-pacs",source:"mri-scanner",target:"pacs-server",style:{stroke:"#a855f7",strokeDasharray:"3,3"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"Image Transfer"},{id:"e-ehr-dbfw",source:"ehr-server",target:"db-firewall",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"TDS/1433",data:{protocol:"SQL Server",port:1433,encrypted:!0,dataClassification:"restricted"}},{id:"e-dbfw-ehrdb",source:"db-firewall",target:"ehr-database",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"}},{id:"e-dbfw-backup",source:"db-firewall",target:"backup-server",style:{stroke:"#a855f7"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"}},{id:"e-ehrdb-backup",source:"ehr-database",target:"backup-server",style:{stroke:"#a855f7",strokeDasharray:"3,3"},markerEnd:{type:r.ArrowClosed,color:"#a855f7"},label:"Backup",data:{encrypted:!0,dataClassification:"restricted"}},{id:"e-core-mgmt",source:"core-switch",target:"mgmt-switch",style:{stroke:"#22c55e"},markerEnd:{type:r.ArrowClosed,color:"#22c55e"}},{id:"e-mgmt-it",source:"mgmt-switch",target:"it-workstation",style:{stroke:"#22c55e"},markerEnd:{type:r.ArrowClosed,color:"#22c55e"}},{id:"e-mgmt-siem",source:"mgmt-switch",target:"siem-server",style:{stroke:"#22c55e"},markerEnd:{type:r.ArrowClosed,color:"#22c55e"},label:"Syslog/514",data:{protocol:"Syslog",port:514}},{id:"e-mgmt-av",source:"mgmt-switch",target:"av-server",style:{stroke:"#22c55e"},markerEnd:{type:r.ArrowClosed,color:"#22c55e"}},{id:"e-core-admin",source:"core-switch",target:"admin-switch",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-admin-billing",source:"admin-switch",target:"billing-server",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"HTTPS/443",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"confidential"}},{id:"e-admin-hr",source:"admin-switch",target:"hr-workstation",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"}},{id:"e-admin-print",source:"admin-switch",target:"print-server",style:{stroke:"#3b82f6"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"IPP/631",data:{protocol:"IPP",port:631}},{id:"e-ehr-pharmacy",source:"ehr-server",target:"pharmacy-server",style:{stroke:"#3b82f6",strokeDasharray:"3,3"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"NCPDP/HL7",data:{protocol:"HL7",dataClassification:"restricted"}},{id:"e-ehr-lab",source:"ehr-server",target:"lab-server",style:{stroke:"#3b82f6",strokeDasharray:"3,3"},markerEnd:{type:r.ArrowClosed,color:"#3b82f6"},label:"HL7 Orders/Results",data:{protocol:"HL7",dataClassification:"restricted"}}];return{nodes:s,edges:l}},Ss=({isOpen:s,onClose:l,onAdd:g})=>{const[m,c]=n.useState("server"),[y,E]=n.useState(""),[C,k]=n.useState(""),[j,F]=n.useState(""),[I,Z]=n.useState("internal");if(!s)return null;const R=()=>{if(!y){N.error("Please enter a device name");return}g({label:y,deviceType:m,ipAddress:C||void 0,hostname:j||void 0,securityZone:I,complianceStatus:"not_assessed",position:{x:400,y:400}}),E(""),k(""),F(""),l()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Add Network Device"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Device Type"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Object.entries(we).map(([w,z])=>{const W=re[w];return e.jsxs("button",{onClick:()=>c(w),className:`p-2 rounded-lg border flex flex-col items-center gap-1 ${m===w?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(W,{className:"w-5 h-5 text-gray-300"}),e.jsx("span",{className:"text-xs text-gray-400 truncate w-full text-center",children:z})]},w)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Device Name"}),e.jsx("input",{type:"text",value:y,onChange:w=>E(w.target.value),placeholder:"e.g., Web Server 1",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"IP Address"}),e.jsx("input",{type:"text",value:C,onChange:w=>k(w.target.value),placeholder:"e.g., 10.0.0.1",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Hostname"}),e.jsx("input",{type:"text",value:j,onChange:w=>F(w.target.value),placeholder:"e.g., server-01",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Security Zone"}),e.jsxs("select",{value:I,onChange:w=>Z(w.target.value),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white",children:[e.jsx("option",{value:"external",children:"External (Untrusted)"}),e.jsx("option",{value:"dmz",children:"DMZ (Demilitarized Zone)"}),e.jsx("option",{value:"internal",children:"Internal (Trusted)"}),e.jsx("option",{value:"restricted",children:"Restricted (High Security)"}),e.jsx("option",{value:"management",children:"Management"})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:[e.jsx(A,{variant:"secondary",onClick:l,children:"Cancel"}),e.jsxs(A,{onClick:R,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Add Device"]})]})]})})},As=({device:s,onClose:l,onUpdate:g,onDelete:m})=>{if(!s)return null;const c=re[s.data.deviceType],y=X[s.data.securityZone];return e.jsxs("div",{className:"absolute right-4 top-4 w-80 bg-gray-800 rounded-lg border border-gray-700 shadow-xl z-10",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${y.bg} ${y.border} border`,children:e.jsx(c,{className:`w-5 h-5 ${y.text}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:s.data.label}),e.jsx("p",{className:"text-xs text-gray-400",children:we[s.data.deviceType]})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3 text-sm",children:[s.data.ipAddress&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"IP Address"}),e.jsx("span",{className:"text-white font-mono",children:s.data.ipAddress})]}),s.data.hostname&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Hostname"}),e.jsx("span",{className:"text-white",children:s.data.hostname})]}),s.data.os&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"OS/Platform"}),e.jsx("span",{className:"text-white",children:s.data.os})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Security Zone"}),e.jsx("span",{className:y.text,children:s.data.securityZone.toUpperCase()})]}),e.jsxs("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[e.jsx("h4",{className:"text-gray-400 mb-2",children:"Compliance Status"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.data.complianceStatus==="compliant"&&e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-green-400",children:"Compliant"})]}),s.data.complianceStatus==="non_compliant"&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-red-400",children:"Non-Compliant"})]}),s.data.complianceStatus==="partial"&&e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400",children:"Partially Compliant"})]}),s.data.complianceStatus==="not_assessed"&&e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Not Assessed"})]})]}),s.data.controlsAssessed&&e.jsxs("div",{className:"text-xs text-gray-400",children:[s.data.controlsPassing||0,"/",s.data.controlsAssessed," controls passing",e.jsx("div",{className:"w-full h-2 bg-gray-700 rounded-full mt-1",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${(s.data.controlsPassing||0)/s.data.controlsAssessed*100}%`}})})]}),s.data.vulnerabilities&&s.data.vulnerabilities>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-red-400 text-xs bg-red-500/10 p-2 rounded",children:[e.jsx($,{className:"w-4 h-4"}),s.data.vulnerabilities," vulnerabilities detected"]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 flex gap-2",children:[e.jsxs(A,{variant:"secondary",size:"sm",className:"flex-1",children:[e.jsx(ys,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(A,{variant:"secondary",size:"sm",className:"text-red-400 hover:text-red-300",onClick:()=>m(s.id),children:e.jsx(hs,{className:"w-4 h-4"})})]})]})},oe="heroforge_cato_topology_positions",ne="heroforge_cato_topology_viewport",Cs=s=>{const l={};s.forEach(g=>{l[g.id]={x:g.position.x,y:g.position.y}}),localStorage.setItem(oe,JSON.stringify(l))},Ps=()=>{try{const s=localStorage.getItem(oe);if(s)return JSON.parse(s)}catch(s){console.error("Failed to load topology positions:",s)}return null},Ts=s=>{localStorage.setItem(ne,JSON.stringify(s))},Ds=()=>{try{const s=localStorage.getItem(ne);if(s)return JSON.parse(s)}catch(s){console.error("Failed to load topology viewport:",s)}return null},se=(s,l)=>l?s.map(g=>{const m=l[g.id];return m?{...g,position:m}:g}):s,Es=()=>{const[s,l,g]=Me([]),[m,c,y]=Le([]),[E,C]=n.useState(null),[k,j]=n.useState(!1),[F,I]=n.useState(!1),[Z,R]=n.useState(!0),[w,z]=n.useState(!0),[W,P]=n.useState(!0),[p,_]=n.useState(null),[Q,V]=n.useState([]),[T,B]=n.useState(""),[D,i]=n.useState("api"),[f,M]=n.useState(!1),[v,S]=n.useState(!1),[le,ie]=n.useState(void 0),ve=n.useRef(null),q=n.useRef(null),{setViewport:ce,getViewport:de}=Fe();n.useEffect(()=>{const t=Ds();t&&(ie(t),setTimeout(()=>{ce(t)},100))},[ce]);const fe=n.useCallback(t=>{g(t),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{l(o=>(Cs(o),o))},300)},[g,l]),je=n.useCallback(()=>{const t=de();Ts(t)},[de]),Ne=n.useMemo(()=>{const t=s.filter(a=>a.type==="networkDevice").map(a=>({id:a.id,label:a.data.label,device_type:a.data.deviceType,security_zone:a.data.securityZone,ip_address:a.data.ipAddress,hostname:a.data.hostname,os:a.data.os,compliance_status:a.data.complianceStatus,vulnerabilities:a.data.vulnerabilities})),o=m.map(a=>{var x,u,d,L;return{source:a.source,target:a.target,protocol:(x=a.data)==null?void 0:x.protocol,port:(u=a.data)==null?void 0:u.port,encrypted:(d=a.data)==null?void 0:d.encrypted,data_classification:(L=a.data)==null?void 0:L.dataClassification}});return{nodes:t,edges:o,metadata:{name:p==null?void 0:p.name,industry:"healthcare",compliance_frameworks:["HIPAA","NIST 800-53"]}}},[s,m,p]);n.useEffect(()=>{(async()=>{try{const o=await O.get("/api/engagements");V(o.data.engagements||o.data||[])}catch(o){console.error("Failed to fetch engagements:",o)}})()},[]),n.useEffect(()=>{(async()=>{P(!0);const o=Ps();try{if(D==="sample"){const{nodes:a,edges:x}=ee(),u=se(a,o);l(u),c(x),_({name:"Sample Network Topology",description:"Demo topology with sample devices",lastUpdated:new Date().toISOString(),totalDevices:a.length,totalConnections:x.length,dataSource:"sample"})}else{const a=T?`?engagement_id=${T}`:"",u=(await O.get(`/api/network-topology${a}`)).data;if(u.nodes&&u.nodes.length>0){const d=se(u.nodes,o);l(d),c(u.edges||[]),_(u.metadata)}else N.info("No network topology data found. You can add devices or use sample data."),l([]),c([]),_({name:"New Network Topology",description:"Add devices to build your network map",lastUpdated:new Date().toISOString(),totalDevices:0,totalConnections:0,dataSource:"empty"})}}catch(a){console.error("Failed to fetch topology:",a),N.error("Failed to load topology. Using sample data.");const{nodes:x,edges:u}=ee(),d=se(x,o);l(d),c(u),i("sample")}finally{P(!1)}})()},[T,D,l,c]);const ke=n.useCallback(t=>{const o={...t,markerEnd:{type:r.ArrowClosed,color:"#06b6d4"},style:{stroke:"#06b6d4"}};c(a=>Re(o,a))},[c]),Se=n.useCallback((t,o)=>{C(o)},[]),Ae=n.useCallback(()=>{C(null)},[]),Ce=t=>{const o={id:`device-${Date.now()}`,type:"networkDevice",position:t.position,data:{label:t.label||"New Device",deviceType:t.deviceType||"server",securityZone:t.securityZone||"internal",ipAddress:t.ipAddress,hostname:t.hostname,complianceStatus:"not_assessed"}};l(a=>[...a,o]),N.success(`Added ${t.label}`)},Pe=t=>{l(o=>o.filter(a=>a.id!==t)),c(o=>o.filter(a=>a.source!==t&&a.target!==t)),C(null),N.success("Device removed")},Te=()=>{const t={nodes:s,edges:m},o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(o),x=document.createElement("a");x.href=a,x.download=`cato-network-map-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(a),N.success("Network map exported")},De=()=>{N.info("Image export coming soon")},Ee=async()=>{M(!0);try{await O.post("/api/network-topology",{name:(p==null?void 0:p.name)||"Network Topology",description:p==null?void 0:p.description,engagementId:T||null,nodes:s,edges:m}),N.success("Topology saved successfully")}catch(t){console.error("Failed to save topology:",t),N.error("Failed to save topology")}finally{M(!1)}},Ie=(t,o,a)=>{const x=t.map(d=>({...d,type:d.type||"device",data:{...d.data,deviceType:d.data.deviceType||"server",securityZone:d.data.securityZone||"internal",complianceStatus:"not_assessed"}})),u=o.map(d=>({...d,data:{}}));l(d=>{const L=new Map(d.filter(b=>b.data.ipAddress).map(b=>[b.data.ipAddress,b])),h=[];for(const b of x){const U=b.data.ipAddress?L.get(b.data.ipAddress):void 0;U?U.data={...U.data,...b.data,label:U.data.label||b.data.label}:h.push(b)}return[...d,...h]}),c(d=>{const L=new Set(d.map(b=>b.id)),h=u.filter(b=>!L.has(b.id));return[...d,...h]}),_(d=>({...d,lastUpdated:new Date().toISOString(),totalDevices:s.length+a.hostsImported,totalConnections:m.length+u.length,dataSource:`Imported from ${a.sourceFormat}`}))},H=n.useMemo(()=>{const t=s.filter(h=>h.type==="networkDevice"),o=t.length,a=t.filter(h=>h.data.complianceStatus==="compliant").length,x=t.filter(h=>h.data.complianceStatus==="non_compliant").length,u=t.filter(h=>h.data.complianceStatus==="partial").length,d=t.filter(h=>h.data.complianceStatus==="not_assessed").length,L=t.reduce((h,b)=>h+(b.data.vulnerabilities||0),0);return{total:o,compliant:a,nonCompliant:x,partial:u,notAssessed:d,totalVulns:L}},[s]);return W?e.jsx(xe,{children:e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-80px)]",children:e.jsx(bs,{})})}):e.jsxs(xe,{children:[e.jsxs("div",{className:"h-[calc(100vh-80px)] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(ge,{className:"w-8 h-8 text-cyan-400"}),"cATO Network Topology Map"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[(p==null?void 0:p.name)||"Network Architecture & Data Flow Visualization",(p==null?void 0:p.dataSource)&&p.dataSource!=="sample"&&e.jsxs("span",{className:"text-xs text-green-400 ml-2",children:["(from ",p.dataSource,")"]}),(p==null?void 0:p.dataSource)==="sample"&&e.jsx("span",{className:"text-xs text-yellow-400 ml-2",children:"(sample data)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:v?"primary":"secondary",onClick:()=>S(!v),className:v?"bg-gradient-to-r from-cyan-600 to-purple-600":"",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"AI Advisor",v&&e.jsx(Ye,{className:"w-3 h-3 ml-1"})]}),e.jsxs(A,{variant:"secondary",onClick:Ee,disabled:f,children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),f?"Saving...":"Save"]}),e.jsxs(A,{variant:"secondary",onClick:()=>j(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Add Device"]}),e.jsxs(A,{variant:"secondary",onClick:()=>I(!0),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Import"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(A,{variant:"secondary",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-20",children:[e.jsxs("button",{onClick:Te,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2 rounded-t-lg",children:[e.jsx(qe,{className:"w-4 h-4"}),"Export as JSON"]}),e.jsxs("button",{onClick:De,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2 rounded-b-lg",children:[e.jsx(es,{className:"w-4 h-4"}),"Export as PNG"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Engagement:"}),e.jsxs("select",{value:T,onChange:t=>B(t.target.value),className:"px-3 py-1.5 bg-gray-800 border border-gray-600 rounded-lg text-white text-sm min-w-[180px]",disabled:D==="sample",children:[e.jsx("option",{value:"",children:"All Assets"}),Q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Data:"}),e.jsxs("div",{className:"flex bg-gray-800 rounded-lg border border-gray-600 overflow-hidden",children:[e.jsx("button",{onClick:()=>i("api"),className:`px-3 py-1.5 text-sm ${D==="api"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Real Data"}),e.jsx("button",{onClick:()=>i("sample"),className:`px-3 py-1.5 text-sm ${D==="sample"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Sample"})]})]}),D==="sample"&&e.jsx("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded",children:"Using sample demo data"})]}),e.jsxs("div",{className:"flex gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-400",children:"Devices:"}),e.jsx("span",{className:"text-white font-semibold",children:H.total})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 rounded-lg",children:[e.jsx(te,{className:"w-4 h-4 text-green-400"}),e.jsxs("span",{className:"text-green-400",children:[H.compliant," Compliant"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-500/10 rounded-lg",children:[e.jsx($,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400",children:[H.partial," Partial"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 rounded-lg",children:[e.jsx(ae,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[H.nonCompliant," Non-Compliant"]})]}),H.totalVulns>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/20 rounded-lg",children:[e.jsx(ye,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[H.totalVulns," Vulnerabilities"]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>{localStorage.removeItem(oe),localStorage.removeItem(ne),ie(void 0);const{nodes:t,edges:o}=ee();l(t),c(o),N.success("Layout reset to default")},className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700",title:"Reset node positions and zoom to default",children:[e.jsx(ss,{className:"w-4 h-4"}),"Reset Layout"]}),e.jsxs("button",{onClick:()=>R(!Z),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg ${Z?"bg-cyan-500/20 text-cyan-400":"bg-gray-800 text-gray-400"}`,children:[Z?e.jsx(ts,{className:"w-4 h-4"}):e.jsx(as,{className:"w-4 h-4"}),"Labels"]})]}),e.jsxs("div",{className:"flex gap-4 mb-4 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Security Zones:"}),Object.entries(X).map(([t,o])=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-3 h-3 rounded border ${o.border} ${o.bg}`}),e.jsx("span",{className:o.text,children:t.toUpperCase()})]},t))]}),e.jsxs("div",{ref:ve,className:"flex-1 bg-gray-900 rounded-lg border border-gray-700 relative",children:[e.jsxs(ze,{nodes:s,edges:m,onNodesChange:fe,onEdgesChange:y,onConnect:ke,onNodeClick:Se,onPaneClick:Ae,onMoveEnd:je,nodeTypes:ks,fitView:!le,defaultViewport:le,snapToGrid:!0,snapGrid:[20,20],defaultEdgeOptions:{type:"smoothstep",markerEnd:{type:r.ArrowClosed}},children:[e.jsx(We,{variant:_e.Dots,gap:20,size:1,color:"#374151"}),e.jsx(He,{className:"!bg-gray-800 !border-gray-700 !rounded-lg"}),e.jsx(Oe,{className:"!bg-gray-800 !border-gray-700 !rounded-lg",nodeColor:t=>{const o=t.data;return o.complianceStatus==="compliant"?"#22c55e":o.complianceStatus==="non_compliant"?"#ef4444":o.complianceStatus==="partial"?"#eab308":"#6b7280"},maskColor:"rgba(0, 0, 0, 0.6)"}),e.jsx($e,{position:"top-left",className:"!m-2",children:e.jsxs("div",{className:"bg-gray-800/90 rounded-lg p-3 border border-gray-700 text-xs",children:[e.jsx("div",{className:"font-semibold text-gray-300 mb-2",children:"Data Flow"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-red-500"}),e.jsx("span",{className:"text-gray-400",children:"External"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-yellow-500"}),e.jsx("span",{className:"text-gray-400",children:"DMZ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),e.jsx("span",{className:"text-gray-400",children:"Internal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-purple-500"}),e.jsx("span",{className:"text-gray-400",children:"Restricted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-green-500"}),e.jsx("span",{className:"text-gray-400",children:"Management"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-gray-600",children:[e.jsx("div",{className:"w-8 h-0.5 border-b border-dashed border-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Wireless"})]})]})]})})]}),e.jsx(As,{device:E,onClose:()=>C(null),onUpdate:()=>{},onDelete:Pe})]})]}),e.jsx(Ss,{isOpen:k,onClose:()=>j(!1),onAdd:Ce}),e.jsx(vs,{isOpen:F,onClose:()=>I(!1),onImportComplete:Ie,engagementId:T||void 0}),v&&e.jsx("div",{className:"fixed right-0 top-0 h-screen w-[420px] bg-gray-900 border-l border-gray-700 shadow-2xl z-50 overflow-hidden flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Ve,{topology:Ne,engagementId:T||void 0,onClose:()=>S(!1)})})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>S(!1)})]})},Vs=()=>e.jsx(Ze,{children:e.jsx(Es,{})});export{Vs as default};
