import{b as z,u as v,j as e,d as $}from"./vendor-state-BjT_zREg.js";import{r as g}from"./vendor-react-5KxtEOLM.js";import{f as k,s as q,g as b,V as S,aa as L,z as T,aO as F,B as u,i as C,p as A}from"./vendor-ui-CfSMq23b.js";import{N as o}from"./index-CJ_zz9jP.js";import{L as D}from"./Layout-C_2au5Vm.js";import{A as I}from"./AcasNavigation-Dr6x0v0J.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const p={getConfig:()=>o.get("/api/emass/config").then(s=>s.data),updateConfig:s=>o.put("/api/emass/config",s).then(t=>t.data),testConnection:()=>o.post("/api/emass/test").then(s=>s.data),listSystems:()=>o.get("/api/emass/systems").then(s=>s.data),getSystem:s=>o.get(`/api/emass/systems/${s}`).then(t=>t.data),listControls:s=>o.get(`/api/emass/systems/${s}/controls`).then(t=>t.data),syncControls:s=>o.post(`/api/emass/systems/${s}/controls/sync`).then(t=>t.data),listPoams:s=>o.get(`/api/emass/systems/${s}/poams`).then(t=>t.data),createPoam:(s,t)=>o.post(`/api/emass/systems/${s}/poams`,t).then(n=>n.data),updatePoam:(s,t,n)=>o.put(`/api/emass/systems/${s}/poams/${t}`,n).then(l=>l.data),uploadArtifact:(s,t)=>o.post(`/api/emass/systems/${s}/artifacts`,t).then(n=>n.data),fullSync:s=>o.post(`/api/emass/systems/${s}/sync`).then(t=>t.data),getSyncStatus:()=>o.get("/api/emass/sync-status").then(s=>s.data)},f=({status:s,type:t})=>{const n={authorized:{bg:"bg-green-900/50 text-green-400",icon:e.jsx(b,{className:"w-3 h-3"})},"authorized to operate":{bg:"bg-green-900/50 text-green-400",icon:e.jsx(b,{className:"w-3 h-3"})},conditional:{bg:"bg-amber-900/50 text-amber-400",icon:e.jsx(S,{className:"w-3 h-3"})},"not authorized":{bg:"bg-red-900/50 text-red-400",icon:e.jsx(C,{className:"w-3 h-3"})},pending:{bg:"bg-gray-700 text-gray-300",icon:e.jsx(A,{className:"w-3 h-3"})},compliant:{bg:"bg-green-900/50 text-green-400",icon:e.jsx(b,{className:"w-3 h-3"})},"non-compliant":{bg:"bg-red-900/50 text-red-400",icon:e.jsx(C,{className:"w-3 h-3"})},"not applicable":{bg:"bg-gray-600 text-gray-400",icon:null},open:{bg:"bg-amber-900/50 text-amber-400",icon:e.jsx(S,{className:"w-3 h-3"})},closed:{bg:"bg-green-900/50 text-green-400",icon:e.jsx(b,{className:"w-3 h-3"})},delayed:{bg:"bg-red-900/50 text-red-400",icon:e.jsx(A,{className:"w-3 h-3"})}},l=s.toLowerCase(),d=n[l]||{bg:"bg-gray-700",icon:null};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs ${d.bg}`,children:[d.icon,s]})},O=({isOpen:s,onClose:t,onSuccess:n})=>{const[l,d]=g.useState(""),[x,y]=g.useState(""),[c,r]=g.useState(""),[m,N]=g.useState(""),[a,h]=g.useState(!1),[_,P]=g.useState(!1),K=async()=>{var i,j;h(!0);try{await p.updateConfig({api_key:l,user_uid:x,cert_path:c,key_path:m}),u.success("eMASS configuration saved"),n(),t()}catch(w){u.error(((j=(i=w.response)==null?void 0:i.data)==null?void 0:j.error)||"Failed to save configuration")}finally{h(!1)}},M=async()=>{var i,j;P(!0);try{await p.testConnection(),u.success("Connection successful!")}catch(w){u.error(((j=(i=w.response)==null?void 0:i.data)==null?void 0:j.error)||"Connection failed")}finally{P(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100 mb-4",children:"eMASS Configuration"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"API Key"}),e.jsx("input",{type:"password",value:l,onChange:i=>d(i.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"User UID"}),e.jsx("input",{type:"text",value:x,onChange:i=>y(i.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"PKI Certificate Path"}),e.jsx("input",{type:"text",value:c,onChange:i=>r(i.target.value),placeholder:"/path/to/cert.pem",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"PKI Key Path"}),e.jsx("input",{type:"text",value:m,onChange:i=>N(i.target.value),placeholder:"/path/to/key.pem",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("button",{onClick:M,disabled:_,className:"px-4 py-2 bg-gray-600 text-gray-200 rounded hover:bg-gray-500 disabled:opacity-50",children:_?"Testing...":"Test Connection"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:K,disabled:a,className:"px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 disabled:opacity-50",children:a?"Saving...":"Save"})]})]})]})]})}):null},E=({system:s,onClose:t})=>{const n=z(),[l,d]=g.useState("controls"),{data:x=[]}=v({queryKey:["emass-controls",s==null?void 0:s.system_id],queryFn:()=>s?p.listControls(s.system_id):Promise.resolve([]),enabled:!!s}),{data:y=[]}=v({queryKey:["emass-poams",s==null?void 0:s.system_id],queryFn:()=>s?p.listPoams(s.system_id):Promise.resolve([]),enabled:!!s&&l==="poams"}),c=$({mutationFn:()=>s?p.fullSync(s.system_id):Promise.reject(),onSuccess:()=>{n.invalidateQueries({queryKey:["emass-controls"]}),n.invalidateQueries({queryKey:["emass-poams"]}),u.success("Sync complete")},onError:()=>u.error("Sync failed")});return s?e.jsxs("div",{className:"fixed inset-y-0 right-0 w-[500px] bg-gray-800 border-l border-gray-700 shadow-xl z-40 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:s.system_name}),s.acronym&&e.jsx("p",{className:"text-sm text-gray-400",children:s.acronym})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-200",children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(f,{status:s.authorization_status,type:"auth"}),s.mission_criticality&&e.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded text-xs text-gray-300",children:s.mission_criticality})]})]}),e.jsx("div",{className:"p-4",children:e.jsxs("button",{onClick:()=>c.mutate(),disabled:c.isPending,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 disabled:opacity-50",children:[e.jsx(L,{className:`w-4 h-4 ${c.isPending?"animate-spin":""}`}),c.isPending?"Syncing...":"Sync with eMASS"]})}),e.jsxs("div",{className:"flex border-b border-gray-700 px-4",children:[e.jsxs("button",{onClick:()=>d("controls"),className:`px-4 py-2 text-sm ${l==="controls"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-gray-200"}`,children:["Controls (",x.length,")"]}),e.jsxs("button",{onClick:()=>d("poams"),className:`px-4 py-2 text-sm ${l==="poams"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-gray-200"}`,children:["POA&Ms (",y.length,")"]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[l==="controls"&&e.jsx(e.Fragment,{children:x.length===0?e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No controls synced"}):x.slice(0,20).map(r=>e.jsxs("div",{className:"p-3 bg-gray-700 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-200 font-medium",children:r.acronym}),e.jsx(f,{status:r.compliance_status,type:"compliance"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:r.name})]},r.control_id))}),l==="poams"&&e.jsx(e.Fragment,{children:y.length===0?e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No POA&Ms found"}):y.map(r=>e.jsxs("div",{className:"p-3 bg-gray-700 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-200 font-medium",children:["POA&M #",r.poam_id]}),e.jsx(f,{status:r.status,type:"poam"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:r.control_id}),e.jsx("p",{className:"text-sm text-gray-300 mt-2 line-clamp-2",children:r.weakness_description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["POC: ",r.poc_name]}),r.scheduled_completion_date&&e.jsxs("span",{children:["Due: ",new Date(r.scheduled_completion_date).toLocaleDateString()]})]})]},r.poam_id))})]})]}):null},J=()=>{const s=z(),[t,n]=g.useState(!1),[l,d]=g.useState(null),[x,y]=g.useState(""),{data:c=[],isLoading:r}=v({queryKey:["emass-systems"],queryFn:p.listSystems}),{data:m}=v({queryKey:["emass-sync-status"],queryFn:p.getSyncStatus,refetchInterval:6e4}),N=c.filter(a=>{var h;return a.system_name.toLowerCase().includes(x.toLowerCase())||((h=a.acronym)==null?void 0:h.toLowerCase().includes(x.toLowerCase()))});return e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8 text-cyan-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"eMASS Integration"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Enterprise Mission Assurance Support Service integration for RMF compliance"})]})]}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",children:[e.jsx(q,{className:"w-4 h-4"}),"Configure"]})]}),m&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-full ${m.status==="success"?"bg-green-900/50":"bg-amber-900/50"}`,children:m.status==="success"?e.jsx(b,{className:"w-5 h-5 text-green-400"}):e.jsx(S,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-200",children:["Last Sync: ",new Date(m.last_sync).toLocaleString()]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[m.systems_synced," systems, ",m.controls_synced," controls, ",m.poams_synced," POA&Ms"]})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500",children:[e.jsx(L,{className:"w-4 h-4"}),"Full Sync"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-100",children:c.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Systems"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:c.filter(a=>a.authorization_status.toLowerCase().includes("authorized")).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Authorized"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:c.filter(a=>a.authorization_status.toLowerCase().includes("conditional")).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Conditional"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:c.filter(a=>a.authorization_status.toLowerCase().includes("not")).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Not Authorized"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:x,onChange:a=>y(a.target.value),placeholder:"Search systems...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),r?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading systems..."}):N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-gray-600"}),e.jsx("p",{className:"text-gray-400",children:"No systems found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure eMASS connection and sync systems"})]}):e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"System"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Acronym"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Authorization"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Criticality"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:N.map(a=>e.jsxs("tr",{className:"hover:bg-gray-700/50 cursor-pointer",onClick:()=>d(a),children:[e.jsx("td",{className:"px-4 py-3 text-gray-200",children:a.system_name}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:a.acronym||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:a.system_type}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(f,{status:a.authorization_status,type:"auth"})}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:a.mission_criticality||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx("button",{onClick:h=>{h.stopPropagation(),d(a)},className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"View Details",children:e.jsx(F,{className:"w-4 h-4"})})})})]},a.system_id))})]})}),e.jsx(O,{isOpen:t,onClose:()=>n(!1),onSuccess:()=>s.invalidateQueries({queryKey:["emass-systems"]})}),e.jsx(E,{system:l,onClose:()=>d(null)})]})})};export{J as default};
