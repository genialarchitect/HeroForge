import{j as e}from"./vendor-state-oFDmcCcB.js";import{r as a}from"./vendor-react-5KxtEOLM.js";import{u as ms,L as us}from"./Layout-U2SG3QMf.js";import{B as u,L as ae,a$ as gs,k as Le,d as Ie,X as hs,aN as bs,ac as ps,f as fs,l as Be,h as ve,cd as Ee,a0 as ze,bg as ys,J as We,t as Ne,aa as js,V as ke,p as qe,q as vs,av as we,ce as ws,g as Ns,C as ks,cf as Ss,cg as _s}from"./vendor-ui-BlFJDRaq.js";import{n as Cs,m as R,A as re,B as As,H as Fs,X as Ps,Y as q,z as $s,b as Rs}from"./index-DU1ke8Sf.js";import{L as Te}from"./LoadingSpinner-Cy32pNXE.js";import{W as Ds,a as Es}from"./WorkflowHistory-iy90NLFH.js";import"./vendor-markdown-BwTKtS0m.js";import"./vendor-utils-DfRopTPV.js";const Ts=({scanId:r,onVulnerabilityClick:x})=>{const[t,h]=a.useState([]),[w,l]=a.useState(!0),[j,_]=a.useState(null),[y,f]=a.useState(!1),[b,v]=a.useState(new Set),[D,E]=a.useState([]),[T,c]=a.useState(!1),[C,n]=a.useState(!1),[i,N]=a.useState(""),[k,A]=a.useState(""),K=[{id:"open",title:"Open",color:"bg-red-900/20 border-red-700"},{id:"in_progress",title:"In Progress",color:"bg-yellow-900/20 border-yellow-700"},{id:"pending_verification",title:"Pending Verification",color:"bg-blue-900/20 border-blue-700"},{id:"resolved",title:"Resolved",color:"bg-green-900/20 border-green-700"}];a.useEffect(()=>{B(),Z()},[r]);const Z=async()=>{try{const d=await Cs.getUsers();E(d.data)}catch(d){console.debug("Could not load users list:",d)}},B=async()=>{try{if(l(!0),!r){h([]);return}const d=await R.list({scan_id:r});h(d.data)}catch(d){console.error("Failed to load vulnerabilities:",d)}finally{l(!1)}},S=(d,m)=>{_(m),d.dataTransfer.effectAllowed="move"},O=d=>{d.preventDefault(),d.dataTransfer.dropEffect="move"},X=async(d,m)=>{if(d.preventDefault(),!(!j||j.status===m||y))try{f(!0),await R.update(j.id,{status:m}),await B(),_(null)}catch(I){console.error("Failed to update vulnerability status:",I)}finally{f(!1)}},p=()=>{_(null)},F=(d,m)=>{m.stopPropagation();const I=new Set(b);I.has(d)?I.delete(d):I.add(d),v(I)},P=async d=>{if(b.size!==0)try{f(!0),await R.bulkUpdate({vulnerability_ids:Array.from(b),status:d}),u.success(`Updated ${b.size} vulnerabilities to ${d.replace(/_/g," ")}`),v(new Set),await B()}catch(m){console.error("Failed to bulk update status:",m),u.error("Failed to update vulnerabilities")}finally{f(!1)}},$=async()=>{if(b.size!==0)try{f(!0),await R.bulkUpdate({vulnerability_ids:Array.from(b),assignee_id:i||void 0}),u.success(`Assigned ${b.size} vulnerabilities`),v(new Set),c(!1),N(""),await B()}catch(d){console.error("Failed to bulk assign:",d),u.error("Failed to assign vulnerabilities")}finally{f(!1)}},L=async()=>{if(!(b.size===0||!k))try{f(!0),await R.bulkUpdate({vulnerability_ids:Array.from(b),due_date:`${k}T00:00:00Z`}),u.success(`Updated due date for ${b.size} vulnerabilities`),v(new Set),n(!1),A(""),await B()}catch(d){console.error("Failed to bulk update due date:",d),u.error("Failed to update due dates")}finally{f(!1)}},M=()=>{v(new Set)},W=d=>t.filter(m=>m.status===d),Q=d=>{switch(d.toLowerCase()){case"critical":return"border-l-4 border-red-500";case"high":return"border-l-4 border-orange-500";case"medium":return"border-l-4 border-yellow-500";case"low":return"border-l-4 border-blue-500";default:return"border-l-4 border-gray-500"}},U=d=>{if(!d)return null;const m={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-blue-600 text-white"};return e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${m[d.toLowerCase()]||"bg-gray-600 text-white"}`,children:d.charAt(0).toUpperCase()})};return w?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Remediation Board"}),e.jsxs("div",{className:"flex gap-2",children:[b.size>0&&e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded",children:[b.size," selected"]}),e.jsx("button",{onClick:B,className:"px-3 py-1 text-sm bg-gray-700 text-gray-300 rounded hover:bg-gray-600",children:"Refresh"})]})]}),b.size>0&&e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-gray-400 text-sm mr-2",children:"Bulk Actions:"}),e.jsx("button",{onClick:()=>P("in_progress"),disabled:y,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600",children:"Mark In Progress"}),e.jsx("button",{onClick:()=>P("pending_verification"),disabled:y,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600",children:"Mark Pending Verification"}),e.jsx("button",{onClick:()=>P("resolved"),disabled:y,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-600",children:"Mark Resolved"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:()=>c(!0),disabled:y,className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 disabled:bg-gray-600",children:"Assign"}),e.jsx("button",{onClick:()=>n(!0),disabled:y,className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-600",children:"Set Due Date"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:M,className:"px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-500",children:"Clear Selection"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:K.map(d=>e.jsxs("div",{className:`rounded-lg border-2 ${d.color} p-4 min-h-[400px] transition-colors ${j&&j.status!==d.id?"ring-2 ring-blue-500/50":""}`,onDragOver:O,onDrop:m=>X(m,d.id),children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 text-white flex justify-between items-center",children:[e.jsx("span",{children:d.title}),e.jsx("span",{className:"text-sm font-normal text-gray-400 bg-gray-800 px-2 py-0.5 rounded",children:W(d.id).length})]}),e.jsxs("div",{className:"space-y-2",children:[W(d.id).map(m=>e.jsxs("div",{draggable:!y&&!b.has(m.id),onDragStart:I=>S(I,m),onDragEnd:p,onClick:()=>x==null?void 0:x(m.id),className:`bg-gray-800 p-3 rounded shadow cursor-move hover:shadow-lg hover:bg-gray-750 transition-all ${Q(m.severity)} ${(j==null?void 0:j.id)===m.id?"opacity-50":""} ${y?"cursor-not-allowed":""} ${b.has(m.id)?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:b.has(m.id),onClick:I=>F(m.id,I),onChange:()=>{},className:"rounded border-gray-600 text-blue-600 focus:ring-blue-500 bg-gray-700"}),e.jsx("div",{className:"font-medium text-sm text-white truncate",children:m.vulnerability_id})]}),U(m.priority)]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 ml-6",children:m.host_ip}),m.port&&e.jsxs("div",{className:"text-xs text-gray-500 ml-6",children:["Port: ",m.port]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 ml-6",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${m.severity==="critical"?"bg-red-900/50 text-red-300":m.severity==="high"?"bg-orange-900/50 text-orange-300":m.severity==="medium"?"bg-yellow-900/50 text-yellow-300":"bg-blue-900/50 text-blue-300"}`,children:m.severity}),m.assignee_id&&e.jsx("span",{className:"text-xs text-gray-500",children:"Assigned"})]}),m.due_date&&e.jsxs("div",{className:`text-xs mt-1 ml-6 ${new Date(m.due_date)<new Date?"text-red-400":"text-gray-500"}`,children:["Due: ",new Date(m.due_date).toLocaleDateString()]}),m.estimated_effort&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 ml-6",children:["Est: ",m.estimated_effort,"h",m.actual_effort?` / Actual: ${m.actual_effort}h`:""]})]},m.id)),W(d.id).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No vulnerabilities"})]})]},d.id))}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-400 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Critical"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"High"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{children:"Low"})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Assign ",b.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Select Assignee"}),e.jsxs("select",{value:i,onChange:d=>N(d.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),D.map(d=>e.jsxs("option",{value:d.id,children:[d.username," (",d.email,")"]},d.id))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{c(!1),N("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:y,children:"Cancel"}),e.jsx("button",{onClick:$,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:y?"Assigning...":"Assign"})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Set Due Date for ",b.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:k,onChange:d=>A(d.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{n(!1),A("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:y,children:"Cancel"}),e.jsx("button",{onClick:L,disabled:y||!k,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:y?"Updating...":"Set Due Date"})]})]})})]}):e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Select a scan to view the remediation board"})},Ls=({vulnerabilityId:r,currentUserId:x,onCommentsChange:t,initialComments:h})=>{const[w,l]=a.useState(h||[]),[j,_]=a.useState(!h),[y,f]=a.useState(""),[b,v]=a.useState(!1),[D,E]=a.useState(null),[T,c]=a.useState(null),[C,n]=a.useState(""),[i,N]=a.useState(!1),k=a.useCallback(async()=>{try{_(!0);const p=await R.getComments(r);l(p.data)}catch(p){console.error("Failed to load comments:",p),u.error("Failed to load comments")}finally{_(!1)}},[r]);a.useEffect(()=>{h||k()},[k,h]),a.useEffect(()=>{h&&l(h)},[h]);const A=async p=>{if(p.preventDefault(),!!y.trim())try{v(!0),await R.addComment(r,y.trim()),f(""),u.success("Comment added"),await k(),t==null||t()}catch(F){console.error("Failed to add comment:",F),u.error("Failed to add comment")}finally{v(!1)}},K=async p=>{var F,P;try{E(p),await R.deleteComment(r,p),u.success("Comment deleted"),await k(),t==null||t()}catch($){console.error("Failed to delete comment:",$);const L=$;u.error(((P=(F=L.response)==null?void 0:F.data)==null?void 0:P.error)||"Failed to delete comment")}finally{E(null)}},Z=p=>{c(p.id),n(p.comment)},B=()=>{c(null),n("")},S=async p=>{var F,P;if(!C.trim()){u.error("Comment cannot be empty");return}try{N(!0),await R.updateComment(r,p,C.trim()),u.success("Comment updated"),c(null),n(""),await k(),t==null||t()}catch($){console.error("Failed to update comment:",$);const L=$;u.error(((P=(F=L.response)==null?void 0:F.data)==null?void 0:P.error)||"Failed to update comment")}finally{N(!1)}},O=p=>new Date(p).toLocaleString(),X=p=>{const F=new Date(p),$=new Date().getTime()-F.getTime(),L=Math.floor($/6e4),M=Math.floor(L/60),W=Math.floor(M/24);return L<1?"just now":L<60?`${L}m ago`:M<24?`${M}h ago`:W<7?`${W}d ago`:F.toLocaleDateString()};return j?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ae,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Loading comments..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("form",{onSubmit:A,className:"space-y-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:y,onChange:p=>f(p.target.value),rows:3,className:"block w-full rounded-lg bg-gray-800 border border-gray-600 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500 placeholder-gray-500 resize-none pr-12",placeholder:"Add a comment...",disabled:b}),e.jsx("button",{type:"submit",disabled:b||!y.trim(),className:"absolute bottom-3 right-3 p-2 rounded-lg bg-cyan-600 text-white hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",title:"Send comment",children:b?e.jsx(ae,{className:"h-4 w-4 animate-spin"}):e.jsx(gs,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-3",children:w.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No comments yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Be the first to add a comment"})]}):w.map(p=>{const F=x===p.user_id,P=D===p.id,$=T===p.id;return e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white text-sm font-semibold",children:p.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:p.username}),e.jsxs("div",{className:"text-xs text-gray-500",title:O(p.created_at),children:[X(p.created_at),p.updated_at&&e.jsx("span",{className:"ml-1 text-gray-600",title:`Edited: ${O(p.updated_at)}`,children:"(edited)"})]})]})]}),$?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:C,onChange:L=>n(L.target.value),rows:3,className:"block w-full rounded-lg bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500 placeholder-gray-500 resize-none",disabled:i,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>S(p.id),disabled:i||!C.trim(),className:"inline-flex items-center gap-1 px-3 py-1 rounded-lg bg-cyan-600 text-white text-sm hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:[i?e.jsx(ae,{className:"h-3 w-3 animate-spin"}):e.jsx(Ie,{className:"h-3 w-3"}),"Save"]}),e.jsxs("button",{onClick:B,disabled:i,className:"inline-flex items-center gap-1 px-3 py-1 rounded-lg bg-gray-600 text-gray-300 text-sm hover:bg-gray-500 disabled:opacity-50 transition-colors",children:[e.jsx(hs,{className:"h-3 w-3"}),"Cancel"]})]})]}):e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap break-words",children:p.comment})]}),F&&!$&&e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Z(p),disabled:P,className:"p-2 rounded-lg text-gray-500 hover:text-cyan-400 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Edit comment",children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>K(p.id),disabled:P,className:"p-2 rounded-lg text-gray-500 hover:text-red-400 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Delete comment",children:P?e.jsx(ae,{className:"h-4 w-4 animate-spin"}):e.jsx(ps,{className:"h-4 w-4"})})]})]})},p.id)})}),w.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center pt-2",children:[w.length," ",w.length===1?"comment":"comments"]})]})},Is=({vulnerabilityId:r,onTicketCreated:x})=>{const[t,h]=a.useState(!1),[w,l]=a.useState(!1),[j,_]=a.useState([]),[y,f]=a.useState(!1),[b,v]=a.useState(null),D=a.useRef(null);a.useEffect(()=>{E(),T()},[r]),a.useEffect(()=>{const i=N=>{D.current&&!D.current.contains(N.target)&&h(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const E=async()=>{var i;try{await re.getSettings(),v(!0)}catch(N){((i=N.response)==null?void 0:i.status)===404&&v(!1)}},T=async()=>{f(!0);try{const i=await re.getTicketsForVulnerability(r);_(i.data)}catch(i){console.error("Failed to load ServiceNow tickets:",i)}finally{f(!1)}},c=async()=>{var i,N;if(!b){u.error("ServiceNow is not configured. Please configure it in Settings."),h(!1);return}l(!0);try{const k=await re.createIncident(r);u.success(`Incident ${k.data.ticket_number} created successfully`),h(!1),await T(),x==null||x()}catch(k){const A=k;console.error("Failed to create ServiceNow incident:",k),u.error(((N=(i=A.response)==null?void 0:i.data)==null?void 0:N.error)||"Failed to create incident")}finally{l(!1)}},C=async()=>{var i,N;if(!b){u.error("ServiceNow is not configured. Please configure it in Settings."),h(!1);return}l(!0);try{const k=await re.createChange(r);u.success(`Change Request ${k.data.ticket_number} created successfully`),h(!1),await T(),x==null||x()}catch(k){const A=k;console.error("Failed to create ServiceNow change request:",k),u.error(((N=(i=A.response)==null?void 0:i.data)==null?void 0:N.error)||"Failed to create change request")}finally{l(!1)}},n=i=>i==="incident"?e.jsx(ve,{className:"h-4 w-4 text-red-400"}):e.jsx(Ee,{className:"h-4 w-4 text-blue-400"});return b===null?null:e.jsxs("div",{className:"relative",ref:D,children:[e.jsxs(As,{variant:"secondary",onClick:()=>h(!t),disabled:w,className:"flex items-center gap-2",children:[w?e.jsx(Te,{className:"h-4 w-4"}):e.jsx(fs,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{children:"ServiceNow"}),e.jsx(Be,{className:`h-4 w-4 transition-transform ${t?"rotate-180":""}`})]}),t&&e.jsx("div",{className:"absolute right-0 mt-2 w-72 bg-gray-800 border border-gray-700 rounded-lg shadow-xl z-50",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 px-2 py-1",children:"Create Ticket"}),e.jsxs("button",{onClick:c,disabled:w,className:"w-full flex items-center gap-3 px-3 py-2 text-left text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(ve,{className:"h-5 w-5 text-red-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create Incident"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Report an issue for investigation"})]})]}),e.jsxs("button",{onClick:C,disabled:w,className:"w-full flex items-center gap-3 px-3 py-2 text-left text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(Ee,{className:"h-5 w-5 text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create Change Request"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Request remediation changes"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("p",{className:"text-xs text-gray-500 px-2 py-1",children:["Linked Tickets ",y&&e.jsx(Te,{className:"h-3 w-3 inline ml-1"})]}),j.length===0?e.jsx("p",{className:"px-3 py-2 text-sm text-gray-500",children:"No tickets linked yet"}):e.jsx("div",{className:"max-h-48 overflow-y-auto",children:j.map(i=>e.jsxs("a",{href:i.ticket_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 px-3 py-2 text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:[n(i.ticket_type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-cyan-400 truncate",children:i.ticket_number}),e.jsxs("div",{className:"text-xs text-gray-500 capitalize",children:[i.ticket_type," ",i.status&&`- ${i.status}`]})]}),e.jsx(ze,{className:"h-4 w-4 text-gray-500 flex-shrink-0"})]},i.id))})]})]}):e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(ve,{className:"h-8 w-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"ServiceNow not configured"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Go to Settings > ServiceNow to configure the integration."})]})})]})},ee="/api",Me={generateRemediation:async r=>{const x=localStorage.getItem("token"),t=await fetch(`${ee}/remediation/generate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(r)});if(!t.ok){const h=await t.json().catch(()=>({}));throw new Error(h.error||"Failed to generate remediation suggestions")}return t.json()},getTopRisks:async(r=5)=>{const x=localStorage.getItem("token"),t=await fetch(`${ee}/ai/top-risks?limit=${r}`,{headers:{Authorization:`Bearer ${x}`}});if(!t.ok){const h=await t.json().catch(()=>({}));throw new Error(h.error||"Failed to fetch top risks")}return t.json()},getVulnerabilityScore:async r=>{const x=localStorage.getItem("token"),t=await fetch(`${ee}/ai/scores/vulnerability/${r}`,{headers:{Authorization:`Bearer ${x}`}});if(!t.ok){const h=await t.json().catch(()=>({}));throw new Error(h.error||"Failed to fetch vulnerability score")}return t.json()},getAttackPathsForVulnerability:async r=>{const x=localStorage.getItem("token"),t=await fetch(`${ee}/attack-paths/vulnerability/${r}`,{headers:{Authorization:`Bearer ${x}`}});if(!t.ok){if(t.status===404)return{path_count:0,affected_assets:[]};const h=await t.json().catch(()=>({}));throw new Error(h.error||"Failed to fetch attack paths")}return t.json()},prioritizeScan:async(r,x=!1)=>{const t=localStorage.getItem("token"),h=await fetch(`${ee}/ai/prioritize/${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({force_recalculate:x})});if(!h.ok){const w=await h.json().catch(()=>({}));throw new Error(w.error||"Failed to prioritize scan")}}},Bs={bash:"text-green-400",sh:"text-green-400",shell:"text-green-400",powershell:"text-blue-400",ps1:"text-blue-400",python:"text-yellow-400",py:"text-yellow-400",javascript:"text-yellow-300",js:"text-yellow-300",typescript:"text-blue-300",ts:"text-blue-300",terraform:"text-purple-400",tf:"text-purple-400",hcl:"text-purple-400",yaml:"text-red-400",yml:"text-red-400",json:"text-orange-400",sql:"text-cyan-400",rust:"text-orange-500",go:"text-cyan-300",dockerfile:"text-blue-500",nginx:"text-green-500",apache:"text-red-500"},zs={bash:"Bash",sh:"Shell",shell:"Shell",powershell:"PowerShell",ps1:"PowerShell",python:"Python",py:"Python",javascript:"JavaScript",js:"JavaScript",typescript:"TypeScript",ts:"TypeScript",terraform:"Terraform",tf:"Terraform",hcl:"HCL",yaml:"YAML",yml:"YAML",json:"JSON",sql:"SQL",rust:"Rust",go:"Go",dockerfile:"Dockerfile",nginx:"Nginx",apache:"Apache"},Ve=({code:r,language:x="bash",title:t,description:h,filename:w,showLineNumbers:l=!0,className:j=""})=>{const[_,y]=a.useState(!1),f=async()=>{try{await navigator.clipboard.writeText(r),y(!0),setTimeout(()=>y(!1),2e3)}catch(E){console.error("Failed to copy:",E)}},b=r.split(`
`),v=Bs[x.toLowerCase()]||"text-gray-400",D=zs[x.toLowerCase()]||x.toUpperCase();return e.jsxs("div",{className:`rounded-lg overflow-hidden bg-gray-900 border border-gray-700 ${j}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:`h-4 w-4 ${v}`}),e.jsxs("div",{className:"flex flex-col",children:[t&&e.jsx("span",{className:"text-sm font-medium text-white",children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx("span",{className:v,children:D}),w&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"font-mono",children:w})]})]})]})]}),e.jsx("button",{onClick:f,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-all ${_?"bg-green-600/20 text-green-400":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:_?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-3.5 w-3.5"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-3.5 w-3.5"}),"Copy"]})})]}),h&&e.jsx("div",{className:"px-4 py-2 bg-gray-800/50 border-b border-gray-700",children:e.jsx("p",{className:"text-sm text-gray-400",children:h})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("pre",{className:"p-4 text-sm",children:e.jsx("code",{className:"font-mono",children:b.map((E,T)=>e.jsxs("div",{className:"flex",children:[l&&e.jsx("span",{className:"select-none text-gray-600 w-8 text-right pr-4 flex-shrink-0",children:T+1}),e.jsx("span",{className:"text-gray-100 whitespace-pre",children:E||" "})]},T))})})})]})},Ws=[{value:"linux",label:"Linux",icon:"ðŸ§"},{value:"windows",label:"Windows",icon:"ðŸªŸ"},{value:"aws",label:"AWS",icon:"â˜ï¸"},{value:"azure",label:"Azure",icon:"ðŸ“˜"},{value:"gcp",label:"GCP",icon:"ðŸŒ"},{value:"kubernetes",label:"Kubernetes",icon:"âŽˆ"},{value:"docker",label:"Docker",icon:"ðŸ³"},{value:"generic",label:"Generic",icon:"ðŸ“‹"}],qs=({vulnerabilityId:r,hostOs:x,onApplyToJira:t})=>{const[h,w]=a.useState(Vs(x)),[l,j]=a.useState(null),[_,y]=a.useState(!1),[f,b]=a.useState(null),[v,D]=a.useState(new Set([0])),E=async()=>{y(!0),b(null);try{const n=await Me.generateRemediation({vulnerability_id:r,platform:h,include_rollback:!0,verbose:!0});j(n),D(new Set([0]))}catch(n){const i=n instanceof Error?n.message:"Failed to generate remediation";b(i),u.error(i)}finally{y(!1)}},T=n=>{D(i=>{const N=new Set(i);return N.has(n)?N.delete(n):N.add(n),N})},c=()=>{if(!l)return"";let n=`h2. AI-Generated Remediation Steps

`;return n+=`*Platform:* ${l.platform}
`,n+=`*Estimated Effort:* ${l.estimated_effort}

`,l.prerequisites.length>0&&(n+=`h3. Prerequisites
`,l.prerequisites.forEach(i=>{n+=`* ${i}
`}),n+=`
`),n+=`h3. Steps
`,l.steps.forEach(i=>{n+=`# *${i.title}*
`,n+=`${i.description}
`,i.code_snippet&&(n+=`{code:${i.code_language||"bash"}}
`,n+=`${i.code_snippet}
`,n+=`{code}
`),n+=`
`}),l.verification_steps.length>0&&(n+=`h3. Verification
`,l.verification_steps.forEach(i=>{n+=`* ${i}
`})),n},C=()=>{t&&(t(c()),u.success("Remediation steps copied to JIRA format"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-purple-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI-Powered Remediation"})]})}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Select Target Platform"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ws.map(n=>e.jsxs("button",{onClick:()=>w(n.value),className:`flex flex-col items-center gap-1 p-3 rounded-lg border transition-all ${h===n.value?"border-purple-500 bg-purple-500/20 text-purple-300":"border-gray-600 bg-gray-700 text-gray-400 hover:border-gray-500"}`,children:[e.jsx("span",{className:"text-2xl",children:n.icon}),e.jsx("span",{className:"text-xs font-medium",children:n.label})]},n.value))}),e.jsx("button",{onClick:E,disabled:_,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded-lg transition-colors font-medium",children:_?e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"h-5 w-5 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-5 w-5"}),"Generate Remediation Steps"]})})]}),f&&e.jsxs("div",{className:"bg-red-900/30 border border-red-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx(ke,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Error generating remediation"})]}),e.jsx("p",{className:"mt-2 text-sm text-red-300",children:f})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Platform"}),e.jsx("p",{className:"text-white font-medium capitalize",children:l.platform})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Estimated Effort"}),e.jsxs("p",{className:"text-white font-medium flex items-center gap-1",children:[e.jsx(qe,{className:"h-4 w-4 text-gray-400"}),l.estimated_effort]})]})]})}),l.prerequisites.length>0&&e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-700/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-300 mb-2",children:"Prerequisites"}),e.jsx("ul",{className:"space-y-1",children:l.prerequisites.map((n,i)=>e.jsxs("li",{className:"text-sm text-yellow-200 flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"â€¢"}),n]},i))})]}),l.risk_notes.length>0&&e.jsxs("div",{className:"bg-orange-900/20 border border-orange-700/50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-orange-300 mb-2 flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Risk Notes"]}),e.jsx("ul",{className:"space-y-1",children:l.risk_notes.map((n,i)=>e.jsxs("li",{className:"text-sm text-orange-200 flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-400",children:"â€¢"}),n]},i))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Remediation Steps"}),l.steps.map((n,i)=>e.jsx(Ms,{step:n,expanded:v.has(i),onToggle:()=>T(i)},n.step_number))]}),l.code_snippets.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Code Snippets"}),l.code_snippets.map((n,i)=>e.jsx(Ve,{code:n.code,language:n.language,title:n.title,description:n.description,filename:n.filename},i))]}),l.verification_steps.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-700/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-300 mb-2",children:"Verification Steps"}),e.jsx("ol",{className:"space-y-1 list-decimal list-inside",children:l.verification_steps.map((n,i)=>e.jsx("li",{className:"text-sm text-green-200",children:n},i))})]}),l.rollback_steps&&l.rollback_steps.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Rollback Procedure"}),e.jsx("ol",{className:"space-y-1 list-decimal list-inside",children:l.rollback_steps.map((n,i)=>e.jsx("li",{className:"text-sm text-gray-400",children:n},i))})]}),t&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(We,{className:"h-4 w-4"}),"Apply to JIRA Ticket"]})})]})]})},Ms=({step:r,expanded:x,onToggle:t})=>e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:t,className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-500/20 text-purple-400 font-bold text-sm",children:r.step_number}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white",children:r.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[r.estimated_time&&e.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(qe,{className:"h-3 w-3"}),r.estimated_time]}),r.risk_level&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${r.risk_level==="high"?"bg-red-500/20 text-red-400":r.risk_level==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"}`,children:[r.risk_level," risk"]}),r.requires_reboot&&e.jsx("span",{className:"text-xs bg-orange-500/20 text-orange-400 px-2 py-0.5 rounded-full",children:"Requires reboot"}),r.requires_downtime&&e.jsx("span",{className:"text-xs bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full",children:"Requires downtime"})]})]})]}),x?e.jsx(vs,{className:"h-5 w-5 text-gray-400"}):e.jsx(Be,{className:"h-5 w-5 text-gray-400"})]}),x&&e.jsxs("div",{className:"px-4 pb-4 border-t border-gray-700 pt-4",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:r.description}),r.code_snippet&&e.jsx(Ve,{code:r.code_snippet,language:r.code_language||"bash",showLineNumbers:!1})]})]});function Vs(r){if(!r)return"generic";const x=r.toLowerCase();return x.includes("linux")||x.includes("ubuntu")||x.includes("debian")||x.includes("rhel")||x.includes("centos")?"linux":x.includes("windows")?"windows":x.includes("aws")||x.includes("amazon")?"aws":x.includes("azure")?"azure":x.includes("gcp")||x.includes("google")?"gcp":x.includes("kubernetes")||x.includes("k8s")?"kubernetes":x.includes("docker")?"docker":"generic"}const Js=({vulnerabilityId:r,onClose:x,onUpdate:t})=>{const{user:h}=Fs(),{openWithPrompt:w}=ms(),[l,j]=a.useState(null),[_,y]=a.useState(!0),[f,b]=a.useState(!1),[v,D]=a.useState("info"),[E,T]=a.useState([]),[c,C]=a.useState(null),[n,i]=a.useState(!1),[N,k]=a.useState(!1),[A,K]=a.useState(null),[Z,B]=a.useState(!1),[S,O]=a.useState(null),[X,p]=a.useState([]),[F,P]=a.useState(!1),[$,L]=a.useState(""),[M,W]=a.useState(!1),[Q,U]=a.useState(""),[d,m]=a.useState(""),[I,le]=a.useState(""),[ie,ne]=a.useState(""),[se,oe]=a.useState(""),[de,ce]=a.useState(""),[xe,me]=a.useState(""),[ue,ge]=a.useState(""),[z,V]=a.useState(!1),[Se,_e]=a.useState(!1),[he,te]=a.useState(""),[Je,be]=a.useState(!1),[pe,fe]=a.useState("still_vulnerable");a.useEffect(()=>{H(),Ge(),J(),Ye(),Ce(),He()},[r]);const He=async()=>{try{B(!0);const s=await Me.getAttackPathsForVulnerability(r);K(s)}catch(s){console.debug("Could not load attack paths:",s),K(null)}finally{B(!1)}},Oe=s=>{w(s,{vulnerabilityId:r})},Ce=async()=>{try{i(!0);const s=await R.getFPPrediction(r);C(s.data)}catch(s){console.debug("Could not load FP prediction:",s),C(null)}finally{i(!1)}},Ae=async s=>{try{k(!0),await R.submitFPFeedback(r,{is_false_positive:s}),u.success("Thank you for your feedback! This helps improve our predictions."),await Ce()}catch(o){console.error("Failed to submit FP feedback:",o),u.error("Failed to submit feedback")}finally{k(!1)}},Ge=async()=>{try{const s=await Ps.list();T(s.data)}catch(s){console.debug("Could not load users list:",s)}},J=async()=>{try{P(!0);const s=await q.getForVulnerability(r);O(s.data)}catch{O(null)}finally{P(!1)}},Ye=async()=>{try{const s=await q.templates.list();p(s.data.filter(o=>o.is_active)),s.data.length>0&&L(s.data[0].id)}catch(s){console.debug("Could not load workflow templates:",s)}},Ke=async()=>{var s,o;if(!$){u.error("Please select a workflow template");return}try{W(!0),await q.instances.start(r,{template_id:$}),u.success("Workflow started successfully"),await J(),t==null||t()}catch(Y){console.error("Failed to start workflow:",Y);const je=Y;u.error(((o=(s=je.response)==null?void 0:s.data)==null?void 0:o.error)||"Failed to start workflow")}finally{W(!1)}},Xe=async s=>{S&&(await q.stages.approve(S.id,{comment:s}),u.success("Stage approved"),await J(),t==null||t())},Ze=async(s,o)=>{S&&(await q.stages.reject(S.id,{comment:s,restart_from_stage:o}),u.success("Stage rejected"),await J(),t==null||t())},Qe=async s=>{S&&(await q.stages.advance(S.id,s),u.success("Advanced to next stage"),await J(),t==null||t())},Ue=async s=>{S&&(await q.instances.hold(S.id,s),u.success("Workflow put on hold"),await J(),t==null||t())},es=async()=>{S&&(await q.instances.resume(S.id),u.success("Workflow resumed"),await J(),t==null||t())},ss=async s=>{S&&(await q.instances.cancel(S.id,s),u.success("Workflow cancelled"),await J(),t==null||t())},H=async()=>{var s;try{y(!0);const o=await R.get(r);j(o.data),U(o.data.vulnerability.status),m(o.data.vulnerability.priority||"medium"),le(o.data.vulnerability.notes||""),ne(o.data.vulnerability.assignee_id||""),oe(((s=o.data.vulnerability.due_date)==null?void 0:s.split("T")[0])||""),ce(o.data.vulnerability.remediation_steps||""),me(o.data.vulnerability.estimated_effort||""),ge(o.data.vulnerability.actual_effort||"")}catch(o){console.error("Failed to load vulnerability detail:",o)}finally{y(!1)}},Fe=async()=>{var s;if(l)try{V(!0),await R.update(r,{status:Q!==l.vulnerability.status?Q:void 0,priority:d!==(l.vulnerability.priority||"medium")?d:void 0,notes:I!==(l.vulnerability.notes||"")?I:void 0,assignee_id:ie!==(l.vulnerability.assignee_id||"")&&ie||void 0,due_date:se!==(((s=l.vulnerability.due_date)==null?void 0:s.split("T")[0])||"")&&se?`${se}T00:00:00Z`:void 0,remediation_steps:de!==(l.vulnerability.remediation_steps||"")?de:void 0,estimated_effort:typeof xe=="number"?xe:void 0,actual_effort:typeof ue=="number"?ue:void 0}),u.success("Vulnerability updated successfully"),await H(),b(!1),t==null||t()}catch(o){console.error("Failed to update vulnerability:",o),u.error("Failed to update vulnerability")}finally{V(!1)}},ts=async()=>{try{V(!0),await R.markForVerification(r,{}),u.success("Vulnerability marked for verification"),await H(),t==null||t()}catch(s){console.error("Failed to mark for verification:",s),u.error("Failed to mark for verification")}finally{V(!1)}},as=async()=>{await H()},rs=async()=>{var s,o;if(l){_e(!0);try{const Y=await $s.createTicket(r);u.success(`JIRA ticket ${Y.data.jira_ticket_key} created successfully!`),await H(),t==null||t()}catch(Y){console.error("Failed to create JIRA ticket:",Y);const je=Y;u.error(((o=(s=je.response)==null?void 0:s.data)==null?void 0:o.error)||"Failed to create JIRA ticket")}finally{_e(!1)}}},ls=async()=>{try{V(!0),await R.requestRetest(r,{notes:he||void 0}),u.success("Retest requested successfully"),te(""),await H(),t==null||t()}catch(s){console.error("Failed to request retest:",s),u.error("Failed to request retest")}finally{V(!1)}},is=async()=>{try{V(!0),await R.completeRetest(r,{result:pe,notes:he||void 0}),u.success(`Retest completed: ${pe.replace(/_/g," ")}`),be(!1),te(""),fe("still_vulnerable"),await H(),t==null||t()}catch(s){console.error("Failed to complete retest:",s),u.error("Failed to complete retest")}finally{V(!1)}},Pe=()=>{var s;l&&(b(!1),U(l.vulnerability.status),m(l.vulnerability.priority||"medium"),le(l.vulnerability.notes||""),ne(l.vulnerability.assignee_id||""),oe(((s=l.vulnerability.due_date)==null?void 0:s.split("T")[0])||""),ce(l.vulnerability.remediation_steps||""),me(l.vulnerability.estimated_effort||""),ge(l.vulnerability.actual_effort||""))},ns=s=>{const o="px-3 py-1 text-sm font-semibold rounded-full";switch(s.toLowerCase()){case"critical":return`${o} bg-red-900/50 text-red-300`;case"high":return`${o} bg-orange-900/50 text-orange-300`;case"medium":return`${o} bg-yellow-900/50 text-yellow-300`;case"low":return`${o} bg-blue-900/50 text-blue-300`;default:return`${o} bg-gray-700 text-gray-300`}},os=s=>{const o="px-3 py-1 text-sm font-semibold rounded-full";switch(s){case"open":return`${o} bg-red-900/50 text-red-300`;case"in_progress":return`${o} bg-yellow-900/50 text-yellow-300`;case"pending_verification":return`${o} bg-blue-900/50 text-blue-300`;case"resolved":return`${o} bg-green-900/50 text-green-300`;case"false_positive":return`${o} bg-gray-700 text-gray-300`;case"accepted_risk":return`${o} bg-purple-900/50 text-purple-300`;default:return`${o} bg-gray-700 text-gray-300`}},$e=s=>s.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),ds=s=>{const o="px-3 py-1 text-sm font-semibold rounded-full";switch(s){case"remediated":return`${o} bg-green-900/50 text-green-300`;case"partially_remediated":return`${o} bg-yellow-900/50 text-yellow-300`;case"still_vulnerable":return`${o} bg-red-900/50 text-red-300`;default:return`${o} bg-blue-900/50 text-blue-300`}},G=s=>new Date(s).toLocaleString(),cs=s=>s.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),xs=()=>!l||!l.timeline||l.timeline.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No timeline events"}):e.jsx("div",{className:"space-y-4",children:l.timeline.map(s=>e.jsxs("div",{className:"border-l-2 border-blue-600 pl-4 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("div",{className:"font-medium text-white",children:s.username}),e.jsx("div",{className:"text-xs text-gray-400",children:G(s.created_at)})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:cs(s.event_type)}),s.old_value&&s.new_value&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Changed from"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:s.old_value})," ","to"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:s.new_value})]}),s.comment&&e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:s.comment})]},s.id))});if(_)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-lg p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})});if(!l)return null;const{vulnerability:g,comments:ye,resolved_by_user:Re,verified_by_user:De}=l;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-900 border-b border-gray-700 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:g.vulnerability_id}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-white text-2xl leading-none",children:"Ã—"})]}),e.jsx("div",{className:"flex gap-4 mt-4 overflow-x-auto",children:[{id:"info",label:"Information"},{id:"ai_analysis",label:"AI Analysis",icon:we},{id:"remediation",label:"Remediation"},{id:"workflow",label:`Workflow${S?" *":""}`},{id:"timeline",label:"Timeline"},{id:"comments",label:`Comments${ye.length>0?` (${ye.length})`:""}`}].map(s=>e.jsxs("button",{onClick:()=>D(s.id),className:`pb-2 px-1 border-b-2 transition-colors flex items-center gap-1 whitespace-nowrap ${v===s.id?"border-blue-500 text-blue-400 font-semibold":"border-transparent text-gray-400 hover:text-gray-200"}`,children:["icon"in s&&s.icon&&e.jsx(s.icon,{className:"h-4 w-4 text-purple-400"}),s.label]},s.id))})]}),e.jsxs("div",{className:"p-6",children:[v==="info"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Host"}),e.jsx("div",{className:"text-white",children:g.host_ip})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Port"}),e.jsx("div",{className:"text-white",children:g.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Severity"}),e.jsx("div",{children:e.jsx("span",{className:ns(g.severity),children:g.severity.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),f?e.jsxs("select",{value:Q,onChange:s=>U(s.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"}),e.jsx("option",{value:"accepted_risk",children:"Accepted Risk"})]}):e.jsx("span",{className:os(g.status),children:$e(g.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Priority"}),f?e.jsxs("select",{value:d,onChange:s=>m(s.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}):e.jsx("div",{className:"text-white",children:(g.priority||"medium").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assignee"}),f?e.jsxs("select",{value:ie,onChange:s=>ne(s.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.username," (",s.email,")"]},s.id))]}):e.jsx("div",{className:"text-white",children:l!=null&&l.assignee?l.assignee.username:"Unassigned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Due Date"}),f?e.jsx("input",{type:"date",value:se,onChange:s=>oe(s.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"}):e.jsx("div",{className:`text-white ${g.due_date&&new Date(g.due_date)<new Date?"text-red-400":""}`,children:g.due_date?new Date(g.due_date).toLocaleDateString():"Not set"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Created"}),e.jsx("div",{className:"text-gray-300",children:G(g.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Updated"}),e.jsx("div",{className:"text-gray-300",children:G(g.updated_at)})]}),g.resolved_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved At"}),e.jsx("div",{className:"text-gray-300",children:G(g.resolved_at)})]}),Re&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved By"}),e.jsx("div",{className:"text-gray-300",children:Re.username})]})]}),g.verified_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified At"}),e.jsx("div",{className:"text-gray-300",children:G(g.verified_at)})]}),De&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified By"}),e.jsx("div",{className:"text-gray-300",children:De.username})]})]})]}),g.retest_requested_at&&e.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-200 mb-3",children:"Retest Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Requested At"}),e.jsx("div",{className:"text-indigo-200",children:G(g.retest_requested_at)})]}),g.retest_completed_at?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Completed At"}),e.jsx("div",{className:"text-indigo-200",children:G(g.retest_completed_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Result"}),e.jsx("span",{className:ds(g.retest_result),children:$e(g.retest_result||"")})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Status"}),e.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-yellow-900/50 text-yellow-300",children:"Pending Retest"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes"}),f?e.jsx("textarea",{value:I,onChange:s=>le(s.target.value),rows:4,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about this vulnerability..."}):e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap bg-gray-800 p-3 rounded-md",children:g.notes||"No notes"})]}),(g.jira_ticket_id||g.jira_ticket_key)&&e.jsx("div",{className:"bg-blue-900/30 border border-blue-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-300 mb-1",children:"JIRA Ticket"}),e.jsx("div",{className:"text-blue-200 font-semibold",children:g.jira_ticket_key})]}),g.jira_ticket_url&&e.jsxs("a",{href:g.jira_ticket_url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 inline-flex items-center gap-2",children:["View in JIRA",e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:f?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Fe,disabled:z,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:z?"Saving...":"Save Changes"}),e.jsx("button",{onClick:Pe,disabled:z,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit"}),g.status==="in_progress"&&e.jsx("button",{onClick:ts,disabled:z,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-600",children:"Mark for Verification"}),!g.jira_ticket_id&&e.jsx("button",{onClick:rs,disabled:Se,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-600 inline-flex items-center gap-2",children:Se?"Creating...":"Create JIRA Ticket"}),e.jsx(Is,{vulnerabilityId:g.id,onTicketCreated:()=>{H(),t==null||t()}}),!g.retest_requested_at&&g.status!=="resolved"&&e.jsx("button",{onClick:ls,disabled:z,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-600",children:"Request Retest"}),g.retest_requested_at&&!g.retest_completed_at&&e.jsx("button",{onClick:()=>be(!0),disabled:z,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:"Complete Retest"})]})})]}),v==="ai_analysis"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg p-4 border border-purple-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500/20",children:e.jsx(Ne,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-white",children:"Ask AI Copilot"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Get AI-powered insights about this vulnerability"})]})]}),e.jsxs("button",{onClick:()=>Oe(`Explain the vulnerability ${r} and provide remediation guidance`),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Le,{className:"h-4 w-4"}),"Ask AI"]})]}),!Z&&A&&A.path_count>0&&e.jsx("div",{className:"bg-red-900/30 border border-red-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-500/20",children:e.jsx(ws,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-red-200",children:["Part of ",A.path_count," Attack Path",A.path_count>1?"s":""]}),e.jsxs("p",{className:"text-xs text-red-300",children:["This vulnerability is involved in potential attack chains",A.affected_assets.length>0&&` affecting ${A.affected_assets.length} asset${A.affected_assets.length>1?"s":""}`]})]})]}),e.jsxs("a",{href:`/attack-paths?vulnerability=${r}`,className:"flex items-center gap-1 px-3 py-1.5 bg-red-600/20 text-red-300 hover:bg-red-600/30 rounded-lg transition-colors text-sm",children:["View Paths",e.jsx(ze,{className:"h-3.5 w-3.5"})]})]})}),n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`rounded-lg p-6 border ${c.prediction==="LikelyFP"?"bg-purple-900/30 border-purple-700":c.prediction==="PossibleFP"?"bg-yellow-900/30 border-yellow-700":c.prediction==="TruePositive"?"bg-green-900/30 border-green-700":"bg-gray-800 border-gray-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 rounded-full ${c.prediction==="LikelyFP"?"bg-purple-500/30":c.prediction==="PossibleFP"?"bg-yellow-500/30":c.prediction==="TruePositive"?"bg-green-500/30":"bg-gray-500/30"}`,children:c.prediction==="TruePositive"?e.jsx(Ns,{className:"h-6 w-6 text-green-400"}):c.prediction==="LikelyFP"||c.prediction==="PossibleFP"?e.jsx(ke,{className:"h-6 w-6 text-yellow-400"}):e.jsx(ks,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:c.prediction==="TruePositive"?"True Positive":c.prediction==="LikelyFP"?"Likely False Positive":c.prediction==="PossibleFP"?"Possible False Positive":"Uncertain"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[Math.round(c.fp_probability*100),"% FP probability â€¢ ",Math.round(c.confidence*100),"% confidence"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400 mr-2",children:"Is this accurate?"}),e.jsxs("button",{onClick:()=>Ae(!0),disabled:N,className:"flex items-center gap-1 px-3 py-1.5 rounded-md bg-green-600/20 text-green-400 hover:bg-green-600/30 transition-colors disabled:opacity-50",title:"Yes, this is a false positive",children:[e.jsx(Ss,{className:"h-4 w-4"}),"FP"]}),e.jsxs("button",{onClick:()=>Ae(!1),disabled:N,className:"flex items-center gap-1 px-3 py-1.5 rounded-md bg-red-600/20 text-red-400 hover:bg-red-600/30 transition-colors disabled:opacity-50",title:"No, this is a true positive",children:[e.jsx(_s,{className:"h-4 w-4"}),"TP"]})]})]})}),c.factors&&c.factors.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-purple-400"}),"Contributing Factors"]}),e.jsx("div",{className:"space-y-3",children:c.factors.map((s,o)=>e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:s.name}),e.jsxs("span",{className:`text-sm font-semibold ${s.contribution>.3?"text-red-400":s.contribution>.15?"text-yellow-400":"text-green-400"}`,children:[Math.round(s.contribution*100),"%"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description}),e.jsx("div",{className:"mt-1 h-1.5 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.contribution>.3?"bg-red-500":s.contribution>.15?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.round(s.contribution*100)}%`}})})]})},o))})]}),c.recommendations&&c.recommendations.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Recommendations"}),e.jsx("ul",{className:"space-y-2",children:c.recommendations.map((s,o)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-300",children:[e.jsx("span",{className:"text-purple-400 mt-0.5",children:"â€¢"}),s]},o))})]}),c.similar_findings&&c.similar_findings.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Similar Historical Findings"}),e.jsx("div",{className:"space-y-3",children:c.similar_findings.map((s,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-300",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Similarity: ",Math.round(s.similarity_score*100),"%",s.resolution&&` â€¢ Resolution: ${s.resolution}`]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${s.was_false_positive?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"}`,children:s.was_false_positive?"False Positive":"True Positive"})]},o))})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Analysis generated at ",new Date(c.predicted_at).toLocaleString()]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No AI Analysis Available"}),e.jsx("p",{className:"text-sm text-gray-500",children:"False positive prediction is not available for this vulnerability."})]})]}),v==="remediation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Estimated Effort (hours)"}),f?e.jsx("input",{type:"number",value:xe,onChange:s=>me(s.target.value?parseInt(s.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:g.estimated_effort?`${g.estimated_effort} hours`:"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Actual Effort (hours)"}),f?e.jsx("input",{type:"number",value:ue,onChange:s=>ge(s.target.value?parseInt(s.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:g.actual_effort?`${g.actual_effort} hours`:"Not set"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Remediation Steps"}),f?e.jsx("textarea",{value:de,onChange:s=>ce(s.target.value),rows:10,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 font-mono text-sm",placeholder:"Enter detailed remediation steps (markdown supported)..."}):e.jsx("div",{className:"bg-gray-800 p-4 rounded-md whitespace-pre-wrap text-gray-300",children:g.remediation_steps||"No remediation steps defined"})]}),f&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Fe,disabled:z,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:z?"Saving...":"Save Changes"}),e.jsx("button",{onClick:Pe,disabled:z,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}),!f&&e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit Remediation"}),e.jsx("div",{className:"border-t border-gray-700 pt-6",children:e.jsx(qs,{vulnerabilityId:r,onApplyToJira:g.jira_ticket_id?s=>{navigator.clipboard.writeText(s),u.success("Remediation steps copied to clipboard (JIRA format)")}:void 0})})]}),v==="workflow"&&e.jsx("div",{className:"space-y-6",children:F?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):S?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ds,{instance:S,onApprove:Xe,onReject:Ze,onAdvance:Qe,onHold:Ue,onResume:es,onCancel:ss,isLoading:F}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Workflow History"}),e.jsx(Es,{transitions:S.transitions,stageNames:S.stage_instances.reduce((s,o)=>(s[o.stage_id]=o.stage.name,s),{})})]})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Start Remediation Workflow"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Start a workflow to track the remediation process through configurable approval stages."}),X.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Workflow Template"}),e.jsx("select",{value:$,onChange:s=>L(s.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:X.map(s=>e.jsxs("option",{value:s.id,children:[s.name,s.description?` - ${s.description}`:""]},s.id))})]}),e.jsx("button",{onClick:Ke,disabled:M||!$,className:"px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700 disabled:bg-gray-600",children:M?"Starting...":"Start Workflow"})]}):e.jsx("p",{className:"text-yellow-400",children:"No workflow templates available. Please configure templates in the Workflows page."})]})}),v==="timeline"&&xs(),v==="comments"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Ls,{vulnerabilityId:r,currentUserId:h==null?void 0:h.id,onCommentsChange:as,initialComments:ye})})]})]}),Je&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Complete Retest"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Retest Result"}),e.jsxs("select",{value:pe,onChange:s=>fe(s.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"still_vulnerable",children:"Still Vulnerable"}),e.jsx("option",{value:"remediated",children:"Remediated"}),e.jsx("option",{value:"partially_remediated",children:"Partially Remediated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:he,onChange:s=>te(s.target.value),rows:3,className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about the retest result..."})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 justify-end",children:[e.jsx("button",{onClick:()=>{be(!1),te(""),fe("still_vulnerable")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{onClick:is,disabled:z,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:z?"Completing...":"Complete Retest"})]})]})})]})},et=()=>{const[r,x]=a.useState([]),[t,h]=a.useState(),[w,l]=a.useState(null),[j,_]=a.useState(null),[y,f]=a.useState(!0);a.useEffect(()=>{b()},[]),a.useEffect(()=>{t&&v()},[t]);const b=async()=>{try{f(!0);const C=(await Rs.getAll()).data.filter(n=>n.status==="completed");x(C),C.length>0&&!t&&h(C[0].id)}catch(c){console.error("Failed to load scans:",c)}finally{f(!1)}},v=async()=>{if(t)try{const c=await R.getStats(t);_(c.data)}catch(c){console.error("Failed to load stats:",c)}},D=c=>{l(c)},E=()=>{l(null)},T=()=>{v()};return e.jsxs(us,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Remediation Workflow"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Track and manage vulnerability remediation progress with a Kanban-style board"})]}),e.jsxs("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Scan"}),e.jsxs("select",{value:t||"",onChange:c=>h(c.target.value||void 0),className:"w-full md:w-96 rounded-md bg-dark-bg border-dark-border text-white shadow-sm focus:border-primary focus:ring-primary",disabled:y,children:[e.jsx("option",{value:"",children:"Select a scan..."}),r.map(c=>e.jsxs("option",{value:c.id,children:[c.name," - ",new Date(c.created_at).toLocaleDateString()]},c.id))]})]}),j&&e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg px-4 py-2 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:j.total}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-severity-critical/20 rounded-lg px-4 py-2 text-center border border-severity-critical/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-critical",children:j.open}),e.jsx("div",{className:"text-xs text-slate-400",children:"Open"})]}),e.jsxs("div",{className:"bg-severity-medium/20 rounded-lg px-4 py-2 text-center border border-severity-medium/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-medium",children:j.in_progress}),e.jsx("div",{className:"text-xs text-slate-400",children:"In Progress"})]}),e.jsxs("div",{className:"bg-status-completed/20 rounded-lg px-4 py-2 text-center border border-status-completed/50",children:[e.jsx("div",{className:"text-2xl font-bold text-status-completed",children:j.resolved}),e.jsx("div",{className:"text-xs text-slate-400",children:"Resolved"})]})]})]}),j&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"By Severity"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-critical"}),e.jsxs("span",{className:"text-slate-300",children:["Critical: ",j.critical]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-high"}),e.jsxs("span",{className:"text-slate-300",children:["High: ",j.high]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-medium"}),e.jsxs("span",{className:"text-slate-300",children:["Medium: ",j.medium]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-low"}),e.jsxs("span",{className:"text-slate-300",children:["Low: ",j.low]})]})]})]})]}),e.jsx("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:y?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):r.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("p",{className:"text-lg mb-2",children:"No completed scans found"}),e.jsx("p",{className:"text-sm",children:"Run a scan with vulnerability detection enabled to see results here"})]}):e.jsx(Ts,{scanId:t,onVulnerabilityClick:D})})]}),w&&e.jsx(Js,{vulnerabilityId:w,onClose:E,onUpdate:T})]})};export{et as default};
