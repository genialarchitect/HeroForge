import{b as K,u as b,d as u,j as e}from"./vendor-state-BjT_zREg.js";import{r as N}from"./vendor-react-5KxtEOLM.js";import{S as Q,m as M,Y as R,y as T,as as I,V as _,h as L,E as B,G as v,aa as w,az as $,aw as z,B as d,p as G,aZ as C,aY as H,ac as O,$ as W,g as U,X as Y}from"./vendor-ui-CfSMq23b.js";import{L as V}from"./Layout-C_2au5Vm.js";import{u as X,E as Z}from"./useRequireEngagement-PpLJuw5s.js";import{B as p,ad as x}from"./index-CJ_zz9jP.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";const J=s=>{switch(s){case"critical":return"bg-red-500/20 text-red-400 border-red-500/30";case"high":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"medium":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"low":return"bg-blue-500/20 text-blue-400 border-blue-500/30";default:return"bg-slate-500/20 text-slate-400 border-slate-500/30"}},ee=s=>({new_subdomain:{label:"New Subdomain",color:"text-green-400"},new_port:{label:"New Port",color:"text-green-400"},port_closed:{label:"Port Closed",color:"text-blue-400"},certificate_change:{label:"Cert Change",color:"text-yellow-400"},certificate_expiring:{label:"Cert Expiring",color:"text-orange-400"},technology_change:{label:"Tech Change",color:"text-purple-400"},ip_address_change:{label:"IP Change",color:"text-cyan-400"},asset_removed:{label:"Asset Removed",color:"text-red-400"},service_change:{label:"Service Change",color:"text-indigo-400"},shadow_it_detected:{label:"Shadow IT",color:"text-red-500"}})[s]||{label:s,color:"text-slate-400"},S=({score:s,size:n="md"})=>{const i={sm:{width:60,stroke:4},md:{width:80,stroke:6},lg:{width:120,stroke:8}},{width:o,stroke:t}=i[n],c=(o-t)/2,a=2*Math.PI*c,r=s/100*a,m=()=>s>=80?"text-red-500":s>=60?"text-orange-500":s>=40?"text-yellow-500":"text-green-500";return e.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[e.jsxs("svg",{width:o,height:o,className:"-rotate-90",children:[e.jsx("circle",{cx:o/2,cy:o/2,r:c,fill:"none",stroke:"currentColor",strokeWidth:t,className:"text-slate-700"}),e.jsx("circle",{cx:o/2,cy:o/2,r:c,fill:"none",stroke:"currentColor",strokeWidth:t,strokeDasharray:a,strokeDashoffset:a-r,strokeLinecap:"round",className:m()})]}),e.jsx("span",{className:`absolute text-${n==="sm"?"xs":n==="md"?"sm":"lg"} font-bold text-white`,children:s})]})},h=({label:s,value:n,icon:i,color:o="text-cyan-400"})=>e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:`${o}`,children:i})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:n}),e.jsx("p",{className:"text-sm text-slate-400",children:s})]})]}),se=({isOpen:s,onClose:n,onSubmit:i,isLoading:o})=>{const[t,c]=N.useState({name:"",description:"",domains:"",schedule:"0 0 * * *",enableSubdomain:!0,enablePortScan:!0,enableServiceDetection:!0,enableSslAnalysis:!0,alertNewSubdomain:!0,alertNewPort:!0,alertCertChange:!0,alertShadowIt:!0}),a=r=>{r.preventDefault();const m=t.domains.split(",").map(g=>g.trim()).filter(Boolean);if(m.length===0){d.error("Please enter at least one domain");return}i({name:t.name,description:t.description||void 0,domains:m,schedule:t.schedule,discovery_config:{enable_subdomain_enum:t.enableSubdomain,enable_port_scan:t.enablePortScan,enable_service_detection:t.enableServiceDetection,enable_ssl_analysis:t.enableSslAnalysis,enable_tech_detection:!0,dns_resolvers:[]},alert_config:{alert_on_new_subdomain:t.alertNewSubdomain,alert_on_new_port:t.alertNewPort,alert_on_cert_change:t.alertCertChange,alert_on_tech_change:!0,alert_on_ip_change:!0,alert_on_asset_removed:!0,alert_on_shadow_it:t.alertShadowIt,min_severity:"low",notification_channels:[]}})};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Create ASM Monitor"}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-slate-700 rounded",children:e.jsx(Y,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:t.name,onChange:r=>c({...t,name:r.target.value}),placeholder:"Production Assets Monitor",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:t.description,onChange:r=>c({...t,description:r.target.value}),placeholder:"Monitor for production domain assets",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Domains (comma-separated)"}),e.jsx("input",{type:"text",value:t.domains,onChange:r=>c({...t,domains:r.target.value}),placeholder:"example.com, sub.example.com",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Schedule (Cron)"}),e.jsxs("select",{value:t.schedule,onChange:r=>c({...t,schedule:r.target.value}),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white",children:[e.jsx("option",{value:"0 * * * *",children:"Hourly"}),e.jsx("option",{value:"0 */6 * * *",children:"Every 6 hours"}),e.jsx("option",{value:"0 0 * * *",children:"Daily"}),e.jsx("option",{value:"0 0 * * 0",children:"Weekly"})]})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Discovery Options"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"enableSubdomain",label:"Subdomain Enum"},{key:"enablePortScan",label:"Port Scanning"},{key:"enableServiceDetection",label:"Service Detection"},{key:"enableSslAnalysis",label:"SSL Analysis"}].map(r=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:t[r.key],onChange:m=>c({...t,[r.key]:m.target.checked}),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),r.label]},r.key))})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Alert Triggers"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"alertNewSubdomain",label:"New Subdomain"},{key:"alertNewPort",label:"New Port"},{key:"alertCertChange",label:"Cert Change"},{key:"alertShadowIt",label:"Shadow IT"}].map(r=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:t[r.key],onChange:m=>c({...t,[r.key]:m.target.checked}),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),r.label]},r.key))})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(p,{type:"submit",disabled:o,children:[o?e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(M,{className:"w-4 h-4 mr-2"}),"Create Monitor"]}),e.jsx(p,{type:"button",variant:"secondary",onClick:n,children:"Cancel"})]})]})]})}):null},te=({monitor:s,onRun:n,onToggle:i,onDelete:o,onSelect:t})=>e.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4 hover:border-slate-600 transition-colors cursor-pointer",onClick:t,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h4",{className:"text-white font-medium",children:s.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${s.enabled?"bg-green-500/20 text-green-400":"bg-slate-600 text-slate-400"}`,children:s.enabled?"Active":"Disabled"})]}),s.description&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.domains.slice(0,3).map((c,a)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-slate-700 text-slate-300 rounded",children:c},a)),s.domains.length>3&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-slate-700 text-slate-400 rounded",children:["+",s.domains.length-3," more"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),s.schedule]}),s.last_run_at&&e.jsxs("span",{children:["Last run: ",new Date(s.last_run_at).toLocaleDateString()]}),s.next_run_at&&e.jsxs("span",{children:["Next: ",new Date(s.next_run_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",onClick:c=>c.stopPropagation(),children:[e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-700 rounded-lg",title:"Run now",children:e.jsx(C,{className:"w-4 h-4 text-green-400"})}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-700 rounded-lg",title:s.enabled?"Disable":"Enable",children:s.enabled?e.jsx(H,{className:"w-4 h-4 text-yellow-400"}):e.jsx(C,{className:"w-4 h-4 text-cyan-400"})}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-slate-700 rounded-lg",title:"Delete",children:e.jsx(O,{className:"w-4 h-4 text-red-400"})}),e.jsx(W,{className:"w-5 h-5 text-slate-500"})]})]})}),ae=({change:s,onAcknowledge:n})=>{const i=ee(s.change_type);return e.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 border border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded border ${J(s.severity)}`,children:s.severity}),e.jsx("span",{className:`text-sm font-medium ${i.color}`,children:i.label})]}),e.jsx("p",{className:"text-white text-sm mt-1",children:s.hostname}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:s.details.description}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(s.detected_at).toLocaleString()})]}),!s.acknowledged&&e.jsx("button",{onClick:n,className:"p-1.5 hover:bg-slate-700 rounded",title:"Acknowledge",children:e.jsx(U,{className:"w-4 h-4 text-green-400"})}),s.acknowledged&&e.jsx("span",{className:"text-xs text-slate-500",children:"Acknowledged"})]})})},le=({events:s})=>e.jsxs("div",{className:"space-y-3",children:[s.map((n,i)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.severity==="critical"?"bg-red-400":n.severity==="high"?"bg-orange-400":n.severity==="medium"?"bg-yellow-400":"bg-slate-500"}`}),i<s.length-1&&e.jsx("div",{className:"w-px flex-1 bg-slate-700 mt-1"})]}),e.jsxs("div",{className:"flex-1 pb-3",children:[e.jsx("p",{className:"text-sm text-white",children:n.description}),e.jsxs("p",{className:"text-xs text-slate-400",children:[n.monitor_name," - ",new Date(n.timestamp).toLocaleString()]})]})]},i)),s.length===0&&e.jsx("p",{className:"text-slate-400 text-sm text-center py-4",children:"No recent events"})]});function ue(){const s=K(),[n,i]=N.useState(!1),[o,t]=N.useState(null),{hasEngagement:c}=X(),{data:a}=b({queryKey:["asm-dashboard"],queryFn:async()=>(await x.getDashboard()).data,refetchInterval:3e4}),{data:r,isLoading:m}=b({queryKey:["asm-monitors"],queryFn:async()=>(await x.listMonitors()).data}),{data:g}=b({queryKey:["asm-changes"],queryFn:async()=>(await x.listChanges({limit:20,acknowledged:!1})).data,refetchInterval:3e4}),{data:q}=b({queryKey:["asm-timeline"],queryFn:async()=>(await x.getTimeline(void 0,7)).data}),{data:j}=b({queryKey:["asm-risk-scores"],queryFn:async()=>(await x.listRiskScores(10)).data}),f=u({mutationFn:x.createMonitor,onSuccess:()=>{d.success("Monitor created successfully"),s.invalidateQueries({queryKey:["asm-monitors"]}),s.invalidateQueries({queryKey:["asm-dashboard"]}),i(!1)},onError:l=>{var y,k;d.error(((k=(y=l.response)==null?void 0:y.data)==null?void 0:k.error)||"Failed to create monitor")}}),D=u({mutationFn:x.runMonitor,onSuccess:(l,y)=>{d.success("Monitor scan started"),s.invalidateQueries({queryKey:["asm-monitors"]}),s.invalidateQueries({queryKey:["asm-timeline"]})},onError:()=>d.error("Failed to run monitor")}),A=u({mutationFn:x.enableMonitor,onSuccess:()=>{d.success("Monitor enabled"),s.invalidateQueries({queryKey:["asm-monitors"]}),s.invalidateQueries({queryKey:["asm-dashboard"]})},onError:()=>d.error("Failed to enable monitor")}),P=u({mutationFn:x.disableMonitor,onSuccess:()=>{d.success("Monitor disabled"),s.invalidateQueries({queryKey:["asm-monitors"]}),s.invalidateQueries({queryKey:["asm-dashboard"]})},onError:()=>d.error("Failed to disable monitor")}),F=u({mutationFn:x.deleteMonitor,onSuccess:()=>{d.success("Monitor deleted"),s.invalidateQueries({queryKey:["asm-monitors"]}),s.invalidateQueries({queryKey:["asm-dashboard"]})},onError:()=>d.error("Failed to delete monitor")}),E=u({mutationFn:l=>x.acknowledgeChange(l),onSuccess:()=>{d.success("Change acknowledged"),s.invalidateQueries({queryKey:["asm-changes"]}),s.invalidateQueries({queryKey:["asm-dashboard"]})},onError:()=>d.error("Failed to acknowledge change")});return e.jsxs(V,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-7 h-7 text-cyan-400"}),"Attack Surface Management"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Continuous external monitoring with change detection and risk scoring"})]}),e.jsxs(p,{onClick:()=>i(!0),disabled:!c,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"New Monitor"]})]}),e.jsx(Z,{toolName:"Attack Surface Management",className:"mb-6"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(h,{label:"Active Monitors",value:(a==null?void 0:a.active_monitors)||0,icon:e.jsx(R,{className:"w-5 h-5"})}),e.jsx(h,{label:"Total Assets",value:(a==null?void 0:a.total_assets)||0,icon:e.jsx(T,{className:"w-5 h-5"}),color:"text-green-400"}),e.jsx(h,{label:"Changes (24h)",value:(a==null?void 0:a.total_changes_24h)||0,icon:e.jsx(I,{className:"w-5 h-5"}),color:"text-yellow-400"}),e.jsx(h,{label:"Unacknowledged",value:(a==null?void 0:a.unacknowledged_changes)||0,icon:e.jsx(_,{className:"w-5 h-5"}),color:"text-orange-400"}),e.jsx(h,{label:"High Risk Assets",value:(a==null?void 0:a.high_risk_assets)||0,icon:e.jsx(L,{className:"w-5 h-5"}),color:"text-red-400"}),e.jsx(h,{label:"Shadow IT",value:(a==null?void 0:a.shadow_it_count)||0,icon:e.jsx(B,{className:"w-5 h-5"}),color:"text-purple-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-cyan-400"}),"Monitors"]}),e.jsx(p,{variant:"secondary",size:"sm",onClick:()=>s.invalidateQueries({queryKey:["asm-monitors"]}),children:e.jsx(w,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-4 space-y-3",children:m?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(w,{className:"w-6 h-6 text-cyan-400 animate-spin"})}):r&&r.length>0?r.map(l=>e.jsx(te,{monitor:l,onRun:()=>D.mutate(l.id),onToggle:()=>l.enabled?P.mutate(l.id):A.mutate(l.id),onDelete:()=>{confirm("Delete this monitor?")&&F.mutate(l.id)},onSelect:()=>t(l.id)},l.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"No monitors configured"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create a monitor to start tracking your attack surface"})]})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-orange-400"}),"Recent Changes"]})}),e.jsx("div",{className:"p-4 space-y-2 max-h-80 overflow-y-auto",children:g&&g.length>0?g.map(l=>e.jsx(ae,{change:l,onAcknowledge:()=>E.mutate(l.id)},l.id)):e.jsx("p",{className:"text-slate-400 text-sm text-center py-4",children:"No unacknowledged changes"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-cyan-400"}),"Activity Timeline"]})}),e.jsx("div",{className:"p-4 max-h-64 overflow-y-auto",children:e.jsx(le,{events:q||[]})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-red-400"}),"Highest Risk Assets"]})}),e.jsx("div",{className:"p-4 space-y-3",children:j&&j.length>0?j.slice(0,5).map(l=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:l.hostname}),e.jsxs("p",{className:"text-xs text-slate-400",children:[l.factors.length," risk factors"]})]}),e.jsx(S,{score:l.overall_score,size:"sm"})]},l.id)):e.jsx("p",{className:"text-slate-400 text-sm text-center py-4",children:"No risk scores calculated yet"})})]}),a&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6 text-center",children:[e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Average Risk Score"}),e.jsx(S,{score:Math.round(a.average_risk_score),size:"lg"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-3",children:["Based on ",a.total_assets," monitored assets"]})]})]})]}),e.jsx(se,{isOpen:n,onClose:()=>i(!1),onSubmit:l=>f.mutate(l),isLoading:f.isPending})]})}export{ue as default};
