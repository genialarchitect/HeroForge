import{j as e}from"./vendor-state-BjT_zREg.js";import{i as D,r as s,L as E}from"./vendor-react-5KxtEOLM.js";import{P as u}from"./PortalLayout-E2qcEdGG.js";import{az as n}from"./index--6GUYD2o.js";import{aT as F}from"./vendor-ui-CaTPr3iI.js";import"./vendor-utils-DfRopTPV.js";const R={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-green-600 text-white"},z={open:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",in_progress:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",pending_verification:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",resolved:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",accepted_risk:"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300"},U={open:["in_progress","accepted_risk"],in_progress:["pending_verification","accepted_risk","resolved"],pending_verification:["in_progress"]};function W(){var y;const{id:a}=D(),[t,w]=s.useState(null),[p,C]=s.useState([]),[S,_]=s.useState(!0),[k,A]=s.useState(""),[d,f]=s.useState(""),[l,i]=s.useState(!1),[c,b]=s.useState(""),[x,m]=s.useState(null);s.useEffect(()=>{a&&(v(),g())},[a]);const v=async()=>{if(a)try{const r=await n.getById(a);w(r.data)}catch(r){A("Failed to load vulnerability"),console.error(r)}finally{_(!1)}},g=async()=>{if(a)try{const r=await n.getComments(a);C(r.data.comments)}catch(r){console.error("Failed to load comments:",r)}},V=async r=>{var o,N;if(a){i(!0);try{await n.updateStatus(a,r,c||void 0),v(),c&&g(),m(null),b("")}catch(P){alert(((N=(o=P.response)==null?void 0:o.data)==null?void 0:N.error)||"Failed to update status")}finally{i(!1)}}},L=async r=>{if(r.preventDefault(),!(!a||!d.trim())){i(!0);try{await n.addComment(a,d),f(""),g()}catch(o){console.error("Failed to add comment:",o)}finally{i(!1)}}};if(S)return e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})});if(k||!t)return e.jsx(u,{children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 p-4 rounded-lg",children:k||"Vulnerability not found"})});const h=t.vulnerability.status,j=U[h]||[];return e.jsxs(u,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{to:"/portal/vulnerabilities",className:"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex-1",children:t.vulnerability.title}),e.jsx("span",{className:`px-3 py-1 rounded text-sm font-medium ${R[t.vulnerability.severity]||"bg-slate-200 dark:bg-slate-700"}`,children:t.vulnerability.severity.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${z[h]||"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}`,children:h.replace("_"," ")})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"CVSS Score"}),e.jsx("p",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:((y=t.vulnerability.cvss_score)==null?void 0:y.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Host"}),e.jsxs("p",{className:"text-slate-900 dark:text-white",children:[t.vulnerability.host,t.vulnerability.port?`:${t.vulnerability.port}`:""]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Service"}),e.jsx("p",{className:"text-slate-900 dark:text-white",children:t.vulnerability.service||"Unknown"})]})]}),j.length>0&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:"Update Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(r=>e.jsxs("button",{onClick:()=>m(r),className:"px-4 py-2 bg-light-hover dark:bg-dark-hover hover:bg-primary/10 text-slate-900 dark:text-white rounded-lg text-sm transition-colors",children:[r==="in_progress"&&"Start Working",r==="pending_verification"&&"Request Verification",r==="accepted_risk"&&"Accept Risk",r==="resolved"&&"Mark Resolved"]},r))})]}),t.vulnerability.cve_ids&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:"CVE IDs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.vulnerability.cve_ids.split(",").map(r=>e.jsx("a",{href:`https://nvd.nist.gov/vuln/detail/${r.trim()}`,target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm hover:bg-blue-200 dark:hover:bg-blue-800/50 transition-colors",children:r.trim()},r))})]}),t.description&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Description"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 whitespace-pre-wrap",children:t.description})]}),t.remediation&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Remediation"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 whitespace-pre-wrap",children:t.remediation})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:"Comments"}),e.jsxs("form",{onSubmit:L,className:"mb-6",children:[e.jsx("textarea",{value:d,onChange:r=>f(r.target.value),placeholder:"Add a comment...",className:"w-full bg-light-bg dark:bg-dark-bg text-slate-900 dark:text-white px-4 py-3 rounded-lg border border-light-border dark:border-dark-border focus:ring-2 focus:ring-primary focus:border-primary resize-none",rows:3}),e.jsx("button",{type:"submit",disabled:l||!d.trim(),className:"mt-2 px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg text-sm disabled:opacity-50 transition-colors",children:l?"Adding...":"Add Comment"})]}),p.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No comments yet"}):e.jsx("div",{className:"space-y-4",children:p.map(r=>e.jsxs("div",{className:"border-l-2 border-light-border dark:border-dark-border pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-primary",children:r.user_email}),e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:new Date(r.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mt-1",children:r.comment})]},r.id))})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:["Change Status to: ",x.replace("_"," ")]}),e.jsx("textarea",{value:c,onChange:r=>b(r.target.value),placeholder:"Add a comment (optional)...",className:"w-full bg-light-bg dark:bg-dark-bg text-slate-900 dark:text-white px-4 py-3 rounded-lg border border-light-border dark:border-dark-border focus:ring-2 focus:ring-primary resize-none mb-4",rows:3}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{m(null),b("")},className:"px-4 py-2 bg-light-hover dark:bg-dark-hover text-slate-900 dark:text-white rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>V(x),disabled:l,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg disabled:opacity-50 transition-colors",children:l?"Updating...":"Confirm"})]})]})})]})}export{W as default};
