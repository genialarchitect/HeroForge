import{j as e}from"./vendor-state-DrZ0R9WI.js";import{r as a}from"./vendor-react-HUtzaQ-y.js";import{d as we,C as S,L as z,I as B,B as v,a as ce,b as Z,e as de,t as be,s as je,f as ns,n as le,g as Qe,h as Je,i as is,u as cs,j as ve,k as me,m as Ne,l as Ie,o as fe,p as ue,v as ne,c as os}from"./index-HWikd5b2.js";import{B as t,U as De,S as te,ai as Ve,ax as Re,t as pe,a as Ee,A as ee,n as ds,b as _e,J as Xe,ay as xs,az as ms,aA as hs,a7 as ie,aB as us,v as oe,q as $e,P as Q,X as ye,F as ps,au as ge,aC as gs,aD as Ze,aE as es,aF as Fe,Q as se,aG as js,aH as Le,D as fs,aI as he,a8 as ke,N as Ke,h as Ue,a5 as Se,aJ as bs,R as ys,s as ss,aK as vs,aL as ts,w as Ns,x as Ce,V as Oe,$ as ws,aM as qe,a3 as ks,K as Pe,m as as,ag as rs,aN as ze,aO as _s,aP as Me,W as ls,I as He,aQ as Ss,aR as Ge}from"./vendor-ui-B0CnzN9V.js";import"./vendor-charts-B0X_RreH.js";const Cs=()=>{var l;const[c,M]=a.useState(null),[V,j]=a.useState(!0),[g,E]=a.useState(!1),[k,F]=a.useState(!1),[x,A]=a.useState(""),[i,_]=a.useState(!1),[P,L]=a.useState(""),[b,I]=a.useState(""),[D,U]=a.useState("");a.useEffect(()=>{T()},[]);const T=async()=>{j(!0);try{const d=await we.me();M(d.data),A(d.data.email||"")}catch(d){t.error("Failed to load profile"),console.error(d)}finally{j(!1)}},o=async d=>{var C,f;if(d.preventDefault(),!x.trim()){t.error("Email is required");return}E(!0);try{const y=await we.updateProfile({email:x.trim()});M(y.data),t.success("Profile updated successfully")}catch(y){const p=y;t.error(((f=(C=p.response)==null?void 0:C.data)==null?void 0:f.error)||"Failed to update profile")}finally{E(!1)}},h=async d=>{var C,f;if(d.preventDefault(),!P||!b){t.error("All password fields are required");return}if(b.length<6){t.error("New password must be at least 6 characters");return}if(b!==D){t.error("Passwords do not match");return}F(!0);try{await we.changePassword({current_password:P,new_password:b}),t.success("Password changed successfully"),_(!1),L(""),I(""),U("")}catch(y){const p=y;t.error(((f=(C=p.response)==null?void 0:C.data)==null?void 0:f.error)||"Failed to change password")}finally{F(!1)}},n=d=>d?new Date(d).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A";return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(De,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Profile Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-dark-bg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(De,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Username"}),e.jsx("p",{className:"text-white font-medium",children:c==null?void 0:c.username})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(te,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Roles"}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:((l=c==null?void 0:c.roles)==null?void 0:l.map(d=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-primary/20 text-primary rounded capitalize",children:d},d)))||e.jsx("span",{className:"text-slate-400",children:"No roles"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(Ve,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Member Since"}),e.jsx("p",{className:"text-white",children:n(c==null?void 0:c.created_at)})]})]})]}),e.jsx("form",{onSubmit:o,className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Email Address"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(B,{type:"email",value:x,onChange:d=>A(d.target.value),placeholder:"your@email.com",className:"flex-1"}),e.jsxs(v,{type:"submit",variant:"primary",loading:g,disabled:g||x===(c==null?void 0:c.email),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Save"]})]})]})})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-6 w-6 text-yellow-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Security"})]}),!i&&e.jsx(v,{variant:"secondary",onClick:()=>_(!0),children:"Change Password"})]}),i?e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx(B,{label:"Current Password",type:"password",value:P,onChange:d=>L(d.target.value),placeholder:"Enter current password"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(B,{label:"New Password",type:"password",value:b,onChange:d=>I(d.target.value),placeholder:"Enter new password"}),e.jsx(B,{label:"Confirm New Password",type:"password",value:D,onChange:d=>U(d.target.value),placeholder:"Confirm new password"})]}),b&&D&&b!==D&&e.jsx("p",{className:"text-sm text-red-400",children:"Passwords do not match"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:()=>{_(!1),L(""),I(""),U("")},children:"Cancel"}),e.jsx(v,{type:"submit",variant:"primary",loading:k,disabled:k||!P||!b||b!==D,children:"Update Password"})]})]}):e.jsx("p",{className:"text-slate-400",children:"Keep your account secure by using a strong, unique password."})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(te,{className:"h-6 w-6 text-green-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Account Status"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(c==null?void 0:c.is_active)!==!1?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-white",children:(c==null?void 0:c.is_active)!==!1?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Your account is in good standing."})]})]})},Ps=[{id:"admin",name:"Admin",description:"Full system access"},{id:"user",name:"User",description:"Standard user access"},{id:"auditor",name:"Auditor",description:"Read-only access to all scans"},{id:"viewer",name:"Viewer",description:"Limited view access"}],Es=()=>{const[c,M]=a.useState([]),[V,j]=a.useState([]),[g,E]=a.useState(!0),[k,F]=a.useState(!1),[x,A]=a.useState(new Set),[i,_]=a.useState(!1),[P,L]=a.useState(!0),[b,I]=a.useState(null),[D,U]=a.useState(!1);a.useEffect(()=>{T()},[]);const T=async()=>{var m;E(!0);try{const r=await ce.getUsers();M(r.data),L(!0)}catch(r){((m=r.response)==null?void 0:m.status)===403?L(!1):t.error("Failed to load users"),console.error(r)}finally{E(!1)}},o=async()=>{F(!0);try{const m=await ce.getAuditLogs({limit:50,offset:0});j(m.data.logs)}catch(m){t.error("Failed to load audit logs"),console.error(m)}finally{F(!1)}},h=m=>{const r=new Set(x);r.has(m)?r.delete(m):r.add(m),A(r)},n=async m=>{var r,u;try{await ce.updateUser(m.id,{is_active:!m.is_active}),t.success(`User ${m.is_active?"deactivated":"activated"}`),T()}catch(N){const H=N;t.error(((u=(r=H.response)==null?void 0:r.data)==null?void 0:u.error)||"Failed to update user")}},l=async()=>{var m,r;if(b){U(!0);try{await ce.deleteUser(b.id),t.success(`User "${b.username}" deleted successfully`),T(),I(null)}catch(u){const N=u;t.error(((r=(m=N.response)==null?void 0:m.data)==null?void 0:r.error)||"Failed to delete user")}finally{U(!1)}}},d=async(m,r)=>{var u,N;try{await ce.assignRole(m,r),t.success("Role assigned"),T()}catch(H){const Y=H;t.error(((N=(u=Y.response)==null?void 0:u.data)==null?void 0:N.error)||"Failed to assign role")}},C=async(m,r)=>{var u,N;try{await ce.removeRole(m,r),t.success("Role removed"),T()}catch(H){const Y=H;t.error(((N=(u=Y.response)==null?void 0:u.data)==null?void 0:N.error)||"Failed to remove role")}},f=async m=>{var r,u;try{await ce.unlockUser(m.id),t.success(`Account "${m.username}" unlocked`),T()}catch(N){const H=N;t.error(((u=(r=H.response)==null?void 0:r.data)==null?void 0:u.error)||"Failed to unlock account")}},y=m=>new Date(m).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),p=m=>{switch(m){case"admin":return"bg-red-500/20 text-red-400 border-red-500/30";case"user":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"auditor":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"viewer":return"bg-slate-500/20 text-slate-400 border-slate-500/30";default:return"bg-slate-500/20 text-slate-400 border-slate-500/30"}};return g?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):P?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ds,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"User Management"})]}),e.jsxs(Z,{variant:"status",type:"completed",children:[c.length," users"]})]}),e.jsx("div",{className:"space-y-3",children:c.map(m=>{const r=x.has(m.id),u=m.roles||[];return e.jsxs("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-dark-hover transition-colors",onClick:()=>h(m.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"text-slate-400",children:r?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${m.is_active!==!1?"bg-green-400":"bg-red-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:m.username}),e.jsx("p",{className:"text-sm text-slate-400",children:m.email})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex gap-1",children:u.map(N=>e.jsx("span",{className:`px-2 py-0.5 text-xs rounded border capitalize ${p(N)}`,children:N},N))}),m.is_locked&&e.jsxs("span",{className:"px-2 py-0.5 text-xs rounded border bg-red-500/20 text-red-400 border-red-500/30 flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),"Locked"]}),e.jsx("span",{className:"text-xs text-slate-500",children:m.created_at?y(m.created_at):"N/A"})]})]}),r&&e.jsxs("div",{className:"border-t border-dark-border p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Manage Roles"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Ps.map(N=>{const H=u.includes(N.id);return e.jsxs("button",{onClick:Y=>{Y.stopPropagation(),H?C(m.id,N.id):d(m.id,N.id)},className:`p-3 rounded-lg border text-left transition-colors ${H?"bg-primary/20 border-primary/50 text-primary":"bg-dark-surface border-dark-border text-slate-400 hover:border-primary/30"}`,children:[e.jsx("p",{className:"font-medium text-sm capitalize",children:N.name}),e.jsx("p",{className:"text-xs opacity-75",children:N.description})]},N.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-border",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:m.is_active!==!1?"secondary":"primary",size:"sm",onClick:N=>{N.stopPropagation(),n(m)},children:m.is_active!==!1?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),"Activate"]})}),m.is_locked&&e.jsxs(v,{variant:"primary",size:"sm",onClick:N=>{N.stopPropagation(),f(m)},children:[e.jsx(hs,{className:"h-4 w-4 mr-1"}),"Unlock Account"]})]}),e.jsxs(v,{variant:"secondary",size:"sm",onClick:N=>{N.stopPropagation(),I(m)},className:"text-red-400 hover:text-red-300 hover:bg-red-500/10","aria-label":`Delete user ${m.username}`,children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})]},m.id)})})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(us,{className:"h-6 w-6 text-purple-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Audit Logs"})]}),e.jsx(v,{variant:"secondary",onClick:()=>{_(!i),!i&&V.length===0&&o()},children:i?"Hide Logs":"Show Logs"})]}),i&&e.jsx(e.Fragment,{children:k?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(z,{})}):V.length===0?e.jsx("p",{className:"text-slate-400 text-center py-8",children:"No audit logs found"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:V.map(m=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-dark-bg rounded-lg text-sm",children:[e.jsx(oe,{className:"h-4 w-4 text-slate-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-white",children:m.action}),m.target_type&&e.jsxs("span",{className:"text-slate-400",children:["on ",m.target_type]}),m.target_id&&e.jsx("span",{className:"text-xs text-slate-500 font-mono truncate max-w-32",children:m.target_id})]}),m.details&&e.jsx("p",{className:"text-xs text-slate-500 mt-1 truncate",children:m.details})]}),e.jsx("span",{className:"text-xs text-slate-500 whitespace-nowrap",children:y(m.created_at)})]},m.id))})}),!i&&e.jsx("p",{className:"text-slate-400",children:"View a log of administrative actions performed in the system."})]}),e.jsx(de,{isOpen:!!b,onClose:()=>I(null),onConfirm:l,title:"Delete User",message:`Are you sure you want to delete user "${b==null?void 0:b.username}"? All their data, including scans and settings, will be permanently removed.`,confirmLabel:"Delete User",variant:"danger",loading:D})]}):e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"h-12 w-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-slate-400",children:"You don't have permission to access the administration panel."}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Contact an administrator if you need elevated access."})]})})},Te=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899","#6366f1","#64748b"],As=()=>{const[c,M]=a.useState([]),[V,j]=a.useState(!0),[g,E]=a.useState(!1),[k,F]=a.useState(null),[x,A]=a.useState({name:"",description:"",targets:"",color:Te[0]}),[i,_]=a.useState(null),[P,L]=a.useState(!1);a.useEffect(()=>{b()},[]);const b=async()=>{j(!0);try{const h=await be.getAll();M(h.data)}catch(h){t.error("Failed to load target groups"),console.error(h)}finally{j(!1)}},I=()=>{A({name:"",description:"",targets:"",color:Te[0]}),F(null),E(!1)},D=h=>{const n=JSON.parse(h.targets||"[]");A({name:h.name,description:h.description||"",targets:n.join(`
`),color:h.color}),F(h.id),E(!0)},U=async h=>{var l,d;h.preventDefault();const n=x.targets.split(`
`).map(C=>C.trim()).filter(C=>C.length>0);if(!x.name.trim()){t.error("Name is required");return}if(n.length===0){t.error("At least one target is required");return}try{k?(await be.update(k,{name:x.name,description:x.description||void 0,targets:n,color:x.color}),t.success("Target group updated")):(await be.create({name:x.name,description:x.description||void 0,targets:n,color:x.color}),t.success("Target group created")),I(),b()}catch(C){const f=C;t.error(((d=(l=f.response)==null?void 0:l.data)==null?void 0:d.error)||"Failed to save target group")}},T=async()=>{var h,n;if(i){L(!0);try{await be.delete(i.id),t.success(`Target group "${i.name}" deleted`),b(),_(null)}catch(l){const d=l;t.error(((n=(h=d.response)==null?void 0:h.data)==null?void 0:n.error)||"Failed to delete")}finally{L(!1)}}},o=h=>{try{return JSON.parse(h||"[]")}catch{return[]}};return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Target Groups"})]}),!g&&e.jsxs(v,{variant:"primary",onClick:()=>E(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"New Group"]})]})}),g&&e.jsx(S,{children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:k?"Edit Target Group":"Create Target Group"}),e.jsx("button",{type:"button",onClick:I,className:"text-slate-400 hover:text-white",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:x.name,onChange:h=>A({...x,name:h.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Production Servers"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Color"}),e.jsx("div",{className:"flex gap-2",children:Te.map(h=>e.jsx("button",{type:"button",onClick:()=>A({...x,color:h}),className:`w-8 h-8 rounded-full border-2 transition-all ${x.color===h?"border-white scale-110":"border-transparent"}`,style:{backgroundColor:h}},h))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:x.description,onChange:h=>A({...x,description:h.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Optional description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Targets (one per line)"}),e.jsx("textarea",{value:x.targets,onChange:h=>A({...x,targets:h.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm",rows:5,placeholder:`192.168.1.0/24
10.0.0.1
example.com`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:I,children:"Cancel"}),e.jsxs(v,{type:"submit",variant:"primary",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),k?"Update":"Create"]})]})]})}),c.length===0&&!g?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ps,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No target groups yet"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create groups to organize your scan targets"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(h=>{const n=o(h.targets);return e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:h.color}}),e.jsx("h4",{className:"font-medium text-white",children:h.name})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>D(h),className:"p-1.5 text-slate-400 hover:text-primary transition-colors",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(h),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors","aria-label":`Delete target group ${h.name}`,children:e.jsx(ie,{className:"h-4 w-4"})})]})]}),h.description&&e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:h.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:[n.length," target",n.length!==1?"s":""]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[n.slice(0,5).map((l,d)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-dark-bg rounded text-slate-300 font-mono",children:l},d)),n.length>5&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-dark-bg rounded text-slate-500",children:["+",n.length-5," more"]})]})]})]},h.id)})}),e.jsx(de,{isOpen:!!i,onClose:()=>_(null),onConfirm:T,title:"Delete Target Group",message:`Are you sure you want to delete the target group "${i==null?void 0:i.name}"? Scheduled scans using this group will need to be updated.`,confirmLabel:"Delete Group",variant:"danger",loading:P})]})},We={name:"",description:"",schedule_type:"daily",schedule_value:"02:00",targets:"",port_range_start:1,port_range_end:1e3,threads:100,enable_os_detection:!0,enable_service_detection:!0,enable_vuln_scan:!0,enable_enumeration:!1},Be=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Is=()=>{const[c,M]=a.useState([]),[V,j]=a.useState([]),[g,E]=a.useState(!0),[k,F]=a.useState(!1),[x,A]=a.useState(null),[i,_]=a.useState(We),[P,L]=a.useState(0),[b,I]=a.useState(1),[D,U]=a.useState(null),[T,o]=a.useState(!1);a.useEffect(()=>{h()},[]);const h=async()=>{E(!0);try{const[r,u]=await Promise.all([je.getAll(),be.getAll()]);M(r.data),j(u.data)}catch(r){t.error("Failed to load scheduled scans"),console.error(r)}finally{E(!1)}},n=()=>{_(We),A(null),F(!1),L(0),I(1)},l=r=>{const u=JSON.parse(r.config);if(_({name:r.name,description:r.description||"",schedule_type:r.schedule_type,schedule_value:r.schedule_value,targets:u.targets.join(`
`),port_range_start:u.port_range[0],port_range_end:u.port_range[1],threads:u.threads,enable_os_detection:u.enable_os_detection,enable_service_detection:u.enable_service_detection,enable_vuln_scan:u.enable_vuln_scan,enable_enumeration:u.enable_enumeration}),r.schedule_type==="weekly"){const N=r.schedule_value.split(" ");N.length>=2&&L(parseInt(N[1])||0)}else if(r.schedule_type==="monthly"){const N=r.schedule_value.split(" ");N.length>=2&&I(parseInt(N[1])||1)}A(r.id),F(!0)},d=()=>{const r=i.schedule_value.includes(":")?i.schedule_value:"02:00";switch(i.schedule_type){case"daily":return r;case"weekly":return`${r} ${P}`;case"monthly":return`${r} ${b}`;default:return r}},C=async r=>{var Y,w;r.preventDefault();const u=i.targets.split(`
`).map(R=>R.trim()).filter(R=>R.length>0);if(!i.name.trim()){t.error("Name is required");return}if(u.length===0){t.error("At least one target is required");return}const N={targets:u,port_range:[i.port_range_start,i.port_range_end],threads:i.threads,enable_os_detection:i.enable_os_detection,enable_service_detection:i.enable_service_detection,enable_vuln_scan:i.enable_vuln_scan,enable_enumeration:i.enable_enumeration},H=d();try{x?(await je.update(x,{name:i.name,description:i.description||void 0,config:N,schedule_type:i.schedule_type,schedule_value:H}),t.success("Scheduled scan updated")):(await je.create({name:i.name,description:i.description||void 0,config:N,schedule_type:i.schedule_type,schedule_value:H}),t.success("Scheduled scan created")),n(),h()}catch(R){const K=R;t.error(((w=(Y=K.response)==null?void 0:Y.data)==null?void 0:w.error)||"Failed to save scheduled scan")}},f=async r=>{var u,N;try{await je.update(r.id,{is_active:!r.is_active}),t.success(`Scheduled scan ${r.is_active?"paused":"activated"}`),h()}catch(H){const Y=H;t.error(((N=(u=Y.response)==null?void 0:u.data)==null?void 0:N.error)||"Failed to update")}},y=async()=>{var r,u;if(D){o(!0);try{await je.delete(D.id),t.success(`Scheduled scan "${D.name}" deleted`),h(),U(null)}catch(N){const H=N;t.error(((u=(r=H.response)==null?void 0:r.data)==null?void 0:u.error)||"Failed to delete")}finally{o(!1)}}},p=r=>{const u=JSON.parse(r.targets||"[]");_(N=>({...N,targets:u.join(`
`)}))},m=r=>{const u=r.schedule_value.split(" "),N=u[0];switch(r.schedule_type){case"daily":return`Daily at ${N}`;case"weekly":return`Every ${Be[parseInt(u[1])||0]} at ${N}`;case"monthly":return`Monthly on day ${u[1]||1} at ${N}`;default:return r.schedule_value}};return g?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scheduled Scans"})]}),!k&&e.jsxs(v,{variant:"primary",onClick:()=>F(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"New Schedule"]})]})}),k&&e.jsx(S,{children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:x?"Edit Scheduled Scan":"Create Scheduled Scan"}),e.jsx("button",{type:"button",onClick:n,className:"text-slate-400 hover:text-white",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:i.name,onChange:r=>_({...i,name:r.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Daily Network Scan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:i.description,onChange:r=>_({...i,description:r.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Optional description"})]})]}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"})," Schedule"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Frequency"}),e.jsxs("select",{value:i.schedule_type,onChange:r=>_({...i,schedule_type:r.target.value}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),i.schedule_type==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Day of Week"}),e.jsx("select",{value:P,onChange:r=>L(parseInt(r.target.value)),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:Be.map((r,u)=>e.jsx("option",{value:u,children:r},r))})]}),i.schedule_type==="monthly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Day of Month"}),e.jsx("select",{value:b,onChange:r=>I(parseInt(r.target.value)),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:Array.from({length:28},(r,u)=>u+1).map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Time (UTC)"}),e.jsx("input",{type:"time",value:i.schedule_value.split(" ")[0],onChange:r=>_({...i,schedule_value:r.target.value}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Targets (one per line)"}),V.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Use group:"}),V.slice(0,3).map(r=>e.jsx("button",{type:"button",onClick:()=>p(r),className:"px-2 py-0.5 text-xs rounded border border-dark-border text-slate-400 hover:text-white hover:border-primary",style:{borderLeftColor:r.color,borderLeftWidth:3},children:r.name},r.id))]})]}),e.jsx("textarea",{value:i.targets,onChange:r=>_({...i,targets:r.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm",rows:4,placeholder:`192.168.1.0/24
10.0.0.1`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Port Start"}),e.jsx("input",{type:"number",value:i.port_range_start,onChange:r=>_({...i,port_range_start:parseInt(r.target.value)||1}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",min:1,max:65535})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Port End"}),e.jsx("input",{type:"number",value:i.port_range_end,onChange:r=>_({...i,port_range_end:parseInt(r.target.value)||1e3}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",min:1,max:65535})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Threads"}),e.jsx("input",{type:"number",value:i.threads,onChange:r=>_({...i,threads:parseInt(r.target.value)||100}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",min:1,max:1e3})]})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:[{key:"enable_os_detection",label:"OS Detection"},{key:"enable_service_detection",label:"Service Detection"},{key:"enable_vuln_scan",label:"Vulnerability Scan"},{key:"enable_enumeration",label:"Enumeration"}].map(({key:r,label:u})=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i[r],onChange:N=>_({...i,[r]:N.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-bg text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-slate-300",children:u})]},r))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:n,children:"Cancel"}),e.jsxs(v,{type:"submit",variant:"primary",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),x?"Update":"Create"]})]})]})}),c.length===0&&!k?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No scheduled scans"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create automated recurring scans"})]})}):e.jsx("div",{className:"space-y-3",children:c.map(r=>{const u=JSON.parse(r.config);return e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${r.is_active?"bg-green-500/20":"bg-slate-500/20"}`,children:e.jsx(oe,{className:`h-5 w-5 ${r.is_active?"text-green-400":"text-slate-400"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-white",children:r.name}),e.jsx(Z,{variant:"status",type:r.is_active?"completed":"pending",children:r.is_active?"Active":"Paused"})]}),e.jsx("p",{className:"text-sm text-slate-400",children:m(r)}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[u.targets.length," target",u.targets.length!==1?"s":""," | Ports ",u.port_range[0],"-",u.port_range[1]," |",r.run_count," runs",r.last_run_at&&e.jsxs(e.Fragment,{children:[" | Last run ",ns(new Date(r.last_run_at))," ago"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(r),className:`p-2 rounded transition-colors ${r.is_active?"text-yellow-400 hover:bg-yellow-500/20":"text-green-400 hover:bg-green-500/20"}`,title:r.is_active?"Pause":"Activate",children:r.is_active?e.jsx(gs,{className:"h-4 w-4"}):e.jsx(Ze,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>l(r),className:"p-2 text-slate-400 hover:text-primary transition-colors",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(r),className:"p-2 text-slate-400 hover:text-red-400 transition-colors","aria-label":`Delete scheduled scan ${r.name}`,children:e.jsx(ie,{className:"h-4 w-4"})})]})]})},r.id)})}),e.jsx(de,{isOpen:!!D,onClose:()=>U(null),onConfirm:y,title:"Delete Scheduled Scan",message:`Are you sure you want to delete the scheduled scan "${D==null?void 0:D.name}"? Future automated scans will no longer run.`,confirmLabel:"Delete Schedule",variant:"warning",loading:T})]})},Fs=()=>{const[c,M]=a.useState(null),[V,j]=a.useState(!0),[g,E]=a.useState(!1),[k,F]=a.useState(!1),[x,A]=a.useState(!1),[i,_]=a.useState(!1),[P,L]=a.useState(null),[b,I]=a.useState({email_on_scan_complete:!1,email_on_critical_vuln:!0,email_address:"",slack_webhook_url:"",teams_webhook_url:""});a.useEffect(()=>{D(),U()},[]);const D=async()=>{var l;j(!0);try{const d=await le.getSettings();M(d.data),I({email_on_scan_complete:d.data.email_on_scan_complete,email_on_critical_vuln:d.data.email_on_critical_vuln,email_address:d.data.email_address||"",slack_webhook_url:d.data.slack_webhook_url||"",teams_webhook_url:d.data.teams_webhook_url||""})}catch(d){((l=d.response)==null?void 0:l.status)!==404&&(t.error("Failed to load notification settings"),console.error(d))}finally{j(!1)}},U=async()=>{try{const l=await le.checkSmtpStatus();L(l.data.configured)}catch(l){console.error("Failed to check SMTP status:",l),L(!1)}},T=async l=>{var d,C;if(l.preventDefault(),(b.email_on_scan_complete||b.email_on_critical_vuln)&&!b.email_address){t.error("Email address is required when notifications are enabled");return}E(!0);try{const f=await le.updateSettings(b);M(f.data),t.success("Notification settings saved")}catch(f){const y=f;t.error(((C=(d=y.response)==null?void 0:d.data)==null?void 0:C.error)||"Failed to save settings")}finally{E(!1)}},o=async()=>{var l,d;if(!b.slack_webhook_url){t.error("Please enter a Slack webhook URL first");return}F(!0);try{b.slack_webhook_url!==(c==null?void 0:c.slack_webhook_url)&&await le.updateSettings({slack_webhook_url:b.slack_webhook_url});const C=await le.testSlack();t.success(C.data.message)}catch(C){const f=C;t.error(((d=(l=f.response)==null?void 0:l.data)==null?void 0:d.error)||"Failed to send test message")}finally{F(!1)}},h=async()=>{var l,d;if(!b.teams_webhook_url){t.error("Please enter a Teams webhook URL first");return}A(!0);try{b.teams_webhook_url!==(c==null?void 0:c.teams_webhook_url)&&await le.updateSettings({teams_webhook_url:b.teams_webhook_url});const C=await le.testTeams();t.success(C.data.message)}catch(C){const f=C;t.error(((d=(l=f.response)==null?void 0:l.data)==null?void 0:d.error)||"Failed to send test message")}finally{A(!1)}},n=async()=>{var l,d;if(!b.email_address){t.error("Please enter an email address first");return}if(!P){t.error("SMTP is not configured on the server. Contact your administrator.");return}_(!0);try{b.email_address!==(c==null?void 0:c.email_address)&&await le.updateSettings({email_address:b.email_address});const C=await le.testEmail();t.success(C.data.message)}catch(C){const f=C;t.error(((d=(l=f.response)==null?void 0:l.data)==null?void 0:d.error)||"Failed to send test email")}finally{_(!1)}};return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(es,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Notification Settings"})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Notification Email Address"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"email",value:b.email_address,onChange:l=>I({...b,email_address:l.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg pl-10 pr-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"your@email.com"})]}),e.jsx(v,{type:"button",variant:"secondary",onClick:n,disabled:!b.email_address||i||!P,title:P?"Send test email":"SMTP not configured on server",children:i?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Test"]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email address where notifications will be sent"}),P!==null&&e.jsx("span",{className:`text-xs flex items-center gap-1 ${P?"text-green-400":"text-amber-400"}`,children:P?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-3 w-3"}),"SMTP configured"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-3 w-3"}),"SMTP not configured"]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Email Notifications"}),e.jsxs("label",{className:"flex items-start gap-4 p-4 bg-dark-bg rounded-lg border border-dark-border cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:b.email_on_scan_complete,onChange:l=>I({...b,email_on_scan_complete:l.target.checked}),className:"mt-1 w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"font-medium text-white",children:"Scan Completion"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Receive an email when any of your scans complete, including a summary of findings"})]})]}),e.jsxs("label",{className:"flex items-start gap-4 p-4 bg-dark-bg rounded-lg border border-dark-border cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:b.email_on_critical_vuln,onChange:l=>I({...b,email_on_critical_vuln:l.target.checked}),className:"mt-1 w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"font-medium text-white",children:"Critical Vulnerabilities"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Get immediate alerts when critical or high severity vulnerabilities are discovered"})]})]})]}),P===!1?e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"h-5 w-5 text-amber-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-200",children:"SMTP is not configured on this server. Email notifications are disabled."}),e.jsx("p",{className:"text-xs text-amber-300/70 mt-1",children:"Contact your administrator to configure SMTP settings (SMTP_HOST, SMTP_USER, etc.)"})]})]})}):e.jsx("div",{className:"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Re,{className:"h-5 w-5 text-blue-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-200",children:P?"Email notifications are ready. Use the Test button to verify delivery.":"Checking SMTP configuration..."}),e.jsx("p",{className:"text-xs text-blue-300/70 mt-1",children:"Contact your administrator if you're not receiving emails."})]})]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-dark-border",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4"}),"Webhook Integrations"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Slack Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:b.slack_webhook_url,onChange:l=>I({...b,slack_webhook_url:l.target.value}),className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"https://hooks.slack.com/services/YOUR/WEBHOOK/URL"}),e.jsx(v,{type:"button",variant:"secondary",onClick:o,disabled:!b.slack_webhook_url||k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Test"]})})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Send scan notifications to a Slack channel. Create a webhook at"," ",e.jsx("a",{href:"https://api.slack.com/messaging/webhooks",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Slack Incoming Webhooks"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Microsoft Teams Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:b.teams_webhook_url,onChange:l=>I({...b,teams_webhook_url:l.target.value}),className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"https://outlook.office.com/webhook/YOUR/WEBHOOK/URL"}),e.jsx(v,{type:"button",variant:"secondary",onClick:h,disabled:!b.teams_webhook_url||x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Test"]})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Send scan notifications to a Teams channel. Create a webhook in your Teams channel connectors."})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{type:"submit",variant:"primary",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Save Settings"]})})})]})]}),c&&e.jsxs(S,{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"Current Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Scan Complete Emails:"}),e.jsx("span",{className:`ml-2 ${c.email_on_scan_complete?"text-green-400":"text-slate-400"}`,children:c.email_on_scan_complete?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Critical Vuln Alerts:"}),e.jsx("span",{className:`ml-2 ${c.email_on_critical_vuln?"text-green-400":"text-slate-400"}`,children:c.email_on_critical_vuln?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-500",children:"Last Updated:"}),e.jsx("span",{className:"ml-2 text-slate-300",children:new Date(c.updated_at).toLocaleString()})]})]})]})]})},Ts=()=>{const[c,M]=a.useState([]),[V,j]=a.useState(!0),[g,E]=a.useState(""),[k,F]=a.useState(""),[x,A]=a.useState(!1),[i,_]=a.useState(null),[P,L]=a.useState(new Set);a.useEffect(()=>{b()},[]);const b=async()=>{j(!0);try{const h=(await Qe.getAll()).data.filter(n=>n.status==="completed");M(h)}catch(o){t.error("Failed to load scans"),console.error(o)}finally{j(!1)}},I=async()=>{var o,h;if(!g||!k){t.error("Please select two scans to compare");return}if(g===k){t.error("Please select two different scans");return}A(!0);try{const n=await is.compare(g,k);_(n.data),t.success("Comparison completed")}catch(n){const l=n;t.error(((h=(o=l.response)==null?void 0:o.data)==null?void 0:h.error)||"Failed to compare scans"),console.error(n)}finally{A(!1)}},D=o=>{const h=new Set(P);h.has(o)?h.delete(o):h.add(o),L(h)},U=o=>{switch(o){case"NewService":return e.jsx(Q,{className:"h-3 w-3 text-green-400"});case"ServiceRemoved":return e.jsx(he,{className:"h-3 w-3 text-red-400"});case"ServiceChanged":case"VersionChanged":return e.jsx(ke,{className:"h-3 w-3 text-yellow-400"});default:return null}},T=o=>{switch(o){case"NewService":return"New Service";case"ServiceRemoved":return"Service Removed";case"ServiceChanged":return"Service Changed";case"VersionChanged":return"Version Changed";default:return o}};return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Le,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Compare Scans"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Select two completed scans to compare their results and identify changes in hosts, ports, services, and vulnerabilities."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Baseline Scan (Older)"}),e.jsxs("select",{value:g,onChange:o=>E(o.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),c.map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",new Date(o.created_at).toLocaleString()]},o.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Comparison Scan (Newer)"}),e.jsxs("select",{value:k,onChange:o=>F(o.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),c.map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",new Date(o.created_at).toLocaleString()]},o.id))]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(v,{variant:"primary",onClick:I,loading:x,disabled:!g||!k||g===k,children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Compare Scans"]})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fs,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Comparison Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Q,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Hosts"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:i.diff.summary.total_new_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(he,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Removed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:i.diff.summary.total_removed_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ke,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Changed"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:i.diff.summary.total_hosts_changed})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ke,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Ports"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:i.diff.summary.total_new_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ke,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Closed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:i.diff.summary.total_closed_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ee,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Vulns"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:i.diff.summary.total_new_vulnerabilities})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(se,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:i.diff.summary.total_resolved_vulnerabilities})]})]})]}),i.diff.new_hosts.length>0&&e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{className:"h-5 w-5 text-green-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["New Hosts (",i.diff.new_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.diff.new_hosts.map(o=>e.jsx("span",{className:"px-3 py-1.5 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 font-mono text-sm",children:o},o))})]}),i.diff.removed_hosts.length>0&&e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{className:"h-5 w-5 text-red-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Removed Hosts (",i.diff.removed_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.diff.removed_hosts.map(o=>e.jsx("span",{className:"px-3 py-1.5 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 font-mono text-sm",children:o},o))})]}),i.diff.host_changes.length>0&&e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ue,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Host Changes (",i.diff.host_changes.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:i.diff.host_changes.map(o=>{const h=P.has(o.ip);return o.new_ports.length>0||o.closed_ports.length>0||o.new_vulnerabilities.length>0||o.resolved_vulnerabilities.length>0||o.service_changes.length>0||o.os_change!==null?e.jsxs("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:[e.jsxs("button",{onClick:()=>D(o.ip),className:"w-full flex items-center justify-between p-4 hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h?e.jsx(_e,{className:"h-4 w-4 text-slate-400"}):e.jsx(Xe,{className:"h-4 w-4 text-slate-400"}),e.jsx(Ue,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-mono text-white",children:o.ip}),o.hostname&&e.jsxs("span",{className:"text-sm text-slate-400",children:["(",o.hostname,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.new_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["+",o.new_ports.length," ports"]}),o.closed_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["-",o.closed_ports.length," ports"]}),o.new_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["+",o.new_vulnerabilities.length," vulns"]}),o.resolved_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["-",o.resolved_vulnerabilities.length," vulns"]})]})]}),h&&e.jsxs("div",{className:"border-t border-dark-border p-4 space-y-4",children:[o.os_change&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-2",children:"Operating System Change"}),e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-sm text-red-400",children:[o.os_change.old_os," (",o.os_change.old_confidence,"% confidence)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-sm text-green-400",children:[o.os_change.new_os," (",o.os_change.new_confidence,"% confidence)"]})]})]})]}),o.new_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-green-400"}),"New Open Ports (",o.new_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:o.new_ports.map(l=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-green-400",children:[l.port,"/",l.protocol]}),l.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[l.service.name,l.service.version&&` ${l.service.version}`]})]},l.port))})]}),o.closed_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-red-400"}),"Closed Ports (",o.closed_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:o.closed_ports.map(l=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-red-400",children:[l.port,"/",l.protocol]}),l.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[l.service.name,l.service.version&&` ${l.service.version}`]})]},l.port))})]}),o.service_changes.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4 text-yellow-400"}),"Service Changes (",o.service_changes.length,")"]}),e.jsx("div",{className:"space-y-2",children:o.service_changes.map((l,d)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-white",children:[l.port,"/",l.protocol]}),e.jsxs("div",{className:"flex items-center gap-2",children:[U(l.change_type),e.jsx("span",{className:"text-xs text-yellow-400",children:T(l.change_type)})]})]}),l.old_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[l.old_service,l.old_version&&` ${l.old_version}`]})]}),l.new_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Q,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-green-400",children:[l.new_service,l.new_version&&` ${l.new_version}`]})]})]},d))})]}),o.new_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-red-400"}),"New Vulnerabilities (",o.new_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:o.new_vulnerabilities.map((l,d)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:l.cve_id||l.title}),e.jsx(Z,{variant:"severity",type:Je(l.severity),children:l.severity})]}),e.jsx("p",{className:"text-xs text-slate-400",children:l.description}),l.affected_service&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Service: ",l.affected_service]})]},d))})]}),o.resolved_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-green-400"}),"Resolved Vulnerabilities (",o.resolved_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:o.resolved_vulnerabilities.map((l,d)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1 opacity-75",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-green-400 line-through",children:l.cve_id||l.title}),e.jsx(Z,{variant:"severity",type:Je(l.severity),children:l.severity})]}),e.jsx("p",{className:"text-xs text-slate-500",children:l.description})]},d))})]})]})]},o.ip):null})})]}),i.diff.new_hosts.length===0&&i.diff.removed_hosts.length===0&&i.diff.host_changes.length===0&&e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-white font-medium mb-2",children:"No Changes Detected"}),e.jsx("p",{className:"text-sm text-slate-400",children:"The selected scans have identical results"})]})})]}),!i&&c.length===0&&e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No completed scans available"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Complete at least two scans to use the comparison feature"})]})})]})},Ds=()=>{const[c,M]=a.useState([]),[V,j]=a.useState(!0),[g,E]=a.useState(!1),[k,F]=a.useState(null),[x,A]=a.useState({name:"",description:""}),[i,_]=a.useState(new Set),[P,L]=a.useState(null),[b,I]=a.useState(!1),{addScan:D}=cs();a.useEffect(()=>{U()},[]);const U=async()=>{j(!0);try{const f=await ve.getAll();M(f.data)}catch(f){t.error("Failed to load templates"),console.error(f)}finally{j(!1)}},T=()=>{A({name:"",description:""}),F(null),E(!1)},o=f=>{A({name:f.name,description:f.description||""}),F(f.id),E(!0)},h=async f=>{var y,p;if(f.preventDefault(),!x.name.trim()){t.error("Name is required");return}if(!k){t.error('Cannot create templates from this form. Use "Save as Template" in the scan form.');return}try{await ve.update(k,{name:x.name,description:x.description||void 0}),t.success("Template updated"),T(),U()}catch(m){const r=m;t.error(((p=(y=r.response)==null?void 0:y.data)==null?void 0:p.error)||"Failed to update template")}},n=async()=>{var f,y;if(P){I(!0);try{await ve.delete(P.id),t.success(`Template "${P.name}" deleted`),U(),L(null)}catch(p){const m=p;t.error(((y=(f=m.response)==null?void 0:f.data)==null?void 0:y.error)||"Failed to delete")}finally{I(!1)}}},l=async(f,y)=>{var m,r;const p=prompt(`Enter name for new scan (based on "${y}"):`,`${y} - ${new Date().toLocaleDateString()}`);if(p){_(new Set([...i,f]));try{const u=await ve.createScan(f,p);D(u.data),t.success("Scan started from template!")}catch(u){const N=u;t.error(((r=(m=N.response)==null?void 0:m.data)==null?void 0:r.error)||"Failed to create scan")}finally{_(u=>{const N=new Set(u);return N.delete(f),N})}}},d=f=>{try{return JSON.parse(f)}catch{return null}},C=f=>new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scan Templates"})]}),e.jsx("div",{className:"text-sm text-slate-400",children:"Save scan configurations for quick reuse"})]})}),g&&e.jsx(S,{children:e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Edit Template"}),e.jsx("button",{type:"button",onClick:T,className:"text-slate-400 hover:text-white",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:x.name,onChange:f=>A({...x,name:f.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Production Network Template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:x.description,onChange:f=>A({...x,description:f.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",rows:3,placeholder:"Optional description"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:T,children:"Cancel"}),e.jsxs(v,{type:"submit",variant:"primary",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Update"]})]})]})}),c.length===0&&!g?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No scan templates yet"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:'Save scan configurations using "Save as Template" when creating a scan'})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:c.map(f=>{const y=d(f.config),p=i.has(f.id);return e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white text-lg",children:f.name}),f.description&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:f.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>o(f),className:"p-1.5 text-slate-400 hover:text-primary transition-colors",title:"Edit template",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(f),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors",title:"Delete template","aria-label":`Delete template ${f.name}`,children:e.jsx(ie,{className:"h-4 w-4"})})]})]}),y&&e.jsxs("div",{className:"space-y-2 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-slate-500"}),e.jsxs("span",{className:"text-slate-400",children:[y.targets.length," target",y.targets.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4 text-slate-500"}),e.jsxs("span",{className:"text-slate-400",children:["Ports: ",y.port_range[0],"-",y.port_range[1]]})]}),y.scan_type&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4 text-slate-500"}),e.jsx("span",{className:"text-slate-400 capitalize",children:y.scan_type.replace("_"," ")})]}),y.enable_enumeration&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-slate-500"}),e.jsxs("span",{className:"text-slate-400",children:["Enumeration: ",y.enum_depth||"light"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[y.enable_os_detection&&e.jsx(Z,{variant:"status",type:"completed",children:"OS Detection"}),y.enable_service_detection&&e.jsx(Z,{variant:"status",type:"completed",children:"Services"}),y.enable_vuln_scan&&e.jsx(Z,{variant:"status",type:"running",children:"Vuln Scan"}),y.enable_enumeration&&e.jsx(Z,{variant:"status",type:"pending",children:"Enumeration"})]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-dark-border pt-4",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["Created ",C(f.created_at)]}),e.jsxs(v,{variant:"primary",size:"sm",onClick:()=>l(f.id,f.name),loading:p,disabled:p,children:[e.jsx(vs,{className:"h-4 w-4 mr-1.5"}),"Create Scan"]})]})]})},f.id)})}),e.jsx(de,{isOpen:!!P,onClose:()=>L(null),onConfirm:n,title:"Delete Template",message:`Are you sure you want to delete the template "${P==null?void 0:P.name}"? This will not affect any scans previously created from this template.`,confirmLabel:"Delete Template",variant:"danger",loading:b})]})},Ye=["critical","high","medium","low","info"],Rs=["web","network","infrastructure","cloud","api","mobile","other"],Ls=()=>{var ae,J,W;const[c,M]=a.useState([]),[V,j]=a.useState([]),[g,E]=a.useState(!0),[k,F]=a.useState(!1),[x,A]=a.useState(null),[i,_]=a.useState(null),[P,L]=a.useState(!1),[b,I]=a.useState(!1),[D,U]=a.useState(null),[T,o]=a.useState(""),[h,n]=a.useState(""),[l,d]=a.useState(""),[C,f]=a.useState(!0),[y,p]=a.useState({category:"web",title:"",severity:"medium",description:"",impact:"",remediation:"",references:[],cwe_ids:[],cvss_vector:"",cvss_score:void 0,tags:[]});a.useEffect(()=>{m(),r()},[h,l,T,C]);const m=async()=>{E(!0);try{const s=await me.list({category:h||void 0,severity:l||void 0,search:T||void 0,include_system:C});M(s.data)}catch(s){t.error("Failed to load finding templates"),console.error(s)}finally{E(!1)}},r=async()=>{try{const s=await me.getCategories();j(s.data)}catch(s){console.error("Failed to load categories:",s)}},u=()=>{p({category:"web",title:"",severity:"medium",description:"",impact:"",remediation:"",references:[],cwe_ids:[],cvss_vector:"",cvss_score:void 0,tags:[]}),A(null),F(!1)},N=s=>{p({category:s.category,title:s.title,severity:s.severity,description:s.description,impact:s.impact||"",remediation:s.remediation||"",references:s.references?JSON.parse(s.references):[],cwe_ids:s.cwe_ids?JSON.parse(s.cwe_ids):[],cvss_vector:s.cvss_vector||"",cvss_score:s.cvss_score||void 0,tags:s.tags?JSON.parse(s.tags):[]}),A(s),F(!0)},H=async s=>{var q,re;const $=prompt("Enter name for cloned template:",`${s.title} (Copy)`);if($)try{await me.clone(s.id,{new_title:$}),t.success("Template cloned successfully"),m(),r()}catch(xe){const X=xe;t.error(((re=(q=X.response)==null?void 0:q.data)==null?void 0:re.error)||"Failed to clone template")}},Y=async s=>{var $,q;if(s.preventDefault(),!y.title.trim()){t.error("Title is required");return}if(!y.description.trim()){t.error("Description is required");return}I(!0);try{x?(await me.update(x.id,y),t.success("Template updated successfully")):(await me.create(y),t.success("Template created successfully")),u(),m(),r()}catch(re){const xe=re;t.error(((q=($=xe.response)==null?void 0:$.data)==null?void 0:q.error)||"Failed to save template")}finally{I(!1)}},w=async()=>{var s,$;if(i){L(!0);try{await me.delete(i.id),t.success(`Template "${i.title}" deleted`),m(),r(),_(null)}catch(q){const re=q;t.error((($=(s=re.response)==null?void 0:s.data)==null?void 0:$.error)||"Failed to delete template")}finally{L(!1)}}},R=s=>{switch(s.toLowerCase()){case"critical":case"high":return e.jsx(ee,{className:"h-4 w-4"});case"medium":return e.jsx(te,{className:"h-4 w-4"});default:return e.jsx(ws,{className:"h-4 w-4"})}},K=s=>{const $=s.toLowerCase();return $==="critical"?"critical":$==="high"?"high":$==="medium"?"medium":"low"},O=s=>{if(!s)return[];try{return JSON.parse(s)}catch{return[]}},G=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return g&&c.length===0?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Finding Templates"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:[c.length," template",c.length!==1?"s":""]}),e.jsxs(v,{variant:"primary",size:"sm",onClick:()=>F(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-1.5"}),"New Template"]})]})]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ss,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",value:T,onChange:s=>o(s.target.value),placeholder:"Search templates...",className:"w-full bg-dark-bg border border-dark-border rounded-lg pl-10 pr-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(Ns,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsxs("select",{value:h,onChange:s=>n(s.target.value),className:"bg-dark-bg border border-dark-border rounded-lg pl-10 pr-8 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"All Categories"}),V.map(s=>e.jsxs("option",{value:s.category,children:[s.category.charAt(0).toUpperCase()+s.category.slice(1)," (",s.count,")"]},s.category))]}),e.jsx(_e,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l,onChange:s=>d(s.target.value),className:"bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent appearance-none cursor-pointer pr-8",children:[e.jsx("option",{value:"",children:"All Severities"}),Ye.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]}),e.jsx(_e,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>f(s.target.checked),className:"rounded border-dark-border bg-dark-bg text-primary focus:ring-primary"}),"Include system templates"]})]})}),k&&e.jsx(S,{children:e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:x?"Edit Template":"New Template"}),e.jsx("button",{type:"button",onClick:u,className:"text-slate-400 hover:text-white",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Category"}),e.jsx("select",{value:y.category,onChange:s=>p({...y,category:s.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:Rs.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Severity"}),e.jsx("select",{value:y.severity,onChange:s=>p({...y,severity:s.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:Ye.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"CVSS Score"}),e.jsx("input",{type:"number",step:"0.1",min:"0",max:"10",value:y.cvss_score||"",onChange:s=>p({...y,cvss_score:s.target.value?parseFloat(s.target.value):void 0}),placeholder:"0.0 - 10.0",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:y.title,onChange:s=>p({...y,title:s.target.value}),placeholder:"e.g., SQL Injection in Login Form",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description *"}),e.jsx("textarea",{value:y.description,onChange:s=>p({...y,description:s.target.value}),rows:4,placeholder:"Detailed description of the vulnerability...",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Impact"}),e.jsx("textarea",{value:y.impact||"",onChange:s=>p({...y,impact:s.target.value}),rows:2,placeholder:"Potential impact if exploited...",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Remediation"}),e.jsx("textarea",{value:y.remediation||"",onChange:s=>p({...y,remediation:s.target.value}),rows:3,placeholder:"Recommended steps to fix...",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"CVSS Vector"}),e.jsx("input",{type:"text",value:y.cvss_vector||"",onChange:s=>p({...y,cvss_vector:s.target.value}),placeholder:"CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"CWE IDs (comma-separated)"}),e.jsx("input",{type:"text",value:((ae=y.cwe_ids)==null?void 0:ae.join(", "))||"",onChange:s=>{const $=s.target.value.split(",").map(q=>parseInt(q.trim())).filter(q=>!isNaN(q));p({...y,cwe_ids:$})},placeholder:"e.g., 89, 564",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"References (one URL per line)"}),e.jsx("textarea",{value:((J=y.references)==null?void 0:J.join(`
`))||"",onChange:s=>{const $=s.target.value.split(`
`).map(q=>q.trim()).filter(q=>q);p({...y,references:$})},rows:2,placeholder:"https://owasp.org/...",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:((W=y.tags)==null?void 0:W.join(", "))||"",onChange:s=>{const $=s.target.value.split(",").map(q=>q.trim()).filter(q=>q);p({...y,tags:$})},placeholder:"e.g., owasp, web, injection",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:u,children:"Cancel"}),e.jsxs(v,{type:"submit",variant:"primary",loading:b,disabled:b,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),x?"Update":"Create"]})]})]})}),c.length===0&&!k?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No finding templates found"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:h||l||T?"Try adjusting your filters":"Create your first template or include system templates"})]})}):e.jsx("div",{className:"space-y-3",children:c.map(s=>{const $=D===s.id,q=O(s.references),re=O(s.cwe_ids),xe=O(s.tags);return e.jsx(S,{className:$?"ring-1 ring-primary":"",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>U($?null:s.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Z,{variant:"severity",type:K(s.severity),children:[R(s.severity),e.jsx("span",{className:"ml-1",children:s.severity})]}),e.jsx(Z,{variant:"status",type:"pending",children:s.category}),s.is_system&&e.jsx(Z,{variant:"status",type:"completed",children:"System"})]}),e.jsx("h4",{className:"font-semibold text-white text-lg mt-2",children:s.title}),!$&&e.jsx("p",{className:"text-sm text-slate-400 mt-1 line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx("button",{onClick:()=>H(s),className:"p-1.5 text-slate-400 hover:text-primary transition-colors",title:"Clone template",children:e.jsx(Ce,{className:"h-4 w-4"})}),!s.is_system&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(s),className:"p-1.5 text-slate-400 hover:text-primary transition-colors",title:"Edit template",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(s),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors",title:"Delete template",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})]}),$&&e.jsxs("div",{className:"border-t border-dark-border pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-slate-400 whitespace-pre-wrap",children:s.description})]}),s.impact&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-1",children:"Impact"}),e.jsx("p",{className:"text-sm text-slate-400 whitespace-pre-wrap",children:s.impact})]}),s.remediation&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-1",children:"Remediation"}),e.jsx("p",{className:"text-sm text-slate-400 whitespace-pre-wrap",children:s.remediation})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[s.cvss_score!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"CVSS:"})," ",e.jsx("span",{className:"text-white font-medium",children:s.cvss_score.toFixed(1)})]}),s.cvss_vector&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Vector:"})," ",e.jsx("code",{className:"text-slate-300 text-xs",children:s.cvss_vector})]}),re.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"CWE:"})," ",re.map((X,Ae)=>e.jsxs("span",{children:[Ae>0&&", ",e.jsxs("a",{href:`https://cwe.mitre.org/data/definitions/${X}.html`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:["CWE-",X]})]},X))]})]}),q.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-2",children:"References"}),e.jsx("div",{className:"space-y-1",children:q.map((X,Ae)=>e.jsxs("a",{href:X,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(Oe,{className:"h-3 w-3"}),X]},Ae))})]}),xe.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:xe.map(X=>e.jsx("span",{className:"px-2 py-0.5 bg-dark-border rounded text-xs text-slate-300",children:X},X))}),e.jsxs("div",{className:"text-xs text-slate-500 pt-2 border-t border-dark-border",children:["Created ",G(s.created_at),s.updated_at!==s.created_at&&e.jsxs(e.Fragment,{children:["  Updated ",G(s.updated_at)]})]})]})]})},s.id)})}),e.jsx(de,{isOpen:!!i,onClose:()=>_(null),onConfirm:w,title:"Delete Template",message:`Are you sure you want to delete the template "${i==null?void 0:i.title}"? This action cannot be undone.`,confirmLabel:"Delete Template",variant:"danger",loading:P})]})},Us=()=>{const[c,M]=a.useState(!1),[V,j]=a.useState(!0),[g,E]=a.useState("idle"),[k,F]=a.useState(""),[x,A]=a.useState(""),[i,_]=a.useState([]),[P,L]=a.useState(""),[b,I]=a.useState(!1),[D,U]=a.useState(!1),[T,o]=a.useState(""),[h,n]=a.useState(""),[l,d]=a.useState(!1),[C,f]=a.useState(!1),[y,p]=a.useState(""),[m,r]=a.useState(""),[u,N]=a.useState(!1);a.useEffect(()=>{H()},[]);const H=async()=>{j(!0);try{const J=await we.me();M(J.data.mfa_enabled||!1)}catch(J){console.error("Failed to check MFA status:",J)}finally{j(!1)}},Y=async()=>{var J,W;try{const s=await Ne.setup();F(s.data.secret),A(s.data.qr_code_url),_(s.data.recovery_codes),E("scan-qr")}catch(s){const $=s;t.error(((W=(J=$.response)==null?void 0:J.data)==null?void 0:W.error)||"Failed to initialize MFA setup")}},w=async J=>{var W,s;if(J.preventDefault(),!P||P.length!==6){t.error("Please enter a valid 6-digit code");return}I(!0);try{await Ne.verifySetup({totp_code:P}),t.success("MFA enabled successfully!"),E("show-recovery"),M(!0)}catch($){const q=$;t.error(((s=(W=q.response)==null?void 0:W.data)==null?void 0:s.error)||"Invalid verification code")}finally{I(!1)}},R=()=>{E("idle"),F(""),A(""),_([]),L("")},K=async J=>{var W,s;if(J.preventDefault(),!T||!h){t.error("Password and TOTP code are required");return}d(!0);try{await Ne.disable({password:T,totp_code:h}),t.success("MFA disabled successfully"),M(!1),U(!1),o(""),n("")}catch($){const q=$;t.error(((s=(W=q.response)==null?void 0:W.data)==null?void 0:s.error)||"Failed to disable MFA")}finally{d(!1)}},O=async J=>{var W,s;if(J.preventDefault(),!y||!m){t.error("Password and TOTP code are required");return}N(!0);try{const $=await Ne.regenerateRecoveryCodes({password:y,totp_code:m});_($.data.recovery_codes),t.success("Recovery codes regenerated successfully"),f(!1),p(""),r(""),E("show-recovery")}catch($){const q=$;t.error(((s=(W=q.response)==null?void 0:W.data)==null?void 0:s.error)||"Failed to regenerate recovery codes")}finally{N(!1)}},G=J=>{navigator.clipboard.writeText(J),t.success("Copied to clipboard")},ae=()=>{const J=new Blob([i.join(`
`)],{type:"text/plain"}),W=URL.createObjectURL(J),s=document.createElement("a");s.href=W,s.download="heroforge-recovery-codes.txt",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(W),t.success("Recovery codes downloaded")};return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):g!=="idle"?e.jsx("div",{className:"space-y-6",children:e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Enable Two-Factor Authentication"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("span",{className:g==="scan-qr"?"text-primary":"",children:"1. Scan QR"}),e.jsx("span",{children:""}),e.jsx("span",{className:g==="verify-code"?"text-primary":"",children:"2. Verify"}),e.jsx("span",{children:""}),e.jsx("span",{className:g==="show-recovery"?"text-primary":"",children:"3. Save Codes"})]})]}),g==="scan-qr"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-dark-bg rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Step 1: Scan QR Code"}),e.jsx("p",{className:"text-slate-400 text-sm text-center mb-6 max-w-md",children:"Use an authenticator app like Google Authenticator, Authy, or 1Password to scan this QR code:"}),x&&e.jsx("div",{className:"bg-white p-4 rounded-lg mb-4",children:e.jsx("img",{src:x,alt:"MFA QR Code",className:"w-64 h-64"})}),e.jsxs("div",{className:"mt-4 w-full max-w-md",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Or enter this secret manually:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{type:"text",value:k,readOnly:!0,className:"font-mono text-sm flex-1"}),e.jsx(v,{variant:"secondary",onClick:()=>G(k),children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{variant:"primary",onClick:()=>E("verify-code"),children:"Next: Verify Code"})})]}),g==="verify-code"&&e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsx("div",{className:"bg-dark-bg rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(qe,{className:"h-12 w-12 text-primary mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Step 2: Verify Your Code"}),e.jsx("p",{className:"text-slate-400 text-sm text-center mb-6 max-w-md",children:"Enter the 6-digit code from your authenticator app to confirm setup:"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx(B,{type:"text",value:P,onChange:J=>L(J.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center text-2xl tracking-widest font-mono",maxLength:6,autoFocus:!0})})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:()=>E("scan-qr"),children:"Back"}),e.jsx(v,{type:"submit",variant:"primary",loading:b,disabled:b||P.length!==6,children:"Verify & Enable MFA"})]})]}),g==="show-recovery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"h-6 w-6 text-yellow-400 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-yellow-400 mb-2",children:"Save Your Recovery Codes"}),e.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Store these recovery codes in a safe place. Each code can be used once to access your account if you lose your authenticator device."}),e.jsx("div",{className:"grid grid-cols-2 gap-2 bg-dark-bg rounded-lg p-4 font-mono text-sm mb-4",children:i.map((J,W)=>e.jsxs("div",{className:"text-white",children:[W+1,". ",J]},W))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"secondary",onClick:()=>G(i.join(`
`)),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Copy Codes"]}),e.jsxs(v,{variant:"secondary",onClick:ae,children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Download Codes"]})]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(v,{variant:"primary",onClick:R,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Finish Setup"]})})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(te,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Two-Factor Authentication"})]}),e.jsxs("div",{className:"flex items-start justify-between mb-6 p-4 bg-dark-bg rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[c?e.jsx(se,{className:"h-6 w-6 text-green-400 flex-shrink-0"}):e.jsx(ee,{className:"h-6 w-6 text-yellow-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:c?"MFA Enabled":"MFA Disabled"}),e.jsx("p",{className:"text-sm text-slate-400",children:c?"Your account is protected with two-factor authentication.":"Enable MFA to add an extra layer of security to your account."})]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${c?"bg-green-400":"bg-yellow-400"}`})]}),c?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-primary"}),e.jsx("h5",{className:"font-medium text-white",children:"Recovery Codes"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Generate new recovery codes if you've lost the originals or used them."}),e.jsx(v,{variant:"secondary",size:"sm",onClick:()=>f(!0),children:"Regenerate Codes"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-red-400"}),e.jsx("h5",{className:"font-medium text-white",children:"Disable MFA"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Turn off two-factor authentication for your account."}),e.jsx(v,{variant:"danger",size:"sm",onClick:()=>U(!0),children:"Disable MFA"})]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[e.jsx("h5",{className:"text-white font-medium mb-2",children:"Why enable MFA?"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Adds an extra layer of security beyond your password"}),e.jsx("li",{children:"Prevents unauthorized access even if your password is compromised"}),e.jsx("li",{children:"Uses time-based codes from your smartphone"}),e.jsx("li",{children:"Industry standard for securing sensitive accounts"})]})]}),e.jsxs(v,{variant:"primary",onClick:Y,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Enable Two-Factor Authentication"]})]})]}),D&&e.jsx(S,{children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Disable Two-Factor Authentication"}),e.jsxs("button",{type:"button",onClick:()=>{U(!1),o(""),n("")},className:"text-slate-400 hover:text-white",children:[e.jsx("span",{className:"sr-only",children:"Close"}),""]})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-300",children:"Disabling MFA will make your account less secure. You'll need to provide your password and a TOTP code to confirm."})}),e.jsx(B,{label:"Password",type:"password",value:T,onChange:J=>o(J.target.value),placeholder:"Your account password",autoComplete:"current-password"}),e.jsx(B,{label:"TOTP Code",type:"text",value:h,onChange:J=>n(J.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center tracking-widest font-mono",maxLength:6}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:()=>{U(!1),o(""),n("")},children:"Cancel"}),e.jsx(v,{type:"submit",variant:"danger",loading:l,disabled:l||!T||h.length!==6,children:"Disable MFA"})]})]})}),C&&e.jsx(S,{children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Regenerate Recovery Codes"}),e.jsxs("button",{type:"button",onClick:()=>{f(!1),p(""),r("")},className:"text-slate-400 hover:text-white",children:[e.jsx("span",{className:"sr-only",children:"Close"}),""]})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-300",children:"This will invalidate all existing recovery codes. Make sure to save the new codes in a safe place."})}),e.jsx(B,{label:"Password",type:"password",value:y,onChange:J=>p(J.target.value),placeholder:"Your account password",autoComplete:"current-password"}),e.jsx(B,{label:"TOTP Code",type:"text",value:m,onChange:J=>r(J.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center tracking-widest font-mono",maxLength:6}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:()=>{f(!1),p(""),r("")},children:"Cancel"}),e.jsx(v,{type:"submit",variant:"primary",loading:u,disabled:u||!y||m.length!==6,children:"Generate New Codes"})]})]})})]})},Ms=()=>{const[c,M]=a.useState([]),[V,j]=a.useState(!0),[g,E]=a.useState(!1),[k,F]=a.useState(""),[x,A]=a.useState(!1),[i,_]=a.useState(null),[P,L]=a.useState(null),[b,I]=a.useState(!1);a.useEffect(()=>{D()},[]);const D=async()=>{j(!0);try{const n=await Ie.getAll();M(n.data)}catch(n){t.error("Failed to load API keys"),console.error(n)}finally{j(!1)}},U=async()=>{var n,l;if(!k.trim()){t.error("Please enter a name for the API key");return}A(!0);try{const d=await Ie.create({name:k.trim()});_(d.data),F(""),await D(),t.success("API key created successfully")}catch(d){const C=d;t.error(((l=(n=C.response)==null?void 0:n.data)==null?void 0:l.error)||"Failed to create API key")}finally{A(!1)}},T=async()=>{var n,l;if(P){I(!0);try{await Ie.delete(P.id),await D(),t.success(`API key "${P.name}" revoked successfully`),L(null)}catch(d){const C=d;t.error(((l=(n=C.response)==null?void 0:n.data)==null?void 0:l.error)||"Failed to revoke API key")}finally{I(!1)}}},o=n=>{navigator.clipboard.writeText(n),t.success("API key copied to clipboard")},h=()=>{_(null),E(!1)};return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"API Keys"})]}),e.jsxs(v,{variant:"primary",onClick:()=>E(!0),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Create API Key"]})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"API keys allow programmatic access to HeroForge. Keep your keys secure and never share them publicly."}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"h-12 w-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No API keys yet"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-3",children:c.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-white",children:n.name}),e.jsxs("code",{className:"px-2 py-1 bg-dark-surface rounded text-xs text-slate-400 font-mono",children:[n.prefix,"..."]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-3 w-3"}),"Created ",new Date(n.created_at).toLocaleDateString()]}),n.last_used_at&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),"Last used ",new Date(n.last_used_at).toLocaleDateString()]}),!n.last_used_at&&e.jsx("span",{className:"text-amber-500",children:"Never used"})]})]}),e.jsxs(v,{variant:"danger",size:"sm",onClick:()=>L(n),className:"flex items-center gap-2","aria-label":`Revoke API key ${n.name}`,children:[e.jsx(ie,{className:"h-4 w-4"}),"Revoke"]})]},n.id))})]}),g&&!i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Create API Key"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:k,onChange:n=>F(n.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",autoFocus:!0}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Give your API key a descriptive name to remember where it's used"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(v,{variant:"secondary",onClick:()=>{E(!1),F("")},children:"Cancel"}),e.jsx(v,{variant:"primary",onClick:U,disabled:x||!k.trim(),children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Creating..."})]}):"Create Key"})]})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-6 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(se,{className:"h-6 w-6 text-green-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"API Key Created Successfully"})]}),e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-amber-200 font-medium mb-2",children:"Important: Save your API key now!"}),e.jsx("p",{className:"text-xs text-amber-300/70",children:"This is the only time you'll see the full key. If you lose it, you'll need to create a new one."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-3 text-white font-mono text-sm break-all",children:i.key}),e.jsxs(v,{variant:"secondary",onClick:()=>o(i.key),className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Copy"]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-200 mb-2",children:"Using your API key"}),e.jsx("p",{className:"text-xs text-blue-300/70 mb-3",children:"Include your API key in the X-API-Key header:"}),e.jsxs("code",{className:"block bg-dark-bg border border-dark-border rounded px-3 py-2 text-xs text-slate-300 font-mono",children:['curl -H "X-API-Key: ',i.key,'" https://heroforge.example.com/api/scans']})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(v,{variant:"primary",onClick:h,children:"Done"})})]})]})}),e.jsx(de,{isOpen:!!P,onClose:()=>L(null),onConfirm:T,title:"Revoke API Key",message:`Are you sure you want to revoke the API key "${P==null?void 0:P.name}"? Any applications using this key will lose access immediately.`,confirmLabel:"Revoke Key",variant:"danger",loading:b})]})},Vs=()=>{const[c,M]=a.useState(!0),[V,j]=a.useState(!1),[g,E]=a.useState(!1),[k,F]=a.useState(!1),[x,A]=a.useState({jira_url:"",username:"",api_token:"",project_key:"",issue_type:"Task",default_assignee:"",enabled:!0}),[i,_]=a.useState([]),[P,L]=a.useState([]),[b,I]=a.useState(!1);a.useEffect(()=>{D()},[]);const D=async()=>{var n;M(!0);try{const l=await fe.getSettings();A(l.data),F(!0)}catch(l){((n=l.response)==null?void 0:n.status)===404?F(!1):console.error("Failed to load JIRA settings:",l)}finally{M(!1)}},U=async()=>{var n,l;if(!x.jira_url||!x.username||!x.api_token||!x.project_key){t.error("Please fill in all required fields");return}j(!0);try{await fe.updateSettings(x),t.success("JIRA settings saved successfully"),F(!0)}catch(d){const C=d;console.error("Failed to save JIRA settings:",d),t.error(((l=(n=C.response)==null?void 0:n.data)==null?void 0:l.error)||"Failed to save JIRA settings")}finally{j(!1)}},T=async()=>{var n,l;if(!k){t.error("Please save your settings first");return}E(!0);try{await fe.testConnection(),t.success("JIRA connection successful!")}catch(d){const C=d;console.error("JIRA connection failed:",d),t.error(((l=(n=C.response)==null?void 0:n.data)==null?void 0:l.error)||"JIRA connection failed")}finally{E(!1)}},o=async()=>{var n,l;if(!k){t.error("Please save your settings first");return}I(!0);try{const d=await fe.listProjects();_(d.data),t.success(`Loaded ${d.data.length} projects`)}catch(d){const C=d;console.error("Failed to load projects:",d),t.error(((l=(n=C.response)==null?void 0:n.data)==null?void 0:l.error)||"Failed to load projects")}finally{I(!1)}},h=async()=>{var n,l;if(!k||!x.project_key){t.error("Please save your settings and select a project first");return}I(!0);try{const d=await fe.listIssueTypes();L(d.data),t.success(`Loaded ${d.data.length} issue types`)}catch(d){const C=d;console.error("Failed to load issue types:",d),t.error(((l=(n=C.response)==null?void 0:n.data)==null?void 0:l.error)||"Failed to load issue types")}finally{I(!1)}};return c?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(as,{className:"h-6 w-6 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"JIRA Integration"})]}),e.jsxs("div",{className:"space-y-4",children:[!k&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(ee,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"JIRA Integration Not Configured"}),e.jsx("p",{children:"Configure your JIRA instance to automatically create tickets from vulnerabilities."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["JIRA URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{type:"url",placeholder:"https://your-domain.atlassian.net",value:x.jira_url,onChange:n=>A({...x,jira_url:n.target.value})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Your JIRA instance URL (e.g., https://company.atlassian.net)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Username/Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{type:"text",placeholder:"user@example.com",value:x.username,onChange:n=>A({...x,username:n.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["API Token ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{type:"password",placeholder:"Your JIRA API token",value:x.api_token,onChange:n=>A({...x,api_token:n.target.value})}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Generate an API token at"," ",e.jsxs("a",{href:"https://id.atlassian.com/manage-profile/security/api-tokens",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 inline-flex items-center gap-1",children:["Atlassian Account Settings ",e.jsx(Oe,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Project Key ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:i.length>0?e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:x.project_key,onChange:n=>A({...x,project_key:n.target.value}),children:[e.jsx("option",{value:"",children:"Select a project"}),i.map(n=>e.jsxs("option",{value:n.key,children:[n.name," (",n.key,")"]},n.key))]}):e.jsx(B,{type:"text",placeholder:"PROJECT",value:x.project_key,onChange:n=>A({...x,project_key:n.target.value})})}),e.jsx(v,{onClick:o,disabled:!k||b,variant:"secondary",children:b?"Loading...":"Load Projects"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Issue Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:P.length>0?e.jsx("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:x.issue_type,onChange:n=>A({...x,issue_type:n.target.value}),children:P.map(n=>e.jsx("option",{value:n.name,children:n.name},n.id))}):e.jsx(B,{type:"text",placeholder:"Task",value:x.issue_type,onChange:n=>A({...x,issue_type:n.target.value})})}),e.jsx(v,{onClick:h,disabled:!k||!x.project_key||b,variant:"secondary",children:b?"Loading...":"Load Types"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Assignee (optional)"}),e.jsx(B,{type:"text",placeholder:"username",value:x.default_assignee||"",onChange:n=>A({...x,default_assignee:n.target.value})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty for unassigned or enter a JIRA username"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"jira-enabled",checked:x.enabled,onChange:n=>A({...x,enabled:n.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"jira-enabled",className:"text-sm font-medium text-gray-700",children:"Enable JIRA integration"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(v,{onClick:U,disabled:V,children:V?"Saving...":"Save Settings"}),e.jsx(v,{onClick:T,disabled:!k||g,variant:"secondary",children:g?"Testing...":"Test Connection"})]}),k&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(se,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"JIRA Integration Configured"}),e.jsx("p",{children:"You can now create JIRA tickets from vulnerabilities."})]})]})]})]}),e.jsxs(S,{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"How to Use JIRA Integration"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"1"})}),e.jsx("p",{children:"Configure your JIRA instance settings above and test the connection."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"2"})}),e.jsx("p",{children:"Navigate to any vulnerability in your scans."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"3"})}),e.jsx("p",{children:'Click the "Create JIRA Ticket" button to automatically create an issue with vulnerability details.'})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"4"})}),e.jsx("p",{children:"The vulnerability will be linked to the JIRA ticket, and you can track it in your JIRA project."})]})]})]})]})},$s=()=>{const[c,M]=a.useState([]),[V,j]=a.useState(!0),[g,E]=a.useState(!1),[k,F]=a.useState(null),[x,A]=a.useState(null),[i,_]=a.useState(null),[P,L]=a.useState(!1),[b,I]=a.useState([]),[D,U]=a.useState(!1),[T,o]=a.useState(""),[h,n]=a.useState(!1);a.useEffect(()=>{l(),f()},[]);const l=async()=>{j(!0);try{const p=await ue.getSettings();M(p.data)}catch(p){t.error("Failed to load SIEM settings"),console.error(p)}finally{j(!1)}},d=async p=>{var m,r;A(p);try{const u=await ue.testConnection(p);u.data.success?t.success("Connection test successful!"):t.error(`Connection test failed: ${u.data.message}`)}catch(u){const N=u;t.error(((r=(m=N.response)==null?void 0:m.data)==null?void 0:r.error)||"Connection test failed")}finally{A(null)}},C=async()=>{var p,m;if(i){L(!0);try{await ue.deleteSettings(i.id),t.success(`${i.siem_type.toUpperCase()} integration deleted`),l(),_(null)}catch(r){const u=r;t.error(((m=(p=u.response)==null?void 0:p.data)==null?void 0:m.error)||"Failed to delete SIEM integration")}finally{L(!1)}}},f=async()=>{U(!0);try{const p=await Qe.getAll();I(p.data.filter(m=>m.status==="completed"))}catch(p){console.error("Failed to load scans:",p)}finally{U(!1)}},y=async()=>{var m,r;if(!T){t.error("Please select a scan to export");return}if(c.filter(u=>u.enabled).length===0){t.error("No enabled SIEM integrations found. Please enable at least one integration.");return}n(!0);try{const u=await ue.exportScan(T);u.data.success?(t.success(`Scan exported to ${u.data.exported_to} SIEM integration(s). ${u.data.events_count} events sent.`),u.data.errors&&u.data.errors.length>0&&u.data.errors.forEach(N=>t.warning(N))):t.error("Export failed. Check SIEM configuration.")}catch(u){const N=u;t.error(((r=(m=N.response)==null?void 0:m.data)==null?void 0:r.error)||"Failed to export scan to SIEM")}finally{n(!1)}};return V?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"SIEM Integrations"})]}),e.jsxs(v,{variant:"primary",onClick:()=>E(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Integration"]})]}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ue,{className:"h-12 w-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"No SIEM integrations configured"}),e.jsxs(v,{variant:"primary",onClick:()=>E(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Your First Integration"]})]}):e.jsx("div",{className:"space-y-4",children:c.map(p=>e.jsx("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/20 text-primary rounded-md text-sm font-medium uppercase",children:p.siem_type}),p.enabled?e.jsxs("span",{className:"flex items-center gap-1 text-green-400 text-sm",children:[e.jsx(se,{className:"h-4 w-4"}),"Enabled"]}):e.jsxs("span",{className:"flex items-center gap-1 text-slate-500 text-sm",children:[e.jsx(ze,{className:"h-4 w-4"}),"Disabled"]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-500",children:"Endpoint:"}),e.jsx("span",{className:"text-white font-mono",children:p.endpoint_url})]}),p.protocol&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-500",children:"Protocol:"}),e.jsx("span",{className:"text-white uppercase",children:p.protocol})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p.export_on_scan_complete,disabled:!0,className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary"}),e.jsx("span",{className:"text-slate-400",children:"Export on scan complete"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p.export_on_critical_vuln,disabled:!0,className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary"}),e.jsx("span",{className:"text-slate-400",children:"Export critical vulnerabilities"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>d(p.id),disabled:x===p.id,children:x===p.id?e.jsx(z,{}):e.jsx(_s,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>F(p),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>_(p),"aria-label":`Delete ${p.siem_type} integration`,children:e.jsx(ie,{className:"h-4 w-4 text-red-400"})})]})]})},p.id))})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Manual Export"})]}),e.jsx(v,{variant:"outline",size:"sm",onClick:f,disabled:D,children:D?e.jsx(z,{}):e.jsx(ke,{className:"h-4 w-4"})})]}),c.filter(p=>p.enabled).length===0?e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"No Enabled Integrations"}),e.jsx("p",{children:"Enable at least one SIEM integration above before exporting scan results."})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Manually export scan results to all enabled SIEM integrations."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:T,onChange:p=>o(p.target.value),className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",disabled:D||h,children:[e.jsx("option",{value:"",children:"Select a completed scan..."}),b.map(p=>e.jsxs("option",{value:p.id,children:[p.name," - ",new Date(p.created_at).toLocaleDateString()," ",new Date(p.created_at).toLocaleTimeString()]},p.id))]}),e.jsx(v,{variant:"primary",onClick:y,disabled:!T||h||D,children:h?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Exporting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Export to SIEM"]})})]}),b.length===0&&!D&&e.jsx("p",{className:"text-sm text-slate-500",children:"No completed scans available for export."}),e.jsxs("div",{className:"text-xs text-slate-500 mt-2",children:["Export will send data to: ",c.filter(p=>p.enabled).map(p=>p.siem_type.toUpperCase()).join(", ")]})]})]}),e.jsxs(S,{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"About SIEM Integration"}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-400",children:[e.jsx("p",{children:"SIEM (Security Information and Event Management) integration allows HeroForge to automatically export scan results and vulnerability findings to your security monitoring platform."}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Syslog:"})," RFC 5424 compliant syslog over TCP/UDP"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Splunk:"})," Splunk HTTP Event Collector (HEC)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Elasticsearch:"})," Direct indexing via Bulk API"]})]})]})]}),(g||k)&&e.jsx(Os,{settings:k,onClose:()=>{E(!1),F(null)},onSave:()=>{E(!1),F(null),l()}}),e.jsx(de,{isOpen:!!i,onClose:()=>_(null),onConfirm:C,title:"Delete SIEM Integration",message:`Are you sure you want to delete the ${i==null?void 0:i.siem_type.toUpperCase()} integration? Automatic exports to this endpoint will stop.`,confirmLabel:"Delete Integration",variant:"danger",loading:P})]})},Os=({settings:c,onClose:M,onSave:V})=>{const[j,g]=a.useState({siem_type:(c==null?void 0:c.siem_type)||"syslog",endpoint_url:(c==null?void 0:c.endpoint_url)||"",api_key:(c==null?void 0:c.api_key)||"",protocol:(c==null?void 0:c.protocol)||"tcp",enabled:(c==null?void 0:c.enabled)??!0,export_on_scan_complete:(c==null?void 0:c.export_on_scan_complete)??!1,export_on_critical_vuln:(c==null?void 0:c.export_on_critical_vuln)??!0}),[E,k]=a.useState(!1),F=async x=>{var A,i;if(x.preventDefault(),!j.endpoint_url){t.error("Endpoint URL is required");return}if(j.siem_type==="splunk"&&!j.api_key){t.error("API key is required for Splunk HEC");return}k(!0);try{if(c){const _={endpoint_url:j.endpoint_url,enabled:j.enabled,export_on_scan_complete:j.export_on_scan_complete,export_on_critical_vuln:j.export_on_critical_vuln};j.api_key&&(_.api_key=j.api_key),j.siem_type==="syslog"&&(_.protocol=j.protocol),await ue.updateSettings(c.id,_),t.success("SIEM integration updated")}else{const _={siem_type:j.siem_type,endpoint_url:j.endpoint_url,enabled:j.enabled,export_on_scan_complete:j.export_on_scan_complete,export_on_critical_vuln:j.export_on_critical_vuln};j.api_key&&(_.api_key=j.api_key),j.siem_type==="syslog"&&(_.protocol=j.protocol),await ue.createSettings(_),t.success("SIEM integration created")}V()}catch(_){const P=_;t.error(((i=(A=P.response)==null?void 0:A.data)==null?void 0:i.error)||"Failed to save SIEM integration")}finally{k(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-dark-border",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white",children:[c?"Edit":"Add"," SIEM Integration"]}),e.jsx("button",{onClick:M,className:"text-slate-400 hover:text-white",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-6",children:[!c&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"SIEM Type"}),e.jsxs("select",{value:j.siem_type,onChange:x=>g({...j,siem_type:x.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"syslog",children:"Syslog (RFC 5424)"}),e.jsx("option",{value:"splunk",children:"Splunk HEC"}),e.jsx("option",{value:"elasticsearch",children:"Elasticsearch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Endpoint URL"}),e.jsx("input",{type:"text",value:j.endpoint_url,onChange:x=>g({...j,endpoint_url:x.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:j.siem_type==="syslog"?"192.168.1.100:514":j.siem_type==="splunk"?"https://splunk.example.com:8088":"https://elasticsearch.example.com:9200"})]}),j.siem_type==="syslog"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Protocol"}),e.jsxs("select",{value:j.protocol,onChange:x=>g({...j,protocol:x.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"tcp",children:"TCP"}),e.jsx("option",{value:"udp",children:"UDP"})]})]}),(j.siem_type==="splunk"||j.siem_type==="elasticsearch")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[j.siem_type==="splunk"?"HEC Token":"API Key"," ",j.siem_type==="splunk"&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"password",value:j.api_key,onChange:x=>g({...j,api_key:x.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:c?"(leave blank to keep current)":""})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.enabled,onChange:x=>g({...j,enabled:x.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsx("span",{className:"text-white",children:"Enable this integration"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.export_on_scan_complete,onChange:x=>g({...j,export_on_scan_complete:x.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsx("span",{className:"text-white",children:"Auto-export when scans complete"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.export_on_critical_vuln,onChange:x=>g({...j,export_on_critical_vuln:x.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsx("span",{className:"text-white",children:"Auto-export critical vulnerabilities immediately"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:M,children:"Cancel"}),e.jsx(v,{type:"submit",variant:"primary",disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):e.jsxs("span",{children:[c?"Update":"Create"," Integration"]})})]})]})]})})},Js=()=>{const[c,M]=a.useState(!0),[V,j]=a.useState([]),[g,E]=a.useState(null),[k,F]=a.useState(!1),[x,A]=a.useState(!1),[i,_]=a.useState(null),[P,L]=a.useState(!1),[b,I]=a.useState(!1),[D,U]=a.useState(null),[T,o]=a.useState(""),h=a.useRef(null),[n,l]=a.useState({name:"",vpnType:"openvpn",username:"",password:""}),[d,C]=a.useState(null);a.useEffect(()=>{f()},[]);const f=async()=>{M(!0);try{const[w,R]=await Promise.all([ne.getConfigs(),ne.getStatus()]);j(w.data),E(R.data)}catch(w){console.error("Failed to load VPN data:",w),t.error("Failed to load VPN settings")}finally{M(!1)}},y=w=>{var G,ae;const R=(G=w.target.files)==null?void 0:G[0];if(!R)return;const K=(ae=R.name.split(".").pop())==null?void 0:ae.toLowerCase();let O="openvpn";K==="conf"&&(O="wireguard"),C(R),l({...n,name:R.name.replace(/\.(ovpn|conf)$/i,""),vpnType:O}),F(!0)},p=async()=>{if(!d){t.error("Please select a VPN config file");return}if(!n.name.trim()){t.error("Please enter a name for the VPN config");return}A(!0);try{const w=new FileReader;w.onload=async()=>{var K,O;const R=w.result.split(",")[1];try{await ne.uploadConfig({name:n.name.trim(),vpn_type:n.vpnType,config_data:R,filename:d.name,username:n.username||void 0,password:n.password||void 0,set_as_default:!1}),t.success("VPN config uploaded successfully"),F(!1),C(null),l({name:"",vpnType:"openvpn",username:"",password:""}),h.current&&(h.current.value=""),await f()}catch(G){const ae=G;console.error("Failed to upload VPN config:",G),t.error(((O=(K=ae.response)==null?void 0:K.data)==null?void 0:O.error)||"Failed to upload VPN config")}},w.readAsDataURL(d)}finally{A(!1)}},m=async w=>{var R,K;if(window.confirm("Are you sure you want to delete this VPN config?"))try{await ne.deleteConfig(w),t.success("VPN config deleted"),await f()}catch(O){const G=O;console.error("Failed to delete VPN config:",O),t.error(((K=(R=G.response)==null?void 0:R.data)==null?void 0:K.error)||"Failed to delete VPN config")}},r=async w=>{var R,K;_(w);try{const O=await ne.testConfig(w);O.data.success?t.success(`Connection successful! IP: ${O.data.assigned_ip||"N/A"}`):t.error(O.data.message||"Connection test failed")}catch(O){const G=O;console.error("Failed to test VPN config:",O),t.error(((K=(R=G.response)==null?void 0:R.data)==null?void 0:K.error)||"Connection test failed")}finally{_(null)}},u=async w=>{var R,K;L(!0);try{await ne.connect({config_id:w,connection_mode:"persistent"}),t.success("VPN connected"),await f()}catch(O){const G=O;console.error("Failed to connect VPN:",O),t.error(((K=(R=G.response)==null?void 0:R.data)==null?void 0:K.error)||"Failed to connect")}finally{L(!1)}},N=async()=>{var w,R;I(!0);try{await ne.disconnect(),t.success("VPN disconnected"),await f()}catch(K){const O=K;console.error("Failed to disconnect VPN:",K),t.error(((R=(w=O.response)==null?void 0:w.data)==null?void 0:R.error)||"Failed to disconnect")}finally{I(!1)}},H=async w=>{var R,K;try{await ne.updateConfig(w,{is_default:!0}),t.success("Default VPN config updated"),await f()}catch(O){const G=O;console.error("Failed to set default:",O),t.error(((K=(R=G.response)==null?void 0:R.data)==null?void 0:K.error)||"Failed to set default")}},Y=async w=>{var R,K;if(!T.trim()){t.error("Name cannot be empty");return}try{await ne.updateConfig(w,{name:T.trim()}),t.success("VPN config updated"),U(null),await f()}catch(O){const G=O;console.error("Failed to update config:",O),t.error(((K=(R=G.response)==null?void 0:R.data)==null?void 0:K.error)||"Failed to update")}};return c?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g!=null&&g.connected?e.jsx(ls,{className:"h-6 w-6 text-green-500"}):e.jsx(He,{className:"h-6 w-6 text-slate-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"VPN Status"}),e.jsx("p",{className:"text-sm text-slate-400",children:g!=null&&g.connected?`Connected to ${g.config_name}`:"Not connected"})]})]}),(g==null?void 0:g.connected)&&e.jsxs(v,{onClick:N,disabled:b,variant:"danger",className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),b?"Disconnecting...":"Disconnect"]})]}),(g==null?void 0:g.connected)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-dark-hover rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase",children:"Mode"}),e.jsx("p",{className:"text-sm text-white",children:g.connection_mode==="persistent"?"Persistent":"Per-Scan"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase",children:"Assigned IP"}),e.jsx("p",{className:"text-sm text-white font-mono",children:g.assigned_ip||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase",children:"Interface"}),e.jsx("p",{className:"text-sm text-white font-mono",children:g.interface_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase",children:"Connected Since"}),e.jsx("p",{className:"text-sm text-white",children:g.connected_since?new Date(g.connected_since).toLocaleString():"N/A"})]})]})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"VPN Configurations"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:h,type:"file",accept:".ovpn,.conf",onChange:y,className:"hidden"}),e.jsxs(v,{onClick:()=>{var w;return(w=h.current)==null?void 0:w.click()},className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),"Upload Config"]})]})]}),k&&e.jsxs("div",{className:"mb-6 p-4 bg-dark-hover rounded-lg border border-dark-border",children:[e.jsx("h4",{className:"text-md font-semibold text-white mb-4",children:"Upload VPN Configuration"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("span",{children:"File:"}),e.jsx("span",{className:"text-white font-mono",children:d==null?void 0:d.name}),e.jsx("span",{className:"px-2 py-0.5 bg-primary/20 text-primary rounded text-xs uppercase",children:n.vpnType})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Config Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{type:"text",placeholder:"My VPN Connection",value:n.name,onChange:w=>l({...n,name:w.target.value})})]}),n.vpnType==="openvpn"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Username (optional)"}),e.jsx(B,{type:"text",placeholder:"VPN username",value:n.username,onChange:w=>l({...n,username:w.target.value})}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Required if your VPN requires authentication"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Password (optional)"}),e.jsx(B,{type:"password",placeholder:"VPN password",value:n.password,onChange:w=>l({...n,password:w.target.value})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{onClick:p,disabled:x,children:x?"Uploading...":"Upload"}),e.jsx(v,{onClick:()=>{F(!1),C(null),h.current&&(h.current.value="")},variant:"secondary",children:"Cancel"})]})]})]}),V.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-400",children:[e.jsx(He,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No VPN configurations yet"}),e.jsx("p",{className:"text-sm",children:"Upload an OpenVPN (.ovpn) or WireGuard (.conf) file to get started"})]}):e.jsx("div",{className:"space-y-3",children:V.map(w=>e.jsxs("div",{className:"p-4 bg-dark-hover rounded-lg border border-dark-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${w.vpn_type==="openvpn"?"bg-orange-500/20 text-orange-400":"bg-blue-500/20 text-blue-400"}`,children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{children:[D===w.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{type:"text",value:T,onChange:R=>o(R.target.value),className:"w-48",autoFocus:!0,onKeyDown:R=>{R.key==="Enter"&&Y(w.id),R.key==="Escape"&&U(null)}}),e.jsx(v,{size:"sm",onClick:()=>Y(w.id),children:"Save"}),e.jsx(v,{size:"sm",variant:"secondary",onClick:()=>U(null),children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:w.name}),w.is_default&&e.jsx(Ge,{className:"h-4 w-4 text-yellow-400 fill-yellow-400"}),e.jsx("span",{className:"px-2 py-0.5 bg-slate-700 text-slate-300 rounded text-xs uppercase",children:w.vpn_type}),(g==null?void 0:g.connected)&&g.config_id===w.id&&e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 rounded text-xs",children:"Connected"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 mt-1",children:[w.requires_credentials&&e.jsx("span",{className:w.has_credentials?"text-green-400":"text-yellow-400",children:w.has_credentials?"Credentials saved":"Credentials required"}),w.last_used_at&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),"Last used: ",new Date(w.last_used_at).toLocaleDateString()]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:D!==w.id&&e.jsxs(e.Fragment,{children:[!w.is_default&&e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>H(w.id),title:"Set as default",children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>{U(w.id),o(w.name)},title:"Edit",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>r(w.id),disabled:i===w.id,title:"Test connection",children:i===w.id?e.jsx(z,{size:"sm"}):e.jsx(se,{className:"h-4 w-4"})}),!(g!=null&&g.connected)||g.config_id!==w.id?e.jsx(v,{size:"sm",variant:"secondary",onClick:()=>u(w.id),disabled:P||(g==null?void 0:g.connected),title:"Connect",children:e.jsx(Ze,{className:"h-4 w-4"})}):null,e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>m(w.id),className:"text-red-400 hover:text-red-300",title:"Delete",children:e.jsx(ie,{className:"h-4 w-4"})})]})})]},w.id))})]}),e.jsxs(S,{children:[e.jsx("h4",{className:"text-md font-semibold text-white mb-4",children:"How to Use VPN Integration"}),e.jsxs("div",{className:"space-y-3 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/20 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-primary font-semibold text-xs",children:"1"})}),e.jsx("p",{children:"Upload your OpenVPN (.ovpn) or WireGuard (.conf) configuration file."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/20 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-primary font-semibold text-xs",children:"2"})}),e.jsx("p",{children:"If your VPN requires credentials, enter them during upload. They are stored encrypted."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/20 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-primary font-semibold text-xs",children:"3"})}),e.jsx("p",{children:"Test your connection to verify it works before using it for scans."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-primary/20 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-primary font-semibold text-xs",children:"4"})}),e.jsx("p",{children:"When creating a scan, select a VPN config to route the scan through that VPN. The VPN connects before the scan starts and disconnects when it completes."})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-200",children:[e.jsx("p",{className:"font-medium",children:"Security Note"}),e.jsx("p",{className:"text-yellow-300/80 mt-1",children:"VPN credentials are encrypted using AES-256-GCM. Config files containing dangerous options (scripts, hooks) are rejected. Only use VPN configurations from trusted sources."})]})]})})]})]})},Ws=()=>{const[c,M]=a.useState("profile"),V=[{name:"Account",tabs:[{id:"profile",label:"Profile",icon:e.jsx(De,{className:"h-4 w-4"}),component:e.jsx(Cs,{})},{id:"security",label:"Security",icon:e.jsx(Ee,{className:"h-4 w-4"}),component:e.jsx(Us,{})},{id:"api-keys",label:"API Keys",icon:e.jsx(Pe,{className:"h-4 w-4"}),component:e.jsx(Ms,{})}]},{name:"Administration",tabs:[{id:"administration",label:"Users",icon:e.jsx(te,{className:"h-4 w-4"}),component:e.jsx(Es,{})}]},{name:"Scanning",tabs:[{id:"target-groups",label:"Target Groups",icon:e.jsx($e,{className:"h-4 w-4"}),component:e.jsx(As,{})},{id:"scheduled-scans",label:"Scheduled Scans",icon:e.jsx(oe,{className:"h-4 w-4"}),component:e.jsx(Is,{})},{id:"templates",label:"Scan Templates",icon:e.jsx(Se,{className:"h-4 w-4"}),component:e.jsx(Ds,{})},{id:"finding-templates",label:"Finding Templates",icon:e.jsx(ts,{className:"h-4 w-4"}),component:e.jsx(Ls,{})},{id:"vpn",label:"VPN",icon:e.jsx(ls,{className:"h-4 w-4"}),component:e.jsx(Js,{})},{id:"compare-scans",label:"Compare",icon:e.jsx(Le,{className:"h-4 w-4"}),component:e.jsx(Ts,{})}]},{name:"Integrations",tabs:[{id:"notifications",label:"Notifications",icon:e.jsx(es,{className:"h-4 w-4"}),component:e.jsx(Fs,{})},{id:"jira-integration",label:"JIRA",icon:e.jsx(Oe,{className:"h-4 w-4"}),component:e.jsx(Vs,{})},{id:"siem-integration",label:"SIEM",icon:e.jsx(rs,{className:"h-4 w-4"}),component:e.jsx($s,{})}]}],g=V.flatMap(E=>E.tabs).find(E=>E.id===c);return e.jsx(os,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(as,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"})]}),e.jsx("p",{className:"text-slate-400",children:"Manage your account, scanning configuration, and integrations"})]}),e.jsx("div",{className:"bg-dark-surface rounded-lg border border-dark-border p-4",children:e.jsx("div",{className:"flex flex-wrap gap-6",children:V.map(E=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:E.name}),e.jsx("div",{className:"flex gap-1",children:E.tabs.map(k=>e.jsxs("button",{onClick:()=>M(k.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c===k.id?"bg-primary text-white":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[k.icon,k.label]},k.id))})]},E.name))})}),e.jsx("div",{children:g==null?void 0:g.component})]})})};export{Ws as default};
