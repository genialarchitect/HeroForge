import{j as e}from"./vendor-state-DdX3IZQk.js";import{u as ee,r as d}from"./vendor-react-Da1CiaFS.js";import{B as j,E as B,Q as v,i as E,ap as se,a2 as I,T as D,a6 as ae,b1 as te,a_ as M,aC as O,Y as re,b4 as q,ba as le,ao as V,bi as ie,k as ne,ac as Q,X as U,J as ce}from"./vendor-ui-M-o_--rZ.js";import{G as de,N as P,O as k,P as oe,d as z,L as me,B as m,C as p,b as xe,I as $}from"./index-Rk50pbPR.js";import"./vendor-charts-PE5xD9Ly.js";const he=[{id:"assessments",label:"Assessments",icon:e.jsx(B,{className:"h-4 w-4"})},{id:"campaigns",label:"Campaigns",icon:e.jsx(D,{className:"h-4 w-4"})},{id:"rubrics",label:"Rubrics",icon:e.jsx(M,{className:"h-4 w-4"})}],ue=[{value:"",label:"All Statuses"},{value:"draft",label:"Draft"},{value:"pending_review",label:"Pending Review"},{value:"approved",label:"Approved"},{value:"rejected",label:"Rejected"}],pe={draft:{type:"pending",label:"Draft"},pending_review:{type:"running",label:"Pending Review"},approved:{type:"completed",label:"Approved"},rejected:{type:"failed",label:"Rejected"}},fe=({assessment:a,frameworks:n,onView:u,onEdit:x,onDelete:r})=>{const l=n.find(g=>g.id===a.framework_id),f=pe[a.review_status],h=a.review_status==="draft"||a.review_status==="rejected";return e.jsxs(p,{className:"hover:border-dark-hover transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-lg font-medium text-white truncate",children:a.control_id}),e.jsx("p",{className:"text-sm text-slate-400 truncate",children:(l==null?void 0:l.name)||a.framework_id})]}),e.jsx(xe,{variant:"status",type:f.type,children:f.label})]}),a.rating_score!==null&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-400",children:"Score"}),e.jsxs("span",{className:`font-medium ${a.rating_score>=80?"text-green-400":a.rating_score>=50?"text-yellow-400":"text-red-400"}`,children:[a.rating_score,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-border rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${a.rating_score>=80?"bg-green-500":a.rating_score>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.rating_score}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsxs("span",{children:[new Date(a.assessment_period_start).toLocaleDateString()," -"," ",new Date(a.assessment_period_end).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsxs("span",{children:["Updated ",new Date(a.updated_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"secondary",size:"sm",onClick:u,className:"flex-1",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"View"]}),h&&e.jsxs(m,{variant:"secondary",size:"sm",onClick:x,className:"flex-1",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:r,className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:e.jsx(V,{className:"h-4 w-4"})})]})]})},ge=({campaign:a,onView:n,onDelete:u})=>{const x={draft:"bg-slate-500/20 text-slate-400 border-slate-500/30",active:"bg-blue-500/20 text-blue-400 border-blue-500/30",completed:"bg-green-500/20 text-green-400 border-green-500/30",archived:"bg-slate-500/20 text-slate-500 border-slate-500/30"};return e.jsxs(p,{className:"hover:border-dark-hover transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-lg font-medium text-white truncate",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-slate-400 line-clamp-2",children:a.description})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border capitalize ${x[a.status]||x.draft}`,children:a.status})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:a.frameworks.map(r=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 bg-dark-bg border border-dark-border rounded text-xs text-slate-300",children:r},r))}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-400",children:"Progress"}),e.jsxs("span",{className:"text-white font-medium",children:[a.progress.assessed," / ",a.progress.total_controls," (",a.progress.percentage_complete,"%)"]})]}),e.jsx("div",{className:"w-full h-2 bg-dark-border rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${a.progress.percentage_complete}%`}})}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{className:"text-yellow-400",children:[a.progress.pending_review," pending review"]}),e.jsxs("span",{className:"text-green-400",children:[a.progress.approved," approved"]})]})]}),a.due_date&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 mb-4",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsxs("span",{children:["Due: ",new Date(a.due_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"secondary",size:"sm",onClick:n,className:"flex-1",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"View Details"]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:u,className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:e.jsx(V,{className:"h-4 w-4"})})]})]})},je=({rubric:a,onSelect:n})=>e.jsxs(p,{variant:"interactive",onClick:n,className:"hover:border-primary/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-lg font-medium text-white truncate",children:a.name}),e.jsxs("p",{className:"text-sm text-slate-400",children:[a.framework_id," - ",a.control_id]})]}),a.is_system_default&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 bg-primary/20 text-primary border border-primary/30 rounded text-xs",children:"System"})]}),a.description&&e.jsx("p",{className:"text-sm text-slate-300 line-clamp-2 mb-3",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsxs("span",{children:[a.assessment_criteria.length," criteria"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3"}),e.jsx("span",{children:a.rating_scale.scale_type})]})]}),e.jsx("div",{className:"flex items-center justify-end mt-3",children:e.jsx(Q,{className:"h-5 w-5 text-slate-500"})})]}),be=({isOpen:a,onClose:n,frameworks:u,rubrics:x,onSelectRubric:r})=>{const[l,f]=d.useState(""),[h,g]=d.useState("");if(!a)return null;const b=x.filter(t=>{var c;if(l&&t.framework_id!==l)return!1;if(h){const N=h.toLowerCase();return t.name.toLowerCase().includes(N)||t.control_id.toLowerCase().includes(N)||((c=t.description)==null?void 0:c.toLowerCase().includes(N))}return!0});return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-primary"}),"New Assessment"]}),e.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-200 p-1",children:e.jsx(U,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 border-b border-dark-border space-y-3",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Select a rubric to create a new manual assessment"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search rubrics...",value:h,onChange:t=>g(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),e.jsxs("select",{value:l,onChange:t=>f(t.target.value),className:"px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Frameworks"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"h-12 w-12 text-slate-500 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"No rubrics found"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Try adjusting your filters or search query"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:b.map(t=>e.jsx("div",{onClick:()=>r(t),className:"p-4 bg-dark-bg border border-dark-border rounded-lg cursor-pointer hover:border-primary/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-400",children:[t.framework_id," - ",t.control_id]}),t.description&&e.jsx("p",{className:"text-sm text-slate-500 mt-1 line-clamp-1",children:t.description})]}),e.jsx(Q,{className:"h-5 w-5 text-slate-500 flex-shrink-0"})]})},t.id))})})]})})},Ne=({isOpen:a,onClose:n,frameworks:u,onSubmit:x})=>{const[r,l]=d.useState({name:"",description:"",frameworks:[],due_date:""}),[f,h]=d.useState(!1);if(!a)return null;const g=t=>{l(c=>({...c,frameworks:c.frameworks.includes(t)?c.frameworks.filter(N=>N!==t):[...c.frameworks,t]}))},b=async t=>{if(t.preventDefault(),!r.name.trim()||r.frameworks.length===0){j.error("Please provide a name and select at least one framework");return}h(!0);try{await x({name:r.name.trim(),description:r.description.trim()||void 0,frameworks:r.frameworks,due_date:r.due_date||void 0}),l({name:"",description:"",frameworks:[],due_date:""}),n()}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-primary"}),"New Campaign"]}),e.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-200 p-1",children:e.jsx(U,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-4 space-y-4",children:[e.jsx($,{label:"Campaign Name",placeholder:"Q4 2024 Compliance Assessment",value:r.name,onChange:t=>l(c=>({...c,name:t.target.value})),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-slate-100 placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",rows:3,placeholder:"Describe the purpose of this assessment campaign...",value:r.description,onChange:t=>l(c=>({...c,description:t.target.value}))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Frameworks ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(t=>e.jsxs("button",{type:"button",onClick:()=>g(t.id),className:`px-3 py-1.5 rounded-lg border text-sm transition-colors ${r.frameworks.includes(t.id)?"bg-primary/20 border-primary text-primary":"bg-dark-bg border-dark-border text-slate-300 hover:border-slate-500"}`,children:[r.frameworks.includes(t.id)&&e.jsx(ce,{className:"h-3 w-3 inline mr-1"}),t.name]},t.id))})]}),e.jsx($,{label:"Due Date",type:"date",value:r.due_date,onChange:t=>l(c=>({...c,due_date:t.target.value}))}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{type:"button",variant:"secondary",onClick:n,className:"flex-1",children:"Cancel"}),e.jsx(m,{type:"submit",loading:f,loadingText:"Creating...",className:"flex-1",children:"Create Campaign"})]})]})]})})},_e=()=>{const a=ee(),[n,u]=d.useState("assessments"),[x,r]=d.useState(!0),[l,f]=d.useState([]),[h,g]=d.useState([]),[b,t]=d.useState([]),[c,N]=d.useState([]),[o,C]=d.useState({framework:"",status:"",search:""}),[_,Y]=d.useState(""),[G,y]=d.useState(!1),[J,S]=d.useState(!1);d.useEffect(()=>{F()},[]);const F=async()=>{r(!0);try{const[s,i,w,A]=await Promise.all([de.getFrameworks(),P.getAll(),k.getAll(),oe.getAll()]);f(s.data.frameworks),g(i.data),t(w.data),N(A.data)}catch(s){j.error("Failed to load data"),console.error(s)}finally{r(!1)}},R=h.filter(s=>{if(o.framework&&s.framework_id!==o.framework||o.status&&s.review_status!==o.status)return!1;if(o.search){const i=o.search.toLowerCase();return s.control_id.toLowerCase().includes(i)}return!0}),T=c.filter(s=>!(_&&s.framework_id!==_)),L=s=>{y(!1),a(`/manual-assessments/new?rubricId=${s.id}`)},X=s=>{a(`/manual-assessments/${s.id}`)},H=s=>{a(`/manual-assessments/${s.id}?edit=true`)},K=async s=>{if(window.confirm("Are you sure you want to delete this assessment?"))try{await P.delete(s.id),g(i=>i.filter(w=>w.id!==s.id)),j.success("Assessment deleted")}catch{j.error("Failed to delete assessment")}},W=async s=>{try{const i=await k.create(s),w=await k.getById(i.data.id);t(A=>[...A,w.data]),j.success("Campaign created successfully")}catch(i){throw j.error("Failed to create campaign"),i}},Z=async s=>{if(window.confirm("Are you sure you want to delete this campaign?"))try{await k.delete(s.id),t(i=>i.filter(w=>w.id!==s.id)),j.success("Campaign deleted")}catch{j.error("Failed to delete campaign")}};return x?e.jsx(z,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{})})}):e.jsxs(z,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Manual Compliance Assessments"}),e.jsx("p",{className:"text-slate-400",children:"Conduct and manage manual compliance assessments against security frameworks"})]})]}),e.jsxs(m,{onClick:()=>y(!0),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"New Assessment"]})]}),e.jsx("div",{className:"border-b border-dark-border",children:e.jsx("nav",{className:"flex gap-1",children:he.map(s=>e.jsxs("button",{onClick:()=>u(s.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${n===s.id?"border-primary text-primary":"border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-600"}`,children:[s.icon,s.label]},s.id))})}),n==="assessments"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"!p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by control ID...",value:o.search,onChange:s=>C(i=>({...i,search:s.target.value})),className:"w-full pl-10 pr-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),e.jsxs("select",{value:o.framework,onChange:s=>C(i=>({...i,framework:s.target.value})),className:"px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Frameworks"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("select",{value:o.status,onChange:s=>C(i=>({...i,status:s.target.value})),className:"px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:ue.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx(m,{variant:"secondary",size:"sm",onClick:F,className:"px-3",children:e.jsx(se,{className:"h-4 w-4"})})]})}),R.length===0?e.jsxs(p,{className:"!p-8 text-center",children:[e.jsx(I,{className:"h-12 w-12 text-slate-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-1",children:"No Assessments Found"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:o.search||o.framework||o.status?"Try adjusting your filters":"Create your first manual assessment to get started"}),e.jsxs(m,{onClick:()=>y(!0),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Create Assessment"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(s=>e.jsx(fe,{assessment:s,frameworks:l,onView:()=>X(s),onEdit:()=>H(s),onDelete:()=>K(s)},s.id))})]}),n==="campaigns"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Organize assessments into campaigns for tracking progress across frameworks"}),e.jsxs(m,{onClick:()=>S(!0),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"New Campaign"]})]}),b.length===0?e.jsxs(p,{className:"!p-8 text-center",children:[e.jsx(D,{className:"h-12 w-12 text-slate-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-1",children:"No Campaigns Yet"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Create a campaign to organize and track your assessment progress"}),e.jsxs(m,{onClick:()=>S(!0),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(s=>e.jsx(ge,{campaign:s,onView:()=>a(`/manual-assessments/campaign/${s.id}`),onDelete:()=>Z(s)},s.id))})]}),n==="rubrics"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"!p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-400",children:"Filter by framework:"})]}),e.jsxs("select",{value:_,onChange:s=>Y(s.target.value),className:"px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Frameworks"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})}),e.jsx(p,{className:"bg-blue-500/10 border-blue-500/30 !p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(te,{className:"h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-blue-300",children:"Rubrics define the assessment criteria for each compliance control. System rubrics are provided by default. You can create custom rubrics for specific controls to tailor the assessment process."})})]})}),T.length===0?e.jsxs(p,{className:"!p-8 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-slate-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-slate-300 mb-1",children:"No Rubrics Found"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Try selecting a different framework filter"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(s=>e.jsx(je,{rubric:s,onSelect:()=>L(s)},s.id))})]})]}),e.jsx(be,{isOpen:G,onClose:()=>y(!1),frameworks:l,rubrics:c,onSelectRubric:L}),e.jsx(Ne,{isOpen:J,onClose:()=>S(!1),frameworks:l,onSubmit:W})]})};export{_e as default};
