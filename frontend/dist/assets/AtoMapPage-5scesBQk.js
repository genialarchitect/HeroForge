import{j as e}from"./vendor-state-BXNPjUwt.js";import{r as N}from"./vendor-react-5KxtEOLM.js";import{S as J,aT as _,a6 as Ne,l as q,a7 as Q,br as ee,bs as fe,F as ve,bt as we,U as Ce,v as Y,at as Se,ax as te,B as C,_ as se,X as ae,z as Ae,bu as B,k as Ie,bv as ke,C as K,a9 as Me,bn as Oe,O as Ee,i as De,g as Pe}from"./vendor-ui-PizTOSgB.js";import{L as Z}from"./Layout-CeExTnzB.js";import{C as z}from"./Card-D4UbjXYP.js";import{B as O,L as R}from"./index-DgePDh_X.js";import{L as G}from"./LoadingSpinner-p-Ub3czh.js";import"./Header-Dw99lsG2.js";import"./vendor-markdown-RN55YrVy.js";import"./vendor-utils-DfRopTPV.js";const H=[{id:"AC",name:"Access Control",abbreviation:"AC"},{id:"AT",name:"Awareness and Training",abbreviation:"AT"},{id:"AU",name:"Audit and Accountability",abbreviation:"AU"},{id:"CA",name:"Assessment, Authorization, and Monitoring",abbreviation:"CA"},{id:"CM",name:"Configuration Management",abbreviation:"CM"},{id:"CP",name:"Contingency Planning",abbreviation:"CP"},{id:"IA",name:"Identification and Authentication",abbreviation:"IA"},{id:"IR",name:"Incident Response",abbreviation:"IR"},{id:"MA",name:"Maintenance",abbreviation:"MA"},{id:"MP",name:"Media Protection",abbreviation:"MP"},{id:"PE",name:"Physical and Environmental Protection",abbreviation:"PE"},{id:"PL",name:"Planning",abbreviation:"PL"},{id:"PM",name:"Program Management",abbreviation:"PM"},{id:"PS",name:"Personnel Security",abbreviation:"PS"},{id:"PT",name:"PII Processing and Transparency",abbreviation:"PT"},{id:"RA",name:"Risk Assessment",abbreviation:"RA"},{id:"SA",name:"System and Services Acquisition",abbreviation:"SA"},{id:"SC",name:"System and Communications Protection",abbreviation:"SC"},{id:"SI",name:"System and Information Integrity",abbreviation:"SI"},{id:"SR",name:"Supply Chain Risk Management",abbreviation:"SR"}],$e=n=>{switch(n){case"Compliant":return e.jsx(Pe,{className:"w-4 h-4 text-green-400"});case"NonCompliant":return e.jsx(De,{className:"w-4 h-4 text-red-400"});case"PartiallyCompliant":return e.jsx(Ee,{className:"w-4 h-4 text-yellow-400"});case"NotApplicable":return e.jsx(Oe,{className:"w-4 h-4 text-gray-400"});case"NotAssessed":return e.jsx(K,{className:"w-4 h-4 text-blue-400"});case"ManualOverride":return e.jsx(Me,{className:"w-4 h-4 text-purple-400"});default:return e.jsx(K,{className:"w-4 h-4 text-gray-400"})}},U=n=>{let x=0,s=0,a=0,i=0,d=0,g=0;const w=j=>{switch(g++,j.status){case"Compliant":x++;break;case"NonCompliant":s++;break;case"PartiallyCompliant":a++;break;case"NotAssessed":i++;break;case"NotApplicable":d++;break}j.children&&j.children.forEach(w)};return n.forEach(w),{compliantCount:x,nonCompliantCount:s,partialCount:a,notAssessedCount:i,notApplicableCount:d,total:g}},W=n=>U(n),X=n=>{let x=0,s=0,a=0;return n.forEach(i=>{const d=U(i.controls),g=d.total-d.notApplicableCount-d.notAssessedCount;x+=g,s+=d.compliantCount,a+=d.partialCount}),x===0?0:Math.round((s+a*.5)/x*100)},V=()=>{const n=H.map((a,i)=>{const d=Math.floor(Math.random()*10)+5,g=[];for(let j=1;j<=d;j++){const A=Math.random();let I;A<.5?I="Compliant":A<.65?I="PartiallyCompliant":A<.75?I="NonCompliant":A<.85?I="NotAssessed":I="NotApplicable";const S=Math.random()<.4?Math.floor(Math.random()*3)+1:0,c=[];for(let b=1;b<=S;b++){const E=Math.random();let r;E<.5?r="Compliant":E<.65?r="PartiallyCompliant":E<.75?r="NonCompliant":E<.85?r="NotAssessed":r="NotApplicable",c.push({id:`${a.id}-${j}(${b})`,controlId:`${a.abbreviation}-${j}(${b})`,title:`${a.name} Control ${j} Enhancement ${b}`,status:r,evidenceCount:r==="Compliant"?Math.floor(Math.random()*3)+1:0,poamId:r==="NonCompliant"?`POA&M-${Math.floor(Math.random()*100)+1}`:void 0,lastAssessed:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString().split("T")[0],parentId:`${a.id}-${j}`})}g.push({id:`${a.id}-${j}`,controlId:`${a.abbreviation}-${j}`,title:`${a.name} Control ${j}`,status:I,evidenceCount:I==="Compliant"?Math.floor(Math.random()*5)+1:0,poamId:I==="NonCompliant"?`POA&M-${Math.floor(Math.random()*100)+1}`:void 0,lastAssessed:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString().split("T")[0],children:c.length>0?c:void 0})}const w=W(g);return{id:a.id,name:a.name,abbreviation:a.abbreviation,controls:g,order:i,...w}}),x=a=>{let i=0;return a.forEach(d=>{d.poamId&&i++,d.children&&(i+=x(d.children))}),i},s=n.reduce((a,i)=>a+x(i.controls),0);return{systemName:"Sample Information System",systemId:"SYS-2024-001",organization:"Sample Organization",authorizingOfficial:"Jane Smith, CISO",assessmentDate:new Date().toISOString().split("T")[0],targetAtoDate:new Date(Date.now()+2160*60*60*1e3).toISOString().split("T")[0],baseline:"Moderate",framework:"NIST 800-53 Rev 5",controlFamilies:n,overallScore:X(n),poamCount:s}},ne=({control:n,depth:x,expandedControls:s,onToggleControl:a,onEditControl:i})=>{const d=n.children&&n.children.length>0,g=s.has(n.id);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`border-t border-gray-700 ${x>0?"bg-gray-800/50":""}`,children:[e.jsx("td",{className:"py-2",style:{paddingLeft:`${x*24+8}px`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[d?e.jsx("button",{onClick:()=>a(n.id),className:"p-0.5 hover:bg-gray-700 rounded",children:g?e.jsx(q,{className:"w-4 h-4 text-gray-400"}):e.jsx(se,{className:"w-4 h-4 text-gray-400"})}):e.jsx("span",{className:"w-5"}),e.jsx("span",{className:"font-mono text-cyan-400",children:n.controlId})]})}),e.jsx("td",{className:"py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[$e(n.status),e.jsx("span",{className:"text-gray-300",children:n.status})]})}),e.jsx("td",{className:"py-2 text-gray-400",children:n.evidenceCount>0?`${n.evidenceCount} items`:"-"}),e.jsx("td",{className:"py-2",children:n.poamId?e.jsx("span",{className:"text-red-400 font-mono",children:n.poamId}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"py-2 text-gray-400",children:n.lastAssessed||"-"}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>i(n),className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-cyan-400",title:"Edit control",children:e.jsx(ke,{className:"w-4 h-4"})})})]}),d&&g&&n.children.map(w=>e.jsx(ne,{control:w,depth:x+1,expandedControls:s,onToggleControl:a,onEditControl:i},w.id))]})},Fe=({family:n,expanded:x,onToggle:s,expandedControls:a,onToggleControl:i,onEditControl:d,isDragging:g,onDragStart:w,onDragOver:j,onDrop:A,onDragEnd:I})=>{const S=U(n.controls),c=S.total,b=c>0?S.compliantCount/c*100:0,E=c>0?S.partialCount/c*100:0,r=c>0?S.nonCompliantCount/c*100:0,f=c>0?S.notAssessedCount/c*100:0,D=c>0?S.notApplicableCount/c*100:0;return e.jsxs("div",{className:`bg-gray-800 rounded-lg border border-gray-700 overflow-hidden print:break-inside-avoid transition-all ${g?"opacity-50 border-cyan-500":""}`,draggable:!0,onDragStart:v=>w(v,n.id),onDragOver:j,onDrop:v=>A(v,n.id),onDragEnd:I,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"px-2 py-4 cursor-grab active:cursor-grabbing hover:bg-gray-700 print:hidden",title:"Drag to reorder",children:e.jsx(te,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("button",{onClick:s,className:"flex-1 p-4 flex items-center justify-between hover:bg-gray-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-700 flex items-center justify-center font-bold text-cyan-400",children:n.abbreviation}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-white",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:[c," controls"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 rounded bg-green-500/20 text-green-400",children:S.compliantCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-yellow-500/20 text-yellow-400",children:S.partialCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-red-500/20 text-red-400",children:S.nonCompliantCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-blue-500/20 text-blue-400",children:S.notAssessedCount})]}),x?e.jsx(q,{className:"w-5 h-5 text-gray-400"}):e.jsx(se,{className:"w-5 h-5 text-gray-400"})]})]})]}),e.jsxs("div",{className:"h-2 flex",children:[e.jsx("div",{className:"bg-green-500",style:{width:`${b}%`}}),e.jsx("div",{className:"bg-yellow-500",style:{width:`${E}%`}}),e.jsx("div",{className:"bg-red-500",style:{width:`${r}%`}}),e.jsx("div",{className:"bg-blue-500",style:{width:`${f}%`}}),e.jsx("div",{className:"bg-gray-500",style:{width:`${D}%`}})]}),x&&e.jsx("div",{className:"p-4 border-t border-gray-700 bg-gray-850",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 text-left",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Control"}),e.jsx("th",{className:"pb-2 font-medium",children:"Status"}),e.jsx("th",{className:"pb-2 font-medium",children:"Evidence"}),e.jsx("th",{className:"pb-2 font-medium",children:"POA&M"}),e.jsx("th",{className:"pb-2 font-medium",children:"Last Assessed"}),e.jsx("th",{className:"pb-2 font-medium w-10"})]})}),e.jsx("tbody",{children:n.controls.map(v=>e.jsx(ne,{control:v,depth:0,expandedControls:a,onToggleControl:i,onEditControl:d},v.id))})]})})]})},Te=({control:n,onClose:x,onSave:s})=>{const[a,i]=N.useState(n);if(N.useEffect(()=>{i(n)},[n]),!n||!a)return null;const d=()=>{s(a),x()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:hidden",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Control"}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-white",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Control ID"}),e.jsx("div",{className:"text-white font-mono",children:a.controlId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:a.status,onChange:g=>i({...a,status:g.target.value}),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white",children:[e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"PartiallyCompliant",children:"Partially Compliant"}),e.jsx("option",{value:"NonCompliant",children:"Non-Compliant"}),e.jsx("option",{value:"NotAssessed",children:"Not Assessed"}),e.jsx("option",{value:"NotApplicable",children:"Not Applicable"}),e.jsx("option",{value:"ManualOverride",children:"Manual Override"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Evidence Count"}),e.jsx("input",{type:"number",min:"0",value:a.evidenceCount,onChange:g=>i({...a,evidenceCount:parseInt(g.target.value)||0}),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"POA&M ID"}),e.jsx("input",{type:"text",value:a.poamId||"",onChange:g=>i({...a,poamId:g.target.value||void 0}),placeholder:"e.g., POA&M-001",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes||"",onChange:g=>i({...a,notes:g.target.value||void 0}),placeholder:"Assessment notes...",rows:3,className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assessor"}),e.jsx("input",{type:"text",value:a.assessor||"",onChange:g=>i({...a,assessor:g.target.value||void 0}),placeholder:"Assessor name",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:[e.jsx(O,{variant:"secondary",onClick:x,children:"Cancel"}),e.jsxs(O,{onClick:d,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})})},Le=({atoData:n,onAction:x})=>{const[s,a]=N.useState(!1),[i,d]=N.useState(""),[g,w]=N.useState([]),[j,A]=N.useState(!1),I=async()=>{if(!i.trim()||!n)return;const c=i;d(""),w(b=>[...b,{role:"user",content:c}]),A(!0);try{const b=await R.post("/api/ato-map/zeus",{prompt:c,context:{systemName:n.systemName,overallScore:n.overallScore,poamCount:n.poamCount,families:n.controlFamilies.map(r=>({id:r.id,name:r.name,stats:U(r.controls)}))}}),E=b.data.message||"Action completed.";w(r=>[...r,{role:"assistant",content:E}]),b.data.action&&(x(b.data.action),C.success("Zeus action applied"))}catch(b){console.error("Zeus error:",b);const E=b instanceof Error?b.message:"Unknown error";w(r=>[...r,{role:"assistant",content:`I encountered an error processing your request. You can still use me to help analyze the ATO data or suggest actions. Error: ${E}`}])}finally{A(!1)}},S=[{label:"Analyze gaps",prompt:"What are the main compliance gaps in this ATO assessment?"},{label:"Prioritize POA&Ms",prompt:"Help me prioritize the POA&M items by risk."},{label:"Generate summary",prompt:"Generate an executive summary of the current ATO status."},{label:"Recommend actions",prompt:"What controls should I focus on to improve the overall score?"}];return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-6 right-6 p-4 bg-purple-600 hover:bg-purple-500 rounded-full shadow-lg z-40 print:hidden transition-colors",title:"Ask Zeus AI Assistant",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),s&&e.jsxs("div",{className:"fixed bottom-6 right-6 w-96 bg-gray-800 rounded-lg shadow-xl border border-gray-700 z-50 print:hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Zeus AI Assistant"})]}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"h-64 overflow-y-auto p-4 space-y-3",children:[g.length===0&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-2 text-purple-400/50"}),e.jsx("p",{className:"text-sm",children:"Ask me about your ATO assessment or use quick actions below."})]}),g.map((c,b)=>e.jsx("div",{className:`p-3 rounded-lg ${c.role==="user"?"bg-cyan-500/20 text-cyan-100 ml-8":"bg-gray-700 text-gray-100 mr-8"}`,children:c.content},b)),j&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(G,{}),e.jsx("span",{className:"text-sm",children:"Zeus is thinking..."})]})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-700",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:S.map((c,b)=>e.jsx("button",{onClick:()=>d(c.prompt),className:"px-2 py-1 text-xs bg-gray-700 hover:bg-gray-600 rounded text-gray-300",children:c.label},b))})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:c=>d(c.target.value),onKeyDown:c=>c.key==="Enter"&&I(),placeholder:"Ask Zeus...",className:"flex-1 p-2 bg-gray-900 border border-gray-600 rounded-lg text-white text-sm",disabled:j}),e.jsx(O,{onClick:I,disabled:j||!i.trim(),children:e.jsx(Ie,{className:"w-4 h-4"})})]})})]})]})},Re=({isOpen:n,onClose:x,onImport:s})=>{const[a,i]=N.useState("heroforge"),[d,g]=N.useState(""),[w,j]=N.useState(!1),A=N.useRef(null);if(!n)return null;const I=async r=>{var D;const f=(D=r.target.files)==null?void 0:D[0];if(f){j(!0);try{const v=await f.text();if(a==="json"){const m=JSON.parse(v),y=b(m);s(y),C.success("ATO Map data imported successfully"),x()}else if(a==="csv"){const m=E(v);s(m),C.success("CSV data imported successfully"),x()}}catch(v){console.error("Import error:",v),C.error("Failed to import data. Please check the file format.")}finally{j(!1)}}},S=()=>{try{const r=JSON.parse(d),f=b(r);s(f),C.success("ATO Map data imported successfully"),x()}catch(r){console.error("JSON parse error:",r),C.error("Invalid JSON format")}},c=async()=>{j(!0);try{const r=await R.get("/api/ato-map");if(r.data&&r.data.controlFamilies)s(r.data),C.success("Loaded compliance data from HeroForge"),x();else{const f=V();s(f),C.success("Loaded sample compliance data"),x()}}catch(r){console.error("Load error:",r);const f=V();s(f),C.info("Loaded sample data (API not available)"),x()}finally{j(!1)}},b=r=>{const f=new Map,D=new Map;H.forEach(m=>f.set(m.id,[])),r.controls.forEach(m=>{const y=m.controlId,u=y.split("-")[0].toUpperCase(),P={id:y,controlId:y,title:`Control ${y}`,status:m.status||"NotAssessed",evidenceCount:m.evidenceCount||0,poamId:m.poamId,notes:m.notes,parentId:m.parentId},L=y.match(/^([A-Z]+-\d+)\(\d+\)$/);if(L||m.parentId){const T=m.parentId||L[1];D.has(T)||D.set(T,[]),D.get(T).push(P)}else f.has(u)&&f.get(u).push(P)}),f.forEach(m=>{m.forEach(y=>{const u=D.get(y.controlId);u&&u.length>0&&(y.children=u)})});const v=H.map((m,y)=>{const u=f.get(m.id)||[],P=W(u);return{id:m.id,name:m.name,abbreviation:m.abbreviation,controls:u,order:y,...P}}).filter(m=>m.controls.length>0);return{systemName:r.systemName||"Imported System",organization:r.organization,baseline:r.baseline||"Moderate",framework:"NIST 800-53 Rev 5",controlFamilies:v,overallScore:X(v),poamCount:v.reduce((m,y)=>{let u=0;const P=L=>{L.forEach(T=>{T.poamId&&u++,T.children&&P(T.children)})};return P(y.controls),m+u},0)}},E=r=>{const f=r.trim().split(`
`),D=f[0].split(",").map(m=>m.trim().toLowerCase()),v=[];for(let m=1;m<f.length;m++){const y=f[m].split(",").map(P=>P.trim()),u={};D.forEach((P,L)=>{u[P]=y[L]||""}),v.push({controlId:u.control_id||u.controlid||u.control||"",status:u.status||"NotAssessed",evidenceCount:parseInt(u.evidence_count||u.evidence||"0",10),poamId:u.poam_id||u.poam||void 0,notes:u.notes||void 0,parentId:u.parent_id||u.parentid||void 0})}return b({controls:v})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:hidden",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Import ATO Map Data"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Load compliance assessment data"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>i("heroforge"),className:`flex-1 p-4 rounded-lg border ${a==="heroforge"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(J,{className:"w-6 h-6 mx-auto mb-2 text-cyan-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"HeroForge Data"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Load from scans"})]}),e.jsxs("button",{onClick:()=>i("json"),className:`flex-1 p-4 rounded-lg border ${a==="json"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(Q,{className:"w-6 h-6 mx-auto mb-2 text-yellow-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"JSON File"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Import JSON"})]}),e.jsxs("button",{onClick:()=>i("csv"),className:`flex-1 p-4 rounded-lg border ${a==="csv"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(ee,{className:"w-6 h-6 mx-auto mb-2 text-green-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"CSV File"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Import spreadsheet"})]})]}),a==="heroforge"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-cyan-400"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Load compliance assessment data from your HeroForge scans and manual assessments."}),e.jsx(O,{onClick:c,disabled:w,children:w?e.jsx(G,{}):"Load HeroForge Data"})]}),a==="json"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"file",ref:A,accept:".json",onChange:I,className:"hidden"}),e.jsxs(O,{variant:"secondary",onClick:()=>{var r;return(r=A.current)==null?void 0:r.click()},className:"w-full",disabled:w,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Upload JSON File"]})]}),e.jsx("div",{className:"text-center text-gray-500 my-4",children:"— or paste JSON below —"}),e.jsx("textarea",{value:d,onChange:r=>g(r.target.value),placeholder:'{"systemName": "My System", "controls": [{"controlId": "AC-1", "status": "Compliant"}]}',className:"w-full h-40 p-3 bg-gray-900 border border-gray-600 rounded-lg text-gray-300 font-mono text-sm"}),e.jsx(O,{onClick:S,className:"mt-4 w-full",disabled:!d.trim(),children:"Import JSON"})]}),a==="csv"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Expected CSV format:"}),e.jsxs("code",{className:"text-xs text-cyan-400",children:["control_id,status,evidence_count,poam_id,notes,parent_id",e.jsx("br",{}),"AC-1,Compliant,3,,Reviewed annually,",e.jsx("br",{}),"AC-1(1),Compliant,1,,Enhancement 1,AC-1",e.jsx("br",{}),"AC-2,NonCompliant,0,POA&M-001,Needs remediation,"]})]}),e.jsx("input",{type:"file",ref:A,accept:".csv",onChange:I,className:"hidden"}),e.jsxs(O,{onClick:()=>{var r;return(r=A.current)==null?void 0:r.click()},className:"w-full",disabled:w,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Upload CSV File"]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:e.jsx(O,{variant:"secondary",onClick:x,children:"Cancel"})})]})})},We=()=>{const[n,x]=N.useState(!0),[s,a]=N.useState(null),[i,d]=N.useState(new Set),[g,w]=N.useState(new Set),[j,A]=N.useState(!1),[I,S]=N.useState(null),[c,b]=N.useState(null),[E,r]=N.useState(null),[f,D]=N.useState([]),[v,m]=N.useState(""),[y,u]=N.useState("real"),P=N.useRef(null);N.useEffect(()=>{(async()=>{try{const l=await R.get("/api/engagements"),o=l.data.engagements||l.data||[];D(o),o.length>0&&m(o[0].id)}catch(l){console.error("Failed to fetch engagements:",l),u("sample")}})()},[]),N.useEffect(()=>{(async()=>{var l;x(!0);try{let o;v&&y==="real"?o=await R.get(`/api/ato-map/engagement/${v}`):y==="real"?o=await R.get("/api/ato-map"):o=await R.get("/api/ato-map/sample");const p=o.data;!((l=p.controlFamilies)==null?void 0:l.some(F=>F.controls.some(k=>k.status!=="NotAssessed")))&&y==="real"&&C.info("No assessment data found. Showing framework controls for assessment."),a(p)}catch(o){console.error("Failed to fetch ATO data:",o),C.warning("Could not load assessment data. Using sample data."),a(V()),u("sample")}finally{x(!1)}})()},[v,y]);const L=t=>{const l=new Set(i);l.has(t)?l.delete(t):l.add(t),d(l)},T=t=>{const l=new Set(g);l.has(t)?l.delete(t):l.add(t),w(l)},re=()=>{if(s){d(new Set(s.controlFamilies.map(l=>l.id)));const t=[];s.controlFamilies.forEach(l=>{l.controls.forEach(o=>{o.children&&o.children.length>0&&t.push(o.id)})}),w(new Set(t))}},le=()=>{d(new Set),w(new Set)},oe=(t,l)=>{b(l),t.dataTransfer.effectAllowed="move"},ie=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},ce=(t,l)=>{if(t.preventDefault(),!c||!s||c===l)return;const o=[...s.controlFamilies],p=o.findIndex(k=>k.id===c),h=o.findIndex(k=>k.id===l);if(p===-1||h===-1)return;const[F]=o.splice(p,1);o.splice(h,0,F),o.forEach((k,M)=>{k.order=M}),a({...s,controlFamilies:o}),C.success("Control family order updated")},de=()=>{b(null)},me=()=>{window.print()},xe=()=>{if(!s)return;const t={exportDate:new Date().toISOString(),...s},l=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(l),p=document.createElement("a");p.href=o,p.download=`ato-map-${s.systemName.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(o),C.success("ATO Map exported as JSON")},pe=()=>{if(!s)return;const t=[["Control Family","Control ID","Parent ID","Status","Evidence Count","POA&M ID","Last Assessed","Notes"]],l=(k,M,je)=>{t.push([k,M.controlId,je||"",M.status,String(M.evidenceCount),M.poamId||"",M.lastAssessed||"",M.notes||""]),M.children&&M.children.forEach(ye=>l(k,ye,M.controlId))};s.controlFamilies.forEach(k=>{k.controls.forEach(M=>l(k.name,M))});const o=t.map(k=>k.map(M=>`"${M}"`).join(",")).join(`
`),p=new Blob([o],{type:"text/csv"}),h=URL.createObjectURL(p),F=document.createElement("a");F.href=h,F.download=`ato-map-${s.systemName.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(h),C.success("ATO Map exported as CSV")},he=t=>{a(t)},ge=t=>{S(t)},ue=t=>{if(!s)return;const l=p=>p.map(h=>h.id===t.id?{...t,children:h.children}:h.children?{...h,children:l(h.children)}:h),o=s.controlFamilies.map(p=>({...p,controls:l(p.controls)}));o.forEach(p=>{const h=W(p.controls);Object.assign(p,h)}),a({...s,controlFamilies:o,overallScore:X(o)}),C.success(`Control ${t.controlId} updated`)},be=t=>{if(s)switch(console.log("Zeus action:",t),t.type){case"update_status":if(t.controlId&&t.newStatus){const l=p=>p.map(h=>h.controlId===t.controlId?{...h,status:t.newStatus,notes:t.notes||h.notes}:h.children&&h.children.length>0?{...h,children:l(h.children)}:h),o=s.controlFamilies.map(p=>({...p,controls:l(p.controls)}));a({...s,controlFamilies:o}),C.success(`Control ${t.controlId} updated to ${t.newStatus}`)}break;case"bulk_update":if(t.targetStatus&&t.newStatus){const l=p=>p.map(h=>{const F=h.status===t.targetStatus?{...h,status:t.newStatus,notes:t.notes||h.notes}:h;return h.children&&h.children.length>0?{...F,children:l(h.children)}:F}),o=s.controlFamilies.map(p=>t.familyId&&p.id!==t.familyId?p:{...p,controls:l(p.controls)});a({...s,controlFamilies:o}),C.success(`Bulk updated ${t.targetStatus} controls to ${t.newStatus}`)}break;case"focus_family":if(t.familyId){d(o=>new Set([...o,t.familyId]));const l=document.getElementById(`family-${t.familyId}`);l&&l.scrollIntoView({behavior:"smooth",block:"start"}),C.info(`Focused on ${t.familyId} family`)}break;case"highlight_status":t.targetStatus&&(r(t.targetStatus),C.info(`Highlighting ${t.targetStatus} controls`));break;case"export":C.info("Opening export options...");break;default:console.log("Unknown Zeus action type:",t.type)}};if(n)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{})})});if(!s)return e.jsx(Z,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No ATO Map Data"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Import compliance data to generate the ATO map."}),e.jsxs(O,{onClick:()=>A(!0),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Import Data"]})]})});const $=s.controlFamilies.reduce((t,l)=>{const o=U(l.controls);return{total:t.total+o.total,compliant:t.compliant+o.compliantCount,partial:t.partial+o.partialCount,nonCompliant:t.nonCompliant+o.nonCompliantCount,notAssessed:t.notAssessed+o.notAssessedCount}},{total:0,compliant:0,partial:0,nonCompliant:0,notAssessed:0});return e.jsxs(Z,{children:[e.jsxs("div",{ref:P,className:"ato-map-container",children:[e.jsxs("div",{className:"hidden print:block mb-8 text-center border-b-2 border-gray-300 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Authority to Operate (ATO) Assessment Map"}),e.jsx("p",{className:"text-gray-600",children:s.systemName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Generated: ",new Date().toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6 print:hidden",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(J,{className:"w-8 h-8 text-cyan-400"}),"ATO Assessment Map"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Authority to Operate control assessment visualization"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"secondary",onClick:()=>A(!0),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Import"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(O,{variant:"secondary",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Export",e.jsx(q,{className:"w-4 h-4 ml-2"})]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsxs("button",{onClick:xe,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Export as JSON"]}),e.jsxs("button",{onClick:pe,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Export as CSV"]})]})]}),e.jsxs(O,{onClick:me,children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Print"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6 print:hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Engagement:"}),e.jsxs("select",{value:v,onChange:t=>m(t.target.value),className:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white text-sm min-w-[200px]",disabled:y==="sample",children:[e.jsx("option",{value:"",children:"All Assessments"}),f.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.customer_name?`(${t.customer_name})`:""]},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Data Source:"}),e.jsxs("div",{className:"flex bg-gray-800 rounded-lg border border-gray-600 overflow-hidden",children:[e.jsx("button",{onClick:()=>u("real"),className:`px-3 py-2 text-sm ${y==="real"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Real Data"}),e.jsx("button",{onClick:()=>u("sample"),className:`px-3 py-2 text-sm ${y==="sample"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Sample Data"})]})]}),y==="sample"&&e.jsx("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded",children:"Using sample data - no real assessments loaded"}),y==="real"&&f.length===0&&e.jsx("span",{className:"text-xs text-orange-400 bg-orange-500/10 px-2 py-1 rounded",children:"No engagements found - create an engagement to load real data"})]}),e.jsxs(z,{className:"mb-6 print:shadow-none print:border print:border-gray-300",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"System Name"]}),e.jsx("div",{className:"text-white font-semibold",children:s.systemName}),s.systemId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.systemId]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(we,{className:"w-4 h-4"}),"Organization"]}),e.jsx("div",{className:"text-white font-semibold",children:s.organization||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Authorizing Official"]}),e.jsx("div",{className:"text-white font-semibold",children:s.authorizingOfficial||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(Y,{className:"w-4 h-4"}),"Baseline"]}),e.jsx("div",{className:"text-white font-semibold",children:s.baseline}),e.jsx("div",{className:"text-xs text-gray-500",children:s.framework})]})]}),e.jsxs("div",{className:"border-t border-gray-700 px-6 py-4 flex items-center justify-between bg-gray-800/50 print:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Assessment Date:"}),e.jsx("span",{className:"text-white",children:s.assessmentDate||"Ongoing"})]}),s.targetAtoDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-gray-400",children:"Target ATO:"}),e.jsx("span",{className:"text-cyan-400",children:s.targetAtoDate})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:s.poamCount>0&&e.jsxs("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:[s.poamCount," POA&M Items"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(z,{className:"md:col-span-2 print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-6xl font-bold mb-2",style:{color:s.overallScore>=80?"#22c55e":s.overallScore>=60?"#eab308":s.overallScore>=40?"#f97316":"#ef4444"},children:[s.overallScore,"%"]}),e.jsx("div",{className:"text-gray-400",children:"Overall Compliance Score"}),e.jsx("div",{className:"mt-4 h-3 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${s.overallScore}%`,backgroundColor:s.overallScore>=80?"#22c55e":s.overallScore>=60?"#eab308":s.overallScore>=40?"#f97316":"#ef4444"}})})]})}),e.jsx(z,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:$.compliant}),e.jsx("div",{className:"text-sm text-gray-400",children:"Compliant"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.total>0?Math.round($.compliant/$.total*100):0,"%"]})]})}),e.jsx(z,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:$.partial}),e.jsx("div",{className:"text-sm text-gray-400",children:"Partial"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.total>0?Math.round($.partial/$.total*100):0,"%"]})]})}),e.jsx(z,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-400",children:$.nonCompliant}),e.jsx("div",{className:"text-sm text-gray-400",children:"Non-Compliant"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.total>0?Math.round($.nonCompliant/$.total*100):0,"%"]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 text-sm print:text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-500"}),e.jsx("span",{className:"text-gray-300",children:"Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-500"}),e.jsx("span",{className:"text-gray-300",children:"Partially Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-gray-300",children:"Non-Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500"}),e.jsx("span",{className:"text-gray-300",children:"Not Assessed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gray-500"}),e.jsx("span",{className:"text-gray-300",children:"Not Applicable"})]}),e.jsxs("div",{className:"ml-auto flex gap-2 print:hidden",children:[e.jsx(O,{variant:"secondary",size:"sm",onClick:re,children:"Expand All"}),e.jsx(O,{variant:"secondary",size:"sm",onClick:le,children:"Collapse All"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2 flex items-center gap-2 print:hidden",children:[e.jsx(te,{className:"w-4 h-4"}),"Drag control families to reorder"]}),e.jsx("div",{className:"space-y-4",children:s.controlFamilies.map(t=>e.jsx(Fe,{family:t,expanded:i.has(t.id),onToggle:()=>L(t.id),expandedControls:g,onToggleControl:T,onEditControl:ge,isDragging:c===t.id,onDragStart:oe,onDragOver:ie,onDrop:ce,onDragEnd:de},t.id))}),e.jsxs("div",{className:"hidden print:block mt-8 pt-4 border-t border-gray-300 text-center text-sm text-gray-500",children:[e.jsx("p",{children:"Generated by HeroForge Security Assessment Platform"}),e.jsxs("p",{children:["Report Date: ",new Date().toLocaleString()]})]})]}),e.jsx(Re,{isOpen:j,onClose:()=>A(!1),onImport:he}),e.jsx(Te,{control:I,onClose:()=>S(null),onSave:ue}),e.jsx(Le,{atoData:s,onAction:be}),e.jsx("style",{children:`
        @media print {
          body {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
          }
          .ato-map-container {
            padding: 0;
            max-width: none;
          }
          .bg-gray-800, .bg-gray-900 {
            background-color: white !important;
          }
          .text-white, .text-gray-300 {
            color: black !important;
          }
          .text-gray-400, .text-gray-500 {
            color: #666 !important;
          }
          .border-gray-700 {
            border-color: #ccc !important;
          }
        }
      `})]})};export{We as default};
