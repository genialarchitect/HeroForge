import{e as gr,f as pr,j as l}from"./vendor-state-BXNPjUwt.js";import{R as hr,r as S}from"./vendor-react-5KxtEOLM.js";import{s as it,p as Fn,z as On,i as mr,d as Wn,t as xr}from"./vendor-viz-B27Gou7z.js";import{f as xt,y as yt}from"./vendor-charts-B7kFV7Tb.js";import{af as Yn,z as yr,m as Zn,a6 as wr,a7 as br,bq as vr,g as Pt,O as Ve,i as $t,a4 as Xn,aX as Nr,E as Sr,B as fe,a as Er,G as Cr,w as Jt,bw as jr,bx as kr,n as Mr,W as Ar,by as Ir,bs as Pr,aU as $r,aj as en,b7 as Dr,ar as Tr,x as Gn,ai as Lr,X as Un,S as Kn,s as _r,ab as zr}from"./vendor-ui-PizTOSgB.js";import{B as Ne,L as wt}from"./index-DgePDh_X.js";import{L as tn}from"./Layout-CeExTnzB.js";import{L as Hr}from"./LoadingSpinner-p-Ub3czh.js";import"./vendor-utils-DfRopTPV.js";import"./Header-Dw99lsG2.js";import"./vendor-markdown-RN55YrVy.js";function ie(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=ie(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const de={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Be=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],qn=["Enter"," ","Escape"],Qn={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Ie;(function(e){e.Strict="strict",e.Loose="loose"})(Ie||(Ie={}));var Se;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Se||(Se={}));var Fe;(function(e){e.Partial="partial",e.Full="full"})(Fe||(Fe={}));const Jn={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var ye;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(ye||(ye={}));var ne;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(ne||(ne={}));var O;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(O||(O={}));const nn={[O.Left]:O.Right,[O.Right]:O.Left,[O.Top]:O.Bottom,[O.Bottom]:O.Top};function es(e){return e===null?null:e?"valid":"invalid"}const ts=e=>"id"in e&&"source"in e&&"target"in e,Rr=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Dt=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Ze=(e,t=[0,0])=>{const{width:n,height:s}=pe(e),o=e.origin??t,r=n*o[0],i=s*o[1];return{x:e.position.x-r,y:e.position.y-i}},Vr=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,o)=>{const r=typeof o=="string";let i=!t.nodeLookup&&!r?o:void 0;t.nodeLookup&&(i=r?t.nodeLookup.get(o):Dt(o)?o:t.nodeLookup.get(o.id));const a=i?st(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return at(s,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ct(n)},Xe=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(o=>{(t.filter===void 0||t.filter(o))&&(n=at(n,st(o)),s=!0)}),s?ct(n):{x:0,y:0,width:0,height:0}},Tt=(e,t,[n,s,o]=[0,0,1],r=!1,i=!1)=>{const a={...Ue(t,[n,s,o]),width:t.width/o,height:t.height/o},u=[];for(const g of e.values()){const{measured:h,selectable:c=!0,hidden:d=!1}=g;if(i&&!c||d)continue;const x=h.width??g.width??g.initialWidth??null,p=h.height??g.height??g.initialHeight??null,w=Oe(a,$e(g)),m=(x??0)*(p??0),y=r&&w>0;(!g.internals.handleBounds||y||w>=m||g.dragging)&&u.push(g)}return u},Br=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function Fr(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!o.hidden)&&(!s||s.has(o.id))&&n.set(o.id,o)}),n}async function Or({nodes:e,width:t,height:n,panZoom:s,minZoom:o,maxZoom:r},i){if(e.size===0)return Promise.resolve(!0);const a=Fr(e,i),u=Xe(a),g=Lt(u,t,n,(i==null?void 0:i.minZoom)??o,(i==null?void 0:i.maxZoom)??r,(i==null?void 0:i.padding)??.1);return await s.setViewport(g,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function ns({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:o,onError:r}){const i=n.get(e),a=i.parentId?n.get(i.parentId):void 0,{x:u,y:g}=a?a.internals.positionAbsolute:{x:0,y:0},h=i.origin??s;let c=i.extent||o;if(i.extent==="parent"&&!i.expandParent)if(!a)r==null||r("005",de.error005());else{const x=a.measured.width,p=a.measured.height;x&&p&&(c=[[u,g],[u+x,g+p]])}else a&&De(i.extent)&&(c=[[i.extent[0][0]+u,i.extent[0][1]+g],[i.extent[1][0]+u,i.extent[1][1]+g]]);const d=De(c)?Ee(t,c,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&(r==null||r("015",de.error015())),{position:{x:d.x-u+(i.measured.width??0)*h[0],y:d.y-g+(i.measured.height??0)*h[1]},positionAbsolute:d}}async function Wr({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:o}){const r=new Set(e.map(d=>d.id)),i=[];for(const d of n){if(d.deletable===!1)continue;const x=r.has(d.id),p=!x&&d.parentId&&i.find(w=>w.id===d.parentId);(x||p)&&i.push(d)}const a=new Set(t.map(d=>d.id)),u=s.filter(d=>d.deletable!==!1),h=Br(i,u);for(const d of u)a.has(d.id)&&!h.find(p=>p.id===d.id)&&h.push(d);if(!o)return{edges:h,nodes:i};const c=await o({nodes:i,edges:h});return typeof c=="boolean"?c?{edges:h,nodes:i}:{edges:[],nodes:[]}:c}const Pe=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Ee=(e={x:0,y:0},t,n)=>({x:Pe(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Pe(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function ss(e,t,n){const{width:s,height:o}=pe(n),{x:r,y:i}=n.internals.positionAbsolute;return Ee(e,[[r,i],[r+s,i+o]],t)}const sn=(e,t,n)=>e<t?Pe(Math.abs(e-t),1,t)/t:e>n?-Pe(Math.abs(e-n),1,t)/t:0,os=(e,t,n=15,s=40)=>{const o=sn(e.x,s,t.width-s)*n,r=sn(e.y,s,t.height-s)*n;return[o,r]},at=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Ct=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),ct=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),$e=(e,t=[0,0])=>{var o,r;const{x:n,y:s}=Dt(e)?e.internals.positionAbsolute:Ze(e,t);return{x:n,y:s,width:((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0,height:((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0}},st=(e,t=[0,0])=>{var o,r;const{x:n,y:s}=Dt(e)?e.internals.positionAbsolute:Ze(e,t);return{x:n,y:s,x2:n+(((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0),y2:s+(((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0)}},rs=(e,t)=>ct(at(Ct(e),Ct(t))),Oe=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},on=e=>ce(e.width)&&ce(e.height)&&ce(e.x)&&ce(e.y),ce=e=>!isNaN(e)&&isFinite(e),Yr=(e,t)=>{},Ge=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Ue=({x:e,y:t},[n,s,o],r=!1,i=[1,1])=>{const a={x:(e-n)/o,y:(t-s)/o};return r?Ge(a,i):a},ot=({x:e,y:t},[n,s,o])=>({x:e*o+n,y:t*o+s});function ke(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Zr(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=ke(e,n),o=ke(e,t);return{top:s,right:o,bottom:s,left:o,x:o*2,y:s*2}}if(typeof e=="object"){const s=ke(e.top??e.y??0,n),o=ke(e.bottom??e.y??0,n),r=ke(e.left??e.x??0,t),i=ke(e.right??e.x??0,t);return{top:s,right:i,bottom:o,left:r,x:r+i,y:s+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Xr(e,t,n,s,o,r){const{x:i,y:a}=ot(e,[t,n,s]),{x:u,y:g}=ot({x:e.x+e.width,y:e.y+e.height},[t,n,s]),h=o-u,c=r-g;return{left:Math.floor(i),top:Math.floor(a),right:Math.floor(h),bottom:Math.floor(c)}}const Lt=(e,t,n,s,o,r)=>{const i=Zr(r,t,n),a=(t-i.x)/e.width,u=(n-i.y)/e.height,g=Math.min(a,u),h=Pe(g,s,o),c=e.x+e.width/2,d=e.y+e.height/2,x=t/2-c*h,p=n/2-d*h,w=Xr(e,x,p,h,t,n),m={left:Math.min(w.left-i.left,0),top:Math.min(w.top-i.top,0),right:Math.min(w.right-i.right,0),bottom:Math.min(w.bottom-i.bottom,0)};return{x:x-m.left+m.right,y:p-m.top+m.bottom,zoom:h}},We=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function De(e){return e!=null&&e!=="parent"}function pe(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function is(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function as(e,t={width:0,height:0},n,s,o){const r={...e},i=s.get(n);if(i){const a=i.origin||o;r.x+=i.internals.positionAbsolute.x-(t.width??0)*a[0],r.y+=i.internals.positionAbsolute.y-(t.height??0)*a[1]}return r}function rn(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Gr(){let e,t;return{promise:new Promise((s,o)=>{e=s,t=o}),resolve:e,reject:t}}function Ur(e){return{...Qn,...e||{}}}function Re(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:o}){const{x:r,y:i}=le(e),a=Ue({x:r-((o==null?void 0:o.left)??0),y:i-((o==null?void 0:o.top)??0)},s),{x:u,y:g}=n?Ge(a,t):a;return{xSnapped:u,ySnapped:g,...a}}const _t=e=>({width:e.offsetWidth,height:e.offsetHeight}),cs=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},Kr=["INPUT","SELECT","TEXTAREA"];function ls(e){var s,o;const t=((o=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:o[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:Kr.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const ds=e=>"clientX"in e,le=(e,t)=>{var r,i;const n=ds(e),s=n?e.clientX:(r=e.touches)==null?void 0:r[0].clientX,o=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},an=(e,t,n,s,o)=>{const r=t.querySelectorAll(`.${e}`);return!r||!r.length?null:Array.from(r).map(i=>{const a=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(a.left-n.left)/s,y:(a.top-n.top)/s,..._t(i)}})};function us({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:o,sourceControlY:r,targetControlX:i,targetControlY:a}){const u=e*.125+o*.375+i*.375+n*.125,g=t*.125+r*.375+a*.375+s*.125,h=Math.abs(u-e),c=Math.abs(g-t);return[u,g,h,c]}function Je(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function cn({pos:e,x1:t,y1:n,x2:s,y2:o,c:r}){switch(e){case O.Left:return[t-Je(t-s,r),n];case O.Right:return[t+Je(s-t,r),n];case O.Top:return[t,n-Je(n-o,r)];case O.Bottom:return[t,n+Je(o-n,r)]}}function fs({sourceX:e,sourceY:t,sourcePosition:n=O.Bottom,targetX:s,targetY:o,targetPosition:r=O.Top,curvature:i=.25}){const[a,u]=cn({pos:n,x1:e,y1:t,x2:s,y2:o,c:i}),[g,h]=cn({pos:r,x1:s,y1:o,x2:e,y2:t,c:i}),[c,d,x,p]=us({sourceX:e,sourceY:t,targetX:s,targetY:o,sourceControlX:a,sourceControlY:u,targetControlX:g,targetControlY:h});return[`M${e},${t} C${a},${u} ${g},${h} ${s},${o}`,c,d,x,p]}function gs({sourceX:e,sourceY:t,targetX:n,targetY:s}){const o=Math.abs(n-e)/2,r=n<e?n+o:n-o,i=Math.abs(s-t)/2,a=s<t?s+i:s-i;return[r,a,o,i]}function qr({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s=0,elevateOnSelect:o=!1,zIndexMode:r="basic"}){if(r==="manual")return s;const i=o&&n?s+1e3:s,a=Math.max(e.parentId||o&&e.selected?e.internals.z:0,t.parentId||o&&t.selected?t.internals.z:0);return i+a}function Qr({sourceNode:e,targetNode:t,width:n,height:s,transform:o}){const r=at(st(e),st(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:s/o[2]};return Oe(i,ct(r))>0}const Jr=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,ei=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),ps=(e,t,n={})=>{if(!e.source||!e.target)return t;const s=n.getEdgeId||Jr;let o;return ts(e)?o={...e}:o={...e,id:s(e)},ei(o,t)?t:(o.sourceHandle===null&&delete o.sourceHandle,o.targetHandle===null&&delete o.targetHandle,t.concat(o))};function hs({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[o,r,i,a]=gs({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,o,r,i,a]}const ln={[O.Left]:{x:-1,y:0},[O.Right]:{x:1,y:0},[O.Top]:{x:0,y:-1},[O.Bottom]:{x:0,y:1}},ti=({source:e,sourcePosition:t=O.Bottom,target:n})=>t===O.Left||t===O.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},dn=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function ni({source:e,sourcePosition:t=O.Bottom,target:n,targetPosition:s=O.Top,center:o,offset:r,stepPosition:i}){const a=ln[t],u=ln[s],g={x:e.x+a.x*r,y:e.y+a.y*r},h={x:n.x+u.x*r,y:n.y+u.y*r},c=ti({source:g,sourcePosition:t,target:h}),d=c.x!==0?"x":"y",x=c[d];let p=[],w,m;const y={x:0,y:0},b={x:0,y:0},[,,f,v]=gs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[d]*u[d]===-1){d==="x"?(w=o.x??g.x+(h.x-g.x)*i,m=o.y??(g.y+h.y)/2):(w=o.x??(g.x+h.x)/2,m=o.y??g.y+(h.y-g.y)*i);const N=[{x:w,y:g.y},{x:w,y:h.y}],k=[{x:g.x,y:m},{x:h.x,y:m}];a[d]===x?p=d==="x"?N:k:p=d==="x"?k:N}else{const N=[{x:g.x,y:h.y}],k=[{x:h.x,y:g.y}];if(d==="x"?p=a.x===x?k:N:p=a.y===x?N:k,t===s){const E=Math.abs(e[d]-n[d]);if(E<=r){const D=Math.min(r-1,r-E);a[d]===x?y[d]=(g[d]>e[d]?-1:1)*D:b[d]=(h[d]>n[d]?-1:1)*D}}if(t!==s){const E=d==="x"?"y":"x",D=a[d]===u[E],z=g[E]>h[E],_=g[E]<h[E];(a[d]===1&&(!D&&z||D&&_)||a[d]!==1&&(!D&&_||D&&z))&&(p=d==="x"?N:k)}const I={x:g.x+y.x,y:g.y+y.y},A={x:h.x+b.x,y:h.y+b.y},R=Math.max(Math.abs(I.x-p[0].x),Math.abs(A.x-p[0].x)),C=Math.max(Math.abs(I.y-p[0].y),Math.abs(A.y-p[0].y));R>=C?(w=(I.x+A.x)/2,m=p[0].y):(w=p[0].x,m=(I.y+A.y)/2)}return[[e,{x:g.x+y.x,y:g.y+y.y},...p,{x:h.x+b.x,y:h.y+b.y},n],w,m,f,v]}function si(e,t,n,s){const o=Math.min(dn(e,t)/2,dn(t,n)/2,s),{x:r,y:i}=t;if(e.x===r&&r===n.x||e.y===i&&i===n.y)return`L${r} ${i}`;if(e.y===i){const g=e.x<n.x?-1:1,h=e.y<n.y?1:-1;return`L ${r+o*g},${i}Q ${r},${i} ${r},${i+o*h}`}const a=e.x<n.x?1:-1,u=e.y<n.y?-1:1;return`L ${r},${i+o*u}Q ${r},${i} ${r+o*a},${i}`}function jt({sourceX:e,sourceY:t,sourcePosition:n=O.Bottom,targetX:s,targetY:o,targetPosition:r=O.Top,borderRadius:i=5,centerX:a,centerY:u,offset:g=20,stepPosition:h=.5}){const[c,d,x,p,w]=ni({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:o},targetPosition:r,center:{x:a,y:u},offset:g,stepPosition:h});return[c.reduce((y,b,f)=>{let v="";return f>0&&f<c.length-1?v=si(c[f-1],b,c[f+1],i):v=`${f===0?"M":"L"}${b.x} ${b.y}`,y+=v,y},""),d,x,p,w]}function un(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function oi(e){var c;const{sourceNode:t,targetNode:n}=e;if(!un(t)||!un(n))return null;const s=t.internals.handleBounds||fn(t.handles),o=n.internals.handleBounds||fn(n.handles),r=gn((s==null?void 0:s.source)??[],e.sourceHandle),i=gn(e.connectionMode===Ie.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),e.targetHandle);if(!r||!i)return(c=e.onError)==null||c.call(e,"008",de.error008(r?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(r==null?void 0:r.position)||O.Bottom,u=(i==null?void 0:i.position)||O.Top,g=Ce(t,r,a),h=Ce(n,i,u);return{sourceX:g.x,sourceY:g.y,targetX:h.x,targetY:h.y,sourcePosition:a,targetPosition:u}}function fn(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function Ce(e,t,n=O.Left,s=!1){const o=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,r=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:i,height:a}=t??pe(e);if(s)return{x:o+i/2,y:r+a/2};switch((t==null?void 0:t.position)??n){case O.Top:return{x:o+i/2,y:r};case O.Right:return{x:o+i,y:r+a/2};case O.Bottom:return{x:o+i/2,y:r+a};case O.Left:return{x:o,y:r+a/2}}}function gn(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function kt(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function ri(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:o}){const r=new Set;return e.reduce((i,a)=>([a.markerStart||s,a.markerEnd||o].forEach(u=>{if(u&&typeof u=="object"){const g=kt(u,t);r.has(g)||(i.push({id:g,color:u.color||n,...u}),r.add(g))}}),i),[]).sort((i,a)=>i.id.localeCompare(a.id))}const ms=1e3,ii=10,zt={nodeOrigin:[0,0],nodeExtent:Be,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},ai={...zt,checkEquality:!0};function Ht(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function ci(e,t,n){const s=Ht(zt,n);for(const o of e.values())if(o.parentId)Vt(o,e,t,s);else{const r=Ze(o,s.nodeOrigin),i=De(o.extent)?o.extent:s.nodeExtent,a=Ee(r,i,pe(o));o.internals.positionAbsolute=a}}function li(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const o of e.handles){const r={id:o.id,width:o.width??1,height:o.height??1,nodeId:e.id,x:o.x,y:o.y,position:o.position,type:o.type};o.type==="source"?n.push(r):o.type==="target"&&s.push(r)}return{source:n,target:s}}function Rt(e){return e==="manual"}function Mt(e,t,n,s={}){var g,h;const o=Ht(ai,s),r={i:0},i=new Map(t),a=o!=null&&o.elevateNodesOnSelect&&!Rt(o.zIndexMode)?ms:0;let u=e.length>0;t.clear(),n.clear();for(const c of e){let d=i.get(c.id);if(o.checkEquality&&c===(d==null?void 0:d.internals.userNode))t.set(c.id,d);else{const x=Ze(c,o.nodeOrigin),p=De(c.extent)?c.extent:o.nodeExtent,w=Ee(x,p,pe(c));d={...o.defaults,...c,measured:{width:(g=c.measured)==null?void 0:g.width,height:(h=c.measured)==null?void 0:h.height},internals:{positionAbsolute:w,handleBounds:li(c,d),z:xs(c,a,o.zIndexMode),userNode:c}},t.set(c.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(u=!1),c.parentId&&Vt(d,t,n,s,r)}return u}function di(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Vt(e,t,n,s,o){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:a,zIndexMode:u}=Ht(zt,s),g=e.parentId,h=t.get(g);if(!h){console.warn(`Parent node ${g} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}di(e,n),o&&!h.parentId&&h.internals.rootParentIndex===void 0&&u==="auto"&&(h.internals.rootParentIndex=++o.i,h.internals.z=h.internals.z+o.i*ii),o&&h.internals.rootParentIndex!==void 0&&(o.i=h.internals.rootParentIndex);const c=r&&!Rt(u)?ms:0,{x:d,y:x,z:p}=ui(e,h,i,a,c,u),{positionAbsolute:w}=e.internals,m=d!==w.x||x!==w.y;(m||p!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:m?{x:d,y:x}:w,z:p}})}function xs(e,t,n){const s=ce(e.zIndex)?e.zIndex:0;return Rt(n)?s:s+(e.selected?t:0)}function ui(e,t,n,s,o,r){const{x:i,y:a}=t.internals.positionAbsolute,u=pe(e),g=Ze(e,n),h=De(e.extent)?Ee(g,e.extent,u):g;let c=Ee({x:i+h.x,y:a+h.y},s,u);e.extent==="parent"&&(c=ss(c,u,t));const d=xs(e,o,r),x=t.internals.z??0;return{x:c.x,y:c.y,z:x>=d?x+1:d}}function Bt(e,t,n,s=[0,0]){var i;const o=[],r=new Map;for(const a of e){const u=t.get(a.parentId);if(!u)continue;const g=((i=r.get(a.parentId))==null?void 0:i.expandedRect)??$e(u),h=rs(g,a.rect);r.set(a.parentId,{expandedRect:h,parent:u})}return r.size>0&&r.forEach(({expandedRect:a,parent:u},g)=>{var f;const h=u.internals.positionAbsolute,c=pe(u),d=u.origin??s,x=a.x<h.x?Math.round(Math.abs(h.x-a.x)):0,p=a.y<h.y?Math.round(Math.abs(h.y-a.y)):0,w=Math.max(c.width,Math.round(a.width)),m=Math.max(c.height,Math.round(a.height)),y=(w-c.width)*d[0],b=(m-c.height)*d[1];(x>0||p>0||y||b)&&(o.push({id:g,type:"position",position:{x:u.position.x-x+y,y:u.position.y-p+b}}),(f=n.get(g))==null||f.forEach(v=>{e.some(M=>M.id===v.id)||o.push({id:v.id,type:"position",position:{x:v.position.x+x,y:v.position.y+p}})})),(c.width<a.width||c.height<a.height||x||p)&&o.push({id:g,type:"dimensions",setAttributes:!0,dimensions:{width:w+(x?d[0]*x-y:0),height:m+(p?d[1]*p-b:0)}})}),o}function fi(e,t,n,s,o,r,i){const a=s==null?void 0:s.querySelector(".xyflow__viewport");let u=!1;if(!a)return{changes:[],updatedInternals:u};const g=[],h=window.getComputedStyle(a),{m22:c}=new window.DOMMatrixReadOnly(h.transform),d=[];for(const x of e.values()){const p=t.get(x.id);if(!p)continue;if(p.hidden){t.set(p.id,{...p,internals:{...p.internals,handleBounds:void 0}}),u=!0;continue}const w=_t(x.nodeElement),m=p.measured.width!==w.width||p.measured.height!==w.height;if(!!(w.width&&w.height&&(m||!p.internals.handleBounds||x.force))){const b=x.nodeElement.getBoundingClientRect(),f=De(p.extent)?p.extent:r;let{positionAbsolute:v}=p.internals;p.parentId&&p.extent==="parent"?v=ss(v,w,t.get(p.parentId)):f&&(v=Ee(v,f,w));const M={...p,measured:w,internals:{...p.internals,positionAbsolute:v,handleBounds:{source:an("source",x.nodeElement,b,c,p.id),target:an("target",x.nodeElement,b,c,p.id)}}};t.set(p.id,M),p.parentId&&Vt(M,t,n,{nodeOrigin:o,zIndexMode:i}),u=!0,m&&(g.push({id:p.id,type:"dimensions",dimensions:w}),p.expandParent&&p.parentId&&d.push({id:p.id,parentId:p.parentId,rect:$e(M,o)}))}}if(d.length>0){const x=Bt(d,t,n,o);g.push(...x)}return{changes:g,updatedInternals:u}}async function gi({delta:e,panZoom:t,transform:n,translateExtent:s,width:o,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[o,r]],s),a=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(a)}function pn(e,t,n,s,o,r){let i=o;const a=s.get(i)||new Map;s.set(i,a.set(n,t)),i=`${o}-${e}`;const u=s.get(i)||new Map;if(s.set(i,u.set(n,t)),r){i=`${o}-${e}-${r}`;const g=s.get(i)||new Map;s.set(i,g.set(n,t))}}function ys(e,t,n){e.clear(),t.clear();for(const s of n){const{source:o,target:r,sourceHandle:i=null,targetHandle:a=null}=s,u={edgeId:s.id,source:o,target:r,sourceHandle:i,targetHandle:a},g=`${o}-${i}--${r}-${a}`,h=`${r}-${a}--${o}-${i}`;pn("source",u,h,e,o,i),pn("target",u,g,e,r,a),t.set(s.id,s)}}function ws(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:ws(n,t):!1}function hn(e,t,n){var o;let s=e;do{if((o=s==null?void 0:s.matches)!=null&&o.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function pi(e,t,n,s){const o=new Map;for(const[r,i]of e)if((i.selected||i.id===s)&&(!i.parentId||!ws(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const a=e.get(r);a&&o.set(r,{id:r,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return o}function bt({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var i,a,u;const o=[];for(const[g,h]of t){const c=(i=n.get(g))==null?void 0:i.internals.userNode;c&&o.push({...c,position:h.position,dragging:s})}if(!e)return[o[0],o];const r=(a=n.get(e))==null?void 0:a.internals.userNode;return[r?{...r,position:((u=t.get(e))==null?void 0:u.position)||r.position,dragging:s}:o[0],o]}function hi({dragItems:e,snapGrid:t,x:n,y:s}){const o=e.values().next().value;if(!o)return null;const r={x:n-o.distance.x,y:s-o.distance.y},i=Ge(r,t);return{x:i.x-r.x,y:i.y-r.y}}function mi({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:o}){let r={x:null,y:null},i=0,a=new Map,u=!1,g={x:0,y:0},h=null,c=!1,d=null,x=!1,p=!1,w=null;function m({noDragClassName:b,handleSelector:f,domNode:v,isSelectable:M,nodeId:N,nodeClickDistance:k=0}){d=it(v);function I({x:E,y:D}){const{nodeLookup:z,nodeExtent:_,snapGrid:V,snapToGrid:H,nodeOrigin:P,onNodeDrag:j,onSelectionDrag:$,onError:T,updateNodePositions:L}=t();r={x:E,y:D};let B=!1;const W=a.size>1,K=W&&_?Ct(Xe(a)):null,q=W&&H?hi({dragItems:a,snapGrid:V,x:E,y:D}):null;for(const[Y,F]of a){if(!z.has(Y))continue;let G={x:E-F.distance.x,y:D-F.distance.y};H&&(G=q?{x:Math.round(G.x+q.x),y:Math.round(G.y+q.y)}:Ge(G,V));let Q=null;if(W&&_&&!F.extent&&K){const{positionAbsolute:Z}=F.internals,te=Z.x-K.x+_[0][0],se=Z.x+F.measured.width-K.x2+_[1][0],ee=Z.y-K.y+_[0][1],ae=Z.y+F.measured.height-K.y2+_[1][1];Q=[[te,ee],[se,ae]]}const{position:U,positionAbsolute:X}=ns({nodeId:Y,nextPosition:G,nodeLookup:z,nodeExtent:Q||_,nodeOrigin:P,onError:T});B=B||F.position.x!==U.x||F.position.y!==U.y,F.position=U,F.internals.positionAbsolute=X}if(p=p||B,!!B&&(L(a,!0),w&&(s||j||!N&&$))){const[Y,F]=bt({nodeId:N,dragItems:a,nodeLookup:z});s==null||s(w,a,Y,F),j==null||j(w,Y,F),N||$==null||$(w,F)}}async function A(){if(!h)return;const{transform:E,panBy:D,autoPanSpeed:z,autoPanOnNodeDrag:_}=t();if(!_){u=!1,cancelAnimationFrame(i);return}const[V,H]=os(g,h,z);(V!==0||H!==0)&&(r.x=(r.x??0)-V/E[2],r.y=(r.y??0)-H/E[2],await D({x:V,y:H})&&I(r)),i=requestAnimationFrame(A)}function R(E){var W;const{nodeLookup:D,multiSelectionActive:z,nodesDraggable:_,transform:V,snapGrid:H,snapToGrid:P,selectNodesOnDrag:j,onNodeDragStart:$,onSelectionDragStart:T,unselectNodesAndEdges:L}=t();c=!0,(!j||!M)&&!z&&N&&((W=D.get(N))!=null&&W.selected||L()),M&&j&&N&&(e==null||e(N));const B=Re(E.sourceEvent,{transform:V,snapGrid:H,snapToGrid:P,containerBounds:h});if(r=B,a=pi(D,_,B,N),a.size>0&&(n||$||!N&&T)){const[K,q]=bt({nodeId:N,dragItems:a,nodeLookup:D});n==null||n(E.sourceEvent,a,K,q),$==null||$(E.sourceEvent,K,q),N||T==null||T(E.sourceEvent,q)}}const C=Wn().clickDistance(k).on("start",E=>{const{domNode:D,nodeDragThreshold:z,transform:_,snapGrid:V,snapToGrid:H}=t();h=(D==null?void 0:D.getBoundingClientRect())||null,x=!1,p=!1,w=E.sourceEvent,z===0&&R(E),r=Re(E.sourceEvent,{transform:_,snapGrid:V,snapToGrid:H,containerBounds:h}),g=le(E.sourceEvent,h)}).on("drag",E=>{const{autoPanOnNodeDrag:D,transform:z,snapGrid:_,snapToGrid:V,nodeDragThreshold:H,nodeLookup:P}=t(),j=Re(E.sourceEvent,{transform:z,snapGrid:_,snapToGrid:V,containerBounds:h});if(w=E.sourceEvent,(E.sourceEvent.type==="touchmove"&&E.sourceEvent.touches.length>1||N&&!P.has(N))&&(x=!0),!x){if(!u&&D&&c&&(u=!0,A()),!c){const $=le(E.sourceEvent,h),T=$.x-g.x,L=$.y-g.y;Math.sqrt(T*T+L*L)>H&&R(E)}(r.x!==j.xSnapped||r.y!==j.ySnapped)&&a&&c&&(g=le(E.sourceEvent,h),I(j))}}).on("end",E=>{if(!(!c||x)&&(u=!1,c=!1,cancelAnimationFrame(i),a.size>0)){const{nodeLookup:D,updateNodePositions:z,onNodeDragStop:_,onSelectionDragStop:V}=t();if(p&&(z(a,!1),p=!1),o||_||!N&&V){const[H,P]=bt({nodeId:N,dragItems:a,nodeLookup:D,dragging:!1});o==null||o(E.sourceEvent,a,H,P),_==null||_(E.sourceEvent,H,P),N||V==null||V(E.sourceEvent,P)}}}).filter(E=>{const D=E.target;return!E.button&&(!b||!hn(D,`.${b}`,v))&&(!f||hn(D,f,v))});d.call(C)}function y(){d==null||d.on(".drag",null)}return{update:m,destroy:y}}function xi(e,t,n){const s=[],o={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const r of t.values())Oe(o,$e(r))>0&&s.push(r);return s}const yi=250;function wi(e,t,n,s){var a,u;let o=[],r=1/0;const i=xi(e,n,t+yi);for(const g of i){const h=[...((a=g.internals.handleBounds)==null?void 0:a.source)??[],...((u=g.internals.handleBounds)==null?void 0:u.target)??[]];for(const c of h){if(s.nodeId===c.nodeId&&s.type===c.type&&s.id===c.id)continue;const{x:d,y:x}=Ce(g,c,c.position,!0),p=Math.sqrt(Math.pow(d-e.x,2)+Math.pow(x-e.y,2));p>t||(p<r?(o=[{...c,x:d,y:x}],r=p):p===r&&o.push({...c,x:d,y:x}))}}if(!o.length)return null;if(o.length>1){const g=s.type==="source"?"target":"source";return o.find(h=>h.type===g)??o[0]}return o[0]}function bs(e,t,n,s,o,r=!1){var g,h,c;const i=s.get(e);if(!i)return null;const a=o==="strict"?(g=i.internals.handleBounds)==null?void 0:g[t]:[...((h=i.internals.handleBounds)==null?void 0:h.source)??[],...((c=i.internals.handleBounds)==null?void 0:c.target)??[]],u=(n?a==null?void 0:a.find(d=>d.id===n):a==null?void 0:a[0])??null;return u&&r?{...u,...Ce(i,u,u.position,!0)}:u}function vs(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function bi(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Ns=()=>!0;function vi(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:o,edgeUpdaterType:r,isTarget:i,domNode:a,nodeLookup:u,lib:g,autoPanOnConnect:h,flowId:c,panBy:d,cancelConnection:x,onConnectStart:p,onConnect:w,onConnectEnd:m,isValidConnection:y=Ns,onReconnectEnd:b,updateConnection:f,getTransform:v,getFromHandle:M,autoPanSpeed:N,dragThreshold:k=1,handleDomNode:I}){const A=cs(e.target);let R=0,C;const{x:E,y:D}=le(e),z=vs(r,I),_=a==null?void 0:a.getBoundingClientRect();let V=!1;if(!_||!z)return;const H=bs(o,z,s,u,t);if(!H)return;let P=le(e,_),j=!1,$=null,T=!1,L=null;function B(){if(!h||!_)return;const[U,X]=os(P,_,N);d({x:U,y:X}),R=requestAnimationFrame(B)}const W={...H,nodeId:o,type:z,position:H.position},K=u.get(o);let Y={inProgress:!0,isValid:null,from:Ce(K,W,O.Left,!0),fromHandle:W,fromPosition:W.position,fromNode:K,to:P,toHandle:null,toPosition:nn[W.position],toNode:null,pointer:P};function F(){V=!0,f(Y),p==null||p(e,{nodeId:o,handleId:s,handleType:z})}k===0&&F();function G(U){if(!V){const{x:ae,y:he}=le(U),ue=ae-E,be=he-D;if(!(ue*ue+be*be>k*k))return;F()}if(!M()||!W){Q(U);return}const X=v();P=le(U,_),C=wi(Ue(P,X,!1,[1,1]),n,u,W),j||(B(),j=!0);const Z=Ss(U,{handle:C,connectionMode:t,fromNodeId:o,fromHandleId:s,fromType:i?"target":"source",isValidConnection:y,doc:A,lib:g,flowId:c,nodeLookup:u});L=Z.handleDomNode,$=Z.connection,T=bi(!!C,Z.isValid);const te=u.get(o),se=te?Ce(te,W,O.Left,!0):Y.from,ee={...Y,from:se,isValid:T,to:Z.toHandle&&T?ot({x:Z.toHandle.x,y:Z.toHandle.y},X):P,toHandle:Z.toHandle,toPosition:T&&Z.toHandle?Z.toHandle.position:nn[W.position],toNode:Z.toHandle?u.get(Z.toHandle.nodeId):null,pointer:P};f(ee),Y=ee}function Q(U){if(!("touches"in U&&U.touches.length>0)){if(V){(C||L)&&$&&T&&(w==null||w($));const{inProgress:X,...Z}=Y,te={...Z,toPosition:Y.toHandle?Y.toPosition:null};m==null||m(U,te),r&&(b==null||b(U,te))}x(),cancelAnimationFrame(R),j=!1,T=!1,$=null,L=null,A.removeEventListener("mousemove",G),A.removeEventListener("mouseup",Q),A.removeEventListener("touchmove",G),A.removeEventListener("touchend",Q)}}A.addEventListener("mousemove",G),A.addEventListener("mouseup",Q),A.addEventListener("touchmove",G),A.addEventListener("touchend",Q)}function Ss(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:o,fromType:r,doc:i,lib:a,flowId:u,isValidConnection:g=Ns,nodeLookup:h}){const c=r==="target",d=t?i.querySelector(`.${a}-flow__handle[data-id="${u}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x,y:p}=le(e),w=i.elementFromPoint(x,p),m=w!=null&&w.classList.contains(`${a}-flow__handle`)?w:d,y={handleDomNode:m,isValid:!1,connection:null,toHandle:null};if(m){const b=vs(void 0,m),f=m.getAttribute("data-nodeid"),v=m.getAttribute("data-handleid"),M=m.classList.contains("connectable"),N=m.classList.contains("connectableend");if(!f||!b)return y;const k={source:c?f:s,sourceHandle:c?v:o,target:c?s:f,targetHandle:c?o:v};y.connection=k;const A=M&&N&&(n===Ie.Strict?c&&b==="source"||!c&&b==="target":f!==s||v!==o);y.isValid=A&&g(k),y.toHandle=bs(f,b,v,h,n,!0)}return y}const At={onPointerDown:vi,isValid:Ss};function Ni({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const o=it(e);function r({translateExtent:a,width:u,height:g,zoomStep:h=1,pannable:c=!0,zoomable:d=!0,inversePan:x=!1}){const p=f=>{if(f.sourceEvent.type!=="wheel"||!t)return;const v=n(),M=f.sourceEvent.ctrlKey&&We()?10:1,N=-f.sourceEvent.deltaY*(f.sourceEvent.deltaMode===1?.05:f.sourceEvent.deltaMode?1:.002)*h,k=v[2]*Math.pow(2,N*M);t.scaleTo(k)};let w=[0,0];const m=f=>{(f.sourceEvent.type==="mousedown"||f.sourceEvent.type==="touchstart")&&(w=[f.sourceEvent.clientX??f.sourceEvent.touches[0].clientX,f.sourceEvent.clientY??f.sourceEvent.touches[0].clientY])},y=f=>{const v=n();if(f.sourceEvent.type!=="mousemove"&&f.sourceEvent.type!=="touchmove"||!t)return;const M=[f.sourceEvent.clientX??f.sourceEvent.touches[0].clientX,f.sourceEvent.clientY??f.sourceEvent.touches[0].clientY],N=[M[0]-w[0],M[1]-w[1]];w=M;const k=s()*Math.max(v[2],Math.log(v[2]))*(x?-1:1),I={x:v[0]-N[0]*k,y:v[1]-N[1]*k},A=[[0,0],[u,g]];t.setViewportConstrained({x:I.x,y:I.y,zoom:v[2]},A,a)},b=On().on("start",m).on("zoom",c?y:null).on("zoom.wheel",d?p:null);o.call(b,{})}function i(){o.on("zoom",null)}return{update:r,destroy:i,pointer:Fn}}const lt=e=>({x:e.x,y:e.y,zoom:e.k}),vt=({x:e,y:t,zoom:n})=>mr.translate(e,t).scale(n),Me=(e,t)=>e.target.closest(`.${t}`),Es=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Si=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Nt=(e,t=0,n=Si,s=()=>{})=>{const o=typeof t=="number"&&t>0;return o||s(),o?e.transition().duration(t).ease(n).on("end",s):e},Cs=e=>{const t=e.ctrlKey&&We()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Ei({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:o,panOnScrollSpeed:r,zoomOnPinch:i,onPanZoomStart:a,onPanZoom:u,onPanZoomEnd:g}){return h=>{if(Me(h,t))return h.ctrlKey&&h.preventDefault(),!1;h.preventDefault(),h.stopImmediatePropagation();const c=n.property("__zoom").k||1;if(h.ctrlKey&&i){const m=Fn(h),y=Cs(h),b=c*Math.pow(2,y);s.scaleTo(n,b,m,h);return}const d=h.deltaMode===1?20:1;let x=o===Se.Vertical?0:h.deltaX*d,p=o===Se.Horizontal?0:h.deltaY*d;!We()&&h.shiftKey&&o!==Se.Vertical&&(x=h.deltaY*d,p=0),s.translateBy(n,-(x/c)*r,-(p/c)*r,{internal:!0});const w=lt(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(u==null||u(h,w),e.panScrollTimeout=setTimeout(()=>{g==null||g(h,w),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,a==null||a(h,w))}}function Ci({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,o){const r=s.type==="wheel",i=!t&&r&&!s.ctrlKey,a=Me(s,e);if(s.ctrlKey&&r&&a&&s.preventDefault(),i||a)return null;s.preventDefault(),n.call(this,s,o)}}function ji({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var r,i,a;if((r=s.sourceEvent)!=null&&r.internal)return;const o=lt(s.transform);e.mouseButton=((i=s.sourceEvent)==null?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=o,((a=s.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,o))}}function ki({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:o}){return r=>{var i,a;e.usedRightMouseButton=!!(n&&Es(t,e.mouseButton??0)),(i=r.sourceEvent)!=null&&i.sync||s([r.transform.x,r.transform.y,r.transform.k]),o&&!((a=r.sourceEvent)!=null&&a.internal)&&(o==null||o(r.sourceEvent,lt(r.transform)))}}function Mi({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:o,onPaneContextMenu:r}){return i=>{var a;if(!((a=i.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,r&&Es(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&r(i.sourceEvent),e.usedRightMouseButton=!1,s(!1),o)){const u=lt(i.transform);e.prevViewport=u,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o==null||o(i.sourceEvent,u)},n?150:0)}}}function Ai({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:o,zoomOnDoubleClick:r,userSelectionActive:i,noWheelClassName:a,noPanClassName:u,lib:g,connectionInProgress:h}){return c=>{var m;const d=e||t,x=n&&c.ctrlKey,p=c.type==="wheel";if(c.button===1&&c.type==="mousedown"&&(Me(c,`${g}-flow__node`)||Me(c,`${g}-flow__edge`)))return!0;if(!s&&!d&&!o&&!r&&!n||i||h&&!p||Me(c,a)&&p||Me(c,u)&&(!p||o&&p&&!e)||!n&&c.ctrlKey&&p)return!1;if(!n&&c.type==="touchstart"&&((m=c.touches)==null?void 0:m.length)>1)return c.preventDefault(),!1;if(!d&&!o&&!x&&p||!s&&(c.type==="mousedown"||c.type==="touchstart")||Array.isArray(s)&&!s.includes(c.button)&&c.type==="mousedown")return!1;const w=Array.isArray(s)&&s.includes(c.button)||!c.button||c.button<=1;return(!c.ctrlKey||p)&&w}}function Ii({domNode:e,minZoom:t,maxZoom:n,translateExtent:s,viewport:o,onPanZoom:r,onPanZoomStart:i,onPanZoomEnd:a,onDraggingChange:u}){const g={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},h=e.getBoundingClientRect(),c=On().scaleExtent([t,n]).translateExtent(s),d=it(e).call(c);b({x:o.x,y:o.y,zoom:Pe(o.zoom,t,n)},[[0,0],[h.width,h.height]],s);const x=d.on("wheel.zoom"),p=d.on("dblclick.zoom");c.wheelDelta(Cs);function w(C,E){return d?new Promise(D=>{c==null||c.interpolate((E==null?void 0:E.interpolate)==="linear"?yt:xt).transform(Nt(d,E==null?void 0:E.duration,E==null?void 0:E.ease,()=>D(!0)),C)}):Promise.resolve(!1)}function m({noWheelClassName:C,noPanClassName:E,onPaneContextMenu:D,userSelectionActive:z,panOnScroll:_,panOnDrag:V,panOnScrollMode:H,panOnScrollSpeed:P,preventScrolling:j,zoomOnPinch:$,zoomOnScroll:T,zoomOnDoubleClick:L,zoomActivationKeyPressed:B,lib:W,onTransformChange:K,connectionInProgress:q,paneClickDistance:Y,selectionOnDrag:F}){z&&!g.isZoomingOrPanning&&y();const G=_&&!B&&!z;c.clickDistance(F?1/0:!ce(Y)||Y<0?0:Y);const Q=G?Ei({zoomPanValues:g,noWheelClassName:C,d3Selection:d,d3Zoom:c,panOnScrollMode:H,panOnScrollSpeed:P,zoomOnPinch:$,onPanZoomStart:i,onPanZoom:r,onPanZoomEnd:a}):Ci({noWheelClassName:C,preventScrolling:j,d3ZoomHandler:x});if(d.on("wheel.zoom",Q,{passive:!1}),!z){const X=ji({zoomPanValues:g,onDraggingChange:u,onPanZoomStart:i});c.on("start",X);const Z=ki({zoomPanValues:g,panOnDrag:V,onPaneContextMenu:!!D,onPanZoom:r,onTransformChange:K});c.on("zoom",Z);const te=Mi({zoomPanValues:g,panOnDrag:V,panOnScroll:_,onPaneContextMenu:D,onPanZoomEnd:a,onDraggingChange:u});c.on("end",te)}const U=Ai({zoomActivationKeyPressed:B,panOnDrag:V,zoomOnScroll:T,panOnScroll:_,zoomOnDoubleClick:L,zoomOnPinch:$,userSelectionActive:z,noPanClassName:E,noWheelClassName:C,lib:W,connectionInProgress:q});c.filter(U),L?d.on("dblclick.zoom",p):d.on("dblclick.zoom",null)}function y(){c.on("zoom",null)}async function b(C,E,D){const z=vt(C),_=c==null?void 0:c.constrain()(z,E,D);return _&&await w(_),new Promise(V=>V(_))}async function f(C,E){const D=vt(C);return await w(D,E),new Promise(z=>z(D))}function v(C){if(d){const E=vt(C),D=d.property("__zoom");(D.k!==C.zoom||D.x!==C.x||D.y!==C.y)&&(c==null||c.transform(d,E,null,{sync:!0}))}}function M(){const C=d?xr(d.node()):{x:0,y:0,k:1};return{x:C.x,y:C.y,zoom:C.k}}function N(C,E){return d?new Promise(D=>{c==null||c.interpolate((E==null?void 0:E.interpolate)==="linear"?yt:xt).scaleTo(Nt(d,E==null?void 0:E.duration,E==null?void 0:E.ease,()=>D(!0)),C)}):Promise.resolve(!1)}function k(C,E){return d?new Promise(D=>{c==null||c.interpolate((E==null?void 0:E.interpolate)==="linear"?yt:xt).scaleBy(Nt(d,E==null?void 0:E.duration,E==null?void 0:E.ease,()=>D(!0)),C)}):Promise.resolve(!1)}function I(C){c==null||c.scaleExtent(C)}function A(C){c==null||c.translateExtent(C)}function R(C){const E=!ce(C)||C<0?0:C;c==null||c.clickDistance(E)}return{update:m,destroy:y,setViewport:f,setViewportConstrained:b,getViewport:M,scaleTo:N,scaleBy:k,setScaleExtent:I,setTranslateExtent:A,syncViewport:v,setClickDistance:R}}var Te;(function(e){e.Line="line",e.Handle="handle"})(Te||(Te={}));function Pi({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:o,affectsY:r}){const i=e-t,a=n-s,u=[i>0?1:i<0?-1:0,a>0?1:a<0?-1:0];return i&&o&&(u[0]=u[0]*-1),a&&r&&(u[1]=u[1]*-1),u}function mn(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:o}}function me(e,t){return Math.max(0,t-e)}function xe(e,t){return Math.max(0,e-t)}function et(e,t,n){return Math.max(0,t-e,e-n)}function xn(e,t){return e?!t:t}function $i(e,t,n,s,o,r,i,a){let{affectsX:u,affectsY:g}=t;const{isHorizontal:h,isVertical:c}=t,d=h&&c,{xSnapped:x,ySnapped:p}=n,{minWidth:w,maxWidth:m,minHeight:y,maxHeight:b}=s,{x:f,y:v,width:M,height:N,aspectRatio:k}=e;let I=Math.floor(h?x-e.pointerX:0),A=Math.floor(c?p-e.pointerY:0);const R=M+(u?-I:I),C=N+(g?-A:A),E=-r[0]*M,D=-r[1]*N;let z=et(R,w,m),_=et(C,y,b);if(i){let P=0,j=0;u&&I<0?P=me(f+I+E,i[0][0]):!u&&I>0&&(P=xe(f+R+E,i[1][0])),g&&A<0?j=me(v+A+D,i[0][1]):!g&&A>0&&(j=xe(v+C+D,i[1][1])),z=Math.max(z,P),_=Math.max(_,j)}if(a){let P=0,j=0;u&&I>0?P=xe(f+I,a[0][0]):!u&&I<0&&(P=me(f+R,a[1][0])),g&&A>0?j=xe(v+A,a[0][1]):!g&&A<0&&(j=me(v+C,a[1][1])),z=Math.max(z,P),_=Math.max(_,j)}if(o){if(h){const P=et(R/k,y,b)*k;if(z=Math.max(z,P),i){let j=0;!u&&!g||u&&!g&&d?j=xe(v+D+R/k,i[1][1])*k:j=me(v+D+(u?I:-I)/k,i[0][1])*k,z=Math.max(z,j)}if(a){let j=0;!u&&!g||u&&!g&&d?j=me(v+R/k,a[1][1])*k:j=xe(v+(u?I:-I)/k,a[0][1])*k,z=Math.max(z,j)}}if(c){const P=et(C*k,w,m)/k;if(_=Math.max(_,P),i){let j=0;!u&&!g||g&&!u&&d?j=xe(f+C*k+E,i[1][0])/k:j=me(f+(g?A:-A)*k+E,i[0][0])/k,_=Math.max(_,j)}if(a){let j=0;!u&&!g||g&&!u&&d?j=me(f+C*k,a[1][0])/k:j=xe(f+(g?A:-A)*k,a[0][0])/k,_=Math.max(_,j)}}}A=A+(A<0?_:-_),I=I+(I<0?z:-z),o&&(d?R>C*k?A=(xn(u,g)?-I:I)/k:I=(xn(u,g)?-A:A)*k:h?(A=I/k,g=u):(I=A*k,u=g));const V=u?f+I:f,H=g?v+A:v;return{width:M+(u?-I:I),height:N+(g?-A:A),x:r[0]*I*(u?-1:1)+V,y:r[1]*A*(g?-1:1)+H}}const js={width:0,height:0,x:0,y:0},Di={...js,pointerX:0,pointerY:0,aspectRatio:1};function Ti(e){return[[0,0],[e.measured.width,e.measured.height]]}function Li(e,t,n){const s=t.position.x+e.position.x,o=t.position.y+e.position.y,r=e.measured.width??0,i=e.measured.height??0,a=n[0]*r,u=n[1]*i;return[[s-a,o-u],[s+r-a,o+i-u]]}function _i({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:o}){const r=it(e);let i={controlDirection:mn("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:g,boundaries:h,keepAspectRatio:c,resizeDirection:d,onResizeStart:x,onResize:p,onResizeEnd:w,shouldResize:m}){let y={...js},b={...Di};i={boundaries:h,resizeDirection:d,keepAspectRatio:c,controlDirection:mn(g)};let f,v=null,M=[],N,k,I,A=!1;const R=Wn().on("start",C=>{const{nodeLookup:E,transform:D,snapGrid:z,snapToGrid:_,nodeOrigin:V,paneDomNode:H}=n();if(f=E.get(t),!f)return;v=(H==null?void 0:H.getBoundingClientRect())??null;const{xSnapped:P,ySnapped:j}=Re(C.sourceEvent,{transform:D,snapGrid:z,snapToGrid:_,containerBounds:v});y={width:f.measured.width??0,height:f.measured.height??0,x:f.position.x??0,y:f.position.y??0},b={...y,pointerX:P,pointerY:j,aspectRatio:y.width/y.height},N=void 0,f.parentId&&(f.extent==="parent"||f.expandParent)&&(N=E.get(f.parentId),k=N&&f.extent==="parent"?Ti(N):void 0),M=[],I=void 0;for(const[$,T]of E)if(T.parentId===t&&(M.push({id:$,position:{...T.position},extent:T.extent}),T.extent==="parent"||T.expandParent)){const L=Li(T,f,T.origin??V);I?I=[[Math.min(L[0][0],I[0][0]),Math.min(L[0][1],I[0][1])],[Math.max(L[1][0],I[1][0]),Math.max(L[1][1],I[1][1])]]:I=L}x==null||x(C,{...y})}).on("drag",C=>{const{transform:E,snapGrid:D,snapToGrid:z,nodeOrigin:_}=n(),V=Re(C.sourceEvent,{transform:E,snapGrid:D,snapToGrid:z,containerBounds:v}),H=[];if(!f)return;const{x:P,y:j,width:$,height:T}=y,L={},B=f.origin??_,{width:W,height:K,x:q,y:Y}=$i(b,i.controlDirection,V,i.boundaries,i.keepAspectRatio,B,k,I),F=W!==$,G=K!==T,Q=q!==P&&F,U=Y!==j&&G;if(!Q&&!U&&!F&&!G)return;if((Q||U||B[0]===1||B[1]===1)&&(L.x=Q?q:y.x,L.y=U?Y:y.y,y.x=L.x,y.y=L.y,M.length>0)){const se=q-P,ee=Y-j;for(const ae of M)ae.position={x:ae.position.x-se+B[0]*(W-$),y:ae.position.y-ee+B[1]*(K-T)},H.push(ae)}if((F||G)&&(L.width=F&&(!i.resizeDirection||i.resizeDirection==="horizontal")?W:y.width,L.height=G&&(!i.resizeDirection||i.resizeDirection==="vertical")?K:y.height,y.width=L.width,y.height=L.height),N&&f.expandParent){const se=B[0]*(L.width??0);L.x&&L.x<se&&(y.x=se,b.x=b.x-(L.x-se));const ee=B[1]*(L.height??0);L.y&&L.y<ee&&(y.y=ee,b.y=b.y-(L.y-ee))}const X=Pi({width:y.width,prevWidth:$,height:y.height,prevHeight:T,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),Z={...y,direction:X};(m==null?void 0:m(C,Z))!==!1&&(A=!0,p==null||p(C,Z),s(L,H))}).on("end",C=>{A&&(w==null||w(C,{...y}),o==null||o({...y}),A=!1)});r.call(R)}function u(){r.on(".drag",null)}return{update:a,destroy:u}}const{useDebugValue:zi}=hr,{useSyncExternalStoreWithSelector:Hi}=gr,Ri=e=>e;function ks(e,t=Ri,n){const s=Hi(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return zi(s),s}const yn=(e,t)=>{const n=pr(e),s=(o,r=t)=>ks(n,o,r);return Object.assign(s,n),s},Vi=(e,t)=>e?yn(e,t):yn;function oe(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,o]of e)if(!Object.is(o,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const dt=S.createContext(null),Bi=dt.Provider,Ms=de.error001();function J(e,t){const n=S.useContext(dt);if(n===null)throw new Error(Ms);return ks(n,e,t)}function re(){const e=S.useContext(dt);if(e===null)throw new Error(Ms);return S.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const wn={display:"none"},Fi={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},As="react-flow__node-desc",Is="react-flow__edge-desc",Oi="react-flow__aria-live",Wi=e=>e.ariaLiveMessage,Yi=e=>e.ariaLabelConfig;function Zi({rfId:e}){const t=J(Wi);return l.jsx("div",{id:`${Oi}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Fi,children:t})}function Xi({rfId:e,disableKeyboardA11y:t}){const n=J(Yi);return l.jsxs(l.Fragment,{children:[l.jsx("div",{id:`${As}-${e}`,style:wn,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),l.jsx("div",{id:`${Is}-${e}`,style:wn,children:n["edge.a11yDescription.default"]}),!t&&l.jsx(Zi,{rfId:e})]})}const Ke=S.forwardRef(({position:e="top-left",children:t,className:n,style:s,...o},r)=>{const i=`${e}`.split("-");return l.jsx("div",{className:ie(["react-flow__panel",n,...i]),style:s,ref:r,...o,children:t})});Ke.displayName="Panel";function Gi({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:l.jsx(Ke,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:l.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Ui=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},tt=e=>e.id;function Ki(e,t){return oe(e.selectedNodes.map(tt),t.selectedNodes.map(tt))&&oe(e.selectedEdges.map(tt),t.selectedEdges.map(tt))}function qi({onSelectionChange:e}){const t=re(),{selectedNodes:n,selectedEdges:s}=J(Ui,Ki);return S.useEffect(()=>{const o={nodes:n,edges:s};e==null||e(o),t.getState().onSelectionChangeHandlers.forEach(r=>r(o))},[n,s,e]),null}const Qi=e=>!!e.onSelectionChangeHandlers;function Ji({onSelectionChange:e}){const t=J(Qi);return e||t?l.jsx(qi,{onSelectionChange:e}):null}const Ps=[0,0],ea={x:0,y:0,zoom:1},ta=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],bn=[...ta,"rfId"],na=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),vn={translateExtent:Be,nodeOrigin:Ps,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function sa(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:o,setTranslateExtent:r,setNodeExtent:i,reset:a,setDefaultNodesAndEdges:u}=J(na,oe),g=re();S.useEffect(()=>(u(e.defaultNodes,e.defaultEdges),()=>{h.current=vn,a()}),[]);const h=S.useRef(vn);return S.useEffect(()=>{for(const c of bn){const d=e[c],x=h.current[c];d!==x&&(typeof e[c]>"u"||(c==="nodes"?t(d):c==="edges"?n(d):c==="minZoom"?s(d):c==="maxZoom"?o(d):c==="translateExtent"?r(d):c==="nodeExtent"?i(d):c==="ariaLabelConfig"?g.setState({ariaLabelConfig:Ur(d)}):c==="fitView"?g.setState({fitViewQueued:d}):c==="fitViewOptions"?g.setState({fitViewOptions:d}):g.setState({[c]:d})))}h.current=e},bn.map(c=>e[c])),null}function Nn(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function oa(e){var s;const[t,n]=S.useState(e==="system"?null:e);return S.useEffect(()=>{if(e!=="system"){n(e);return}const o=Nn(),r=()=>n(o!=null&&o.matches?"dark":"light");return r(),o==null||o.addEventListener("change",r),()=>{o==null||o.removeEventListener("change",r)}},[e]),t!==null?t:(s=Nn())!=null&&s.matches?"dark":"light"}const Sn=typeof document<"u"?document:null;function Ye(e=null,t={target:Sn,actInsideInputWithModifier:!0}){const[n,s]=S.useState(!1),o=S.useRef(!1),r=S.useRef(new Set([])),[i,a]=S.useMemo(()=>{if(e!==null){const g=(Array.isArray(e)?e:[e]).filter(c=>typeof c=="string").map(c=>c.replace("+",`
`).replace(`

`,`
+`).split(`
`)),h=g.reduce((c,d)=>c.concat(...d),[]);return[g,h]}return[[],[]]},[e]);return S.useEffect(()=>{const u=(t==null?void 0:t.target)??Sn,g=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const h=x=>{var m,y;if(o.current=x.ctrlKey||x.metaKey||x.shiftKey||x.altKey,(!o.current||o.current&&!g)&&ls(x))return!1;const w=Cn(x.code,a);if(r.current.add(x[w]),En(i,r.current,!1)){const b=((y=(m=x.composedPath)==null?void 0:m.call(x))==null?void 0:y[0])||x.target,f=(b==null?void 0:b.nodeName)==="BUTTON"||(b==null?void 0:b.nodeName)==="A";t.preventDefault!==!1&&(o.current||!f)&&x.preventDefault(),s(!0)}},c=x=>{const p=Cn(x.code,a);En(i,r.current,!0)?(s(!1),r.current.clear()):r.current.delete(x[p]),x.key==="Meta"&&r.current.clear(),o.current=!1},d=()=>{r.current.clear(),s(!1)};return u==null||u.addEventListener("keydown",h),u==null||u.addEventListener("keyup",c),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{u==null||u.removeEventListener("keydown",h),u==null||u.removeEventListener("keyup",c),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,s]),n}function En(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(o=>t.has(o)))}function Cn(e,t){return t.includes(e)?"code":"key"}const ra=()=>{const e=re();return S.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,o,r],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??s,y:t.y??o,zoom:t.zoom??r},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:o,minZoom:r,maxZoom:i,panZoom:a}=e.getState(),u=Lt(t,s,o,r,i,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(u,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:o,snapToGrid:r,domNode:i}=e.getState();if(!i)return t;const{x:a,y:u}=i.getBoundingClientRect(),g={x:t.x-a,y:t.y-u},h=n.snapGrid??o,c=n.snapToGrid??r;return Ue(g,s,c,h)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:o,y:r}=s.getBoundingClientRect(),i=ot(t,n);return{x:i.x+o,y:i.y+r}}}),[])};function $s(e,t){const n=[],s=new Map,o=[];for(const r of e)if(r.type==="add"){o.push(r);continue}else if(r.type==="remove"||r.type==="replace")s.set(r.id,[r]);else{const i=s.get(r.id);i?i.push(r):s.set(r.id,[r])}for(const r of t){const i=s.get(r.id);if(!i){n.push(r);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const a={...r};for(const u of i)ia(u,a);n.push(a)}return o.length&&o.forEach(r=>{r.index!==void 0?n.splice(r.index,0,{...r.item}):n.push({...r.item})}),n}function ia(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Ds(e,t){return $s(e,t)}function Ts(e,t){return $s(e,t)}function ve(e,t){return{id:e,type:"select",selected:t}}function Ae(e,t=new Set,n=!1){const s=[];for(const[o,r]of e){const i=t.has(o);!(r.selected===void 0&&!i)&&r.selected!==i&&(n&&(r.selected=i),s.push(ve(r.id,i)))}return s}function jn({items:e=[],lookup:t}){var o;const n=[],s=new Map(e.map(r=>[r.id,r]));for(const[r,i]of e.entries()){const a=t.get(i.id),u=((o=a==null?void 0:a.internals)==null?void 0:o.userNode)??a;u!==void 0&&u!==i&&n.push({id:i.id,item:i,type:"replace"}),u===void 0&&n.push({item:i,type:"add",index:r})}for(const[r]of t)s.get(r)===void 0&&n.push({id:r,type:"remove"});return n}function kn(e){return{id:e.id,type:"remove"}}const Mn=e=>Rr(e),aa=e=>ts(e);function Ls(e){return S.forwardRef(e)}const ca=typeof window<"u"?S.useLayoutEffect:S.useEffect;function An(e){const[t,n]=S.useState(BigInt(0)),[s]=S.useState(()=>la(()=>n(o=>o+BigInt(1))));return ca(()=>{const o=s.get();o.length&&(e(o),s.reset())},[t]),s}function la(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const _s=S.createContext(null);function da({children:e}){const t=re(),n=S.useCallback(a=>{const{nodes:u=[],setNodes:g,hasDefaultNodes:h,onNodesChange:c,nodeLookup:d,fitViewQueued:x,onNodesChangeMiddlewareMap:p}=t.getState();let w=u;for(const y of a)w=typeof y=="function"?y(w):y;let m=jn({items:w,lookup:d});for(const y of p.values())m=y(m);h&&g(w),m.length>0?c==null||c(m):x&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:b,setNodes:f}=t.getState();y&&f(b)})},[]),s=An(n),o=S.useCallback(a=>{const{edges:u=[],setEdges:g,hasDefaultEdges:h,onEdgesChange:c,edgeLookup:d}=t.getState();let x=u;for(const p of a)x=typeof p=="function"?p(x):p;h?g(x):c&&c(jn({items:x,lookup:d}))},[]),r=An(o),i=S.useMemo(()=>({nodeQueue:s,edgeQueue:r}),[]);return l.jsx(_s.Provider,{value:i,children:e})}function ua(){const e=S.useContext(_s);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const fa=e=>!!e.panZoom;function Ft(){const e=ra(),t=re(),n=ua(),s=J(fa),o=S.useMemo(()=>{const r=c=>t.getState().nodeLookup.get(c),i=c=>{n.nodeQueue.push(c)},a=c=>{n.edgeQueue.push(c)},u=c=>{var y,b;const{nodeLookup:d,nodeOrigin:x}=t.getState(),p=Mn(c)?c:d.get(c.id),w=p.parentId?as(p.position,p.measured,p.parentId,d,x):p.position,m={...p,position:w,width:((y=p.measured)==null?void 0:y.width)??p.width,height:((b=p.measured)==null?void 0:b.height)??p.height};return $e(m)},g=(c,d,x={replace:!1})=>{i(p=>p.map(w=>{if(w.id===c){const m=typeof d=="function"?d(w):d;return x.replace&&Mn(m)?m:{...w,...m}}return w}))},h=(c,d,x={replace:!1})=>{a(p=>p.map(w=>{if(w.id===c){const m=typeof d=="function"?d(w):d;return x.replace&&aa(m)?m:{...w,...m}}return w}))};return{getNodes:()=>t.getState().nodes.map(c=>({...c})),getNode:c=>{var d;return(d=r(c))==null?void 0:d.internals.userNode},getInternalNode:r,getEdges:()=>{const{edges:c=[]}=t.getState();return c.map(d=>({...d}))},getEdge:c=>t.getState().edgeLookup.get(c),setNodes:i,setEdges:a,addNodes:c=>{const d=Array.isArray(c)?c:[c];n.nodeQueue.push(x=>[...x,...d])},addEdges:c=>{const d=Array.isArray(c)?c:[c];n.edgeQueue.push(x=>[...x,...d])},toObject:()=>{const{nodes:c=[],edges:d=[],transform:x}=t.getState(),[p,w,m]=x;return{nodes:c.map(y=>({...y})),edges:d.map(y=>({...y})),viewport:{x:p,y:w,zoom:m}}},deleteElements:async({nodes:c=[],edges:d=[]})=>{const{nodes:x,edges:p,onNodesDelete:w,onEdgesDelete:m,triggerNodeChanges:y,triggerEdgeChanges:b,onDelete:f,onBeforeDelete:v}=t.getState(),{nodes:M,edges:N}=await Wr({nodesToRemove:c,edgesToRemove:d,nodes:x,edges:p,onBeforeDelete:v}),k=N.length>0,I=M.length>0;if(k){const A=N.map(kn);m==null||m(N),b(A)}if(I){const A=M.map(kn);w==null||w(M),y(A)}return(I||k)&&(f==null||f({nodes:M,edges:N})),{deletedNodes:M,deletedEdges:N}},getIntersectingNodes:(c,d=!0,x)=>{const p=on(c),w=p?c:u(c),m=x!==void 0;return w?(x||t.getState().nodes).filter(y=>{const b=t.getState().nodeLookup.get(y.id);if(b&&!p&&(y.id===c.id||!b.internals.positionAbsolute))return!1;const f=$e(m?y:b),v=Oe(f,w);return d&&v>0||v>=f.width*f.height||v>=w.width*w.height}):[]},isNodeIntersecting:(c,d,x=!0)=>{const w=on(c)?c:u(c);if(!w)return!1;const m=Oe(w,d);return x&&m>0||m>=d.width*d.height||m>=w.width*w.height},updateNode:g,updateNodeData:(c,d,x={replace:!1})=>{g(c,p=>{const w=typeof d=="function"?d(p):d;return x.replace?{...p,data:w}:{...p,data:{...p.data,...w}}},x)},updateEdge:h,updateEdgeData:(c,d,x={replace:!1})=>{h(c,p=>{const w=typeof d=="function"?d(p):d;return x.replace?{...p,data:w}:{...p,data:{...p.data,...w}}},x)},getNodesBounds:c=>{const{nodeLookup:d,nodeOrigin:x}=t.getState();return Vr(c,{nodeLookup:d,nodeOrigin:x})},getHandleConnections:({type:c,id:d,nodeId:x})=>{var p;return Array.from(((p=t.getState().connectionLookup.get(`${x}-${c}${d?`-${d}`:""}`))==null?void 0:p.values())??[])},getNodeConnections:({type:c,handleId:d,nodeId:x})=>{var p;return Array.from(((p=t.getState().connectionLookup.get(`${x}${c?d?`-${c}-${d}`:`-${c}`:""}`))==null?void 0:p.values())??[])},fitView:async c=>{const d=t.getState().fitViewResolver??Gr();return t.setState({fitViewQueued:!0,fitViewOptions:c,fitViewResolver:d}),n.nodeQueue.push(x=>[...x]),d.promise}}},[]);return S.useMemo(()=>({...o,...e,viewportInitialized:s}),[s])}const In=e=>e.selected,ga=typeof window<"u"?window:void 0;function pa({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=re(),{deleteElements:s}=Ft(),o=Ye(e,{actInsideInputWithModifier:!1}),r=Ye(t,{target:ga});S.useEffect(()=>{if(o){const{edges:i,nodes:a}=n.getState();s({nodes:a.filter(In),edges:i.filter(In)}),n.setState({nodesSelectionActive:!1})}},[o]),S.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}function ha(e){const t=re();S.useEffect(()=>{const n=()=>{var o,r,i,a;if(!e.current||!(((r=(o=e.current).checkVisibility)==null?void 0:r.call(o))??!0))return!1;const s=_t(e.current);(s.height===0||s.width===0)&&((a=(i=t.getState()).onError)==null||a.call(i,"004",de.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const ut={position:"absolute",width:"100%",height:"100%",top:0,left:0},ma=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function xa({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:o=.5,panOnScrollMode:r=Se.Free,zoomOnDoubleClick:i=!0,panOnDrag:a=!0,defaultViewport:u,translateExtent:g,minZoom:h,maxZoom:c,zoomActivationKeyCode:d,preventScrolling:x=!0,children:p,noWheelClassName:w,noPanClassName:m,onViewportChange:y,isControlledViewport:b,paneClickDistance:f,selectionOnDrag:v}){const M=re(),N=S.useRef(null),{userSelectionActive:k,lib:I,connectionInProgress:A}=J(ma,oe),R=Ye(d),C=S.useRef();ha(N);const E=S.useCallback(D=>{y==null||y({x:D[0],y:D[1],zoom:D[2]}),b||M.setState({transform:D})},[y,b]);return S.useEffect(()=>{if(N.current){C.current=Ii({domNode:N.current,minZoom:h,maxZoom:c,translateExtent:g,viewport:u,onDraggingChange:V=>M.setState({paneDragging:V}),onPanZoomStart:(V,H)=>{const{onViewportChangeStart:P,onMoveStart:j}=M.getState();j==null||j(V,H),P==null||P(H)},onPanZoom:(V,H)=>{const{onViewportChange:P,onMove:j}=M.getState();j==null||j(V,H),P==null||P(H)},onPanZoomEnd:(V,H)=>{const{onViewportChangeEnd:P,onMoveEnd:j}=M.getState();j==null||j(V,H),P==null||P(H)}});const{x:D,y:z,zoom:_}=C.current.getViewport();return M.setState({panZoom:C.current,transform:[D,z,_],domNode:N.current.closest(".react-flow")}),()=>{var V;(V=C.current)==null||V.destroy()}}},[]),S.useEffect(()=>{var D;(D=C.current)==null||D.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:o,panOnScrollMode:r,zoomOnDoubleClick:i,panOnDrag:a,zoomActivationKeyPressed:R,preventScrolling:x,noPanClassName:m,userSelectionActive:k,noWheelClassName:w,lib:I,onTransformChange:E,connectionInProgress:A,selectionOnDrag:v,paneClickDistance:f})},[e,t,n,s,o,r,i,a,R,x,m,k,w,I,E,A,v,f]),l.jsx("div",{className:"react-flow__renderer",ref:N,style:ut,children:p})}const ya=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function wa(){const{userSelectionActive:e,userSelectionRect:t}=J(ya,oe);return e&&t?l.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const St=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},ba=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function va({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Fe.Full,panOnDrag:s,paneClickDistance:o,selectionOnDrag:r,onSelectionStart:i,onSelectionEnd:a,onPaneClick:u,onPaneContextMenu:g,onPaneScroll:h,onPaneMouseEnter:c,onPaneMouseMove:d,onPaneMouseLeave:x,children:p}){const w=re(),{userSelectionActive:m,elementsSelectable:y,dragging:b,connectionInProgress:f}=J(ba,oe),v=y&&(e||m),M=S.useRef(null),N=S.useRef(),k=S.useRef(new Set),I=S.useRef(new Set),A=S.useRef(!1),R=P=>{if(A.current||f){A.current=!1;return}u==null||u(P),w.getState().resetSelectedElements(),w.setState({nodesSelectionActive:!1})},C=P=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){P.preventDefault();return}g==null||g(P)},E=h?P=>h(P):void 0,D=P=>{A.current&&(P.stopPropagation(),A.current=!1)},z=P=>{var K,q;const{domNode:j}=w.getState();if(N.current=j==null?void 0:j.getBoundingClientRect(),!N.current)return;const $=P.target===M.current;if(!$&&!!P.target.closest(".nokey")||!e||!(r&&$||t)||P.button!==0||!P.isPrimary)return;(q=(K=P.target)==null?void 0:K.setPointerCapture)==null||q.call(K,P.pointerId),A.current=!1;const{x:B,y:W}=le(P.nativeEvent,N.current);w.setState({userSelectionRect:{width:0,height:0,startX:B,startY:W,x:B,y:W}}),$||(P.stopPropagation(),P.preventDefault())},_=P=>{const{userSelectionRect:j,transform:$,nodeLookup:T,edgeLookup:L,connectionLookup:B,triggerNodeChanges:W,triggerEdgeChanges:K,defaultEdgeOptions:q,resetSelectedElements:Y}=w.getState();if(!N.current||!j)return;const{x:F,y:G}=le(P.nativeEvent,N.current),{startX:Q,startY:U}=j;if(!A.current){const ee=t?0:o;if(Math.hypot(F-Q,G-U)<=ee)return;Y(),i==null||i(P)}A.current=!0;const X={startX:Q,startY:U,x:F<Q?F:Q,y:G<U?G:U,width:Math.abs(F-Q),height:Math.abs(G-U)},Z=k.current,te=I.current;k.current=new Set(Tt(T,X,$,n===Fe.Partial,!0).map(ee=>ee.id)),I.current=new Set;const se=(q==null?void 0:q.selectable)??!0;for(const ee of k.current){const ae=B.get(ee);if(ae)for(const{edgeId:he}of ae.values()){const ue=L.get(he);ue&&(ue.selectable??se)&&I.current.add(he)}}if(!rn(Z,k.current)){const ee=Ae(T,k.current,!0);W(ee)}if(!rn(te,I.current)){const ee=Ae(L,I.current);K(ee)}w.setState({userSelectionRect:X,userSelectionActive:!0,nodesSelectionActive:!1})},V=P=>{var j,$;P.button===0&&(($=(j=P.target)==null?void 0:j.releasePointerCapture)==null||$.call(j,P.pointerId),!m&&P.target===M.current&&w.getState().userSelectionRect&&(R==null||R(P)),w.setState({userSelectionActive:!1,userSelectionRect:null}),A.current&&(a==null||a(P),w.setState({nodesSelectionActive:k.current.size>0})))},H=s===!0||Array.isArray(s)&&s.includes(0);return l.jsxs("div",{className:ie(["react-flow__pane",{draggable:H,dragging:b,selection:e}]),onClick:v?void 0:St(R,M),onContextMenu:St(C,M),onWheel:St(E,M),onPointerEnter:v?void 0:c,onPointerMove:v?_:d,onPointerUp:v?V:void 0,onPointerDownCapture:v?z:void 0,onClickCapture:v?D:void 0,onPointerLeave:x,ref:M,style:ut,children:[p,l.jsx(wa,{})]})}function It({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:o,unselectNodesAndEdges:r,multiSelectionActive:i,nodeLookup:a,onError:u}=t.getState(),g=a.get(e);if(!g){u==null||u("012",de.error012(e));return}t.setState({nodesSelectionActive:!1}),g.selected?(n||g.selected&&i)&&(r({nodes:[g],edges:[]}),requestAnimationFrame(()=>{var h;return(h=s==null?void 0:s.current)==null?void 0:h.blur()})):o([e])}function zs({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:o,isSelectable:r,nodeClickDistance:i}){const a=re(),[u,g]=S.useState(!1),h=S.useRef();return S.useEffect(()=>{h.current=mi({getStoreItems:()=>a.getState(),onNodeMouseDown:c=>{It({id:c,store:a,nodeRef:e})},onDragStart:()=>{g(!0)},onDragStop:()=>{g(!1)}})},[]),S.useEffect(()=>{var c,d;if(t)(c=h.current)==null||c.destroy();else if(e.current)return(d=h.current)==null||d.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:r,nodeId:o,nodeClickDistance:i}),()=>{var x;(x=h.current)==null||x.destroy()}},[n,s,t,r,e,o]),u}const Na=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Hs(){const e=re();return S.useCallback(n=>{const{nodeExtent:s,snapToGrid:o,snapGrid:r,nodesDraggable:i,onError:a,updateNodePositions:u,nodeLookup:g,nodeOrigin:h}=e.getState(),c=new Map,d=Na(i),x=o?r[0]:5,p=o?r[1]:5,w=n.direction.x*x*n.factor,m=n.direction.y*p*n.factor;for(const[,y]of g){if(!d(y))continue;let b={x:y.internals.positionAbsolute.x+w,y:y.internals.positionAbsolute.y+m};o&&(b=Ge(b,r));const{position:f,positionAbsolute:v}=ns({nodeId:y.id,nextPosition:b,nodeLookup:g,nodeExtent:s,nodeOrigin:h,onError:a});y.position=f,y.internals.positionAbsolute=v,c.set(y.id,y)}u(c)},[])}const Ot=S.createContext(null),Sa=Ot.Provider;Ot.Consumer;const Rs=()=>S.useContext(Ot),Ea=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),Ca=(e,t,n)=>s=>{const{connectionClickStartHandle:o,connectionMode:r,connection:i}=s,{fromHandle:a,toHandle:u,isValid:g}=i,h=(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===t&&(u==null?void 0:u.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:h,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===n,isPossibleEndHandle:r===Ie.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!o,valid:h&&g}};function ja({type:e="source",position:t=O.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:o=!0,isConnectableEnd:r=!0,id:i,onConnect:a,children:u,className:g,onMouseDown:h,onTouchStart:c,...d},x){var _,V;const p=i||null,w=e==="target",m=re(),y=Rs(),{connectOnClick:b,noPanClassName:f,rfId:v}=J(Ea,oe),{connectingFrom:M,connectingTo:N,clickConnecting:k,isPossibleEndHandle:I,connectionInProcess:A,clickConnectionInProcess:R,valid:C}=J(Ca(y,p,e),oe);y||(V=(_=m.getState()).onError)==null||V.call(_,"010",de.error010());const E=H=>{const{defaultEdgeOptions:P,onConnect:j,hasDefaultEdges:$}=m.getState(),T={...P,...H};if($){const{edges:L,setEdges:B}=m.getState();B(ps(T,L))}j==null||j(T),a==null||a(T)},D=H=>{if(!y)return;const P=ds(H.nativeEvent);if(o&&(P&&H.button===0||!P)){const j=m.getState();At.onPointerDown(H.nativeEvent,{handleDomNode:H.currentTarget,autoPanOnConnect:j.autoPanOnConnect,connectionMode:j.connectionMode,connectionRadius:j.connectionRadius,domNode:j.domNode,nodeLookup:j.nodeLookup,lib:j.lib,isTarget:w,handleId:p,nodeId:y,flowId:j.rfId,panBy:j.panBy,cancelConnection:j.cancelConnection,onConnectStart:j.onConnectStart,onConnectEnd:j.onConnectEnd,updateConnection:j.updateConnection,onConnect:E,isValidConnection:n||j.isValidConnection,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,autoPanSpeed:j.autoPanSpeed,dragThreshold:j.connectionDragThreshold})}P?h==null||h(H):c==null||c(H)},z=H=>{const{onClickConnectStart:P,onClickConnectEnd:j,connectionClickStartHandle:$,connectionMode:T,isValidConnection:L,lib:B,rfId:W,nodeLookup:K,connection:q}=m.getState();if(!y||!$&&!o)return;if(!$){P==null||P(H.nativeEvent,{nodeId:y,handleId:p,handleType:e}),m.setState({connectionClickStartHandle:{nodeId:y,type:e,id:p}});return}const Y=cs(H.target),F=n||L,{connection:G,isValid:Q}=At.isValid(H.nativeEvent,{handle:{nodeId:y,id:p,type:e},connectionMode:T,fromNodeId:$.nodeId,fromHandleId:$.id||null,fromType:$.type,isValidConnection:F,flowId:W,doc:Y,lib:B,nodeLookup:K});Q&&G&&E(G);const U=structuredClone(q);delete U.inProgress,U.toPosition=U.toHandle?U.toHandle.position:null,j==null||j(H,U),m.setState({connectionClickStartHandle:null})};return l.jsx("div",{"data-handleid":p,"data-nodeid":y,"data-handlepos":t,"data-id":`${v}-${y}-${p}-${e}`,className:ie(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",f,g,{source:!w,target:w,connectable:s,connectablestart:o,connectableend:r,clickconnecting:k,connectingfrom:M,connectingto:N,valid:C,connectionindicator:s&&(!A||I)&&(A||R?r:o)}]),onMouseDown:D,onTouchStart:D,onClick:b?z:void 0,ref:x,...d,children:u})}const we=S.memo(Ls(ja));function ka({data:e,isConnectable:t,sourcePosition:n=O.Bottom}){return l.jsxs(l.Fragment,{children:[e==null?void 0:e.label,l.jsx(we,{type:"source",position:n,isConnectable:t})]})}function Ma({data:e,isConnectable:t,targetPosition:n=O.Top,sourcePosition:s=O.Bottom}){return l.jsxs(l.Fragment,{children:[l.jsx(we,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,l.jsx(we,{type:"source",position:s,isConnectable:t})]})}function Aa(){return null}function Ia({data:e,isConnectable:t,targetPosition:n=O.Top}){return l.jsxs(l.Fragment,{children:[l.jsx(we,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const rt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Pn={input:ka,default:Ma,output:Ia,group:Aa};function Pa(e){var t,n,s,o;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((o=e.style)==null?void 0:o.height)}}const $a=e=>{const{width:t,height:n,x:s,y:o}=Xe(e.nodeLookup,{filter:r=>!!r.selected});return{width:ce(t)?t:null,height:ce(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${o}px)`}};function Da({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=re(),{width:o,height:r,transformString:i,userSelectionActive:a}=J($a,oe),u=Hs(),g=S.useRef(null);if(S.useEffect(()=>{var d;n||(d=g.current)==null||d.focus({preventScroll:!0})},[n]),zs({nodeRef:g}),a||!o||!r)return null;const h=e?d=>{const x=s.getState().nodes.filter(p=>p.selected);e(d,x)}:void 0,c=d=>{Object.prototype.hasOwnProperty.call(rt,d.key)&&(d.preventDefault(),u({direction:rt[d.key],factor:d.shiftKey?4:1}))};return l.jsx("div",{className:ie(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:l.jsx("div",{ref:g,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:n?void 0:-1,onKeyDown:n?void 0:c,style:{width:o,height:r}})})}const $n=typeof window<"u"?window:void 0,Ta=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Vs({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:r,onPaneScroll:i,paneClickDistance:a,deleteKeyCode:u,selectionKeyCode:g,selectionOnDrag:h,selectionMode:c,onSelectionStart:d,onSelectionEnd:x,multiSelectionKeyCode:p,panActivationKeyCode:w,zoomActivationKeyCode:m,elementsSelectable:y,zoomOnScroll:b,zoomOnPinch:f,panOnScroll:v,panOnScrollSpeed:M,panOnScrollMode:N,zoomOnDoubleClick:k,panOnDrag:I,defaultViewport:A,translateExtent:R,minZoom:C,maxZoom:E,preventScrolling:D,onSelectionContextMenu:z,noWheelClassName:_,noPanClassName:V,disableKeyboardA11y:H,onViewportChange:P,isControlledViewport:j}){const{nodesSelectionActive:$,userSelectionActive:T}=J(Ta,oe),L=Ye(g,{target:$n}),B=Ye(w,{target:$n}),W=B||I,K=B||v,q=h&&W!==!0,Y=L||T||q;return pa({deleteKeyCode:u,multiSelectionKeyCode:p}),l.jsx(xa,{onPaneContextMenu:r,elementsSelectable:y,zoomOnScroll:b,zoomOnPinch:f,panOnScroll:K,panOnScrollSpeed:M,panOnScrollMode:N,zoomOnDoubleClick:k,panOnDrag:!L&&W,defaultViewport:A,translateExtent:R,minZoom:C,maxZoom:E,zoomActivationKeyCode:m,preventScrolling:D,noWheelClassName:_,noPanClassName:V,onViewportChange:P,isControlledViewport:j,paneClickDistance:a,selectionOnDrag:q,children:l.jsxs(va,{onSelectionStart:d,onSelectionEnd:x,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:r,onPaneScroll:i,panOnDrag:W,isSelecting:!!Y,selectionMode:c,selectionKeyPressed:L,paneClickDistance:a,selectionOnDrag:q,children:[e,$&&l.jsx(Da,{onSelectionContextMenu:z,noPanClassName:V,disableKeyboardA11y:H})]})})}Vs.displayName="FlowRenderer";const La=S.memo(Vs),_a=e=>t=>e?Tt(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function za(e){return J(S.useCallback(_a(e),[e]),oe)}const Ha=e=>e.updateNodeInternals;function Ra(){const e=J(Ha),[t]=S.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(o=>{const r=o.target.getAttribute("data-id");s.set(r,{id:r,nodeElement:o.target,force:!0})}),e(s)}));return S.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function Va({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const o=re(),r=S.useRef(null),i=S.useRef(null),a=S.useRef(e.sourcePosition),u=S.useRef(e.targetPosition),g=S.useRef(t),h=n&&!!e.internals.handleBounds;return S.useEffect(()=>{r.current&&!e.hidden&&(!h||i.current!==r.current)&&(i.current&&(s==null||s.unobserve(i.current)),s==null||s.observe(r.current),i.current=r.current)},[h,e.hidden]),S.useEffect(()=>()=>{i.current&&(s==null||s.unobserve(i.current),i.current=null)},[]),S.useEffect(()=>{if(r.current){const c=g.current!==t,d=a.current!==e.sourcePosition,x=u.current!==e.targetPosition;(c||d||x)&&(g.current=t,a.current=e.sourcePosition,u.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}function Ba({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:o,onContextMenu:r,onDoubleClick:i,nodesDraggable:a,elementsSelectable:u,nodesConnectable:g,nodesFocusable:h,resizeObserver:c,noDragClassName:d,noPanClassName:x,disableKeyboardA11y:p,rfId:w,nodeTypes:m,nodeClickDistance:y,onError:b}){const{node:f,internals:v,isParent:M}=J(F=>{const G=F.nodeLookup.get(e),Q=F.parentLookup.has(e);return{node:G,internals:G.internals,isParent:Q}},oe);let N=f.type||"default",k=(m==null?void 0:m[N])||Pn[N];k===void 0&&(b==null||b("003",de.error003(N)),N="default",k=(m==null?void 0:m.default)||Pn.default);const I=!!(f.draggable||a&&typeof f.draggable>"u"),A=!!(f.selectable||u&&typeof f.selectable>"u"),R=!!(f.connectable||g&&typeof f.connectable>"u"),C=!!(f.focusable||h&&typeof f.focusable>"u"),E=re(),D=is(f),z=Va({node:f,nodeType:N,hasDimensions:D,resizeObserver:c}),_=zs({nodeRef:z,disabled:f.hidden||!I,noDragClassName:d,handleSelector:f.dragHandle,nodeId:e,isSelectable:A,nodeClickDistance:y}),V=Hs();if(f.hidden)return null;const H=pe(f),P=Pa(f),j=A||I||t||n||s||o,$=n?F=>n(F,{...v.userNode}):void 0,T=s?F=>s(F,{...v.userNode}):void 0,L=o?F=>o(F,{...v.userNode}):void 0,B=r?F=>r(F,{...v.userNode}):void 0,W=i?F=>i(F,{...v.userNode}):void 0,K=F=>{const{selectNodesOnDrag:G,nodeDragThreshold:Q}=E.getState();A&&(!G||!I||Q>0)&&It({id:e,store:E,nodeRef:z}),t&&t(F,{...v.userNode})},q=F=>{if(!(ls(F.nativeEvent)||p)){if(qn.includes(F.key)&&A){const G=F.key==="Escape";It({id:e,store:E,unselect:G,nodeRef:z})}else if(I&&f.selected&&Object.prototype.hasOwnProperty.call(rt,F.key)){F.preventDefault();const{ariaLabelConfig:G}=E.getState();E.setState({ariaLiveMessage:G["node.a11yDescription.ariaLiveMessage"]({direction:F.key.replace("Arrow","").toLowerCase(),x:~~v.positionAbsolute.x,y:~~v.positionAbsolute.y})}),V({direction:rt[F.key],factor:F.shiftKey?4:1})}}},Y=()=>{var te;if(p||!((te=z.current)!=null&&te.matches(":focus-visible")))return;const{transform:F,width:G,height:Q,autoPanOnNodeFocus:U,setCenter:X}=E.getState();if(!U)return;Tt(new Map([[e,f]]),{x:0,y:0,width:G,height:Q},F,!0).length>0||X(f.position.x+H.width/2,f.position.y+H.height/2,{zoom:F[2]})};return l.jsx("div",{className:ie(["react-flow__node",`react-flow__node-${N}`,{[x]:I},f.className,{selected:f.selected,selectable:A,parent:M,draggable:I,dragging:_}]),ref:z,style:{zIndex:v.z,transform:`translate(${v.positionAbsolute.x}px,${v.positionAbsolute.y}px)`,pointerEvents:j?"all":"none",visibility:D?"visible":"hidden",...f.style,...P},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:$,onMouseMove:T,onMouseLeave:L,onContextMenu:B,onClick:K,onDoubleClick:W,onKeyDown:C?q:void 0,tabIndex:C?0:void 0,onFocus:C?Y:void 0,role:f.ariaRole??(C?"group":void 0),"aria-roledescription":"node","aria-describedby":p?void 0:`${As}-${w}`,"aria-label":f.ariaLabel,...f.domAttributes,children:l.jsx(Sa,{value:e,children:l.jsx(k,{id:e,data:f.data,type:N,positionAbsoluteX:v.positionAbsolute.x,positionAbsoluteY:v.positionAbsolute.y,selected:f.selected??!1,selectable:A,draggable:I,deletable:f.deletable??!0,isConnectable:R,sourcePosition:f.sourcePosition,targetPosition:f.targetPosition,dragging:_,dragHandle:f.dragHandle,zIndex:v.z,parentId:f.parentId,...H})})})}var Fa=S.memo(Ba);const Oa=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Bs(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:o,onError:r}=J(Oa,oe),i=za(e.onlyRenderVisibleElements),a=Ra();return l.jsx("div",{className:"react-flow__nodes",style:ut,children:i.map(u=>l.jsx(Fa,{id:u,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:r},u))})}Bs.displayName="NodeRenderer";const Wa=S.memo(Bs);function Ya(e){return J(S.useCallback(n=>{if(!e)return n.edges.map(o=>o.id);const s=[];if(n.width&&n.height)for(const o of n.edges){const r=n.nodeLookup.get(o.source),i=n.nodeLookup.get(o.target);r&&i&&Qr({sourceNode:r,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&s.push(o.id)}return s},[e]),oe)}const Za=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return l.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Xa=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return l.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Dn={[ne.Arrow]:Za,[ne.ArrowClosed]:Xa};function Ga(e){const t=re();return S.useMemo(()=>{var o,r;return Object.prototype.hasOwnProperty.call(Dn,e)?Dn[e]:((r=(o=t.getState()).onError)==null||r.call(o,"009",de.error009(e)),null)},[e])}const Ua=({id:e,type:t,color:n,width:s=12.5,height:o=12.5,markerUnits:r="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const u=Ga(t);return u?l.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:a,refX:"0",refY:"0",children:l.jsx(u,{color:n,strokeWidth:i})}):null},Fs=({defaultColor:e,rfId:t})=>{const n=J(r=>r.edges),s=J(r=>r.defaultEdgeOptions),o=S.useMemo(()=>ri(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return o.length?l.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:l.jsx("defs",{children:o.map(r=>l.jsx(Ua,{id:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient},r.id))})}):null};Fs.displayName="MarkerDefinitions";var Ka=S.memo(Fs);function Os({x:e,y:t,label:n,labelStyle:s,labelShowBg:o=!0,labelBgStyle:r,labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:u,className:g,...h}){const[c,d]=S.useState({x:1,y:0,width:0,height:0}),x=ie(["react-flow__edge-textwrapper",g]),p=S.useRef(null);return S.useEffect(()=>{if(p.current){const w=p.current.getBBox();d({x:w.x,y:w.y,width:w.width,height:w.height})}},[n]),n?l.jsxs("g",{transform:`translate(${e-c.width/2} ${t-c.height/2})`,className:x,visibility:c.width?"visible":"hidden",...h,children:[o&&l.jsx("rect",{width:c.width+2*i[0],x:-i[0],y:-i[1],height:c.height+2*i[1],className:"react-flow__edge-textbg",style:r,rx:a,ry:a}),l.jsx("text",{className:"react-flow__edge-text",y:c.height/2,dy:"0.3em",ref:p,style:s,children:n}),u]}):null}Os.displayName="EdgeText";const qa=S.memo(Os);function ft({path:e,labelX:t,labelY:n,label:s,labelStyle:o,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:u,interactionWidth:g=20,...h}){return l.jsxs(l.Fragment,{children:[l.jsx("path",{...h,d:e,fill:"none",className:ie(["react-flow__edge-path",h.className])}),g?l.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:g,className:"react-flow__edge-interaction"}):null,s&&ce(t)&&ce(n)?l.jsx(qa,{x:t,y:n,label:s,labelStyle:o,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:u}):null]})}function Tn({pos:e,x1:t,y1:n,x2:s,y2:o}){return e===O.Left||e===O.Right?[.5*(t+s),n]:[t,.5*(n+o)]}function Ws({sourceX:e,sourceY:t,sourcePosition:n=O.Bottom,targetX:s,targetY:o,targetPosition:r=O.Top}){const[i,a]=Tn({pos:n,x1:e,y1:t,x2:s,y2:o}),[u,g]=Tn({pos:r,x1:s,y1:o,x2:e,y2:t}),[h,c,d,x]=us({sourceX:e,sourceY:t,targetX:s,targetY:o,sourceControlX:i,sourceControlY:a,targetControlX:u,targetControlY:g});return[`M${e},${t} C${i},${a} ${u},${g} ${s},${o}`,h,c,d,x]}function Ys(e){return S.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,sourcePosition:i,targetPosition:a,label:u,labelStyle:g,labelShowBg:h,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:x,style:p,markerEnd:w,markerStart:m,interactionWidth:y})=>{const[b,f,v]=Ws({sourceX:n,sourceY:s,sourcePosition:i,targetX:o,targetY:r,targetPosition:a}),M=e.isInternal?void 0:t;return l.jsx(ft,{id:M,path:b,labelX:f,labelY:v,label:u,labelStyle:g,labelShowBg:h,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:x,style:p,markerEnd:w,markerStart:m,interactionWidth:y})})}const Qa=Ys({isInternal:!1}),Zs=Ys({isInternal:!0});Qa.displayName="SimpleBezierEdge";Zs.displayName="SimpleBezierEdgeInternal";function Xs(e){return S.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:g,labelBgPadding:h,labelBgBorderRadius:c,style:d,sourcePosition:x=O.Bottom,targetPosition:p=O.Top,markerEnd:w,markerStart:m,pathOptions:y,interactionWidth:b})=>{const[f,v,M]=jt({sourceX:n,sourceY:s,sourcePosition:x,targetX:o,targetY:r,targetPosition:p,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset,stepPosition:y==null?void 0:y.stepPosition}),N=e.isInternal?void 0:t;return l.jsx(ft,{id:N,path:f,labelX:v,labelY:M,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:g,labelBgPadding:h,labelBgBorderRadius:c,style:d,markerEnd:w,markerStart:m,interactionWidth:b})})}const Gs=Xs({isInternal:!1}),Us=Xs({isInternal:!0});Gs.displayName="SmoothStepEdge";Us.displayName="SmoothStepEdgeInternal";function Ks(e){return S.memo(({id:t,...n})=>{var o;const s=e.isInternal?void 0:t;return l.jsx(Gs,{...n,id:s,pathOptions:S.useMemo(()=>{var r;return{borderRadius:0,offset:(r=n.pathOptions)==null?void 0:r.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const Ja=Ks({isInternal:!1}),qs=Ks({isInternal:!0});Ja.displayName="StepEdge";qs.displayName="StepEdgeInternal";function Qs(e){return S.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:g,labelBgPadding:h,labelBgBorderRadius:c,style:d,markerEnd:x,markerStart:p,interactionWidth:w})=>{const[m,y,b]=hs({sourceX:n,sourceY:s,targetX:o,targetY:r}),f=e.isInternal?void 0:t;return l.jsx(ft,{id:f,path:m,labelX:y,labelY:b,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:g,labelBgPadding:h,labelBgBorderRadius:c,style:d,markerEnd:x,markerStart:p,interactionWidth:w})})}const ec=Qs({isInternal:!1}),Js=Qs({isInternal:!0});ec.displayName="StraightEdge";Js.displayName="StraightEdgeInternal";function eo(e){return S.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,sourcePosition:i=O.Bottom,targetPosition:a=O.Top,label:u,labelStyle:g,labelShowBg:h,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:x,style:p,markerEnd:w,markerStart:m,pathOptions:y,interactionWidth:b})=>{const[f,v,M]=fs({sourceX:n,sourceY:s,sourcePosition:i,targetX:o,targetY:r,targetPosition:a,curvature:y==null?void 0:y.curvature}),N=e.isInternal?void 0:t;return l.jsx(ft,{id:N,path:f,labelX:v,labelY:M,label:u,labelStyle:g,labelShowBg:h,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:x,style:p,markerEnd:w,markerStart:m,interactionWidth:b})})}const tc=eo({isInternal:!1}),to=eo({isInternal:!0});tc.displayName="BezierEdge";to.displayName="BezierEdgeInternal";const Ln={default:to,straight:Js,step:qs,smoothstep:Us,simplebezier:Zs},_n={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},nc=(e,t,n)=>n===O.Left?e-t:n===O.Right?e+t:e,sc=(e,t,n)=>n===O.Top?e-t:n===O.Bottom?e+t:e,zn="react-flow__edgeupdater";function Hn({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:o,onMouseEnter:r,onMouseOut:i,type:a}){return l.jsx("circle",{onMouseDown:o,onMouseEnter:r,onMouseOut:i,className:ie([zn,`${zn}-${a}`]),cx:nc(t,s,e),cy:sc(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function oc({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:o,targetX:r,targetY:i,sourcePosition:a,targetPosition:u,onReconnect:g,onReconnectStart:h,onReconnectEnd:c,setReconnecting:d,setUpdateHover:x}){const p=re(),w=(v,M)=>{if(v.button!==0)return;const{autoPanOnConnect:N,domNode:k,isValidConnection:I,connectionMode:A,connectionRadius:R,lib:C,onConnectStart:E,onConnectEnd:D,cancelConnection:z,nodeLookup:_,rfId:V,panBy:H,updateConnection:P}=p.getState(),j=M.type==="target",$=(B,W)=>{d(!1),c==null||c(B,n,M.type,W)},T=B=>g==null?void 0:g(n,B),L=(B,W)=>{d(!0),h==null||h(v,n,M.type),E==null||E(B,W)};At.onPointerDown(v.nativeEvent,{autoPanOnConnect:N,connectionMode:A,connectionRadius:R,domNode:k,handleId:M.id,nodeId:M.nodeId,nodeLookup:_,isTarget:j,edgeUpdaterType:M.type,lib:C,flowId:V,cancelConnection:z,panBy:H,isValidConnection:I,onConnect:T,onConnectStart:L,onConnectEnd:D,onReconnectEnd:$,updateConnection:P,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:v.currentTarget})},m=v=>w(v,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=v=>w(v,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),b=()=>x(!0),f=()=>x(!1);return l.jsxs(l.Fragment,{children:[(e===!0||e==="source")&&l.jsx(Hn,{position:a,centerX:s,centerY:o,radius:t,onMouseDown:m,onMouseEnter:b,onMouseOut:f,type:"source"}),(e===!0||e==="target")&&l.jsx(Hn,{position:u,centerX:r,centerY:i,radius:t,onMouseDown:y,onMouseEnter:b,onMouseOut:f,type:"target"})]})}function rc({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:o,onDoubleClick:r,onContextMenu:i,onMouseEnter:a,onMouseMove:u,onMouseLeave:g,reconnectRadius:h,onReconnect:c,onReconnectStart:d,onReconnectEnd:x,rfId:p,edgeTypes:w,noPanClassName:m,onError:y,disableKeyboardA11y:b}){let f=J(X=>X.edgeLookup.get(e));const v=J(X=>X.defaultEdgeOptions);f=v?{...v,...f}:f;let M=f.type||"default",N=(w==null?void 0:w[M])||Ln[M];N===void 0&&(y==null||y("011",de.error011(M)),M="default",N=(w==null?void 0:w.default)||Ln.default);const k=!!(f.focusable||t&&typeof f.focusable>"u"),I=typeof c<"u"&&(f.reconnectable||n&&typeof f.reconnectable>"u"),A=!!(f.selectable||s&&typeof f.selectable>"u"),R=S.useRef(null),[C,E]=S.useState(!1),[D,z]=S.useState(!1),_=re(),{zIndex:V,sourceX:H,sourceY:P,targetX:j,targetY:$,sourcePosition:T,targetPosition:L}=J(S.useCallback(X=>{const Z=X.nodeLookup.get(f.source),te=X.nodeLookup.get(f.target);if(!Z||!te)return{zIndex:f.zIndex,..._n};const se=oi({id:e,sourceNode:Z,targetNode:te,sourceHandle:f.sourceHandle||null,targetHandle:f.targetHandle||null,connectionMode:X.connectionMode,onError:y});return{zIndex:qr({selected:f.selected,zIndex:f.zIndex,sourceNode:Z,targetNode:te,elevateOnSelect:X.elevateEdgesOnSelect,zIndexMode:X.zIndexMode}),...se||_n}},[f.source,f.target,f.sourceHandle,f.targetHandle,f.selected,f.zIndex]),oe),B=S.useMemo(()=>f.markerStart?`url('#${kt(f.markerStart,p)}')`:void 0,[f.markerStart,p]),W=S.useMemo(()=>f.markerEnd?`url('#${kt(f.markerEnd,p)}')`:void 0,[f.markerEnd,p]);if(f.hidden||H===null||P===null||j===null||$===null)return null;const K=X=>{var ee;const{addSelectedEdges:Z,unselectNodesAndEdges:te,multiSelectionActive:se}=_.getState();A&&(_.setState({nodesSelectionActive:!1}),f.selected&&se?(te({nodes:[],edges:[f]}),(ee=R.current)==null||ee.blur()):Z([e])),o&&o(X,f)},q=r?X=>{r(X,{...f})}:void 0,Y=i?X=>{i(X,{...f})}:void 0,F=a?X=>{a(X,{...f})}:void 0,G=u?X=>{u(X,{...f})}:void 0,Q=g?X=>{g(X,{...f})}:void 0,U=X=>{var Z;if(!b&&qn.includes(X.key)&&A){const{unselectNodesAndEdges:te,addSelectedEdges:se}=_.getState();X.key==="Escape"?((Z=R.current)==null||Z.blur(),te({edges:[f]})):se([e])}};return l.jsx("svg",{style:{zIndex:V},children:l.jsxs("g",{className:ie(["react-flow__edge",`react-flow__edge-${M}`,f.className,m,{selected:f.selected,animated:f.animated,inactive:!A&&!o,updating:C,selectable:A}]),onClick:K,onDoubleClick:q,onContextMenu:Y,onMouseEnter:F,onMouseMove:G,onMouseLeave:Q,onKeyDown:k?U:void 0,tabIndex:k?0:void 0,role:f.ariaRole??(k?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":f.ariaLabel===null?void 0:f.ariaLabel||`Edge from ${f.source} to ${f.target}`,"aria-describedby":k?`${Is}-${p}`:void 0,ref:R,...f.domAttributes,children:[!D&&l.jsx(N,{id:e,source:f.source,target:f.target,type:f.type,selected:f.selected,animated:f.animated,selectable:A,deletable:f.deletable??!0,label:f.label,labelStyle:f.labelStyle,labelShowBg:f.labelShowBg,labelBgStyle:f.labelBgStyle,labelBgPadding:f.labelBgPadding,labelBgBorderRadius:f.labelBgBorderRadius,sourceX:H,sourceY:P,targetX:j,targetY:$,sourcePosition:T,targetPosition:L,data:f.data,style:f.style,sourceHandleId:f.sourceHandle,targetHandleId:f.targetHandle,markerStart:B,markerEnd:W,pathOptions:"pathOptions"in f?f.pathOptions:void 0,interactionWidth:f.interactionWidth}),I&&l.jsx(oc,{edge:f,isReconnectable:I,reconnectRadius:h,onReconnect:c,onReconnectStart:d,onReconnectEnd:x,sourceX:H,sourceY:P,targetX:j,targetY:$,sourcePosition:T,targetPosition:L,setUpdateHover:E,setReconnecting:z})]})})}var ic=S.memo(rc);const ac=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function no({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:o,onReconnect:r,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:u,onEdgeMouseLeave:g,onEdgeClick:h,reconnectRadius:c,onEdgeDoubleClick:d,onReconnectStart:x,onReconnectEnd:p,disableKeyboardA11y:w}){const{edgesFocusable:m,edgesReconnectable:y,elementsSelectable:b,onError:f}=J(ac,oe),v=Ya(t);return l.jsxs("div",{className:"react-flow__edges",children:[l.jsx(Ka,{defaultColor:e,rfId:n}),v.map(M=>l.jsx(ic,{id:M,edgesFocusable:m,edgesReconnectable:y,elementsSelectable:b,noPanClassName:o,onReconnect:r,onContextMenu:i,onMouseEnter:a,onMouseMove:u,onMouseLeave:g,onClick:h,reconnectRadius:c,onDoubleClick:d,onReconnectStart:x,onReconnectEnd:p,rfId:n,onError:f,edgeTypes:s,disableKeyboardA11y:w},M))]})}no.displayName="EdgeRenderer";const cc=S.memo(no),lc=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function dc({children:e}){const t=J(lc);return l.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function uc(e){const t=Ft(),n=S.useRef(!1);S.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const fc=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function gc(e){const t=J(fc),n=re();return S.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function pc(e){return e.connection.inProgress?{...e.connection,to:Ue(e.connection.to,e.transform)}:{...e.connection}}function hc(e){return pc}function mc(e){const t=hc();return J(t,oe)}const xc=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function yc({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:o,width:r,height:i,isValid:a,inProgress:u}=J(xc,oe);return!(r&&o&&u)?null:l.jsx("svg",{style:e,width:r,height:i,className:"react-flow__connectionline react-flow__container",children:l.jsx("g",{className:ie(["react-flow__connection",es(a)]),children:l.jsx(so,{style:t,type:n,CustomComponent:s,isValid:a})})})}const so=({style:e,type:t=ye.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:o,from:r,fromNode:i,fromHandle:a,fromPosition:u,to:g,toNode:h,toHandle:c,toPosition:d,pointer:x}=mc();if(!o)return;if(n)return l.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:a,fromX:r.x,fromY:r.y,toX:g.x,toY:g.y,fromPosition:u,toPosition:d,connectionStatus:es(s),toNode:h,toHandle:c,pointer:x});let p="";const w={sourceX:r.x,sourceY:r.y,sourcePosition:u,targetX:g.x,targetY:g.y,targetPosition:d};switch(t){case ye.Bezier:[p]=fs(w);break;case ye.SimpleBezier:[p]=Ws(w);break;case ye.Step:[p]=jt({...w,borderRadius:0});break;case ye.SmoothStep:[p]=jt(w);break;default:[p]=hs(w)}return l.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:e})};so.displayName="ConnectionLine";const wc={};function Rn(e=wc){S.useRef(e),re(),S.useEffect(()=>{},[e])}function bc(){re(),S.useRef(!1),S.useEffect(()=>{},[])}function oo({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:o,onNodeDoubleClick:r,onEdgeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:u,onNodeMouseLeave:g,onNodeContextMenu:h,onSelectionContextMenu:c,onSelectionStart:d,onSelectionEnd:x,connectionLineType:p,connectionLineStyle:w,connectionLineComponent:m,connectionLineContainerStyle:y,selectionKeyCode:b,selectionOnDrag:f,selectionMode:v,multiSelectionKeyCode:M,panActivationKeyCode:N,zoomActivationKeyCode:k,deleteKeyCode:I,onlyRenderVisibleElements:A,elementsSelectable:R,defaultViewport:C,translateExtent:E,minZoom:D,maxZoom:z,preventScrolling:_,defaultMarkerColor:V,zoomOnScroll:H,zoomOnPinch:P,panOnScroll:j,panOnScrollSpeed:$,panOnScrollMode:T,zoomOnDoubleClick:L,panOnDrag:B,onPaneClick:W,onPaneMouseEnter:K,onPaneMouseMove:q,onPaneMouseLeave:Y,onPaneScroll:F,onPaneContextMenu:G,paneClickDistance:Q,nodeClickDistance:U,onEdgeContextMenu:X,onEdgeMouseEnter:Z,onEdgeMouseMove:te,onEdgeMouseLeave:se,reconnectRadius:ee,onReconnect:ae,onReconnectStart:he,onReconnectEnd:ue,noDragClassName:be,noWheelClassName:Le,noPanClassName:_e,disableKeyboardA11y:ze,nodeExtent:pt,rfId:qe,viewport:je,onViewportChange:He}){return Rn(e),Rn(t),bc(),uc(n),gc(je),l.jsx(La,{onPaneClick:W,onPaneMouseEnter:K,onPaneMouseMove:q,onPaneMouseLeave:Y,onPaneContextMenu:G,onPaneScroll:F,paneClickDistance:Q,deleteKeyCode:I,selectionKeyCode:b,selectionOnDrag:f,selectionMode:v,onSelectionStart:d,onSelectionEnd:x,multiSelectionKeyCode:M,panActivationKeyCode:N,zoomActivationKeyCode:k,elementsSelectable:R,zoomOnScroll:H,zoomOnPinch:P,zoomOnDoubleClick:L,panOnScroll:j,panOnScrollSpeed:$,panOnScrollMode:T,panOnDrag:B,defaultViewport:C,translateExtent:E,minZoom:D,maxZoom:z,onSelectionContextMenu:c,preventScrolling:_,noDragClassName:be,noWheelClassName:Le,noPanClassName:_e,disableKeyboardA11y:ze,onViewportChange:He,isControlledViewport:!!je,children:l.jsxs(dc,{children:[l.jsx(cc,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:ae,onReconnectStart:he,onReconnectEnd:ue,onlyRenderVisibleElements:A,onEdgeContextMenu:X,onEdgeMouseEnter:Z,onEdgeMouseMove:te,onEdgeMouseLeave:se,reconnectRadius:ee,defaultMarkerColor:V,noPanClassName:_e,disableKeyboardA11y:ze,rfId:qe}),l.jsx(yc,{style:w,type:p,component:m,containerStyle:y}),l.jsx("div",{className:"react-flow__edgelabel-renderer"}),l.jsx(Wa,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:r,onNodeMouseEnter:a,onNodeMouseMove:u,onNodeMouseLeave:g,onNodeContextMenu:h,nodeClickDistance:U,onlyRenderVisibleElements:A,noPanClassName:_e,noDragClassName:be,disableKeyboardA11y:ze,nodeExtent:pt,rfId:qe}),l.jsx("div",{className:"react-flow__viewport-portal"})]})})}oo.displayName="GraphView";const vc=S.memo(oo),Vn=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:u=.5,maxZoom:g=2,nodeOrigin:h,nodeExtent:c,zIndexMode:d="basic"}={})=>{const x=new Map,p=new Map,w=new Map,m=new Map,y=s??t??[],b=n??e??[],f=h??[0,0],v=c??Be;ys(w,m,y);const M=Mt(b,x,p,{nodeOrigin:f,nodeExtent:v,zIndexMode:d});let N=[0,0,1];if(i&&o&&r){const k=Xe(x,{filter:C=>!!((C.width||C.initialWidth)&&(C.height||C.initialHeight))}),{x:I,y:A,zoom:R}=Lt(k,o,r,u,g,(a==null?void 0:a.padding)??.1);N=[I,A,R]}return{rfId:"1",width:o??0,height:r??0,transform:N,nodes:b,nodesInitialized:M,nodeLookup:x,parentLookup:p,edges:y,edgeLookup:m,connectionLookup:w,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:u,maxZoom:g,translateExtent:Be,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Ie.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:f,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Jn},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Yr,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Qn,zIndexMode:d,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},Nc=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:u,maxZoom:g,nodeOrigin:h,nodeExtent:c,zIndexMode:d})=>Vi((x,p)=>{async function w(){const{nodeLookup:m,panZoom:y,fitViewOptions:b,fitViewResolver:f,width:v,height:M,minZoom:N,maxZoom:k}=p();y&&(await Or({nodes:m,width:v,height:M,panZoom:y,minZoom:N,maxZoom:k},b),f==null||f.resolve(!0),x({fitViewResolver:null}))}return{...Vn({nodes:e,edges:t,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:u,maxZoom:g,nodeOrigin:h,nodeExtent:c,defaultNodes:n,defaultEdges:s,zIndexMode:d}),setNodes:m=>{const{nodeLookup:y,parentLookup:b,nodeOrigin:f,elevateNodesOnSelect:v,fitViewQueued:M,zIndexMode:N}=p(),k=Mt(m,y,b,{nodeOrigin:f,nodeExtent:c,elevateNodesOnSelect:v,checkEquality:!0,zIndexMode:N});M&&k?(w(),x({nodes:m,nodesInitialized:k,fitViewQueued:!1,fitViewOptions:void 0})):x({nodes:m,nodesInitialized:k})},setEdges:m=>{const{connectionLookup:y,edgeLookup:b}=p();ys(y,b,m),x({edges:m})},setDefaultNodesAndEdges:(m,y)=>{if(m){const{setNodes:b}=p();b(m),x({hasDefaultNodes:!0})}if(y){const{setEdges:b}=p();b(y),x({hasDefaultEdges:!0})}},updateNodeInternals:m=>{const{triggerNodeChanges:y,nodeLookup:b,parentLookup:f,domNode:v,nodeOrigin:M,nodeExtent:N,debug:k,fitViewQueued:I,zIndexMode:A}=p(),{changes:R,updatedInternals:C}=fi(m,b,f,v,M,N,A);C&&(ci(b,f,{nodeOrigin:M,nodeExtent:N,zIndexMode:A}),I?(w(),x({fitViewQueued:!1,fitViewOptions:void 0})):x({}),(R==null?void 0:R.length)>0&&(k&&console.log("React Flow: trigger node changes",R),y==null||y(R)))},updateNodePositions:(m,y=!1)=>{const b=[];let f=[];const{nodeLookup:v,triggerNodeChanges:M,connection:N,updateConnection:k,onNodesChangeMiddlewareMap:I}=p();for(const[A,R]of m){const C=v.get(A),E=!!(C!=null&&C.expandParent&&(C!=null&&C.parentId)&&(R!=null&&R.position)),D={id:A,type:"position",position:E?{x:Math.max(0,R.position.x),y:Math.max(0,R.position.y)}:R.position,dragging:y};if(C&&N.inProgress&&N.fromNode.id===C.id){const z=Ce(C,N.fromHandle,O.Left,!0);k({...N,from:z})}E&&C.parentId&&b.push({id:A,parentId:C.parentId,rect:{...R.internals.positionAbsolute,width:R.measured.width??0,height:R.measured.height??0}}),f.push(D)}if(b.length>0){const{parentLookup:A,nodeOrigin:R}=p(),C=Bt(b,v,A,R);f.push(...C)}for(const A of I.values())f=A(f);M(f)},triggerNodeChanges:m=>{const{onNodesChange:y,setNodes:b,nodes:f,hasDefaultNodes:v,debug:M}=p();if(m!=null&&m.length){if(v){const N=Ds(m,f);b(N)}M&&console.log("React Flow: trigger node changes",m),y==null||y(m)}},triggerEdgeChanges:m=>{const{onEdgesChange:y,setEdges:b,edges:f,hasDefaultEdges:v,debug:M}=p();if(m!=null&&m.length){if(v){const N=Ts(m,f);b(N)}M&&console.log("React Flow: trigger edge changes",m),y==null||y(m)}},addSelectedNodes:m=>{const{multiSelectionActive:y,edgeLookup:b,nodeLookup:f,triggerNodeChanges:v,triggerEdgeChanges:M}=p();if(y){const N=m.map(k=>ve(k,!0));v(N);return}v(Ae(f,new Set([...m]),!0)),M(Ae(b))},addSelectedEdges:m=>{const{multiSelectionActive:y,edgeLookup:b,nodeLookup:f,triggerNodeChanges:v,triggerEdgeChanges:M}=p();if(y){const N=m.map(k=>ve(k,!0));M(N);return}M(Ae(b,new Set([...m]))),v(Ae(f,new Set,!0))},unselectNodesAndEdges:({nodes:m,edges:y}={})=>{const{edges:b,nodes:f,nodeLookup:v,triggerNodeChanges:M,triggerEdgeChanges:N}=p(),k=m||f,I=y||b,A=k.map(C=>{const E=v.get(C.id);return E&&(E.selected=!1),ve(C.id,!1)}),R=I.map(C=>ve(C.id,!1));M(A),N(R)},setMinZoom:m=>{const{panZoom:y,maxZoom:b}=p();y==null||y.setScaleExtent([m,b]),x({minZoom:m})},setMaxZoom:m=>{const{panZoom:y,minZoom:b}=p();y==null||y.setScaleExtent([b,m]),x({maxZoom:m})},setTranslateExtent:m=>{var y;(y=p().panZoom)==null||y.setTranslateExtent(m),x({translateExtent:m})},resetSelectedElements:()=>{const{edges:m,nodes:y,triggerNodeChanges:b,triggerEdgeChanges:f,elementsSelectable:v}=p();if(!v)return;const M=y.reduce((k,I)=>I.selected?[...k,ve(I.id,!1)]:k,[]),N=m.reduce((k,I)=>I.selected?[...k,ve(I.id,!1)]:k,[]);b(M),f(N)},setNodeExtent:m=>{const{nodes:y,nodeLookup:b,parentLookup:f,nodeOrigin:v,elevateNodesOnSelect:M,nodeExtent:N,zIndexMode:k}=p();m[0][0]===N[0][0]&&m[0][1]===N[0][1]&&m[1][0]===N[1][0]&&m[1][1]===N[1][1]||(Mt(y,b,f,{nodeOrigin:v,nodeExtent:m,elevateNodesOnSelect:M,checkEquality:!1,zIndexMode:k}),x({nodeExtent:m}))},panBy:m=>{const{transform:y,width:b,height:f,panZoom:v,translateExtent:M}=p();return gi({delta:m,panZoom:v,transform:y,translateExtent:M,width:b,height:f})},setCenter:async(m,y,b)=>{const{width:f,height:v,maxZoom:M,panZoom:N}=p();if(!N)return Promise.resolve(!1);const k=typeof(b==null?void 0:b.zoom)<"u"?b.zoom:M;return await N.setViewport({x:f/2-m*k,y:v/2-y*k,zoom:k},{duration:b==null?void 0:b.duration,ease:b==null?void 0:b.ease,interpolate:b==null?void 0:b.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{x({connection:{...Jn}})},updateConnection:m=>{x({connection:m})},reset:()=>x({...Vn()})}},Object.is);function Sc({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:o,initialHeight:r,initialMinZoom:i,initialMaxZoom:a,initialFitViewOptions:u,fitView:g,nodeOrigin:h,nodeExtent:c,zIndexMode:d,children:x}){const[p]=S.useState(()=>Nc({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:g,minZoom:i,maxZoom:a,fitViewOptions:u,nodeOrigin:h,nodeExtent:c,zIndexMode:d}));return l.jsx(Bi,{value:p,children:l.jsx(da,{children:x})})}function Ec({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:o,width:r,height:i,fitView:a,fitViewOptions:u,minZoom:g,maxZoom:h,nodeOrigin:c,nodeExtent:d,zIndexMode:x}){return S.useContext(dt)?l.jsx(l.Fragment,{children:e}):l.jsx(Sc,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:o,initialWidth:r,initialHeight:i,fitView:a,initialFitViewOptions:u,initialMinZoom:g,initialMaxZoom:h,nodeOrigin:c,nodeExtent:d,zIndexMode:x,children:e})}const Cc={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function jc({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:o,nodeTypes:r,edgeTypes:i,onNodeClick:a,onEdgeClick:u,onInit:g,onMove:h,onMoveStart:c,onMoveEnd:d,onConnect:x,onConnectStart:p,onConnectEnd:w,onClickConnectStart:m,onClickConnectEnd:y,onNodeMouseEnter:b,onNodeMouseMove:f,onNodeMouseLeave:v,onNodeContextMenu:M,onNodeDoubleClick:N,onNodeDragStart:k,onNodeDrag:I,onNodeDragStop:A,onNodesDelete:R,onEdgesDelete:C,onDelete:E,onSelectionChange:D,onSelectionDragStart:z,onSelectionDrag:_,onSelectionDragStop:V,onSelectionContextMenu:H,onSelectionStart:P,onSelectionEnd:j,onBeforeDelete:$,connectionMode:T,connectionLineType:L=ye.Bezier,connectionLineStyle:B,connectionLineComponent:W,connectionLineContainerStyle:K,deleteKeyCode:q="Backspace",selectionKeyCode:Y="Shift",selectionOnDrag:F=!1,selectionMode:G=Fe.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:U=We()?"Meta":"Control",zoomActivationKeyCode:X=We()?"Meta":"Control",snapToGrid:Z,snapGrid:te,onlyRenderVisibleElements:se=!1,selectNodesOnDrag:ee,nodesDraggable:ae,autoPanOnNodeFocus:he,nodesConnectable:ue,nodesFocusable:be,nodeOrigin:Le=Ps,edgesFocusable:_e,edgesReconnectable:ze,elementsSelectable:pt=!0,defaultViewport:qe=ea,minZoom:je=.5,maxZoom:He=2,translateExtent:Yt=Be,preventScrolling:lo=!0,nodeExtent:ht,defaultMarkerColor:uo="#b1b1b7",zoomOnScroll:fo=!0,zoomOnPinch:go=!0,panOnScroll:po=!1,panOnScrollSpeed:ho=.5,panOnScrollMode:mo=Se.Free,zoomOnDoubleClick:xo=!0,panOnDrag:yo=!0,onPaneClick:wo,onPaneMouseEnter:bo,onPaneMouseMove:vo,onPaneMouseLeave:No,onPaneScroll:So,onPaneContextMenu:Eo,paneClickDistance:Co=1,nodeClickDistance:jo=0,children:ko,onReconnect:Mo,onReconnectStart:Ao,onReconnectEnd:Io,onEdgeContextMenu:Po,onEdgeDoubleClick:$o,onEdgeMouseEnter:Do,onEdgeMouseMove:To,onEdgeMouseLeave:Lo,reconnectRadius:_o=10,onNodesChange:zo,onEdgesChange:Ho,noDragClassName:Ro="nodrag",noWheelClassName:Vo="nowheel",noPanClassName:Zt="nopan",fitView:Xt,fitViewOptions:Gt,connectOnClick:Bo,attributionPosition:Fo,proOptions:Oo,defaultEdgeOptions:Wo,elevateNodesOnSelect:Yo=!0,elevateEdgesOnSelect:Zo=!1,disableKeyboardA11y:Ut=!1,autoPanOnConnect:Xo,autoPanOnNodeDrag:Go,autoPanSpeed:Uo,connectionRadius:Ko,isValidConnection:qo,onError:Qo,style:Jo,id:Kt,nodeDragThreshold:er,connectionDragThreshold:tr,viewport:nr,onViewportChange:sr,width:or,height:rr,colorMode:ir="light",debug:ar,onScroll:Qe,ariaLabelConfig:cr,zIndexMode:qt="basic",...lr},dr){const mt=Kt||"1",ur=oa(ir),fr=S.useCallback(Qt=>{Qt.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Qe==null||Qe(Qt)},[Qe]);return l.jsx("div",{"data-testid":"rf__wrapper",...lr,onScroll:fr,style:{...Jo,...Cc},ref:dr,className:ie(["react-flow",o,ur]),id:Kt,role:"application",children:l.jsxs(Ec,{nodes:e,edges:t,width:or,height:rr,fitView:Xt,fitViewOptions:Gt,minZoom:je,maxZoom:He,nodeOrigin:Le,nodeExtent:ht,zIndexMode:qt,children:[l.jsx(vc,{onInit:g,onNodeClick:a,onEdgeClick:u,onNodeMouseEnter:b,onNodeMouseMove:f,onNodeMouseLeave:v,onNodeContextMenu:M,onNodeDoubleClick:N,nodeTypes:r,edgeTypes:i,connectionLineType:L,connectionLineStyle:B,connectionLineComponent:W,connectionLineContainerStyle:K,selectionKeyCode:Y,selectionOnDrag:F,selectionMode:G,deleteKeyCode:q,multiSelectionKeyCode:U,panActivationKeyCode:Q,zoomActivationKeyCode:X,onlyRenderVisibleElements:se,defaultViewport:qe,translateExtent:Yt,minZoom:je,maxZoom:He,preventScrolling:lo,zoomOnScroll:fo,zoomOnPinch:go,zoomOnDoubleClick:xo,panOnScroll:po,panOnScrollSpeed:ho,panOnScrollMode:mo,panOnDrag:yo,onPaneClick:wo,onPaneMouseEnter:bo,onPaneMouseMove:vo,onPaneMouseLeave:No,onPaneScroll:So,onPaneContextMenu:Eo,paneClickDistance:Co,nodeClickDistance:jo,onSelectionContextMenu:H,onSelectionStart:P,onSelectionEnd:j,onReconnect:Mo,onReconnectStart:Ao,onReconnectEnd:Io,onEdgeContextMenu:Po,onEdgeDoubleClick:$o,onEdgeMouseEnter:Do,onEdgeMouseMove:To,onEdgeMouseLeave:Lo,reconnectRadius:_o,defaultMarkerColor:uo,noDragClassName:Ro,noWheelClassName:Vo,noPanClassName:Zt,rfId:mt,disableKeyboardA11y:Ut,nodeExtent:ht,viewport:nr,onViewportChange:sr}),l.jsx(sa,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:x,onConnectStart:p,onConnectEnd:w,onClickConnectStart:m,onClickConnectEnd:y,nodesDraggable:ae,autoPanOnNodeFocus:he,nodesConnectable:ue,nodesFocusable:be,edgesFocusable:_e,edgesReconnectable:ze,elementsSelectable:pt,elevateNodesOnSelect:Yo,elevateEdgesOnSelect:Zo,minZoom:je,maxZoom:He,nodeExtent:ht,onNodesChange:zo,onEdgesChange:Ho,snapToGrid:Z,snapGrid:te,connectionMode:T,translateExtent:Yt,connectOnClick:Bo,defaultEdgeOptions:Wo,fitView:Xt,fitViewOptions:Gt,onNodesDelete:R,onEdgesDelete:C,onDelete:E,onNodeDragStart:k,onNodeDrag:I,onNodeDragStop:A,onSelectionDrag:_,onSelectionDragStart:z,onSelectionDragStop:V,onMove:h,onMoveStart:c,onMoveEnd:d,noPanClassName:Zt,nodeOrigin:Le,rfId:mt,autoPanOnConnect:Xo,autoPanOnNodeDrag:Go,autoPanSpeed:Uo,onError:Qo,connectionRadius:Ko,isValidConnection:qo,selectNodesOnDrag:ee,nodeDragThreshold:er,connectionDragThreshold:tr,onBeforeDelete:$,debug:ar,ariaLabelConfig:cr,zIndexMode:qt}),l.jsx(Ji,{onSelectionChange:D}),ko,l.jsx(Gi,{proOptions:Oo,position:Fo}),l.jsx(Xi,{rfId:mt,disableKeyboardA11y:Ut})]})})}var kc=Ls(jc);function Mc(e){const[t,n]=S.useState(e),s=S.useCallback(o=>n(r=>Ds(o,r)),[]);return[t,n,s]}function Ac(e){const[t,n]=S.useState(e),s=S.useCallback(o=>n(r=>Ts(o,r)),[]);return[t,n,s]}function Ic({dimensions:e,lineWidth:t,variant:n,className:s}){return l.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:ie(["react-flow__background-pattern",n,s])})}function Pc({radius:e,className:t}){return l.jsx("circle",{cx:e,cy:e,r:e,className:ie(["react-flow__background-pattern","dots",t])})}var ge;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ge||(ge={}));const $c={[ge.Dots]:1,[ge.Lines]:1,[ge.Cross]:6},Dc=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ro({id:e,variant:t=ge.Dots,gap:n=20,size:s,lineWidth:o=1,offset:r=0,color:i,bgColor:a,style:u,className:g,patternClassName:h}){const c=S.useRef(null),{transform:d,patternId:x}=J(Dc,oe),p=s||$c[t],w=t===ge.Dots,m=t===ge.Cross,y=Array.isArray(n)?n:[n,n],b=[y[0]*d[2]||1,y[1]*d[2]||1],f=p*d[2],v=Array.isArray(r)?r:[r,r],M=m?[f,f]:b,N=[v[0]*d[2]||1+M[0]/2,v[1]*d[2]||1+M[1]/2],k=`${x}${e||""}`;return l.jsxs("svg",{className:ie(["react-flow__background",g]),style:{...u,...ut,"--xy-background-color-props":a,"--xy-background-pattern-color-props":i},ref:c,"data-testid":"rf__background",children:[l.jsx("pattern",{id:k,x:d[0]%b[0],y:d[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${N[0]},-${N[1]})`,children:w?l.jsx(Pc,{radius:f/2,className:h}):l.jsx(Ic,{dimensions:M,lineWidth:o,variant:t,className:h})}),l.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${k})`})]})}ro.displayName="Background";const Tc=S.memo(ro);function Lc(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:l.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function _c(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:l.jsx("path",{d:"M0 0h32v4.2H0z"})})}function zc(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:l.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Hc(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:l.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Rc(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:l.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function nt({children:e,className:t,...n}){return l.jsx("button",{type:"button",className:ie(["react-flow__controls-button",t]),...n,children:e})}const Vc=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function io({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:o,onZoomIn:r,onZoomOut:i,onFitView:a,onInteractiveChange:u,className:g,children:h,position:c="bottom-left",orientation:d="vertical","aria-label":x}){const p=re(),{isInteractive:w,minZoomReached:m,maxZoomReached:y,ariaLabelConfig:b}=J(Vc,oe),{zoomIn:f,zoomOut:v,fitView:M}=Ft(),N=()=>{f(),r==null||r()},k=()=>{v(),i==null||i()},I=()=>{M(o),a==null||a()},A=()=>{p.setState({nodesDraggable:!w,nodesConnectable:!w,elementsSelectable:!w}),u==null||u(!w)},R=d==="horizontal"?"horizontal":"vertical";return l.jsxs(Ke,{className:ie(["react-flow__controls",R,g]),position:c,style:e,"data-testid":"rf__controls","aria-label":x??b["controls.ariaLabel"],children:[t&&l.jsxs(l.Fragment,{children:[l.jsx(nt,{onClick:N,className:"react-flow__controls-zoomin",title:b["controls.zoomIn.ariaLabel"],"aria-label":b["controls.zoomIn.ariaLabel"],disabled:y,children:l.jsx(Lc,{})}),l.jsx(nt,{onClick:k,className:"react-flow__controls-zoomout",title:b["controls.zoomOut.ariaLabel"],"aria-label":b["controls.zoomOut.ariaLabel"],disabled:m,children:l.jsx(_c,{})})]}),n&&l.jsx(nt,{className:"react-flow__controls-fitview",onClick:I,title:b["controls.fitView.ariaLabel"],"aria-label":b["controls.fitView.ariaLabel"],children:l.jsx(zc,{})}),s&&l.jsx(nt,{className:"react-flow__controls-interactive",onClick:A,title:b["controls.interactive.ariaLabel"],"aria-label":b["controls.interactive.ariaLabel"],children:w?l.jsx(Rc,{}):l.jsx(Hc,{})}),h]})}io.displayName="Controls";const Bc=S.memo(io);function Fc({id:e,x:t,y:n,width:s,height:o,style:r,color:i,strokeColor:a,strokeWidth:u,className:g,borderRadius:h,shapeRendering:c,selected:d,onClick:x}){const{background:p,backgroundColor:w}=r||{},m=i||p||w;return l.jsx("rect",{className:ie(["react-flow__minimap-node",{selected:d},g]),x:t,y:n,rx:h,ry:h,width:s,height:o,style:{fill:m,stroke:a,strokeWidth:u},shapeRendering:c,onClick:x?y=>x(y,e):void 0})}const Oc=S.memo(Fc),Wc=e=>e.nodes.map(t=>t.id),Et=e=>e instanceof Function?e:()=>e;function Yc({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:o,nodeComponent:r=Oc,onClick:i}){const a=J(Wc,oe),u=Et(t),g=Et(e),h=Et(n),c=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return l.jsx(l.Fragment,{children:a.map(d=>l.jsx(Xc,{id:d,nodeColorFunc:u,nodeStrokeColorFunc:g,nodeClassNameFunc:h,nodeBorderRadius:s,nodeStrokeWidth:o,NodeComponent:r,onClick:i,shapeRendering:c},d))})}function Zc({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:o,nodeStrokeWidth:r,shapeRendering:i,NodeComponent:a,onClick:u}){const{node:g,x:h,y:c,width:d,height:x}=J(p=>{const{internals:w}=p.nodeLookup.get(e),m=w.userNode,{x:y,y:b}=w.positionAbsolute,{width:f,height:v}=pe(m);return{node:m,x:y,y:b,width:f,height:v}},oe);return!g||g.hidden||!is(g)?null:l.jsx(a,{x:h,y:c,width:d,height:x,style:g.style,selected:!!g.selected,className:s(g),color:t(g),borderRadius:o,strokeColor:n(g),strokeWidth:r,shapeRendering:i,onClick:u,id:g.id})}const Xc=S.memo(Zc);var Gc=S.memo(Yc);const Uc=200,Kc=150,qc=e=>!e.hidden,Qc=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?rs(Xe(e.nodeLookup,{filter:qc}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Jc="react-flow__minimap-desc";function ao({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:o="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:a,bgColor:u,maskColor:g,maskStrokeColor:h,maskStrokeWidth:c,position:d="bottom-right",onClick:x,onNodeClick:p,pannable:w=!1,zoomable:m=!1,ariaLabel:y,inversePan:b,zoomStep:f=1,offsetScale:v=5}){const M=re(),N=S.useRef(null),{boundingRect:k,viewBB:I,rfId:A,panZoom:R,translateExtent:C,flowWidth:E,flowHeight:D,ariaLabelConfig:z}=J(Qc,oe),_=(e==null?void 0:e.width)??Uc,V=(e==null?void 0:e.height)??Kc,H=k.width/_,P=k.height/V,j=Math.max(H,P),$=j*_,T=j*V,L=v*j,B=k.x-($-k.width)/2-L,W=k.y-(T-k.height)/2-L,K=$+L*2,q=T+L*2,Y=`${Jc}-${A}`,F=S.useRef(0),G=S.useRef();F.current=j,S.useEffect(()=>{if(N.current&&R)return G.current=Ni({domNode:N.current,panZoom:R,getTransform:()=>M.getState().transform,getViewScale:()=>F.current}),()=>{var Z;(Z=G.current)==null||Z.destroy()}},[R]),S.useEffect(()=>{var Z;(Z=G.current)==null||Z.update({translateExtent:C,width:E,height:D,inversePan:b,pannable:w,zoomStep:f,zoomable:m})},[w,m,b,f,C,E,D]);const Q=x?Z=>{var ee;const[te,se]=((ee=G.current)==null?void 0:ee.pointer(Z))||[0,0];x(Z,{x:te,y:se})}:void 0,U=p?S.useCallback((Z,te)=>{const se=M.getState().nodeLookup.get(te).internals.userNode;p(Z,se)},[]):void 0,X=y??z["minimap.ariaLabel"];return l.jsx(Ke,{position:d,style:{...e,"--xy-minimap-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-background-color-props":typeof g=="string"?g:void 0,"--xy-minimap-mask-stroke-color-props":typeof h=="string"?h:void 0,"--xy-minimap-mask-stroke-width-props":typeof c=="number"?c*j:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:ie(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:l.jsxs("svg",{width:_,height:V,viewBox:`${B} ${W} ${K} ${q}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Y,ref:N,onClick:Q,children:[X&&l.jsx("title",{id:Y,children:X}),l.jsx(Gc,{onClick:U,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:a}),l.jsx("path",{className:"react-flow__minimap-mask",d:`M${B-L},${W-L}h${K+L*2}v${q+L*2}h${-K-L*2}z
        M${I.x},${I.y}h${I.width}v${I.height}h${-I.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ao.displayName="MiniMap";const el=S.memo(ao),tl=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,nl={[Te.Line]:"right",[Te.Handle]:"bottom-right"};function sl({nodeId:e,position:t,variant:n=Te.Handle,className:s,style:o=void 0,children:r,color:i,minWidth:a=10,minHeight:u=10,maxWidth:g=Number.MAX_VALUE,maxHeight:h=Number.MAX_VALUE,keepAspectRatio:c=!1,resizeDirection:d,autoScale:x=!0,shouldResize:p,onResizeStart:w,onResize:m,onResizeEnd:y}){const b=Rs(),f=typeof e=="string"?e:b,v=re(),M=S.useRef(null),N=n===Te.Handle,k=J(S.useCallback(tl(N&&x),[N,x]),oe),I=S.useRef(null),A=t??nl[n];S.useEffect(()=>{if(!(!M.current||!f))return I.current||(I.current=_i({domNode:M.current,nodeId:f,getStoreItems:()=>{const{nodeLookup:C,transform:E,snapGrid:D,snapToGrid:z,nodeOrigin:_,domNode:V}=v.getState();return{nodeLookup:C,transform:E,snapGrid:D,snapToGrid:z,nodeOrigin:_,paneDomNode:V}},onChange:(C,E)=>{const{triggerNodeChanges:D,nodeLookup:z,parentLookup:_,nodeOrigin:V}=v.getState(),H=[],P={x:C.x,y:C.y},j=z.get(f);if(j&&j.expandParent&&j.parentId){const $=j.origin??V,T=C.width??j.measured.width??0,L=C.height??j.measured.height??0,B={id:j.id,parentId:j.parentId,rect:{width:T,height:L,...as({x:C.x??j.position.x,y:C.y??j.position.y},{width:T,height:L},j.parentId,z,$)}},W=Bt([B],z,_,V);H.push(...W),P.x=C.x?Math.max($[0]*T,C.x):void 0,P.y=C.y?Math.max($[1]*L,C.y):void 0}if(P.x!==void 0&&P.y!==void 0){const $={id:f,type:"position",position:{...P}};H.push($)}if(C.width!==void 0&&C.height!==void 0){const T={id:f,type:"dimensions",resizing:!0,setAttributes:d?d==="horizontal"?"width":"height":!0,dimensions:{width:C.width,height:C.height}};H.push(T)}for(const $ of E){const T={...$,type:"position"};H.push(T)}D(H)},onEnd:({width:C,height:E})=>{const D={id:f,type:"dimensions",resizing:!1,dimensions:{width:C,height:E}};v.getState().triggerNodeChanges([D])}})),I.current.update({controlPosition:A,boundaries:{minWidth:a,minHeight:u,maxWidth:g,maxHeight:h},keepAspectRatio:c,resizeDirection:d,onResizeStart:w,onResize:m,onResizeEnd:y,shouldResize:p}),()=>{var C;(C=I.current)==null||C.destroy()}},[A,a,u,g,h,c,w,m,y,p]);const R=A.split("-");return l.jsx("div",{className:ie(["react-flow__resize-control","nodrag",...R,n,s]),ref:M,style:{...o,scale:k,...i&&{[N?"backgroundColor":"borderColor"]:i}},children:r})}S.memo(sl);const Wt={router:Lr,switch:Yn,firewall:Xn,server:Gn,database:Tr,cloud:Dr,workstation:en,laptop:en,mobile:$r,iot:Jt,printer:Pr,camera:Ir,wireless_ap:Ar,load_balancer:Mr,storage:kr,container:jr,virtual_machine:Jt,internet:Cr,vpn:Er},co={router:"Router",switch:"Switch",firewall:"Firewall",server:"Server",database:"Database",cloud:"Cloud Service",workstation:"Workstation",laptop:"Laptop",mobile:"Mobile Device",iot:"IoT Device",printer:"Printer",camera:"Camera",wireless_ap:"Wireless AP",load_balancer:"Load Balancer",storage:"Storage",container:"Container",virtual_machine:"Virtual Machine",internet:"Internet",vpn:"VPN Gateway"},gt={external:{bg:"bg-red-500/10",border:"border-red-500",text:"text-red-400"},dmz:{bg:"bg-yellow-500/10",border:"border-yellow-500",text:"text-yellow-400"},internal:{bg:"bg-blue-500/10",border:"border-blue-500",text:"text-blue-400"},restricted:{bg:"bg-purple-500/10",border:"border-purple-500",text:"text-purple-400"},management:{bg:"bg-green-500/10",border:"border-green-500",text:"text-green-400"}},ol={compliant:"ring-green-500",non_compliant:"ring-red-500",partial:"ring-yellow-500",not_assessed:"ring-gray-500"},rl=({data:e,selected:t})=>{const n=Wt[e.deviceType]||Gn,s=gt[e.securityZone],o=ol[e.complianceStatus],r=()=>{switch(e.complianceStatus){case"compliant":return l.jsx(Pt,{className:"w-3 h-3 text-green-400"});case"non_compliant":return l.jsx($t,{className:"w-3 h-3 text-red-400"});case"partial":return l.jsx(Ve,{className:"w-3 h-3 text-yellow-400"});default:return l.jsx(Kn,{className:"w-3 h-3 text-gray-400"})}};return l.jsxs("div",{className:`relative px-4 py-3 rounded-lg border-2 ${s.bg} ${s.border} ${t?"ring-2 ring-cyan-400":""} transition-all shadow-lg hover:shadow-xl`,children:[l.jsx(we,{type:"target",position:O.Top,className:"!bg-cyan-500 !w-3 !h-3"}),l.jsx(we,{type:"source",position:O.Bottom,className:"!bg-cyan-500 !w-3 !h-3"}),l.jsx(we,{type:"target",position:O.Left,className:"!bg-cyan-500 !w-3 !h-3"}),l.jsx(we,{type:"source",position:O.Right,className:"!bg-cyan-500 !w-3 !h-3"}),l.jsx("div",{className:`absolute -top-2 -right-2 p-1 rounded-full bg-gray-900 ring-2 ${o}`,children:l.jsx(r,{})}),l.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[100px]",children:[l.jsx("div",{className:`p-3 rounded-lg bg-gray-800/80 ${s.border} border`,children:l.jsx(n,{className:`w-8 h-8 ${s.text}`})}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"font-semibold text-white text-sm",children:e.label}),e.ipAddress&&l.jsx("div",{className:"text-xs text-gray-400 font-mono",children:e.ipAddress}),e.hostname&&l.jsx("div",{className:"text-xs text-gray-500",children:e.hostname})]}),e.vulnerabilities&&e.vulnerabilities>0&&l.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-400 bg-red-500/20 px-2 py-0.5 rounded",children:[l.jsx(Ve,{className:"w-3 h-3"}),e.vulnerabilities," vuln"]})]})]})},il=({data:e})=>{const t=gt[e.zone];return l.jsx("div",{className:`px-6 py-4 rounded-xl border-2 border-dashed ${t.border} ${t.bg} min-w-[200px] min-h-[150px]`,style:{pointerEvents:"none"},children:l.jsx("div",{className:`text-sm font-bold ${t.text} uppercase tracking-wider`,children:e.label})})},al={networkDevice:rl,securityZone:il},Bn=()=>{const e=[{id:"internet",type:"networkDevice",position:{x:400,y:0},data:{label:"Internet",deviceType:"internet",securityZone:"external",complianceStatus:"not_assessed"}},{id:"ext-firewall",type:"networkDevice",position:{x:400,y:120},data:{label:"External Firewall",deviceType:"firewall",securityZone:"dmz",ipAddress:"10.0.0.1",hostname:"fw-ext-01",complianceStatus:"compliant",controlsAssessed:45,controlsPassing:43}},{id:"dmz-switch",type:"networkDevice",position:{x:400,y:240},data:{label:"DMZ Switch",deviceType:"switch",securityZone:"dmz",ipAddress:"10.0.1.1",hostname:"sw-dmz-01",complianceStatus:"compliant",controlsAssessed:20,controlsPassing:20}},{id:"web-server",type:"networkDevice",position:{x:200,y:350},data:{label:"Web Server",deviceType:"server",securityZone:"dmz",ipAddress:"10.0.1.10",hostname:"web-01",os:"Ubuntu 22.04",complianceStatus:"partial",controlsAssessed:85,controlsPassing:72,vulnerabilities:3}},{id:"mail-server",type:"networkDevice",position:{x:400,y:350},data:{label:"Mail Server",deviceType:"server",securityZone:"dmz",ipAddress:"10.0.1.11",hostname:"mail-01",os:"RHEL 8",complianceStatus:"compliant",controlsAssessed:90,controlsPassing:88}},{id:"vpn-gateway",type:"networkDevice",position:{x:600,y:350},data:{label:"VPN Gateway",deviceType:"vpn",securityZone:"dmz",ipAddress:"10.0.1.12",hostname:"vpn-01",complianceStatus:"compliant",controlsAssessed:40,controlsPassing:40}},{id:"int-firewall",type:"networkDevice",position:{x:400,y:480},data:{label:"Internal Firewall",deviceType:"firewall",securityZone:"internal",ipAddress:"10.1.0.1",hostname:"fw-int-01",complianceStatus:"compliant",controlsAssessed:45,controlsPassing:44}},{id:"core-switch",type:"networkDevice",position:{x:400,y:600},data:{label:"Core Switch",deviceType:"switch",securityZone:"internal",ipAddress:"10.1.1.1",hostname:"sw-core-01",complianceStatus:"compliant",controlsAssessed:25,controlsPassing:25}},{id:"app-server-1",type:"networkDevice",position:{x:100,y:720},data:{label:"App Server 1",deviceType:"server",securityZone:"internal",ipAddress:"10.1.2.10",hostname:"app-01",os:"Windows Server 2022",complianceStatus:"partial",controlsAssessed:95,controlsPassing:80,vulnerabilities:5}},{id:"app-server-2",type:"networkDevice",position:{x:300,y:720},data:{label:"App Server 2",deviceType:"container",securityZone:"internal",ipAddress:"10.1.2.11",hostname:"k8s-node-01",os:"Kubernetes",complianceStatus:"compliant",controlsAssessed:100,controlsPassing:98}},{id:"load-balancer",type:"networkDevice",position:{x:200,y:600},data:{label:"Load Balancer",deviceType:"load_balancer",securityZone:"internal",ipAddress:"10.1.2.1",hostname:"lb-01",complianceStatus:"compliant",controlsAssessed:30,controlsPassing:30}},{id:"wireless-ap",type:"networkDevice",position:{x:600,y:720},data:{label:"Wireless AP",deviceType:"wireless_ap",securityZone:"internal",ipAddress:"10.1.3.1",hostname:"ap-01",complianceStatus:"partial",controlsAssessed:20,controlsPassing:16,vulnerabilities:2}},{id:"workstation-1",type:"networkDevice",position:{x:700,y:820},data:{label:"Workstation",deviceType:"workstation",securityZone:"internal",ipAddress:"10.1.4.100",hostname:"ws-001",os:"Windows 11",complianceStatus:"compliant",controlsAssessed:50,controlsPassing:48}},{id:"laptop-1",type:"networkDevice",position:{x:500,y:820},data:{label:"Mobile Laptop",deviceType:"laptop",securityZone:"internal",ipAddress:"DHCP",hostname:"laptop-001",os:"macOS",complianceStatus:"partial",controlsAssessed:45,controlsPassing:38,vulnerabilities:1}},{id:"db-firewall",type:"networkDevice",position:{x:200,y:850},data:{label:"DB Firewall",deviceType:"firewall",securityZone:"restricted",ipAddress:"10.2.0.1",hostname:"fw-db-01",complianceStatus:"compliant",controlsAssessed:50,controlsPassing:50}},{id:"primary-db",type:"networkDevice",position:{x:100,y:970},data:{label:"Primary Database",deviceType:"database",securityZone:"restricted",ipAddress:"10.2.1.10",hostname:"db-primary",os:"PostgreSQL 15",complianceStatus:"compliant",controlsAssessed:80,controlsPassing:78}},{id:"replica-db",type:"networkDevice",position:{x:300,y:970},data:{label:"Replica Database",deviceType:"database",securityZone:"restricted",ipAddress:"10.2.1.11",hostname:"db-replica",os:"PostgreSQL 15",complianceStatus:"compliant",controlsAssessed:80,controlsPassing:80}},{id:"storage-san",type:"networkDevice",position:{x:200,y:1080},data:{label:"SAN Storage",deviceType:"storage",securityZone:"restricted",ipAddress:"10.2.2.1",hostname:"san-01",complianceStatus:"compliant",controlsAssessed:40,controlsPassing:40}},{id:"mgmt-switch",type:"networkDevice",position:{x:700,y:600},data:{label:"Mgmt Switch",deviceType:"switch",securityZone:"management",ipAddress:"10.3.0.1",hostname:"sw-mgmt-01",complianceStatus:"compliant",controlsAssessed:20,controlsPassing:20}},{id:"siem",type:"networkDevice",position:{x:850,y:550},data:{label:"SIEM",deviceType:"server",securityZone:"management",ipAddress:"10.3.1.10",hostname:"siem-01",complianceStatus:"compliant",controlsAssessed:60,controlsPassing:58}},{id:"monitoring",type:"networkDevice",position:{x:850,y:670},data:{label:"Monitoring",deviceType:"server",securityZone:"management",ipAddress:"10.3.1.11",hostname:"monitor-01",complianceStatus:"compliant",controlsAssessed:45,controlsPassing:45}},{id:"cloud-aws",type:"networkDevice",position:{x:50,y:120},data:{label:"AWS Cloud",deviceType:"cloud",securityZone:"external",complianceStatus:"partial",controlsAssessed:120,controlsPassing:100,vulnerabilities:8,description:"Cloud infrastructure"}}],t=[{id:"e-internet-fw",source:"internet",target:"ext-firewall",animated:!0,style:{stroke:"#ef4444"},markerEnd:{type:ne.ArrowClosed,color:"#ef4444"},label:"HTTPS/443",data:{protocol:"HTTPS",port:443,encrypted:!0,dataClassification:"public"}},{id:"e-cloud-fw",source:"cloud-aws",target:"ext-firewall",animated:!0,style:{stroke:"#ef4444"},markerEnd:{type:ne.ArrowClosed,color:"#ef4444"},label:"VPN/IPSec",data:{protocol:"IPSec",encrypted:!0}},{id:"e-fw-dmz-sw",source:"ext-firewall",target:"dmz-switch",style:{stroke:"#eab308"},markerEnd:{type:ne.ArrowClosed,color:"#eab308"}},{id:"e-dmz-web",source:"dmz-switch",target:"web-server",style:{stroke:"#eab308"},markerEnd:{type:ne.ArrowClosed,color:"#eab308"},label:"HTTP/80",data:{protocol:"HTTP",port:80}},{id:"e-dmz-mail",source:"dmz-switch",target:"mail-server",style:{stroke:"#eab308"},markerEnd:{type:ne.ArrowClosed,color:"#eab308"},label:"SMTP/25",data:{protocol:"SMTP",port:25,encrypted:!0}},{id:"e-dmz-vpn",source:"dmz-switch",target:"vpn-gateway",style:{stroke:"#eab308"},markerEnd:{type:ne.ArrowClosed,color:"#eab308"},label:"OpenVPN/1194",data:{protocol:"OpenVPN",port:1194,encrypted:!0}},{id:"e-dmz-int-fw",source:"dmz-switch",target:"int-firewall",style:{stroke:"#3b82f6",strokeWidth:2},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"}},{id:"e-int-fw-core",source:"int-firewall",target:"core-switch",style:{stroke:"#3b82f6"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"}},{id:"e-core-lb",source:"core-switch",target:"load-balancer",style:{stroke:"#3b82f6"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"}},{id:"e-lb-app1",source:"load-balancer",target:"app-server-1",style:{stroke:"#3b82f6"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"},label:"HTTP/8080",data:{protocol:"HTTP",port:8080}},{id:"e-lb-app2",source:"load-balancer",target:"app-server-2",style:{stroke:"#3b82f6"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"},label:"HTTP/8080",data:{protocol:"HTTP",port:8080}},{id:"e-core-ap",source:"core-switch",target:"wireless-ap",style:{stroke:"#3b82f6"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"}},{id:"e-ap-ws",source:"wireless-ap",target:"workstation-1",style:{stroke:"#3b82f6",strokeDasharray:"5,5"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"},label:"WiFi"},{id:"e-ap-laptop",source:"wireless-ap",target:"laptop-1",style:{stroke:"#3b82f6",strokeDasharray:"5,5"},markerEnd:{type:ne.ArrowClosed,color:"#3b82f6"},label:"WiFi"},{id:"e-app1-dbfw",source:"app-server-1",target:"db-firewall",style:{stroke:"#a855f7"},markerEnd:{type:ne.ArrowClosed,color:"#a855f7"},label:"SQL/5432",data:{protocol:"PostgreSQL",port:5432,encrypted:!0,dataClassification:"confidential"}},{id:"e-app2-dbfw",source:"app-server-2",target:"db-firewall",style:{stroke:"#a855f7"},markerEnd:{type:ne.ArrowClosed,color:"#a855f7"},label:"SQL/5432",data:{protocol:"PostgreSQL",port:5432,encrypted:!0,dataClassification:"confidential"}},{id:"e-dbfw-primary",source:"db-firewall",target:"primary-db",style:{stroke:"#a855f7"},markerEnd:{type:ne.ArrowClosed,color:"#a855f7"}},{id:"e-dbfw-replica",source:"db-firewall",target:"replica-db",style:{stroke:"#a855f7"},markerEnd:{type:ne.ArrowClosed,color:"#a855f7"}},{id:"e-primary-replica",source:"primary-db",target:"replica-db",style:{stroke:"#a855f7",strokeDasharray:"3,3"},markerEnd:{type:ne.ArrowClosed,color:"#a855f7"},label:"Replication"},{id:"e-db-san",source:"primary-db",target:"storage-san",style:{stroke:"#a855f7"},markerEnd:{type:ne.ArrowClosed,color:"#a855f7"},label:"iSCSI",data:{protocol:"iSCSI",encrypted:!0,dataClassification:"restricted"}},{id:"e-core-mgmt",source:"core-switch",target:"mgmt-switch",style:{stroke:"#22c55e"},markerEnd:{type:ne.ArrowClosed,color:"#22c55e"}},{id:"e-mgmt-siem",source:"mgmt-switch",target:"siem",style:{stroke:"#22c55e"},markerEnd:{type:ne.ArrowClosed,color:"#22c55e"},label:"Syslog/514",data:{protocol:"Syslog",port:514}},{id:"e-mgmt-monitor",source:"mgmt-switch",target:"monitoring",style:{stroke:"#22c55e"},markerEnd:{type:ne.ArrowClosed,color:"#22c55e"},label:"SNMP/161",data:{protocol:"SNMP",port:161}}];return{nodes:e,edges:t}},cl=({isOpen:e,onClose:t,onAdd:n})=>{const[s,o]=S.useState("server"),[r,i]=S.useState(""),[a,u]=S.useState(""),[g,h]=S.useState(""),[c,d]=S.useState("internal");if(!e)return null;const x=()=>{if(!r){fe.error("Please enter a device name");return}n({label:r,deviceType:s,ipAddress:a||void 0,hostname:g||void 0,securityZone:c,complianceStatus:"not_assessed",position:{x:400,y:400}}),i(""),u(""),h(""),t()};return l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md",children:[l.jsxs("div",{className:"p-6 border-b border-gray-700 flex items-center justify-between",children:[l.jsx("h2",{className:"text-xl font-bold text-white",children:"Add Network Device"}),l.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:l.jsx(Un,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"p-6 space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Device Type"}),l.jsx("div",{className:"grid grid-cols-4 gap-2",children:Object.entries(co).map(([p,w])=>{const m=Wt[p];return l.jsxs("button",{onClick:()=>o(p),className:`p-2 rounded-lg border flex flex-col items-center gap-1 ${s===p?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[l.jsx(m,{className:"w-5 h-5 text-gray-300"}),l.jsx("span",{className:"text-xs text-gray-400 truncate w-full text-center",children:w})]},p)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Device Name"}),l.jsx("input",{type:"text",value:r,onChange:p=>i(p.target.value),placeholder:"e.g., Web Server 1",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"IP Address"}),l.jsx("input",{type:"text",value:a,onChange:p=>u(p.target.value),placeholder:"e.g., 10.0.0.1",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white font-mono"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Hostname"}),l.jsx("input",{type:"text",value:g,onChange:p=>h(p.target.value),placeholder:"e.g., server-01",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Security Zone"}),l.jsxs("select",{value:c,onChange:p=>d(p.target.value),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white",children:[l.jsx("option",{value:"external",children:"External (Untrusted)"}),l.jsx("option",{value:"dmz",children:"DMZ (Demilitarized Zone)"}),l.jsx("option",{value:"internal",children:"Internal (Trusted)"}),l.jsx("option",{value:"restricted",children:"Restricted (High Security)"}),l.jsx("option",{value:"management",children:"Management"})]})]})]}),l.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:[l.jsx(Ne,{variant:"secondary",onClick:t,children:"Cancel"}),l.jsxs(Ne,{onClick:x,children:[l.jsx(Zn,{className:"w-4 h-4 mr-2"}),"Add Device"]})]})]})})},ll=({device:e,onClose:t,onUpdate:n,onDelete:s})=>{if(!e)return null;const o=Wt[e.data.deviceType],r=gt[e.data.securityZone];return l.jsxs("div",{className:"absolute right-4 top-4 w-80 bg-gray-800 rounded-lg border border-gray-700 shadow-xl z-10",children:[l.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`p-2 rounded-lg ${r.bg} ${r.border} border`,children:l.jsx(o,{className:`w-5 h-5 ${r.text}`})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-white",children:e.data.label}),l.jsx("p",{className:"text-xs text-gray-400",children:co[e.data.deviceType]})]})]}),l.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:l.jsx(Un,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"p-4 space-y-3 text-sm",children:[e.data.ipAddress&&l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"IP Address"}),l.jsx("span",{className:"text-white font-mono",children:e.data.ipAddress})]}),e.data.hostname&&l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Hostname"}),l.jsx("span",{className:"text-white",children:e.data.hostname})]}),e.data.os&&l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"OS/Platform"}),l.jsx("span",{className:"text-white",children:e.data.os})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Security Zone"}),l.jsx("span",{className:r.text,children:e.data.securityZone.toUpperCase()})]}),l.jsxs("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[l.jsx("h4",{className:"text-gray-400 mb-2",children:"Compliance Status"}),l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.data.complianceStatus==="compliant"&&l.jsxs(l.Fragment,{children:[l.jsx(Pt,{className:"w-4 h-4 text-green-400"}),l.jsx("span",{className:"text-green-400",children:"Compliant"})]}),e.data.complianceStatus==="non_compliant"&&l.jsxs(l.Fragment,{children:[l.jsx($t,{className:"w-4 h-4 text-red-400"}),l.jsx("span",{className:"text-red-400",children:"Non-Compliant"})]}),e.data.complianceStatus==="partial"&&l.jsxs(l.Fragment,{children:[l.jsx(Ve,{className:"w-4 h-4 text-yellow-400"}),l.jsx("span",{className:"text-yellow-400",children:"Partially Compliant"})]}),e.data.complianceStatus==="not_assessed"&&l.jsxs(l.Fragment,{children:[l.jsx(Kn,{className:"w-4 h-4 text-gray-400"}),l.jsx("span",{className:"text-gray-400",children:"Not Assessed"})]})]}),e.data.controlsAssessed&&l.jsxs("div",{className:"text-xs text-gray-400",children:[e.data.controlsPassing||0,"/",e.data.controlsAssessed," controls passing",l.jsx("div",{className:"w-full h-2 bg-gray-700 rounded-full mt-1",children:l.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${(e.data.controlsPassing||0)/e.data.controlsAssessed*100}%`}})})]}),e.data.vulnerabilities&&e.data.vulnerabilities>0&&l.jsxs("div",{className:"mt-2 flex items-center gap-2 text-red-400 text-xs bg-red-500/10 p-2 rounded",children:[l.jsx(Ve,{className:"w-4 h-4"}),e.data.vulnerabilities," vulnerabilities detected"]})]})]}),l.jsxs("div",{className:"p-4 border-t border-gray-700 flex gap-2",children:[l.jsxs(Ne,{variant:"secondary",size:"sm",className:"flex-1",children:[l.jsx(_r,{className:"w-4 h-4 mr-1"}),"Edit"]}),l.jsx(Ne,{variant:"secondary",size:"sm",className:"text-red-400 hover:text-red-300",onClick:()=>s(e.id),children:l.jsx(zr,{className:"w-4 h-4"})})]})]})},vl=()=>{const[e,t,n]=Mc([]),[s,o,r]=Ac([]),[i,a]=S.useState(null),[u,g]=S.useState(!1),[h,c]=S.useState(!0),[d,x]=S.useState(!0),[p,w]=S.useState(!0),[m,y]=S.useState(null),[b,f]=S.useState([]),[v,M]=S.useState(""),[N,k]=S.useState("api"),[I,A]=S.useState(!1),R=S.useRef(null);S.useEffect(()=>{(async()=>{try{const T=await wt.get("/api/engagements");f(T.data.engagements||T.data||[])}catch(T){console.error("Failed to fetch engagements:",T)}})()},[]),S.useEffect(()=>{(async()=>{w(!0);try{if(N==="sample"){const{nodes:T,edges:L}=Bn();t(T),o(L),y({name:"Sample Network Topology",description:"Demo topology with sample devices",lastUpdated:new Date().toISOString(),totalDevices:T.length,totalConnections:L.length,dataSource:"sample"})}else{const T=v?`?engagement_id=${v}`:"",B=(await wt.get(`/api/network-topology${T}`)).data;B.nodes&&B.nodes.length>0?(t(B.nodes),o(B.edges||[]),y(B.metadata)):(fe.info("No network topology data found. You can add devices or use sample data."),t([]),o([]),y({name:"New Network Topology",description:"Add devices to build your network map",lastUpdated:new Date().toISOString(),totalDevices:0,totalConnections:0,dataSource:"empty"}))}}catch(T){console.error("Failed to fetch topology:",T),fe.error("Failed to load topology. Using sample data.");const{nodes:L,edges:B}=Bn();t(L),o(B),k("sample")}finally{w(!1)}})()},[v,N,t,o]);const C=S.useCallback($=>{const T={...$,markerEnd:{type:ne.ArrowClosed,color:"#06b6d4"},style:{stroke:"#06b6d4"}};o(L=>ps(T,L))},[o]),E=S.useCallback(($,T)=>{a(T)},[]),D=S.useCallback(()=>{a(null)},[]),z=$=>{const T={id:`device-${Date.now()}`,type:"networkDevice",position:$.position,data:{label:$.label||"New Device",deviceType:$.deviceType||"server",securityZone:$.securityZone||"internal",ipAddress:$.ipAddress,hostname:$.hostname,complianceStatus:"not_assessed"}};t(L=>[...L,T]),fe.success(`Added ${$.label}`)},_=$=>{t(T=>T.filter(L=>L.id!==$)),o(T=>T.filter(L=>L.source!==$&&L.target!==$)),a(null),fe.success("Device removed")},V=()=>{const $={nodes:e,edges:s},T=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),L=URL.createObjectURL(T),B=document.createElement("a");B.href=L,B.download=`cato-network-map-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(L),fe.success("Network map exported")},H=()=>{fe.info("Image export coming soon")},P=async()=>{A(!0);try{await wt.post("/api/network-topology",{name:(m==null?void 0:m.name)||"Network Topology",description:m==null?void 0:m.description,engagementId:v||null,nodes:e,edges:s}),fe.success("Topology saved successfully")}catch($){console.error("Failed to save topology:",$),fe.error("Failed to save topology")}finally{A(!1)}},j=S.useMemo(()=>{const $=e.filter(Y=>Y.type==="networkDevice"),T=$.length,L=$.filter(Y=>Y.data.complianceStatus==="compliant").length,B=$.filter(Y=>Y.data.complianceStatus==="non_compliant").length,W=$.filter(Y=>Y.data.complianceStatus==="partial").length,K=$.filter(Y=>Y.data.complianceStatus==="not_assessed").length,q=$.reduce((Y,F)=>Y+(F.data.vulnerabilities||0),0);return{total:T,compliant:L,nonCompliant:B,partial:W,notAssessed:K,totalVulns:q}},[e]);return p?l.jsx(tn,{children:l.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-80px)]",children:l.jsx(Hr,{})})}):l.jsxs(tn,{children:[l.jsxs("div",{className:"h-[calc(100vh-80px)] flex flex-col",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[l.jsx(Yn,{className:"w-8 h-8 text-cyan-400"}),"cATO Network Topology Map"]}),l.jsxs("p",{className:"text-gray-400 mt-1",children:[(m==null?void 0:m.name)||"Network Architecture & Data Flow Visualization",(m==null?void 0:m.dataSource)&&m.dataSource!=="sample"&&l.jsxs("span",{className:"text-xs text-green-400 ml-2",children:["(from ",m.dataSource,")"]}),(m==null?void 0:m.dataSource)==="sample"&&l.jsx("span",{className:"text-xs text-yellow-400 ml-2",children:"(sample data)"})]})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(Ne,{variant:"secondary",onClick:P,disabled:I,children:[l.jsx(yr,{className:"w-4 h-4 mr-2"}),I?"Saving...":"Save"]}),l.jsxs(Ne,{variant:"secondary",onClick:()=>g(!0),children:[l.jsx(Zn,{className:"w-4 h-4 mr-2"}),"Add Device"]}),l.jsxs("div",{className:"relative group",children:[l.jsxs(Ne,{variant:"secondary",children:[l.jsx(wr,{className:"w-4 h-4 mr-2"}),"Export"]}),l.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-20",children:[l.jsxs("button",{onClick:V,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2 rounded-t-lg",children:[l.jsx(br,{className:"w-4 h-4"}),"Export as JSON"]}),l.jsxs("button",{onClick:H,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2 rounded-b-lg",children:[l.jsx(vr,{className:"w-4 h-4"}),"Export as PNG"]})]})]})]})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-sm text-gray-400",children:"Engagement:"}),l.jsxs("select",{value:v,onChange:$=>M($.target.value),className:"px-3 py-1.5 bg-gray-800 border border-gray-600 rounded-lg text-white text-sm min-w-[180px]",disabled:N==="sample",children:[l.jsx("option",{value:"",children:"All Assets"}),b.map($=>l.jsx("option",{value:$.id,children:$.name},$.id))]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-sm text-gray-400",children:"Data:"}),l.jsxs("div",{className:"flex bg-gray-800 rounded-lg border border-gray-600 overflow-hidden",children:[l.jsx("button",{onClick:()=>k("api"),className:`px-3 py-1.5 text-sm ${N==="api"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Real Data"}),l.jsx("button",{onClick:()=>k("sample"),className:`px-3 py-1.5 text-sm ${N==="sample"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Sample"})]})]}),N==="sample"&&l.jsx("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded",children:"Using sample demo data"})]}),l.jsxs("div",{className:"flex gap-4 mb-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-800 rounded-lg",children:[l.jsx("span",{className:"text-gray-400",children:"Devices:"}),l.jsx("span",{className:"text-white font-semibold",children:j.total})]}),l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 rounded-lg",children:[l.jsx(Pt,{className:"w-4 h-4 text-green-400"}),l.jsxs("span",{className:"text-green-400",children:[j.compliant," Compliant"]})]}),l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-500/10 rounded-lg",children:[l.jsx(Ve,{className:"w-4 h-4 text-yellow-400"}),l.jsxs("span",{className:"text-yellow-400",children:[j.partial," Partial"]})]}),l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 rounded-lg",children:[l.jsx($t,{className:"w-4 h-4 text-red-400"}),l.jsxs("span",{className:"text-red-400",children:[j.nonCompliant," Non-Compliant"]})]}),j.totalVulns>0&&l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/20 rounded-lg",children:[l.jsx(Xn,{className:"w-4 h-4 text-red-400"}),l.jsxs("span",{className:"text-red-400",children:[j.totalVulns," Vulnerabilities"]})]}),l.jsx("div",{className:"flex-1"}),l.jsxs("button",{onClick:()=>c(!h),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg ${h?"bg-cyan-500/20 text-cyan-400":"bg-gray-800 text-gray-400"}`,children:[h?l.jsx(Nr,{className:"w-4 h-4"}):l.jsx(Sr,{className:"w-4 h-4"}),"Labels"]})]}),l.jsxs("div",{className:"flex gap-4 mb-4 text-xs",children:[l.jsx("span",{className:"text-gray-500",children:"Security Zones:"}),Object.entries(gt).map(([$,T])=>l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:`w-3 h-3 rounded border ${T.border} ${T.bg}`}),l.jsx("span",{className:T.text,children:$.toUpperCase()})]},$))]}),l.jsxs("div",{ref:R,className:"flex-1 bg-gray-900 rounded-lg border border-gray-700 relative",children:[l.jsxs(kc,{nodes:e,edges:s,onNodesChange:n,onEdgesChange:r,onConnect:C,onNodeClick:E,onPaneClick:D,nodeTypes:al,fitView:!0,snapToGrid:!0,snapGrid:[20,20],defaultEdgeOptions:{type:"smoothstep",markerEnd:{type:ne.ArrowClosed}},children:[l.jsx(Tc,{variant:ge.Dots,gap:20,size:1,color:"#374151"}),l.jsx(Bc,{className:"!bg-gray-800 !border-gray-700 !rounded-lg"}),l.jsx(el,{className:"!bg-gray-800 !border-gray-700 !rounded-lg",nodeColor:$=>{const T=$.data;return T.complianceStatus==="compliant"?"#22c55e":T.complianceStatus==="non_compliant"?"#ef4444":T.complianceStatus==="partial"?"#eab308":"#6b7280"},maskColor:"rgba(0, 0, 0, 0.6)"}),l.jsx(Ke,{position:"top-left",className:"!m-2",children:l.jsxs("div",{className:"bg-gray-800/90 rounded-lg p-3 border border-gray-700 text-xs",children:[l.jsx("div",{className:"font-semibold text-gray-300 mb-2",children:"Data Flow"}),l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-8 h-0.5 bg-red-500"}),l.jsx("span",{className:"text-gray-400",children:"External"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-8 h-0.5 bg-yellow-500"}),l.jsx("span",{className:"text-gray-400",children:"DMZ"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),l.jsx("span",{className:"text-gray-400",children:"Internal"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-8 h-0.5 bg-purple-500"}),l.jsx("span",{className:"text-gray-400",children:"Restricted"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-8 h-0.5 bg-green-500"}),l.jsx("span",{className:"text-gray-400",children:"Management"})]}),l.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-gray-600",children:[l.jsx("div",{className:"w-8 h-0.5 border-b border-dashed border-gray-400"}),l.jsx("span",{className:"text-gray-400",children:"Wireless"})]})]})]})})]}),l.jsx(ll,{device:i,onClose:()=>a(null),onUpdate:()=>{},onDelete:_})]})]}),l.jsx(cl,{isOpen:u,onClose:()=>g(!1),onAdd:z})]})};export{vl as default};
