var Ys=Object.defineProperty;var Js=(t,s,a)=>s in t?Ys(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var Ce=(t,s,a)=>Js(t,typeof s!="symbol"?s+"":s,a);import{j as e,c as Qs,u as Xs}from"./vendor-state-BXNPjUwt.js";import{r as l,R as ea,e as ta,g as sa,u as aa}from"./vendor-react-5KxtEOLM.js";import{T as rt,X as ve,l as Ne,m as Ie,B as D,n as ra,o as Ot,a as Me,p as pe,q as Ee,r as Bt,F as oe,E as gs,G as Pe,S as K,s as Kt,Z as wt,d as St,f as la,t as ia,u as na,v as $t,w as ca,R as oa,W as Ft,x as ke,y as Tt,z as qt,D as da,H as bs,I as At,L as fs,J as xa,N as Zt,O as G,V as fe,Y as Ut,_ as it,i as we,g as se,$ as js,a0 as ma,K as Ue,a1 as Wt,a2 as ys,a3 as ha,a4 as ua,a5 as vs,a6 as We,a7 as pa,a8 as ga,a9 as et,aa as le,ab as Yt,ac as Ns,ad as ba,ae as fa,af as Gt,ag as ja,ah as ya,ai as ls,C as va,aj as Na,ak as wa,k as ka,al as nt,am as Sa,an as _a,ao as kt,ap as Dt,aq as Ca,ar as $a,as as Fa,at as Be,au as _t,av as Ta,aw as Aa,ax as Da,ay as Ea,az as is,aA as ns,aB as Ra,aC as cs,aD as os,aE as La,aF as Pa}from"./vendor-ui-PizTOSgB.js";import{L as Ma}from"./Layout-CeExTnzB.js";import{s as me,t as tt,a as za,b as je,v as Ha,c as ds,e as Oa,d as xs,I as re,B as Q,r as st,f as bt,g as Je,h as Ct,i as Va,j as Oe,k as Ia,l as ms}from"./index-DgePDh_X.js";import{C as Ve}from"./Checkbox-DXJkiglL.js";import{C as z}from"./Card-D4UbjXYP.js";import{B as ie}from"./Badge-B0_IBqp5.js";import{f as Te,a as Ba,b as Et}from"./vendor-utils-DfRopTPV.js";import{L as ye}from"./LoadingSpinner-p-Ub3czh.js";import{t as ws}from"./common-PL4GWpC9.js";import{C as Ua}from"./ConfirmationDialog-CE4JJxRj.js";import{F as Wa,r as Ga}from"./vendor-viz-B27Gou7z.js";import{R as ee,B as Rt,X as he,Y as ce,T as te,h as Lt,C as ct,j as Jt,k as Qt,l as Ka,n as qa,p as Za,q as Ya,t as Ja,L as at,u as be,v as lt,w as Ae,A as ks,x as De}from"./vendor-charts-B7kFV7Tb.js";import"./Header-Dw99lsG2.js";import"./vendor-markdown-RN55YrVy.js";const Qa=({selectedTagIds:t,onChange:s,existingTags:a,onTagsChange:r})=>{const[i,n]=l.useState(!1),[d,m]=l.useState(""),[c,f]=l.useState([]),[N,j]=l.useState(!1),[o,g]=l.useState(""),[b,w]=l.useState("#06b6d4"),[$,F]=l.useState(!1),y=l.useRef(null),p=["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444","#ec4899","#3b82f6","#84cc16"];l.useEffect(()=>{h()},[]),l.useEffect(()=>{const u=v=>{y.current&&!y.current.contains(v.target)&&(n(!1),j(!1))};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const h=async()=>{try{const u=await me.getSuggestions();f(u.data)}catch(u){console.error("Failed to load tag suggestions:",u)}},S=a.filter(u=>t.includes(u.id)),E=a.filter(u=>!t.includes(u.id)&&u.name.toLowerCase().includes(d.toLowerCase())),P=c.reduce((u,v)=>(u[v.category]||(u[v.category]=[]),!a.some(V=>V.name.toLowerCase()===v.name.toLowerCase())&&v.name.toLowerCase().includes(d.toLowerCase())&&u[v.category].push(v),u),{}),O=u=>{t.includes(u)?s(t.filter(v=>v!==u)):s([...t,u])},C=async u=>{F(!0);try{const A=(await me.create({name:u.name,color:u.color})).data;r&&r([...a,A]),s([...t,A.id]),m("")}catch(v){console.error("Failed to create tag:",v)}finally{F(!1)}},_=async()=>{if(o.trim()){F(!0);try{const v=(await me.create({name:o.trim(),color:b})).data;r&&r([...a,v]),s([...t,v.id]),g(""),j(!1)}catch(u){console.error("Failed to create tag:",u)}finally{F(!1)}}};return e.jsxs("div",{className:"relative",ref:y,children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-4 w-4 text-primary"}),"Tags (Optional)"]})}),e.jsxs("div",{className:"min-h-[42px] px-3 py-2 bg-dark-surface border border-dark-border rounded-lg cursor-pointer flex flex-wrap gap-2 items-center",onClick:()=>n(!i),children:[S.length>0?e.jsx(e.Fragment,{children:S.map(u=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-sm",style:{backgroundColor:u.color+"20",color:u.color},children:[u.name,e.jsx("button",{type:"button",onClick:v=>{v.stopPropagation(),O(u.id)},className:"hover:opacity-70",children:e.jsx(ve,{className:"h-3 w-3"})})]},u.id))}):e.jsx("span",{className:"text-slate-500",children:"Click to add tags..."}),e.jsx(Ne,{className:`h-4 w-4 text-slate-400 ml-auto transition-transform ${i?"rotate-180":""}`})]}),i&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full bg-dark-bg border border-dark-border rounded-lg shadow-xl max-h-80 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-dark-border",children:e.jsx("input",{type:"text",placeholder:"Search or create tags...",value:d,onChange:u=>m(u.target.value),className:"w-full px-3 py-1.5 bg-dark-surface border border-dark-border rounded text-sm text-white focus:outline-none focus:border-primary",autoFocus:!0})}),e.jsxs("div",{className:"p-2 space-y-3",children:[E.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Your Tags"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:E.map(u=>e.jsxs("button",{type:"button",onClick:()=>O(u.id),className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm transition-opacity hover:opacity-80",style:{backgroundColor:u.color+"20",color:u.color},children:[e.jsx(Ie,{className:"h-3 w-3"}),u.name]},u.id))})]}),Object.entries(P).map(([u,v])=>v.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:u}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:v.map(A=>e.jsxs("button",{type:"button",onClick:()=>C(A),disabled:$,className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm transition-opacity hover:opacity-80 disabled:opacity-50",style:{backgroundColor:A.color+"15",color:A.color,border:`1px dashed ${A.color}40`},children:[e.jsx(Ie,{className:"h-3 w-3"}),A.name]},A.name))})]},u)),N?e.jsxs("div",{className:"space-y-2 p-2 bg-dark-surface rounded-lg",children:[e.jsx("input",{type:"text",placeholder:"Tag name",value:o,onChange:u=>g(u.target.value),className:"w-full px-3 py-1.5 bg-dark-bg border border-dark-border rounded text-sm text-white focus:outline-none focus:border-primary",autoFocus:!0}),e.jsx("div",{className:"flex gap-1",children:p.map(u=>e.jsx("button",{type:"button",onClick:()=>w(u),className:`w-6 h-6 rounded-full border-2 ${b===u?"border-white":"border-transparent"}`,style:{backgroundColor:u}},u))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:_,disabled:!o.trim()||$,className:"flex-1 px-3 py-1.5 bg-primary text-white rounded text-sm hover:bg-primary/80 disabled:opacity-50",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),g("")},className:"px-3 py-1.5 bg-dark-bg border border-dark-border text-slate-400 rounded text-sm hover:text-white",children:"Cancel"})]})]}):e.jsxs("button",{type:"button",onClick:()=>{j(!0),d&&g(d)},className:"w-full px-3 py-2 text-sm text-slate-400 border border-dashed border-dark-border rounded hover:border-primary hover:text-primary transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Create new tag",d?`: "${d}"`:""]})]})]})]})},ft={quick:{label:"Quick",icon:wt,color:"text-yellow-400",description:"Fast, lightweight scans"},standard:{label:"Standard",icon:Kt,color:"text-blue-400",description:"Balanced scanning approach"},comprehensive:{label:"Comprehensive",icon:K,color:"text-green-400",description:"Thorough security assessment"},web:{label:"Web",icon:Pe,color:"text-purple-400",description:"Web application focused"},stealth:{label:"Stealth",icon:gs,color:"text-orange-400",description:"Low-profile reconnaissance"},custom:{label:"Custom",icon:oe,color:"text-slate-400",description:"User-defined templates"}},Xa=({onSelect:t,selectedTemplateId:s,className:a=""})=>{const[r,i]=l.useState([]),[n,d]=l.useState([]),[m,c]=l.useState(null),[f,N]=l.useState(!0),[j,o]=l.useState(!1),[g,b]=l.useState(null),[w,$]=l.useState("all");l.useEffect(()=>{F()},[]);const F=async()=>{try{N(!0);const[u,v,A]=await Promise.all([tt.getAll(),tt.getSystem(),tt.getDefault().catch(()=>({data:null}))]);i(u.data),d(v.data),c(A.data)}catch(u){console.error("Failed to load templates:",u),D.error("Failed to load scan templates")}finally{N(!1)}},y=[...n,...r],p=w==="all"?y:y.filter(u=>u.category===w),h=y.find(u=>u.id===s),S=u=>{t(u),o(!1),b(null),D.success(`Applied "${u.name}" template`)},E=()=>{t(null),o(!1),b(null)},P=u=>{var v;return((v=ft[u])==null?void 0:v.icon)||oe},O=u=>{var v;return((v=ft[u])==null?void 0:v.color)||"text-slate-400"},C=u=>{if(!u)return null;if(u<60)return`~${u}m`;const v=Math.floor(u/60),A=u%60;return A>0?`~${v}h ${A}m`:`~${v}h`},_=u=>{const v=[];return u.enable_os_detection&&v.push("OS Detection"),u.enable_service_detection&&v.push("Service Detection"),u.enable_vuln_scan&&v.push("Vulnerability Scan"),u.enable_enumeration&&v.push(`Enumeration (${u.enum_depth||"light"})`),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"Ports:"})," ",u.port_range[0],"-",u.port_range[1]]}),e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"Threads:"})," ",u.threads]}),u.scan_type&&e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"Type:"})," ",u.scan_type.replace("_"," ")]}),u.udp_port_range&&e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"UDP:"})," ",u.udp_port_range[0],"-",u.udp_port_range[1]]})]}),v.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-1",children:v.map(A=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-dark-surface rounded-full text-slate-400 border border-dark-border",children:A},A))})]})};return f?e.jsx("div",{className:`bg-dark-card border border-dark-border rounded-lg p-4 ${a}`,children:e.jsxs("div",{className:"animate-pulse flex items-center space-x-3",children:[e.jsx("div",{className:"h-8 w-8 bg-dark-surface rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-dark-surface rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-3 bg-dark-surface rounded w-1/2"})]})]})}):e.jsxs("div",{className:`space-y-3 ${a}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ra,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Scan Template"})]}),m&&!s&&e.jsxs("button",{type:"button",onClick:()=>S(m),className:"text-xs text-yellow-400 hover:text-yellow-300 flex items-center gap-1",children:[e.jsx(Ot,{className:"h-3 w-3"}),"Use Default"]})]}),e.jsx("button",{type:"button",onClick:()=>o(!j),className:`w-full p-3 rounded-lg border transition-all text-left ${j?"bg-primary/10 border-primary":"bg-dark-card border-dark-border hover:border-slate-500"}`,children:h?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[ea.createElement(P(h.category),{className:`h-5 w-5 ${O(h.category)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:h.name}),h.is_system&&e.jsx(Me,{className:"h-3 w-3 text-slate-500"}),h.is_default&&e.jsx(Ot,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})]}),h.description&&e.jsx("p",{className:"text-xs text-slate-500 mt-0.5 line-clamp-1",children:h.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.estimated_duration_mins&&e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),C(h.estimated_duration_mins)]}),j?e.jsx(Ee,{className:"h-4 w-4 text-slate-400"}):e.jsx(Ne,{className:"h-4 w-4 text-slate-400"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Bt,{className:"h-5 w-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Start from scratch"}),e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Or select a template to pre-configure scan settings"})]})]}),j?e.jsx(Ee,{className:"h-4 w-4 text-slate-400"}):e.jsx(Ne,{className:"h-4 w-4 text-slate-400"})]})}),j&&e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-1 p-2 border-b border-dark-border bg-dark-surface overflow-x-auto",children:[e.jsx("button",{type:"button",onClick:()=>$("all"),className:`px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors ${w==="all"?"bg-primary text-white":"text-slate-400 hover:text-white hover:bg-dark-border"}`,children:"All"}),Object.keys(ft).map(u=>{const v=ft[u],A=y.filter(k=>k.category===u).length;if(A===0)return null;const V=v.icon;return e.jsxs("button",{type:"button",onClick:()=>$(u),className:`px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors flex items-center gap-1.5 ${w===u?"bg-primary text-white":"text-slate-400 hover:text-white hover:bg-dark-border"}`,children:[e.jsx(V,{className:"h-3 w-3"}),v.label,e.jsxs("span",{className:"text-slate-500",children:["(",A,")"]})]},u)})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[e.jsxs("button",{type:"button",onClick:E,className:`w-full p-3 border-b border-dark-border text-left transition-colors hover:bg-dark-surface flex items-center gap-3 ${s?"":"bg-dark-surface"}`,children:[e.jsx("div",{className:"p-2 rounded-lg bg-dark-surface border border-dark-border",children:e.jsx(Bt,{className:"h-5 w-5 text-slate-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:"Start from scratch"}),!s&&e.jsx(St,{className:"h-4 w-4 text-green-400"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Configure all scan settings manually"})]})]}),p.map(u=>{const v=P(u.category),A=s===u.id,V=(g==null?void 0:g.id)===u.id;return e.jsxs("div",{className:`border-b border-dark-border transition-colors ${A?"bg-primary/10":"hover:bg-dark-surface"}`,children:[e.jsxs("button",{type:"button",onClick:()=>S(u),onMouseEnter:()=>b(u),onMouseLeave:()=>b(null),className:"w-full p-3 text-left flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg border ${A?"bg-primary/20 border-primary":"bg-dark-surface border-dark-border"}`,children:e.jsx(v,{className:`h-5 w-5 ${O(u.category)}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:u.name}),u.is_system&&e.jsx("span",{title:"System Template",children:e.jsx(Me,{className:"h-3 w-3 text-slate-500"})}),u.is_default&&e.jsx("span",{title:"Default Template",children:e.jsx(Ot,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})}),A&&e.jsx(St,{className:"h-4 w-4 text-green-400"})]}),u.description&&e.jsx("p",{className:"text-xs text-slate-500 mt-0.5 line-clamp-1",children:u.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5 text-xs text-slate-500",children:[u.estimated_duration_mins&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),C(u.estimated_duration_mins)]}),u.use_count>0&&e.jsxs("span",{children:["Used ",u.use_count," time",u.use_count!==1?"s":""]})]})]})]}),V&&e.jsx("div",{className:"px-3 pb-3 animate-fadeIn",children:e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg border border-dark-border",children:[e.jsx("div",{className:"text-xs font-medium text-slate-400 mb-2",children:"Configuration Preview"}),_(u.config)]})})]},u.id)}),p.length===0&&e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx(oe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No templates in this category"})]})]}),e.jsxs("div",{className:"p-2 border-t border-dark-border bg-dark-surface flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:[y.length," template",y.length!==1?"s":""," available"]}),e.jsxs("button",{type:"button",onClick:()=>o(!1),className:"text-xs text-slate-400 hover:text-white flex items-center gap-1",children:[e.jsx(ve,{className:"h-3 w-3"}),"Close"]})]})]})]})},ue=Qs(t=>({scans:[],activeScan:null,results:new Map,liveUpdates:new Map,setScans:s=>t({scans:s}),addScan:s=>t(a=>({scans:[s,...a.scans]})),setActiveScan:s=>t({activeScan:s}),updateScanStatus:(s,a)=>t(r=>{var n;const i=a;return{scans:r.scans.map(d=>d.id===s?{...d,status:i}:d),activeScan:((n=r.activeScan)==null?void 0:n.id)===s?{...r.activeScan,status:i}:r.activeScan}}),setResults:(s,a)=>t(r=>{const i=new Map(r.results);return i.set(s,a),{results:i}}),addHostToResults:(s,a)=>t(r=>{const i=new Map(r.results),n=i.get(s)||[],d=n.findIndex(m=>m.target.ip===a.target.ip);return d>=0?n[d]=a:n.push(a),i.set(s,n),{results:i}}),updateHostInResults:(s,a,r)=>t(i=>{const n=new Map(i.results),m=(n.get(s)||[]).map(c=>c.target.ip===a?{...c,...r}:c);return n.set(s,m),{results:n}}),addLiveUpdate:(s,a)=>t(r=>{const i=new Map(r.liveUpdates),n=i.get(s)||[];return n.push(a),i.set(s,n),{liveUpdates:i}}),clearLiveUpdates:s=>t(a=>{const r=new Map(a.liveUpdates);return r.delete(s),{liveUpdates:r}})})),er=[{id:"tcp_connect",label:"TCP Connect",description:"Standard TCP scan (most reliable)"},{id:"udp",label:"UDP Only",description:"UDP port scanning (requires root)"},{id:"comprehensive",label:"Comprehensive",description:"TCP + UDP scanning (thorough)"},{id:"syn",label:"SYN Stealth",description:"Half-open TCP scan (requires root)"}],tr=[{id:"http",label:"HTTP",category:"Web"},{id:"https",label:"HTTPS",category:"Web"},{id:"dns",label:"DNS",category:"Network"},{id:"smb",label:"SMB",category:"Network"},{id:"ftp",label:"FTP",category:"Network"},{id:"ssh",label:"SSH",category:"Network"},{id:"smtp",label:"SMTP",category:"Network"},{id:"ldap",label:"LDAP",category:"Network"},{id:"rdp",label:"RDP",category:"Remote"},{id:"vnc",label:"VNC",category:"Remote"},{id:"telnet",label:"Telnet",category:"Remote"},{id:"snmp",label:"SNMP",category:"Network"},{id:"mysql",label:"MySQL",category:"Database"},{id:"postgresql",label:"PostgreSQL",category:"Database"},{id:"mongodb",label:"MongoDB",category:"Database"},{id:"redis",label:"Redis",category:"Database"},{id:"elasticsearch",label:"Elasticsearch",category:"Database"}],sr=()=>{const[t]=ta(),[s,a]=l.useState(""),[r,i]=l.useState(""),[n,d]=l.useState(1),[m,c]=l.useState(1e3),[f,N]=l.useState(100),[j,o]=l.useState("tcp_connect"),[g,b]=l.useState(53),[w,$]=l.useState(500),[F,y]=l.useState(2),[p,h]=l.useState(!0),[S,E]=l.useState(!0),[P,O]=l.useState(!1),[C,_]=l.useState(!1),[u,v]=l.useState("light"),[A,V]=l.useState([]),[k,R]=l.useState(!1),[U,ge]=l.useState([]),[L,B]=l.useState(!1),[Z,Y]=l.useState(""),[Se,Re]=l.useState(""),[de,q]=l.useState([]),[J,ae]=l.useState(null),[T,H]=l.useState(null),[W,I]=l.useState([]),[ne,Ge]=l.useState(""),[ot,_s]=l.useState([]),[Le,Pt]=l.useState(""),[Mt,zt]=l.useState([]),[Xt,dt]=l.useState(""),[Cs,es]=l.useState([]),[Ht,ts]=l.useState([]),[Ke,$s]=l.useState([]),[qe,ss]=l.useState([]),[as,Fs]=l.useState(!1),[ze,Ts]=l.useState([]),[He,As]=l.useState([]),[Fe,xt]=l.useState("local"),[mt,ht]=l.useState(""),[ut,pt]=l.useState(""),{addScan:Ds}=ue(),Ze=j==="udp"||j==="comprehensive";l.useEffect(()=>{Es(),Rs(),Ls(),Ps(),Ms(),zs(),Hs()},[]),l.useEffect(()=>{const x=t.get("customer");x&&ot.length>0&&ot.find(X=>X.id===x)&&Pt(x)},[t,ot]),l.useEffect(()=>{Le?Os(Le):(zt([]),dt(""))},[Le]);const Es=async()=>{try{const x=await za.getAll();ge(x.data)}catch(x){console.error("Failed to load target groups:",x)}},Rs=async()=>{try{const x=await je.getPresets();q(x.data)}catch(x){console.error("Failed to load scan presets:",x)}},Ls=async()=>{try{const x=await Ha.getConfigs();I(x.data);const M=x.data.find(X=>X.is_default);M&&Ge(M.id)}catch(x){console.error("Failed to load VPN configs:",x)}},Ps=async()=>{try{const x=await ds.customers.getAll("active");_s(x.data)}catch(x){console.error("Failed to load customers:",x)}},Ms=async()=>{try{const x=await me.getAll();es(x.data)}catch(x){console.error("Failed to load tags:",x)}},zs=async()=>{try{const x=await Oa.getAll();$s(x.data)}catch(x){console.error("Failed to load exclusions:",x)}},Hs=async()=>{try{const[x,M]=await Promise.all([xs.list(),xs.groups.list()]),X=x.data.filter(_e=>_e.status==="online");Ts(X),As(M.data)}catch(x){console.error("Failed to load agents:",x)}},Os=async x=>{try{const X=(await ds.engagements.getByCustomer(x)).data.filter(_e=>_e.status==="planning"||_e.status==="in_progress");zt(X)}catch(M){console.error("Failed to load engagements:",M),zt([])}},Vs=x=>{const M=JSON.parse(x.targets||"[]");i(M.join(", "))},Is=x=>{ae(x.id),x.id==="webapp"?(d(80),c(8443)):(d(x.port_range[0]),c(x.port_range[1])),N(x.threads),o(x.scan_type),h(x.enable_os_detection),E(x.enable_service_detection),O(x.enable_vuln_scan),_(x.enable_enumeration),x.enum_depth&&v(x.enum_depth),x.udp_port_range&&(b(x.udp_port_range[0]),$(x.udp_port_range[1])),x.udp_retries&&y(x.udp_retries),x.enum_services?V(x.enum_services):V([]),D.success(`Applied "${x.name}" preset`)},Bs=x=>{if(!x){H(null),ae(null),d(1),c(1e3),N(100),o("tcp_connect"),b(53),$(500),y(2),h(!0),E(!0),O(!1),_(!1),v("light"),V([]);return}H(x.id),ae(null);const M=x.config;d(M.port_range[0]),c(M.port_range[1]),N(M.threads),M.scan_type&&o(M.scan_type),h(M.enable_os_detection),E(M.enable_service_detection),O(M.enable_vuln_scan),_(M.enable_enumeration),M.enum_depth&&v(M.enum_depth),M.enum_services&&M.enum_services.length>0?V(M.enum_services):V([]),M.udp_port_range&&(b(M.udp_port_range[0]),$(M.udp_port_range[1])),M.udp_retries!==void 0&&M.udp_retries!==null&&y(M.udp_retries),tt.createScan(x.id,"",[]).catch(()=>{})},Us=x=>{switch(x){case"Zap":return wt;case"Radar":return da;case"Globe":return Pe;case"EyeOff":return gs;default:return wt}},Ws=x=>{const M=x.trim(),X=/^(\d{1,3}\.){3}\d{1,3}$/,_e=/^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/,Ye=/^(\d{1,3}\.){3}\d{1,3}-(\d{1,3}\.){3}\d{1,3}$/,gt=/^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$/;return X.test(M)||_e.test(M)||Ye.test(M)||gt.test(M)},rs=x=>x.split(/[,\n]/).map(M=>M.trim()).filter(M=>M.length>0),Gs=x=>{const M=rs(x);return M.length===0?!1:M.every(Ws)},Ks=async x=>{var X,_e;if(x.preventDefault(),!s.trim()){D.error("Please enter a scan name");return}if(!r.trim()){D.error("Please enter a target");return}if(!Gs(r)){D.error("Invalid target format. Use IP (192.168.1.1), CIDR (192.168.1.0/24), range, or hostname. Separate multiple targets with commas.");return}if(n<1||m>65535||n>m){D.error("Invalid port range");return}const M=rs(r);R(!0);try{const Ye=await je.create({name:s.trim(),targets:M,port_range:[n,m],threads:f,scan_type:j,udp_port_range:Ze?[g,w]:void 0,udp_retries:Ze?F:void 0,enable_os_detection:p,enable_service_detection:S,enable_vuln_scan:P,enable_enumeration:C,enum_depth:C?u:void 0,enum_services:C&&A.length>0?A:void 0,vpn_config_id:ne||void 0,customer_id:Le||void 0,engagement_id:Xt||void 0,tag_ids:Ht.length>0?Ht:void 0,exclusion_ids:qe.length>0?qe:void 0,skip_global_exclusions:as||void 0,execution_mode:Fe,agent_id:Fe==="agent"&&mt?mt:void 0,agent_group_id:Fe==="agent_group"&&ut?ut:void 0});if(Ds(Ye.data),D.success("Scan started successfully!"),L&&Z.trim())try{await tt.create({name:Z.trim(),description:Se.trim()||void 0,config:{port_range:[n,m],threads:f,scan_type:j,udp_port_range:Ze?[g,w]:void 0,udp_retries:Ze?F:void 0,enable_os_detection:p,enable_service_detection:S,enable_vuln_scan:P,enable_enumeration:C,enum_depth:C?u:void 0,enum_services:C&&A.length>0?A:void 0}}),D.success("Template saved!")}catch(gt){console.error("Failed to save template:",gt),D.warning("Scan started but template save failed")}a(""),i(""),d(1),c(1e3),N(100),o("tcp_connect"),b(53),$(500),y(2),_(!1),v("light"),V([]),B(!1),Y(""),Re(""),Pt(""),dt(""),ts([]),H(null),ae(null),xt("local"),ht(""),pt("")}catch(Ye){const Zs=((_e=(X=Ye.response)==null?void 0:X.data)==null?void 0:_e.error)||"Failed to start scan";D.error(Zs)}finally{R(!1)}},qs=x=>{V(M=>M.includes(x)?M.filter(X=>X!==x):[...M,x])};return e.jsxs(z,{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Create New Scan"}),e.jsxs("form",{onSubmit:Ks,className:"space-y-4",children:[e.jsx("div",{className:"pb-4 border-b border-dark-border",children:e.jsx(Xa,{onSelect:Bs,selectedTemplateId:T})}),de.length>0&&!T&&e.jsxs("div",{className:"space-y-3 pb-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(wt,{className:"h-5 w-5 text-yellow-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Quick Presets"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:de.map(x=>{const M=Us(x.icon);return e.jsxs("button",{type:"button",onClick:()=>Is(x),className:`px-3 py-3 text-sm rounded-lg border transition-all text-left ${J===x.id?"bg-gradient-to-br from-yellow-600/20 to-orange-600/20 border-yellow-500 text-white shadow-lg":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500 hover:bg-dark-surface/50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(M,{className:`h-4 w-4 ${J===x.id?"text-yellow-400":"text-slate-500"}`}),e.jsx("div",{className:"font-medium",children:x.name})]}),e.jsx("div",{className:"text-xs opacity-70 line-clamp-2",children:x.description})]},x.id)})}),e.jsx("p",{className:"text-xs text-slate-500 italic",children:"Select a preset to auto-configure scan settings, or customize manually below."})]}),e.jsx(re,{label:"Scan Name",type:"text",placeholder:"Production Network Scan",value:s,onChange:x=>a(x.target.value),required:!0}),e.jsx(Qa,{selectedTagIds:Ht,onChange:ts,existingTags:Cs,onTagsChange:es}),e.jsxs("div",{className:"space-y-3 pb-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(la,{className:"h-5 w-5 text-indigo-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Customer Association (Optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Customer"}),e.jsxs("select",{value:Le,onChange:x=>{Pt(x.target.value),dt("")},className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"No customer"}),ot.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Engagement"}),e.jsxs("select",{value:Xt,onChange:x=>dt(x.target.value),disabled:!Le||Mt.length===0,className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:Le?Mt.length===0?"No active engagements":"No engagement":"Select customer first"}),Mt.map(x=>e.jsxs("option",{value:x.id,children:[x.name," (",x.engagement_type.replace("_"," "),")"]},x.id))]})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Link this scan to a customer and engagement for tracking and reporting."})]}),Ke.length>0&&e.jsxs("div",{className:"space-y-3 pb-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ia,{className:"h-5 w-5 text-orange-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Exclusions (Optional)"})]}),Ke.filter(x=>x.is_global).length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-green-400"}),e.jsxs("span",{className:"text-sm text-green-400",children:[Ke.filter(x=>x.is_global).length," global exclusion(s) will be applied"]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:as,onChange:x=>Fs(x.target.checked),className:"w-4 h-4 rounded bg-dark-bg border-dark-border text-orange-500 focus:ring-orange-500 focus:ring-offset-dark-bg"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Skip global exclusions"})]})]}),Ke.filter(x=>!x.is_global).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Additional exclusions for this scan"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Ke.filter(x=>!x.is_global).map(x=>e.jsxs("label",{className:"flex items-center gap-3 p-2 bg-dark-surface rounded-lg cursor-pointer hover:bg-dark-border/30 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:qe.includes(x.id),onChange:M=>{M.target.checked?ss([...qe,x.id]):ss(qe.filter(X=>X!==x.id))},className:"w-4 h-4 rounded bg-dark-bg border-dark-border text-primary focus:ring-primary focus:ring-offset-dark-bg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:x.name}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-orange-500/20 text-orange-400",children:x.exclusion_type.replace("_"," ")})]}),e.jsx("code",{className:"text-xs text-slate-400 font-mono",children:x.value})]})]},x.id))})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Exclusions prevent scanning specific hosts or ports. Configure them in Settings."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Target"}),U.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"h-3 w-3 text-slate-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Use group:"}),U.slice(0,3).map(x=>e.jsx("button",{type:"button",onClick:()=>Vs(x),className:"px-2 py-0.5 text-xs rounded border border-dark-border text-slate-400 hover:text-white hover:border-primary transition-colors",style:{borderLeftColor:x.color,borderLeftWidth:3},children:x.name},x.id)),U.length>3&&e.jsxs("span",{className:"text-xs text-slate-500",children:["+",U.length-3]})]})]}),e.jsx(re,{type:"text",placeholder:"192.168.1.0/24, 10.0.0.1-10.0.0.100, or hostname",value:r,onChange:x=>i(x.target.value),icon:e.jsx($t,{className:"h-5 w-5"}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(re,{label:"Start Port",type:"number",min:1,max:65535,value:n,onChange:x=>{d(Number(x.target.value)),ae(null),H(null)}}),e.jsx(re,{label:"End Port",type:"number",min:1,max:65535,value:m,onChange:x=>{c(Number(x.target.value)),ae(null),H(null)}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Threads: ",f]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ca,{className:"h-5 w-5 text-slate-400"}),e.jsx("input",{type:"range",min:1,max:100,value:f,onChange:x=>{N(Number(x.target.value)),ae(null),H(null)},className:"w-full h-2 bg-dark-surface rounded-lg appearance-none cursor-pointer slider"})]})]}),e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oa,{className:"h-5 w-5 text-primary"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Scan Type"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:er.map(x=>e.jsxs("button",{type:"button",onClick:()=>{o(x.id),ae(null),H(null)},className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${j===x.id?"bg-primary/20 border-primary text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium",children:x.label}),e.jsx("div",{className:"text-xs opacity-70",children:x.description})]},x.id))}),Ze&&e.jsxs("div",{className:"ml-4 space-y-3 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ft,{className:"h-4 w-4 text-cyan-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-400",children:"UDP Options"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(re,{label:"UDP Start Port",type:"number",min:1,max:65535,value:g,onChange:x=>b(Number(x.target.value))}),e.jsx(re,{label:"UDP End Port",type:"number",min:1,max:65535,value:w,onChange:x=>$(Number(x.target.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:["UDP Retries: ",F]}),e.jsx("input",{type:"range",min:1,max:5,value:F,onChange:x=>y(Number(x.target.value)),className:"w-full h-2 bg-dark-surface rounded-lg appearance-none cursor-pointer slider"})]})]})]}),W.length>0&&e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-5 w-5 text-green-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"VPN Connection"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Route scan through VPN (optional)"}),e.jsxs("select",{value:ne,onChange:x=>Ge(x.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"No VPN - Direct connection"}),W.map(x=>e.jsxs("option",{value:x.id,children:[x.name," (",x.vpn_type.toUpperCase(),")",x.is_default?" (Default)":""]},x.id))]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"VPN connects before scan and disconnects when complete. Configure VPNs in Settings."})]})]}),(ze.length>0||He.length>0)&&e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"h-5 w-5 text-purple-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Scan Execution"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{xt("local"),ht(""),pt("")},className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${Fe==="local"?"bg-purple-600/20 border-purple-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium",children:"Local"}),e.jsx("div",{className:"text-xs opacity-70",children:"Run on this server"})]}),e.jsxs("button",{type:"button",onClick:()=>{xt("agent"),pt("")},disabled:ze.length===0,className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${Fe==="agent"?"bg-purple-600/20 border-purple-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"} ${ze.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"font-medium",children:"Agent"}),e.jsxs("div",{className:"text-xs opacity-70",children:[ze.length," online"]})]}),e.jsxs("button",{type:"button",onClick:()=>{xt("agent_group"),ht("")},disabled:He.length===0,className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${Fe==="agent_group"?"bg-purple-600/20 border-purple-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"} ${He.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"font-medium",children:"Group"}),e.jsxs("div",{className:"text-xs opacity-70",children:[He.length," groups"]})]})]}),Fe==="agent"&&ze.length>0&&e.jsxs("div",{className:"ml-4 animate-fadeIn",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Agent"}),e.jsxs("select",{value:mt,onChange:x=>ht(x.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select an agent..."}),ze.map(x=>e.jsxs("option",{value:x.id,children:[x.name,x.network_zones?` (${JSON.parse(x.network_zones).join(", ")})`:""]},x.id))]}),mt&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Scan will be executed by the selected agent in its network zone."})]}),Fe==="agent_group"&&He.length>0&&e.jsxs("div",{className:"ml-4 animate-fadeIn",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Agent Group"}),e.jsxs("select",{value:ut,onChange:x=>pt(x.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a group..."}),He.map(x=>e.jsxs("option",{value:x.id,children:[x.name,x.network_ranges?` (${JSON.parse(x.network_ranges).join(", ")})`:""]},x.id))]}),ut&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Scan tasks will be distributed across agents in this group based on network zones."})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Configure agents in Settings > Agents for distributed scanning across network zones."})]}),e.jsxs("div",{className:"space-y-2 border-t border-dark-border pt-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Scan Options"}),e.jsx(Ve,{label:"Enable OS Detection",checked:p,onChange:h}),e.jsx(Ve,{label:"Enable Service Detection",checked:S,onChange:E}),e.jsx(Ve,{label:"Enable Vulnerability Scanning",checked:P,onChange:O})]}),e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Tt,{className:"h-5 w-5 text-cyan-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Service Enumeration"})]}),e.jsx(Ve,{label:"Enable Deep Service Enumeration",checked:C,onChange:_}),C&&e.jsxs("div",{className:"ml-4 space-y-4 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Enumeration Depth"}),e.jsxs("select",{value:u,onChange:x=>v(x.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-transparent",children:[e.jsx("option",{value:"passive",children:"Passive - Banner analysis only"}),e.jsx("option",{value:"light",children:"Light - Common checks (default)"}),e.jsx("option",{value:"aggressive",children:"Aggressive - Full enumeration"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Services to Enumerate (leave empty for all detected)"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:tr.map(x=>e.jsx("button",{type:"button",onClick:()=>qs(x.id),className:`px-3 py-1.5 text-sm rounded-md border transition-colors ${A.includes(x.id)?"bg-cyan-600 border-cyan-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:x.label},x.id))}),A.length>0&&e.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Selected: ",A.join(", ")]})]})]})]}),e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qt,{className:"h-5 w-5 text-purple-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Save Configuration"})]}),e.jsx(Ve,{label:"Save this scan configuration as a template",checked:L,onChange:B}),L&&e.jsxs("div",{className:"ml-4 space-y-3 animate-fadeIn",children:[e.jsx(re,{label:"Template Name",type:"text",placeholder:"Production Network Scan Template",value:Z,onChange:x=>Y(x.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Template Description (Optional)"}),e.jsx("textarea",{value:Se,onChange:x=>Re(x.target.value),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:2,placeholder:"Quick template for scanning production servers"})]})]})]}),e.jsx(Q,{type:"submit",variant:"primary",size:"lg",loading:k,className:"w-full",children:"Start Scan"})]})]})},ar=({scan:t,isActive:s,onClick:a,tags:r,onTagClick:i})=>{const n=JSON.parse(t.targets),d=t.status,m=()=>({pending:"Pending",running:"Running",completed:"Completed",failed:"Failed"})[t.status]||t.status;return e.jsxs("div",{onClick:a,className:`
        p-4 border rounded-lg cursor-pointer transition-all duration-200
        ${s?"bg-primary/10 border-primary shadow-lg":"bg-dark-surface border-dark-border hover:border-primary/50 hover:shadow-md"}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"text-white font-semibold truncate flex-1",children:t.name}),e.jsxs(ie,{variant:"status",type:d,children:[d==="running"&&e.jsx("span",{className:"inline-block w-2 h-2 bg-primary rounded-full animate-pulse-dot mr-1"}),m()]})]}),r&&r.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[r.slice(0,3).map(c=>e.jsxs("button",{type:"button",onClick:f=>{f.stopPropagation(),i==null||i(c.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium hover:opacity-80 transition-opacity",style:{backgroundColor:c.color+"20",color:c.color},title:`Filter by ${c.name}`,children:[e.jsx(rt,{className:"h-3 w-3 mr-1"}),c.name]},c.id)),r.length>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs text-slate-400",children:["+",r.length-3," more"]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center text-slate-400",children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-mono text-xs",children:n[0]})]}),e.jsxs("div",{className:"flex items-center text-slate-500",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:Te(new Date(t.created_at),"MMM d, yyyy HH:mm")})]})]})]})},rr=({selectedIds:t,onSelectionChange:s})=>{const{scans:a,activeScan:r,setScans:i,setActiveScan:n}=ue(),[d,m]=l.useState(!0),[c,f]=l.useState(""),[N,j]=l.useState("all"),[o,g]=l.useState("all"),[b,w]=l.useState([]),[$,F]=l.useState({}),[y,p]=l.useState(!1),[h,S]=l.useState(""),[E,P]=l.useState("#06b6d4"),[O,C]=l.useState(null);l.useEffect(()=>{_(),u()},[]);const _=async()=>{try{const B=(await je.getAllWithTags()).data;i(B.map(Y=>({...Y,tags:void 0})));const Z={};B.forEach(Y=>{Z[Y.id]=Y.tags||[]}),F(Z)}catch{try{const B=await je.getAll();i(B.data)}catch{D.error("Failed to load scans")}}finally{m(!1)}},u=async()=>{try{const L=await me.getAll();w(L.data)}catch(L){console.error("Failed to load tags:",L)}},v=async()=>{if(h.trim())try{const L=await me.create({name:h.trim(),color:E});w([...b,L.data]),S(""),D.success("Tag created successfully")}catch{D.error("Failed to create tag")}},A=async L=>{try{await me.delete(L),w(b.filter(B=>B.id!==L)),o===L&&g("all"),D.success("Tag deleted")}catch{D.error("Failed to delete tag")}},V=async(L,B)=>{L.stopPropagation(),C(B);try{const Y=(await je.duplicate(B)).data;i([Y,...a]),$[B]&&F({...$,[Y.id]:$[B]}),D.success("Scan duplicated successfully")}catch{D.error("Failed to duplicate scan")}finally{C(null)}},k=a.filter(L=>{const B=L.name.toLowerCase().includes(c.toLowerCase())||L.targets.toLowerCase().includes(c.toLowerCase()),Z=N==="all"||L.status===N,Y=o==="all"||$[L.id]&&$[L.id].some(Se=>Se.id===o);return B&&Z&&Y}),R=L=>{s&&(L.target.checked?s(new Set(k.map(B=>B.id))):s(new Set))},U=(L,B)=>{if(!s||!t)return;const Z=new Set(t);B?Z.add(L):Z.delete(L),s(Z)},ge=["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444","#ec4899","#3b82f6","#84cc16"];return d?e.jsx(z,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ye,{})})}):e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scan History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(!y),className:"text-sm text-slate-400 hover:text-primary flex items-center gap-1",title:"Manage tags",children:[e.jsx(rt,{className:"h-4 w-4"}),"Tags"]}),e.jsxs("span",{className:"text-sm text-slate-400",children:[a.length," scans",t&&t.size>0&&` (${t.size} selected)`]})]})]}),y&&e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{type:"text",placeholder:"New tag name...",value:h,onChange:L=>S(L.target.value),className:"flex-1"}),e.jsx("div",{className:"flex gap-1",children:ge.map(L=>e.jsx("button",{onClick:()=>P(L),className:`w-6 h-6 rounded-full border-2 ${E===L?"border-white":"border-transparent"}`,style:{backgroundColor:L},title:L},L))}),e.jsx("button",{onClick:v,disabled:!h.trim(),className:"px-3 py-1.5 bg-primary text-white rounded hover:bg-primary/80 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ie,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(L=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:L.color+"20",color:L.color},children:[L.name,e.jsx("button",{onClick:()=>A(L.id),className:"hover:opacity-70",children:e.jsx(ve,{className:"h-3 w-3"})})]},L.id)),b.length===0&&e.jsx("span",{className:"text-sm text-slate-500",children:"No tags yet"})]})]}),e.jsx(re,{type:"text",placeholder:"Search by name, target, or customer...",value:c,onChange:L=>f(L.target.value),icon:e.jsx(Tt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bs,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-slate-400",children:"Status:"}),e.jsxs("select",{value:N,onChange:L=>j(L.target.value),className:"bg-dark-bg border border-dark-border text-slate-300 rounded px-2 py-1 focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),b.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rt,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-slate-400",children:"Tag:"}),e.jsxs("select",{value:o,onChange:L=>g(L.target.value),className:"bg-dark-bg border border-dark-border text-slate-300 rounded px-2 py-1 focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"all",children:"All Tags"}),b.map(L=>e.jsx("option",{value:L.id,children:L.name},L.id))]})]})]}),s&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"select-all",checked:(t==null?void 0:t.size)===k.length&&k.length>0,onChange:R,className:"rounded border-dark-border bg-dark-bg text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"select-all",className:"text-sm text-slate-400 cursor-pointer",children:"Select All"})]})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:k.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:c||N!=="all"||o!=="all"?"No scans match your filters":"No scans yet. Create your first scan above."}):k.map(L=>e.jsxs("div",{className:"flex items-center space-x-2",children:[s&&e.jsx("input",{type:"checkbox",checked:(t==null?void 0:t.has(L.id))||!1,onChange:B=>U(L.id,B.target.checked),className:"rounded border-dark-border bg-dark-bg text-primary focus:ring-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(ar,{scan:L,isActive:(r==null?void 0:r.id)===L.id,onClick:()=>n(L),tags:$[L.id],onTagClick:B=>g(B)}),e.jsx("button",{onClick:B=>V(B,L.id),disabled:O===L.id,className:"absolute top-2 right-12 p-1.5 bg-dark-bg/90 border border-dark-border rounded opacity-0 group-hover:opacity-100 transition-opacity hover:border-primary hover:text-primary disabled:opacity-50",title:"Duplicate scan",children:O===L.id?e.jsx(ye,{className:"h-4 w-4"}):e.jsx(At,{className:"h-4 w-4"})})]})]},L.id))})]})})},Qe=[{name:"host_discovery",label:"Host Discovery",progressStart:0,progressEnd:20},{name:"port_scanning",label:"Port Scanning",progressStart:20,progressEnd:40},{name:"service_detection",label:"Service Detection",progressStart:40,progressEnd:60},{name:"enumeration",label:"Enumeration",progressStart:60,progressEnd:75},{name:"os_fingerprinting",label:"OS Fingerprinting",progressStart:75,progressEnd:85},{name:"vulnerability_scanning",label:"Vulnerability Scanning",progressStart:85,progressEnd:100}],lr=({currentPhase:t,progress:s=0,isComplete:a=!1})=>{var m;const r=c=>c.toLowerCase().replace(/\s+/g,"_"),n=(()=>{if(a)return Qe.length;if(!t)return-1;const c=r(t);return Qe.findIndex(f=>f.name===c||r(f.label)===c)})(),d=c=>a||c<n?"completed":c===n?"active":"pending";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-6 left-0 right-0 h-0.5 bg-dark-border"}),e.jsx("div",{className:"absolute top-6 left-0 h-0.5 bg-gradient-to-r from-primary to-primary-light transition-all duration-500",style:{width:`${a?100:n/Qe.length*100}%`}}),e.jsx("div",{className:"relative grid grid-cols-6 gap-2",children:Qe.map((c,f)=>{const N=d(f);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-12 h-12 rounded-full border-2 transition-all duration-300
                    ${N==="completed"?"bg-green-500 border-green-500 shadow-lg shadow-green-500/50":N==="active"?"bg-primary border-primary shadow-lg shadow-primary/50 animate-pulse-glow":"bg-dark-surface border-dark-border"}
                  `,children:N==="completed"?e.jsx(St,{className:"h-6 w-6 text-white"}):N==="active"?e.jsx(fs,{className:"h-6 w-6 text-white animate-spin"}):e.jsx(xa,{className:"h-6 w-6 text-slate-600"})}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("p",{className:`text-xs font-medium transition-colors ${N==="completed"?"text-green-500":N==="active"?"text-primary":"text-slate-500"}`,children:c.label}),N==="active"&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"In Progress..."}),N==="completed"&&e.jsx("p",{className:"text-xs text-green-500/70 mt-1",children:"Complete"})]})]},c.name)})})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:a?e.jsx("span",{className:"text-green-500 font-medium",children:"Scan Complete"}):t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary font-medium",children:((m=Qe[n])==null?void 0:m.label)||t})," in progress..."]}):e.jsx("span",{className:"text-slate-500",children:"Initializing..."})}),e.jsxs("span",{className:"text-white font-semibold tabular-nums",children:[Math.round(s),"%"]})]}),e.jsx("div",{className:"relative h-3 bg-dark-surface rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary via-primary-light to-primary transition-all duration-500 ease-out",style:{width:`${a?100:s}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shimmer"})})})]})]})},Xe=({value:t,duration:s=500})=>{const[a,r]=l.useState(0);return l.useEffect(()=>{if(a===t)return;const i=a,n=t-i,d=Date.now(),m=()=>{const c=Date.now()-d,f=Math.min(c/s,1),N=1-Math.pow(1-f,3),j=Math.round(i+n*N);r(j),f<1&&requestAnimationFrame(m)};requestAnimationFrame(m)},[t,s]),e.jsx("span",{className:"tabular-nums",children:a.toLocaleString()})},ir=({hostsFound:t,portsOpen:s,servicesDetected:a,vulnerabilitiesFound:r,criticalVulns:i=0,highVulns:n=0,mediumVulns:d=0,lowVulns:m=0})=>{const c=[{label:"Hosts Found",value:t,icon:ke,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30"},{label:"Open Ports",value:s,icon:Ft,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30"},{label:"Services Detected",value:a,icon:Zt,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/30"},{label:"Vulnerabilities",value:r,icon:G,color:r>0?"text-red-400":"text-slate-500",bgColor:r>0?"bg-red-500/10":"bg-slate-500/10",borderColor:r>0?"border-red-500/30":"border-slate-500/30"}],f=N=>{switch(N){case"critical":return"bg-severity-critical text-white";case"high":return"bg-severity-high text-white";case"medium":return"bg-severity-medium text-white";case"low":return"bg-severity-low text-white";default:return"bg-slate-600 text-white"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(N=>{const j=N.icon;return e.jsxs("div",{className:`relative overflow-hidden rounded-lg border ${N.borderColor} ${N.bgColor} p-4 transition-all duration-300 hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(j,{className:`h-5 w-5 ${N.color}`}),N.value>0&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-current animate-pulse-dot"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:e.jsx(Xe,{value:N.value})}),e.jsx("p",{className:"text-xs text-slate-400 font-medium",children:N.label})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"})]},N.label)})}),r>0&&e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(K,{className:"h-4 w-4 text-red-400"}),e.jsx("h4",{className:"text-sm font-semibold text-white",children:"Vulnerability Breakdown"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${f("critical")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(Xe,{value:i})})," Critical"]}),n>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${f("high")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(Xe,{value:n})})," High"]}),d>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${f("medium")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(Xe,{value:d})})," Medium"]}),m>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${f("low")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(Xe,{value:m})})," Low"]})]})]})]})};class nr{constructor(s,a){Ce(this,"ws",null);Ce(this,"scanId");Ce(this,"token");Ce(this,"reconnectAttempts",0);Ce(this,"maxReconnectAttempts",10);Ce(this,"reconnectDelay",1e3);Ce(this,"messageHandlers",[]);Ce(this,"statusHandlers",[]);this.scanId=s,this.token=a||localStorage.getItem("token")||""}connect(){if(!this.token){console.error("WebSocket connection failed: No authentication token available"),this.updateStatus("failed");return}const s=window.location.protocol==="https:"?"wss:":"ws:",a=window.location.hostname,r=window.location.port||(s==="wss:"?"443":"80"),i=`${s}//${a}:${r}/api/ws/scans/${this.scanId}?token=${encodeURIComponent(this.token)}`;this.updateStatus("connecting");try{this.ws=new WebSocket(i),this.ws.onopen=()=>{console.log(`WebSocket connected for scan: ${this.scanId}`),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.updateStatus("connected")},this.ws.onmessage=n=>{try{const d=JSON.parse(n.data);this.messageHandlers.forEach(m=>m(d))}catch(d){console.error("Failed to parse WebSocket message:",d)}},this.ws.onerror=n=>{console.error("WebSocket error:",n)},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.updateStatus("disconnected"),this.attemptReconnect()}}catch(n){console.error("Failed to create WebSocket:",n),this.updateStatus("failed")}}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached"),this.updateStatus("failed");return}this.reconnectAttempts++;const s=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),8e3);console.log(`Reconnecting in ${s}ms... (Attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},s)}onMessage(s){this.messageHandlers.push(s)}onStatusChange(s){this.statusHandlers.push(s)}updateStatus(s){this.statusHandlers.forEach(a=>a(s))}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.messageHandlers=[],this.statusHandlers=[]}reconnect(){this.disconnect(),this.reconnectAttempts=0,this.connect()}}const cr=t=>{const[s,a]=l.useState("disconnected"),[r,i]=l.useState(null),n=l.useRef(null),{updateScanStatus:d,addHostToResults:m,updateHostInResults:c,results:f}=ue();l.useEffect(()=>{if(!t)return;const o=new nr(t);return n.current=o,o.onStatusChange(g=>{a(g),i(g==="failed"?"Failed to connect to WebSocket":null)}),o.onMessage(g=>{N(t,g)}),o.connect(),()=>{o.disconnect(),n.current=null}},[t]);const N=(o,g)=>{switch(console.log("WebSocket message:",g),g.type){case"scanStarted":d(o,"running"),D.info("Scan started");break;case"phaseStarted":break;case"hostDiscovered":const b={target:{ip:g.ip,hostname:g.hostname||null},is_alive:!0,os_guess:null,ports:[],vulnerabilities:[],scan_duration:{secs:0,nanos:0}};m(o,b);break;case"portFound":const $=(f.get(o)||[]).find(S=>S.target.ip===g.ip);if($){const S={port:g.port,protocol:g.protocol==="TCP"?"TCP":"UDP",state:g.state,service:null},E=[...$.ports,S];c(o,g.ip,{ports:E})}break;case"serviceDetected":const y=(f.get(o)||[]).find(S=>S.target.ip===g.ip);if(y){const S=y.ports.map(E=>E.port===g.port?{...E,service:{name:g.service_name,version:g.version||null,banner:null,cpe:null,ssl_info:null}}:E);c(o,g.ip,{ports:S})}break;case"vulnerabilityFound":const h=(f.get(o)||[]).find(S=>S.target.ip===g.ip);if(h){const S={cve_id:g.cve_id||null,title:g.title,severity:g.severity,description:"",affected_service:null},E=[...h.vulnerabilities,S];c(o,g.ip,{vulnerabilities:E}),g.severity==="Critical"?D.error(` CRITICAL vulnerability found on ${g.ip}: ${g.title}`,{autoClose:8e3}):g.severity==="High"&&D.warning(` HIGH severity vulnerability found on ${g.ip}: ${g.title}`,{autoClose:6e3})}break;case"scanCompleted":d(o,"completed"),D.success(`Scan completed! Found ${g.total_hosts} hosts`);break;case"error":g.message&&!g.message.includes("channel")&&!g.message.includes("not found")?(d(o,"failed"),D.error(`Scan error: ${g.message}`)):console.log("WebSocket channel closed, fetching actual scan status from API");break;default:console.log("Unknown message type:",g.type)}};return{status:s,error:r,reconnect:()=>{n.current&&n.current.reconnect()}}},or=({scanId:t})=>{const{status:s,error:a,reconnect:r}=cr(t),{liveUpdates:i,scans:n}=ue(),[d,m]=l.useState(!0),c=l.useMemo(()=>n.find(h=>h.id===t),[n,t]),{currentPhase:f,progress:N,isComplete:j,metrics:o,currentActivity:g,estimatedTime:b}=l.useMemo(()=>{var B,Z,Y,Se,Re,de;if(!t)return{currentPhase:void 0,progress:0,isComplete:!1,metrics:{hostsFound:0,portsOpen:0,servicesDetected:0,vulnerabilitiesFound:0,criticalVulns:0,highVulns:0,mediumVulns:0,lowVulns:0},currentActivity:"",estimatedTime:null};const h=i.get(t)||[],S=(c==null?void 0:c.status)==="completed",E=h.filter(q=>q.type==="phaseStarted"),P=E.length>0?E[E.length-1]:null,O=h.filter(q=>q.type==="scanProgress"),C=O.length>0?O[O.length-1]:null,_=h.filter(q=>q.type==="hostDiscovered"),u=h.filter(q=>q.type==="portFound"),v=h.filter(q=>q.type==="serviceDetected"),A=h.filter(q=>q.type==="vulnerabilityFound"),V=A.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="Critical"}).length,k=A.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="High"}).length,R=A.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="Medium"}).length,U=A.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="Low"}).length,ge=((B=C==null?void 0:C.data)==null?void 0:B.message)||((Z=P==null?void 0:P.data)==null?void 0:Z.phase)||"";let L=null;if(!S&&C&&((Y=C.data)==null?void 0:Y.progress)>0){const q=C.data.progress,J=h.find(ae=>ae.type==="scanStarted");if(J){const ae=new Date(J.timestamp).getTime(),H=(Date.now()-ae)/1e3,W=H/q*100;L=Math.max(0,W-H)}}return{currentPhase:(Se=P==null?void 0:P.data)==null?void 0:Se.phase,progress:((Re=C==null?void 0:C.data)==null?void 0:Re.progress)||((de=P==null?void 0:P.data)==null?void 0:de.progress)||0,isComplete:S,metrics:{hostsFound:_.length,portsOpen:u.length,servicesDetected:v.length,vulnerabilitiesFound:A.length,criticalVulns:V,highVulns:k,mediumVulns:R,lowVulns:U},currentActivity:ge,estimatedTime:L}},[t,i,c]),w=h=>h===null?"Calculating...":h<60?`~${Math.round(h)}s remaining`:h<3600?`~${Math.round(h/60)}m remaining`:`~${Math.round(h/3600)}h ${Math.round(h%3600/60)}m remaining`;if(!t)return e.jsx(z,{children:e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Select a scan to view real-time progress"})});const $=()=>{switch(s){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"disconnected":case"failed":return"text-red-500";default:return"text-slate-500"}},F=()=>s==="connected"?e.jsx(Ft,{className:"h-5 w-5"}):e.jsx(Ut,{className:"h-5 w-5"}),y=()=>{switch(s){case"connected":return"Connected - Receiving live updates";case"connecting":return"Connecting to scan...";case"disconnected":return"Disconnected";case"failed":return"Connection failed";default:return"Unknown"}},p=(c==null?void 0:c.status)==="running"||(c==null?void 0:c.status)==="completed";return e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center",children:[e.jsx(fe,{className:"h-5 w-5 mr-2"}),"Real-Time Scan Progress"]}),e.jsxs(ie,{variant:"status",type:s==="connected"?"running":"pending",children:[s==="connected"&&e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse-dot mr-1"}),"Live"]})]}),e.jsx("button",{onClick:()=>m(!d),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:d?e.jsx(Ee,{className:"h-5 w-5 text-slate-400"}):e.jsx(Ne,{className:"h-5 w-5 text-slate-400"})})]}),e.jsxs("div",{className:`flex items-center space-x-2 ${$()}`,children:[F(),e.jsx("span",{className:"text-sm",children:y()})]}),a&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-500 text-sm",children:a}),e.jsx("button",{onClick:r,className:"mt-2 text-xs text-red-400 hover:text-red-300 underline",children:"Try reconnecting"})]}),d&&e.jsxs(e.Fragment,{children:[p&&!j&&g&&e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-primary mt-0.5 animate-pulse"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm text-slate-300",children:g})})]}),b!==null&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx(pe,{className:"h-3 w-3"}),e.jsx("span",{children:w(b)})]})]}),p&&e.jsx(ir,{hostsFound:o.hostsFound,portsOpen:o.portsOpen,servicesDetected:o.servicesDetected,vulnerabilitiesFound:o.vulnerabilitiesFound,criticalVulns:o.criticalVulns,highVulns:o.highVulns,mediumVulns:o.mediumVulns,lowVulns:o.lowVulns}),p&&e.jsx("div",{className:"border-t border-dark-border pt-4",children:e.jsx(lr,{currentPhase:f,progress:N,isComplete:j})}),s==="connected"&&!p&&e.jsxs("div",{className:"border-t border-dark-border pt-4 text-sm text-slate-400",children:[e.jsx("p",{children:"Listening for scan events:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-xs",children:[e.jsx("li",{children:" Host discoveries"}),e.jsx("li",{children:" Open ports"}),e.jsx("li",{children:" Service detections"}),e.jsx("li",{children:" Vulnerability findings"})]})]})]})]})})},dr=({onScanSelect:t})=>{const{scans:s,liveUpdates:a,activeScan:r}=ue(),i=l.useMemo(()=>s.filter(f=>f.status==="running"),[s]),n=l.useMemo(()=>{const f=new Map;return i.forEach(N=>{var b;const o=(a.get(N.id)||[]).filter(w=>w.type==="scanProgress"||w.type==="phaseStarted"),g=o.length>0?o[o.length-1]:null;f.set(N.id,((b=g==null?void 0:g.data)==null?void 0:b.progress)||0)}),f},[i,a]),d=l.useMemo(()=>{let f=0,N=0,j=0;i.forEach(g=>{const b=a.get(g.id)||[];f+=n.get(g.id)||0,N+=b.filter(w=>w.type==="hostDiscovered").length,j+=b.filter(w=>w.type==="vulnerabilityFound").length});const o=i.length>0?f/i.length:0;return{totalScans:i.length,avgProgress:o,totalHosts:N,totalVulns:j}},[i,a,n]),m=f=>{switch(f){case"running":return e.jsx(fs,{className:"h-4 w-4 text-primary animate-spin"});case"completed":return e.jsx(se,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(we,{className:"h-4 w-4 text-red-500"});default:return e.jsx(fe,{className:"h-4 w-4 text-slate-400"})}},c=f=>{if(!f.started_at)return"";const N=new Date(f.started_at).getTime(),j=f.completed_at?new Date(f.completed_at).getTime():Date.now(),o=Math.floor((j-N)/1e3);return o<60?`${o}s`:o<3600?`${Math.floor(o/60)}m`:`${Math.floor(o/3600)}h ${Math.floor(o%3600/60)}m`};return i.length===0?null:e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Active Scans"}),e.jsxs(ie,{variant:"status",type:"running",children:[d.totalScans," Running"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pb-3 border-b border-dark-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(d.avgProgress),"%"]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Avg Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:d.totalHosts}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Hosts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-400",children:d.totalVulns}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Vulns"})]})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto custom-scrollbar",children:i.map(f=>{const N=n.get(f.id)||0,j=(r==null?void 0:r.id)===f.id;return e.jsxs("div",{onClick:()=>t==null?void 0:t(f.id),className:`
                  group relative p-3 rounded-lg border transition-all cursor-pointer
                  ${j?"bg-primary/10 border-primary":"bg-dark-surface border-dark-border hover:border-primary/50 hover:bg-dark-hover"}
                `,children:[e.jsx("div",{className:"absolute inset-0 bg-primary/5 rounded-lg transition-all duration-300",style:{width:`${N}%`}}),e.jsxs("div",{className:"relative flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[m(f.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:f.name}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:f.targets})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-primary tabular-nums",children:[Math.round(N),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:c(f)})]}),e.jsx(it,{className:`h-4 w-4 text-slate-400 transition-transform ${j?"text-primary":"group-hover:translate-x-1"}`})]})]}),e.jsx("div",{className:"relative mt-2 h-1 bg-dark-bg rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary to-primary-light transition-all duration-500",style:{width:`${N}%`}})})]},f.id)})})]})})},xr=({scanId:t,maxItems:s=50})=>{const{liveUpdates:a}=ue(),[r,i]=l.useState(!1),n=l.useRef(null),[d,m]=l.useState(!0),c=t?a.get(t)||[]:[],N=(r?c.filter(b=>{var w,$;return b.type==="vulnerabilityFound"&&(((w=b.data)==null?void 0:w.severity)==="Critical"||(($=b.data)==null?void 0:$.severity)==="High")}):c).slice(-s);l.useEffect(()=>{d&&n.current&&n.current.scrollIntoView({behavior:"smooth"})},[N.length,d]);const j=b=>{switch(b){case"hostDiscovered":return e.jsx(ke,{className:"h-4 w-4 text-blue-400"});case"portFound":return e.jsx(Ft,{className:"h-4 w-4 text-green-400"});case"serviceDetected":return e.jsx(Zt,{className:"h-4 w-4 text-purple-400"});case"vulnerabilityFound":return e.jsx(G,{className:"h-4 w-4 text-red-400"});case"phaseStarted":return e.jsx(fe,{className:"h-4 w-4 text-primary"});case"scanStarted":case"scanCompleted":return e.jsx(K,{className:"h-4 w-4 text-green-400"});case"vpnConnecting":return e.jsx(Pe,{className:"h-4 w-4 text-yellow-400 animate-pulse"});case"vpnConnected":return e.jsx(Pe,{className:"h-4 w-4 text-green-400"});case"vpnDisconnecting":return e.jsx(Ut,{className:"h-4 w-4 text-yellow-400"});case"vpnDisconnected":return e.jsx(Ut,{className:"h-4 w-4 text-slate-400"});case"vpnError":return e.jsx(Pe,{className:"h-4 w-4 text-red-400"});default:return e.jsx(fe,{className:"h-4 w-4 text-slate-400"})}},o=b=>{var w,$,F,y,p,h,S,E,P,O,C,_,u,v,A,V,k,R,U,ge,L,B,Z,Y;switch(b.type){case"hostDiscovered":return e.jsxs(e.Fragment,{children:["Discovered host ",e.jsx("code",{className:"text-primary font-mono",children:(w=b.data)==null?void 0:w.ip}),(($=b.data)==null?void 0:$.hostname)&&` (${b.data.hostname})`]});case"portFound":return e.jsxs(e.Fragment,{children:["Found open port"," ",e.jsxs("code",{className:"text-green-400 font-mono",children:[(F=b.data)==null?void 0:F.port,"/",(y=b.data)==null?void 0:y.protocol]})," ","on ",e.jsx("code",{className:"text-primary font-mono",children:(p=b.data)==null?void 0:p.ip})]});case"serviceDetected":return e.jsxs(e.Fragment,{children:["Detected service ",e.jsx("code",{className:"text-purple-400",children:(h=b.data)==null?void 0:h.service_name})," on"," ",e.jsx("code",{className:"text-primary font-mono",children:(S=b.data)==null?void 0:S.ip}),":",(E=b.data)==null?void 0:E.port]});case"vulnerabilityFound":return e.jsxs(e.Fragment,{children:["Found"," ",e.jsx(ie,{variant:"severity",type:((O=(P=b.data)==null?void 0:P.severity)==null?void 0:O.toLowerCase())||"low",children:(C=b.data)==null?void 0:C.severity})," ","vulnerability on ",e.jsx("code",{className:"text-primary font-mono",children:(_=b.data)==null?void 0:_.ip}),":"," ",e.jsx("span",{className:"text-white",children:(u=b.data)==null?void 0:u.title})]});case"phaseStarted":return e.jsxs(e.Fragment,{children:["Started phase: ",e.jsx("span",{className:"text-primary font-medium",children:(v=b.data)==null?void 0:v.phase})]});case"scanStarted":return e.jsx("span",{className:"text-green-400 font-medium",children:"Scan started"});case"scanCompleted":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-green-400 font-medium",children:"Scan completed"})," - Found"," ",((A=b.data)==null?void 0:A.total_hosts)||0," hosts in ",((V=b.data)==null?void 0:V.duration)||0,"s"]});case"error":return e.jsxs("span",{className:"text-red-400",children:["Error: ",(k=b.data)==null?void 0:k.message]});case"vpnConnecting":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-yellow-400",children:"Connecting to VPN:"})," ",e.jsx("span",{className:"text-white",children:(R=b.data)==null?void 0:R.config_name})]});case"vpnConnected":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-green-400 font-medium",children:"VPN connected"})," - ",(U=b.data)==null?void 0:U.config_name,((ge=b.data)==null?void 0:ge.assigned_ip)&&e.jsxs(e.Fragment,{children:[" (IP: ",e.jsx("code",{className:"text-primary font-mono",children:b.data.assigned_ip}),")"]})]});case"vpnDisconnecting":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-yellow-400",children:"Disconnecting from VPN:"})," ",e.jsx("span",{className:"text-white",children:(L=b.data)==null?void 0:L.config_name})]});case"vpnDisconnected":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-400",children:"VPN disconnected:"})," ",e.jsx("span",{className:"text-white",children:(B=b.data)==null?void 0:B.config_name})]});case"vpnError":return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-red-400",children:["VPN Error (",(Z=b.data)==null?void 0:Z.config_name,"):"]})," ",(Y=b.data)==null?void 0:Y.message]});default:return e.jsx("span",{className:"text-slate-400",children:b.type})}},g=b=>{var w;if(b.type==="vulnerabilityFound")switch((w=b.data)==null?void 0:w.severity){case"Critical":return"border-l-severity-critical bg-severity-critical/5";case"High":return"border-l-severity-high bg-severity-high/5";case"Medium":return"border-l-severity-medium bg-severity-medium/5";default:return"border-l-severity-low bg-severity-low/5"}return b.type==="vpnConnecting"||b.type==="vpnDisconnecting"?"border-l-yellow-500 bg-yellow-500/5":b.type==="vpnConnected"?"border-l-green-500 bg-green-500/5":b.type==="vpnError"?"border-l-red-500 bg-red-500/5":"border-l-slate-600 bg-dark-bg"};return t?e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Live Activity Feed"}),e.jsxs("span",{className:"text-sm text-slate-400",children:["(",N.length," events)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>i(!r),className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm transition-colors ${r?"bg-red-500/20 text-red-400 border border-red-500/50":"bg-dark-surface text-slate-400 border border-dark-border hover:border-primary"}`,children:[e.jsx(bs,{className:"h-3 w-3"}),r?"Critical/High Only":"All Events"]}),e.jsx("button",{onClick:()=>m(!d),className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${d?"bg-primary text-white":"bg-dark-surface text-slate-400 border border-dark-border"}`,children:"Auto-scroll"})]})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto pr-2 custom-scrollbar",children:[N.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:r?"No critical/high severity findings yet":"Waiting for scan events..."}):N.map((b,w)=>e.jsx("div",{className:`border-l-4 rounded-r-lg p-3 transition-all hover:bg-dark-surface/50 ${g(b)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:j(b.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-slate-300",children:o(b)}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:Te(new Date(b.timestamp),"HH:mm:ss.SSS")})]})]})},w)),e.jsx("div",{ref:n})]})]}):e.jsx(z,{children:e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Select a running scan to view live activity"})})},mr={Critical:10,High:7,Medium:4,Low:1};function Vt(t){let s=0;const a=t.vulnerabilities.reduce((n,d)=>n+mr[d.severity],0),r=t.ports.filter(n=>n.state==="Open").length,i=Math.min(r*2,30);return s=a+i,Math.min(Math.round(s),100)}function hr(t){return t>=70?"Critical":t>=50?"High":t>=25?"Medium":"Low"}function Ss(t){const s={Critical:0,High:0,Medium:0,Low:0};return t.forEach(a=>{a.vulnerabilities.forEach(r=>{s[r.severity]++})}),s}function ur(t){const s=new Map;return t.forEach(a=>{a.ports.filter(r=>r.state==="Open").forEach(r=>{var n;const i=s.get(r.port);i?i.count++:s.set(r.port,{count:1,service:((n=r.service)==null?void 0:n.name)||`Port ${r.port}`})})}),Array.from(s.entries()).map(([a,r])=>({port:a,...r})).sort((a,r)=>r.count-a.count).slice(0,10)}function pr(t){const s=t.length,a=t.reduce((d,m)=>d+m.ports.filter(c=>c.state==="Open").length,0),r=Ss(t),i=Object.values(r).reduce((d,m)=>d+m,0),n=r.Critical;return{totalHosts:s,totalPorts:a,totalVulnerabilities:i,criticalVulnerabilities:n,vulnerabilities:r}}const gr=({vulnerability:t,compact:s=!1})=>{const[a,r]=l.useState(!1),i=()=>{t.cve_id&&(navigator.clipboard.writeText(t.cve_id),D.success("CVE ID copied to clipboard"))},n=m=>`https://nvd.nist.gov/vuln/detail/${m}`,d=m=>{switch(m){case"Critical":return"border-severity-critical bg-severity-critical/10";case"High":return"border-severity-high bg-severity-high/10";case"Medium":return"border-severity-medium bg-severity-medium/10";case"Low":return"border-severity-low bg-severity-low/10";default:return"border-slate-600 bg-slate-600/10"}};return e.jsx("div",{className:`border-l-4 rounded-lg p-4 ${d(t.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),e.jsx("h4",{className:"text-white font-semibold text-sm truncate",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[t.cve_id&&e.jsxs("div",{className:"flex items-center gap-1 bg-dark-surface px-2 py-1 rounded",children:[e.jsx("code",{className:"text-xs text-primary font-mono",children:t.cve_id}),e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors",title:"Copy CVE ID",children:e.jsx(At,{className:"h-3 w-3"})}),e.jsx("a",{href:n(t.cve_id),target:"_blank",rel:"noopener noreferrer",className:"text-slate-400 hover:text-white transition-colors",title:"View on NVD",children:e.jsx(js,{className:"h-3 w-3"})})]}),e.jsx(ie,{variant:"severity",type:ws(t.severity),children:t.severity}),t.affected_service&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Affects: ",e.jsx("span",{className:"text-slate-300 font-mono",children:t.affected_service})]})]}),!s&&t.description&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm text-slate-300 mt-2 ${a?"":"line-clamp-2"}`,children:t.description}),t.description.length>100&&e.jsx("button",{onClick:()=>r(!a),className:"flex items-center gap-1 text-xs text-primary hover:text-primary-light transition-colors mt-2",children:a?e.jsxs(e.Fragment,{children:["Show less ",e.jsx(Ee,{className:"h-3 w-3"})]}):e.jsxs(e.Fragment,{children:["Show more ",e.jsx(Ne,{className:"h-3 w-3"})]})})]})]})})})},br=({banner:t,service:s})=>{const[a,r]=l.useState(!1),i=()=>{navigator.clipboard.writeText(t),D.success("Service banner copied to clipboard")},n=t.length>100,d=a||!n?t:t.substring(0,100)+"...";return e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-3 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ma,{className:"h-4 w-4 text-green-400"}),e.jsxs("span",{className:"text-xs font-semibold text-slate-300",children:["Service Banner ",s&&`(${s})`]})]}),e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors p-1 rounded hover:bg-dark-surface",title:"Copy banner",children:e.jsx(At,{className:"h-3 w-3"})})]}),e.jsx("pre",{className:"bg-slate-900 rounded p-2 overflow-x-auto",children:e.jsx("code",{className:"text-xs text-green-400 font-mono whitespace-pre-wrap break-all",children:d})}),n&&e.jsx("button",{onClick:()=>r(!a),className:"flex items-center gap-1 text-xs text-primary hover:text-primary-light transition-colors mt-2",children:a?e.jsxs(e.Fragment,{children:["Show less ",e.jsx(Ee,{className:"h-3 w-3"})]}):e.jsxs(e.Fragment,{children:["Show full banner ",e.jsx(Ne,{className:"h-3 w-3"})]})})]})};function fr(t){switch(t){case"A+":return{bg:"bg-emerald-500",text:"text-white",border:"border-emerald-600",glow:"shadow-emerald-500/50"};case"A":return{bg:"bg-green-500",text:"text-white",border:"border-green-600",glow:"shadow-green-500/50"};case"A-":return{bg:"bg-green-400",text:"text-white",border:"border-green-500",glow:"shadow-green-400/50"};case"B+":return{bg:"bg-lime-500",text:"text-white",border:"border-lime-600",glow:"shadow-lime-500/50"};case"B":return{bg:"bg-yellow-500",text:"text-gray-900",border:"border-yellow-600",glow:"shadow-yellow-500/50"};case"B-":return{bg:"bg-yellow-400",text:"text-gray-900",border:"border-yellow-500",glow:"shadow-yellow-400/50"};case"C":return{bg:"bg-orange-500",text:"text-white",border:"border-orange-600",glow:"shadow-orange-500/50"};case"D":return{bg:"bg-red-400",text:"text-white",border:"border-red-500",glow:"shadow-red-400/50"};case"F":return{bg:"bg-red-600",text:"text-white",border:"border-red-700",glow:"shadow-red-600/50"};case"T":return{bg:"bg-purple-600",text:"text-white",border:"border-purple-700",glow:"shadow-purple-600/50"};case"M":return{bg:"bg-fuchsia-600",text:"text-white",border:"border-fuchsia-700",glow:"shadow-fuchsia-600/50"};default:return{bg:"bg-gray-500",text:"text-white",border:"border-gray-600"}}}function hs(t){switch(t){case"A+":return"Excellent - Best possible SSL/TLS configuration with HSTS";case"A":return"Very Good - Strong SSL/TLS configuration";case"A-":return"Good - Minor improvements possible";case"B+":case"B":case"B-":return"Acceptable - Some security issues present";case"C":return"Weak - Significant security issues";case"D":return"Poor - Serious security vulnerabilities";case"F":return"Failed - Critical security issues";case"T":return"Trust Issue - Certificate not from a trusted CA (self-signed)";case"M":return"Mismatch - Certificate hostname does not match";default:return"Unknown - Grade could not be determined"}}function jr(t){switch(t){case"T":return ua;case"M":return ha;default:return null}}function yr(t){return t>=90?"bg-emerald-500":t>=80?"bg-green-500":t>=70?"bg-lime-500":t>=60?"bg-yellow-500":t>=50?"bg-orange-500":"bg-red-500"}function vr(t){switch(t){case"Critical":return{bg:"bg-red-600",text:"text-white"};case"High":return{bg:"bg-orange-500",text:"text-white"};case"Medium":return{bg:"bg-yellow-500",text:"text-gray-900"};case"Low":return{bg:"bg-blue-500",text:"text-white"};case"Informational":return{bg:"bg-gray-500",text:"text-white"};default:return{bg:"bg-gray-500",text:"text-white"}}}function jt({label:t,score:s,icon:a}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:t})]}),e.jsxs("span",{className:"font-mono text-gray-200",children:[s,"/100"]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${yr(s)} transition-all duration-300`,style:{width:`${s}%`}})})]})}function Nr({vuln:t}){const s=vr(t.severity);return e.jsx("div",{className:"bg-gray-800 rounded-lg p-3 border border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${s.bg} ${s.text}`,children:t.severity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-200",children:t.name}),t.cve&&e.jsx("span",{className:"text-xs text-cyan-400 font-mono",children:t.cve})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:t.description})]})]})})}function wr({grade:t,showDetails:s=!0,compact:a=!1,animate:r=!0}){const[i,n]=l.useState(!1),[d,m]=l.useState(!r),c=fr(t.grade),f=jr(t.grade),N=t.grade==="T"||t.grade==="M";return l.useEffect(()=>{if(r&&!d){const j=setTimeout(()=>m(!0),100);return()=>clearTimeout(j)}},[r,d]),a?e.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-lg font-bold text-sm
          ${c.bg} ${c.text} border ${c.border}
          ${d?"opacity-100 scale-100":"opacity-0 scale-75"}
          ${c.glow?`shadow-lg ${c.glow}`:""}
          transition-all duration-300 ease-out`,title:`SSL/TLS Grade: ${t.grade} - ${hs(t.grade)} (Score: ${t.overall_score}/100)`,children:f?e.jsx(f,{className:"w-4 h-4"}):t.grade}):e.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 ${s?"cursor-pointer hover:bg-gray-800/80":""} transition-colors`,onClick:()=>s&&n(!i),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-lg font-bold text-xl
              ${c.bg} ${c.text} border-2 ${c.border}
              ${d?"opacity-100 scale-100":"opacity-0 scale-75"}
              ${c.glow?`shadow-lg ${c.glow}`:""}
              transition-all duration-500 ease-out`,children:f?e.jsx(f,{className:"w-6 h-6"}):t.grade}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-200 font-medium",children:"SSL/TLS Grade"}),N&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${t.grade==="T"?"bg-purple-500/20 text-purple-400":"bg-fuchsia-500/20 text-fuchsia-400"}`,children:t.grade==="T"?"Trust Issue":"Hostname Mismatch"}),!N&&t.grade_capped&&e.jsx("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded",children:"Capped"})]}),e.jsx("div",{className:"text-sm text-gray-400",children:N?e.jsx("span",{children:hs(t.grade)}):e.jsxs(e.Fragment,{children:["Overall Score: ",t.overall_score,"/100",t.vulnerabilities_found.length>0&&e.jsxs("span",{className:"ml-2 text-red-400",children:["(",t.vulnerabilities_found.length," issue",t.vulnerabilities_found.length!==1?"s":"",")"]})]})})]})]}),s&&e.jsx("button",{className:"text-gray-400 hover:text-gray-200 p-1 transition-colors",children:i?e.jsx(Ee,{className:"w-5 h-5"}):e.jsx(Ne,{className:"w-5 h-5"})})]}),s&&i&&e.jsxs("div",{className:"border-t border-gray-700 p-4 space-y-4",children:[t.grade_capped&&t.cap_reason&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-400 font-medium",children:"Grade Capped"}),e.jsx("p",{className:"text-sm text-yellow-300/80 mt-1",children:t.cap_reason})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Score Breakdown"]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(jt,{label:"Protocol",score:t.protocol_score,icon:Me}),e.jsx(jt,{label:"Cipher Suites",score:t.cipher_score,icon:Ue}),e.jsx(jt,{label:"Certificate",score:t.certificate_score,icon:Wt}),e.jsx(jt,{label:"Key Exchange",score:t.key_exchange_score,icon:K})]})]}),t.vulnerabilities_found.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-red-400"}),"Issues Found (",t.vulnerabilities_found.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.vulnerabilities_found.map((j,o)=>e.jsx(Nr,{vuln:j},`${j.id}-${o}`))})]}),t.recommendations.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-400"}),"Recommendations (",t.recommendations.length,")"]}),e.jsx("ul",{className:"space-y-2",children:t.recommendations.map((j,o)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-400",children:[e.jsx(ys,{className:"w-4 h-4 text-cyan-400 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:j})]},o))})]}),t.vulnerabilities_found.length===0&&t.recommendations.length===0&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-3 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-emerald-500"}),e.jsx("span",{className:"text-emerald-400",children:"Excellent! No security issues or recommendations found."})]})]})]})}function kr(t){return t>=90?"text-emerald-400":t>=80?"text-green-400":t>=70?"text-lime-400":t>=60?"text-yellow-400":t>=50?"text-orange-400":"text-red-400"}function Sr(t){return t>=90?"bg-emerald-500":t>=80?"bg-green-500":t>=70?"bg-lime-500":t>=60?"bg-yellow-500":t>=50?"bg-orange-500":"bg-red-500"}function _r(t){switch(t){case"A+":return{bg:"bg-emerald-500",text:"text-white",border:"border-emerald-600"};case"A":return{bg:"bg-green-500",text:"text-white",border:"border-green-600"};case"A-":return{bg:"bg-green-400",text:"text-white",border:"border-green-500"};case"B+":return{bg:"bg-lime-500",text:"text-white",border:"border-lime-600"};case"B":return{bg:"bg-yellow-500",text:"text-gray-900",border:"border-yellow-600"};case"B-":return{bg:"bg-yellow-400",text:"text-gray-900",border:"border-yellow-500"};case"C":return{bg:"bg-orange-500",text:"text-white",border:"border-orange-600"};case"D":return{bg:"bg-red-400",text:"text-white",border:"border-red-500"};case"F":return{bg:"bg-red-600",text:"text-white",border:"border-red-700"};case"T":return{bg:"bg-purple-600",text:"text-white",border:"border-purple-700"};case"M":return{bg:"bg-fuchsia-600",text:"text-white",border:"border-fuchsia-700"};default:return{bg:"bg-gray-500",text:"text-white",border:"border-gray-600"}}}function Cr(t){switch(t){case"Critical":return"bg-red-600 text-white";case"High":return"bg-orange-500 text-white";case"Medium":return"bg-yellow-500 text-gray-900";case"Low":return"bg-blue-500 text-white";case"Informational":return"bg-gray-500 text-white";default:return"bg-gray-500 text-white"}}function yt({label:t,score:s,icon:a,description:r}){return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-200",children:t})]}),e.jsxs("span",{className:`font-bold text-lg ${kr(s)}`,children:[s,"/100"]})]}),e.jsx("div",{className:"h-3 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${Sr(s)} transition-all duration-500`,style:{width:`${s}%`}})}),r&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:r})]})}function $r({protocol:t,isWeak:s}){return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${s?"bg-red-500/10 border border-red-500/30":"bg-green-500/10 border border-green-500/30"}`,children:[s?e.jsx(we,{className:"w-4 h-4 text-red-400"}):e.jsx(se,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:s?"text-red-300":"text-green-300",children:t}),s&&e.jsx("span",{className:"text-xs text-red-400 ml-auto",children:"Weak"})]})}function Fr({cipher:t,isWeak:s}){return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm ${s?"bg-red-500/10 text-red-300":"bg-gray-700/50 text-gray-300"}`,children:[s&&e.jsx(G,{className:"w-3 h-3 text-red-400"}),e.jsx("span",{className:"font-mono text-xs truncate",children:t})]})}function Tr({sslInfo:t,hostname:s}){const a=t.ssl_grade;if(!a)return e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-6 border border-gray-700",children:e.jsx("p",{className:"text-gray-400 text-center",children:"SSL grade information not available"})});const r=_r(a.grade),i=a.grade==="T"||a.grade==="M";return e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-800 to-gray-900 p-6 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`flex items-center justify-center w-24 h-24 rounded-xl font-bold text-4xl shadow-xl ${r.bg} ${r.text} border-4 ${r.border}`,children:a.grade}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-2",children:["SSL/TLS Security Grade",s&&e.jsxs("span",{className:"text-gray-400 font-normal ml-2",children:["for ",s]})]}),i?e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg ${a.grade==="T"?"bg-purple-500/20 text-purple-300":"bg-fuchsia-500/20 text-fuchsia-300"}`,children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:a.grade==="T"?"Certificate not trusted (self-signed or untrusted CA)":"Certificate hostname mismatch"})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:a.overall_score}),e.jsx("span",{className:"text-gray-500",children:"/100"})]}),a.grade_capped&&a.cap_reason&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Grade capped"})]})]})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-cyan-400"}),"Score Breakdown"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(yt,{label:"Protocol Support",score:a.protocol_score,icon:Me,description:"TLS version support and configuration"}),e.jsx(yt,{label:"Cipher Strength",score:a.cipher_score,icon:Ue,description:"Encryption algorithms and key sizes"}),e.jsx(yt,{label:"Certificate",score:a.certificate_score,icon:Wt,description:"Certificate validity and chain"}),e.jsx(yt,{label:"Key Exchange",score:a.key_exchange_score,icon:K,description:"Forward secrecy and key exchange methods"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Wt,{className:"w-5 h-5 text-cyan-400"}),"Certificate Details"]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Subject"}),e.jsx("p",{className:"text-gray-200 font-mono text-sm truncate",title:t.subject,children:t.subject})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Issuer"}),e.jsx("p",{className:"text-gray-200 font-mono text-sm truncate",title:t.issuer,children:t.issuer})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Valid From"}),e.jsx("p",{className:"text-gray-200",children:new Date(t.valid_from).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Valid Until"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:t.cert_expired?"text-red-400":"text-gray-200",children:new Date(t.valid_until).toLocaleDateString()}),t.days_until_expiry!==null&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${t.cert_expired?"bg-red-500/20 text-red-400":t.days_until_expiry<30?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"}`,children:t.cert_expired?`Expired ${Math.abs(t.days_until_expiry)} days ago`:`${t.days_until_expiry} days`})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-gray-700",children:[t.self_signed&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded",children:[e.jsx(G,{className:"w-3 h-3"}),"Self-Signed"]}),t.hostname_mismatch&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-fuchsia-500/20 text-fuchsia-400 text-xs rounded",children:[e.jsx(we,{className:"w-3 h-3"}),"Hostname Mismatch"]}),t.hsts_enabled?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded",children:[e.jsx(se,{className:"w-3 h-3"}),"HSTS Enabled"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded",children:[e.jsx(G,{className:"w-3 h-3"}),"HSTS Not Enabled"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-cyan-400"}),"Protocol Support"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:t.protocols.map(n=>e.jsx($r,{protocol:n,isWeak:t.weak_protocols.includes(n)},n))})]}),t.cipher_suites.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-cyan-400"}),"Cipher Suites",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",t.cipher_suites.length,")"]})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:t.cipher_suites.map(n=>e.jsx(Fr,{cipher:n,isWeak:t.weak_ciphers.includes(n)},n))})})]}),a.vulnerabilities_found.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-red-400"}),"Security Issues",e.jsxs("span",{className:"text-sm font-normal text-red-400",children:["(",a.vulnerabilities_found.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:a.vulnerabilities_found.map((n,d)=>e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded flex-shrink-0 ${Cr(n.severity)}`,children:n.severity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-200",children:n.name}),n.cve&&e.jsxs("a",{href:`https://nvd.nist.gov/vuln/detail/${n.cve}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 font-mono hover:underline flex items-center gap-1",children:[n.cve,e.jsx(js,{className:"w-3 h-3"})]})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:n.description})]})]})},`${n.id}-${d}`))})]}),a.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-400"}),"Recommendations"]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 space-y-2",children:a.recommendations.map((n,d)=>e.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[e.jsx(ys,{className:"w-4 h-4 text-cyan-400 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-300",children:n})]},d))})]}),t.chain_issues.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-yellow-400"}),"Certificate Chain Issues"]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 space-y-2",children:t.chain_issues.map((n,d)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm text-yellow-300",children:[e.jsx(G,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:n})]},d))})]}),a.vulnerabilities_found.length===0&&a.recommendations.length===0&&t.chain_issues.length===0&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-6 flex items-center justify-center gap-3",children:[e.jsx(se,{className:"w-6 h-6 text-emerald-400"}),e.jsx("span",{className:"text-emerald-300 text-lg",children:"Excellent! SSL/TLS configuration meets best practices."})]})]})]})}const Ar=({sslInfo:t,port:s,hostname:a})=>{const[r,i]=l.useState(!1),d=t.cert_expired||t.hostname_mismatch?"critical":t.weak_protocols.length>0||t.weak_ciphers.length>0||t.self_signed?"warning":!t.hsts_enabled&&s===443?"info":"good",m=()=>t.cert_expired?"text-red-400":t.days_until_expiry?t.days_until_expiry<30?"text-yellow-400":t.days_until_expiry<90?"text-blue-400":"text-green-400":"text-slate-400";return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80",children:e.jsxs("div",{className:"relative w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>i(!1),className:"absolute top-4 right-4 z-10 p-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-white transition-colors",children:e.jsx(we,{className:"w-6 h-6"})}),e.jsx(Tr,{sslInfo:t,hostname:a})]})}):e.jsxs("div",{className:"mt-3 space-y-3 border-t border-dark-border pt-3",children:[t.ssl_grade&&e.jsxs("div",{className:"relative",children:[e.jsx(wr,{grade:t.ssl_grade,showDetails:!0,animate:!0}),e.jsx("button",{onClick:()=>i(!0),className:"absolute top-3 right-12 p-1.5 text-gray-400 hover:text-cyan-400 hover:bg-gray-700/50 rounded transition-colors",title:"View detailed SSL/TLS breakdown",children:e.jsx(vs,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:"SSL/TLS Certificate"}),!t.ssl_grade&&e.jsxs(e.Fragment,{children:[d==="critical"&&e.jsx(ie,{variant:"severity",type:"critical",children:"Critical Issues"}),d==="warning"&&e.jsx(ie,{variant:"severity",type:"high",children:"Security Issues"}),d==="good"&&e.jsx(ie,{variant:"severity",type:"low",children:"Secure"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[t.cert_valid&&!t.cert_expired?e.jsx(se,{className:"h-3 w-3 text-green-500"}):e.jsx(we,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Certificate Status"})]}),e.jsx("div",{className:t.cert_expired?"text-red-400":"text-green-400",children:t.cert_expired?"Expired":"Valid"})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(pe,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Expires In"})]}),e.jsx("div",{className:m(),children:t.days_until_expiry!==null?t.cert_expired?`${Math.abs(t.days_until_expiry)} days ago`:`${t.days_until_expiry} days`:"Unknown"})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2 col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ke,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Subject"})]}),e.jsx("div",{className:"text-slate-400 truncate",title:t.subject,children:t.subject})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2 col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(K,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Issuer"})]}),e.jsx("div",{className:"text-slate-400 truncate",title:t.issuer,children:t.issuer})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("span",{className:"font-medium text-slate-300",children:"Valid From"}),e.jsx("div",{className:"text-slate-400 text-[10px] mt-1",children:new Date(t.valid_from).toLocaleDateString()})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("span",{className:"font-medium text-slate-300",children:"Valid Until"}),e.jsx("div",{className:"text-slate-400 text-[10px] mt-1",children:new Date(t.valid_until).toLocaleDateString()})]})]}),(t.self_signed||t.hostname_mismatch||t.weak_protocols.length>0||t.weak_ciphers.length>0||!t.hsts_enabled||t.chain_issues.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm font-medium text-yellow-400",children:[e.jsx(G,{className:"h-4 w-4"}),"Security Findings"]}),t.self_signed&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-yellow-400 font-medium",children:"Self-Signed Certificate"}),e.jsx("div",{className:"text-slate-400 mt-1",children:"Certificate is not from a trusted Certificate Authority"})]}),t.hostname_mismatch&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-red-400 font-medium",children:"Hostname Mismatch"}),e.jsx("div",{className:"text-slate-400 mt-1",children:"Certificate does not match the hostname"})]}),t.weak_protocols.length>0&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-red-400 font-medium",children:"Weak Protocols"}),e.jsx("div",{className:"text-slate-400 mt-1",children:t.weak_protocols.join(", ")})]}),t.weak_ciphers.length>0&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-yellow-400 font-medium",children:"Weak Ciphers"}),e.jsx("div",{className:"text-slate-400 mt-1 max-h-16 overflow-y-auto",children:t.weak_ciphers.join(", ")})]}),!t.hsts_enabled&&s===443&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-blue-400 font-medium",children:"HSTS Not Enabled"}),e.jsx("div",{className:"text-slate-400 mt-1",children:"HTTP Strict Transport Security header not detected"})]}),t.chain_issues.length>0&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-yellow-400 font-medium",children:"Certificate Chain Issues"}),e.jsx("div",{className:"text-slate-400 mt-1",children:t.chain_issues.join(", ")})]})]}),t.protocols.length>0&&e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-300 mb-1",children:"Supported Protocols"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.protocols.map(c=>e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] ${t.weak_protocols.includes(c)?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:c},c))})]}),t.hsts_enabled&&e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-300 mb-1",children:"HSTS"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(se,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-green-400",children:"Enabled"}),t.hsts_max_age&&e.jsxs("span",{className:"text-slate-400",children:["(max-age: ",t.hsts_max_age.toLocaleString(),"s)"]})]})]})]})},Dr=({hosts:t,scanName:s="scan",scanId:a,disabled:r=!1})=>{const[i,n]=l.useState(!1),[d,m]=l.useState(!1),c=()=>{const b={scan:s,exportedAt:new Date().toISOString(),totalHosts:t.length,hosts:t.map(w=>({ip:w.target.ip,hostname:w.target.hostname,isAlive:w.is_alive,osGuess:w.os_guess,ports:w.ports.map($=>({port:$.port,protocol:$.protocol,state:$.state,service:$.service})),vulnerabilities:w.vulnerabilities}))};o(JSON.stringify(b,null,2),`${s}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.json`,"application/json"),D.success("Exported as JSON")},f=()=>{let b=`IP,Hostname,Alive,OS,Ports,Vulnerabilities,Critical,High,Medium,Low
`;t.forEach(w=>{var y;const $=w.ports.filter(p=>p.state==="Open").map(p=>p.port).join(";"),F={Critical:w.vulnerabilities.filter(p=>p.severity==="Critical").length,High:w.vulnerabilities.filter(p=>p.severity==="High").length,Medium:w.vulnerabilities.filter(p=>p.severity==="Medium").length,Low:w.vulnerabilities.filter(p=>p.severity==="Low").length};b+=`"${w.target.ip}",`,b+=`"${w.target.hostname||""}",`,b+=`${w.is_alive},`,b+=`"${((y=w.os_guess)==null?void 0:y.os_family)||""}",`,b+=`"${$}",`,b+=`${w.vulnerabilities.length},`,b+=`${F.Critical},`,b+=`${F.High},`,b+=`${F.Medium},`,b+=`${F.Low}
`}),o(b,`${s}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.csv`,"text/csv"),D.success("Exported as CSV")},N=()=>{const b=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HeroForge Scan Report - ${s}</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      padding: 2rem;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: #3b82f6; margin-bottom: 0.5rem; }
    .meta { color: #94a3b8; margin-bottom: 2rem; }
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 1.5rem;
    }
    .card h3 { color: #cbd5e1; font-size: 0.875rem; margin-bottom: 0.5rem; }
    .card .value { font-size: 2rem; font-weight: bold; }
    .host {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    .host-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #334155;
    }
    .host-ip { font-family: monospace; font-size: 1.25rem; color: #3b82f6; }
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-critical { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .badge-high { background: rgba(249, 115, 22, 0.2); color: #f97316; }
    .badge-medium { background: rgba(234, 179, 8, 0.2); color: #eab308; }
    .badge-low { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .section { margin-top: 1rem; }
    .section h4 { color: #cbd5e1; margin-bottom: 0.5rem; font-size: 0.875rem; }
    .ports { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; }
    .port {
      background: #0f172a;
      padding: 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.875rem;
    }
    .vuln {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid #ef4444;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 4px;
    }
    .vuln-title { color: #fff; font-weight: 600; margin-bottom: 0.25rem; }
    .vuln-cve { color: #3b82f6; font-family: monospace; font-size: 0.875rem; }
    @media print {
      body { background: white; color: black; }
      .card, .host { border-color: #ccc; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> HeroForge Scan Report</h1>
    <p class="meta">
      Scan: ${s} |
      Generated: ${Te(new Date,"PPpp")} |
      Hosts: ${t.length}
    </p>

    <div class="summary">
      <div class="card">
        <h3>Total Hosts</h3>
        <div class="value" style="color: #3b82f6;">${t.length}</div>
      </div>
      <div class="card">
        <h3>Open Ports</h3>
        <div class="value" style="color: #22c55e;">
          ${t.reduce((w,$)=>w+$.ports.filter(F=>F.state==="Open").length,0)}
        </div>
      </div>
      <div class="card">
        <h3>Total Vulnerabilities</h3>
        <div class="value" style="color: #eab308;">
          ${t.reduce((w,$)=>w+$.vulnerabilities.length,0)}
        </div>
      </div>
      <div class="card">
        <h3>Critical Findings</h3>
        <div class="value" style="color: #ef4444;">
          ${t.reduce((w,$)=>w+$.vulnerabilities.filter(F=>F.severity==="Critical").length,0)}
        </div>
      </div>
    </div>

    <h2 style="color: #cbd5e1; margin-bottom: 1rem;">Discovered Hosts</h2>
    ${t.map(w=>`
      <div class="host">
        <div class="host-header">
          <div>
            <div class="host-ip">${w.target.ip}</div>
            ${w.target.hostname?`<div style="color: #94a3b8; font-size: 0.875rem;">${w.target.hostname}</div>`:""}
          </div>
          <div>
            ${w.vulnerabilities.length>0?`<span class="badge badge-critical">${w.vulnerabilities.length} vulnerabilities</span>`:""}
          </div>
        </div>

        ${w.os_guess?`
          <div class="section">
            <h4>OS Detection</h4>
            <p style="color: #94a3b8; font-size: 0.875rem;">
              ${w.os_guess.os_family} ${w.os_guess.os_version||""} (${w.os_guess.confidence}% confidence)
            </p>
          </div>
        `:""}

        ${w.ports.filter($=>$.state==="Open").length>0?`
          <div class="section">
            <h4>Open Ports (${w.ports.filter($=>$.state==="Open").length})</h4>
            <div class="ports">
              ${w.ports.filter($=>$.state==="Open").map($=>`
                <div class="port">
                  <strong>${$.port}/${$.protocol}</strong><br>
                  ${$.service?`<span style="color: #94a3b8;">${$.service.name} ${$.service.version||""}</span>`:""}
                </div>
              `).join("")}
            </div>
          </div>
        `:""}

        ${w.vulnerabilities.length>0?`
          <div class="section">
            <h4>Vulnerabilities (${w.vulnerabilities.length})</h4>
            ${w.vulnerabilities.map($=>`
              <div class="vuln">
                <div class="vuln-title">${$.title}</div>
                ${$.cve_id?`<div class="vuln-cve">${$.cve_id}</div>`:""}
                <span class="badge badge-${$.severity.toLowerCase()}">${$.severity}</span>
              </div>
            `).join("")}
          </div>
        `:""}
      </div>
    `).join("")}

    <footer style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #334155; text-align: center; color: #64748b;">
      <p>Generated by HeroForge - Network Reconnaissance Tool</p>
      <p style="font-size: 0.875rem;">For authorized security testing only</p>
    </footer>
  </div>
</body>
</html>`;o(b,`${s}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.html`,"text/html"),D.success("Exported as HTML report")},j=async()=>{if(!a){D.error("Scan ID required for Markdown export");return}m(!0);try{const b=localStorage.getItem("token"),w=await Ba.get(`/api/scans/${a}/export/markdown`,{headers:{Authorization:`Bearer ${b}`},responseType:"blob"}),$=w.headers["content-disposition"];let F=`${s}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.md`;if($){const h=$.match(/filename="?([^";\n]+)"?/);h&&(F=h[1])}const y=window.URL.createObjectURL(new Blob([w.data])),p=document.createElement("a");p.href=y,p.setAttribute("download",F),document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(y),D.success("Exported as Markdown")}catch(b){console.error("Markdown export failed:",b),D.error("Failed to export as Markdown")}finally{m(!1)}},o=(b,w,$)=>{const F=new Blob([b],{type:$}),y=URL.createObjectURL(F),p=document.createElement("a");p.href=y,p.download=w,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(y)},g=b=>{if(n(!1),t.length===0){D.error("No results to export");return}switch(b){case"json":c();break;case"csv":f();break;case"html":N();break;case"markdown":j();break}};return e.jsxs("div",{className:"relative",children:[e.jsxs(Q,{onClick:()=>n(!i),disabled:r||t.length===0,variant:"secondary",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Export Results"]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-dark-surface border border-dark-border rounded-lg shadow-xl z-20 overflow-hidden",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>g("json"),className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors",children:[e.jsx(pa,{className:"h-4 w-4 text-blue-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"JSON"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Full data export"})]})]}),e.jsxs("button",{onClick:()=>g("csv"),className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors",children:[e.jsx(oe,{className:"h-4 w-4 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"CSV"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Spreadsheet format"})]})]}),e.jsxs("button",{onClick:()=>g("html"),className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors",children:[e.jsx(Zt,{className:"h-4 w-4 text-purple-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"HTML"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Printable report"})]})]}),e.jsxs("button",{onClick:()=>g("markdown"),disabled:!a||d,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ga,{className:"h-4 w-4 text-cyan-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Markdown"}),e.jsx("div",{className:"text-xs text-slate-500",children:"GitHub-flavored MD"})]})]})]})})]})]})},Er={tableOfContents:"Table of Contents",executiveSummary:"Executive Summary",riskOverview:"Risk Overview",hostInventory:"Host Inventory",portAnalysis:"Port Analysis",vulnerabilityFindings:"Vulnerability Findings",serviceEnumeration:"Service Enumeration",remediationRecommendations:"Remediation Recommendations",appendix:"Appendix"},Rr=({scanId:t,scanName:s,onClose:a,onReportCreated:r})=>{const[i,n]=l.useState([]),[d,m]=l.useState(!0),[c,f]=l.useState(!1),[N,j]=l.useState(!1),[o,g]=l.useState(`${s} Report`),[b,w]=l.useState(""),[$,F]=l.useState("pdf"),[y,p]=l.useState("technical"),[h,S]=l.useState([]),[E,P]=l.useState({include_charts:!0,company_name:"",assessor_name:"",classification:"Confidential"});l.useEffect(()=>{O()},[]),l.useEffect(()=>{const v=i.find(A=>A.id===y);v&&S(v.default_sections)},[y,i]);const O=async()=>{try{const v=await st.getTemplates();n(v.data);const A=v.data.find(V=>V.id==="technical");A&&S(A.default_sections)}catch{D.error("Failed to load report templates")}finally{m(!1)}},C=v=>{S(A=>A.includes(v)?A.filter(V=>V!==v):[...A,v])},_=async()=>{var v,A;if(!o.trim()){D.error("Please enter a report name");return}if(h.length===0){D.error("Please select at least one section");return}f(!0);try{const V={scan_id:t,name:o.trim(),description:b.trim()||void 0,format:$,template_id:y,sections:h,options:E};await st.create(V),D.success("Report generation started"),r==null||r(),a()}catch(V){const R=((A=(v=V.response)==null?void 0:v.data)==null?void 0:A.error)||"Failed to create report";D.error(R)}finally{f(!1)}},u=i.find(v=>v.id===y);return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx(z,{className:"w-full max-w-2xl mx-4",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ye,{})})})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs(z,{className:"w-full max-w-2xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Generate Report"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-dark-surface rounded-lg transition-colors",children:e.jsx(ve,{className:"h-5 w-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Name"}),e.jsx(re,{type:"text",value:o,onChange:v=>g(v.target.value),placeholder:"Enter report name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description (optional)"}),e.jsx("textarea",{value:b,onChange:v=>w(v.target.value),placeholder:"Brief description of the report",className:"w-full bg-dark-surface border border-dark-border rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Template"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:i.map(v=>e.jsxs("button",{onClick:()=>p(v.id),className:`p-4 rounded-lg border text-left transition-all ${y===v.id?"border-primary bg-primary/10":"border-dark-border hover:border-primary/50"}`,children:[e.jsx("p",{className:"font-medium text-white",children:v.name}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:v.description})]},v.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Output Format"}),e.jsx("div",{className:"flex gap-3",children:u==null?void 0:u.supports_formats.map(v=>e.jsxs("button",{onClick:()=>F(v),className:`px-6 py-3 rounded-lg border font-medium transition-all flex items-center gap-2 ${$===v?"border-primary bg-primary/10 text-primary":"border-dark-border text-slate-400 hover:border-primary/50"}`,children:[e.jsx(We,{className:"h-4 w-4"}),v.toUpperCase()]},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Included Sections"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Er).map(([v,A])=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${h.includes(A)?"border-primary bg-primary/10":"border-dark-border hover:border-primary/50"}`,children:[e.jsx("input",{type:"checkbox",checked:h.includes(A),onChange:()=>C(A),className:"w-4 h-4 rounded border-dark-border text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-white",children:A})]},v))})]}),e.jsxs("button",{onClick:()=>j(!N),className:"flex items-center gap-2 text-sm text-slate-400 hover:text-white transition-colors",children:[e.jsx(Kt,{className:"h-4 w-4"}),N?"Hide":"Show"," Advanced Options"]}),N&&e.jsxs("div",{className:"space-y-4 p-4 bg-dark-surface rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Company Name"}),e.jsx(re,{type:"text",value:E.company_name||"",onChange:v=>P({...E,company_name:v.target.value}),placeholder:"Your Company"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Assessor Name"}),e.jsx(re,{type:"text",value:E.assessor_name||"",onChange:v=>P({...E,assessor_name:v.target.value}),placeholder:"Security Analyst"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Classification"}),e.jsxs("select",{value:E.classification||"",onChange:v=>P({...E,classification:v.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"Public",children:"Public"}),e.jsx("option",{value:"Internal",children:"Internal"}),e.jsx("option",{value:"Confidential",children:"Confidential"}),e.jsx("option",{value:"Restricted",children:"Restricted"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:E.include_charts,onChange:v=>P({...E,include_charts:v.target.checked}),className:"w-4 h-4 rounded border-dark-border text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-white",children:"Include visual charts"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-border",children:[e.jsx(Q,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(Q,{onClick:_,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:"sm",className:"mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Generate Report"]})})]})]})]})})},Lr=({scanId:t,onGenerateNew:s})=>{const[a,r]=l.useState([]),[i,n]=l.useState(!0),[d,m]=l.useState(null),[c,f]=l.useState(null),[N,j]=l.useState(null);l.useEffect(()=>{o();const y=setInterval(()=>{a.filter(h=>h.status==="pending"||h.status==="generating").length>0&&o()},5e3);return()=>clearInterval(y)},[t]);const o=async()=>{try{const y=await st.getAll(t);r(y.data)}catch{D.error("Failed to load reports")}finally{n(!1)}},g=async y=>{if(y.status!=="completed"){D.warning("Report is not ready for download");return}m(y.id);try{const p=await st.download(y.id),h=new Blob([p.data],{type:p.headers["content-type"]}),S=window.URL.createObjectURL(h),E=document.createElement("a");E.href=S,E.download=`${y.name.replace(/\s+/g,"_")}.${y.format}`,document.body.appendChild(E),E.click(),window.URL.revokeObjectURL(S),document.body.removeChild(E),D.success("Report downloaded")}catch{D.error("Failed to download report")}finally{m(null)}},b=async()=>{if(N){f(N.id);try{await st.delete(N.id),r(y=>y.filter(p=>p.id!==N.id)),D.success(`Report "${N.name}" deleted`),j(null)}catch{D.error("Failed to delete report")}finally{f(null)}}},w=y=>{switch(y){case"completed":return e.jsx(se,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(we,{className:"h-4 w-4 text-red-500"});case"generating":return e.jsx(le,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(pe,{className:"h-4 w-4 text-slate-400"})}},$=y=>{switch(y){case"completed":return"completed";case"generating":return"running";case"failed":return"failed";default:return"pending"}},F=y=>y?y<1024?`${y} B`:y<1024*1024?`${(y/1024).toFixed(1)} KB`:`${(y/(1024*1024)).toFixed(1)} MB`:"-";return i?e.jsx(z,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ye,{})})}):a.length===0?e.jsx(z,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-4 text-slate-500"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Reports Yet"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Generate a professional report from your scan results."}),s&&e.jsxs(Q,{onClick:s,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]})}):e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),"Reports"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-dark-surface rounded-lg transition-colors",title:"Refresh",children:e.jsx(et,{className:"h-4 w-4 text-slate-400"})}),s&&e.jsxs(Q,{size:"sm",onClick:s,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"New Report"]})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-surface rounded-lg border border-dark-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-dark-bg rounded-lg",children:w(y.status)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:y.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-400 mt-1",children:[e.jsx("span",{className:"uppercase font-mono",children:y.format}),e.jsx("span",{children:"|"}),e.jsx("span",{children:y.template_id}),e.jsx("span",{children:"|"}),e.jsx("span",{children:Te(new Date(y.created_at),"MMM d, yyyy HH:mm")}),y.file_size&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"|"}),e.jsx("span",{children:F(y.file_size)})]})]}),y.error_message&&e.jsx("p",{className:"text-sm text-red-400 mt-1",children:y.error_message})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{variant:"status",type:$(y.status),children:y.status}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g(y),disabled:y.status!=="completed"||d===y.id,className:`p-2 rounded-lg transition-colors ${y.status==="completed"?"hover:bg-dark-bg text-slate-400 hover:text-white":"text-slate-600 cursor-not-allowed"}`,title:"Download",children:d===y.id?e.jsx(le,{className:"h-4 w-4 animate-spin"}):e.jsx(We,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j(y),disabled:c===y.id,className:"p-2 rounded-lg text-slate-400 hover:text-red-400 hover:bg-dark-bg transition-colors",title:"Delete","aria-label":`Delete report ${y.name}`,children:c===y.id?e.jsx(le,{className:"h-4 w-4 animate-spin"}):e.jsx(Yt,{className:"h-4 w-4"})})]})]})]},y.id))}),e.jsx(Ua,{isOpen:!!N,onClose:()=>j(null),onConfirm:b,title:"Delete Report",message:`Are you sure you want to delete the report "${N==null?void 0:N.name}"?`,confirmLabel:"Delete Report",variant:"danger",loading:!!c})]})},Pr=({scanId:t,scanName:s,onClose:a})=>{const[r,i]=l.useState([]),[n,d]=l.useState(new Set),[m,c]=l.useState(!1),[f,N]=l.useState(!1),[j,o]=l.useState(null),[g,b]=l.useState(null),[w,$]=l.useState(!1),[F,y]=l.useState("pdf");l.useEffect(()=>{p()},[]);const p=async()=>{c(!0);try{const C=await bt.getFrameworks();i(C.data.frameworks),d(new Set(["pci_dss","nist_800_53","owasp_top10"]))}catch{D.error("Failed to load compliance frameworks")}finally{c(!1)}},h=async()=>{var C,_;if(n.size===0){D.warning("Please select at least one framework");return}N(!0);try{const u=await bt.analyzeScan(t,{frameworks:Array.from(n)});o(u.data),D.success("Compliance analysis completed")}catch(u){const v=u;D.error(((_=(C=v.response)==null?void 0:C.data)==null?void 0:_.error)||"Analysis failed")}finally{N(!1)}},S=C=>{const _=new Set(n);_.has(C)?_.delete(C):_.add(C),d(_)},E=C=>C>=80?"text-green-400":C>=60?"text-yellow-400":C>=40?"text-orange-400":"text-red-400",P=C=>C>=80?"completed":C>=60?"running":"failed",O=async()=>{var C,_;if(j){$(!0);try{const u=j.summary.frameworks.map(U=>String(U.framework).toLowerCase().replace(/_/g,"_")),v=await bt.generateReport(t,{frameworks:u,format:F,include_evidence:!0}),A=await bt.downloadReport(v.data.report_id),V=new Blob([A.data],{type:F==="pdf"?"application/pdf":F==="html"?"text/html":"application/json"}),k=window.URL.createObjectURL(V),R=document.createElement("a");R.href=k,R.download=`compliance_report_${t}.${F}`,document.body.appendChild(R),R.click(),document.body.removeChild(R),window.URL.revokeObjectURL(k),D.success(`${F.toUpperCase()} report generated and downloaded successfully`)}catch(u){const v=u;D.error(((_=(C=v.response)==null?void 0:C.data)==null?void 0:_.error)||"Failed to generate report")}finally{$(!1)}}};return m?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsx(z,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ye,{})})})}):e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:e.jsxs(z,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Compliance Analysis"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Scan: ",s]})]})]}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(we,{className:"h-6 w-6"})})]}),j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 p-4 bg-dark-bg rounded-lg border border-dark-border",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:`text-3xl font-bold ${E(j.summary.overall_score)}`,children:[j.summary.overall_score.toFixed(0),"%"]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Overall Score"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:j.summary.total_findings}),e.jsx("p",{className:"text-sm text-slate-400",children:"Total Findings"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-red-400",children:j.summary.critical_findings+j.summary.high_findings}),e.jsx("p",{className:"text-sm text-slate-400",children:"Critical/High"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:j.summary.medium_findings+j.summary.low_findings}),e.jsx("p",{className:"text-sm text-slate-400",children:"Medium/Low"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Framework Results"}),j.summary.frameworks.map(C=>e.jsxs("div",{className:"border border-dark-border rounded-lg overflow-hidden",children:[e.jsxs("div",{onClick:()=>b(g===C.framework?null:C.framework),className:"flex items-center justify-between p-4 bg-dark-surface cursor-pointer hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g===C.framework?e.jsx(Ne,{className:"h-5 w-5 text-slate-400"}):e.jsx(it,{className:"h-5 w-5 text-slate-400"}),e.jsx("span",{className:"font-medium text-white",children:C.framework})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ba,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-green-400",children:C.compliant})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(we,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-red-400",children:C.non_compliant})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400",children:C.partially_compliant})]}),e.jsxs(ie,{variant:"status",type:P(C.compliance_score),children:[C.compliance_score.toFixed(0),"%"]})]})]}),g===C.framework&&e.jsxs("div",{className:"p-4 bg-dark-bg border-t border-dark-border",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Total Controls"}),e.jsx("p",{className:"text-xl font-bold text-white",children:C.total_controls})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Compliant"}),e.jsx("p",{className:"text-xl font-bold text-green-400",children:C.compliant})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Non-Compliant"}),e.jsx("p",{className:"text-xl font-bold text-red-400",children:C.non_compliant})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Partially Compliant"}),e.jsx("p",{className:"text-xl font-bold text-yellow-400",children:C.partially_compliant})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Not Applicable"}),e.jsx("p",{className:"text-xl font-bold text-slate-400",children:C.not_applicable})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Not Assessed"}),e.jsx("p",{className:"text-xl font-bold text-slate-500",children:C.not_assessed})]})]}),C.by_category&&C.by_category.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"By Category"}),e.jsx("div",{className:"space-y-2",children:C.by_category.map(_=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-surface rounded",children:[e.jsx("span",{className:"text-sm text-white",children:_.category}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[_.compliant,"/",_.total," compliant"]}),e.jsx("div",{className:"w-24 bg-dark-border rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${_.percentage>=80?"bg-green-500":_.percentage>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${_.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-slate-300 w-12 text-right",children:[_.percentage.toFixed(0),"%"]})]})]},_.category))})]})]})]},C.framework))]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-dark-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Generate Compliance Report"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex gap-2",children:["pdf","html","json"].map(C=>e.jsx("button",{onClick:()=>y(C),className:`px-4 py-2 rounded-lg font-medium transition-colors ${F===C?"bg-primary text-white":"bg-dark-surface text-slate-400 hover:bg-dark-hover"}`,children:C.toUpperCase()},C))}),e.jsx(Q,{onClick:O,disabled:w,className:"ml-auto",children:w?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 animate-spin mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"h-4 w-4 mr-2"}),"Generate Report"]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsxs(Q,{variant:"secondary",onClick:()=>o(null),children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"Run New Analysis"]}),e.jsx(Q,{onClick:a,children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Compliance Frameworks"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.map(C=>e.jsx("div",{onClick:()=>S(C.id),className:`p-4 rounded-lg border cursor-pointer transition-all ${n.has(C.id)?"border-primary bg-primary/10":"border-dark-border hover:border-primary/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ve,{checked:n.has(C.id),onChange:()=>S(C.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-white",children:C.name}),e.jsxs(ie,{variant:"status",type:"running",children:["v",C.version]})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:C.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:[C.control_count," controls"]}),e.jsxs("span",{children:[C.automated_percentage.toFixed(0),"% automated"]})]})]})]})},C.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Q,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(Q,{onClick:h,disabled:f||n.size===0,children:f?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 animate-spin mr-2"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Run Analysis"]})})]})]})]})})},Mr=({scanId:t})=>{const[s,a]=l.useState(null),[r,i]=l.useState(!0),[n,d]=l.useState(null),[m,c]=l.useState(null),[f,N]=l.useState(""),[j,o]=l.useState(!1),g=l.useRef(),b=l.useRef(null);l.useEffect(()=>{(async()=>{try{i(!0);const u=localStorage.getItem("token"),v=await fetch(`/api/scans/${t}/topology`,{headers:{Authorization:`Bearer ${u}`}});if(!v.ok)throw new Error("Failed to fetch topology data");const A=await v.json();a(A)}catch(u){d(u instanceof Error?u.message:"Unknown error")}finally{i(!1)}})()},[t]);const w=_=>_.critical_vulns>0||_.risk_score>=75?"#ef4444":_.high_vulns>0||_.risk_score>=50?"#f97316":_.risk_score>=25?"#eab308":"#22c55e",$=_=>{const v=Math.min(_.open_ports_count/10,3),A=Math.min(_.vuln_count/5,3),V=_.is_gateway?3:0;return 5+v+A+V},F=_=>{switch(_){case"server":return e.jsx(ke,{className:"w-4 h-4"});case"workstation":return e.jsx(Na,{className:"w-4 h-4"});case"network":return e.jsx(Gt,{className:"w-4 h-4"});case"gateway":return e.jsx(ls,{className:"w-4 h-4"});default:return e.jsx(va,{className:"w-4 h-4"})}},y=_=>{switch(_.relationship_type){case"gateway":return"#3b82f6";case"shared_service":return"#8b5cf6";case"same_subnet":return"#6b7280";default:return"#6b7280"}},p=l.useCallback(_=>{c(_)},[]),h=()=>{if(g.current){const _=g.current.zoom();g.current.zoom(_*1.3,400)}},S=()=>{if(g.current){const _=g.current.zoom();g.current.zoom(_/1.3,400)}},E=()=>{if(!s||!f)return;const _=s.nodes.find(u=>{var v;return u.ip.includes(f)||((v=u.hostname)==null?void 0:v.toLowerCase().includes(f.toLowerCase()))});if(_&&g.current){const u=_;g.current.centerAt(u.x,u.y,1e3),g.current.zoom(3,1e3),c(_)}},P=()=>{o(!j)};if(r)return e.jsx(z,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading network topology..."})]})});if(n)return e.jsx(z,{className:"p-8",children:e.jsx("div",{className:"text-center text-red-600 dark:text-red-400",children:e.jsxs("p",{children:["Failed to load topology: ",n]})})});if(!s||s.nodes.length===0)return e.jsx(z,{className:"p-8",children:e.jsxs("div",{className:"text-center text-gray-600 dark:text-gray-400",children:[e.jsx(Gt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No topology data available for this scan."})]})});const O={nodes:s.nodes.map(_=>({..._,color:w(_),size:$(_)})),links:s.edges.map(_=>({..._,color:y(_)}))},C=j?"fixed inset-0 z-50 bg-gray-900":"relative";return e.jsx("div",{ref:b,className:C,children:e.jsxs(z,{className:j?"h-full rounded-none":"h-[600px]",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-2",children:[e.jsx("input",{type:"text",placeholder:"Search IP or hostname...",value:f,onChange:_=>N(_.target.value),onKeyPress:_=>_.key==="Enter"&&E(),className:"px-3 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:text-white"}),e.jsx("button",{onClick:E,className:"px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors",children:e.jsx(Tt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-2",children:[e.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Zoom In",children:e.jsx(ja,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Zoom Out",children:e.jsx(ya,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:P,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:j?"Exit Fullscreen":"Fullscreen",children:j?e.jsx(ve,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}):e.jsx(vs,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})})]})]}),e.jsxs("div",{className:"absolute top-4 right-4 z-10 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-xs",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2 text-gray-900 dark:text-white",children:"Legend"}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Risk Level"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Low (0-25)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Medium (25-50)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"High (50-75)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Critical (75+)"})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Connections"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Gateway"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-purple-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Shared Service"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Same Subnet"})]})]})]})]}),m&&e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[F(m.node_type),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:m.hostname||m.ip})]}),e.jsx("button",{onClick:()=>c(null),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"IP:"})," ",m.ip]}),m.os&&e.jsxs("div",{children:[e.jsx("strong",{children:"OS:"})," ",m.os]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Subnet:"})," ",m.subnet]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Open Ports:"})," ",m.open_ports_count]}),m.vuln_count>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerabilities:"})," ",m.vuln_count]}),m.critical_vulns>0&&e.jsxs("div",{className:"text-red-600 dark:text-red-400",children:["Critical: ",m.critical_vulns]}),m.high_vulns>0&&e.jsxs("div",{className:"text-orange-600 dark:text-orange-400",children:["High: ",m.high_vulns]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Risk Score:"})," ",m.risk_score.toFixed(1)]})]}),m.is_gateway&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded text-xs font-medium",children:[e.jsx(ls,{className:"w-3 h-3 mr-1"}),"Gateway"]})})]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 z-10 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-xs",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2 text-gray-900 dark:text-white",children:["Subnets (",s.subnets.length,")"]}),e.jsx("div",{className:"space-y-1 text-xs max-h-32 overflow-y-auto",children:s.subnets.map(_=>e.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-mono",children:_.subnet}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-500",children:[_.host_count," ",_.host_count===1?"host":"hosts"]})]},_.subnet))})]}),e.jsx(Wa,{ref:g,graphData:O,nodeLabel:_=>{const u=_;return`${u.hostname||u.ip}
${u.os||""}
Risk: ${u.risk_score.toFixed(1)}`},nodeColor:_=>_.color||"#22c55e",nodeVal:_=>_.size||5,linkColor:_=>_.color||"#64748b",linkWidth:_=>(_.strength||1)*2,linkDirectionalParticles:_=>_.relationship_type==="gateway"?2:0,linkDirectionalParticleSpeed:.005,onNodeClick:p,nodeCanvasObject:(_,u,v)=>{const A=_,V=A.hostname||A.ip,k=12/v;u.font=`${k}px Sans-Serif`,u.beginPath(),u.arc(A.x||0,A.y||0,A.size||5,0,2*Math.PI,!1),u.fillStyle=A.color||"#22c55e",u.fill(),A.is_gateway&&(u.strokeStyle="#3b82f6",u.lineWidth=2/v,u.stroke()),v>1.5&&(u.textAlign="center",u.textBaseline="middle",u.fillStyle="rgba(255, 255, 255, 0.9)",u.fillText(V,A.x||0,(A.y||0)+(A.size||5)+k+2))},enableNodeDrag:!0,enableZoomInteraction:!0,enablePanInteraction:!0,cooldownTicks:100,onEngineStop:()=>{var _;return(_=g.current)==null?void 0:_.zoomToFit(400)}})]})})},zr=({scanId:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(null),[n,d]=l.useState(!0),[m,c]=l.useState(""),[f,N]=l.useState(""),[j,o]=l.useState(""),[g,b]=l.useState(new Set),[w,$]=l.useState(null),[F,y]=l.useState(!1),p=l.useCallback(async()=>{try{d(!0);let R=(await Je.getByScan(t)).data;m&&(R=R.filter(U=>U.status===m)),f&&(R=R.filter(U=>U.severity===f)),j&&(R=R.filter(U=>U.secret_type===j)),a(R)}catch(k){console.error("Failed to load secret findings:",k),D.error("Failed to load secret findings")}finally{d(!1)}},[t,m,f,j]),h=l.useCallback(async()=>{try{const k=await Je.getStats(t);i(k.data)}catch(k){console.error("Failed to load secret finding stats:",k)}},[t]);l.useEffect(()=>{p(),h()},[p,h]);const S=(k,R)=>{const U=new Set(g);R?U.add(k):U.delete(k),b(U)},E=async(k,R)=>{try{y(!0),await Je.update(k,{status:R}),D.success(`Status updated to ${R}`),p(),h()}catch(U){console.error("Failed to update status:",U),D.error("Failed to update status")}finally{y(!1)}},P=async k=>{if(g.size!==0)try{y(!0);const R=await Je.bulkUpdateStatus(Array.from(g),k);D.success(R.data.message),b(new Set),p(),h()}catch(R){console.error("Failed to bulk update status:",R),D.error("Failed to update findings")}finally{y(!1)}},O=async(k,R)=>{try{y(!0),await Je.update(k,{false_positive:R,status:R?"false_positive":"open"}),D.success(R?"Marked as false positive":"Unmarked false positive"),p(),h()}catch(U){console.error("Failed to update false positive status:",U),D.error("Failed to update")}finally{y(!1)}},C=k=>{const R="px-2 py-1 text-xs font-semibold rounded-full";switch(k.toLowerCase()){case"critical":return`${R} bg-red-500/20 text-red-400`;case"high":return`${R} bg-orange-500/20 text-orange-400`;case"medium":return`${R} bg-yellow-500/20 text-yellow-400`;case"low":return`${R} bg-blue-500/20 text-blue-400`;default:return`${R} bg-gray-500/20 text-gray-400`}},_=k=>{const R="px-2 py-1 text-xs font-semibold rounded-full";switch(k){case"open":return`${R} bg-red-500/20 text-red-400`;case"investigating":return`${R} bg-yellow-500/20 text-yellow-400`;case"resolved":return`${R} bg-green-500/20 text-green-400`;case"false_positive":return`${R} bg-gray-500/20 text-gray-400`;default:return`${R} bg-gray-500/20 text-gray-400`}},u=k=>{const R=k.toLowerCase();return R.includes("key")||R.includes("api")?e.jsx(Ue,{className:"h-4 w-4"}):R.includes("password")||R.includes("secret")?e.jsx(Me,{className:"h-4 w-4"}):R.includes("token")?e.jsx(K,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})},v=k=>k.replace(/_/g," ").replace(/\b\w/g,R=>R.toUpperCase()),A=k=>{const R=Math.round(k*100);return R>=90?e.jsxs("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded",children:[R,"% confident"]}):R>=70?e.jsxs("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-0.5 rounded",children:[R,"% confident"]}):e.jsxs("span",{className:"text-xs text-gray-400 bg-gray-500/10 px-2 py-0.5 rounded",children:[R,"% confident"]})},V=[...new Set(s.map(k=>k.secret_type))];return n?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"})}):s.length===0&&!(r!=null&&r.total_findings)?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(K,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No exposed secrets detected in this scan."})]}):e.jsxs("div",{className:"space-y-4",children:[r&&r.total_findings>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Total Secrets"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.total_findings})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Critical"}),e.jsx("div",{className:"text-2xl font-bold text-red-500",children:r.critical_count})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"High"}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:r.high_count})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Open"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:r.open_count})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Resolved"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:r.resolved_count})]})]}),r&&r.by_type.length>0&&e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Secrets by Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.by_type.map(k=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700/50 px-3 py-1.5 rounded-full text-sm",children:[u(k.secret_type),e.jsx("span",{className:"text-gray-300",children:v(k.secret_type)}),e.jsx("span",{className:"bg-gray-600 px-2 py-0.5 rounded-full text-xs text-white",children:k.count})]},k.secret_type))})]}),e.jsx("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Status"}),e.jsxs("select",{value:m,onChange:k=>c(k.target.value),className:"block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Severity"}),e.jsxs("select",{value:f,onChange:k=>N(k.target.value),className:"block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Type"}),e.jsxs("select",{value:j,onChange:k=>o(k.target.value),className:"block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All Types"}),V.map(k=>e.jsx("option",{value:k,children:v(k)},k))]})]}),g.size>0&&e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[g.size," selected"]}),e.jsx("button",{onClick:()=>P("resolved"),disabled:F,className:"px-3 py-1.5 text-sm bg-green-600 hover:bg-green-500 text-white rounded-md disabled:opacity-50",children:"Mark Resolved"}),e.jsx("button",{onClick:()=>P("false_positive"),disabled:F,className:"px-3 py-1.5 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded-md disabled:opacity-50",children:"False Positive"})]})]})}),e.jsx("div",{className:"space-y-2",children:s.map(k=>e.jsxs("div",{className:`bg-gray-800 border rounded-lg overflow-hidden transition-all ${k.false_positive?"border-gray-600 opacity-60":k.status==="resolved"?"border-green-700":"border-gray-700"}`,children:[e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsx("input",{type:"checkbox",checked:g.has(k.id),onChange:R=>S(k.id,R.target.checked),className:"rounded border-gray-600 bg-gray-700 text-cyan-500 focus:ring-cyan-500"}),e.jsx("div",{className:"flex items-center gap-2 text-gray-400",children:u(k.secret_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white",children:v(k.secret_type)}),e.jsx("span",{className:C(k.severity),children:k.severity.toUpperCase()}),e.jsx("span",{className:_(k.status),children:k.status.replace("_"," ").toUpperCase()}),A(k.confidence)]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("span",{className:"font-mono",children:k.host_ip}),k.port&&e.jsxs("span",{children:[":",k.port]}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsxs("span",{children:[k.source_type,": ",k.source_location]}),k.line_number&&e.jsxs("span",{className:"text-gray-500",children:[" (line ",k.line_number,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!k.false_positive&&k.status!=="resolved"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(k.id,"resolved"),disabled:F,className:"p-1.5 text-green-400 hover:bg-green-500/20 rounded transition-colors",title:"Mark Resolved",children:e.jsx(St,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>O(k.id,!0),disabled:F,className:"p-1.5 text-gray-400 hover:bg-gray-500/20 rounded transition-colors",title:"Mark False Positive",children:e.jsx(ve,{className:"h-4 w-4"})})]}),k.false_positive&&e.jsx("button",{onClick:()=>O(k.id,!1),disabled:F,className:"p-1.5 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Unmark False Positive",children:e.jsx(wa,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$(w===k.id?null:k.id),className:"p-1.5 text-gray-400 hover:bg-gray-500/20 rounded transition-colors",children:w===k.id?e.jsx(Ee,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"})})]})]}),w===k.id&&e.jsxs("div",{className:"border-t border-gray-700 p-4 bg-gray-850",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Redacted Value"}),e.jsx("div",{className:"bg-gray-900 p-3 rounded font-mono text-sm text-cyan-400 break-all",children:k.redacted_value})]}),k.context&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Context"}),e.jsx("div",{className:"bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 whitespace-pre-wrap break-all max-h-32 overflow-y-auto",children:k.context})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Source Type:"}),e.jsx("span",{className:"ml-2 text-gray-300",children:k.source_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Location:"}),e.jsx("span",{className:"ml-2 text-gray-300 font-mono",children:k.source_location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Detected:"}),e.jsx("span",{className:"ml-2 text-gray-300",children:new Date(k.created_at).toLocaleString()})]}),k.resolved_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Resolved:"}),e.jsx("span",{className:"ml-2 text-gray-300",children:new Date(k.resolved_at).toLocaleString()})]})]}),k.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(ka,{className:"h-4 w-4"}),"Notes"]}),e.jsx("div",{className:"bg-gray-900 p-3 rounded text-sm text-gray-300",children:k.notes})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded",children:[e.jsxs("h4",{className:"text-sm font-medium text-yellow-400 mb-2 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Remediation Guidance"]}),e.jsxs("ul",{className:"text-sm text-gray-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Immediately rotate or revoke the exposed credential"}),e.jsx("li",{children:"Check audit logs for any unauthorized access using this credential"}),e.jsx("li",{children:"Review how the secret was exposed and fix the root cause"}),e.jsx("li",{children:"Implement secrets management best practices (e.g., HashiCorp Vault, AWS Secrets Manager)"}),e.jsx("li",{children:"Add pre-commit hooks to prevent secrets from being committed"})]})]})]})]},k.id))}),s.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No findings match your current filters."})]})},Hr=({score:t,category:s,confidence:a,priority:r,estimatedHours:i,compact:n=!1})=>{const d=f=>{switch(f.toLowerCase()){case"critical":return"text-red-400 bg-red-500/20 border-red-500/50";case"high":return"text-orange-400 bg-orange-500/20 border-orange-500/50";case"medium":return"text-yellow-400 bg-yellow-500/20 border-yellow-500/50";case"low":return"text-green-400 bg-green-500/20 border-green-500/50";default:return"text-gray-400 bg-gray-500/20 border-gray-500/50"}},m=f=>f>=80?"text-red-400":f>=60?"text-orange-400":f>=40?"text-yellow-400":"text-green-400",c=f=>f/100*180-90;return n?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`text-2xl font-bold ${m(t)}`,children:t.toFixed(0)}),e.jsx("div",{className:`px-2 py-1 rounded-md text-xs font-medium border ${d(s)}`,children:s.toUpperCase()}),e.jsxs("div",{className:"text-gray-500 text-sm",children:["#",r]})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("div",{className:"relative w-32 h-16 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-end justify-center",children:e.jsx("div",{className:"w-32 h-16 border-t-8 border-l-8 border-r-8 border-gray-700 rounded-t-full"})}),e.jsx("div",{className:"absolute inset-0 flex items-end justify-center origin-bottom",style:{transform:`rotate(${c(t)}deg)`},children:e.jsx("div",{className:`w-1 h-14 ${m(t)} bg-current rounded-t-full`})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 text-center",children:e.jsx("span",{className:`text-2xl font-bold ${m(t)}`,children:t.toFixed(0)})})]})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${d(s)}`,children:[s.toUpperCase()," RISK"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded p-2",children:[e.jsx(nt,{className:"w-4 h-4 mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Priority"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:["#",r]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded p-2",children:[e.jsx(K,{className:"w-4 h-4 mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Confidence"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[a.toFixed(0),"%"]})]}),i!==void 0&&e.jsxs("div",{className:"bg-gray-900/50 rounded p-2",children:[e.jsx(pe,{className:"w-4 h-4 mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Effort"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[i,"h"]})]})]})]})},Or=({scores:t,onSelectVulnerability:s,selectedId:a})=>{const[r,i]=l.useState(null),[n,d]=l.useState("all"),m=o=>{switch(o.toLowerCase()){case"critical":return"border-red-500 bg-red-500/10";case"high":return"border-orange-500 bg-orange-500/10";case"medium":return"border-yellow-500 bg-yellow-500/10";case"low":return"border-green-500 bg-green-500/10";default:return"border-gray-500 bg-gray-500/10"}},c=o=>{switch(o.toLowerCase()){case"critical":return"bg-red-500/20 text-red-400 border-red-500/50";case"high":return"bg-orange-500/20 text-orange-400 border-orange-500/50";case"medium":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/50";case"low":return"bg-green-500/20 text-green-400 border-green-500/50";default:return"bg-gray-500/20 text-gray-400 border-gray-500/50"}},f=n==="all"?t:t.filter(o=>o.risk_category.toLowerCase()===n),N=["all","critical","high","medium","low"],j={all:t.length,critical:t.filter(o=>o.risk_category.toLowerCase()==="critical").length,high:t.filter(o=>o.risk_category.toLowerCase()==="high").length,medium:t.filter(o=>o.risk_category.toLowerCase()==="medium").length,low:t.filter(o=>o.risk_category.toLowerCase()==="low").length};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:N.map(o=>e.jsxs("button",{onClick:()=>d(o),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${n===o?o==="all"?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50":c(o):"bg-gray-800 text-gray-400 border border-gray-700 hover:border-gray-600"}`,children:[o.charAt(0).toUpperCase()+o.slice(1),e.jsxs("span",{className:"ml-1.5 text-xs opacity-75",children:["(",j[o],")"]})]},o))}),e.jsx("div",{className:"space-y-2",children:f.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No vulnerabilities in this category"}):f.map(o=>e.jsxs("div",{className:`border-l-4 rounded-lg transition-all ${m(o.risk_category)} ${a===o.vulnerability_id?"ring-2 ring-cyan-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-800/50",onClick:()=>{s&&s(o.vulnerability_id),i(r===o.vulnerability_id?null:o.vulnerability_id)},children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gray-800 text-white font-bold text-sm",children:["#",o.remediation_priority]}),e.jsx(Hr,{score:o.effective_risk_score,category:o.risk_category,confidence:o.confidence,priority:o.remediation_priority,compact:!0})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),o.estimated_effort.estimated_hours,"h"]}),e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx($t,{className:"w-4 h-4 mr-1"}),o.confidence.toFixed(0),"%"]}),r===o.vulnerability_id?e.jsx(Ee,{className:"w-5 h-5 text-gray-400"}):e.jsx(Ne,{className:"w-5 h-5 text-gray-400"})]})]}),r===o.vulnerability_id&&e.jsx("div",{className:"px-4 pb-4 border-t border-gray-700/50",children:e.jsxs("div",{className:"pt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Contributing Factors"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.factor_scores.slice(0,4).map((g,b)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 rounded p-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:g.factor_name}),e.jsx("span",{className:"text-xs font-medium text-white",children:g.normalized_value.toFixed(0)})]},b))})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${o.estimated_effort.effort_level==="low"?"bg-green-500/20 text-green-400":o.estimated_effort.effort_level==="medium"?"bg-yellow-500/20 text-yellow-400":o.estimated_effort.effort_level==="high"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:[o.estimated_effort.effort_level.replace("_"," ").toUpperCase()," EFFORT"]}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${o.estimated_effort.impact_level==="low"?"bg-green-500/20 text-green-400":o.estimated_effort.impact_level==="medium"?"bg-yellow-500/20 text-yellow-400":o.estimated_effort.impact_level==="high"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:[o.estimated_effort.impact_level.toUpperCase()," IMPACT"]}),o.estimated_effort.requires_downtime&&e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-red-500/20 text-red-400",children:"DOWNTIME REQUIRED"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Calculated: ",new Date(o.calculated_at).toLocaleString()]})]})})]},o.vulnerability_id))})]})},Vr=({score:t})=>{const s=t.factor_scores.map(i=>({name:i.factor_name.replace(" ",`
`),value:i.normalized_value,contribution:i.contribution,weight:i.weight})),a=i=>i>=80?"#ef4444":i>=60?"#f97316":i>=40?"#eab308":"#22c55e",r=({active:i,payload:n})=>{if(i&&n&&n.length){const d=n[0].payload;return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-medium text-white",children:d.name.replace(`
`," ")}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Score: ",e.jsx("span",{className:"text-white",children:d.value.toFixed(1)})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Weight: ",e.jsxs("span",{className:"text-white",children:[(d.weight*100).toFixed(0),"%"]})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Contribution: ",e.jsx("span",{className:"text-cyan-400",children:d.contribution.toFixed(1)})]})]})}return null};return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Score Breakdown"}),e.jsx("div",{className:"h-64 mb-4",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Rt,{data:s,layout:"vertical",margin:{top:5,right:20,left:100,bottom:5},children:[e.jsx(he,{type:"number",domain:[0,100],tick:{fill:"#9ca3af",fontSize:12},axisLine:{stroke:"#4b5563"},tickLine:{stroke:"#4b5563"}}),e.jsx(ce,{type:"category",dataKey:"name",tick:{fill:"#9ca3af",fontSize:11},axisLine:{stroke:"#4b5563"},tickLine:{stroke:"#4b5563"},width:95}),e.jsx(te,{content:e.jsx(r,{})}),e.jsx(Lt,{dataKey:"value",radius:[0,4,4,0],children:s.map((i,n)=>e.jsx(ct,{fill:a(i.value)},`cell-${n}`))})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left py-2 text-gray-400 font-medium",children:"Factor"}),e.jsx("th",{className:"text-right py-2 text-gray-400 font-medium",children:"Score"}),e.jsx("th",{className:"text-right py-2 text-gray-400 font-medium",children:"Weight"}),e.jsx("th",{className:"text-right py-2 text-gray-400 font-medium",children:"Contribution"})]})}),e.jsxs("tbody",{children:[t.factor_scores.map((i,n)=>e.jsxs("tr",{className:"border-b border-gray-700/50",children:[e.jsx("td",{className:"py-2 text-white",children:i.factor_name}),e.jsx("td",{className:"py-2 text-right text-gray-300",children:i.normalized_value.toFixed(1)}),e.jsxs("td",{className:"py-2 text-right text-gray-400",children:[(i.weight*100).toFixed(0),"%"]}),e.jsx("td",{className:"py-2 text-right text-cyan-400 font-medium",children:i.contribution.toFixed(1)})]},n)),e.jsxs("tr",{className:"font-medium",children:[e.jsx("td",{className:"py-2 text-white",children:"Total"}),e.jsx("td",{className:"py-2 text-right text-white",children:t.effective_risk_score.toFixed(1)}),e.jsx("td",{className:"py-2 text-right text-gray-400",children:"100%"}),e.jsx("td",{className:"py-2 text-right text-cyan-400",children:t.factor_scores.reduce((i,n)=>i+n.contribution,0).toFixed(1)})]})]})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-900/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Remediation Effort"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Estimated Hours:"}),e.jsxs("span",{className:"ml-2 text-white font-medium",children:[t.estimated_effort.estimated_hours,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Effort Level:"}),e.jsx("span",{className:"ml-2 text-white font-medium capitalize",children:t.estimated_effort.effort_level.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Impact Level:"}),e.jsx("span",{className:"ml-2 text-white font-medium capitalize",children:t.estimated_effort.impact_level})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[t.estimated_effort.requires_downtime&&e.jsx("span",{className:"text-red-400 text-xs",children:"Requires Downtime"}),t.estimated_effort.requires_testing&&e.jsx("span",{className:"text-yellow-400 text-xs",children:"Requires Testing"})]})]})]})]})},Ir=({onConfigUpdate:t})=>{const[s,a]=l.useState(null),[r,i]=l.useState(!0),[n,d]=l.useState(!1),[m,c]=l.useState({cvss_weight:.25,exploit_weight:.2,asset_criticality_weight:.15,network_exposure_weight:.15,attack_path_weight:.1,compliance_weight:.08,business_context_weight:.07}),f={cvss_weight:.25,exploit_weight:.2,asset_criticality_weight:.15,network_exposure_weight:.15,attack_path_weight:.1,compliance_weight:.08,business_context_weight:.07};l.useEffect(()=>{N()},[]);const N=async()=>{try{i(!0);const F=await Ct.getConfig();a(F.data),c(F.data.weights)}catch(F){console.error("Failed to load AI config:",F),D.error("Failed to load AI configuration")}finally{i(!1)}},j=(F,y)=>{c(p=>({...p,[F]:y}))},o=async()=>{try{d(!0),await Ct.updateConfig({weights:m}),D.success("AI configuration updated"),t&&t()}catch(F){console.error("Failed to save AI config:",F),D.error("Failed to save configuration")}finally{d(!1)}},g=()=>{c(f),D.info("Weights reset to defaults")},b=()=>Object.values(m).reduce((F,y)=>F+y,0),w={cvss_weight:"CVSS Score",exploit_weight:"Exploit Availability",asset_criticality_weight:"Asset Criticality",network_exposure_weight:"Network Exposure",attack_path_weight:"Attack Path Risk",compliance_weight:"Compliance Impact",business_context_weight:"Business Context"},$={cvss_weight:"Base vulnerability severity from CVE database",exploit_weight:"Whether exploits exist in the wild",asset_criticality_weight:"Importance of the affected asset",network_exposure_weight:"Internet-facing vs internal exposure",attack_path_weight:"Position in potential attack chains",compliance_weight:"Impact on regulatory compliance",business_context_weight:"Overall business risk context"};return r?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"})}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Sa,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"AI Scoring Configuration"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(Q,{variant:"secondary",size:"sm",onClick:g,children:[e.jsx(_a,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsxs(Q,{variant:"primary",size:"sm",onClick:o,loading:n,children:[e.jsx(qt,{className:"w-4 h-4 mr-1"}),"Save"]})]})]}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Weight"}),e.jsxs("span",{className:`text-lg font-bold ${Math.abs(b()-1)<.01?"text-green-400":"text-yellow-400"}`,children:[(b()*100).toFixed(0),"%"]})]}),Math.abs(b()-1)>=.01&&e.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"Weights should sum to 100% for optimal scoring"})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(m).map(F=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white",children:w[F]}),e.jsx("p",{className:"text-xs text-gray-400",children:$[F]})]}),e.jsxs("span",{className:"text-sm font-mono text-cyan-400",children:[(m[F]*100).toFixed(0),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:m[F]*100,onChange:y=>j(F,parseInt(y.target.value)/100),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer
                         [&::-webkit-slider-thumb]:appearance-none
                         [&::-webkit-slider-thumb]:w-4
                         [&::-webkit-slider-thumb]:h-4
                         [&::-webkit-slider-thumb]:rounded-full
                         [&::-webkit-slider-thumb]:bg-cyan-500
                         [&::-webkit-slider-thumb]:cursor-pointer
                         [&::-webkit-slider-thumb]:transition-transform
                         [&::-webkit-slider-thumb]:hover:scale-110`})]},F))}),s&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Configuration Name:"}),e.jsx("span",{className:"ml-2 text-white",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Last Updated:"}),e.jsx("span",{className:"ml-2 text-white",children:new Date(s.updated_at).toLocaleString()})]})]})})]})},Br=({scanId:t,onSelectVulnerability:s})=>{const[a,r]=l.useState(null),[i,n]=l.useState(!1),[d,m]=l.useState(!1),[c,f]=l.useState(null),[N,j]=l.useState(!1),[o,g]=l.useState("list"),b=l.useCallback(async()=>{var p;try{n(!0);const h=await Ct.getScores(t);r(h.data)}catch(h){((p=h.response)==null?void 0:p.status)!==404&&console.error("Failed to load AI scores:",h)}finally{n(!1)}},[t]);l.useEffect(()=>{b()},[b]);const w=async(p=!1)=>{try{m(!0);const h=await Ct.prioritize(t,{force_recalculate:p});r(h.data),D.success("AI prioritization calculated successfully")}catch(h){console.error("Failed to calculate prioritization:",h),D.error("Failed to calculate AI prioritization")}finally{m(!1)}},$=p=>{const h=a==null?void 0:a.scores.find(S=>S.vulnerability_id===p);f(h||null),s&&s(p)},F=p=>[{name:"Critical",value:p.critical_count,color:"#ef4444"},{name:"High",value:p.high_count,color:"#f97316"},{name:"Medium",value:p.medium_count,color:"#eab308"},{name:"Low",value:p.low_count,color:"#22c55e"}].filter(h=>h.value>0),y=p=>{var S;return p.length===0?[]:(((S=p[0])==null?void 0:S.factor_scores.map(E=>E.factor_name))||[]).map(E=>{const P=p.reduce((O,C)=>{const _=C.factor_scores.find(u=>u.factor_name===E);return O+((_==null?void 0:_.normalized_value)||0)},0)/p.length;return{factor:E.replace(" ",`
`),value:P,fullMark:100}})};return i?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(kt,{className:"w-6 h-6 text-cyan-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"AI Vulnerability Prioritization"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a&&e.jsxs(Q,{variant:"secondary",size:"sm",onClick:()=>w(!0),loading:d,children:[e.jsx(et,{className:"w-4 h-4 mr-1"}),"Recalculate"]}),e.jsxs(Q,{variant:N?"primary":"secondary",size:"sm",onClick:()=>j(!N),children:[e.jsx(Kt,{className:"w-4 h-4 mr-1"}),"Configure"]})]})]}),N&&e.jsx(Ir,{onConfigUpdate:()=>w(!0)}),!a&&!i&&e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-8 text-center",children:[e.jsx(kt,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No AI Prioritization Data"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Calculate AI-based risk scores to prioritize vulnerabilities for remediation."}),e.jsxs(Q,{variant:"primary",onClick:()=>w(!1),loading:d,children:[e.jsx(kt,{className:"w-4 h-4 mr-2"}),"Calculate AI Prioritization"]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(G,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Critical"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:a.summary.critical_count})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(nt,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Avg Risk Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.summary.average_risk_score.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($t,{className:"w-5 h-5 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Highest Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:a.summary.highest_risk_score.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Dt,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Total Analyzed"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.summary.total_vulnerabilities})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Risk Distribution"}),e.jsx("div",{className:"h-48",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Qt,{data:F(a.summary),cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,paddingAngle:2,dataKey:"value",children:F(a.summary).map((p,h)=>e.jsx(ct,{fill:p.color},`cell-${h}`))}),e.jsx(te,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px"},itemStyle:{color:"#fff"}})]})})}),e.jsx("div",{className:"flex justify-center space-x-4 mt-2",children:F(a.summary).map(p=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:p.color}}),e.jsxs("span",{className:"text-xs text-gray-400",children:[p.name," (",p.value,")"]})]},p.name))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Average Factor Scores"}),e.jsx("div",{className:"h-48",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Ka,{data:y(a.scores),children:[e.jsx(qa,{stroke:"#374151"}),e.jsx(Za,{dataKey:"factor",tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(Ya,{angle:30,domain:[0,100],tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(Ja,{name:"Score",dataKey:"value",stroke:"#06b6d4",fill:"#06b6d4",fillOpacity:.3}),e.jsx(te,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px"},itemStyle:{color:"#fff"}})]})})})]})]}),e.jsxs("div",{className:"flex space-x-2 border-b border-gray-700",children:[e.jsx("button",{onClick:()=>g("list"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${o==="list"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:"Prioritized List"}),e.jsx("button",{onClick:()=>g("matrix"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${o==="matrix"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:"Impact vs Likelihood"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[o==="list"&&e.jsx(Or,{scores:a.scores,onSelectVulnerability:$,selectedId:c==null?void 0:c.vulnerability_id}),o==="matrix"&&e.jsx(Ur,{scores:a.scores})]}),e.jsx("div",{className:"lg:col-span-1",children:c?e.jsx(Vr,{score:c}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6 text-center",children:[e.jsx(it,{className:"w-8 h-8 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Select a vulnerability to view detailed score breakdown"})]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:["Last calculated: ",new Date(a.calculated_at).toLocaleString()]})]})]})},Ur=({scores:t})=>{const s=r=>{const i=r.factor_scores.find(c=>c.factor_name==="CVSS Score"),n=r.factor_scores.find(c=>c.factor_name==="Exploit Availability"),d=(i==null?void 0:i.normalized_value)||50,m=(n==null?void 0:n.normalized_value)||50;return{impact:d,likelihood:m}},a=r=>{switch(r.toLowerCase()){case"critical":return"#ef4444";case"high":return"#f97316";case"medium":return"#eab308";case"low":return"#22c55e";default:return"#6b7280"}};return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Impact vs Likelihood Matrix"}),e.jsxs("div",{className:"relative w-full h-80 border border-gray-700 rounded-lg bg-gray-900/50",children:[e.jsx("div",{className:"absolute inset-0 grid grid-cols-5 grid-rows-5",children:Array.from({length:25}).map((r,i)=>{const n=Math.floor(i/5),d=i%5;let m="bg-gray-800/20";const c=(d+(4-n))/8;return c>.7?m="bg-red-500/10":c>.5?m="bg-orange-500/10":c>.3?m="bg-yellow-500/10":m="bg-green-500/10",e.jsx("div",{className:`border-r border-b border-gray-700/50 ${m}`},i)})}),e.jsx("div",{className:"absolute -bottom-6 inset-x-0 text-center text-xs text-gray-400",children:"Likelihood (Exploit Availability) "}),e.jsx("div",{className:"absolute -left-6 inset-y-0 flex items-center text-xs text-gray-400",style:{writingMode:"vertical-rl",transform:"rotate(180deg)"},children:"Impact (CVSS Score) "}),t.map(r=>{const{impact:i,likelihood:n}=s(r),d=n/100*100,m=i/100*100;return e.jsx("div",{className:"absolute w-3 h-3 rounded-full transform -translate-x-1/2 translate-y-1/2 cursor-pointer hover:scale-150 transition-transform",style:{left:`${d}%`,bottom:`${m}%`,backgroundColor:a(r.risk_category)},title:`Priority #${r.remediation_priority} - Score: ${r.effective_risk_score.toFixed(1)}`},r.vulnerability_id)})]}),e.jsx("div",{className:"flex justify-center space-x-4 mt-6",children:["critical","high","medium","low"].map(r=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a(r)}}),e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:r})]},r))})]})},Wr=()=>{const{activeScan:t,results:s}=ue(),[a,r]=l.useState(!1),[i,n]=l.useState(null),[d,m]=l.useState(""),[c,f]=l.useState("risk"),[N,j]=l.useState("all"),[o,g]=l.useState(!1),[b,w]=l.useState(!1),[$,F]=l.useState(!1),[y,p]=l.useState(0),[h,S]=l.useState("results"),[E,P]=l.useState(!1),[O,C]=l.useState([]),[_,u]=l.useState([]),[v,A]=l.useState(!1),[V,k]=l.useState(!1),R=t?s.get(t.id)||[]:[];l.useEffect(()=>{t&&t.status==="completed"&&R.length===0&&Se(),t&&(U(),ge())},[t]);const U=async()=>{if(t)try{const T=await me.getTagsForScan(t.id);C(T.data)}catch(T){console.error("Failed to load scan tags:",T)}},ge=async()=>{try{const T=await me.getAll();u(T.data)}catch(T){console.error("Failed to load all tags:",T)}},L=async T=>{if(t)try{const H=await me.addTagsToScan(t.id,{tag_ids:[T]});C(H.data),A(!1),D.success("Tag added")}catch{D.error("Failed to add tag")}},B=async T=>{if(t)try{await me.removeTagFromScan(t.id,T),C(O.filter(H=>H.id!==T)),D.success("Tag removed")}catch{D.error("Failed to remove tag")}},Z=async()=>{if(t){k(!0);try{const T=await je.duplicate(t.id);D.success(`Scan duplicated as "${T.data.name}"`),ue.getState().setActiveScan(T.data)}catch{D.error("Failed to duplicate scan")}finally{k(!1)}}},Y=_.filter(T=>!O.some(H=>H.id===T.id)),Se=async()=>{if(t){r(!0);try{const T=await je.getResults(t.id);ue.getState().setResults(t.id,T.data)}catch{D.error("Failed to load scan results")}finally{r(!1)}}},Re=async()=>{var T,H,W;if(t){P(!0);try{const I=await Va.exportScan(t.id);I.data.success?D.success(`Exported ${I.data.events_count} events to ${I.data.exported_to} SIEM integration(s)`):D.warning("Export completed with issues. Check SIEM settings."),I.data.errors&&I.data.errors.length>0&&I.data.errors.forEach(ne=>{D.error(`SIEM export error: ${ne}`)})}catch(I){const ne=I;((T=ne.response)==null?void 0:T.status)===404?D.error("No SIEM integrations configured. Go to Settings > SIEM Integration to set up."):D.error(((W=(H=ne.response)==null?void 0:H.data)==null?void 0:W.error)||"Failed to export to SIEM")}finally{P(!1)}}},de=l.useMemo(()=>{let T=[...R];switch(d&&(T=T.filter(H=>{var W;return H.target.ip.includes(d)||((W=H.target.hostname)==null?void 0:W.toLowerCase().includes(d.toLowerCase()))})),N){case"with-vulns":T=T.filter(H=>H.vulnerabilities.length>0);break;case"critical":T=T.filter(H=>H.vulnerabilities.some(W=>W.severity==="Critical"));break;case"high":T=T.filter(H=>H.vulnerabilities.some(W=>W.severity==="Critical"||W.severity==="High"));break}return T.sort((H,W)=>{switch(c){case"risk":return Vt(W)-Vt(H);case"vulns":return W.vulnerabilities.length-H.vulnerabilities.length;case"ports":return W.ports.filter(I=>I.state==="Open").length-H.ports.filter(I=>I.state==="Open").length;case"ip":default:return H.target.ip.localeCompare(W.target.ip)}}),T},[R,d,c,N]);if(!t)return e.jsx(z,{children:e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Select a scan from the list to view results"})});if(a)return e.jsx(z,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ye,{})})});if(R.length===0)return e.jsx(z,{children:e.jsx("div",{className:"text-center py-12 text-slate-500",children:t.status==="running"?"Scan in progress... Results will appear here as hosts are discovered":t.status==="pending"?"Scan is pending...":t.status==="failed"?`Scan failed: ${t.error_message||"Unknown error"}`:"No results available"})});const q=R.filter(T=>T.is_alive).length,J=R.reduce((T,H)=>T+H.ports.filter(W=>W.state==="Open").length,0),ae=R.reduce((T,H)=>T+H.vulnerabilities.length,0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(z,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t==null?void 0:t.name}),e.jsxs("button",{onClick:Z,disabled:V,className:"flex items-center gap-1 px-3 py-1.5 text-sm border border-dark-border rounded hover:border-primary hover:text-primary transition-colors disabled:opacity-50",title:"Duplicate this scan",children:[V?e.jsx(ye,{className:"h-4 w-4"}):e.jsx(At,{className:"h-4 w-4"}),"Duplicate"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsx(rt,{className:"h-4 w-4 text-slate-400"}),O.map(T=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:T.color+"20",color:T.color},children:[T.name,e.jsx("button",{onClick:()=>B(T.id),className:"hover:opacity-70",title:"Remove tag",children:e.jsx(ve,{className:"h-3 w-3"})})]},T.id)),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>A(!v),className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm border border-dashed border-dark-border text-slate-400 hover:border-primary hover:text-primary",children:[e.jsx(Ie,{className:"h-3 w-3"}),"Add Tag"]}),v&&Y.length>0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-10 bg-dark-surface border border-dark-border rounded-lg shadow-lg min-w-[150px] max-h-[200px] overflow-y-auto",children:Y.map(T=>e.jsxs("button",{onClick:()=>L(T.id),className:"w-full text-left px-3 py-2 hover:bg-dark-hover flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:T.color}}),e.jsx("span",{className:"text-sm text-slate-300",children:T.name})]},T.id))}),v&&Y.length===0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-10 bg-dark-surface border border-dark-border rounded-lg shadow-lg p-3",children:e.jsx("span",{className:"text-sm text-slate-500",children:"No more tags available"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx(ke,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:q}),e.jsx("p",{className:"text-sm text-slate-400",children:"Alive Hosts"})]}),e.jsxs("div",{children:[e.jsx(K,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:J}),e.jsx("p",{className:"text-sm text-slate-400",children:"Open Ports"})]}),e.jsxs("div",{children:[e.jsx(G,{className:"h-8 w-8 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:ae}),e.jsx("p",{className:"text-sm text-slate-400",children:"Vulnerabilities"})]})]})]}),e.jsx(z,{children:e.jsxs("div",{className:"flex gap-2 border-b border-dark-border pb-2",children:[e.jsxs("button",{onClick:()=>S("results"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="results"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(Ca,{className:"h-4 w-4"}),"Results"]}),e.jsxs("button",{onClick:()=>S("topology"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="topology"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(Gt,{className:"h-4 w-4"}),"Topology"]}),e.jsxs("button",{onClick:()=>S("secrets"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="secrets"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(Ue,{className:"h-4 w-4"}),"Secrets"]}),e.jsxs("button",{onClick:()=>S("ai-priority"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="ai-priority"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(kt,{className:"h-4 w-4"}),"AI Priority"]})]})}),h==="topology"&&t&&e.jsx(Mr,{scanId:t.id}),h==="secrets"&&t&&e.jsxs(z,{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5 text-yellow-400"}),"Exposed Secrets"]}),e.jsx(zr,{scanId:t.id})]}),h==="ai-priority"&&t&&e.jsx(z,{children:e.jsx(Br,{scanId:t.id})}),h==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(re,{type:"text",placeholder:"Search by IP or hostname...",value:d,onChange:T=>m(T.target.value),icon:e.jsx(Tt,{className:"h-4 w-4"})})}),e.jsx(Dr,{hosts:de,scanName:t==null?void 0:t.name,scanId:t==null?void 0:t.id,disabled:de.length===0}),e.jsxs("button",{onClick:()=>F(!0),disabled:(t==null?void 0:t.status)!=="completed",className:"px-4 py-2 rounded-lg border border-green-500 text-green-500 hover:bg-green-500/10 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ns,{className:"h-4 w-4"}),"Compliance"]}),e.jsxs("button",{onClick:Re,disabled:(t==null?void 0:t.status)!=="completed"||E,className:"px-4 py-2 rounded-lg border border-purple-500 text-purple-500 hover:bg-purple-500/10 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Export scan results to configured SIEM integrations",children:[E?e.jsx(ye,{}):e.jsx($a,{className:"h-4 w-4"}),E?"Exporting...":"SIEM"]}),e.jsxs("button",{onClick:()=>w(!0),disabled:(t==null?void 0:t.status)!=="completed",className:"px-4 py-2 rounded-lg border border-primary text-primary hover:bg-primary/10 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(oe,{className:"h-4 w-4"}),"Report"]}),e.jsxs("button",{onClick:()=>g(!o),className:`px-4 py-2 rounded-lg border transition-colors flex items-center gap-2 ${o?"bg-primary border-primary text-white":"border-dark-border text-slate-400 hover:border-primary hover:text-white"}`,children:[e.jsx(Fa,{className:"h-4 w-4"}),"Filters"]})]}),o&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-dark-border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Sort by"}),e.jsxs("select",{value:c,onChange:T=>f(T.target.value),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"risk",children:"Risk Score (High to Low)"}),e.jsx("option",{value:"vulns",children:"Vulnerability Count"}),e.jsx("option",{value:"ports",children:"Port Count"}),e.jsx("option",{value:"ip",children:"IP Address"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Filter by"}),e.jsxs("select",{value:N,onChange:T=>j(T.target.value),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Hosts"}),e.jsx("option",{value:"with-vulns",children:"With Vulnerabilities"}),e.jsx("option",{value:"high",children:"High/Critical Severity"}),e.jsx("option",{value:"critical",children:"Critical Only"})]})]})]}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Showing ",de.length," of ",R.length," hosts"]})]})}),e.jsxs(z,{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Discovered Hosts"}),e.jsxs("div",{className:"space-y-3",children:[de.map(T=>{const H=Vt(T),W=hr(H);return e.jsxs("div",{className:`bg-dark-bg border rounded-lg p-4 cursor-pointer hover:border-primary/50 transition-all ${W==="Critical"?"border-severity-critical":W==="High"?"border-severity-high":"border-dark-border"}`,onClick:()=>n(i===T.target.ip?null:T.target.ip),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-mono font-semibold",children:T.target.ip}),T.target.hostname&&e.jsx("p",{className:"text-sm text-slate-400",children:T.target.hostname})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ie,{variant:"severity",type:ws(W),children:["Risk: ",H]}),e.jsx(ie,{variant:"status",type:T.is_alive?"completed":"failed",children:T.is_alive?"Alive":"Down"}),T.ports.filter(I=>I.state==="Open").length>0&&e.jsxs("span",{className:"text-sm text-slate-400",children:[T.ports.filter(I=>I.state==="Open").length," ports"]}),T.vulnerabilities.length>0&&e.jsxs("span",{className:"text-sm text-red-400",children:[T.vulnerabilities.length," vulns"]})]})]}),i===T.target.ip&&e.jsxs("div",{className:"mt-4 border-t border-dark-border pt-4 space-y-4",children:[T.os_guess&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-1",children:"OS Detection"}),e.jsxs("p",{className:"text-sm text-slate-400",children:[T.os_guess.os_family," ",T.os_guess.os_version," (",T.os_guess.confidence,"% confidence)"]})]}),T.ports.filter(I=>I.state==="Open").length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Open Ports"}),e.jsx("div",{className:"space-y-2",children:T.ports.filter(I=>I.state==="Open").map(I=>{var ne,Ge;return e.jsx("div",{children:e.jsxs("div",{className:"bg-dark-surface rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-mono font-semibold",children:[I.port,"/",I.protocol]}),I.service&&e.jsxs("span",{className:"text-slate-400",children:[I.service.name," ",I.service.version&&e.jsxs("span",{className:"text-slate-500",children:["v",I.service.version]})]})]}),((ne=I.service)==null?void 0:ne.banner)&&e.jsx(br,{banner:I.service.banner,port:I.port,service:I.service.name}),((Ge=I.service)==null?void 0:Ge.ssl_info)&&e.jsx(Ar,{sslInfo:I.service.ssl_info,port:I.port})]})},I.port)})})]}),T.vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-slate-300 mb-3",children:["Vulnerabilities (",T.vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-3",children:T.vulnerabilities.map((I,ne)=>e.jsx(gr,{vulnerability:I},ne))})]})]})]},T.target.ip)}),de.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400",children:"No hosts match the current filters"})]})]}),(t==null?void 0:t.status)==="completed"&&e.jsx(Lr,{scanId:t.id,onGenerateNew:()=>w(!0)},y)]}),b&&t&&e.jsx(Rr,{scanId:t.id,scanName:t.name,onClose:()=>w(!1),onReportCreated:()=>p(T=>T+1)}),$&&t&&e.jsx(Pr,{scanId:t.id,scanName:t.name,onClose:()=>F(!1)})]})},vt=({title:t,value:s,icon:a,color:r,subtitle:i})=>e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:t}),e.jsx("p",{className:`text-3xl font-bold ${r} mb-1`,children:s}),i&&e.jsx("p",{className:"text-slate-500 text-xs",children:i})]}),e.jsx("div",{className:`${r.replace("text-","bg-")}/20 p-3 rounded-lg`,children:a})]})}),Gr=()=>{const{scans:t,results:s}=ue(),a=l.useMemo(()=>{const r=t.filter(n=>n.status==="completed"),i=Array.from(s.values()).flat();return{...pr(i),completedScans:r.length}},[t,s]);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(vt,{title:"Completed Scans",value:a.completedScans,icon:e.jsx(fe,{className:"h-6 w-6 text-primary"}),color:"text-primary",subtitle:`${t.filter(r=>r.status==="running").length} running`}),e.jsx(vt,{title:"Hosts Discovered",value:a.totalHosts,icon:e.jsx(ke,{className:"h-6 w-6 text-blue-400"}),color:"text-blue-400",subtitle:`${a.totalPorts} open ports`}),e.jsx(vt,{title:"Total Vulnerabilities",value:a.totalVulnerabilities,icon:e.jsx(G,{className:"h-6 w-6 text-yellow-400"}),color:"text-yellow-400",subtitle:"Across all scans"}),e.jsx(vt,{title:"Critical Findings",value:a.criticalVulnerabilities,icon:e.jsx(K,{className:"h-6 w-6 text-severity-critical"}),color:"text-severity-critical",subtitle:"Requires immediate attention"})]})},Kr={Critical:"#ef4444",High:"#f97316",Medium:"#eab308",Low:"#3b82f6"},qr=({hosts:t})=>{const s=l.useMemo(()=>{const r=Ss(t);return Object.entries(r).filter(([i,n])=>n>0).map(([i,n])=>({name:i,value:n,color:Kr[i]}))},[t]),a=s.reduce((r,i)=>r+i.value,0);return a===0?e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerability Distribution"}),e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No vulnerabilities found"})})]}):e.jsxs(z,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Vulnerability Distribution",e.jsxs("span",{className:"text-sm font-normal text-slate-400 ml-2",children:["(",a," total)"]})]}),e.jsx(ee,{width:"100%",height:300,children:e.jsxs(Jt,{children:[e.jsx(Qt,{data:s,cx:"50%",cy:"50%",labelLine:!1,label:({name:r,percent:i})=>`${r}: ${(i*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:s.map((r,i)=>e.jsx(ct,{fill:r.color},`cell-${i}`))}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},formatter:r=>[`${r} vulnerabilities`,"Count"]}),e.jsx(at,{verticalAlign:"bottom",height:36,formatter:(r,i)=>e.jsxs("span",{style:{color:"#cbd5e1"},children:[r,": ",i.payload.value]})})]})})]})},Zr={21:"#f97316",22:"#22c55e",23:"#ef4444",25:"#3b82f6",53:"#8b5cf6",80:"#06b6d4",110:"#3b82f6",143:"#3b82f6",443:"#10b981",445:"#f59e0b",3306:"#ec4899",3389:"#ef4444",5432:"#3b82f6",8080:"#06b6d4"},Yr="#64748b",Jr=({hosts:t})=>{const s=l.useMemo(()=>ur(t).map(a=>({...a,displayName:`${a.port} (${a.service})`,color:Zr[a.port]||Yr})),[t]);return s.length===0?e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Port Distribution"}),e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No open ports found"})})]}):e.jsxs(z,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Top Open Ports",e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-2",children:"(Across all hosts)"})]}),e.jsx(ee,{width:"100%",height:300,children:e.jsxs(Rt,{data:s,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{type:"number",stroke:"#cbd5e1"}),e.jsx(ce,{dataKey:"displayName",type:"category",width:90,stroke:"#cbd5e1",tick:{fontSize:12}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},formatter:(a,r,i)=>[`${a} hosts`,i.payload.service],labelFormatter:a=>{var r;return`Port ${(r=s.find(i=>i.displayName===a))==null?void 0:r.port}`}}),e.jsx(Lt,{dataKey:"count",radius:[0,4,4,0],children:s.map((a,r)=>e.jsx(ct,{fill:a.color},`cell-${r}`))})]})})]})},It=({title:t,value:s,subtitle:a,icon:r,color:i,trend:n})=>e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:t}),e.jsx("p",{className:`text-3xl font-bold ${i} mb-1`,children:s}),a&&e.jsx("p",{className:"text-slate-500 text-xs",children:a}),n&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs ${n.isPositive?"text-green-400":"text-red-400"}`,children:[e.jsx(nt,{className:`h-3 w-3 ${!n.isPositive&&"rotate-180"}`}),e.jsxs("span",{children:[n.isPositive?"+":"",n.value.toFixed(1),"%"]})]})]}),e.jsx("div",{className:`${i.replace("text-","bg-")}/20 p-3 rounded-lg`,children:r})]})}),Qr=({height:t=300})=>e.jsx("div",{className:"animate-pulse",style:{height:t},children:e.jsx("div",{className:"h-full bg-slate-700/50 rounded-lg"})}),xe={critical:"#ef4444",high:"#f97316",medium:"#eab308",low:"#3b82f6"},Xr=()=>{const[t,s]=l.useState(30),[a,r]=l.useState(!0),[i,n]=l.useState(null),[d,m]=l.useState(null);l.useEffect(()=>{c()},[t]);const c=async()=>{var p,h;r(!0),n(null);try{const S=await Oe.getVulnerabilityTrendsDashboard(t);m(S.data)}catch(S){const E=S;console.error("Failed to load vulnerability trends:",S),n(((h=(p=E.response)==null?void 0:p.data)==null?void 0:h.message)||"Failed to load vulnerability trends")}finally{r(!1)}},f=p=>{if(p.includes("-W")){const[S,E]=p.split("-W");return`W${E}`}return new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric"})},N=p=>{switch(p){case"improving":return e.jsx(Aa,{className:"h-5 w-5 text-green-400"});case"declining":return e.jsx(nt,{className:"h-5 w-5 text-red-400"});default:return e.jsx(Ta,{className:"h-5 w-5 text-yellow-400"})}},j=p=>{switch(p){case"improving":return"text-green-400";case"declining":return"text-red-400";default:return"text-yellow-400"}},o=p=>{switch(p){case"improving":return"Improving";case"declining":return"Declining";default:return"Stable"}};if(a)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-64 bg-slate-700 rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-4 w-48 bg-slate-700 rounded animate-pulse"})]}),e.jsx("div",{className:"h-10 w-72 bg-slate-700 rounded animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(p=>e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 w-24 bg-slate-700 rounded mb-3"}),e.jsx("div",{className:"h-8 w-16 bg-slate-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-32 bg-slate-700 rounded"})]})},p))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[1,2,3,4].map(p=>e.jsxs(z,{className:"p-6",children:[e.jsx("div",{className:"h-6 w-48 bg-slate-700 rounded animate-pulse mb-4"}),e.jsx(Qr,{})]},p))})]});if(i)return e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"h-12 w-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Failed to Load Vulnerability Trends"}),e.jsx("p",{className:"text-slate-400 mb-4",children:i}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors",children:"Retry"})]})});if(!d)return null;const{summary:g,daily_counts:b,severity_trends:w,remediation_rates:$,top_recurring:F}=d,y=[{name:"Critical",value:g.critical_open,color:xe.critical},{name:"High",value:g.high_open,color:xe.high},{name:"Medium",value:g.current_open-g.critical_open-g.high_open,color:xe.medium}].filter(p=>p.value>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Vulnerability Trends"}),e.jsx("p",{className:"text-slate-400",children:"Historical analysis and remediation metrics"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-slate-800 border border-slate-700 rounded-lg p-1",children:[7,30,90,180].map(p=>e.jsxs("button",{onClick:()=>s(p),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${t===p?"bg-cyan-600 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:[e.jsx(Be,{className:"h-4 w-4"}),p,"d"]},p))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(It,{title:"Current Open",value:g.current_open,subtitle:`${g.critical_open} critical, ${g.high_open} high`,icon:e.jsx(_t,{className:"h-6 w-6 text-yellow-400"}),color:"text-yellow-400"}),e.jsx(It,{title:"Remediation Rate",value:`${g.remediation_rate.toFixed(1)}%`,subtitle:`${g.total_resolved} of ${g.total_found} resolved`,icon:e.jsx(se,{className:"h-6 w-6 text-green-400"}),color:"text-green-400"}),e.jsx(It,{title:"Avg. MTTR",value:`${g.avg_mttr_days.toFixed(1)}`,subtitle:"Days to remediate",icon:e.jsx(pe,{className:"h-6 w-6 text-blue-400"}),color:"text-blue-400"}),e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:"Trend"}),e.jsxs("div",{className:"flex items-center gap-2",children:[N(g.trend_direction),e.jsx("span",{className:`text-2xl font-bold ${j(g.trend_direction)}`,children:o(g.trend_direction)})]}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"Compared to previous period"})]}),e.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg",children:e.jsx(K,{className:"h-6 w-6 text-slate-400"})})]})})]}),(g.critical_open>0||g.high_open>0)&&e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Critical Issues Requiring Attention"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Critical"}),e.jsx(we,{className:"h-4 w-4 text-red-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:g.critical_open})]}),e.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"High"}),e.jsx(G,{className:"h-4 w-4 text-orange-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:g.high_open})]}),e.jsxs("div",{className:"bg-slate-700/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Total Found"}),e.jsx(_t,{className:"h-4 w-4 text-slate-400"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:g.total_found})]}),e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Resolved"}),e.jsx(se,{className:"h-4 w-4 text-green-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:g.total_resolved})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerabilities Over Time"}),b.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(lt,{data:b,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{dataKey:"date",tickFormatter:f,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:f}),e.jsx(at,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(Ae,{type:"monotone",dataKey:"open",stroke:"#f97316",strokeWidth:2,dot:{fill:"#f97316",r:3},activeDot:{r:5},name:"Open"}),e.jsx(Ae,{type:"monotone",dataKey:"new",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:3},activeDot:{r:5},name:"New"}),e.jsx(Ae,{type:"monotone",dataKey:"resolved",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e",r:3},activeDot:{r:5},name:"Resolved"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Severity Distribution Over Time"}),w.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(ks,{data:w,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{dataKey:"date",tickFormatter:f,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:f}),e.jsx(at,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(De,{type:"monotone",dataKey:"critical",stackId:"1",stroke:xe.critical,fill:xe.critical,fillOpacity:.6,name:"Critical"}),e.jsx(De,{type:"monotone",dataKey:"high",stackId:"1",stroke:xe.high,fill:xe.high,fillOpacity:.6,name:"High"}),e.jsx(De,{type:"monotone",dataKey:"medium",stackId:"1",stroke:xe.medium,fill:xe.medium,fillOpacity:.6,name:"Medium"}),e.jsx(De,{type:"monotone",dataKey:"low",stackId:"1",stroke:xe.low,fill:xe.low,fillOpacity:.6,name:"Low"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Remediation Rate Over Time"}),$.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(lt,{data:$,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{dataKey:"date",tickFormatter:f,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{yAxisId:"left",stroke:"#94a3b8",style:{fontSize:"12px"},domain:[0,100],tickFormatter:p=>`${p}%`}),e.jsx(ce,{yAxisId:"right",orientation:"right",stroke:"#94a3b8",style:{fontSize:"12px"},tickFormatter:p=>`${p}d`}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:f,formatter:(p,h)=>h==="Remediation Rate"?[`${p.toFixed(1)}%`,h]:h==="MTTR (days)"?[`${p.toFixed(1)} days`,h]:[p,h]}),e.jsx(at,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(Ae,{yAxisId:"left",type:"monotone",dataKey:"remediation_rate",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e",r:3},activeDot:{r:5},name:"Remediation Rate"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"mttr_days",stroke:"#06b6d4",strokeWidth:2,dot:{fill:"#06b6d4",r:3},activeDot:{r:5},name:"MTTR (days)"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Top Recurring Vulnerabilities"}),F.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(Rt,{data:F,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{type:"number",stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{dataKey:"title",type:"category",stroke:"#94a3b8",style:{fontSize:"11px"},width:140,tickFormatter:p=>p.length>20?`${p.substring(0,20)}...`:p}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},content:({active:p,payload:h})=>{if(!p||!h||!h[0])return null;const S=h[0].payload;return e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3 text-white text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:S.title}),e.jsxs("div",{className:"space-y-1 text-slate-300",children:[e.jsxs("div",{children:["Occurrences: ",S.count]}),e.jsxs("div",{children:["Severity: ",S.severity]}),e.jsxs("div",{children:["Affected Hosts: ",S.affected_hosts]}),S.avg_resolution_days!==null&&e.jsxs("div",{children:["Avg Resolution: ",S.avg_resolution_days.toFixed(1)," days"]})]})]})}}),e.jsx(Lt,{dataKey:"count",fill:"#06b6d4",radius:[0,4,4,0],name:"Occurrences"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No recurring vulnerabilities found"})})]})]}),y.length>0&&e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Current Open Vulnerabilities by Severity"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(ee,{width:"100%",height:250,children:e.jsxs(Jt,{children:[e.jsx(Qt,{data:y,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",nameKey:"name",label:({name:p,percent:h})=>`${p} ${(h*100).toFixed(0)}%`,labelLine:!1,children:y.map((p,h)=>e.jsx(ct,{fill:p.color},`cell-${h}`))}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"}})]})}),e.jsxs("div",{className:"flex flex-col justify-center space-y-4",children:[y.map(p=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:p.color}}),e.jsx("span",{className:"text-slate-300",children:p.name})]}),e.jsx("span",{className:"text-white font-semibold",children:p.value})]},p.name)),e.jsx("div",{className:"border-t border-slate-700 pt-4 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-300 font-medium",children:"Total Open"}),e.jsx("span",{className:"text-white font-bold text-lg",children:g.current_open})]})})]})]})]}),F.length>0&&e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Recurring Vulnerability Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Vulnerability"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Severity"}),e.jsx("th",{className:"text-center py-3 px-4 text-slate-400 font-medium",children:"Occurrences"}),e.jsx("th",{className:"text-center py-3 px-4 text-slate-400 font-medium",children:"Affected Hosts"}),e.jsx("th",{className:"text-center py-3 px-4 text-slate-400 font-medium",children:"Avg. Resolution"})]})}),e.jsx("tbody",{children:F.map((p,h)=>e.jsxs("tr",{className:"border-b border-slate-700/50 hover:bg-slate-800/50",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("span",{className:"text-white font-medium",children:p.title}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:p.vulnerability_id})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${p.severity==="critical"?"bg-red-500/20 text-red-400":p.severity==="high"?"bg-orange-500/20 text-orange-400":p.severity==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-blue-500/20 text-blue-400"}`,children:p.severity})}),e.jsx("td",{className:"py-3 px-4 text-center text-white",children:p.count}),e.jsx("td",{className:"py-3 px-4 text-center text-white",children:p.affected_hosts}),e.jsx("td",{className:"py-3 px-4 text-center text-white",children:p.avg_resolution_days!==null?`${p.avg_resolution_days.toFixed(1)} days`:"-"})]},h))})]})})]})]})},Nt=({title:t,value:s,subtitle:a,icon:r,color:i,trend:n})=>e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:t}),e.jsx("p",{className:`text-3xl font-bold ${i} mb-1`,children:s}),a&&e.jsx("p",{className:"text-slate-500 text-xs",children:a}),n&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs ${n.isPositive?"text-green-400":"text-red-400"}`,children:[e.jsx(nt,{className:`h-3 w-3 ${!n.isPositive&&"rotate-180"}`}),e.jsxs("span",{children:[n.isPositive?"+":"",n.value,"%"]})]})]}),e.jsx("div",{className:`${i.replace("text-","bg-")}/20 p-3 rounded-lg`,children:r})]})}),el=()=>{const[t,s]=l.useState("overview"),[a,r]=l.useState(30),[i,n]=l.useState(!0),[d,m]=l.useState(null),[c,f]=l.useState(null),[N,j]=l.useState([]),[o,g]=l.useState([]),[b,w]=l.useState([]),[$,F]=l.useState([]);l.useEffect(()=>{t==="overview"&&y()},[a,t]);const y=async()=>{var S,E;n(!0),m(null);try{const[P,O,C,_,u]=await Promise.all([Oe.getSummary(a),Oe.getHosts(a),Oe.getVulnerabilities(a),Oe.getServices(10),Oe.getFrequency(a)]);f(P.data),j(O.data),g(C.data),w(_.data),F(u.data)}catch(P){const O=P;console.error("Failed to load analytics:",P),m(((E=(S=O.response)==null?void 0:S.data)==null?void 0:E.message)||"Failed to load analytics data")}finally{n(!1)}},p=S=>new Date(S).toLocaleDateString("en-US",{month:"short",day:"numeric"}),h=()=>e.jsxs("div",{className:"flex gap-2 border-b border-slate-700 pb-2 mb-6",children:[e.jsxs("button",{onClick:()=>s("overview"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${t==="overview"?"bg-slate-800 text-cyan-400 border-b-2 border-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-800/50"}`,children:[e.jsx(Dt,{className:"h-4 w-4"}),"Overview"]}),e.jsxs("button",{onClick:()=>s("vulnerability-trends"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${t==="vulnerability-trends"?"bg-slate-800 text-cyan-400 border-b-2 border-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-800/50"}`,children:[e.jsx(_t,{className:"h-4 w-4"}),"Vulnerability Trends"]})]});return t==="vulnerability-trends"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx(Xr,{})]}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(ye,{size:"lg"})})]}):d?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"h-12 w-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Failed to Load Analytics"}),e.jsx("p",{className:"text-slate-400 mb-4",children:d}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors",children:"Retry"})]})})]}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-slate-400",children:"Insights and trends from your security scans"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-dark-surface border border-dark-border rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>r(7),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${a===7?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(Be,{className:"h-4 w-4"}),"7 Days"]}),e.jsxs("button",{onClick:()=>r(30),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${a===30?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(Be,{className:"h-4 w-4"}),"30 Days"]}),e.jsxs("button",{onClick:()=>r(90),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${a===90?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(Be,{className:"h-4 w-4"}),"90 Days"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Nt,{title:"Total Scans",value:c.total_scans,subtitle:`${c.scans_this_week} this week`,icon:e.jsx(fe,{className:"h-6 w-6 text-primary"}),color:"text-primary"}),e.jsx(Nt,{title:"Hosts Discovered",value:c.total_hosts,subtitle:`${c.total_ports} open ports`,icon:e.jsx(ke,{className:"h-6 w-6 text-blue-400"}),color:"text-blue-400"}),e.jsx(Nt,{title:"Total Vulnerabilities",value:c.total_vulnerabilities,subtitle:`${c.critical_vulns} critical`,icon:e.jsx(G,{className:"h-6 w-6 text-yellow-400"}),color:"text-yellow-400"}),e.jsx(Nt,{title:"Critical Findings",value:c.critical_vulns,subtitle:"Requires immediate attention",icon:e.jsx(K,{className:"h-6 w-6 text-severity-critical"}),color:"text-severity-critical"})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerability Severity Breakdown"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Critical"}),e.jsx(K,{className:"h-4 w-4 text-severity-critical"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-critical",children:c.critical_vulns})]}),e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"High"}),e.jsx(K,{className:"h-4 w-4 text-severity-high"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-high",children:c.high_vulns})]}),e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Medium"}),e.jsx(K,{className:"h-4 w-4 text-severity-medium"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-medium",children:c.medium_vulns})]}),e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Low"}),e.jsx(K,{className:"h-4 w-4 text-severity-low"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-low",children:c.low_vulns})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Hosts Discovered Over Time"}),N.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(lt,{data:N,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{dataKey:"date",tickFormatter:p,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:p}),e.jsx(Ae,{type:"monotone",dataKey:"value",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"Hosts"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Scan Frequency"}),$.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(lt,{data:$,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{dataKey:"date",tickFormatter:p,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:p}),e.jsx(Ae,{type:"monotone",dataKey:"value",stroke:"#8b5cf6",strokeWidth:2,dot:{fill:"#8b5cf6",r:4},activeDot:{r:6},name:"Scans"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerability Trends by Severity"}),o.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(ks,{data:o,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{dataKey:"date",tickFormatter:p,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:p}),e.jsx(at,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(De,{type:"monotone",dataKey:"critical",stackId:"1",stroke:"#ef4444",fill:"#ef4444",fillOpacity:.6,name:"Critical"}),e.jsx(De,{type:"monotone",dataKey:"high",stackId:"1",stroke:"#f97316",fill:"#f97316",fillOpacity:.6,name:"High"}),e.jsx(De,{type:"monotone",dataKey:"medium",stackId:"1",stroke:"#eab308",fill:"#eab308",fillOpacity:.6,name:"Medium"}),e.jsx(De,{type:"monotone",dataKey:"low",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Low"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Top Services Discovered"}),b.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(Rt,{data:b,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(he,{type:"number",stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(ce,{dataKey:"service",type:"category",stroke:"#94a3b8",style:{fontSize:"12px"},width:100}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"}}),e.jsx(Lt,{dataKey:"count",fill:"#06b6d4",radius:[0,4,4,0],name:"Count"})]})}):e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No data available"})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center h-96 text-slate-400",children:"No data available"})]})};var tl=Ga();const sl=sa(tl),$e=({title:t,icon:s,children:a,onRemove:r,className:i=""})=>e.jsxs("div",{className:`bg-dark-surface border border-dark-border rounded-lg shadow-lg h-full flex flex-col ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-4 w-4 text-slate-400 cursor-move drag-handle"}),s&&e.jsx("div",{className:"text-primary",children:s}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:t})]}),r&&e.jsx("button",{onClick:r,className:"p-1 text-slate-400 hover:text-white hover:bg-dark-hover rounded transition-colors",children:e.jsx(ve,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 p-4 overflow-auto",children:a})]}),al=({onRemove:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const c=await(await fetch("/api/dashboard/data/recent_scans",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(c.scans||[])}catch(m){console.error("Failed to fetch recent scans:",m)}finally{i(!1)}},d=m=>{switch(m){case"completed":return e.jsx(se,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(we,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(le,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(pe,{className:"h-4 w-4 text-yellow-500"})}};return e.jsx($e,{title:"Recent Scans",icon:e.jsx(fe,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No recent scans"}):e.jsx("div",{className:"space-y-2",children:s.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[d(m.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:m.name}),e.jsx("div",{className:"text-xs text-slate-400",children:Et(new Date(m.created_at),{addSuffix:!0})})]})]}),e.jsx("div",{className:"text-xs text-slate-400 capitalize",children:m.status})]},m.id))})})},rl=({onRemove:t})=>{const[s,a]=l.useState(null),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const m=await(await fetch("/api/dashboard/data/vulnerability_summary",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(m)}catch(d){console.error("Failed to fetch vulnerability summary:",d)}finally{i(!1)}};return e.jsx($e,{title:"Vulnerability Summary",icon:e.jsx(K,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:s.total}),e.jsx("div",{className:"text-sm text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg border border-red-900/30",children:[e.jsx("div",{className:"text-3xl font-bold text-red-500",children:s.critical}),e.jsx("div",{className:"text-sm text-slate-400",children:"Critical"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"High"})]}),e.jsx("span",{className:"text-sm font-semibold text-white",children:s.high})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Medium"})]}),e.jsx("span",{className:"text-sm font-semibold text-white",children:s.medium})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Low"})]}),e.jsx("span",{className:"text-sm font-semibold text-white",children:s.low})]})]})]}):e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No vulnerability data"})})},ll=({onRemove:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const f=await(await fetch("/api/dashboard/data/compliance_scores",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(f.scores||[])}catch(c){console.error("Failed to fetch compliance scores:",c)}finally{i(!1)}},d=c=>c>=90?"text-green-500":c>=70?"text-yellow-500":"text-red-500",m=c=>c>=90?"bg-green-500":c>=70?"bg-yellow-500":"bg-red-500";return e.jsx($e,{title:"Compliance Scores",icon:e.jsx(Ea,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No compliance data"}):e.jsx("div",{className:"space-y-4",children:s.map(c=>{const f=c.score/c.total*100;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:c.framework}),e.jsxs("span",{className:`text-sm font-bold ${d(f)}`,children:[c.score,"/",c.total," (",f.toFixed(0),"%)"]})]}),e.jsx("div",{className:"w-full bg-dark-bg rounded-full h-2",children:e.jsx("div",{className:`${m(f)} h-2 rounded-full transition-all duration-300`,style:{width:`${f}%`}})})]},c.framework)})})})},il=({onRemove:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const m=await(await fetch("/api/dashboard/data/scan_activity_chart",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(m.data||[])}catch(d){console.error("Failed to fetch scan activity:",d)}finally{i(!1)}};return e.jsx($e,{title:"Scan Activity (Last 30 Days)",icon:e.jsx(Dt,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No scan activity data"}):e.jsx(ee,{width:"100%",height:200,children:e.jsxs(lt,{data:s,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(he,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#9ca3af",fontSize:12},tickFormatter:d=>{const m=new Date(d);return`${m.getMonth()+1}/${m.getDate()}`}}),e.jsx(ce,{stroke:"#9ca3af",tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(te,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.5rem",color:"#fff"}}),e.jsx(Ae,{type:"monotone",dataKey:"count",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4}})]})})})},nl=({onRemove:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const c=await(await fetch("/api/dashboard/data/top_risky_hosts",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(c.hosts||[])}catch(m){console.error("Failed to fetch risky hosts:",m)}finally{i(!1)}},d=m=>m>=50?"text-red-500":m>=20?"text-orange-500":"text-yellow-500";return e.jsx($e,{title:"Top Risky Hosts",icon:e.jsx(G,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No risky hosts found"}):e.jsx("div",{className:"space-y-2",children:s.map((m,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`text-xl font-bold ${d(m.risk_score)}`,children:c+1}),e.jsx(ke,{className:"h-4 w-4 text-slate-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:m.hostname||m.ip}),m.hostname&&e.jsx("div",{className:"text-xs text-slate-400",children:m.ip})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"text-sm font-semibold text-white",children:[m.vulnerability_count," vulns"]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[m.critical_count>0&&e.jsxs("span",{className:"text-red-500",children:[m.critical_count,"C"]}),m.high_count>0&&e.jsxs("span",{className:"text-orange-500",children:[m.high_count,"H"]})]})]})]},m.ip))})})},cl=({onRemove:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const m=await(await fetch("/api/dashboard/data/critical_vulns",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(m.vulnerabilities||[])}catch(d){console.error("Failed to fetch critical vulnerabilities:",d)}finally{i(!1)}};return e.jsx($e,{title:"Critical Vulnerabilities",icon:e.jsx(is,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No critical vulnerabilities"}):e.jsx("div",{className:"space-y-2",children:s.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-red-900/30 hover:border-red-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(is,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:d.vulnerability_id}),e.jsxs("div",{className:"text-xs text-slate-400",children:[d.host_ip,"  ",Et(new Date(d.created_at),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("div",{className:"px-2 py-1 bg-red-900/30 text-red-500 text-xs font-semibold rounded",children:d.severity.toUpperCase()}),e.jsx("div",{className:"text-xs text-slate-400 capitalize",children:d.status.replace("_"," ")})]})]},d.id))})})},ol=({onRemove:t})=>{const[s,a]=l.useState([]),[r,i]=l.useState(!0);l.useEffect(()=>{n()},[]);const n=async()=>{try{const m=await(await fetch("/api/dashboard/data/upcoming_scheduled_scans",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(m.scans||[])}catch(d){console.error("Failed to fetch upcoming scans:",d)}finally{i(!1)}};return e.jsx($e,{title:"Upcoming Scheduled Scans",icon:e.jsx(Be,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):s.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No upcoming scans"}):e.jsx("div",{className:"space-y-2",children:s.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(pe,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:d.name}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[d.schedule_type," scan"]})]})]}),e.jsx("div",{className:"text-xs text-slate-400",children:Et(new Date(d.next_run_at),{addSuffix:!0})})]},d.id))})})},us={critical:"bg-red-900/30 text-red-500 border-red-500/50",high:"bg-orange-900/30 text-orange-500 border-orange-500/50",medium:"bg-yellow-900/30 text-yellow-500 border-yellow-500/50",low:"bg-blue-900/30 text-blue-500 border-blue-500/50",info:"bg-slate-700/30 text-slate-400 border-slate-500/50"},dl={exposed_service:e.jsx(Pe,{className:"h-4 w-4"}),exploit_available:e.jsx(_t,{className:"h-4 w-4"}),known_exploited_vulnerability:e.jsx(ns,{className:"h-4 w-4"}),critical_cve:e.jsx(G,{className:"h-4 w-4"}),new_cve:e.jsx(G,{className:"h-4 w-4"}),ransomware_threat:e.jsx(ns,{className:"h-4 w-4"}),misconfiguration:e.jsx(K,{className:"h-4 w-4"})},xl=({onRemove:t,limit:s=5})=>{const{data:a,isLoading:r,error:i}=Xs({queryKey:["threatAlerts","widget",s],queryFn:async()=>(await Ia.getAlerts({limit:s})).data,refetchInterval:6e4}),n=(a==null?void 0:a.alerts)||[],d=(a==null?void 0:a.total)||0,m=n.filter(j=>j.severity==="critical").length,c=n.filter(j=>j.severity==="high").length,f=n.filter(j=>j.in_cisa_kev).length,N=n.filter(j=>j.exploit_available).length;return e.jsx($e,{title:"Threat Intelligence",icon:e.jsx(K,{className:"h-5 w-5"}),onRemove:t,children:r?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):i?e.jsx("div",{className:"text-center text-red-400 py-8",children:"Failed to load threat alerts"}):n.length===0?e.jsxs("div",{className:"text-center text-slate-400 py-8",children:[e.jsx(K,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No active threat alerts"}),e.jsx("p",{className:"text-xs mt-1",children:"Run threat intel enrichment on your scans to generate alerts"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:m}),e.jsx("div",{className:"text-xs text-slate-400",children:"Critical"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:c}),e.jsx("div",{className:"text-xs text-slate-400",children:"High"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:f}),e.jsx("div",{className:"text-xs text-slate-400",children:"KEV"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:N}),e.jsx("div",{className:"text-xs text-slate-400",children:"Exploits"})]})]}),e.jsx("div",{className:"space-y-2",children:n.slice(0,s).map(j=>e.jsx(ml,{alert:j},j.id))}),d>s&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("a",{href:"/threat-intel",className:"text-sm text-primary hover:underline flex items-center justify-center gap-1",children:["View all ",d," alerts",e.jsx(it,{className:"h-4 w-4"})]})})]})})},ml=({alert:t})=>{const s=dl[t.alert_type]||e.jsx(G,{className:"h-4 w-4"}),a=us[t.severity]||us.info;return e.jsxs("div",{className:`flex items-center justify-between p-3 bg-dark-bg rounded-lg border ${t.severity==="critical"?"border-red-900/50":t.severity==="high"?"border-orange-900/50":"border-dark-border"} hover:border-primary/50 transition-colors`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`p-1.5 rounded ${a}`,children:s}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white text-sm truncate",title:t.title,children:t.title}),e.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2",children:[e.jsx("span",{children:t.source}),e.jsx("span",{className:"text-slate-600",children:"|"}),e.jsx("span",{children:Et(new Date(t.created_at),{addSuffix:!0})})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 ml-2",children:[e.jsx("div",{className:`px-2 py-0.5 text-xs font-semibold rounded ${a}`,children:t.severity.toUpperCase()}),e.jsxs("div",{className:"flex gap-1",children:[t.in_cisa_kev&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-red-900/30 text-red-400 rounded",children:"KEV"}),t.exploit_available&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-purple-900/30 text-purple-400 rounded",children:"Exploit"})]})]})]})},hl=({onRemove:t})=>{const s=aa(),[a,r]=l.useState(null),[i,n]=l.useState([]),[d,m]=l.useState(!0),c=l.useCallback(async()=>{try{m(!0);const o=await ms.getMyAssignments({status:""});r(o.data.stats),n(o.data.assignments.slice(0,5))}catch(o){console.error("Failed to fetch assignments:",o)}finally{m(!1)}},[]);l.useEffect(()=>{c()},[c]);const f=async(o,g,b)=>{o.stopPropagation();try{await ms.updateAssignment(g,{status:b}),D.success("Status updated"),c()}catch(w){console.error("Failed to update status:",w),D.error("Failed to update status")}},N=o=>{const g="px-2 py-0.5 text-xs font-semibold rounded-full";switch(o.toLowerCase()){case"critical":return`${g} bg-red-500/20 text-red-400`;case"high":return`${g} bg-orange-500/20 text-orange-400`;case"medium":return`${g} bg-yellow-500/20 text-yellow-400`;case"low":return`${g} bg-blue-500/20 text-blue-400`;default:return`${g} bg-gray-500/20 text-gray-400`}},j=(o,g,b)=>{if(!o)return null;const $=new Date(o).toLocaleDateString();if(b)return e.jsxs("span",{className:"text-red-400 flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),"Overdue"]});if(g!==null){if(g===0)return e.jsx("span",{className:"text-yellow-400",children:"Today"});if(g<=3)return e.jsxs("span",{className:"text-yellow-400",children:[g,"d"]})}return e.jsx("span",{className:"text-gray-400",children:$})};return e.jsx($e,{title:"My Assignments",icon:e.jsx(Ra,{className:"h-5 w-5"}),onRemove:t,children:d?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-6 w-6 text-primary animate-spin"})}):e.jsxs(e.Fragment,{children:[a&&e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4 p-3 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-white",children:a.total}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:a.overdue}),e.jsx("div",{className:"text-xs text-slate-400",children:"Overdue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:a.in_progress}),e.jsx("div",{className:"text-xs text-slate-400",children:"In Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-cyan-400",children:a.critical+a.high}),e.jsx("div",{className:"text-xs text-slate-400",children:"High+"})]})]}),i.length===0?e.jsxs("div",{className:"text-center text-slate-400 py-8",children:[e.jsx(se,{className:"h-12 w-12 mx-auto mb-2 text-green-500/50"}),e.jsx("p",{children:"No assignments"}),e.jsx("p",{className:"text-sm mt-1",children:"You are all caught up!"})]}):e.jsx("div",{className:"space-y-2",children:i.map(o=>e.jsxs("div",{className:`flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary cursor-pointer transition-colors ${o.is_overdue?"border-red-900/50":""}`,onClick:()=>s(`/remediation?vuln=${o.id}`),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:N(o.severity),children:o.severity.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate text-sm",children:o.vulnerability_id}),e.jsxs("div",{className:"text-xs text-slate-400",children:[o.host_ip,o.port?`:${o.port}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 inline mr-1 text-gray-500"}),j(o.due_date,o.days_until_due,o.is_overdue)||e.jsx("span",{className:"text-gray-500",children:"--"})]}),o.status==="open"&&e.jsx("button",{onClick:g=>f(g,o.id,"in_progress"),className:"p-1 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Start Working",children:e.jsx(Bt,{className:"h-4 w-4"})}),o.status==="in_progress"&&e.jsx("button",{onClick:g=>f(g,o.id,"resolved"),className:"p-1 text-green-400 hover:bg-green-500/20 rounded transition-colors",title:"Mark Resolved",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(it,{className:"h-4 w-4 text-gray-500"})]})]},o.id))}),a&&a.total>5&&e.jsx("div",{className:"pt-3 text-center",children:e.jsxs("button",{onClick:()=>s("/remediation?assigned=me"),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:["View all ",a.total," assignments"]})})]})})},ps=[{type:"recent_scans",label:"Recent Scans",minW:4,minH:2},{type:"vulnerability_summary",label:"Vulnerability Summary",minW:4,minH:2},{type:"compliance_scores",label:"Compliance Scores",minW:4,minH:2},{type:"scan_activity_chart",label:"Scan Activity",minW:6,minH:3},{type:"top_risky_hosts",label:"Top Risky Hosts",minW:4,minH:3},{type:"critical_vulns",label:"Critical Vulnerabilities",minW:4,minH:2},{type:"upcoming_scheduled_scans",label:"Upcoming Scans",minW:4,minH:2},{type:"threat_intel",label:"Threat Intelligence",minW:4,minH:3},{type:"my_assignments",label:"My Assignments",minW:4,minH:3}],ul=({editMode:t=!1,onEditModeChange:s})=>{const[a,r]=l.useState([]),[i,n]=l.useState(!0),[d,m]=l.useState(!1),[c,f]=l.useState(t),[N,j]=l.useState(!1);l.useEffect(()=>{o()},[]),l.useEffect(()=>{f(t)},[t]);const o=async()=>{try{const S=await(await fetch("/api/dashboard/widgets",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();r(S.widgets||[])}catch(h){console.error("Failed to fetch dashboard config:",h)}finally{n(!1)}},g=async()=>{m(!0);try{await fetch("/api/dashboard/widgets",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({widgets:a})})}catch(h){console.error("Failed to save dashboard config:",h)}finally{m(!1)}},b=h=>{if(!c)return;const S=a.map(E=>{const P=h.find(O=>O.i===E.id);return P?{...E,x:P.x,y:P.y,w:P.w,h:P.h}:E});r(S)},w=h=>{const S=ps.find(P=>P.type===h);if(!S)return;const E={id:`${h}_${Date.now()}`,widget_type:h,x:0,y:1/0,w:S.minW,h:S.minH};r([...a,E]),j(!1)},$=h=>{r(a.filter(S=>S.id!==h))},F=()=>{const h=!c;f(h),s&&s(h)},y=h=>{const S={onRemove:c?()=>$(h.id):void 0};switch(h.widget_type){case"recent_scans":return e.jsx(al,{...S});case"vulnerability_summary":return e.jsx(rl,{...S});case"compliance_scores":return e.jsx(ll,{...S});case"scan_activity_chart":return e.jsx(il,{...S});case"top_risky_hosts":return e.jsx(nl,{...S});case"critical_vulns":return e.jsx(cl,{...S});case"upcoming_scheduled_scans":return e.jsx(ol,{...S});case"threat_intel":return e.jsx(xl,{...S});case"my_assignments":return e.jsx(hl,{...S});default:return null}};if(i)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"Loading dashboard..."})});const p=a.map(h=>({i:h.id,x:h.x,y:h.y,w:h.w,h:h.h}));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:F,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${c?"bg-primary text-white":"bg-dark-surface text-slate-300 hover:text-white border border-dark-border"}`,children:[e.jsx(cs,{className:"h-4 w-4"}),c?"Exit Edit Mode":"Customize Dashboard"]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>j(!N),className:"flex items-center gap-2 px-4 py-2 bg-dark-surface text-slate-300 hover:text-white border border-dark-border rounded-lg transition-colors",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Add Widget"]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>j(!1)}),e.jsx("div",{className:"absolute top-full mt-2 left-0 bg-dark-surface border border-dark-border rounded-lg shadow-xl z-50 min-w-[200px]",children:ps.map(h=>e.jsx("button",{onClick:()=>w(h.type),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:text-white hover:bg-dark-hover transition-colors first:rounded-t-lg last:rounded-b-lg",children:h.label},h.type))})]})]}),e.jsxs("button",{onClick:g,disabled:d,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(qt,{className:"h-4 w-4"}),d?"Saving...":"Save Layout"]})]})]}),c&&e.jsx("div",{className:"text-sm text-slate-400",children:"Drag widgets to reposition, resize from corners"})]}),e.jsx(sl,{className:"layout",layout:p,cols:12,rowHeight:100,width:1200,isDraggable:c,isResizable:c,onLayoutChange:b,draggableHandle:".drag-handle",children:a.map(h=>e.jsx("div",{className:c?"cursor-move":"",children:y(h)},h.id))}),a.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(cs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No widgets added yet"}),c&&e.jsx("button",{onClick:()=>j(!0),className:"mt-4 text-primary hover:underline",children:"Add your first widget"})]})]})},pl=({selectedCount:t,onClear:s,actions:a,onAction:r,isProcessing:i=!1})=>{const[n,d]=l.useState(null);if(t===0)return null;const m=j=>{j.requiresConfirmation?d(j.id):r(j.id)},c=()=>{n&&(r(n),d(null))},f=j=>{if(j.icon)return j.icon;switch(j.id){case"delete":return e.jsx(Yt,{className:"h-4 w-4"});case"export":return e.jsx(We,{className:"h-4 w-4"});default:return null}},N=a.find(j=>j.id===n);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-lg shadow-2xl px-6 py-4 min-w-[400px]",children:e.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-primary/10 text-primary rounded-full w-8 h-8 flex items-center justify-center font-semibold text-sm",children:t}),e.jsxs("span",{className:"text-white font-medium",children:[t," item",t!==1?"s":""," selected"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.map(j=>e.jsxs(Q,{variant:j.variant||"secondary",onClick:()=>m(j),disabled:i,className:"flex items-center space-x-2",children:[f(j),e.jsx("span",{children:j.label})]},j.id)),e.jsx("button",{onClick:s,disabled:i,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-dark-bg disabled:opacity-50",title:"Clear selection",children:e.jsx(ve,{className:"h-5 w-5"})})]})]})})}),n&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Confirm Action"}),e.jsx("p",{className:"text-slate-300 mb-6",children:N.confirmationMessage||`Are you sure you want to ${N.label.toLowerCase()} ${t} item${t!==1?"s":""}?`}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(Q,{variant:"secondary",onClick:()=>d(null),disabled:i,children:"Cancel"}),e.jsx(Q,{variant:N.variant||"primary",onClick:c,disabled:i,children:"Confirm"})]})]})})]})},gl=({shortcuts:t,enabled:s=!0})=>{l.useEffect(()=>{if(!s)return;const a=r=>{if(!(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||r.target instanceof HTMLSelectElement))for(const i of t){const n=i.ctrl===void 0||i.ctrl===(r.ctrlKey||r.metaKey),d=i.shift===void 0||i.shift===r.shiftKey,m=i.alt===void 0||i.alt===r.altKey,c=r.key.toLowerCase()===i.key.toLowerCase();if(n&&d&&m&&c){r.preventDefault(),i.action();break}}};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[t,s])},bl=t=>{const s=[];return t.ctrl&&s.push("Ctrl"),t.shift&&s.push("Shift"),t.alt&&s.push("Alt"),s.push(t.key.toUpperCase()),s.join("+")},Ll=()=>{const{activeScan:t,results:s,setActiveScan:a,scans:r,setScans:i}=ue(),[n,d]=l.useState(!1),[m,c]=l.useState("overview"),[f,N]=l.useState(new Set),[j,o]=l.useState(!1),g=h=>{const S=r.find(E=>E.id===h);S&&a(S)},b=async h=>{if(f.size!==0){o(!0);try{switch(h){case"delete":await w();break;case"export-json":await $("json");break;case"export-csv":await $("csv");break;default:D.warning("Unknown action")}}catch(S){console.error("Bulk action failed:",S),D.error("Bulk action failed")}finally{o(!1)}}},w=async()=>{try{const h=await je.bulkDelete(Array.from(f));h.data.failed&&h.data.failed>0?D.warning(h.data.message):D.success(h.data.message);const S=await je.getAll();i(S.data),N(new Set)}catch(h){throw D.error("Failed to delete scans"),h}},$=async h=>{try{const S=await je.bulkExport(Array.from(f),h,{include_vulnerabilities:!0,include_services:!0}),E=window.URL.createObjectURL(new Blob([S.data])),P=document.createElement("a");P.href=E,P.setAttribute("download","scans_export.zip"),document.body.appendChild(P),P.click(),P.remove(),window.URL.revokeObjectURL(E),D.success(`Exported ${f.size} scan(s) successfully`),N(new Set)}catch(S){throw D.error("Failed to export scans"),S}},F=[{id:"delete",label:"Delete",icon:e.jsx(Yt,{className:"h-4 w-4"}),variant:"danger",requiresConfirmation:!0,confirmationMessage:`Are you sure you want to delete ${f.size} scan${f.size!==1?"s":""}? This action cannot be undone.`},{id:"export-json",label:"Export JSON",icon:e.jsx(We,{className:"h-4 w-4"}),variant:"secondary"},{id:"export-csv",label:"Export CSV",icon:e.jsx(We,{className:"h-4 w-4"}),variant:"secondary"}],y=l.useMemo(()=>t&&s.has(t.id)?s.get(t.id)||[]:Array.from(s.values()).flat(),[t,s]),p=[{key:"f",ctrl:!0,action:()=>{const h=document.querySelector('input[placeholder*="Search"]');h&&(h.focus(),h.select())},description:"Focus search"},{key:"k",ctrl:!0,action:()=>d(!n),description:"Show keyboard shortcuts"},{key:"Escape",action:()=>d(!1),description:"Close modals"}];return gl({shortcuts:p}),e.jsx(Ma,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"Network Triage Dashboard"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Create scans, monitor progress, and analyze results in real-time"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-3 py-2 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors border border-light-border dark:border-dark-border hover:border-primary rounded-lg",children:[e.jsx(os,{className:"h-4 w-4"}),"Shortcuts"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-light-border dark:border-dark-border pb-2",children:[e.jsxs("button",{onClick:()=>c("overview"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${m==="overview"?"bg-light-surface dark:bg-dark-surface text-primary border-b-2 border-primary":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[e.jsx(La,{className:"h-4 w-4"}),"Overview"]}),e.jsxs("button",{onClick:()=>c("scans"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${m==="scans"?"bg-light-surface dark:bg-dark-surface text-primary border-b-2 border-primary":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[e.jsx(Pa,{className:"h-4 w-4"}),"Scans"]}),e.jsxs("button",{onClick:()=>c("analytics"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${m==="analytics"?"bg-light-surface dark:bg-dark-surface text-primary border-b-2 border-primary":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[e.jsx(Dt,{className:"h-4 w-4"}),"Analytics"]})]}),m==="overview"&&e.jsx(ul,{}),m==="scans"&&e.jsxs(e.Fragment,{children:[e.jsx(Gr,{}),e.jsx(dr,{onScanSelect:g}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(sr,{}),e.jsx(rr,{selectedIds:f,onSelectionChange:N})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(or,{scanId:(t==null?void 0:t.id)||null}),(t==null?void 0:t.status)==="running"&&e.jsx(xr,{scanId:t.id}),y.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(qr,{hosts:y}),e.jsx(Jr,{hosts:y})]}),e.jsx(Wr,{})]})]})]}),m==="analytics"&&e.jsx(el,{}),e.jsx(pl,{selectedCount:f.size,onClear:()=>N(new Set),actions:F,onAction:b,isProcessing:j}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 animate-fadeIn",onClick:()=>d(!1)}),e.jsxs("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-2xl p-6 w-full max-w-md animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5 text-primary"}),"Keyboard Shortcuts"]}),e.jsx("button",{onClick:()=>d(!1),className:"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"space-y-2",children:p.map((h,S)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-light-bg dark:bg-dark-bg rounded border border-light-border dark:border-dark-border",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:h.description}),e.jsx("kbd",{className:"px-2 py-1 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded text-xs font-mono text-primary",children:bl(h)})]},S))}),e.jsxs("p",{className:"text-xs text-slate-500 mt-4 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded text-xs font-mono",children:"Esc"})," to close"]})]})]})]})})};export{Ll as default};
