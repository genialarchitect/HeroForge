import{b as P,u as C,d as D,j as e}from"./vendor-state-BjT_zREg.js";import{r as i}from"./vendor-react-5KxtEOLM.js";import{G as j,y as q,a9 as g,ab as T,_ as $,B as p,x as F,af as K,S as B,n as R,ao as W,O as M,c0 as O,bm as Q,$ as H,aY as z,p as G,i as k,g as U}from"./vendor-ui-CaTPr3iI.js";import{B as v,M as u}from"./index-BwCSAD78.js";import{L as X}from"./Layout-KYMPsh8G.js";import{u as Y,E as J}from"./useRequireEngagement-Cvf3mPmE.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const N={startDiscovery:a=>u.post("/discovery",a),listScans:()=>u.get("/discovery/scans"),getScan:a=>u.get(`/discovery/scans/${a}`),deleteScan:a=>u.delete(`/discovery/scans/${a}`),cancelScan:a=>u.post(`/discovery/scans/${a}/cancel`)},_=a=>{switch(a.toLowerCase()){case"completed":return e.jsx(U,{className:"w-4 h-4 text-green-400"});case"failed":return e.jsx(k,{className:"w-4 h-4 text-red-400"});case"running":return e.jsx(g,{className:"w-4 h-4 text-cyan-400 animate-spin"});case"cancelled":return e.jsx(k,{className:"w-4 h-4 text-yellow-400"});default:return e.jsx(G,{className:"w-4 h-4 text-slate-400"})}},V=a=>({CertificateTransparency:"bg-purple-500/20 text-purple-400 border-purple-500/30",DnsEnumeration:"bg-blue-500/20 text-blue-400 border-blue-500/30",Shodan:"bg-orange-500/20 text-orange-400 border-orange-500/30",Censys:"bg-green-500/20 text-green-400 border-green-500/30",Whois:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30"})[a]||"bg-slate-500/20 text-slate-400 border-slate-500/30";function Z({onSuccess:a,hasEngagement:d}){const[s,o]=i.useState(""),[n,t]=i.useState(!0),[l,m]=i.useState(!0),[h,c]=i.useState(!0),[x,A]=i.useState(!1),[y,I]=i.useState(""),[f,E]=i.useState(!1),b=D({mutationFn:N.startDiscovery,onSuccess:()=>{p.success("Discovery scan started"),o(""),a()},onError:r=>{var w,S;p.error(((S=(w=r.response)==null?void 0:w.data)==null?void 0:S.error)||"Failed to start discovery")}}),L=r=>{if(r.preventDefault(),!s){p.error("Please enter a domain");return}b.mutate({domain:s,include_ct_logs:n,include_dns:l,include_whois:h,include_shodan:x,shodan_api_key:x?y:void 0,active_enum:f})};return e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-cyan-400"}),"Start Asset Discovery"]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Target Domain"}),e.jsx("input",{type:"text",value:s,onChange:r=>o(r.target.value),placeholder:"example.com",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-700/50 rounded-lg px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:r=>t(r.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"CT Logs"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-700/50 rounded-lg px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:r=>m(r.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"DNS Enum"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-700/50 rounded-lg px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:r=>c(r.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"WHOIS"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-700/50 rounded-lg px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:r=>A(r.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Shodan"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-slate-700/50 rounded-lg px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:r=>E(r.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Active Enum"})]})]}),x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Shodan API Key"}),e.jsx("input",{type:"password",value:y,onChange:r=>I(r.target.value),placeholder:"Enter your Shodan API key",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs(v,{type:"submit",disabled:b.isPending||!s||!d,children:[b.isPending?e.jsx(g,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(z,{className:"w-4 h-4 mr-2"}),"Start Discovery"]})]})]})}function ee({scanId:a,onClose:d}){var n;const{data:s,isLoading:o}=C({queryKey:["discovery-scan",a],queryFn:async()=>(await N.getScan(a)).data,refetchInterval:t=>{const l=t.state.data;return(l==null?void 0:l.status)==="running"?3e3:!1}});return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(g,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[_(s.status),s.domain]}),e.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Started ",new Date(s.started_at).toLocaleString(),s.completed_at&&` | Completed ${new Date(s.completed_at).toLocaleString()}`]})]}),e.jsx(v,{variant:"secondary",size:"sm",onClick:d,children:"Back to List"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx(F,{className:"w-4 h-4"}),"Total Assets"]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:s.statistics.total_assets})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx(K,{className:"w-4 h-4"}),"Unique IPs"]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:s.statistics.unique_ips})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx(B,{className:"w-4 h-4"}),"From CT Logs"]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:s.statistics.subdomains_from_ct})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx(R,{className:"w-4 h-4"}),"Technologies"]}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:s.statistics.technologies_identified})]})]}),s.whois&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-cyan-400"}),"WHOIS Information"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Registrar"}),e.jsx("p",{className:"text-white",children:s.whois.registrar||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Created"}),e.jsx("p",{className:"text-white",children:s.whois.creation_date||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Expires"}),e.jsx("p",{className:"text-white",children:s.whois.expiration_date||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Nameservers"}),e.jsx("p",{className:"text-white",children:((n=s.whois.nameservers)==null?void 0:n.join(", "))||"N/A"})]})]})]}),s.errors.length>0&&e.jsxs("div",{className:"bg-red-900/20 rounded-lg border border-red-800/50 p-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Errors (",s.errors.length,")"]}),e.jsx("ul",{className:"text-sm text-red-300 space-y-1",children:s.errors.map((t,l)=>e.jsx("li",{children:t},l))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h4",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-cyan-400"}),"Discovered Assets (",s.assets.length,")"]})}),e.jsx("div",{className:"divide-y divide-slate-700 max-h-96 overflow-y-auto",children:s.assets.map(t=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-white font-medium",children:t.hostname}),t.country&&e.jsxs("span",{className:"text-xs text-slate-400 flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),t.city?`${t.city}, ${t.country}`:t.country]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.sources.map((l,m)=>e.jsx("span",{className:`px-2 py-0.5 rounded text-xs border ${V(l)}`,children:l},m))}),t.ip_addresses.length>0&&e.jsxs("div",{className:"text-xs text-slate-400 mt-2",children:["IPs: ",t.ip_addresses.join(", ")]}),t.ports.length>0&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Ports: ",t.ports.map(l=>`${l.port}/${l.protocol}`).join(", ")]})]}),e.jsx("a",{href:`https://${t.hostname}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-slate-600 rounded-lg",children:e.jsx(H,{className:"w-4 h-4 text-slate-400"})})]})},t.id))})]})]}):e.jsx("div",{className:"text-slate-400",children:"Scan not found"})}function de(){const a=P(),[d,s]=i.useState(null),{hasEngagement:o}=Y(),{data:n,isLoading:t,refetch:l}=C({queryKey:["discovery-scans"],queryFn:async()=>(await N.listScans()).data,refetchInterval:1e4}),m=D({mutationFn:N.deleteScan,onSuccess:()=>{p.success("Scan deleted"),a.invalidateQueries({queryKey:["discovery-scans"]})},onError:()=>p.error("Failed to delete scan")}),h=(n==null?void 0:n.scans)||[];return e.jsxs(X,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(j,{className:"w-7 h-7 text-cyan-400"}),"Asset Discovery"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Discover assets using Certificate Transparency logs, DNS enumeration, WHOIS, and Shodan"})]}),e.jsx(J,{toolName:"Asset Discovery",className:"mb-6"}),d?e.jsx(ee,{scanId:d,onClose:()=>s(null)}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Z,{hasEngagement:o,onSuccess:()=>{a.invalidateQueries({queryKey:["discovery-scans"]})}})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-cyan-400"}),"Discovery Scans"]}),e.jsx(v,{variant:"secondary",size:"sm",onClick:()=>l(),children:e.jsx(g,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:t?e.jsx("div",{className:"p-8 text-center",children:e.jsx(g,{className:"w-8 h-8 text-cyan-400 animate-spin mx-auto"})}):h.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No discovery scans yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start a discovery scan to find assets"})]}):h.map(c=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors cursor-pointer",onClick:()=>s(c.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_(c.status),e.jsx("span",{className:"text-white font-medium",children:c.domain}),e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded bg-cyan-500/20 text-cyan-400",children:[c.assets_count," assets"]})]}),e.jsx("div",{className:"text-sm text-slate-400 mt-1",children:new Date(c.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),confirm("Delete this scan?")&&m.mutate(c.id)},className:"p-2 hover:bg-slate-600 rounded-lg",children:e.jsx(T,{className:"w-4 h-4 text-slate-400 hover:text-red-400"})}),e.jsx($,{className:"w-5 h-5 text-slate-400"})]})]})},c.id))})]})})]})]})}export{de as default};
