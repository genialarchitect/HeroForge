import{j as e,u as _,b as R,d as C}from"./vendor-state-DdX3IZQk.js";import{r as m}from"./vendor-react-Da1CiaFS.js";import{S as ie,ab as de,a8 as P,x as ee,G as L,m as D,V as K,I as se,aJ as v,az as A,$ as xe,B as y,P as Y,E as G,aI as E,ai as F,Z as oe,at as te,ay as V,bf as W,aj as me,aF as ge,bb as z,aq as he,bc as ae,ba as X,aY as ue,c9 as ye,ca as pe,av as B,al as je,C as be,T as Ne}from"./vendor-ui-BsZcNZEA.js";import{d as fe,a5 as o}from"./index-p17BBcCI.js";import"./vendor-charts-Xc8Z_JpT.js";const b={getStats:()=>o.get("/detection/yara/rules/stats").then(s=>s.data),getCategories:()=>o.get("/detection/yara/rules/categories").then(s=>s.data),listRules:s=>o.get("/detection/yara/rules",{params:s}).then(t=>t.data),createRule:s=>o.post("/detection/yara/rules",s).then(t=>t.data),getRule:s=>o.get(`/detection/yara/rules/${s}`).then(t=>t.data),updateRule:(s,t)=>o.put(`/detection/yara/rules/${s}`,t).then(r=>r.data),deleteRule:s=>o.delete(`/detection/yara/rules/${s}`),buildRule:s=>o.post("/detection/yara/rules/build",s).then(t=>t.data),validateRule:s=>o.post("/detection/yara/validate",{rule_content:s}).then(t=>t.data),scanPath:s=>o.post("/detection/yara/scan",s).then(t=>t.data),bulkScan:s=>o.post("/detection/yara/scan/bulk",s).then(t=>t.data),listScans:()=>o.get("/detection/yara/scans").then(s=>s.data),getScan:s=>o.get(`/detection/yara/scans/${s}`).then(t=>t.data),deleteScan:s=>o.delete(`/detection/yara/scans/${s}`),getCommunitySourcesList:()=>o.get("/detection/yara/community/sources").then(s=>s.data),fetchFromCommunity:s=>o.post(`/detection/yara/community/fetch/${s}`).then(t=>t.data),importRules:s=>o.post("/detection/yara/rules/import",s).then(t=>t.data),listMonitors:()=>o.get("/detection/yara/monitors").then(s=>s.data),createMonitor:s=>o.post("/detection/yara/monitors",s).then(t=>t.data),getMonitor:s=>o.get(`/detection/yara/monitors/${s}`).then(t=>t.data),updateMonitorStatus:(s,t)=>o.put(`/detection/yara/monitors/${s}/status`,{status:t}).then(r=>r.data),deleteMonitor:s=>o.delete(`/detection/yara/monitors/${s}`),getMonitorAlerts:s=>o.get(`/detection/yara/monitors/${s}/alerts`).then(t=>t.data),acknowledgeAlert:s=>o.post(`/detection/yara/alerts/${s}/acknowledge`).then(t=>t.data),listMemoryScans:()=>o.get("/detection/yara/memory/scans").then(s=>s.data),scanMemoryDump:s=>o.post("/detection/yara/memory/scan",s,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>t.data),getMemoryScan:s=>o.get(`/detection/yara/memory/scans/${s}`).then(t=>t.data),getEffectiveness:()=>o.get("/detection/yara/effectiveness").then(s=>s.data),getEffectivenessSummary:()=>o.get("/detection/yara/effectiveness/summary").then(s=>s.data),getRulesNeedingReview:()=>o.get("/detection/yara/effectiveness/review").then(s=>s.data),getRuleEffectivenessDetail:s=>o.get(`/detection/yara/effectiveness/${s}`).then(t=>t.data),verifyMatch:(s,t)=>o.post(`/detection/yara/matches/${s}/verify`,t).then(r=>r.data)},Z={critical:{bg:"bg-red-500/20",text:"text-red-400"},high:{bg:"bg-orange-500/20",text:"text-orange-400"},medium:{bg:"bg-yellow-500/20",text:"text-yellow-400"},low:{bg:"bg-blue-500/20",text:"text-blue-400"},info:{bg:"bg-gray-500/20",text:"text-gray-400"}},H={pending:{bg:"bg-yellow-500/20",text:"text-yellow-400"},running:{bg:"bg-blue-500/20",text:"text-blue-400"},completed:{bg:"bg-green-500/20",text:"text-green-400"},failed:{bg:"bg-red-500/20",text:"text-red-400"},active:{bg:"bg-green-500/20",text:"text-green-400"},paused:{bg:"bg-yellow-500/20",text:"text-yellow-400"},stopped:{bg:"bg-gray-500/20",text:"text-gray-400"},error:{bg:"bg-red-500/20",text:"text-red-400"}},I={A:{bg:"bg-green-500/20",text:"text-green-400"},B:{bg:"bg-lime-500/20",text:"text-lime-400"},C:{bg:"bg-yellow-500/20",text:"text-yellow-400"},D:{bg:"bg-orange-500/20",text:"text-orange-400"},F:{bg:"bg-red-500/20",text:"text-red-400"}},Q={high:{bg:"bg-green-500/20",text:"text-green-400"},medium:{bg:"bg-yellow-500/20",text:"text-yellow-400"},low:{bg:"bg-gray-500/20",text:"text-gray-400"}},J={malware:{bg:"bg-red-500/20",text:"text-red-400"},ransomware:{bg:"bg-red-600/20",text:"text-red-300"},apt:{bg:"bg-purple-500/20",text:"text-purple-400"},packer:{bg:"bg-orange-500/20",text:"text-orange-400"},webshell:{bg:"bg-yellow-500/20",text:"text-yellow-400"},exploit:{bg:"bg-pink-500/20",text:"text-pink-400"},miner:{bg:"bg-cyan-500/20",text:"text-cyan-400"},rat:{bg:"bg-violet-500/20",text:"text-violet-400"},backdoor:{bg:"bg-rose-500/20",text:"text-rose-400"},generic:{bg:"bg-gray-500/20",text:"text-gray-400"},custom:{bg:"bg-blue-500/20",text:"text-blue-400"}};function ve({severity:s}){const t=Z[s.toLowerCase()]||Z.info;return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${t.bg} ${t.text}`,children:s})}function O({status:s}){const t=H[s.toLowerCase()]||H.pending,r=s==="completed"?A:s==="failed"?V:s==="running"?v:je;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${t.bg} ${t.text}`,children:[e.jsx(r,{className:`h-3 w-3 ${s==="running"?"animate-spin":""}`}),s]})}function q({category:s}){const t=J[s.toLowerCase()]||J.generic;return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${t.bg} ${t.text}`,children:s})}function we({grade:s}){const t=I[s.toUpperCase()]||I.F;return e.jsx("span",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full text-lg font-bold ${t.bg} ${t.text}`,children:s})}function Ce({confidence:s}){const t=Q[s.toLowerCase()]||Q.low;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${t.bg} ${t.text}`,children:[e.jsx(Ne,{className:"h-3 w-3"}),s]})}function Se(){const{data:s,isLoading:t}=_({queryKey:["yara","stats"],queryFn:b.getStats});return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:e.jsx(P,{className:"h-5 w-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:(s==null?void 0:s.total_rules)||0}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Rules"})]})]})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(A,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:(s==null?void 0:s.enabled_rules)||0}),e.jsx("p",{className:"text-sm text-gray-400",children:"Enabled"})]})]})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:(s==null?void 0:s.total_scans)||0}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Scans"})]})]})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:(s==null?void 0:s.total_matches)||0}),e.jsx("p",{className:"text-sm text-gray-400",children:"Matches Found"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Rules by Category"}),e.jsxs("div",{className:"space-y-2",children:[(s==null?void 0:s.by_category)&&Object.entries(s.by_category).map(([r,d])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{category:r}),e.jsx("span",{className:"text-gray-300",children:d})]},r)),(!(s!=null&&s.by_category)||Object.keys(s.by_category).length===0)&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No rules yet"})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Rules by Source"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Built-in Rules"}),e.jsx("span",{className:"text-cyan-400 font-semibold",children:(s==null?void 0:s.builtin_rules)||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Custom Rules"}),e.jsx("span",{className:"text-green-400 font-semibold",children:(s==null?void 0:s.custom_rules)||0})]})]})]})]})]})}function _e(){const s=R(),[t,r]=m.useState(""),[d,l]=m.useState(""),[u,h]=m.useState(!1),[a,n]=m.useState(null),[i,c]=m.useState(!1),{data:p,isLoading:w}=_({queryKey:["yara","rules",{category:d,search:t}],queryFn:()=>b.listRules({...d&&{category:d},...t&&{search:t}})}),{data:S}=_({queryKey:["yara","categories"],queryFn:b.getCategories}),M=C({mutationFn:b.deleteRule,onSuccess:()=>{y.success("Rule deleted"),s.invalidateQueries({queryKey:["yara"]})},onError:()=>y.error("Failed to delete rule")}),j=C({mutationFn:({id:g,enabled:$})=>b.updateRule(g,{enabled:$}),onSuccess:()=>{s.invalidateQueries({queryKey:["yara"]})}}),k=(p==null?void 0:p.filter(g=>!(t&&!g.name.toLowerCase().includes(t.toLowerCase()))))||[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search rules...",value:t,onChange:g=>r(g.target.value),className:"pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("select",{value:d,onChange:g=>l(g.target.value),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All Categories"}),S==null?void 0:S.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors",children:[e.jsx(Y,{className:"h-4 w-4"}),"Add Rule"]})]}),w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-cyan-400"})}):k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No YARA rules found"})]}):e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Matches"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:k.map(g=>e.jsxs("tr",{className:"hover:bg-gray-750",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:g.name}),g.description&&e.jsx("p",{className:"text-gray-400 text-sm truncate max-w-xs",children:g.description})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(q,{category:g.category||"generic"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${g.is_builtin?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"}`,children:g.is_builtin?"Built-in":"Custom"})}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:g.match_count}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>j.mutate({id:g.id,enabled:!g.enabled}),className:`text-xs px-2 py-0.5 rounded ${g.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:g.enabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>{n(g),c(!0)},className:"p-1 text-gray-400 hover:text-white",title:"View",children:e.jsx(G,{className:"h-4 w-4"})}),!g.is_builtin&&e.jsx("button",{onClick:()=>M.mutate(g.id),className:"p-1 text-gray-400 hover:text-red-400",title:"Delete",children:e.jsx(E,{className:"h-4 w-4"})})]})})]},g.id))})]})}),u&&e.jsx($e,{onClose:()=>h(!1)}),i&&a&&e.jsx(qe,{rule:a,onClose:()=>c(!1)})]})}function ke(){const[s,t]=m.useState(""),[r,d]=m.useState(""),[l,u]=m.useState([]),[h,a]=m.useState(""),[n,i]=m.useState([]),[c,p]=m.useState("any"),[w,S]=m.useState(""),[M,j]=m.useState(""),[k,g]=m.useState(null),$=C({mutationFn:b.buildRule,onSuccess:x=>{j(x.rule_content),g(x.validation),x.validation.is_valid?y.success("Rule generated successfully"):y.warning("Rule has validation warnings")},onError:()=>y.error("Failed to build rule")}),re=()=>{i([...n,{identifier:`str${n.length+1}`,string_type:"text",value:"",modifiers:{nocase:!1,wide:!1,ascii:!0,fullword:!1,xor:!1,base64:!1}}])},T=(x,f)=>{const N=[...n];N[x]={...N[x],...f},i(N)},le=x=>{i(n.filter((f,N)=>N!==x))},U=()=>{h&&!l.includes(h)&&(u([...l,h]),a(""))},ne=()=>{if(!s||n.length===0){y.error("Please provide a name and at least one string");return}$.mutate({name:s,description:r||void 0,tags:l,metadata:[],strings:n,condition:{condition_type:c,custom_condition:c==="custom"?w:void 0}})};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Rule Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Rule Name *"}),e.jsx("input",{type:"text",value:s,onChange:x=>t(x.target.value),placeholder:"e.g., Detect_Malware_XYZ",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:r,onChange:x=>d(x.target.value),placeholder:"Describe what this rule detects...",rows:2,className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:x=>a(x.target.value),onKeyPress:x=>x.key==="Enter"&&U(),placeholder:"Add tag...",className:"flex-1 px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"}),e.jsx("button",{onClick:U,className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Add"})]}),l.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.map(x=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-sm",children:[x,e.jsx("button",{onClick:()=>u(l.filter(f=>f!==x)),children:e.jsx(F,{className:"h-3 w-3"})})]},x))})]})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Strings"}),e.jsxs("button",{onClick:re,className:"flex items-center gap-1 px-2 py-1 bg-cyan-600 hover:bg-cyan-700 text-white rounded text-sm",children:[e.jsx(Y,{className:"h-3 w-3"})," Add String"]})]}),e.jsxs("div",{className:"space-y-4",children:[n.map((x,f)=>e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",value:x.identifier,onChange:N=>T(f,{identifier:N.target.value}),placeholder:"$identifier",className:"w-24 px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm"}),e.jsxs("select",{value:x.string_type,onChange:N=>T(f,{string_type:N.target.value}),className:"px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"hex",children:"Hex"}),e.jsx("option",{value:"regex",children:"Regex"})]}),e.jsx("button",{onClick:()=>le(f),className:"ml-auto p-1 text-gray-400 hover:text-red-400",children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsx("input",{type:"text",value:x.value,onChange:N=>T(f,{value:N.target.value}),placeholder:x.string_type==="hex"?"{ 4D 5A 90 00 }":"Enter string value...",className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm mb-2"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["nocase","wide","ascii","fullword","xor","base64"].map(N=>e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:x.modifiers[N],onChange:ce=>T(f,{modifiers:{...x.modifiers,[N]:ce.target.checked}}),className:"rounded border-gray-600"}),N]},N))})]},f)),n.length===0&&e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:'No strings defined. Click "Add String" to begin.'})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Condition"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("select",{value:c,onChange:x=>p(x.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white",children:[e.jsx("option",{value:"any",children:"Any of them"}),e.jsx("option",{value:"all",children:"All of them"}),e.jsx("option",{value:"count",children:"At least N matches"}),e.jsx("option",{value:"custom",children:"Custom condition"})]}),c==="custom"&&e.jsx("input",{type:"text",value:w,onChange:x=>S(x.target.value),placeholder:"e.g., $str1 and ($str2 or $str3)",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]})]}),e.jsxs("button",{onClick:ne,disabled:$.isPending,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-cyan-600 hover:bg-cyan-700 disabled:bg-cyan-800 text-white rounded-lg transition-colors",children:[$.isPending?e.jsx(v,{className:"h-5 w-5 animate-spin"}):e.jsx(oe,{className:"h-5 w-5"}),"Generate Rule"]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generated Rule"}),M&&e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(M),y.success("Copied to clipboard")},className:"flex items-center gap-1 px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm",children:[e.jsx(te,{className:"h-3 w-3"})," Copy"]})]}),M?e.jsxs(e.Fragment,{children:[e.jsx("pre",{className:"bg-gray-900 p-4 rounded-lg overflow-x-auto text-sm text-gray-300 font-mono",children:M}),k&&e.jsxs("div",{className:"mt-4 space-y-2",children:[k.is_valid?e.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Rule is valid"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Rule has errors"})]}),k.errors.map((x,f)=>e.jsx("p",{className:"text-red-400 text-sm",children:x},f)),k.warnings.map((x,f)=>e.jsx("p",{className:"text-yellow-400 text-sm",children:x},f))]})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:'Fill in the form and click "Generate Rule"'})]})]})]})})}function Re(){const s=R(),[t,r]=m.useState(""),[d,l]=m.useState(!1),{data:u,isLoading:h}=_({queryKey:["yara","community","sources"],queryFn:b.getCommunitySourcesList}),a=C({mutationFn:b.fetchFromCommunity,onSuccess:i=>{y.success(`Fetched ${i.rules_fetched} rules`),s.invalidateQueries({queryKey:["yara"]})},onError:()=>y.error("Failed to fetch rules")}),n=C({mutationFn:b.importRules,onSuccess:i=>{y.success(`Imported ${i.imported} rules, skipped ${i.skipped}`),i.errors.length>0&&i.errors.forEach(c=>y.warning(c)),s.invalidateQueries({queryKey:["yara"]}),l(!1),r("")},onError:()=>y.error("Failed to import rules")});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg",children:[e.jsx(W,{className:"h-4 w-4"}),"Import Rules"]})}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Community Sources"}),h?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(v,{className:"h-6 w-6 animate-spin text-cyan-400"})}):u&&u.length>0?e.jsx("div",{className:"grid gap-4",children:u.map(i=>e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:i.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:i.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),i.rules_count," rules"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),i.source_type]})]})]})]}),e.jsxs("button",{onClick:()=>a.mutate(i.id),disabled:a.isPending,className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 text-white rounded-lg text-sm",children:[a.isPending?e.jsx(v,{className:"h-4 w-4 animate-spin"}):e.jsx(ge,{className:"h-4 w-4"}),"Fetch"]})]})},i.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No community sources configured"})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Import YARA Rules"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Paste YARA rules content"}),e.jsx("textarea",{value:t,onChange:i=>r(i.target.value),placeholder:'rule example { strings: $a = "test" condition: $a }',rows:12,className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white font-mono text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:()=>n.mutate({content:t,overwrite_existing:!1}),disabled:!t||n.isPending,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-cyan-800 text-white rounded-lg",children:[n.isPending?e.jsx(v,{className:"h-4 w-4 animate-spin"}):e.jsx(W,{className:"h-4 w-4"}),"Import"]})]})]})]})})]})}function Me(){const s=R(),[t,r]=m.useState(!1),[d,l]=m.useState(null),{data:u,isLoading:h}=_({queryKey:["yara","scans"],queryFn:b.listScans,refetchInterval:5e3}),a=C({mutationFn:b.deleteScan,onSuccess:()=>{y.success("Scan deleted"),s.invalidateQueries({queryKey:["yara","scans"]})}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg",children:[e.jsx(z,{className:"h-4 w-4"}),"New Scan"]})}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-cyan-400"})}):u&&u.length>0?e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Target"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Files"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Matches"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:u.map(n=>e.jsxs("tr",{className:"hover:bg-gray-750",children:[e.jsx("td",{className:"px-4 py-3 text-white font-medium",children:n.name||"Unnamed Scan"}),e.jsx("td",{className:"px-4 py-3 text-gray-300 truncate max-w-xs",children:n.target_path}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(O,{status:n.status})}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:n.files_scanned}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:n.matches_found>0?"text-red-400 font-semibold":"text-gray-400",children:n.matches_found})}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(n.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>l(n),className:"p-1 text-gray-400 hover:text-white",title:"View Details",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>a.mutate(n.id),className:"p-1 text-gray-400 hover:text-red-400",title:"Delete",children:e.jsx(E,{className:"h-4 w-4"})})]})})]},n.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No YARA scans yet"}),e.jsx("button",{onClick:()=>r(!0),className:"mt-4 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg",children:"Start Your First Scan"})]}),t&&e.jsx(Te,{onClose:()=>r(!1)}),d&&e.jsx(Pe,{scan:d,onClose:()=>l(null)})]})}function Fe(){const s=R(),[t,r]=m.useState(!1),[d,l]=m.useState(null),{data:u,isLoading:h}=_({queryKey:["yara","monitors"],queryFn:b.listMonitors,refetchInterval:1e4}),a=C({mutationFn:b.deleteMonitor,onSuccess:()=>{y.success("Monitor deleted"),s.invalidateQueries({queryKey:["yara","monitors"]})},onError:()=>y.error("Failed to delete monitor")}),n=C({mutationFn:({id:c,status:p})=>b.updateMonitorStatus(c,p),onSuccess:()=>{s.invalidateQueries({queryKey:["yara","monitors"]})},onError:()=>y.error("Failed to update status")}),i=c=>{switch(c){case"active":return e.jsx(K,{className:"h-4 w-4 animate-pulse"});case"paused":return e.jsx(X,{className:"h-4 w-4"});case"stopped":return e.jsx(V,{className:"h-4 w-4"});case"error":return e.jsx(B,{className:"h-4 w-4"});default:return e.jsx(be,{className:"h-4 w-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"File System Monitors"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Real-time YARA scanning of file system changes"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg",children:[e.jsx(Y,{className:"h-4 w-4"}),"New Monitor"]})]}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-cyan-400"})}):u&&u.length>0?e.jsx("div",{className:"grid gap-4",children:u.map(c=>{var p,w;return e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${c.status==="active"?"bg-green-500/20":c.status==="paused"?"bg-yellow-500/20":c.status==="error"?"bg-red-500/20":"bg-gray-500/20"}`,children:i(c.status)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:c.name}),e.jsxs("p",{className:"text-gray-400 text-sm flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),c.watch_path,c.recursive&&e.jsx("span",{className:"text-cyan-400",children:"(recursive)"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[((p=c.file_patterns)==null?void 0:p.length)||0," patterns"]}),e.jsxs("span",{className:"text-gray-500",children:[((w=c.rule_ids)==null?void 0:w.length)||0," rules"]}),c.alerts_count>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(ae,{className:"h-3 w-3"}),c.alerts_count," alerts"]})]}),c.error_message&&e.jsx("p",{className:"text-red-400 text-sm mt-2",children:c.error_message})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{status:c.status}),e.jsxs("div",{className:"flex items-center gap-1",children:[c.status==="active"?e.jsx("button",{onClick:()=>n.mutate({id:c.id,status:"paused"}),className:"p-1 text-gray-400 hover:text-yellow-400",title:"Pause",children:e.jsx(X,{className:"h-4 w-4"})}):c.status!=="error"?e.jsx("button",{onClick:()=>n.mutate({id:c.id,status:"active"}),className:"p-1 text-gray-400 hover:text-green-400",title:"Start",children:e.jsx(z,{className:"h-4 w-4"})}):null,e.jsx("button",{onClick:()=>l(c),className:"p-1 text-gray-400 hover:text-white",title:"View Alerts",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>a.mutate(c.id),className:"p-1 text-gray-400 hover:text-red-400",title:"Delete",children:e.jsx(E,{className:"h-4 w-4"})})]})]})]})},c.id)})}):e.jsxs("div",{className:"text-center py-12 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx(K,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No file monitors configured"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Create a monitor to scan files in real-time"}),e.jsx("button",{onClick:()=>r(!0),className:"mt-4 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg",children:"Create First Monitor"})]}),t&&e.jsx(De,{onClose:()=>r(!1)}),d&&e.jsx(Ee,{monitor:d,onClose:()=>l(null)})]})}function Ae(){R();const[s,t]=m.useState(!1),{data:r,isLoading:d}=_({queryKey:["yara","effectiveness","summary"],queryFn:b.getEffectivenessSummary}),{data:l,isLoading:u}=_({queryKey:["yara","effectiveness",{reviewOnly:s}],queryFn:s?b.getRulesNeedingReview:b.getEffectiveness}),h=d||u;return e.jsxs("div",{className:"space-y-6",children:[r&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:e.jsx(ue,{className:"h-5 w-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-white",children:[Math.round(r.avg_effectiveness_score),"%"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Effectiveness"})]})]})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(ye,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:r.total_true_positives}),e.jsx("p",{className:"text-sm text-gray-400",children:"True Positives"})]})]})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(pe,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:r.total_false_positives}),e.jsx("p",{className:"text-sm text-gray-400",children:"False Positives"})]})]})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/20 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:r.rules_needing_review}),e.jsx("p",{className:"text-sm text-gray-400",children:"Need Review"})]})]})})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Grade Distribution"}),e.jsx("div",{className:"flex items-end gap-4 h-32",children:["A","B","C","D","F"].map(a=>{const n=r.grade_distribution[a]||0,i=Math.max(...Object.values(r.grade_distribution),1),c=n/i*100,p=I[a];return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-400",children:n}),e.jsx("div",{className:`w-full ${p.bg} rounded-t transition-all`,style:{height:`${Math.max(c,4)}%`}}),e.jsx("span",{className:`text-sm font-semibold ${p.text}`,children:a})]},a)})})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confidence Distribution"}),e.jsx("div",{className:"space-y-3",children:["high","medium","low"].map(a=>{const n=r.confidence_distribution[a]||0,i=Object.values(r.confidence_distribution).reduce((w,S)=>w+S,0)||1,c=n/i*100,p=Q[a];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:p.text,children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsxs("span",{className:"text-gray-400",children:[n," rules"]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${p.bg} transition-all`,style:{width:`${c}%`}})})]},a)})})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-gray-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:a=>t(a.target.checked),className:"rounded border-gray-600"}),"Show only rules needing review"]})}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-cyan-400"})}):l&&l.length>0?e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Rule"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase",children:"Grade"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase",children:"Score"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase",children:"TP / FP"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase",children:"Confidence"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:l.map(a=>e.jsxs("tr",{className:`hover:bg-gray-750 ${a.needs_review?"bg-yellow-500/5":""}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"text-white font-medium",children:a.rule_name}),a.last_match_at&&e.jsxs("p",{className:"text-gray-500 text-xs",children:["Last match: ",new Date(a.last_match_at).toLocaleDateString()]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(q,{category:a.category||"generic"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(we,{grade:a.grade})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`text-lg font-semibold ${a.effectiveness_score>=80?"text-green-400":a.effectiveness_score>=60?"text-yellow-400":"text-red-400"}`,children:[Math.round(a.effectiveness_score),"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsx("span",{className:"text-green-400",children:a.true_positives}),e.jsx("span",{className:"text-gray-500 mx-1",children:"/"}),e.jsx("span",{className:"text-red-400",children:a.false_positives})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(Ce,{confidence:a.confidence})}),e.jsx("td",{className:"px-4 py-3",children:a.needs_review?e.jsxs("div",{className:"flex items-center gap-1 text-yellow-400 text-sm",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:a.review_reason||"Needs Review"})]}):e.jsxs("span",{className:"text-green-400 text-sm flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4"}),"Good"]})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx(se,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No effectiveness data yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Run scans and verify matches to build effectiveness metrics"})]})]})}function $e({onClose:s}){const t=R(),[r,d]=m.useState(""),[l,u]=m.useState(""),[h,a]=m.useState("custom"),n=C({mutationFn:b.createRule,onSuccess:()=>{y.success("Rule created"),t.invalidateQueries({queryKey:["yara"]}),s()},onError:i=>y.error(i.message||"Failed to create rule")});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Create YARA Rule"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Rule Name"}),e.jsx("input",{type:"text",value:r,onChange:i=>d(i.target.value),placeholder:"e.g., Detect_Ransomware_LockBit",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Category"}),e.jsxs("select",{value:h,onChange:i=>a(i.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white",children:[e.jsx("option",{value:"custom",children:"Custom"}),e.jsx("option",{value:"malware",children:"Malware"}),e.jsx("option",{value:"ransomware",children:"Ransomware"}),e.jsx("option",{value:"apt",children:"APT"}),e.jsx("option",{value:"packer",children:"Packer"}),e.jsx("option",{value:"webshell",children:"Webshell"}),e.jsx("option",{value:"exploit",children:"Exploit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Rule Content"}),e.jsx("textarea",{value:l,onChange:i=>u(i.target.value),placeholder:`rule example {
  strings:
    $a = "malicious"
  condition:
    $a
}`,rows:12,className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white font-mono text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:()=>n.mutate({name:r,rule_text:l,category:h}),disabled:!r||!l||n.isPending,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-cyan-800 text-white rounded-lg",children:[n.isPending&&e.jsx(v,{className:"h-4 w-4 animate-spin"}),"Create Rule"]})]})]})]})})}function qe({rule:s,onClose:t}){return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.name}),e.jsx(q,{category:s.category}),s.is_builtin&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded",children:"Built-in"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[s.description&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-300",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Match Count: ",e.jsx("span",{className:"text-white",children:s.match_count})]}),e.jsxs("span",{className:"text-gray-400",children:["Created: ",e.jsx("span",{className:"text-white",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-gray-400",children:"Rule Content"}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(s.rule_text),y.success("Copied to clipboard")},className:"flex items-center gap-1 px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-xs",children:[e.jsx(te,{className:"h-3 w-3"})," Copy"]})]}),e.jsx("pre",{className:"bg-gray-900 p-4 rounded-lg overflow-x-auto text-sm text-gray-300 font-mono",children:s.rule_text})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(r=>e.jsx("span",{className:"px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-sm",children:r},r))})]})]})]})})}function Te({onClose:s}){const t=R(),[r,d]=m.useState(""),[l,u]=m.useState(!0),h=C({mutationFn:b.scanPath,onSuccess:()=>{y.success("Scan started"),t.invalidateQueries({queryKey:["yara","scans"]}),s()},onError:a=>y.error(a.message||"Failed to start scan")});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"New YARA Scan"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Target Path"}),e.jsx("input",{type:"text",value:r,onChange:a=>d(a.target.value),placeholder:"/path/to/scan",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:a=>u(a.target.checked),className:"rounded border-gray-600"}),"Scan recursively"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:()=>h.mutate({path:r,recursive:l}),disabled:!r||h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-cyan-800 text-white rounded-lg",children:[h.isPending?e.jsx(v,{className:"h-4 w-4 animate-spin"}):e.jsx(z,{className:"h-4 w-4"}),"Start Scan"]})]})]})]})})}function Pe({scan:s,onClose:t}){const{data:r,isLoading:d}=_({queryKey:["yara","scan",s.id],queryFn:()=>b.getScan(s.id)});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.name||"Scan Details"}),e.jsx(O,{status:s.status})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Target:"}),e.jsx("p",{className:"text-white",children:s.target_path})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Rules Used:"}),e.jsx("p",{className:"text-white",children:s.rules_used})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Files Scanned:"}),e.jsx("p",{className:"text-white",children:s.files_scanned})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Matches Found:"}),e.jsx("p",{className:s.matches_found>0?"text-red-400 font-semibold":"text-white",children:s.matches_found})]})]}),s.error_message&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-red-400 text-sm",children:s.error_message})}),d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(v,{className:"h-6 w-6 animate-spin text-cyan-400"})}):r!=null&&r.matches&&r.matches.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium mb-3",children:"Matches"}),e.jsx("div",{className:"space-y-2",children:r.matches.map((l,u)=>e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-cyan-400 font-medium",children:l.rule_name}),e.jsx("span",{className:"text-gray-400 text-xs",children:new Date(l.matched_at).toLocaleString()})]}),l.file_path&&e.jsx("p",{className:"text-gray-300 text-sm truncate",children:l.file_path}),l.matched_strings&&l.matched_strings.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-400 text-xs",children:"Matched Strings:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:l.matched_strings.map((h,a)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-800 text-gray-300 rounded text-xs font-mono",children:h},a))})]})]},u))})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No matches found"})]})]})]})})}function De({onClose:s}){const t=R(),[r,d]=m.useState(""),[l,u]=m.useState(""),[h,a]=m.useState(!0),[n,i]=m.useState(""),{data:c}=_({queryKey:["yara","rules"],queryFn:()=>b.listRules()}),[p,w]=m.useState([]),S=C({mutationFn:b.createMonitor,onSuccess:()=>{y.success("Monitor created"),t.invalidateQueries({queryKey:["yara","monitors"]}),s()},onError:j=>y.error(j.message||"Failed to create monitor")}),M=()=>{if(!r||!l){y.error("Name and watch path are required");return}S.mutate({name:r,watch_path:l,recursive:h,file_patterns:n?n.split(",").map(j=>j.trim()).filter(Boolean):void 0,rule_ids:p.length>0?p:void 0})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Create File Monitor"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Monitor Name *"}),e.jsx("input",{type:"text",value:r,onChange:j=>d(j.target.value),placeholder:"e.g., Downloads Folder Monitor",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Watch Path *"}),e.jsx("input",{type:"text",value:l,onChange:j=>u(j.target.value),placeholder:"/path/to/watch",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"File Patterns (comma-separated)"}),e.jsx("input",{type:"text",value:n,onChange:j=>i(j.target.value),placeholder:"*.exe, *.dll, *.pdf",className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to match all files"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:j=>a(j.target.checked),className:"rounded border-gray-600"}),"Watch subdirectories recursively"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"YARA Rules to Use"}),e.jsx("div",{className:"max-h-40 overflow-y-auto bg-gray-900 border border-gray-700 rounded-lg p-2",children:c&&c.length>0?e.jsx("div",{className:"space-y-1",children:c.filter(j=>j.enabled).map(j=>e.jsxs("label",{className:"flex items-center gap-2 text-gray-300 text-sm cursor-pointer hover:bg-gray-800 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:p.includes(j.id),onChange:k=>{k.target.checked?w([...p,j.id]):w(p.filter(g=>g!==j.id))},className:"rounded border-gray-600"}),e.jsx("span",{className:"flex-1",children:j.name}),e.jsx(q,{category:j.category||"generic"})]},j.id))}):e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No enabled rules available"})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p.length===0?"All enabled rules will be used":`${p.length} rules selected`})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t border-gray-700",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:M,disabled:!r||!l||S.isPending,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-cyan-800 text-white rounded-lg",children:[S.isPending&&e.jsx(v,{className:"h-4 w-4 animate-spin"}),"Create Monitor"]})]})]})})}function Ee({monitor:s,onClose:t}){const r=R(),{data:d,isLoading:l}=_({queryKey:["yara","monitor",s.id,"alerts"],queryFn:()=>b.getMonitorAlerts(s.id),refetchInterval:5e3}),u=C({mutationFn:b.acknowledgeAlert,onSuccess:()=>{y.success("Alert acknowledged"),r.invalidateQueries({queryKey:["yara","monitor",s.id,"alerts"]})}}),h={created:{bg:"bg-green-500/20",text:"text-green-400"},modified:{bg:"bg-yellow-500/20",text:"text-yellow-400"},renamed:{bg:"bg-blue-500/20",text:"text-blue-400"},deleted:{bg:"bg-red-500/20",text:"text-red-400"}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white",children:[s.name," - Alerts"]}),e.jsx("p",{className:"text-sm text-gray-400",children:s.watch_path})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:l?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"h-6 w-6 animate-spin text-cyan-400"})}):d&&d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(a=>{const n=h[a.event_type]||h.modified;return e.jsx("div",{className:`bg-gray-900 border rounded-lg p-3 ${a.acknowledged?"border-gray-700 opacity-60":"border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-cyan-400 font-medium",children:a.rule_name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${n.bg} ${n.text}`,children:a.event_type}),e.jsx(ve,{severity:a.severity||"medium"})]}),e.jsx("p",{className:"text-gray-300 text-sm truncate",children:a.file_path}),a.file_hash&&e.jsxs("p",{className:"text-gray-500 text-xs mt-1 font-mono",children:["MD5: ",a.file_hash]}),a.matched_strings&&a.matched_strings.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[a.matched_strings.slice(0,5).map((i,c)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-800 text-gray-400 rounded text-xs font-mono",children:i},c)),a.matched_strings.length>5&&e.jsxs("span",{className:"text-gray-500 text-xs",children:["+",a.matched_strings.length-5," more"]})]}),e.jsx("p",{className:"text-gray-500 text-xs mt-2",children:new Date(a.created_at).toLocaleString()})]}),e.jsx("div",{className:"flex items-center gap-2",children:a.acknowledged?e.jsxs("span",{className:"text-gray-500 text-xs flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),"Ack'd"]}):e.jsx("button",{onClick:()=>u.mutate(a.id),disabled:u.isPending,className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-xs",children:"Acknowledge"})})]})},a.id)})}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No alerts for this monitor"})]})})]})})}function Ye(){const[s,t]=m.useState("dashboard"),r=[{id:"dashboard",label:"Dashboard",icon:e.jsx(de,{className:"h-4 w-4"})},{id:"rules",label:"Rules",icon:e.jsx(P,{className:"h-4 w-4"})},{id:"builder",label:"Visual Builder",icon:e.jsx(ee,{className:"h-4 w-4"})},{id:"community",label:"Community",icon:e.jsx(L,{className:"h-4 w-4"})},{id:"scans",label:"Scans",icon:e.jsx(D,{className:"h-4 w-4"})},{id:"monitors",label:"Monitors",icon:e.jsx(K,{className:"h-4 w-4"})},{id:"effectiveness",label:"Effectiveness",icon:e.jsx(se,{className:"h-4 w-4"})}];return e.jsx(fe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:e.jsx(ie,{className:"h-6 w-6 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"YARA Rule Management"}),e.jsx("p",{className:"text-gray-400",children:"Create, manage, and scan with YARA detection rules"})]})]})}),e.jsx("div",{className:"border-b border-gray-700",children:e.jsx("div",{className:"flex gap-1",children:r.map(d=>e.jsxs("button",{onClick:()=>t(d.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors border-b-2 -mb-px ${s===d.id?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-gray-200"}`,children:[d.icon,d.label]},d.id))})}),e.jsxs("div",{children:[s==="dashboard"&&e.jsx(Se,{}),s==="rules"&&e.jsx(_e,{}),s==="builder"&&e.jsx(ke,{}),s==="community"&&e.jsx(Re,{}),s==="scans"&&e.jsx(Me,{}),s==="monitors"&&e.jsx(Fe,{}),s==="effectiveness"&&e.jsx(Ae,{})]})]})})}export{Ye as default};
