import{j as e}from"./vendor-state-DdX3IZQk.js";import{j as D,r as a,L as E}from"./vendor-react-Da1CiaFS.js";import{P as h}from"./PortalLayout-D3znrbCx.js";import{av as d}from"./index-DQiW-u5-.js";import"./vendor-ui-DU7fCopR.js";import"./vendor-charts-BthoN68t.js";const F={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-green-600 text-white"},R={open:"bg-red-900/50 text-red-200",in_progress:"bg-blue-900/50 text-blue-200",pending_verification:"bg-yellow-900/50 text-yellow-200",resolved:"bg-green-900/50 text-green-200",accepted_risk:"bg-purple-900/50 text-purple-200"},M={open:["in_progress","accepted_risk"],in_progress:["pending_verification","accepted_risk","resolved"],pending_verification:["in_progress"]};function q(){var N;const{id:r}=D(),[s,C]=a.useState(null),[b,S]=a.useState([]),[_,k]=a.useState(!0),[y,A]=a.useState(""),[l,v]=a.useState(""),[i,n]=a.useState(!1),[c,m]=a.useState(""),[x,g]=a.useState(null);a.useEffect(()=>{r&&(j(),p())},[r]);const j=async()=>{if(r)try{const t=await d.getById(r);C(t.data)}catch(t){A("Failed to load vulnerability"),console.error(t)}finally{k(!1)}},p=async()=>{if(r)try{const t=await d.getComments(r);S(t.data.comments)}catch(t){console.error("Failed to load comments:",t)}},V=async t=>{var o,w;if(r){n(!0);try{await d.updateStatus(r,t,c||void 0),j(),c&&p(),g(null),m("")}catch(P){alert(((w=(o=P.response)==null?void 0:o.data)==null?void 0:w.error)||"Failed to update status")}finally{n(!1)}}},L=async t=>{if(t.preventDefault(),!(!r||!l.trim())){n(!0);try{await d.addComment(r,l),v(""),p()}catch(o){console.error("Failed to add comment:",o)}finally{n(!1)}}};if(_)return e.jsx(h,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})});if(y||!s)return e.jsx(h,{children:e.jsx("div",{className:"bg-red-900/50 text-red-200 p-4 rounded-lg",children:y||"Vulnerability not found"})});const u=s.vulnerability.status,f=M[u]||[];return e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{to:"/portal/vulnerabilities",className:"text-gray-400 hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-white flex-1",children:s.vulnerability.title}),e.jsx("span",{className:`px-3 py-1 rounded text-sm font-medium ${F[s.vulnerability.severity]||"bg-gray-600"}`,children:s.vulnerability.severity.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${R[u]||"bg-gray-700 text-gray-300"}`,children:u.replace("_"," ")})})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"CVSS Score"}),e.jsx("p",{className:"text-xl font-semibold text-white",children:((N=s.vulnerability.cvss_score)==null?void 0:N.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Host"}),e.jsxs("p",{className:"text-white",children:[s.vulnerability.host,s.vulnerability.port?`:${s.vulnerability.port}`:""]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Service"}),e.jsx("p",{className:"text-white",children:s.vulnerability.service||"Unknown"})]})]}),f.length>0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Update Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(t=>e.jsxs("button",{onClick:()=>g(t),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm",children:[t==="in_progress"&&"Start Working",t==="pending_verification"&&"Request Verification",t==="accepted_risk"&&"Accept Risk",t==="resolved"&&"Mark Resolved"]},t))})]}),s.vulnerability.cve_ids&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"CVE IDs"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.vulnerability.cve_ids.split(",").map(t=>e.jsx("a",{href:`https://nvd.nist.gov/vuln/detail/${t.trim()}`,target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 bg-blue-900/50 text-blue-300 rounded text-sm hover:bg-blue-800/50",children:t.trim()},t))})]}),s.description&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:s.description})]}),s.remediation&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Remediation"}),e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:s.remediation})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Comments"}),e.jsxs("form",{onSubmit:L,className:"mb-6",children:[e.jsx("textarea",{value:l,onChange:t=>v(t.target.value),placeholder:"Add a comment...",className:"w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-blue-500 resize-none",rows:3}),e.jsx("button",{type:"submit",disabled:i||!l.trim(),className:"mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm disabled:opacity-50",children:i?"Adding...":"Add Comment"})]}),b.length===0?e.jsx("p",{className:"text-gray-400",children:"No comments yet"}):e.jsx("div",{className:"space-y-4",children:b.map(t=>e.jsxs("div",{className:"border-l-2 border-gray-600 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-blue-400",children:t.user_email}),e.jsx("span",{className:"text-gray-500",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("p",{className:"text-gray-300 mt-1",children:t.comment})]},t.id))})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Change Status to: ",x.replace("_"," ")]}),e.jsx("textarea",{value:c,onChange:t=>m(t.target.value),placeholder:"Add a comment (optional)...",className:"w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-blue-500 resize-none mb-4",rows:3}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{g(null),m("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>V(x),disabled:i,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg disabled:opacity-50",children:i?"Updating...":"Confirm"})]})]})})]})}export{q as default};
