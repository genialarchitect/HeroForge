import{j as e}from"./vendor-state-DrZ0R9WI.js";import{r}from"./vendor-react-HUtzaQ-y.js";import{a as ae,A as w,D as he,l as pe,p as ye,d as fe}from"./index-Dfnp1sHX.js";import{B as g,L as Q,aH as je,aI as ve,a9 as Ne}from"./vendor-ui-DVewFML6.js";import"./vendor-charts-Cc2OJGc4.js";const we=({scanId:b,onVulnerabilityClick:E})=>{const[o,y]=r.useState([]),[d,$]=r.useState(!0),[m,C]=r.useState(null),[n,h]=r.useState(!1),[x,k]=r.useState(new Set),[M,T]=r.useState([]),[_,u]=r.useState(!1),[D,R]=r.useState(!1),[L,c]=r.useState(""),[p,j]=r.useState(""),A=[{id:"open",title:"Open",color:"bg-red-900/20 border-red-700"},{id:"in_progress",title:"In Progress",color:"bg-yellow-900/20 border-yellow-700"},{id:"pending_verification",title:"Pending Verification",color:"bg-blue-900/20 border-blue-700"},{id:"resolved",title:"Resolved",color:"bg-green-900/20 border-green-700"}];r.useEffect(()=>{v(),S()},[b]);const S=async()=>{try{const s=await ae.getUsers();T(s.data)}catch(s){console.debug("Could not load users list:",s)}},v=async()=>{try{if($(!0),!b){y([]);return}const s=await w.list({scan_id:b});y(s.data)}catch(s){console.error("Failed to load vulnerabilities:",s)}finally{$(!1)}},B=(s,a)=>{C(a),s.dataTransfer.effectAllowed="move"},q=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},H=async(s,a)=>{if(s.preventDefault(),!(!m||m.status===a||n))try{h(!0),await w.update(m.id,{status:a}),await v(),C(null)}catch(N){console.error("Failed to update vulnerability status:",N)}finally{h(!1)}},J=()=>{C(null)},O=(s,a)=>{a.stopPropagation();const N=new Set(x);N.has(s)?N.delete(s):N.add(s),k(N)},f=async s=>{if(x.size!==0)try{h(!0),await w.bulkUpdate({vulnerability_ids:Array.from(x),status:s}),g.success(`Updated ${x.size} vulnerabilities to ${s.replace(/_/g," ")}`),k(new Set),await v()}catch(a){console.error("Failed to bulk update status:",a),g.error("Failed to update vulnerabilities")}finally{h(!1)}},F=async()=>{if(x.size!==0)try{h(!0),await w.bulkUpdate({vulnerability_ids:Array.from(x),assignee_id:L||void 0}),g.success(`Assigned ${x.size} vulnerabilities`),k(new Set),u(!1),c(""),await v()}catch(s){console.error("Failed to bulk assign:",s),g.error("Failed to assign vulnerabilities")}finally{h(!1)}},U=async()=>{if(!(x.size===0||!p))try{h(!0),await w.bulkUpdate({vulnerability_ids:Array.from(x),due_date:`${p}T00:00:00Z`}),g.success(`Updated due date for ${x.size} vulnerabilities`),k(new Set),R(!1),j(""),await v()}catch(s){console.error("Failed to bulk update due date:",s),g.error("Failed to update due dates")}finally{h(!1)}},W=()=>{k(new Set)},P=s=>o.filter(a=>a.status===s),I=s=>{switch(s.toLowerCase()){case"critical":return"border-l-4 border-red-500";case"high":return"border-l-4 border-orange-500";case"medium":return"border-l-4 border-yellow-500";case"low":return"border-l-4 border-blue-500";default:return"border-l-4 border-gray-500"}},K=s=>{if(!s)return null;const a={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-blue-600 text-white"};return e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${a[s.toLowerCase()]||"bg-gray-600 text-white"}`,children:s.charAt(0).toUpperCase()})};return d?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):b?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Remediation Board"}),e.jsxs("div",{className:"flex gap-2",children:[x.size>0&&e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded",children:[x.size," selected"]}),e.jsx("button",{onClick:v,className:"px-3 py-1 text-sm bg-gray-700 text-gray-300 rounded hover:bg-gray-600",children:"Refresh"})]})]}),x.size>0&&e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-gray-400 text-sm mr-2",children:"Bulk Actions:"}),e.jsx("button",{onClick:()=>f("in_progress"),disabled:n,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600",children:"Mark In Progress"}),e.jsx("button",{onClick:()=>f("pending_verification"),disabled:n,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600",children:"Mark Pending Verification"}),e.jsx("button",{onClick:()=>f("resolved"),disabled:n,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-600",children:"Mark Resolved"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:()=>u(!0),disabled:n,className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 disabled:bg-gray-600",children:"Assign"}),e.jsx("button",{onClick:()=>R(!0),disabled:n,className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-600",children:"Set Due Date"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:W,className:"px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-500",children:"Clear Selection"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:A.map(s=>e.jsxs("div",{className:`rounded-lg border-2 ${s.color} p-4 min-h-[400px] transition-colors ${m&&m.status!==s.id?"ring-2 ring-blue-500/50":""}`,onDragOver:q,onDrop:a=>H(a,s.id),children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 text-white flex justify-between items-center",children:[e.jsx("span",{children:s.title}),e.jsx("span",{className:"text-sm font-normal text-gray-400 bg-gray-800 px-2 py-0.5 rounded",children:P(s.id).length})]}),e.jsxs("div",{className:"space-y-2",children:[P(s.id).map(a=>e.jsxs("div",{draggable:!n&&!x.has(a.id),onDragStart:N=>B(N,a),onDragEnd:J,onClick:()=>E==null?void 0:E(a.id),className:`bg-gray-800 p-3 rounded shadow cursor-move hover:shadow-lg hover:bg-gray-750 transition-all ${I(a.severity)} ${(m==null?void 0:m.id)===a.id?"opacity-50":""} ${n?"cursor-not-allowed":""} ${x.has(a.id)?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:x.has(a.id),onClick:N=>O(a.id,N),onChange:()=>{},className:"rounded border-gray-600 text-blue-600 focus:ring-blue-500 bg-gray-700"}),e.jsx("div",{className:"font-medium text-sm text-white truncate",children:a.vulnerability_id})]}),K(a.priority)]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 ml-6",children:a.host_ip}),a.port&&e.jsxs("div",{className:"text-xs text-gray-500 ml-6",children:["Port: ",a.port]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 ml-6",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${a.severity==="critical"?"bg-red-900/50 text-red-300":a.severity==="high"?"bg-orange-900/50 text-orange-300":a.severity==="medium"?"bg-yellow-900/50 text-yellow-300":"bg-blue-900/50 text-blue-300"}`,children:a.severity}),a.assignee_id&&e.jsx("span",{className:"text-xs text-gray-500",children:"Assigned"})]}),a.due_date&&e.jsxs("div",{className:`text-xs mt-1 ml-6 ${new Date(a.due_date)<new Date?"text-red-400":"text-gray-500"}`,children:["Due: ",new Date(a.due_date).toLocaleDateString()]}),a.estimated_effort&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 ml-6",children:["Est: ",a.estimated_effort,"h",a.actual_effort?` / Actual: ${a.actual_effort}h`:""]})]},a.id)),P(s.id).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No vulnerabilities"})]})]},s.id))}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-400 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Critical"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"High"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{children:"Low"})]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Assign ",x.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Select Assignee"}),e.jsxs("select",{value:L,onChange:s=>c(s.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),M.map(s=>e.jsxs("option",{value:s.id,children:[s.username," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{u(!1),c("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:n,children:"Cancel"}),e.jsx("button",{onClick:F,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:n?"Assigning...":"Assign"})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Set Due Date for ",x.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:p,onChange:s=>j(s.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{R(!1),j("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:n,children:"Cancel"}),e.jsx("button",{onClick:U,disabled:n||!p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:n?"Updating...":"Set Due Date"})]})]})})]}):e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Select a scan to view the remediation board"})},ke=({vulnerabilityId:b,currentUserId:E,onCommentsChange:o,initialComments:y})=>{const[d,$]=r.useState(y||[]),[m,C]=r.useState(!y),[n,h]=r.useState(""),[x,k]=r.useState(!1),[M,T]=r.useState(null),_=r.useCallback(async()=>{try{C(!0);const c=await w.getComments(b);$(c.data)}catch(c){console.error("Failed to load comments:",c),g.error("Failed to load comments")}finally{C(!1)}},[b]);r.useEffect(()=>{y||_()},[_,y]),r.useEffect(()=>{y&&$(y)},[y]);const u=async c=>{if(c.preventDefault(),!!n.trim())try{k(!0),await w.addComment(b,n.trim()),h(""),g.success("Comment added"),await _(),o==null||o()}catch(p){console.error("Failed to add comment:",p),g.error("Failed to add comment")}finally{k(!1)}},D=async c=>{var p,j;try{T(c),await w.deleteComment(b,c),g.success("Comment deleted"),await _(),o==null||o()}catch(A){console.error("Failed to delete comment:",A);const S=A;g.error(((j=(p=S.response)==null?void 0:p.data)==null?void 0:j.error)||"Failed to delete comment")}finally{T(null)}},R=c=>new Date(c).toLocaleString(),L=c=>{const p=new Date(c),A=new Date().getTime()-p.getTime(),S=Math.floor(A/6e4),v=Math.floor(S/60),B=Math.floor(v/24);return S<1?"just now":S<60?`${S}m ago`:v<24?`${v}h ago`:B<7?`${B}d ago`:p.toLocaleDateString()};return m?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Q,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Loading comments..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("form",{onSubmit:u,className:"space-y-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:n,onChange:c=>h(c.target.value),rows:3,className:"block w-full rounded-lg bg-gray-800 border border-gray-600 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500 placeholder-gray-500 resize-none pr-12",placeholder:"Add a comment...",disabled:x}),e.jsx("button",{type:"submit",disabled:x||!n.trim(),className:"absolute bottom-3 right-3 p-2 rounded-lg bg-cyan-600 text-white hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",title:"Send comment",children:x?e.jsx(Q,{className:"h-4 w-4 animate-spin"}):e.jsx(je,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-3",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No comments yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Be the first to add a comment"})]}):d.map(c=>{const p=E===c.user_id,j=M===c.id;return e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white text-sm font-semibold",children:c.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:c.username}),e.jsx("div",{className:"text-xs text-gray-500",title:R(c.created_at),children:L(c.created_at)})]})]}),e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap break-words",children:c.comment})]}),p&&e.jsx("button",{onClick:()=>D(c.id),disabled:j,className:"p-2 rounded-lg text-gray-500 hover:text-red-400 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-shrink-0",title:"Delete comment",children:j?e.jsx(Q,{className:"h-4 w-4 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4"})})]})},c.id)})}),d.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center pt-2",children:[d.length," ",d.length===1?"comment":"comments"]})]})},_e=({vulnerabilityId:b,onClose:E,onUpdate:o})=>{const{user:y}=he(),[d,$]=r.useState(null),[m,C]=r.useState(!0),[n,h]=r.useState(!1),[x,k]=r.useState("info"),[M,T]=r.useState([]),[_,u]=r.useState(""),[D,R]=r.useState(""),[L,c]=r.useState(""),[p,j]=r.useState(""),[A,S]=r.useState(""),[v,B]=r.useState(""),[q,H]=r.useState(""),[J,O]=r.useState(""),[f,F]=r.useState(!1),[U,W]=r.useState(!1),[P,I]=r.useState(""),[K,s]=r.useState(!1),[a,N]=r.useState("still_vulnerable");r.useEffect(()=>{V(),re()},[b]);const re=async()=>{try{const t=await ae.getUsers();T(t.data)}catch(t){console.debug("Could not load users list:",t)}},V=async()=>{var t;try{C(!0);const i=await w.get(b);$(i.data),u(i.data.vulnerability.status),R(i.data.vulnerability.priority||"medium"),c(i.data.vulnerability.notes||""),j(i.data.vulnerability.assignee_id||""),S(((t=i.data.vulnerability.due_date)==null?void 0:t.split("T")[0])||""),B(i.data.vulnerability.remediation_steps||""),H(i.data.vulnerability.estimated_effort||""),O(i.data.vulnerability.actual_effort||"")}catch(i){console.error("Failed to load vulnerability detail:",i)}finally{C(!1)}},X=async()=>{var t;if(d)try{F(!0),await w.update(b,{status:_!==d.vulnerability.status?_:void 0,priority:D!==(d.vulnerability.priority||"medium")?D:void 0,notes:L!==(d.vulnerability.notes||"")?L:void 0,assignee_id:p!==(d.vulnerability.assignee_id||"")&&p||void 0,due_date:A!==(((t=d.vulnerability.due_date)==null?void 0:t.split("T")[0])||"")&&A?`${A}T00:00:00Z`:void 0,remediation_steps:v!==(d.vulnerability.remediation_steps||"")?v:void 0,estimated_effort:typeof q=="number"?q:void 0,actual_effort:typeof J=="number"?J:void 0}),g.success("Vulnerability updated successfully"),await V(),h(!1),o==null||o()}catch(i){console.error("Failed to update vulnerability:",i),g.error("Failed to update vulnerability")}finally{F(!1)}},le=async()=>{try{F(!0),await w.markForVerification(b,{}),g.success("Vulnerability marked for verification"),await V(),o==null||o()}catch(t){console.error("Failed to mark for verification:",t),g.error("Failed to mark for verification")}finally{F(!1)}},ie=async()=>{await V()},de=async()=>{var t,i;if(d){W(!0);try{const Z=await pe.createTicket(b);g.success(`JIRA ticket ${Z.data.jira_ticket_key} created successfully!`),await V(),o==null||o()}catch(Z){console.error("Failed to create JIRA ticket:",Z);const ge=Z;g.error(((i=(t=ge.response)==null?void 0:t.data)==null?void 0:i.error)||"Failed to create JIRA ticket")}finally{W(!1)}}},ne=async()=>{try{F(!0),await w.requestRetest(b,{notes:P||void 0}),g.success("Retest requested successfully"),I(""),await V(),o==null||o()}catch(t){console.error("Failed to request retest:",t),g.error("Failed to request retest")}finally{F(!1)}},oe=async()=>{try{F(!0),await w.completeRetest(b,{result:a,notes:P||void 0}),g.success(`Retest completed: ${a.replace(/_/g," ")}`),s(!1),I(""),N("still_vulnerable"),await V(),o==null||o()}catch(t){console.error("Failed to complete retest:",t),g.error("Failed to complete retest")}finally{F(!1)}},Y=()=>{var t;d&&(h(!1),u(d.vulnerability.status),R(d.vulnerability.priority||"medium"),c(d.vulnerability.notes||""),j(d.vulnerability.assignee_id||""),S(((t=d.vulnerability.due_date)==null?void 0:t.split("T")[0])||""),B(d.vulnerability.remediation_steps||""),H(d.vulnerability.estimated_effort||""),O(d.vulnerability.actual_effort||""))},ce=t=>{const i="px-3 py-1 text-sm font-semibold rounded-full";switch(t.toLowerCase()){case"critical":return`${i} bg-red-900/50 text-red-300`;case"high":return`${i} bg-orange-900/50 text-orange-300`;case"medium":return`${i} bg-yellow-900/50 text-yellow-300`;case"low":return`${i} bg-blue-900/50 text-blue-300`;default:return`${i} bg-gray-700 text-gray-300`}},xe=t=>{const i="px-3 py-1 text-sm font-semibold rounded-full";switch(t){case"open":return`${i} bg-red-900/50 text-red-300`;case"in_progress":return`${i} bg-yellow-900/50 text-yellow-300`;case"pending_verification":return`${i} bg-blue-900/50 text-blue-300`;case"resolved":return`${i} bg-green-900/50 text-green-300`;case"false_positive":return`${i} bg-gray-700 text-gray-300`;case"accepted_risk":return`${i} bg-purple-900/50 text-purple-300`;default:return`${i} bg-gray-700 text-gray-300`}},ee=t=>t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),ue=t=>{const i="px-3 py-1 text-sm font-semibold rounded-full";switch(t){case"remediated":return`${i} bg-green-900/50 text-green-300`;case"partially_remediated":return`${i} bg-yellow-900/50 text-yellow-300`;case"still_vulnerable":return`${i} bg-red-900/50 text-red-300`;default:return`${i} bg-blue-900/50 text-blue-300`}},z=t=>new Date(t).toLocaleString(),me=t=>t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),be=()=>!d||!d.timeline||d.timeline.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No timeline events"}):e.jsx("div",{className:"space-y-4",children:d.timeline.map(t=>e.jsxs("div",{className:"border-l-2 border-blue-600 pl-4 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("div",{className:"font-medium text-white",children:t.username}),e.jsx("div",{className:"text-xs text-gray-400",children:z(t.created_at)})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:me(t.event_type)}),t.old_value&&t.new_value&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Changed from"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:t.old_value})," ","to"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:t.new_value})]}),t.comment&&e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:t.comment})]},t.id))});if(m)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-lg p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})});if(!d)return null;const{vulnerability:l,comments:G,resolved_by_user:te,verified_by_user:se}=d;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-900 border-b border-gray-700 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l.vulnerability_id}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-white text-2xl leading-none",children:"Ã—"})]}),e.jsx("div",{className:"flex gap-4 mt-4",children:[{id:"info",label:"Information"},{id:"remediation",label:"Remediation"},{id:"timeline",label:"Timeline"},{id:"comments",label:`Comments${G.length>0?` (${G.length})`:""}`}].map(t=>e.jsx("button",{onClick:()=>k(t.id),className:`pb-2 px-1 border-b-2 transition-colors ${x===t.id?"border-blue-500 text-blue-400 font-semibold":"border-transparent text-gray-400 hover:text-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{className:"p-6",children:[x==="info"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Host"}),e.jsx("div",{className:"text-white",children:l.host_ip})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Port"}),e.jsx("div",{className:"text-white",children:l.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Severity"}),e.jsx("div",{children:e.jsx("span",{className:ce(l.severity),children:l.severity.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),n?e.jsxs("select",{value:_,onChange:t=>u(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"}),e.jsx("option",{value:"accepted_risk",children:"Accepted Risk"})]}):e.jsx("span",{className:xe(l.status),children:ee(l.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Priority"}),n?e.jsxs("select",{value:D,onChange:t=>R(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}):e.jsx("div",{className:"text-white",children:(l.priority||"medium").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assignee"}),n?e.jsxs("select",{value:p,onChange:t=>j(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),M.map(t=>e.jsxs("option",{value:t.id,children:[t.username," (",t.email,")"]},t.id))]}):e.jsx("div",{className:"text-white",children:d!=null&&d.assignee?d.assignee.username:"Unassigned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Due Date"}),n?e.jsx("input",{type:"date",value:A,onChange:t=>S(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"}):e.jsx("div",{className:`text-white ${l.due_date&&new Date(l.due_date)<new Date?"text-red-400":""}`,children:l.due_date?new Date(l.due_date).toLocaleDateString():"Not set"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Created"}),e.jsx("div",{className:"text-gray-300",children:z(l.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Updated"}),e.jsx("div",{className:"text-gray-300",children:z(l.updated_at)})]}),l.resolved_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved At"}),e.jsx("div",{className:"text-gray-300",children:z(l.resolved_at)})]}),te&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved By"}),e.jsx("div",{className:"text-gray-300",children:te.username})]})]}),l.verified_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified At"}),e.jsx("div",{className:"text-gray-300",children:z(l.verified_at)})]}),se&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified By"}),e.jsx("div",{className:"text-gray-300",children:se.username})]})]})]}),l.retest_requested_at&&e.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-200 mb-3",children:"Retest Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Requested At"}),e.jsx("div",{className:"text-indigo-200",children:z(l.retest_requested_at)})]}),l.retest_completed_at?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Completed At"}),e.jsx("div",{className:"text-indigo-200",children:z(l.retest_completed_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Result"}),e.jsx("span",{className:ue(l.retest_result),children:ee(l.retest_result||"")})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Status"}),e.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-yellow-900/50 text-yellow-300",children:"Pending Retest"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes"}),n?e.jsx("textarea",{value:L,onChange:t=>c(t.target.value),rows:4,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about this vulnerability..."}):e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap bg-gray-800 p-3 rounded-md",children:l.notes||"No notes"})]}),(l.jira_ticket_id||l.jira_ticket_key)&&e.jsx("div",{className:"bg-blue-900/30 border border-blue-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-300 mb-1",children:"JIRA Ticket"}),e.jsx("div",{className:"text-blue-200 font-semibold",children:l.jira_ticket_key})]}),l.jira_ticket_url&&e.jsxs("a",{href:l.jira_ticket_url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 inline-flex items-center gap-2",children:["View in JIRA",e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:X,disabled:f,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:f?"Saving...":"Save Changes"}),e.jsx("button",{onClick:Y,disabled:f,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit"}),l.status==="in_progress"&&e.jsx("button",{onClick:le,disabled:f,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-600",children:"Mark for Verification"}),!l.jira_ticket_id&&e.jsx("button",{onClick:de,disabled:U,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-600 inline-flex items-center gap-2",children:U?"Creating...":"Create JIRA Ticket"}),!l.retest_requested_at&&l.status!=="resolved"&&e.jsx("button",{onClick:ne,disabled:f,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-600",children:"Request Retest"}),l.retest_requested_at&&!l.retest_completed_at&&e.jsx("button",{onClick:()=>s(!0),disabled:f,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:"Complete Retest"})]})})]}),x==="remediation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Estimated Effort (hours)"}),n?e.jsx("input",{type:"number",value:q,onChange:t=>H(t.target.value?parseInt(t.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:l.estimated_effort?`${l.estimated_effort} hours`:"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Actual Effort (hours)"}),n?e.jsx("input",{type:"number",value:J,onChange:t=>O(t.target.value?parseInt(t.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:l.actual_effort?`${l.actual_effort} hours`:"Not set"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Remediation Steps"}),n?e.jsx("textarea",{value:v,onChange:t=>B(t.target.value),rows:10,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 font-mono text-sm",placeholder:"Enter detailed remediation steps (markdown supported)..."}):e.jsx("div",{className:"bg-gray-800 p-4 rounded-md whitespace-pre-wrap text-gray-300",children:l.remediation_steps||"No remediation steps defined"})]}),n&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:X,disabled:f,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:f?"Saving...":"Save Changes"}),e.jsx("button",{onClick:Y,disabled:f,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}),!n&&e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit Remediation"})]}),x==="timeline"&&be(),x==="comments"&&e.jsx("div",{className:"space-y-6",children:e.jsx(ke,{vulnerabilityId:b,currentUserId:y==null?void 0:y.id,onCommentsChange:ie,initialComments:G})})]})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Complete Retest"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Retest Result"}),e.jsxs("select",{value:a,onChange:t=>N(t.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"still_vulnerable",children:"Still Vulnerable"}),e.jsx("option",{value:"remediated",children:"Remediated"}),e.jsx("option",{value:"partially_remediated",children:"Partially Remediated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:P,onChange:t=>I(t.target.value),rows:3,className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about the retest result..."})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 justify-end",children:[e.jsx("button",{onClick:()=>{s(!1),I(""),N("still_vulnerable")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{onClick:oe,disabled:f,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:f?"Completing...":"Complete Retest"})]})]})})]})},$e=()=>{const[b,E]=r.useState([]),[o,y]=r.useState(),[d,$]=r.useState(null),[m,C]=r.useState(null),[n,h]=r.useState(!0);r.useEffect(()=>{x()},[]),r.useEffect(()=>{o&&k()},[o]);const x=async()=>{try{h(!0);const D=(await ye.getAll()).data.filter(R=>R.status==="completed");E(D),D.length>0&&!o&&y(D[0].id)}catch(u){console.error("Failed to load scans:",u)}finally{h(!1)}},k=async()=>{if(o)try{const u=await w.getStats(o);C(u.data)}catch(u){console.error("Failed to load stats:",u)}},M=u=>{$(u)},T=()=>{$(null)},_=()=>{k()};return e.jsxs(fe,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Remediation Workflow"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Track and manage vulnerability remediation progress with a Kanban-style board"})]}),e.jsxs("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Scan"}),e.jsxs("select",{value:o||"",onChange:u=>y(u.target.value||void 0),className:"w-full md:w-96 rounded-md bg-dark-bg border-dark-border text-white shadow-sm focus:border-primary focus:ring-primary",disabled:n,children:[e.jsx("option",{value:"",children:"Select a scan..."}),b.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",new Date(u.created_at).toLocaleDateString()]},u.id))]})]}),m&&e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg px-4 py-2 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:m.total}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-severity-critical/20 rounded-lg px-4 py-2 text-center border border-severity-critical/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-critical",children:m.open}),e.jsx("div",{className:"text-xs text-slate-400",children:"Open"})]}),e.jsxs("div",{className:"bg-severity-medium/20 rounded-lg px-4 py-2 text-center border border-severity-medium/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-medium",children:m.in_progress}),e.jsx("div",{className:"text-xs text-slate-400",children:"In Progress"})]}),e.jsxs("div",{className:"bg-status-completed/20 rounded-lg px-4 py-2 text-center border border-status-completed/50",children:[e.jsx("div",{className:"text-2xl font-bold text-status-completed",children:m.resolved}),e.jsx("div",{className:"text-xs text-slate-400",children:"Resolved"})]})]})]}),m&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"By Severity"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-critical"}),e.jsxs("span",{className:"text-slate-300",children:["Critical: ",m.critical]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-high"}),e.jsxs("span",{className:"text-slate-300",children:["High: ",m.high]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-medium"}),e.jsxs("span",{className:"text-slate-300",children:["Medium: ",m.medium]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-low"}),e.jsxs("span",{className:"text-slate-300",children:["Low: ",m.low]})]})]})]})]}),e.jsx("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:n?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):b.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("p",{className:"text-lg mb-2",children:"No completed scans found"}),e.jsx("p",{className:"text-sm",children:"Run a scan with vulnerability detection enabled to see results here"})]}):e.jsx(we,{scanId:o,onVulnerabilityClick:M})})]}),d&&e.jsx(_e,{vulnerabilityId:d,onClose:T,onUpdate:_})]})};export{$e as default};
