import{j as e}from"./vendor-state-DrZ0R9WI.js";import{r as l}from"./vendor-react-HUtzaQ-y.js";import{B as h,G as u,I as F,P as x,b7 as o,aa as p,N as w,H as f,Y as j,h as _,b as O,Q as T,S as G}from"./vendor-ui-DVewFML6.js";import{p as Q,C as n,L as M,B as Y,b as y,P as S,Q as q}from"./index-Dfnp1sHX.js";const W=()=>{const[g,C]=l.useState([]),[k,v]=l.useState(!0),[d,P]=l.useState(""),[i,R]=l.useState(""),[H,N]=l.useState(!1),[a,I]=l.useState(null),[b,B]=l.useState(new Set);l.useEffect(()=>{E()},[]);const E=async()=>{v(!0);try{const r=(await Q.getAll()).data.filter(c=>c.status==="completed");C(r)}catch(s){h.error("Failed to load scans"),console.error(s)}finally{v(!1)}},L=async()=>{var s,r;if(!d||!i){h.error("Please select two scans to compare");return}if(d===i){h.error("Please select two different scans");return}N(!0);try{const c=await q.compare(d,i);I(c.data),h.success("Comparison completed")}catch(c){const t=c;h.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Failed to compare scans"),console.error(c)}finally{N(!1)}},V=s=>{const r=new Set(b);r.has(s)?r.delete(s):r.add(s),B(r)},A=s=>{switch(s){case"NewService":return e.jsx(x,{className:"h-3 w-3 text-green-400"});case"ServiceRemoved":return e.jsx(o,{className:"h-3 w-3 text-red-400"});case"ServiceChanged":case"VersionChanged":return e.jsx(p,{className:"h-3 w-3 text-yellow-400"});default:return null}},$=s=>{switch(s){case"NewService":return"New Service";case"ServiceRemoved":return"Service Removed";case"ServiceChanged":return"Service Changed";case"VersionChanged":return"Version Changed";default:return s}};return k?e.jsx(n,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(u,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Compare Scans"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Select two completed scans to compare their results and identify changes in hosts, ports, services, and vulnerabilities."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Baseline Scan (Older)"}),e.jsxs("select",{value:d,onChange:s=>P(s.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",new Date(s.created_at).toLocaleString()]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Comparison Scan (Newer)"}),e.jsxs("select",{value:i,onChange:s=>R(s.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",new Date(s.created_at).toLocaleString()]},s.id))]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(Y,{variant:"primary",onClick:L,loading:H,disabled:!d||!i||d===i,children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Compare Scans"]})})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(F,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Comparison Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(x,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Hosts"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:a.diff.summary.total_new_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Removed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:a.diff.summary.total_removed_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(p,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Changed"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:a.diff.summary.total_hosts_changed})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Ports"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:a.diff.summary.total_new_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Closed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:a.diff.summary.total_closed_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Vulns"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:a.diff.summary.total_new_vulnerabilities})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(j,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:a.diff.summary.total_resolved_vulnerabilities})]})]})]}),a.diff.new_hosts.length>0&&e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(x,{className:"h-5 w-5 text-green-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["New Hosts (",a.diff.new_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.diff.new_hosts.map(s=>e.jsx("span",{className:"px-3 py-1.5 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 font-mono text-sm",children:s},s))})]}),a.diff.removed_hosts.length>0&&e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(o,{className:"h-5 w-5 text-red-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Removed Hosts (",a.diff.removed_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.diff.removed_hosts.map(s=>e.jsx("span",{className:"px-3 py-1.5 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 font-mono text-sm",children:s},s))})]}),a.diff.host_changes.length>0&&e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Host Changes (",a.diff.host_changes.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:a.diff.host_changes.map(s=>{const r=b.has(s.ip);return s.new_ports.length>0||s.closed_ports.length>0||s.new_vulnerabilities.length>0||s.resolved_vulnerabilities.length>0||s.service_changes.length>0||s.os_change!==null?e.jsxs("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:[e.jsxs("button",{onClick:()=>V(s.ip),className:"w-full flex items-center justify-between p-4 hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r?e.jsx(O,{className:"h-4 w-4 text-slate-400"}):e.jsx(T,{className:"h-4 w-4 text-slate-400"}),e.jsx(_,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-mono text-white",children:s.ip}),s.hostname&&e.jsxs("span",{className:"text-sm text-slate-400",children:["(",s.hostname,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.new_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["+",s.new_ports.length," ports"]}),s.closed_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["-",s.closed_ports.length," ports"]}),s.new_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["+",s.new_vulnerabilities.length," vulns"]}),s.resolved_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["-",s.resolved_vulnerabilities.length," vulns"]})]})]}),r&&e.jsxs("div",{className:"border-t border-dark-border p-4 space-y-4",children:[s.os_change&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-2",children:"Operating System Change"}),e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-sm text-red-400",children:[s.os_change.old_os," (",s.os_change.old_confidence,"% confidence)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-sm text-green-400",children:[s.os_change.new_os," (",s.os_change.new_confidence,"% confidence)"]})]})]})]}),s.new_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4 text-green-400"}),"New Open Ports (",s.new_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.new_ports.map(t=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-green-400",children:[t.port,"/",t.protocol]}),t.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[t.service.name,t.service.version&&` ${t.service.version}`]})]},t.port))})]}),s.closed_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4 text-red-400"}),"Closed Ports (",s.closed_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.closed_ports.map(t=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-red-400",children:[t.port,"/",t.protocol]}),t.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[t.service.name,t.service.version&&` ${t.service.version}`]})]},t.port))})]}),s.service_changes.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-yellow-400"}),"Service Changes (",s.service_changes.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.service_changes.map((t,m)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-white",children:[t.port,"/",t.protocol]}),e.jsxs("div",{className:"flex items-center gap-2",children:[A(t.change_type),e.jsx("span",{className:"text-xs text-yellow-400",children:$(t.change_type)})]})]}),t.old_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(o,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[t.old_service,t.old_version&&` ${t.old_version}`]})]}),t.new_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(x,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-green-400",children:[t.new_service,t.new_version&&` ${t.new_version}`]})]})]},m))})]}),s.new_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 text-red-400"}),"New Vulnerabilities (",s.new_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.new_vulnerabilities.map((t,m)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:t.cve_id||t.title}),e.jsx(y,{variant:"severity",type:S(t.severity),children:t.severity})]}),e.jsx("p",{className:"text-xs text-slate-400",children:t.description}),t.affected_service&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Service: ",t.affected_service]})]},m))})]}),s.resolved_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-green-400"}),"Resolved Vulnerabilities (",s.resolved_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.resolved_vulnerabilities.map((t,m)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1 opacity-75",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-green-400 line-through",children:t.cve_id||t.title}),e.jsx(y,{variant:"severity",type:S(t.severity),children:t.severity})]}),e.jsx("p",{className:"text-xs text-slate-500",children:t.description})]},m))})]})]})]},s.ip):null})})]}),a.diff.new_hosts.length===0&&a.diff.removed_hosts.length===0&&a.diff.host_changes.length===0&&e.jsx(n,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-white font-medium mb-2",children:"No Changes Detected"}),e.jsx("p",{className:"text-sm text-slate-400",children:"The selected scans have identical results"})]})})]}),!a&&g.length===0&&e.jsx(n,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No completed scans available"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Complete at least two scans to use the comparison feature"})]})})]})};export{W as S};
