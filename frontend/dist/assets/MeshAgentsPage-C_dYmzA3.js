import{j as e,b as ke,u as U,d as M}from"./vendor-state-DdX3IZQk.js";import{R as X,r as _}from"./vendor-react-Da1CiaFS.js";import{n as D,bD as he,bA as fe,a0 as ve,Z as O,N as V,Q as H,A as W,a9 as Y,L as Ne,a1 as ye,g as q,av as me,an as L,f as te,am as we,ab as se,a8 as ue,ac as ge,b as _e,aa as Ce,T as Se,bE as $e,aV as Ae,X as be,a2 as pe,bC as Te,a3 as ne,I as ee,i as Le,B as k}from"./vendor-ui-FPrw-IJL.js";import{b as E,B as j,$ as Me,d as De}from"./index-DvzsJW7u.js";import"./vendor-charts-F3s652Wz.js";const ie={online:{label:"Online",variant:"success",icon:e.jsx(ye,{className:"w-3 h-3"})},busy:{label:"Busy",variant:"warning",icon:e.jsx(W,{className:"w-3 h-3"})},offline:{label:"Offline",variant:"danger",icon:e.jsx(Y,{className:"w-3 h-3"})},joining:{label:"Joining",variant:"info",icon:e.jsx(Ne,{className:"w-3 h-3 animate-spin"})},leaving:{label:"Leaving",variant:"secondary",icon:e.jsx(Y,{className:"w-3 h-3"})},disconnected:{label:"Disconnected",variant:"danger",icon:e.jsx(Y,{className:"w-3 h-3"})},unknown:{label:"Unknown",variant:"secondary",icon:e.jsx(W,{className:"w-3 h-3"})}},ce=({agent:s,isLeader:a=!1,onClick:r,onPing:o,onRemove:y,showActions:w=!0})=>{const[g,h]=X.useState(!1),x=X.useRef(null);X.useEffect(()=>{const u=p=>{x.current&&!x.current.contains(p.target)&&h(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const f=ie[s.status]||ie.unknown,m=Math.round(s.load*100),v=s.max_tasks>0?s.current_tasks/s.max_tasks*100:0,S=u=>{const p=new Date(u),b=new Date().getTime()-p.getTime(),$=Math.floor(b/6e4);if($<1)return"Just now";if($<60)return`${$}m ago`;const P=Math.floor($/60);return P<24?`${P}h ago`:p.toLocaleDateString()};return e.jsxs("div",{className:`relative bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4 transition-all ${r?"cursor-pointer hover:border-primary/50 hover:shadow-lg":""}`,onClick:r,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.status==="online"?"bg-green-500/20":s.status==="busy"?"bg-yellow-500/20":"bg-slate-500/20"}`,children:e.jsx(D,{className:`w-5 h-5 ${s.status==="online"?"text-green-400":s.status==="busy"?"text-yellow-400":"text-slate-400"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:s.name}),a&&e.jsx("span",{title:"Cluster Leader",children:e.jsx(he,{className:"w-4 h-4 text-yellow-400"})})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[s.address,":",s.mesh_port]})]})]}),w&&e.jsxs("div",{className:"relative",ref:x,children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),h(!g)},className:"p-1 rounded hover:bg-light-hover dark:hover:bg-dark-hover",children:e.jsx(fe,{className:"w-4 h-4 text-slate-400"})}),g&&e.jsxs("div",{className:"absolute right-0 mt-1 w-40 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-lg py-1 z-10",children:[o&&e.jsx("button",{onClick:u=>{u.stopPropagation(),o(),h(!1)},className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-light-hover dark:hover:bg-dark-hover",children:"Ping Agent"}),y&&e.jsx("button",{onClick:u=>{u.stopPropagation(),y(),h(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-light-hover dark:hover:bg-dark-hover",children:"Remove Agent"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs(E,{variant:f.variant,children:[f.icon,e.jsx("span",{className:"ml-1",children:f.label})]}),s.latency_ms!==null&&s.status==="online"&&e.jsxs("span",{className:"text-xs text-slate-400",children:[s.latency_ms,"ms"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-light-hover dark:bg-dark-hover rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(ve,{className:"w-3 h-3"}),"Load"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${m>80?"bg-red-500":m>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${m}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:[m,"%"]})]})]}),e.jsxs("div",{className:"bg-light-hover dark:bg-dark-hover rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(O,{className:"w-3 h-3"}),"Tasks"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${v>80?"bg-red-500":v>50?"bg-yellow-500":"bg-cyan-500"}`,style:{width:`${v}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:[s.current_tasks,"/",s.max_tasks]})]})]})]}),s.capabilities.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1.5",children:[e.jsx(O,{className:"w-3 h-3"}),"Capabilities"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.capabilities.slice(0,4).map(u=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-cyan-500/10 text-cyan-400 rounded",children:u},u)),s.capabilities.length>4&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-slate-500/10 text-slate-400 rounded",children:["+",s.capabilities.length-4," more"]})]})]}),s.network_zones.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1.5",children:[e.jsx(V,{className:"w-3 h-3"}),"Network Zones"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.network_zones.map(u=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-purple-500/10 text-purple-400 rounded",children:u},u))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-light-border dark:border-dark-border text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),S(s.last_seen)]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-slate-400",children:["v",s.protocol_version]})})]})]})},ze=({cluster:s,onViewDetails:a,onEditConfig:r,onDelete:o,onElectLeader:y,showActions:w=!0})=>{const g=s.health,h=s.config,x=g.online_members+g.offline_members,f=x>0?Math.round(g.online_members/x*100):0,m=Math.round(g.average_load*100),S=g.is_healthy?g.offline_members>0?{label:"Degraded",variant:"warning",icon:e.jsx(ue,{className:"w-4 h-4"})}:{label:"Healthy",variant:"success",icon:e.jsx(ge,{className:"w-4 h-4"})}:{label:"Unhealthy",variant:"danger",icon:e.jsx(se,{className:"w-4 h-4"})},u=x>=((h==null?void 0:h.min_quorum_size)||1),p=s.members.find(N=>N.agent_id===s.leader_agent_id);return e.jsxs("div",{className:`bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg overflow-hidden ${a?"cursor-pointer hover:border-primary/50":""}`,onClick:a,children:[e.jsx("div",{className:"p-4 border-b border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${g.is_healthy?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx(q,{className:`w-5 h-5 ${g.is_healthy?"text-green-400":"text-red-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 line-clamp-1",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(E,{variant:S.variant,children:[S.icon,e.jsx("span",{className:"ml-1",children:S.label})]})})]})}),e.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(D,{className:"w-3 h-3"}),"Members"]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[g.online_members,e.jsxs("span",{className:"text-sm font-normal text-slate-400",children:["/",x]})]}),e.jsx("div",{className:"mt-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${f===100?"bg-green-500":f>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${f}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(O,{className:"w-3 h-3"}),"Tasks"]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:g.total_tasks}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(me,{className:"w-3 h-3"}),"Avg Load"]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[m,"%"]}),e.jsx("div",{className:"mt-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${m>80?"bg-red-500":m>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${m}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(W,{className:"w-3 h-3"}),"Quorum"]}),e.jsx("div",{className:`text-2xl font-bold ${u?"text-green-400":"text-red-400"}`,children:u?"Yes":"No"}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["min: ",(h==null?void 0:h.min_quorum_size)||1]})]})]}),p&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-500/10 rounded-lg",children:[e.jsx(he,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Leader:"}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:p.name}),e.jsxs("span",{className:"text-xs text-slate-400",children:["(",p.address,":",p.mesh_port,")"]})]})}),h&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[h.enable_work_stealing&&e.jsx("span",{className:"px-2 py-1 bg-cyan-500/10 text-cyan-400 rounded",children:"Work Stealing"}),h.enable_gossip&&e.jsx("span",{className:"px-2 py-1 bg-purple-500/10 text-purple-400 rounded",children:"Gossip Protocol"}),h.enable_mdns&&e.jsx("span",{className:"px-2 py-1 bg-blue-500/10 text-blue-400 rounded",children:"mDNS Discovery"}),h.auto_elect_leader&&e.jsx("span",{className:"px-2 py-1 bg-yellow-500/10 text-yellow-400 rounded",children:"Auto Leader Election"})]})}),w&&e.jsxs("div",{className:"px-4 pb-4 flex items-center gap-2",children:[y&&e.jsxs(j,{size:"sm",variant:"outline",onClick:N=>{N.stopPropagation(),y()},children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"Elect Leader"]}),r&&e.jsxs(j,{size:"sm",variant:"outline",onClick:N=>{N.stopPropagation(),r()},children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"Configure"]}),o&&e.jsxs(j,{size:"sm",variant:"ghost",onClick:N=>{N.stopPropagation(),o()},className:"text-red-400 hover:text-red-300",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),"Delete"]})]}),g.last_check&&e.jsxs("div",{className:"px-4 pb-3 text-xs text-slate-400",children:["Last health check: ",new Date(g.last_check).toLocaleString()]})]})},oe={pending:{label:"Pending",variant:"warning",icon:e.jsx(H,{className:"w-3 h-3"})},running:{label:"Running",variant:"info",icon:e.jsx(Ae,{className:"w-3 h-3"})},completed:{label:"Completed",variant:"success",icon:e.jsx(ge,{className:"w-3 h-3"})},failed:{label:"Failed",variant:"danger",icon:e.jsx(ue,{className:"w-3 h-3"})}},xe=({tasks:s,agents:a=[],isLoading:r=!1,onCancelTask:o,onRetryTask:y,onReassignTask:w,onBulkCancel:g,onRefresh:h})=>{const[x,f]=_.useState(new Set),[m,v]=_.useState(null),[S,u]=_.useState(null),[p,N]=_.useState("all"),b=s.filter(l=>p==="all"?!0:l.status===p),$=s.filter(l=>l.status==="pending").length,P=s.filter(l=>l.status==="running").length,R=s.filter(l=>l.status==="completed").length,I=s.filter(l=>l.status==="failed").length,G=l=>{const n=new Set(x);n.has(l)?n.delete(l):n.add(l),f(n)},K=()=>{x.size===b.length?f(new Set):f(new Set(b.map(l=>l.task.id)))},J=()=>{g&&x.size>0&&(g(Array.from(x)),f(new Set))},Z=l=>{const n=new Date(l),A=new Date().getTime()-n.getTime(),T=Math.floor(A/6e4),i=Math.floor(T/60);return T<1?"Just now":T<60?`${T}m`:i<24?`${i}h ${T%60}m`:`${Math.floor(i/24)}d ${i%24}h`};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Task Queue"}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.size>0&&g&&e.jsxs(j,{size:"sm",variant:"danger",onClick:J,children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Cancel Selected (",x.size,")"]}),h&&e.jsxs(j,{size:"sm",variant:"outline",onClick:h,disabled:r,children:[e.jsx(L,{className:`w-3 h-3 mr-1 ${r?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("button",{onClick:()=>N("all"),className:`px-3 py-1 rounded-full transition-colors ${p==="all"?"bg-slate-500/20 text-slate-200":"text-slate-400 hover:text-slate-200"}`,children:["All (",s.length,")"]}),e.jsxs("button",{onClick:()=>N("pending"),className:`px-3 py-1 rounded-full transition-colors ${p==="pending"?"bg-yellow-500/20 text-yellow-400":"text-slate-400 hover:text-yellow-400"}`,children:["Pending (",$,")"]}),e.jsxs("button",{onClick:()=>N("running"),className:`px-3 py-1 rounded-full transition-colors ${p==="running"?"bg-blue-500/20 text-blue-400":"text-slate-400 hover:text-blue-400"}`,children:["Running (",P,")"]}),e.jsxs("button",{onClick:()=>N("completed"),className:`px-3 py-1 rounded-full transition-colors ${p==="completed"?"bg-green-500/20 text-green-400":"text-slate-400 hover:text-green-400"}`,children:["Completed (",R,")"]}),e.jsxs("button",{onClick:()=>N("failed"),className:`px-3 py-1 rounded-full transition-colors ${p==="failed"?"bg-red-500/20 text-red-400":"text-slate-400 hover:text-red-400"}`,children:["Failed (",I,")"]})]})]}),e.jsxs("div",{className:"divide-y divide-light-border dark:divide-dark-border",children:[b.length>0&&e.jsxs("div",{className:"px-4 py-2 bg-light-hover dark:bg-dark-hover flex items-center gap-3 text-sm",children:[e.jsx("input",{type:"checkbox",checked:x.size===b.length&&b.length>0,onChange:K,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:x.size>0?`${x.size} selected`:"Select all"})]}),r&&s.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(L,{className:"w-8 h-8 text-slate-400 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"Loading tasks..."})]}):b.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{className:"w-8 h-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"No tasks in queue"})]}):b.map(l=>{const n=l.task,z=oe[l.status]||oe.pending,A=m===n.id,T=a.find(i=>i.agent_id===l.assigned_agent_id);return e.jsxs("div",{className:"hover:bg-light-hover dark:hover:bg-dark-hover",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:x.has(n.id),onChange:()=>G(n.id),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("button",{onClick:()=>v(A?null:n.id),className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded",children:A?e.jsx(_e,{className:"w-4 h-4 text-slate-400"}):e.jsx(Ce,{className:"w-4 h-4 text-slate-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white truncate",children:n.task_type}),e.jsxs(E,{variant:z.variant,size:"sm",children:[z.icon,e.jsx("span",{className:"ml-1",children:z.label})]}),e.jsxs(E,{variant:"secondary",size:"sm",children:["P",n.priority]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3"}),n.targets.slice(0,3).join(", "),n.targets.length>3&&` +${n.targets.length-3}`]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),Z(l.queued_at)]}),T&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),T.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[l.status==="failed"&&y&&e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>y(n.id),title:"Retry task",children:e.jsx(L,{className:"w-4 h-4"})}),w&&a.length>0&&(l.status==="pending"||l.status==="failed")&&e.jsxs("div",{className:"relative",children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>u(S===n.id?null:n.id),title:"Reassign task",children:e.jsx($e,{className:"w-4 h-4"})}),S===n.id&&e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-lg py-1 z-10",children:a.filter(i=>i.status==="online"||i.status==="busy").map(i=>e.jsxs("button",{onClick:()=>{w(n.id,i.agent_id),u(null)},className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-light-hover dark:hover:bg-dark-hover flex items-center gap-2",children:[e.jsx(D,{className:"w-3 h-3"}),i.name,e.jsx("span",{className:`ml-auto text-xs ${i.status==="online"?"text-green-400":"text-yellow-400"}`,children:i.status})]},i.agent_id))})]}),o&&(l.status==="pending"||l.status==="running")&&e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>o(n.id),className:"text-red-400 hover:text-red-300",title:"Cancel task",children:e.jsx(se,{className:"w-4 h-4"})})]})]}),A&&e.jsxs("div",{className:"px-4 pb-3 ml-12 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Scan ID"}),e.jsx("p",{className:"font-mono text-slate-900 dark:text-white text-xs",children:n.scan_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Timeout"}),e.jsxs("p",{className:"text-slate-900 dark:text-white",children:[n.timeout_seconds,"s"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Attempts"}),e.jsx("p",{className:"text-slate-900 dark:text-white",children:l.attempts})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Queued At"}),e.jsx("p",{className:"text-slate-900 dark:text-white",children:new Date(l.queued_at).toLocaleString()})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.required_capabilities.map(i=>e.jsx("span",{className:"text-xs px-2 py-1 bg-cyan-500/10 text-cyan-400 rounded",children:i},i)),n.required_zones.map(i=>e.jsx("span",{className:"text-xs px-2 py-1 bg-purple-500/10 text-purple-400 rounded",children:i},i))]}),l.last_error&&e.jsxs("div",{className:"p-2 bg-red-500/10 border border-red-500/20 rounded text-sm text-red-400",children:[e.jsx("strong",{children:"Error:"})," ",l.last_error]}),n.targets.length>3&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"All Targets:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:n.targets.map(i=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-slate-500/10 text-slate-400 rounded",children:i},i))})]})]})]},n.id)})]})]})},Qe=({config:s,onChange:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Cluster Configuration"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Min Quorum Size"}),e.jsx("input",{type:"number",min:1,value:s.min_quorum_size??1,onChange:r=>a({...s,min_quorum_size:parseInt(r.target.value)||1}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Heartbeat Interval (secs)"}),e.jsx("input",{type:"number",min:1,value:s.heartbeat_interval_secs??10,onChange:r=>a({...s,heartbeat_interval_secs:parseInt(r.target.value)||10}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Peer Timeout (secs)"}),e.jsx("input",{type:"number",min:1,value:s.peer_timeout_secs??30,onChange:r=>a({...s,peer_timeout_secs:parseInt(r.target.value)||30}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Gossip Fanout"}),e.jsx("input",{type:"number",min:1,value:s.gossip_fanout??3,onChange:r=>a({...s,gossip_fanout:parseInt(r.target.value)||3}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Max Steal Batch"}),e.jsx("input",{type:"number",min:1,value:s.max_steal_batch??5,onChange:r=>a({...s,max_steal_batch:parseInt(r.target.value)||5}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Registry URL (optional)"}),e.jsx("input",{type:"url",value:s.registry_url??"",onChange:r=>a({...s,registry_url:r.target.value||null}),placeholder:"https://heroforge.example.com",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.auto_elect_leader??!0,onChange:r=>a({...s,auto_elect_leader:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Auto Elect Leader"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enable_work_stealing??!0,onChange:r=>a({...s,enable_work_stealing:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Work Stealing"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enable_gossip??!0,onChange:r=>a({...s,enable_gossip:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Gossip Protocol"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enable_mdns??!0,onChange:r=>a({...s,enable_mdns:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"mDNS Discovery"})]})]})]}),Fe=({existingConfig:s,agentId:a,onSave:r,onCancel:o,isLoading:y=!1})=>{const[w,g]=_.useState((s==null?void 0:s.enabled)??!0),[h,x]=_.useState((s==null?void 0:s.mesh_port)??9876),[f,m]=_.useState((s==null?void 0:s.external_address)??""),[v,S]=_.useState((s==null?void 0:s.cluster_id)??""),[u,p]=_.useState((s==null?void 0:s.cluster_role)??"member"),N=b=>{b.preventDefault(),r(s?{enabled:w,mesh_port:h,external_address:f||void 0,cluster_id:v||void 0,cluster_role:u||void 0}:{agent_id:a,enabled:w,mesh_port:h,external_address:f||void 0,cluster_id:v||void 0})};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),s?"Edit Mesh Configuration":"Create Mesh Configuration"]}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-light-hover dark:hover:bg-dark-hover rounded",children:e.jsx(be,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:N,className:"p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Basic Settings"]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:b=>g(b.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:"Enable Mesh Networking"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Allow this agent to participate in the mesh network"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Mesh Port"}),e.jsx("input",{type:"number",min:1,max:65535,value:h,onChange:b=>x(parseInt(b.target.value)||9876),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Default: 9876"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"External Address (optional)"}),e.jsx("input",{type:"text",value:f,onChange:b=>m(b.target.value),placeholder:"e.g., 10.0.0.5",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Override auto-detected address"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Cluster Settings"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Cluster ID (optional)"}),e.jsx("input",{type:"text",value:v,onChange:b=>S(b.target.value),placeholder:"Leave empty for standalone",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Cluster Role"}),e.jsxs("select",{value:u,onChange:b=>p(b.target.value),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"leader",children:"Leader"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(j,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsxs(j,{type:"submit",loading:y,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Save Configuration"]})]})]})]})},Pe=({onSubmit:s,onCancel:a,isLoading:r=!1,existingCluster:o})=>{const[y,w]=_.useState((o==null?void 0:o.name)??""),[g,h]=_.useState((o==null?void 0:o.description)??""),[x,f]=_.useState((o==null?void 0:o.config)??{}),m=v=>{v.preventDefault(),s({name:y,description:g||void 0,config:Object.keys(x).length>0?x:void 0})};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),o?"Edit Cluster":"Create New Cluster"]}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-light-hover dark:hover:bg-dark-hover rounded",children:e.jsx(be,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:m,className:"p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Cluster Name *"}),e.jsx("input",{type:"text",value:y,onChange:v=>w(v.target.value),required:!0,placeholder:"e.g., Production Scanners",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:g,onChange:v=>h(v.target.value),rows:2,placeholder:"Describe the purpose of this cluster...",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]})]}),e.jsx(Qe,{config:x,onChange:f}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsxs(j,{type:"submit",loading:r,disabled:!y.trim(),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),o?"Update Cluster":"Create Cluster"]})]})]})]})},c=Me.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(s=>{const a=localStorage.getItem("token");return a&&(s.headers.Authorization=`Bearer ${a}`),s});const Ee=()=>c.get("/agents/mesh/dashboard"),Re=()=>c.get("/agents/mesh/work-stealing/stats"),qe=s=>c.get("/agents/mesh/agents",{params:s}),Ie=s=>c.get(`/agents/mesh/agents/${s}`),Ke=s=>c.get(`/agents/mesh/agents/${s}/config`),Be=s=>c.post("/agents/mesh/config",s),Ue=(s,a)=>c.patch(`/agents/mesh/agents/${s}/config`,a),Oe=s=>c.delete(`/agents/mesh/agents/${s}/config`),He=s=>c.get(`/agents/mesh/agents/${s}/peer-stats`),We=s=>c.post(`/agents/mesh/agents/${s}/ping`),Ve=s=>c.delete(`/agents/mesh/agents/${s}`),Ge=s=>c.get("/agents/mesh/clusters",{params:s}),Je=s=>c.get(`/agents/mesh/clusters/${s}`),Ze=s=>c.post("/agents/mesh/clusters",s),Xe=(s,a)=>c.patch(`/agents/mesh/clusters/${s}`,a),Ye=s=>c.delete(`/agents/mesh/clusters/${s}`),es=s=>c.get(`/agents/mesh/clusters/${s}/config`),ss=(s,a)=>c.patch(`/agents/mesh/clusters/${s}/config`,a),ts=(s,a)=>c.post(`/agents/mesh/clusters/${s}/agents/${a}`),as=(s,a)=>c.delete(`/agents/mesh/clusters/${s}/agents/${a}`),rs=(s,a)=>c.post(`/agents/mesh/clusters/${s}/leader`,{agent_id:a}),ls=s=>c.post(`/agents/mesh/clusters/${s}/elect-leader`),ds=s=>c.get("/agents/mesh/tasks",{params:s}),ns=s=>c.get(`/agents/mesh/tasks/${s}`),is=s=>c.post(`/agents/mesh/tasks/${s}/cancel`),cs=s=>c.post(`/agents/mesh/tasks/${s}/retry`),os=(s,a)=>c.post(`/agents/mesh/tasks/${s}/reassign`,{agent_id:a}),xs=s=>c.post("/agents/mesh/tasks/bulk-cancel",{task_ids:s}),hs=()=>c.post("/agents/mesh/discovery/trigger"),ms=()=>c.get("/agents/mesh/discovery/status"),C={getDashboardStats:Ee,getWorkStealingStats:Re,listAgents:qe,getAgent:Ie,getAgentMeshConfig:Ke,createMeshConfig:Be,updateMeshConfig:Ue,deleteMeshConfig:Oe,getAgentPeerStats:He,pingAgent:We,removeAgent:Ve,listClusters:Ge,getCluster:Je,createCluster:Ze,updateCluster:Xe,deleteCluster:Ye,getClusterConfig:es,updateClusterConfig:ss,addAgentToCluster:ts,removeAgentFromCluster:as,setClusterLeader:rs,triggerLeaderElection:ls,getTaskQueue:ds,getTask:ns,cancelTask:is,retryTask:cs,reassignTask:os,bulkCancelTasks:xs,triggerDiscovery:hs,getDiscoveryStatus:ms};function ks(){var re,le,de;const[s,a]=_.useState("dashboard"),[r,o]=_.useState(!1),[y,w]=_.useState(null),[g,h]=_.useState(null),[x,f]=_.useState(""),m=ke(),{data:v,isLoading:S}=U({queryKey:["meshDashboardStats"],queryFn:()=>C.getDashboardStats().then(t=>t.data),refetchInterval:1e4}),{data:u,isLoading:p,refetch:N}=U({queryKey:["meshAgents"],queryFn:()=>C.listAgents().then(t=>t.data),refetchInterval:15e3}),{data:b,isLoading:$,refetch:P}=U({queryKey:["meshClusters"],queryFn:()=>C.listClusters().then(t=>t.data),refetchInterval:3e4}),{data:R,isLoading:I,refetch:G}=U({queryKey:["meshTaskQueue"],queryFn:()=>C.getTaskQueue().then(t=>t.data),refetchInterval:5e3}),K=M({mutationFn:t=>C.createCluster(t).then(F=>F.data),onSuccess:()=>{m.invalidateQueries({queryKey:["meshClusters"]}),m.invalidateQueries({queryKey:["meshDashboardStats"]}),k.success("Cluster created successfully"),o(!1)},onError:()=>{k.error("Failed to create cluster")}}),J=M({mutationFn:t=>C.deleteCluster(t),onSuccess:()=>{m.invalidateQueries({queryKey:["meshClusters"]}),m.invalidateQueries({queryKey:["meshDashboardStats"]}),k.success("Cluster deleted"),h(null)},onError:()=>{k.error("Failed to delete cluster")}}),Z=M({mutationFn:t=>C.pingAgent(t).then(F=>F.data),onSuccess:t=>{k.success(`Agent responded in ${t.latency_ms}ms`),m.invalidateQueries({queryKey:["meshAgents"]})},onError:()=>{k.error("Agent did not respond")}}),l=M({mutationFn:t=>C.removeAgent(t),onSuccess:()=>{m.invalidateQueries({queryKey:["meshAgents"]}),m.invalidateQueries({queryKey:["meshDashboardStats"]}),k.success("Agent removed from mesh")},onError:()=>{k.error("Failed to remove agent")}}),n=M({mutationFn:t=>C.cancelTask(t),onSuccess:()=>{m.invalidateQueries({queryKey:["meshTaskQueue"]}),k.success("Task cancelled")},onError:()=>{k.error("Failed to cancel task")}}),z=M({mutationFn:t=>C.retryTask(t),onSuccess:()=>{m.invalidateQueries({queryKey:["meshTaskQueue"]}),k.success("Task queued for retry")},onError:()=>{k.error("Failed to retry task")}}),A=M({mutationFn:()=>C.triggerDiscovery(),onSuccess:()=>{k.success("Discovery triggered"),setTimeout(()=>{m.invalidateQueries({queryKey:["meshAgents"]})},2e3)},onError:()=>{k.error("Failed to trigger discovery")}}),T=M({mutationFn:t=>C.triggerLeaderElection(t),onSuccess:()=>{m.invalidateQueries({queryKey:["meshClusters"]}),k.success("Leader election triggered")},onError:()=>{k.error("Failed to trigger leader election")}}),i=(u==null?void 0:u.agents)||[],Q=(b==null?void 0:b.clusters)||[],B=(R==null?void 0:R.tasks)||[],ae=i.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())||t.address.toLowerCase().includes(x.toLowerCase())),je=[{id:"dashboard",label:"Dashboard",icon:e.jsx(W,{className:"w-4 h-4"})},{id:"agents",label:"Agents",icon:e.jsx(D,{className:"w-4 h-4"}),count:i.length},{id:"clusters",label:"Clusters",icon:e.jsx(q,{className:"w-4 h-4"}),count:Q.length},{id:"tasks",label:"Task Queue",icon:e.jsx(Te,{className:"w-4 h-4"}),count:B.length}],d=v;return e.jsx(De,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3",children:[e.jsx(V,{className:"w-8 h-8 text-cyan-400"}),"Distributed Scanning Mesh"]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Manage distributed scanning agents, clusters, and task distribution"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>A.mutate(),disabled:A.isPending,children:[e.jsx(ne,{className:`w-4 h-4 mr-2 ${A.isPending?"animate-pulse":""}`}),"Discover Peers"]}),e.jsxs(j,{onClick:()=>o(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"New Cluster"]})]})]}),e.jsx("div",{className:"border-b border-light-border dark:border-dark-border",children:e.jsx("nav",{className:"flex gap-4",children:je.map(t=>e.jsxs("button",{onClick:()=>a(t.id),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${s===t.id?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:[t.icon,t.label,t.count!==void 0&&e.jsx(E,{variant:"secondary",size:"sm",children:t.count})]},t.id))})}),s==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Total Agents"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:(d==null?void 0:d.total_agents)??0}),e.jsxs("div",{className:"mt-2 flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-green-400",children:[(d==null?void 0:d.online_agents)??0," online"]}),e.jsxs("span",{className:"text-yellow-400",children:[(d==null?void 0:d.busy_agents)??0," busy"]}),e.jsxs("span",{className:"text-slate-400",children:[(d==null?void 0:d.offline_agents)??0," offline"]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Clusters"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:(d==null?void 0:d.total_clusters)??0}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Avg load: ",Math.round(((d==null?void 0:d.average_cluster_load)??0)*100),"%"]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Tasks"]}),e.jsxs("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:[(d==null?void 0:d.total_tasks_running)??0,e.jsxs("span",{className:"text-lg font-normal text-slate-400",children:["/",(d==null?void 0:d.total_tasks_queued)??0]})]}),e.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"running / queued"})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Work Stealing"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:((re=d==null?void 0:d.work_stealing_stats)==null?void 0:re.tasks_delegated)??0}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("span",{className:"text-cyan-400",children:[((le=d==null?void 0:d.work_stealing_stats)==null?void 0:le.tasks_stolen)??0," stolen"]}),e.jsx("span",{className:"text-slate-400 mx-1",children:"|"}),e.jsxs("span",{className:"text-red-400",children:[((de=d==null?void 0:d.work_stealing_stats)==null?void 0:de.delegation_failures)??0," failed"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Online Agents"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>a("agents"),children:"View All"})]}),e.jsx("div",{className:"p-4 grid gap-3",children:p?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(L,{className:"w-6 h-6 text-slate-400 animate-spin"})}):i.filter(t=>t.status==="online").length===0?e.jsx("div",{className:"text-center py-4 text-slate-400",children:"No online agents"}):i.filter(t=>t.status==="online").slice(0,3).map(t=>e.jsx(ce,{agent:t,showActions:!1,onClick:()=>{w(t.agent_id),a("agents")}},t.agent_id))})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Clusters"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>a("clusters"),children:"View All"})]}),e.jsx("div",{className:"p-4 space-y-3",children:$?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(L,{className:"w-6 h-6 text-slate-400 animate-spin"})}):Q.length===0?e.jsxs("div",{className:"text-center py-4 text-slate-400",children:[e.jsx(q,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No clusters configured"}),e.jsx(j,{size:"sm",className:"mt-2",onClick:()=>o(!0),children:"Create Cluster"})]}):Q.slice(0,2).map(t=>e.jsxs("div",{className:"p-3 bg-light-hover dark:bg-dark-hover rounded-lg cursor-pointer hover:ring-1 ring-primary/50",onClick:()=>{h(t),a("clusters")},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:t.name}),e.jsx(E,{variant:"success",size:"sm",children:"Active"})]}),t.description&&e.jsx("p",{className:"text-sm text-slate-400 mt-1 line-clamp-1",children:t.description})]},t.id))})]})]}),B.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-4",children:"Recent Tasks"}),e.jsx(xe,{tasks:B.slice(0,5),agents:i,isLoading:I,onCancelTask:t=>n.mutate(t),onRetryTask:t=>z.mutate(t)})]})]}),s==="agents"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search agents...",value:x,onChange:t=>f(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs(j,{variant:"outline",onClick:()=>N(),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(L,{className:"w-8 h-8 text-slate-400 animate-spin"})}):ae.length===0?e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(D,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No Agents Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:x?"No agents match your search query":"No agents are connected to the mesh network"}),e.jsxs(j,{variant:"outline",onClick:()=>A.mutate(),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Discover Peers"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ae.map(t=>e.jsx(ce,{agent:t,isLeader:Q.some(F=>F.leader_agent_id===t.agent_id),onPing:()=>Z.mutate(t.agent_id),onRemove:()=>{confirm(`Remove agent "${t.name}" from the mesh?`)&&l.mutate(t.agent_id)},onClick:()=>w(t.agent_id)},t.agent_id))}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsx(Fe,{agentId:y,existingConfig:void 0,onSave:t=>{k.success("Configuration saved"),w(null)},onCancel:()=>w(null)})})})]}),s==="clusters"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white",children:["Clusters (",Q.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>P(),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(j,{onClick:()=>o(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"New Cluster"]})]})]}),$?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(L,{className:"w-8 h-8 text-slate-400 animate-spin"})}):Q.length===0?e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(q,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No Clusters"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Create a cluster to group agents and enable distributed task scheduling"}),e.jsxs(j,{onClick:()=>o(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Create Your First Cluster"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Q.map(t=>e.jsx(ze,{cluster:t,onViewDetails:()=>h(t),onEditConfig:()=>{},onDelete:()=>{confirm(`Delete cluster "${t.name}"? Agents will be removed from the cluster.`)&&J.mutate(t.id)},onElectLeader:()=>T.mutate(t.id)},t.id))})]}),s==="tasks"&&e.jsx(xe,{tasks:B,agents:i,isLoading:I,onCancelTask:t=>n.mutate(t),onRetryTask:t=>z.mutate(t),onReassignTask:(t,F)=>{C.reassignTask(t,F).then(()=>{m.invalidateQueries({queryKey:["meshTaskQueue"]}),k.success("Task reassigned")}).catch(()=>{k.error("Failed to reassign task")})},onBulkCancel:t=>{C.bulkCancelTasks(t).then(()=>{m.invalidateQueries({queryKey:["meshTaskQueue"]}),k.success(`${t.length} tasks cancelled`)}).catch(()=>{k.error("Failed to cancel tasks")})},onRefresh:()=>G()}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsx(Pe,{onSubmit:t=>K.mutate(t),onCancel:()=>o(!1),isLoading:K.isPending})})})]})})}export{ks as default};
