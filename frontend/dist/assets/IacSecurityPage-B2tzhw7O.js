import{j as e,u as E,b as J,d as T}from"./vendor-state-BXNPjUwt.js";import{r as g}from"./vendor-react-5KxtEOLM.js";import{B as y,aY as Z,bd as q,X as H,h as ee,L as se,aT as te,a9 as w,O as Q,_ as O,i as B,H as ae,S as U,p as Y,g as V,$ as re,m as le,y as ne,z as ie,a as ce,aH as oe,ab as X,s as de}from"./vendor-ui-DGSzT-Xm.js";import{B as I,_}from"./index-t7VPhhr8.js";import{u as me}from"./index-D-BwACm5.js";import{L as W}from"./Layout-BlRtLSTJ.js";import{u as xe,E as ue}from"./useRequireEngagement-9lfinMdP.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-charts-CaL4i8-H.js";import"./vendor-markdown-RN55YrVy.js";const ge=[".tf",".tf.json",".json",".yaml",".yml",".template"],he=(t,n)=>{const l=t.toLowerCase();return l.endsWith(".tf")||l.endsWith(".tf.json")?"Terraform":l.includes("cloudformation")||l.endsWith(".template")||n.includes("AWSTemplateFormatVersion")||n.includes("Resources:")?"CloudFormation":l.includes("azuredeploy")||l.includes("maintemplate")||l.endsWith(".arm.json")||n.includes("schema.management.azure.com")?"Azure ARM":n.includes('resource "')||n.includes('provider "')||n.includes('variable "')?"Terraform":null},pe=t=>t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`,ye=t=>{switch(t){case"Terraform":return"bg-purple-500/20 text-purple-400";case"CloudFormation":return"bg-orange-500/20 text-orange-400";case"Azure ARM":return"bg-blue-500/20 text-blue-400";default:return"bg-gray-500/20 text-gray-400"}};function je({onScanCreated:t,customerId:n,engagementId:l}){const[x,h]=g.useState(""),[d,j]=g.useState([]),[S,m]=g.useState(!1),[p,f]=g.useState(null),N=g.useCallback(async u=>{var r;f(null);const i=[];for(const o of u){if(""+((r=o.name.split(".").pop())==null?void 0:r.toLowerCase()),!ge.some(M=>o.name.toLowerCase().endsWith(M))){y.warning(`Skipped ${o.name}: unsupported file type`);continue}const C=await o.text(),L=he(o.name,C);if(!L){y.warning(`Skipped ${o.name}: unable to detect IaC platform`);continue}i.push({file:o,name:o.name,size:o.size,platform:L})}i.length>0&&(j(o=>[...o,...i]),y.success(`Added ${i.length} file(s)`))},[]),{getRootProps:F,getInputProps:a,isDragActive:c}=me({onDrop:N,accept:{"text/plain":[".tf",".tf.json"],"application/json":[".json"],"text/yaml":[".yaml",".yml"],"application/x-yaml":[".yaml",".yml"]},multiple:!0}),b=u=>{j(i=>i.filter((r,o)=>o!==u))},k=async u=>{if(u.preventDefault(),d.length===0){f("Please upload at least one IaC file");return}m(!0),f(null);try{const i=new FormData;i.append("name",x||`IaC Scan - ${new Date().toLocaleString()}`),n&&i.append("customer_id",n),l&&i.append("engagement_id",l);for(const o of d)i.append("files",o.file);const r=await _.createScan(i);y.success("IaC scan started successfully"),t(r.data.id)}catch(i){console.error("Failed to create IaC scan:",i);const r=i instanceof Error?i.message:"Failed to create scan";f(r),y.error(r)}finally{m(!1)}};return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Upload IaC Files"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"scan-name",className:"block text-sm font-medium text-gray-300 mb-1",children:"Scan Name (optional)"}),e.jsx("input",{type:"text",id:"scan-name",value:x,onChange:u=>h(u.target.value),placeholder:"My IaC Security Scan",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{...F(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${c?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx("input",{...a()}),e.jsx(Z,{className:`w-12 h-12 mx-auto mb-3 ${c?"text-cyan-400":"text-gray-400"}`}),e.jsx("p",{className:"text-gray-300 mb-1",children:c?"Drop files here...":"Drag and drop IaC files here, or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Supports: Terraform (.tf), CloudFormation (JSON/YAML), Azure ARM templates"})]}),d.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-300 mb-2",children:[d.length," file(s) ready to scan"]}),d.map((u,i)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-700/50 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-white",children:u.name}),e.jsx("div",{className:"text-xs text-gray-400",children:pe(u.size)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${ye(u.platform)}`,children:u.platform}),e.jsx("button",{type:"button",onClick:()=>b(i),className:"p-1 text-gray-400 hover:text-red-400 transition-colors",children:e.jsx(H,{className:"w-4 h-4"})})]})]},i))]}),p&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:p})]}),e.jsx(I,{type:"submit",disabled:d.length===0||S,className:"w-full",children:S?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2 animate-spin"}),"Starting Scan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Start IaC Security Scan"]})})]})]})}const be=t=>{switch(t.toLowerCase()){case"critical":return"bg-red-500/20 text-red-400 border-red-500/50";case"high":return"bg-orange-500/20 text-orange-400 border-orange-500/50";case"medium":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/50";case"low":return"bg-blue-500/20 text-blue-400 border-blue-500/50";case"info":return"bg-gray-500/20 text-gray-400 border-gray-500/50";default:return"bg-gray-500/20 text-gray-400 border-gray-500/50"}},fe=t=>{switch(t.toLowerCase()){case"completed":return e.jsx(V,{className:"w-5 h-5 text-green-400"});case"failed":return e.jsx(B,{className:"w-5 h-5 text-red-400"});case"running":return e.jsx(w,{className:"w-5 h-5 text-cyan-400 animate-spin"});default:return e.jsx(Y,{className:"w-5 h-5 text-yellow-400"})}},G=t=>({hardcoded_secret:"Hardcoded Secret",iam_misconfiguration:"IAM Misconfiguration",public_storage:"Public Storage",missing_encryption:"Missing Encryption",missing_logging:"Missing Logging",network_exposure:"Network Exposure",missing_tags:"Missing Tags",deprecated_resource:"Deprecated Resource",weak_cryptography:"Weak Cryptography",insecure_default:"Insecure Default",compliance_violation:"Compliance Violation",best_practice:"Best Practice"})[t]||t;function Ne({scanId:t,onBack:n}){var i;const[l,x]=g.useState(null),[h,d]=g.useState("all"),[j,S]=g.useState("all"),{data:m,isLoading:p,refetch:f}=E({queryKey:["iac-scan",t],queryFn:async()=>(await _.getScan(t)).data,refetchInterval:r=>{var R,C;const o=(C=(R=r.state.data)==null?void 0:R.scan)==null?void 0:C.status;return o==="running"||o==="pending"?3e3:!1}}),{data:N=[],isLoading:F}=E({queryKey:["iac-findings",t],queryFn:async()=>(await _.getFindings(t)).data,enabled:((i=m==null?void 0:m.scan)==null?void 0:i.status)==="completed"}),a=m==null?void 0:m.scan,c=(m==null?void 0:m.files)||[],b=m==null?void 0:m.finding_summary,k=N.filter(r=>!(h!=="all"&&r.severity!==h||j!=="all"&&r.category!==j||l&&r.file_id!==l)),u=[...new Set(N.map(r=>r.category))];return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[n&&e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(O,{className:"w-5 h-5 rotate-180"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mt-1",children:[fe(a.status),e.jsx("span",{className:"capitalize",children:a.status}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsx("span",{children:new Date(a.created_at).toLocaleString()})]})]})]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>f(),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),b&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[e.jsx(A,{label:"Total Findings",value:b.total,color:"text-white"}),e.jsx(A,{label:"Critical",value:b.critical,color:"text-red-400"}),e.jsx(A,{label:"High",value:b.high,color:"text-orange-400"}),e.jsx(A,{label:"Medium",value:b.medium,color:"text-yellow-400"}),e.jsx(A,{label:"Low",value:b.low,color:"text-blue-400"}),e.jsx(A,{label:"Info",value:b.info,color:"text-gray-400"})]}),(a.status==="running"||a.status==="pending")&&e.jsx("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{className:"w-8 h-8 text-cyan-400 animate-spin"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Scan in Progress"}),e.jsxs("p",{className:"text-gray-400",children:["Analyzing ",a.file_count," files for security issues..."]})]})]})}),a.status==="failed"&&a.error_message&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-400",children:"Scan Failed"}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:a.error_message})]})]})}),a.status==="completed"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:["Files (",c.length,")"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>x(null),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${l===null?"bg-cyan-500/20 text-cyan-400":"text-gray-300 hover:bg-gray-700"}`,children:"All Files"}),c.map(r=>e.jsx("button",{onClick:()=>x(r.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${l===r.id?"bg-cyan-500/20 text-cyan-400":"text-gray-300 hover:bg-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate text-sm",children:r.filename}),r.finding_count>0&&e.jsx("span",{className:"ml-auto text-xs bg-red-500/20 text-red-400 px-1.5 rounded",children:r.finding_count})]})},r.id))]})]})}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:h,onChange:r=>d(r.target.value),className:"bg-gray-700 border border-gray-600 rounded-lg px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"all",children:"All Severities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"info",children:"Info"})]}),e.jsxs("select",{value:j,onChange:r=>S(r.target.value),className:"bg-gray-700 border border-gray-600 rounded-lg px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),u.map(r=>e.jsx("option",{value:r,children:G(r)},r))]}),e.jsxs("span",{className:"text-sm text-gray-400 ml-auto",children:[k.length," finding(s)"]})]}),F?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(w,{className:"w-6 h-6 text-cyan-400 animate-spin"})}):k.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx(U,{className:"w-12 h-12 text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Issues Found"}),e.jsx("p",{className:"text-gray-400",children:N.length===0?"No security issues were detected in your IaC files.":"No findings match the current filters."})]}):e.jsx("div",{className:"space-y-3",children:k.map(r=>e.jsx(ve,{finding:r,files:c},r.id))})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Scan Not Found"}),e.jsx("p",{className:"text-gray-400",children:"The requested scan could not be found."})]})}function A({label:t,value:n,color:l}){return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:t}),e.jsx("div",{className:`text-2xl font-bold ${l}`,children:n})]})}function ve({finding:t,files:n}){const[l,x]=g.useState(!1),h=n.find(d=>d.id===t.file_id);return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>x(!l),className:"w-full text-left px-4 py-3 flex items-start gap-3 hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:`px-2 py-0.5 rounded text-xs font-medium ${be(t.severity)}`,children:t.severity.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white",children:t.title}),e.jsxs("div",{className:"text-sm text-gray-400 mt-0.5",children:[h==null?void 0:h.filename," : Line ",t.line_start,t.line_end!==t.line_start&&` - ${t.line_end}`]})]}),e.jsx("div",{className:"text-xs text-gray-500 bg-gray-700 px-2 py-1 rounded",children:G(t.category)}),e.jsx(O,{className:`w-5 h-5 text-gray-400 transition-transform ${l?"rotate-90":""}`})]}),l&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-gray-700 pt-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-300",children:t.description})]}),t.resource_type&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-1",children:"Resource"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[t.resource_type,t.resource_name&&` - ${t.resource_name}`]})]}),t.code_snippet&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-1",children:"Code"}),e.jsx("pre",{className:"bg-gray-900 rounded p-3 text-xs text-gray-300 overflow-x-auto",children:t.code_snippet})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-1",children:"Remediation"}),e.jsx("p",{className:"text-sm text-gray-300",children:t.remediation})]}),t.documentation_url&&e.jsxs("a",{href:t.documentation_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-cyan-400 hover:text-cyan-300",children:["Learn More ",e.jsx(re,{className:"w-3 h-3"})]})]})]})}const K=["critical","high","medium","low","info"],z=[{value:"hardcoded_secret",label:"Hardcoded Secret"},{value:"iam_misconfiguration",label:"IAM Misconfiguration"},{value:"public_storage",label:"Public Storage"},{value:"missing_encryption",label:"Missing Encryption"},{value:"missing_logging",label:"Missing Logging"},{value:"network_exposure",label:"Network Exposure"},{value:"missing_tags",label:"Missing Tags"},{value:"deprecated_resource",label:"Deprecated Resource"},{value:"weak_cryptography",label:"Weak Cryptography"},{value:"insecure_default",label:"Insecure Default"},{value:"compliance_violation",label:"Compliance Violation"},{value:"best_practice",label:"Best Practice"}],we=["Terraform","CloudFormation","AzureArm"],Se=["Aws","Azure","Gcp"],Ce=t=>{switch(t.toLowerCase()){case"critical":return"bg-red-500/20 text-red-400";case"high":return"bg-orange-500/20 text-orange-400";case"medium":return"bg-yellow-500/20 text-yellow-400";case"low":return"bg-blue-500/20 text-blue-400";case"info":return"bg-gray-500/20 text-gray-400";default:return"bg-gray-500/20 text-gray-400"}},D={name:"",description:"",severity:"medium",category:"best_practice",platforms:[],providers:[],pattern:"",pattern_type:"regex",remediation:"",documentation_url:""};function _e(){const t=J(),[n,l]=g.useState(""),[x,h]=g.useState("all"),[d,j]=g.useState("all"),[S,m]=g.useState(!0),[p,f]=g.useState(!1),[N,F]=g.useState(null),[a,c]=g.useState(D),{data:b=[],isLoading:k}=E({queryKey:["iac-rules"],queryFn:async()=>(await _.listRules()).data}),u=T({mutationFn:s=>_.createRule(s),onSuccess:()=>{t.invalidateQueries({queryKey:["iac-rules"]}),y.success("Rule created successfully"),C()},onError:s=>{y.error(`Failed to create rule: ${s.message}`)}}),i=T({mutationFn:({id:s,data:v})=>_.updateRule(s,v),onSuccess:()=>{t.invalidateQueries({queryKey:["iac-rules"]}),y.success("Rule updated successfully"),C()},onError:s=>{y.error(`Failed to update rule: ${s.message}`)}}),r=T({mutationFn:s=>_.deleteRule(s),onSuccess:()=>{t.invalidateQueries({queryKey:["iac-rules"]}),y.success("Rule deleted successfully")},onError:s=>{y.error(`Failed to delete rule: ${s.message}`)}}),o=b.filter(s=>{if(!S&&s.is_builtin||x!=="all"&&s.severity!==x||d!=="all"&&s.category!==d)return!1;if(n){const v=n.toLowerCase();return s.name.toLowerCase().includes(v)||s.description.toLowerCase().includes(v)}return!0}),R=s=>{s?(F(s),c({name:s.name,description:s.description,severity:s.severity,category:s.category,platforms:s.platforms,providers:s.providers,pattern:s.pattern,pattern_type:s.pattern_type,remediation:s.remediation,documentation_url:s.documentation_url||""})):(F(null),c(D)),f(!0)},C=()=>{f(!1),F(null),c(D)},L=s=>{s.preventDefault();const v={name:a.name,description:a.description,severity:a.severity,category:a.category,platforms:a.platforms,providers:a.providers,pattern:a.pattern,pattern_type:a.pattern_type,remediation:a.remediation,documentation_url:a.documentation_url||void 0};N?i.mutate({id:N.id,data:{name:a.name,description:a.description,severity:a.severity,category:a.category,pattern:a.pattern,remediation:a.remediation}}):u.mutate(v)},M=s=>{confirm(`Are you sure you want to delete the rule "${s.name}"?`)&&r.mutate(s.id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Security Rules"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage IaC security scanning rules"})]}),e.jsxs(I,{onClick:()=>R(),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"New Rule"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:s=>l(s.target.value),placeholder:"Search rules...",className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("select",{value:x,onChange:s=>h(s.target.value),className:"bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"all",children:"All Severities"}),K.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]}),e.jsxs("select",{value:d,onChange:s=>j(s.target.value),className:"bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:s=>m(s.target.checked),className:"rounded border-gray-600 bg-gray-700 text-cyan-500 focus:ring-cyan-500"}),"Show built-in rules"]})]}),k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):o.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx(U,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Rules Found"}),e.jsx("p",{className:"text-gray-400",children:n||x!=="all"||d!=="all"?"No rules match the current filters.":"Create your first custom rule to get started."})]}):e.jsx("div",{className:"grid gap-4",children:o.map(s=>e.jsx(Fe,{rule:s,onEdit:()=>R(s),onDelete:()=>M(s)},s.id))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:N?"Edit Rule":"Create New Rule"}),e.jsx("button",{onClick:C,className:"p-1 text-gray-400 hover:text-white",children:e.jsx(H,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:L,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Rule Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>c({...a,name:s.target.value}),required:!0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description *"}),e.jsx("textarea",{value:a.description,onChange:s=>c({...a,description:s.target.value}),required:!0,rows:2,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Severity *"}),e.jsx("select",{value:a.severity,onChange:s=>c({...a,severity:s.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:K.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Category *"}),e.jsx("select",{value:a.category,onChange:s=>c({...a,category:s.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Platforms"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:we.map(s=>e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:a.platforms.includes(s),onChange:v=>{v.target.checked?c({...a,platforms:[...a.platforms,s]}):c({...a,platforms:a.platforms.filter($=>$!==s)})},className:"rounded border-gray-600 bg-gray-700 text-cyan-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Providers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(s=>e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:a.providers.includes(s),onChange:v=>{v.target.checked?c({...a,providers:[...a.providers,s]}):c({...a,providers:a.providers.filter($=>$!==s)})},className:"rounded border-gray-600 bg-gray-700 text-cyan-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:s})]},s))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Detection Pattern (Regex) *"}),e.jsx("input",{type:"text",value:a.pattern,onChange:s=>c({...a,pattern:s.target.value}),required:!0,placeholder:`(?i)password\\s*=\\s*['"][^'"]+['"]`,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Regular expression to match security issues in IaC files"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Remediation *"}),e.jsx("textarea",{value:a.remediation,onChange:s=>c({...a,remediation:s.target.value}),required:!0,rows:3,placeholder:"Describe how to fix this security issue...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Documentation URL (optional)"}),e.jsx("input",{type:"url",value:a.documentation_url,onChange:s=>c({...a,documentation_url:s.target.value}),placeholder:"https://example.com/security-best-practices",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx(I,{type:"button",variant:"outline",onClick:C,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:u.isPending||i.isPending,children:u.isPending||i.isPending?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),N?"Update Rule":"Create Rule"]})})]})]})]})})]})}function Fe({rule:t,onEdit:n,onDelete:l}){var h;const x=((h=z.find(d=>d.value===t.category))==null?void 0:h.label)||t.category;return e.jsx("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${Ce(t.severity)}`,children:t.severity.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500",children:x}),t.is_builtin&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ce,{className:"w-3 h-3"}),"Built-in"]})]}),e.jsx("h3",{className:"font-medium text-white mt-2",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[t.platforms.length>0&&e.jsxs("span",{children:["Platforms: ",t.platforms.join(", ")]}),t.providers.length>0&&e.jsxs("span",{children:["Providers: ",t.providers.join(", ")]})]})]}),!t.is_builtin&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Edit rule",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete rule",children:e.jsx(X,{className:"w-4 h-4"})})]})]})})}const ke=t=>{switch(t.toLowerCase()){case"completed":return e.jsx(V,{className:"w-4 h-4 text-green-400"});case"failed":return e.jsx(B,{className:"w-4 h-4 text-red-400"});case"running":return e.jsx(w,{className:"w-4 h-4 text-cyan-400 animate-spin"});default:return e.jsx(Y,{className:"w-4 h-4 text-yellow-400"})}},P=(t,n,l)=>t===0?null:e.jsxs("span",{className:`text-xs px-1.5 py-0.5 rounded ${l}`,children:[t," ",n]});function qe(){const[t,n]=g.useState("scans"),[l,x]=g.useState(null);xe();const{data:h=[],isLoading:d,refetch:j}=E({queryKey:["iac-scans"],queryFn:async()=>(await _.listScans()).data}),S=async p=>{if(confirm("Are you sure you want to delete this scan?"))try{await _.deleteScan(p),y.success("Scan deleted successfully"),j()}catch{y.error("Failed to delete scan")}},m=p=>{j(),x(p)};return l?e.jsx(W,{children:e.jsx(Ne,{scanId:l,onBack:()=>x(null)})}):e.jsxs(W,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"IaC Security Scanning"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Scan Terraform, CloudFormation, and Azure ARM templates for security issues"})]}),e.jsx(ue,{toolName:"IaC Security Scanning",className:"mb-6"}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 border-b border-gray-700",children:[e.jsx("button",{onClick:()=>n("scans"),className:`pb-3 px-1 border-b-2 transition-colors ${t==="scans"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Scans"})]})}),e.jsx("button",{onClick:()=>n("rules"),className:`pb-3 px-1 border-b-2 transition-colors ${t==="rules"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Rules"})]})})]}),t==="scans"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(je,{onScanCreated:m}),e.jsxs("div",{className:"mt-6 bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-3",children:"Supported Platforms"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),"Terraform (.tf, .tf.json)"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),"AWS CloudFormation (JSON/YAML)"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Azure ARM Templates"]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Recent Scans"}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>j(),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),d?e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-800 rounded-lg",children:e.jsx(w,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):h.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx(U,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Scans Yet"}),e.jsx("p",{className:"text-gray-400",children:"Upload your first IaC files to start scanning for security issues."})]}):e.jsx("div",{className:"space-y-3",children:h.map(p=>e.jsx(Re,{scan:p,onView:()=>x(p.id),onDelete:()=>S(p.id)},p.id))})]})]}):e.jsx(_e,{})]})}function Re({scan:t,onView:n,onDelete:l}){return e.jsx("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ke(t.status),e.jsx("h4",{className:"font-medium text-white truncate",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-sm text-gray-400",children:[e.jsxs("span",{children:[t.file_count," files"]}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsxs("span",{children:[t.resource_count," resources"]}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsx("span",{children:new Date(t.created_at).toLocaleString()})]}),t.status==="completed"&&t.finding_count>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[P(t.critical_count,"Critical","bg-red-500/20 text-red-400"),P(t.high_count,"High","bg-orange-500/20 text-orange-400"),P(t.medium_count,"Medium","bg-yellow-500/20 text-yellow-400"),P(t.low_count,"Low","bg-blue-500/20 text-blue-400")]}),t.status==="completed"&&t.finding_count===0&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-green-400",children:[e.jsx(V,{className:"w-4 h-4"}),"No security issues found"]}),t.status==="failed"&&t.error_message&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-red-400",children:[e.jsx(Q,{className:"w-4 h-4"}),t.error_message.slice(0,50),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-cyan-400 transition-colors",title:"View details",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-red-400 transition-colors",title:"Delete scan",children:e.jsx(X,{className:"w-4 h-4"})})]})]})})}export{qe as default};
