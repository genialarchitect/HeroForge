import{j as e}from"./vendor-state-DrZ0R9WI.js";import{r as s}from"./vendor-react-HUtzaQ-y.js";import{a as fe,E as A,o as K,B as je,L as le,F as ve,G as Ne,l as we,q as ke,d as Se}from"./index-1Xo5B0Ip.js";import{B as m,L as X,aO as _e,al as Ce,q as De,X as Re,aE as Ae,ac as Ee,f as $e,b as Fe,aT as U,b4 as ie,a2 as Le}from"./vendor-ui-Bx796rwZ.js";import"./vendor-charts-VRtd0GUX.js";const Te=({scanId:b,onVulnerabilityClick:k})=>{const[i,f]=s.useState([]),[l,D]=s.useState(!0),[h,$]=s.useState(null),[x,j]=s.useState(!1),[u,S]=s.useState(new Set),[B,P]=s.useState([]),[F,g]=s.useState(!1),[_,C]=s.useState(!1),[o,N]=s.useState(""),[p,L]=s.useState(""),M=[{id:"open",title:"Open",color:"bg-red-900/20 border-red-700"},{id:"in_progress",title:"In Progress",color:"bg-yellow-900/20 border-yellow-700"},{id:"pending_verification",title:"Pending Verification",color:"bg-blue-900/20 border-blue-700"},{id:"resolved",title:"Resolved",color:"bg-green-900/20 border-green-700"}];s.useEffect(()=>{T(),O()},[b]);const O=async()=>{try{const a=await fe.getUsers();P(a.data)}catch(a){console.debug("Could not load users list:",a)}},T=async()=>{try{if(D(!0),!b){f([]);return}const a=await A.list({scan_id:b});f(a.data)}catch(a){console.error("Failed to load vulnerabilities:",a)}finally{D(!1)}},J=(a,r)=>{$(r),a.dataTransfer.effectAllowed="move"},z=a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},H=async(a,r)=>{if(a.preventDefault(),!(!h||h.status===r||x))try{j(!0),await A.update(h.id,{status:r}),await T(),$(null)}catch(E){console.error("Failed to update vulnerability status:",E)}finally{j(!1)}},n=()=>{$(null)},w=(a,r)=>{r.stopPropagation();const E=new Set(u);E.has(a)?E.delete(a):E.add(a),S(E)},y=async a=>{if(u.size!==0)try{j(!0),await A.bulkUpdate({vulnerability_ids:Array.from(u),status:a}),m.success(`Updated ${u.size} vulnerabilities to ${a.replace(/_/g," ")}`),S(new Set),await T()}catch(r){console.error("Failed to bulk update status:",r),m.error("Failed to update vulnerabilities")}finally{j(!1)}},v=async()=>{if(u.size!==0)try{j(!0),await A.bulkUpdate({vulnerability_ids:Array.from(u),assignee_id:o||void 0}),m.success(`Assigned ${u.size} vulnerabilities`),S(new Set),g(!1),N(""),await T()}catch(a){console.error("Failed to bulk assign:",a),m.error("Failed to assign vulnerabilities")}finally{j(!1)}},R=async()=>{if(!(u.size===0||!p))try{j(!0),await A.bulkUpdate({vulnerability_ids:Array.from(u),due_date:`${p}T00:00:00Z`}),m.success(`Updated due date for ${u.size} vulnerabilities`),S(new Set),C(!1),L(""),await T()}catch(a){console.error("Failed to bulk update due date:",a),m.error("Failed to update due dates")}finally{j(!1)}},V=()=>{S(new Set)},I=a=>i.filter(r=>r.status===a),G=a=>{switch(a.toLowerCase()){case"critical":return"border-l-4 border-red-500";case"high":return"border-l-4 border-orange-500";case"medium":return"border-l-4 border-yellow-500";case"low":return"border-l-4 border-blue-500";default:return"border-l-4 border-gray-500"}},Q=a=>{if(!a)return null;const r={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-blue-600 text-white"};return e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${r[a.toLowerCase()]||"bg-gray-600 text-white"}`,children:a.charAt(0).toUpperCase()})};return l?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):b?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Remediation Board"}),e.jsxs("div",{className:"flex gap-2",children:[u.size>0&&e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded",children:[u.size," selected"]}),e.jsx("button",{onClick:T,className:"px-3 py-1 text-sm bg-gray-700 text-gray-300 rounded hover:bg-gray-600",children:"Refresh"})]})]}),u.size>0&&e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-gray-400 text-sm mr-2",children:"Bulk Actions:"}),e.jsx("button",{onClick:()=>y("in_progress"),disabled:x,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600",children:"Mark In Progress"}),e.jsx("button",{onClick:()=>y("pending_verification"),disabled:x,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600",children:"Mark Pending Verification"}),e.jsx("button",{onClick:()=>y("resolved"),disabled:x,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-600",children:"Mark Resolved"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:()=>g(!0),disabled:x,className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 disabled:bg-gray-600",children:"Assign"}),e.jsx("button",{onClick:()=>C(!0),disabled:x,className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-600",children:"Set Due Date"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:V,className:"px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-500",children:"Clear Selection"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(a=>e.jsxs("div",{className:`rounded-lg border-2 ${a.color} p-4 min-h-[400px] transition-colors ${h&&h.status!==a.id?"ring-2 ring-blue-500/50":""}`,onDragOver:z,onDrop:r=>H(r,a.id),children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 text-white flex justify-between items-center",children:[e.jsx("span",{children:a.title}),e.jsx("span",{className:"text-sm font-normal text-gray-400 bg-gray-800 px-2 py-0.5 rounded",children:I(a.id).length})]}),e.jsxs("div",{className:"space-y-2",children:[I(a.id).map(r=>e.jsxs("div",{draggable:!x&&!u.has(r.id),onDragStart:E=>J(E,r),onDragEnd:n,onClick:()=>k==null?void 0:k(r.id),className:`bg-gray-800 p-3 rounded shadow cursor-move hover:shadow-lg hover:bg-gray-750 transition-all ${G(r.severity)} ${(h==null?void 0:h.id)===r.id?"opacity-50":""} ${x?"cursor-not-allowed":""} ${u.has(r.id)?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:u.has(r.id),onClick:E=>w(r.id,E),onChange:()=>{},className:"rounded border-gray-600 text-blue-600 focus:ring-blue-500 bg-gray-700"}),e.jsx("div",{className:"font-medium text-sm text-white truncate",children:r.vulnerability_id})]}),Q(r.priority)]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 ml-6",children:r.host_ip}),r.port&&e.jsxs("div",{className:"text-xs text-gray-500 ml-6",children:["Port: ",r.port]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 ml-6",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${r.severity==="critical"?"bg-red-900/50 text-red-300":r.severity==="high"?"bg-orange-900/50 text-orange-300":r.severity==="medium"?"bg-yellow-900/50 text-yellow-300":"bg-blue-900/50 text-blue-300"}`,children:r.severity}),r.assignee_id&&e.jsx("span",{className:"text-xs text-gray-500",children:"Assigned"})]}),r.due_date&&e.jsxs("div",{className:`text-xs mt-1 ml-6 ${new Date(r.due_date)<new Date?"text-red-400":"text-gray-500"}`,children:["Due: ",new Date(r.due_date).toLocaleDateString()]}),r.estimated_effort&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 ml-6",children:["Est: ",r.estimated_effort,"h",r.actual_effort?` / Actual: ${r.actual_effort}h`:""]})]},r.id)),I(a.id).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No vulnerabilities"})]})]},a.id))}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-400 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Critical"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"High"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{children:"Low"})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Assign ",u.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Select Assignee"}),e.jsxs("select",{value:o,onChange:a=>N(a.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),B.map(a=>e.jsxs("option",{value:a.id,children:[a.username," (",a.email,")"]},a.id))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{g(!1),N("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:x,children:"Cancel"}),e.jsx("button",{onClick:v,disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:x?"Assigning...":"Assign"})]})]})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Set Due Date for ",u.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:p,onChange:a=>L(a.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{C(!1),L("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:x,children:"Cancel"}),e.jsx("button",{onClick:R,disabled:x||!p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:x?"Updating...":"Set Due Date"})]})]})})]}):e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Select a scan to view the remediation board"})},Be=({vulnerabilityId:b,currentUserId:k,onCommentsChange:i,initialComments:f})=>{const[l,D]=s.useState(f||[]),[h,$]=s.useState(!f),[x,j]=s.useState(""),[u,S]=s.useState(!1),[B,P]=s.useState(null),[F,g]=s.useState(null),[_,C]=s.useState(""),[o,N]=s.useState(!1),p=s.useCallback(async()=>{try{$(!0);const n=await A.getComments(b);D(n.data)}catch(n){console.error("Failed to load comments:",n),m.error("Failed to load comments")}finally{$(!1)}},[b]);s.useEffect(()=>{f||p()},[p,f]),s.useEffect(()=>{f&&D(f)},[f]);const L=async n=>{if(n.preventDefault(),!!x.trim())try{S(!0),await A.addComment(b,x.trim()),j(""),m.success("Comment added"),await p(),i==null||i()}catch(w){console.error("Failed to add comment:",w),m.error("Failed to add comment")}finally{S(!1)}},M=async n=>{var w,y;try{P(n),await A.deleteComment(b,n),m.success("Comment deleted"),await p(),i==null||i()}catch(v){console.error("Failed to delete comment:",v);const R=v;m.error(((y=(w=R.response)==null?void 0:w.data)==null?void 0:y.error)||"Failed to delete comment")}finally{P(null)}},O=n=>{g(n.id),C(n.comment)},T=()=>{g(null),C("")},J=async n=>{var w,y;if(!_.trim()){m.error("Comment cannot be empty");return}try{N(!0),await A.updateComment(b,n,_.trim()),m.success("Comment updated"),g(null),C(""),await p(),i==null||i()}catch(v){console.error("Failed to update comment:",v);const R=v;m.error(((y=(w=R.response)==null?void 0:w.data)==null?void 0:y.error)||"Failed to update comment")}finally{N(!1)}},z=n=>new Date(n).toLocaleString(),H=n=>{const w=new Date(n),v=new Date().getTime()-w.getTime(),R=Math.floor(v/6e4),V=Math.floor(R/60),I=Math.floor(V/24);return R<1?"just now":R<60?`${R}m ago`:V<24?`${V}h ago`:I<7?`${I}d ago`:w.toLocaleDateString()};return h?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(X,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Loading comments..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("form",{onSubmit:L,className:"space-y-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:x,onChange:n=>j(n.target.value),rows:3,className:"block w-full rounded-lg bg-gray-800 border border-gray-600 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500 placeholder-gray-500 resize-none pr-12",placeholder:"Add a comment...",disabled:u}),e.jsx("button",{type:"submit",disabled:u||!x.trim(),className:"absolute bottom-3 right-3 p-2 rounded-lg bg-cyan-600 text-white hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",title:"Send comment",children:u?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(_e,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-3",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ce,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No comments yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Be the first to add a comment"})]}):l.map(n=>{const w=k===n.user_id,y=B===n.id,v=F===n.id;return e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white text-sm font-semibold",children:n.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:n.username}),e.jsxs("div",{className:"text-xs text-gray-500",title:z(n.created_at),children:[H(n.created_at),n.updated_at&&e.jsx("span",{className:"ml-1 text-gray-600",title:`Edited: ${z(n.updated_at)}`,children:"(edited)"})]})]})]}),v?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:_,onChange:R=>C(R.target.value),rows:3,className:"block w-full rounded-lg bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500 placeholder-gray-500 resize-none",disabled:o,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>J(n.id),disabled:o||!_.trim(),className:"inline-flex items-center gap-1 px-3 py-1 rounded-lg bg-cyan-600 text-white text-sm hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:[o?e.jsx(X,{className:"h-3 w-3 animate-spin"}):e.jsx(De,{className:"h-3 w-3"}),"Save"]}),e.jsxs("button",{onClick:T,disabled:o,className:"inline-flex items-center gap-1 px-3 py-1 rounded-lg bg-gray-600 text-gray-300 text-sm hover:bg-gray-500 disabled:opacity-50 transition-colors",children:[e.jsx(Re,{className:"h-3 w-3"}),"Cancel"]})]})]}):e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap break-words",children:n.comment})]}),w&&!v&&e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>O(n),disabled:y,className:"p-2 rounded-lg text-gray-500 hover:text-cyan-400 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Edit comment",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(n.id),disabled:y,className:"p-2 rounded-lg text-gray-500 hover:text-red-400 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Delete comment",children:y?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(Ee,{className:"h-4 w-4"})})]})]})},n.id)})}),l.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center pt-2",children:[l.length," ",l.length===1?"comment":"comments"]})]})},Pe=({vulnerabilityId:b,onTicketCreated:k})=>{const[i,f]=s.useState(!1),[l,D]=s.useState(!1),[h,$]=s.useState([]),[x,j]=s.useState(!1),[u,S]=s.useState(null),B=s.useRef(null);s.useEffect(()=>{P(),F()},[b]),s.useEffect(()=>{const o=N=>{B.current&&!B.current.contains(N.target)&&f(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const P=async()=>{var o;try{await K.getSettings(),S(!0)}catch(N){((o=N.response)==null?void 0:o.status)===404&&S(!1)}},F=async()=>{j(!0);try{const o=await K.getTicketsForVulnerability(b);$(o.data)}catch(o){console.error("Failed to load ServiceNow tickets:",o)}finally{j(!1)}},g=async()=>{var o,N;if(!u){m.error("ServiceNow is not configured. Please configure it in Settings."),f(!1);return}D(!0);try{const p=await K.createIncident(b);m.success(`Incident ${p.data.ticket_number} created successfully`),f(!1),await F(),k==null||k()}catch(p){const L=p;console.error("Failed to create ServiceNow incident:",p),m.error(((N=(o=L.response)==null?void 0:o.data)==null?void 0:N.error)||"Failed to create incident")}finally{D(!1)}},_=async()=>{var o,N;if(!u){m.error("ServiceNow is not configured. Please configure it in Settings."),f(!1);return}D(!0);try{const p=await K.createChange(b);m.success(`Change Request ${p.data.ticket_number} created successfully`),f(!1),await F(),k==null||k()}catch(p){const L=p;console.error("Failed to create ServiceNow change request:",p),m.error(((N=(o=L.response)==null?void 0:o.data)==null?void 0:N.error)||"Failed to create change request")}finally{D(!1)}},C=o=>o==="incident"?e.jsx(U,{className:"h-4 w-4 text-red-400"}):e.jsx(ie,{className:"h-4 w-4 text-blue-400"});return u===null?null:e.jsxs("div",{className:"relative",ref:B,children:[e.jsxs(je,{variant:"secondary",onClick:()=>f(!i),disabled:l,className:"flex items-center gap-2",children:[l?e.jsx(le,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{children:"ServiceNow"}),e.jsx(Fe,{className:`h-4 w-4 transition-transform ${i?"rotate-180":""}`})]}),i&&e.jsx("div",{className:"absolute right-0 mt-2 w-72 bg-gray-800 border border-gray-700 rounded-lg shadow-xl z-50",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 px-2 py-1",children:"Create Ticket"}),e.jsxs("button",{onClick:g,disabled:l,className:"w-full flex items-center gap-3 px-3 py-2 text-left text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(U,{className:"h-5 w-5 text-red-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create Incident"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Report an issue for investigation"})]})]}),e.jsxs("button",{onClick:_,disabled:l,className:"w-full flex items-center gap-3 px-3 py-2 text-left text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:[e.jsx(ie,{className:"h-5 w-5 text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create Change Request"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Request remediation changes"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("p",{className:"text-xs text-gray-500 px-2 py-1",children:["Linked Tickets ",x&&e.jsx(le,{className:"h-3 w-3 inline ml-1"})]}),h.length===0?e.jsx("p",{className:"px-3 py-2 text-sm text-gray-500",children:"No tickets linked yet"}):e.jsx("div",{className:"max-h-48 overflow-y-auto",children:h.map(o=>e.jsxs("a",{href:o.ticket_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 px-3 py-2 text-gray-300 hover:bg-gray-700 rounded-md transition-colors",children:[C(o.ticket_type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-cyan-400 truncate",children:o.ticket_number}),e.jsxs("div",{className:"text-xs text-gray-500 capitalize",children:[o.ticket_type," ",o.status&&`- ${o.status}`]})]}),e.jsx(Le,{className:"h-4 w-4 text-gray-500 flex-shrink-0"})]},o.id))})]})]}):e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(U,{className:"h-8 w-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"ServiceNow not configured"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Go to Settings > ServiceNow to configure the integration."})]})})]})},Ie=({vulnerabilityId:b,onClose:k,onUpdate:i})=>{const{user:f}=ve(),[l,D]=s.useState(null),[h,$]=s.useState(!0),[x,j]=s.useState(!1),[u,S]=s.useState("info"),[B,P]=s.useState([]),[F,g]=s.useState(""),[_,C]=s.useState(""),[o,N]=s.useState(""),[p,L]=s.useState(""),[M,O]=s.useState(""),[T,J]=s.useState(""),[z,H]=s.useState(""),[n,w]=s.useState(""),[y,v]=s.useState(!1),[R,V]=s.useState(!1),[I,G]=s.useState(""),[Q,a]=s.useState(!1),[r,E]=s.useState("still_vulnerable");s.useEffect(()=>{q(),de()},[b]);const de=async()=>{try{const t=await Ne.list();P(t.data)}catch(t){console.debug("Could not load users list:",t)}},q=async()=>{var t;try{$(!0);const c=await A.get(b);D(c.data),g(c.data.vulnerability.status),C(c.data.vulnerability.priority||"medium"),N(c.data.vulnerability.notes||""),L(c.data.vulnerability.assignee_id||""),O(((t=c.data.vulnerability.due_date)==null?void 0:t.split("T")[0])||""),J(c.data.vulnerability.remediation_steps||""),H(c.data.vulnerability.estimated_effort||""),w(c.data.vulnerability.actual_effort||"")}catch(c){console.error("Failed to load vulnerability detail:",c)}finally{$(!1)}},ee=async()=>{var t;if(l)try{v(!0),await A.update(b,{status:F!==l.vulnerability.status?F:void 0,priority:_!==(l.vulnerability.priority||"medium")?_:void 0,notes:o!==(l.vulnerability.notes||"")?o:void 0,assignee_id:p!==(l.vulnerability.assignee_id||"")&&p||void 0,due_date:M!==(((t=l.vulnerability.due_date)==null?void 0:t.split("T")[0])||"")&&M?`${M}T00:00:00Z`:void 0,remediation_steps:T!==(l.vulnerability.remediation_steps||"")?T:void 0,estimated_effort:typeof z=="number"?z:void 0,actual_effort:typeof n=="number"?n:void 0}),m.success("Vulnerability updated successfully"),await q(),j(!1),i==null||i()}catch(c){console.error("Failed to update vulnerability:",c),m.error("Failed to update vulnerability")}finally{v(!1)}},ne=async()=>{try{v(!0),await A.markForVerification(b,{}),m.success("Vulnerability marked for verification"),await q(),i==null||i()}catch(t){console.error("Failed to mark for verification:",t),m.error("Failed to mark for verification")}finally{v(!1)}},ce=async()=>{await q()},oe=async()=>{var t,c;if(l){V(!0);try{const Z=await we.createTicket(b);m.success(`JIRA ticket ${Z.data.jira_ticket_key} created successfully!`),await q(),i==null||i()}catch(Z){console.error("Failed to create JIRA ticket:",Z);const pe=Z;m.error(((c=(t=pe.response)==null?void 0:t.data)==null?void 0:c.error)||"Failed to create JIRA ticket")}finally{V(!1)}}},xe=async()=>{try{v(!0),await A.requestRetest(b,{notes:I||void 0}),m.success("Retest requested successfully"),G(""),await q(),i==null||i()}catch(t){console.error("Failed to request retest:",t),m.error("Failed to request retest")}finally{v(!1)}},ue=async()=>{try{v(!0),await A.completeRetest(b,{result:r,notes:I||void 0}),m.success(`Retest completed: ${r.replace(/_/g," ")}`),a(!1),G(""),E("still_vulnerable"),await q(),i==null||i()}catch(t){console.error("Failed to complete retest:",t),m.error("Failed to complete retest")}finally{v(!1)}},te=()=>{var t;l&&(j(!1),g(l.vulnerability.status),C(l.vulnerability.priority||"medium"),N(l.vulnerability.notes||""),L(l.vulnerability.assignee_id||""),O(((t=l.vulnerability.due_date)==null?void 0:t.split("T")[0])||""),J(l.vulnerability.remediation_steps||""),H(l.vulnerability.estimated_effort||""),w(l.vulnerability.actual_effort||""))},me=t=>{const c="px-3 py-1 text-sm font-semibold rounded-full";switch(t.toLowerCase()){case"critical":return`${c} bg-red-900/50 text-red-300`;case"high":return`${c} bg-orange-900/50 text-orange-300`;case"medium":return`${c} bg-yellow-900/50 text-yellow-300`;case"low":return`${c} bg-blue-900/50 text-blue-300`;default:return`${c} bg-gray-700 text-gray-300`}},ge=t=>{const c="px-3 py-1 text-sm font-semibold rounded-full";switch(t){case"open":return`${c} bg-red-900/50 text-red-300`;case"in_progress":return`${c} bg-yellow-900/50 text-yellow-300`;case"pending_verification":return`${c} bg-blue-900/50 text-blue-300`;case"resolved":return`${c} bg-green-900/50 text-green-300`;case"false_positive":return`${c} bg-gray-700 text-gray-300`;case"accepted_risk":return`${c} bg-purple-900/50 text-purple-300`;default:return`${c} bg-gray-700 text-gray-300`}},se=t=>t.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),be=t=>{const c="px-3 py-1 text-sm font-semibold rounded-full";switch(t){case"remediated":return`${c} bg-green-900/50 text-green-300`;case"partially_remediated":return`${c} bg-yellow-900/50 text-yellow-300`;case"still_vulnerable":return`${c} bg-red-900/50 text-red-300`;default:return`${c} bg-blue-900/50 text-blue-300`}},W=t=>new Date(t).toLocaleString(),he=t=>t.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),ye=()=>!l||!l.timeline||l.timeline.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No timeline events"}):e.jsx("div",{className:"space-y-4",children:l.timeline.map(t=>e.jsxs("div",{className:"border-l-2 border-blue-600 pl-4 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("div",{className:"font-medium text-white",children:t.username}),e.jsx("div",{className:"text-xs text-gray-400",children:W(t.created_at)})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:he(t.event_type)}),t.old_value&&t.new_value&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Changed from"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:t.old_value})," ","to"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:t.new_value})]}),t.comment&&e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:t.comment})]},t.id))});if(h)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-lg p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})});if(!l)return null;const{vulnerability:d,comments:Y,resolved_by_user:ae,verified_by_user:re}=l;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-900 border-b border-gray-700 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:d.vulnerability_id}),e.jsx("button",{onClick:k,className:"text-gray-400 hover:text-white text-2xl leading-none",children:"Ã—"})]}),e.jsx("div",{className:"flex gap-4 mt-4",children:[{id:"info",label:"Information"},{id:"remediation",label:"Remediation"},{id:"timeline",label:"Timeline"},{id:"comments",label:`Comments${Y.length>0?` (${Y.length})`:""}`}].map(t=>e.jsx("button",{onClick:()=>S(t.id),className:`pb-2 px-1 border-b-2 transition-colors ${u===t.id?"border-blue-500 text-blue-400 font-semibold":"border-transparent text-gray-400 hover:text-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{className:"p-6",children:[u==="info"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Host"}),e.jsx("div",{className:"text-white",children:d.host_ip})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Port"}),e.jsx("div",{className:"text-white",children:d.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Severity"}),e.jsx("div",{children:e.jsx("span",{className:me(d.severity),children:d.severity.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),x?e.jsxs("select",{value:F,onChange:t=>g(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"}),e.jsx("option",{value:"accepted_risk",children:"Accepted Risk"})]}):e.jsx("span",{className:ge(d.status),children:se(d.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Priority"}),x?e.jsxs("select",{value:_,onChange:t=>C(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}):e.jsx("div",{className:"text-white",children:(d.priority||"medium").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assignee"}),x?e.jsxs("select",{value:p,onChange:t=>L(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),B.map(t=>e.jsxs("option",{value:t.id,children:[t.username," (",t.email,")"]},t.id))]}):e.jsx("div",{className:"text-white",children:l!=null&&l.assignee?l.assignee.username:"Unassigned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Due Date"}),x?e.jsx("input",{type:"date",value:M,onChange:t=>O(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"}):e.jsx("div",{className:`text-white ${d.due_date&&new Date(d.due_date)<new Date?"text-red-400":""}`,children:d.due_date?new Date(d.due_date).toLocaleDateString():"Not set"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Created"}),e.jsx("div",{className:"text-gray-300",children:W(d.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Updated"}),e.jsx("div",{className:"text-gray-300",children:W(d.updated_at)})]}),d.resolved_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved At"}),e.jsx("div",{className:"text-gray-300",children:W(d.resolved_at)})]}),ae&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved By"}),e.jsx("div",{className:"text-gray-300",children:ae.username})]})]}),d.verified_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified At"}),e.jsx("div",{className:"text-gray-300",children:W(d.verified_at)})]}),re&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified By"}),e.jsx("div",{className:"text-gray-300",children:re.username})]})]})]}),d.retest_requested_at&&e.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-200 mb-3",children:"Retest Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Requested At"}),e.jsx("div",{className:"text-indigo-200",children:W(d.retest_requested_at)})]}),d.retest_completed_at?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Completed At"}),e.jsx("div",{className:"text-indigo-200",children:W(d.retest_completed_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Result"}),e.jsx("span",{className:be(d.retest_result),children:se(d.retest_result||"")})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Status"}),e.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-yellow-900/50 text-yellow-300",children:"Pending Retest"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes"}),x?e.jsx("textarea",{value:o,onChange:t=>N(t.target.value),rows:4,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about this vulnerability..."}):e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap bg-gray-800 p-3 rounded-md",children:d.notes||"No notes"})]}),(d.jira_ticket_id||d.jira_ticket_key)&&e.jsx("div",{className:"bg-blue-900/30 border border-blue-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-300 mb-1",children:"JIRA Ticket"}),e.jsx("div",{className:"text-blue-200 font-semibold",children:d.jira_ticket_key})]}),d.jira_ticket_url&&e.jsxs("a",{href:d.jira_ticket_url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 inline-flex items-center gap-2",children:["View in JIRA",e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:x?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ee,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:y?"Saving...":"Save Changes"}),e.jsx("button",{onClick:te,disabled:y,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit"}),d.status==="in_progress"&&e.jsx("button",{onClick:ne,disabled:y,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-600",children:"Mark for Verification"}),!d.jira_ticket_id&&e.jsx("button",{onClick:oe,disabled:R,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-600 inline-flex items-center gap-2",children:R?"Creating...":"Create JIRA Ticket"}),e.jsx(Pe,{vulnerabilityId:d.id,onTicketCreated:()=>{q(),i==null||i()}}),!d.retest_requested_at&&d.status!=="resolved"&&e.jsx("button",{onClick:xe,disabled:y,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-600",children:"Request Retest"}),d.retest_requested_at&&!d.retest_completed_at&&e.jsx("button",{onClick:()=>a(!0),disabled:y,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:"Complete Retest"})]})})]}),u==="remediation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Estimated Effort (hours)"}),x?e.jsx("input",{type:"number",value:z,onChange:t=>H(t.target.value?parseInt(t.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:d.estimated_effort?`${d.estimated_effort} hours`:"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Actual Effort (hours)"}),x?e.jsx("input",{type:"number",value:n,onChange:t=>w(t.target.value?parseInt(t.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:d.actual_effort?`${d.actual_effort} hours`:"Not set"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Remediation Steps"}),x?e.jsx("textarea",{value:T,onChange:t=>J(t.target.value),rows:10,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 font-mono text-sm",placeholder:"Enter detailed remediation steps (markdown supported)..."}):e.jsx("div",{className:"bg-gray-800 p-4 rounded-md whitespace-pre-wrap text-gray-300",children:d.remediation_steps||"No remediation steps defined"})]}),x&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ee,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:y?"Saving...":"Save Changes"}),e.jsx("button",{onClick:te,disabled:y,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}),!x&&e.jsx("button",{onClick:()=>j(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit Remediation"})]}),u==="timeline"&&ye(),u==="comments"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Be,{vulnerabilityId:b,currentUserId:f==null?void 0:f.id,onCommentsChange:ce,initialComments:Y})})]})]}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Complete Retest"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Retest Result"}),e.jsxs("select",{value:r,onChange:t=>E(t.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"still_vulnerable",children:"Still Vulnerable"}),e.jsx("option",{value:"remediated",children:"Remediated"}),e.jsx("option",{value:"partially_remediated",children:"Partially Remediated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:I,onChange:t=>G(t.target.value),rows:3,className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about the retest result..."})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 justify-end",children:[e.jsx("button",{onClick:()=>{a(!1),G(""),E("still_vulnerable")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{onClick:ue,disabled:y,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:y?"Completing...":"Complete Retest"})]})]})})]})},Je=()=>{const[b,k]=s.useState([]),[i,f]=s.useState(),[l,D]=s.useState(null),[h,$]=s.useState(null),[x,j]=s.useState(!0);s.useEffect(()=>{u()},[]),s.useEffect(()=>{i&&S()},[i]);const u=async()=>{try{j(!0);const _=(await ke.getAll()).data.filter(C=>C.status==="completed");k(_),_.length>0&&!i&&f(_[0].id)}catch(g){console.error("Failed to load scans:",g)}finally{j(!1)}},S=async()=>{if(i)try{const g=await A.getStats(i);$(g.data)}catch(g){console.error("Failed to load stats:",g)}},B=g=>{D(g)},P=()=>{D(null)},F=()=>{S()};return e.jsxs(Se,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Remediation Workflow"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Track and manage vulnerability remediation progress with a Kanban-style board"})]}),e.jsxs("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Scan"}),e.jsxs("select",{value:i||"",onChange:g=>f(g.target.value||void 0),className:"w-full md:w-96 rounded-md bg-dark-bg border-dark-border text-white shadow-sm focus:border-primary focus:ring-primary",disabled:x,children:[e.jsx("option",{value:"",children:"Select a scan..."}),b.map(g=>e.jsxs("option",{value:g.id,children:[g.name," - ",new Date(g.created_at).toLocaleDateString()]},g.id))]})]}),h&&e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg px-4 py-2 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:h.total}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-severity-critical/20 rounded-lg px-4 py-2 text-center border border-severity-critical/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-critical",children:h.open}),e.jsx("div",{className:"text-xs text-slate-400",children:"Open"})]}),e.jsxs("div",{className:"bg-severity-medium/20 rounded-lg px-4 py-2 text-center border border-severity-medium/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-medium",children:h.in_progress}),e.jsx("div",{className:"text-xs text-slate-400",children:"In Progress"})]}),e.jsxs("div",{className:"bg-status-completed/20 rounded-lg px-4 py-2 text-center border border-status-completed/50",children:[e.jsx("div",{className:"text-2xl font-bold text-status-completed",children:h.resolved}),e.jsx("div",{className:"text-xs text-slate-400",children:"Resolved"})]})]})]}),h&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"By Severity"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-critical"}),e.jsxs("span",{className:"text-slate-300",children:["Critical: ",h.critical]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-high"}),e.jsxs("span",{className:"text-slate-300",children:["High: ",h.high]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-medium"}),e.jsxs("span",{className:"text-slate-300",children:["Medium: ",h.medium]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-low"}),e.jsxs("span",{className:"text-slate-300",children:["Low: ",h.low]})]})]})]})]}),e.jsx("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:x?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):b.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("p",{className:"text-lg mb-2",children:"No completed scans found"}),e.jsx("p",{className:"text-sm",children:"Run a scan with vulnerability detection enabled to see results here"})]}):e.jsx(Te,{scanId:i,onVulnerabilityClick:B})})]}),l&&e.jsx(Ie,{vulnerabilityId:l,onClose:P,onUpdate:F})]})};export{Je as default};
