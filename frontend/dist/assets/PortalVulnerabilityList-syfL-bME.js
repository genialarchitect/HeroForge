import{j as e}from"./vendor-state-oFDmcCcB.js";import{e as w,r as s,L as S}from"./vendor-react-5KxtEOLM.js";import{P}from"./PortalLayout-CL_JObnv.js";import{ay as _,az as C}from"./index-MDkiA-RQ.js";import"./vendor-ui-7EurIAWU.js";import"./vendor-utils-DfRopTPV.js";const E={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-green-600 text-white",info:"bg-blue-600 text-white"},A={open:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",in_progress:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",pending_verification:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",resolved:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",accepted_risk:"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300"};function H(){const[d,o]=w(),[r,m]=s.useState(null),[k,f]=s.useState([]),[j,h]=s.useState(!0),[u,v]=s.useState(""),n=d.get("severity")||"",c=d.get("status")||"",x=d.get("engagement_id")||"",a=parseInt(d.get("page")||"1",10),g=20;s.useEffect(()=>{y()},[]),s.useEffect(()=>{N()},[n,c,x,a]);const y=async()=>{try{const t=await _.getAll();f(t.data)}catch(t){console.error("Failed to load engagements:",t)}},N=async()=>{h(!0);try{const t=await C.getAll({severity:n||void 0,status:c||void 0,engagement_id:x||void 0,limit:g,offset:(a-1)*g});m(t.data)}catch(t){v("Failed to load vulnerabilities"),console.error(t)}finally{h(!1)}},b=(t,l)=>{const i=new URLSearchParams(d);l?i.set(t,l):i.delete(t),i.delete("page"),o(i)},p=r?Math.ceil(r.stats.total/g):0;return e.jsx(P,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Vulnerabilities"}),r&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:r.stats.total}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:r.stats.critical}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Critical"})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:r.stats.high}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"High"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:r.stats.open}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Open"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("select",{value:n,onChange:t=>b("severity",t.target.value),className:"bg-light-surface dark:bg-dark-surface text-slate-900 dark:text-white px-4 py-2 rounded-lg border border-light-border dark:border-dark-border focus:ring-2 focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"",children:"All Severities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:c,onChange:t=>b("status",t.target.value),className:"bg-light-surface dark:bg-dark-surface text-slate-900 dark:text-white px-4 py-2 rounded-lg border border-light-border dark:border-dark-border focus:ring-2 focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"accepted_risk",children:"Accepted Risk"})]}),e.jsxs("select",{value:x,onChange:t=>b("engagement_id",t.target.value),className:"bg-light-surface dark:bg-dark-surface text-slate-900 dark:text-white px-4 py-2 rounded-lg border border-light-border dark:border-dark-border focus:ring-2 focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"",children:"All Engagements"}),k.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),u&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 p-4 rounded-lg",children:u}),j?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):(r==null?void 0:r.vulnerabilities.length)===0?e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-8 text-center",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No vulnerabilities found"})}):e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-light-hover dark:bg-dark-hover",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Title"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Severity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Host"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"CVSS"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:r==null?void 0:r.vulnerabilities.map(t=>{var l;return e.jsxs("tr",{className:"hover:bg-light-hover dark:hover:bg-dark-hover",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx(S,{to:`/portal/vulnerabilities/${t.id}`,className:"text-primary hover:text-primary-dark",children:t.title}),t.cve_ids&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:t.cve_ids})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${E[t.severity]||"bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200"}`,children:t.severity})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${A[t.status]||"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}`,children:t.status.replace("_"," ")})}),e.jsxs("td",{className:"px-4 py-4 text-slate-600 dark:text-slate-300 text-sm",children:[t.host,t.port?`:${t.port}`:""]}),e.jsx("td",{className:"px-4 py-4 text-slate-600 dark:text-slate-300 text-sm",children:((l=t.cvss_score)==null?void 0:l.toFixed(1))||"-"})]},t.id)})})]})}),p>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>o(t=>(t.set("page",String(a-1)),t)),disabled:a<=1,className:"px-4 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border text-slate-900 dark:text-white rounded-lg disabled:opacity-50 hover:bg-light-hover dark:hover:bg-dark-hover transition-colors",children:"Previous"}),e.jsxs("span",{className:"px-4 py-2 text-slate-500 dark:text-slate-400",children:["Page ",a," of ",p]}),e.jsx("button",{onClick:()=>o(t=>(t.set("page",String(a+1)),t)),disabled:a>=p,className:"px-4 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border text-slate-900 dark:text-white rounded-lg disabled:opacity-50 hover:bg-light-hover dark:hover:bg-dark-hover transition-colors",children:"Next"})]})]})})}export{H as default};
