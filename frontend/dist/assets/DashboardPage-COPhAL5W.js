var oa=Object.defineProperty;var da=(s,t,a)=>t in s?oa(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var Ce=(s,t,a)=>da(s,typeof t!="symbol"?t+"":t,a);import{j as e,c as xa,u as ma}from"./vendor-state-BjT_zREg.js";import{r,R as ha,e as ua,L as pa,u as kt,g as ga}from"./vendor-react-5KxtEOLM.js";import{T as ns,X as we,l as ke,m as We,B as A,n as St,o as Is,a as Re,p as be,q as Le,r as Gs,F as xe,E as _t,G as De,S as G,s as Ys,Z as $s,d as Ts,f as ba,t as ja,u as fa,v as Es,w as Ks,R as ya,W as os,x as ce,y as Ds,z as Js,D as va,H as Ct,I as Rs,L as $t,J as Na,N as Qs,O as U,V as le,Y as qs,_ as qe,i as je,g as X,$ as Ft,a0 as wa,K as Ge,a1 as Zs,a2 as Tt,a3 as ka,a4 as At,a5 as Et,a6 as He,a7 as Sa,a8 as _a,a9 as as,aa as ie,ab as Xs,ac as Dt,ad as Ca,ae as $a,af as et,ag as Fa,ah as Ta,ai as Aa,aj as Ea,ak as Da,al as Ra,am as dt,an as La,ao as Rt,ap as st,aq as Pa,k as Ma,ar as Ke,as as za,at as Ha,au as Fs,av as Ls,aw as Va,ax as Oa,ay as ze,az as Ue,aA as Ba,aB as Ia,aC as Ua,aD as Wa,aE as xt,aF as mt,aG as Ga,aH as ht,aI as ut,aJ as Ka,aK as qa}from"./vendor-ui-CaTPr3iI.js";import{L as Za}from"./Layout-DF6EApG0.js";import{s as ue,t as rs,a as Ya,b as ve,v as Ja,c as pt,e as Qa,d as gt,I as re,B as Q,f as Lt,r as ls,g as fs,h as es,i as As,j as Xa,k as Be,l as er,m as bt}from"./index-BgPDfr41.js";import{C as Ie}from"./Checkbox-BctekNnY.js";import{C as M}from"./Card-CV6m9jT5.js";import{B as ne}from"./Badge-Bi3Nk-Vg.js";import{f as Te,a as sr,b as Ps}from"./vendor-utils-DfRopTPV.js";import{L as Ne}from"./LoadingSpinner-DiN0bg1Z.js";import{C as tr}from"./ConfirmationDialog-E60e_YmT.js";import{u as ar,a as rr,M as lr,i as ir,B as nr,b as cr,C as or,c as dr,P as ys,R as xr,H as vs,d as Ns}from"./RedTeamAdvisorPanel-CexK0jTy.js";import{R as se,B as Ms,X as pe,Y as de,T as te,g as zs,C as ds,P as tt,h as at,j as mr,k as hr,l as ur,m as pr,n as gr,L as is,o as ye,p as cs,q as Ae,A as Pt,s as Ee}from"./vendor-charts-Cw33pWBR.js";import{r as br}from"./vendor-viz-TP9P65Td.js";import"./vendor-markdown-BGP8SuZQ.js";const jr=({selectedTagIds:s,onChange:t,existingTags:a,onTagsChange:l})=>{const[n,i]=r.useState(!1),[c,d]=r.useState(""),[o,j]=r.useState([]),[N,y]=r.useState(!1),[x,g]=r.useState(""),[b,v]=r.useState("#06b6d4"),[k,$]=r.useState(!1),w=r.useRef(null),u=["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444","#ec4899","#3b82f6","#84cc16"];r.useEffect(()=>{h()},[]),r.useEffect(()=>{const p=f=>{w.current&&!w.current.contains(f.target)&&(i(!1),y(!1))};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const h=async()=>{try{const p=await ue.getSuggestions();j(p.data)}catch(p){console.error("Failed to load tag suggestions:",p)}},F=a.filter(p=>s.includes(p.id)),L=a.filter(p=>!s.includes(p.id)&&p.name.toLowerCase().includes(c.toLowerCase())),P=o.reduce((p,f)=>(p[f.category]||(p[f.category]=[]),!a.some(O=>O.name.toLowerCase()===f.name.toLowerCase())&&f.name.toLowerCase().includes(c.toLowerCase())&&p[f.category].push(f),p),{}),V=p=>{s.includes(p)?t(s.filter(f=>f!==p)):t([...s,p])},C=async p=>{$(!0);try{const S=(await ue.create({name:p.name,color:p.color})).data;l&&l([...a,S]),t([...s,S.id]),d("")}catch(f){console.error("Failed to create tag:",f)}finally{$(!1)}},R=async()=>{if(x.trim()){$(!0);try{const f=(await ue.create({name:x.trim(),color:b})).data;l&&l([...a,f]),t([...s,f.id]),g(""),y(!1)}catch(p){console.error("Failed to create tag:",p)}finally{$(!1)}}};return e.jsxs("div",{className:"relative",ref:w,children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4 text-primary"}),"Tags (Optional)"]})}),e.jsxs("div",{className:"min-h-[42px] px-3 py-2 bg-dark-surface border border-dark-border rounded-lg cursor-pointer flex flex-wrap gap-2 items-center",onClick:()=>i(!n),children:[F.length>0?e.jsx(e.Fragment,{children:F.map(p=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-sm",style:{backgroundColor:p.color+"20",color:p.color},children:[p.name,e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),V(p.id)},className:"hover:opacity-70",children:e.jsx(we,{className:"h-3 w-3"})})]},p.id))}):e.jsx("span",{className:"text-slate-500",children:"Click to add tags..."}),e.jsx(ke,{className:`h-4 w-4 text-slate-400 ml-auto transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full bg-dark-bg border border-dark-border rounded-lg shadow-xl max-h-80 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-dark-border",children:e.jsx("input",{type:"text",placeholder:"Search or create tags...",value:c,onChange:p=>d(p.target.value),className:"w-full px-3 py-1.5 bg-dark-surface border border-dark-border rounded text-sm text-white focus:outline-none focus:border-primary",autoFocus:!0})}),e.jsxs("div",{className:"p-2 space-y-3",children:[L.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Your Tags"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:L.map(p=>e.jsxs("button",{type:"button",onClick:()=>V(p.id),className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm transition-opacity hover:opacity-80",style:{backgroundColor:p.color+"20",color:p.color},children:[e.jsx(We,{className:"h-3 w-3"}),p.name]},p.id))})]}),Object.entries(P).map(([p,f])=>f.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:p}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:f.map(S=>e.jsxs("button",{type:"button",onClick:()=>C(S),disabled:k,className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm transition-opacity hover:opacity-80 disabled:opacity-50",style:{backgroundColor:S.color+"15",color:S.color,border:`1px dashed ${S.color}40`},children:[e.jsx(We,{className:"h-3 w-3"}),S.name]},S.name))})]},p)),N?e.jsxs("div",{className:"space-y-2 p-2 bg-dark-surface rounded-lg",children:[e.jsx("input",{type:"text",placeholder:"Tag name",value:x,onChange:p=>g(p.target.value),className:"w-full px-3 py-1.5 bg-dark-bg border border-dark-border rounded text-sm text-white focus:outline-none focus:border-primary",autoFocus:!0}),e.jsx("div",{className:"flex gap-1",children:u.map(p=>e.jsx("button",{type:"button",onClick:()=>v(p),className:`w-6 h-6 rounded-full border-2 ${b===p?"border-white":"border-transparent"}`,style:{backgroundColor:p}},p))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:R,disabled:!x.trim()||k,className:"flex-1 px-3 py-1.5 bg-primary text-white rounded text-sm hover:bg-primary/80 disabled:opacity-50",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),g("")},className:"px-3 py-1.5 bg-dark-bg border border-dark-border text-slate-400 rounded text-sm hover:text-white",children:"Cancel"})]})]}):e.jsxs("button",{type:"button",onClick:()=>{y(!0),c&&g(c)},className:"w-full px-3 py-2 text-sm text-slate-400 border border-dashed border-dark-border rounded hover:border-primary hover:text-primary transition-colors flex items-center justify-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Create new tag",c?`: "${c}"`:""]})]})]})]})},ws={quick:{label:"Quick",icon:$s,color:"text-yellow-400",description:"Fast, lightweight scans"},standard:{label:"Standard",icon:Ys,color:"text-blue-400",description:"Balanced scanning approach"},comprehensive:{label:"Comprehensive",icon:G,color:"text-green-400",description:"Thorough security assessment"},web:{label:"Web",icon:De,color:"text-purple-400",description:"Web application focused"},stealth:{label:"Stealth",icon:_t,color:"text-orange-400",description:"Low-profile reconnaissance"},custom:{label:"Custom",icon:xe,color:"text-slate-400",description:"User-defined templates"}},fr=({onSelect:s,selectedTemplateId:t,className:a=""})=>{const[l,n]=r.useState([]),[i,c]=r.useState([]),[d,o]=r.useState(null),[j,N]=r.useState(!0),[y,x]=r.useState(!1),[g,b]=r.useState(null),[v,k]=r.useState("all");r.useEffect(()=>{$()},[]);const $=async()=>{try{N(!0);const[p,f,S]=await Promise.all([rs.getAll(),rs.getSystem(),rs.getDefault().catch(()=>({data:null}))]);n(p.data),c(f.data),o(S.data)}catch(p){console.error("Failed to load templates:",p),A.error("Failed to load scan templates")}finally{N(!1)}},w=[...i,...l],u=v==="all"?w:w.filter(p=>p.category===v),h=w.find(p=>p.id===t),F=p=>{s(p),x(!1),b(null),A.success(`Applied "${p.name}" template`)},L=()=>{s(null),x(!1),b(null)},P=p=>{var f;return((f=ws[p])==null?void 0:f.icon)||xe},V=p=>{var f;return((f=ws[p])==null?void 0:f.color)||"text-slate-400"},C=p=>{if(!p)return null;if(p<60)return`~${p}m`;const f=Math.floor(p/60),S=p%60;return S>0?`~${f}h ${S}m`:`~${f}h`},R=p=>{const f=[];return p.enable_os_detection&&f.push("OS Detection"),p.enable_service_detection&&f.push("Service Detection"),p.enable_vuln_scan&&f.push("Vulnerability Scan"),p.enable_enumeration&&f.push(`Enumeration (${p.enum_depth||"light"})`),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"Ports:"})," ",p.port_range[0],"-",p.port_range[1]]}),e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"Threads:"})," ",p.threads]}),p.scan_type&&e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"Type:"})," ",p.scan_type.replace("_"," ")]}),p.udp_port_range&&e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"text-slate-500",children:"UDP:"})," ",p.udp_port_range[0],"-",p.udp_port_range[1]]})]}),f.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-1",children:f.map(S=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-dark-surface rounded-full text-slate-400 border border-dark-border",children:S},S))})]})};return j?e.jsx("div",{className:`bg-dark-card border border-dark-border rounded-lg p-4 ${a}`,children:e.jsxs("div",{className:"animate-pulse flex items-center space-x-3",children:[e.jsx("div",{className:"h-8 w-8 bg-dark-surface rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-dark-surface rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-3 bg-dark-surface rounded w-1/2"})]})]})}):e.jsxs("div",{className:`space-y-3 ${a}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(St,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Scan Template"})]}),d&&!t&&e.jsxs("button",{type:"button",onClick:()=>F(d),className:"text-xs text-yellow-400 hover:text-yellow-300 flex items-center gap-1",children:[e.jsx(Is,{className:"h-3 w-3"}),"Use Default"]})]}),e.jsx("button",{type:"button",onClick:()=>x(!y),className:`w-full p-3 rounded-lg border transition-all text-left ${y?"bg-primary/10 border-primary":"bg-dark-card border-dark-border hover:border-slate-500"}`,children:h?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[ha.createElement(P(h.category),{className:`h-5 w-5 ${V(h.category)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:h.name}),h.is_system&&e.jsx(Re,{className:"h-3 w-3 text-slate-500"}),h.is_default&&e.jsx(Is,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})]}),h.description&&e.jsx("p",{className:"text-xs text-slate-500 mt-0.5 line-clamp-1",children:h.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.estimated_duration_mins&&e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),C(h.estimated_duration_mins)]}),y?e.jsx(Le,{className:"h-4 w-4 text-slate-400"}):e.jsx(ke,{className:"h-4 w-4 text-slate-400"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Gs,{className:"h-5 w-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Start from scratch"}),e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Or select a template to pre-configure scan settings"})]})]}),y?e.jsx(Le,{className:"h-4 w-4 text-slate-400"}):e.jsx(ke,{className:"h-4 w-4 text-slate-400"})]})}),y&&e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-1 p-2 border-b border-dark-border bg-dark-surface overflow-x-auto",children:[e.jsx("button",{type:"button",onClick:()=>k("all"),className:`px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors ${v==="all"?"bg-primary text-white":"text-slate-400 hover:text-white hover:bg-dark-border"}`,children:"All"}),Object.keys(ws).map(p=>{const f=ws[p],S=w.filter(_=>_.category===p).length;if(S===0)return null;const O=f.icon;return e.jsxs("button",{type:"button",onClick:()=>k(p),className:`px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors flex items-center gap-1.5 ${v===p?"bg-primary text-white":"text-slate-400 hover:text-white hover:bg-dark-border"}`,children:[e.jsx(O,{className:"h-3 w-3"}),f.label,e.jsxs("span",{className:"text-slate-500",children:["(",S,")"]})]},p)})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[e.jsxs("button",{type:"button",onClick:L,className:`w-full p-3 border-b border-dark-border text-left transition-colors hover:bg-dark-surface flex items-center gap-3 ${t?"":"bg-dark-surface"}`,children:[e.jsx("div",{className:"p-2 rounded-lg bg-dark-surface border border-dark-border",children:e.jsx(Gs,{className:"h-5 w-5 text-slate-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:"Start from scratch"}),!t&&e.jsx(Ts,{className:"h-4 w-4 text-green-400"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Configure all scan settings manually"})]})]}),u.map(p=>{const f=P(p.category),S=t===p.id,O=(g==null?void 0:g.id)===p.id;return e.jsxs("div",{className:`border-b border-dark-border transition-colors ${S?"bg-primary/10":"hover:bg-dark-surface"}`,children:[e.jsxs("button",{type:"button",onClick:()=>F(p),onMouseEnter:()=>b(p),onMouseLeave:()=>b(null),className:"w-full p-3 text-left flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg border ${S?"bg-primary/20 border-primary":"bg-dark-surface border-dark-border"}`,children:e.jsx(f,{className:`h-5 w-5 ${V(p.category)}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:p.name}),p.is_system&&e.jsx("span",{title:"System Template",children:e.jsx(Re,{className:"h-3 w-3 text-slate-500"})}),p.is_default&&e.jsx("span",{title:"Default Template",children:e.jsx(Is,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})}),S&&e.jsx(Ts,{className:"h-4 w-4 text-green-400"})]}),p.description&&e.jsx("p",{className:"text-xs text-slate-500 mt-0.5 line-clamp-1",children:p.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5 text-xs text-slate-500",children:[p.estimated_duration_mins&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),C(p.estimated_duration_mins)]}),p.use_count>0&&e.jsxs("span",{children:["Used ",p.use_count," time",p.use_count!==1?"s":""]})]})]})]}),O&&e.jsx("div",{className:"px-3 pb-3 animate-fadeIn",children:e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg border border-dark-border",children:[e.jsx("div",{className:"text-xs font-medium text-slate-400 mb-2",children:"Configuration Preview"}),R(p.config)]})})]},p.id)}),u.length===0&&e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx(xe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No templates in this category"})]})]}),e.jsxs("div",{className:"p-2 border-t border-dark-border bg-dark-surface flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:[w.length," template",w.length!==1?"s":""," available"]}),e.jsxs("button",{type:"button",onClick:()=>x(!1),className:"text-xs text-slate-400 hover:text-white flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),"Close"]})]})]})]})},ge=xa(s=>({scans:[],activeScan:null,results:new Map,liveUpdates:new Map,setScans:t=>s({scans:t}),addScan:t=>s(a=>({scans:[t,...a.scans]})),setActiveScan:t=>s({activeScan:t}),updateScanStatus:(t,a)=>s(l=>{var i;const n=a;return{scans:l.scans.map(c=>c.id===t?{...c,status:n}:c),activeScan:((i=l.activeScan)==null?void 0:i.id)===t?{...l.activeScan,status:n}:l.activeScan}}),setResults:(t,a)=>s(l=>{const n=new Map(l.results);return n.set(t,a),{results:n}}),addHostToResults:(t,a)=>s(l=>{const n=new Map(l.results),i=n.get(t)||[],c=i.findIndex(d=>d.target.ip===a.target.ip);return c>=0?i[c]=a:i.push(a),n.set(t,i),{results:n}}),updateHostInResults:(t,a,l)=>s(n=>{const i=new Map(n.results),d=(i.get(t)||[]).map(o=>o.target.ip===a?{...o,...l}:o);return i.set(t,d),{results:i}}),addLiveUpdate:(t,a)=>s(l=>{const n=new Map(l.liveUpdates),i=n.get(t)||[];return i.push(a),n.set(t,i),{liveUpdates:n}}),clearLiveUpdates:t=>s(a=>{const l=new Map(a.liveUpdates);return l.delete(t),{liveUpdates:l}})})),yr=[{id:"tcp_connect",label:"TCP Connect",description:"Standard TCP scan (most reliable)"},{id:"udp",label:"UDP Only",description:"UDP port scanning (requires root)"},{id:"comprehensive",label:"Comprehensive",description:"TCP + UDP scanning (thorough)"},{id:"syn",label:"SYN Stealth",description:"Half-open TCP scan (requires root)"}],vr=[{id:"http",label:"HTTP",category:"Web"},{id:"https",label:"HTTPS",category:"Web"},{id:"dns",label:"DNS",category:"Network"},{id:"smb",label:"SMB",category:"Network"},{id:"ftp",label:"FTP",category:"Network"},{id:"ssh",label:"SSH",category:"Network"},{id:"smtp",label:"SMTP",category:"Network"},{id:"ldap",label:"LDAP",category:"Network"},{id:"rdp",label:"RDP",category:"Remote"},{id:"vnc",label:"VNC",category:"Remote"},{id:"telnet",label:"Telnet",category:"Remote"},{id:"snmp",label:"SNMP",category:"Network"},{id:"mysql",label:"MySQL",category:"Database"},{id:"postgresql",label:"PostgreSQL",category:"Database"},{id:"mongodb",label:"MongoDB",category:"Database"},{id:"redis",label:"Redis",category:"Database"},{id:"elasticsearch",label:"Elasticsearch",category:"Database"}],Nr=()=>{const[s]=ua(),[t,a]=r.useState(""),[l,n]=r.useState(""),[i,c]=r.useState(1),[d,o]=r.useState(1e3),[j,N]=r.useState(100),[y,x]=r.useState("tcp_connect"),[g,b]=r.useState(53),[v,k]=r.useState(500),[$,w]=r.useState(2),[u,h]=r.useState(!0),[F,L]=r.useState(!0),[P,V]=r.useState(!1),[C,R]=r.useState(!1),[p,f]=r.useState("light"),[S,O]=r.useState([]),[_,E]=r.useState(!1),[W,fe]=r.useState([]),[D,I]=r.useState(!1),[Z,Y]=r.useState(""),[Se,Pe]=r.useState(""),[me,q]=r.useState([]),[J,ae]=r.useState(null),[T,H]=r.useState(null),[K,B]=r.useState([]),[oe,Ze]=r.useState(""),[xs,Ht]=r.useState([]),[Me,Hs]=r.useState(""),[Vs,Os]=r.useState([]),[rt,ms]=r.useState(""),[Vt,lt]=r.useState([]),[Bs,it]=r.useState([]),[Ye,Ot]=r.useState([]),[Je,nt]=r.useState([]),[ct,Bt]=r.useState(!1),[Ve,It]=r.useState([]),[Oe,Ut]=r.useState([]),[Fe,hs]=r.useState("local"),[us,ps]=r.useState(""),[gs,bs]=r.useState(""),{addScan:Wt}=ge(),Qe=y==="udp"||y==="comprehensive";r.useEffect(()=>{Gt(),Kt(),qt(),Zt(),Yt(),Jt(),Qt()},[]),r.useEffect(()=>{const m=s.get("customer");m&&xs.length>0&&xs.find(ee=>ee.id===m)&&Hs(m)},[s,xs]),r.useEffect(()=>{Me?Xt(Me):(Os([]),ms(""))},[Me]);const Gt=async()=>{try{const m=await Ya.getAll();fe(m.data)}catch(m){console.error("Failed to load target groups:",m)}},Kt=async()=>{try{const m=await ve.getPresets();q(m.data)}catch(m){console.error("Failed to load scan presets:",m)}},qt=async()=>{try{const m=await Ja.getConfigs();B(m.data);const z=m.data.find(ee=>ee.is_default);z&&Ze(z.id)}catch(m){console.error("Failed to load VPN configs:",m)}},Zt=async()=>{try{const m=await pt.customers.getAll("active");Ht(m.data)}catch(m){console.error("Failed to load customers:",m)}},Yt=async()=>{try{const m=await ue.getAll();lt(m.data)}catch(m){console.error("Failed to load tags:",m)}},Jt=async()=>{try{const m=await Qa.getAll();Ot(m.data)}catch(m){console.error("Failed to load exclusions:",m)}},Qt=async()=>{try{const[m,z]=await Promise.all([gt.list(),gt.groups.list()]),ee=m.data.filter(_e=>_e.status==="online");It(ee),Ut(z.data)}catch(m){console.error("Failed to load agents:",m)}},Xt=async m=>{try{const ee=(await pt.engagements.getByCustomer(m)).data.filter(_e=>_e.status==="planning"||_e.status==="in_progress");Os(ee)}catch(z){console.error("Failed to load engagements:",z),Os([])}},ea=m=>{const z=JSON.parse(m.targets||"[]");n(z.join(", "))},sa=m=>{ae(m.id),m.id==="webapp"?(c(80),o(8443)):(c(m.port_range[0]),o(m.port_range[1])),N(m.threads),x(m.scan_type),h(m.enable_os_detection),L(m.enable_service_detection),V(m.enable_vuln_scan),R(m.enable_enumeration),m.enum_depth&&f(m.enum_depth),m.udp_port_range&&(b(m.udp_port_range[0]),k(m.udp_port_range[1])),m.udp_retries&&w(m.udp_retries),m.enum_services?O(m.enum_services):O([]),A.success(`Applied "${m.name}" preset`)},ta=m=>{if(!m){H(null),ae(null),c(1),o(1e3),N(100),x("tcp_connect"),b(53),k(500),w(2),h(!0),L(!0),V(!1),R(!1),f("light"),O([]);return}H(m.id),ae(null);const z=m.config;c(z.port_range[0]),o(z.port_range[1]),N(z.threads),z.scan_type&&x(z.scan_type),h(z.enable_os_detection),L(z.enable_service_detection),V(z.enable_vuln_scan),R(z.enable_enumeration),z.enum_depth&&f(z.enum_depth),z.enum_services&&z.enum_services.length>0?O(z.enum_services):O([]),z.udp_port_range&&(b(z.udp_port_range[0]),k(z.udp_port_range[1])),z.udp_retries!==void 0&&z.udp_retries!==null&&w(z.udp_retries),rs.createScan(m.id,"",[]).catch(()=>{})},aa=m=>{switch(m){case"Zap":return $s;case"Radar":return va;case"Globe":return De;case"EyeOff":return _t;default:return $s}},ra=m=>{const z=m.trim(),ee=/^(\d{1,3}\.){3}\d{1,3}$/,_e=/^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/,Xe=/^(\d{1,3}\.){3}\d{1,3}-(\d{1,3}\.){3}\d{1,3}$/,js=/^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$/;return ee.test(z)||_e.test(z)||Xe.test(z)||js.test(z)},ot=m=>m.split(/[,\n]/).map(z=>z.trim()).filter(z=>z.length>0),la=m=>{const z=ot(m);return z.length===0?!1:z.every(ra)},ia=async m=>{var ee,_e;if(m.preventDefault(),!t.trim()){A.error("Please enter a scan name");return}if(!l.trim()){A.error("Please enter a target");return}if(!la(l)){A.error("Invalid target format. Use IP (192.168.1.1), CIDR (192.168.1.0/24), range, or hostname. Separate multiple targets with commas.");return}if(i<1||d>65535||i>d){A.error("Invalid port range");return}const z=ot(l);E(!0);try{const Xe=await ve.create({name:t.trim(),targets:z,port_range:[i,d],threads:j,scan_type:y,udp_port_range:Qe?[g,v]:void 0,udp_retries:Qe?$:void 0,enable_os_detection:u,enable_service_detection:F,enable_vuln_scan:P,enable_enumeration:C,enum_depth:C?p:void 0,enum_services:C&&S.length>0?S:void 0,vpn_config_id:oe||void 0,customer_id:Me||void 0,engagement_id:rt||void 0,tag_ids:Bs.length>0?Bs:void 0,exclusion_ids:Je.length>0?Je:void 0,skip_global_exclusions:ct||void 0,execution_mode:Fe,agent_id:Fe==="agent"&&us?us:void 0,agent_group_id:Fe==="agent_group"&&gs?gs:void 0});if(Wt(Xe.data),A.success("Scan started successfully!"),D&&Z.trim())try{await rs.create({name:Z.trim(),description:Se.trim()||void 0,config:{port_range:[i,d],threads:j,scan_type:y,udp_port_range:Qe?[g,v]:void 0,udp_retries:Qe?$:void 0,enable_os_detection:u,enable_service_detection:F,enable_vuln_scan:P,enable_enumeration:C,enum_depth:C?p:void 0,enum_services:C&&S.length>0?S:void 0}}),A.success("Template saved!")}catch(js){console.error("Failed to save template:",js),A.warning("Scan started but template save failed")}a(""),n(""),c(1),o(1e3),N(100),x("tcp_connect"),b(53),k(500),w(2),R(!1),f("light"),O([]),I(!1),Y(""),Pe(""),Hs(""),ms(""),it([]),H(null),ae(null),hs("local"),ps(""),bs("")}catch(Xe){const ca=((_e=(ee=Xe.response)==null?void 0:ee.data)==null?void 0:_e.error)||"Failed to start scan";A.error(ca)}finally{E(!1)}},na=m=>{O(z=>z.includes(m)?z.filter(ee=>ee!==m):[...z,m])};return e.jsxs(M,{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Create New Scan"}),e.jsxs("form",{onSubmit:ia,className:"space-y-4",children:[e.jsx("div",{className:"pb-4 border-b border-dark-border",children:e.jsx(fr,{onSelect:ta,selectedTemplateId:T})}),me.length>0&&!T&&e.jsxs("div",{className:"space-y-3 pb-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($s,{className:"h-5 w-5 text-yellow-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Quick Presets"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:me.map(m=>{const z=aa(m.icon);return e.jsxs("button",{type:"button",onClick:()=>sa(m),className:`px-3 py-3 text-sm rounded-lg border transition-all text-left ${J===m.id?"bg-gradient-to-br from-yellow-600/20 to-orange-600/20 border-yellow-500 text-white shadow-lg":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500 hover:bg-dark-surface/50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(z,{className:`h-4 w-4 ${J===m.id?"text-yellow-400":"text-slate-500"}`}),e.jsx("div",{className:"font-medium",children:m.name})]}),e.jsx("div",{className:"text-xs opacity-70 line-clamp-2",children:m.description})]},m.id)})}),e.jsx("p",{className:"text-xs text-slate-500 italic",children:"Select a preset to auto-configure scan settings, or customize manually below."})]}),e.jsx(re,{label:"Scan Name",type:"text",placeholder:"Production Network Scan",value:t,onChange:m=>a(m.target.value),required:!0}),e.jsx(jr,{selectedTagIds:Bs,onChange:it,existingTags:Vt,onTagsChange:lt}),e.jsxs("div",{className:"space-y-3 pb-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ba,{className:"h-5 w-5 text-indigo-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Customer Association (Optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Customer"}),e.jsxs("select",{value:Me,onChange:m=>{Hs(m.target.value),ms("")},className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"No customer"}),xs.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Engagement"}),e.jsxs("select",{value:rt,onChange:m=>ms(m.target.value),disabled:!Me||Vs.length===0,className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:Me?Vs.length===0?"No active engagements":"No engagement":"Select customer first"}),Vs.map(m=>e.jsxs("option",{value:m.id,children:[m.name," (",m.engagement_type.replace("_"," "),")"]},m.id))]})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Link this scan to a customer and engagement for tracking and reporting."})]}),Ye.length>0&&e.jsxs("div",{className:"space-y-3 pb-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ja,{className:"h-5 w-5 text-orange-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Exclusions (Optional)"})]}),Ye.filter(m=>m.is_global).length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-green-400"}),e.jsxs("span",{className:"text-sm text-green-400",children:[Ye.filter(m=>m.is_global).length," global exclusion(s) will be applied"]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ct,onChange:m=>Bt(m.target.checked),className:"w-4 h-4 rounded bg-dark-bg border-dark-border text-orange-500 focus:ring-orange-500 focus:ring-offset-dark-bg"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Skip global exclusions"})]})]}),Ye.filter(m=>!m.is_global).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Additional exclusions for this scan"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Ye.filter(m=>!m.is_global).map(m=>e.jsxs("label",{className:"flex items-center gap-3 p-2 bg-dark-surface rounded-lg cursor-pointer hover:bg-dark-border/30 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:Je.includes(m.id),onChange:z=>{z.target.checked?nt([...Je,m.id]):nt(Je.filter(ee=>ee!==m.id))},className:"w-4 h-4 rounded bg-dark-bg border-dark-border text-primary focus:ring-primary focus:ring-offset-dark-bg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:m.name}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-orange-500/20 text-orange-400",children:m.exclusion_type.replace("_"," ")})]}),e.jsx("code",{className:"text-xs text-slate-400 font-mono",children:m.value})]})]},m.id))})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Exclusions prevent scanning specific hosts or ports. Configure them in Settings."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Target"}),W.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fa,{className:"h-3 w-3 text-slate-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Use group:"}),W.slice(0,3).map(m=>e.jsx("button",{type:"button",onClick:()=>ea(m),className:"px-2 py-0.5 text-xs rounded border border-dark-border text-slate-400 hover:text-white hover:border-primary transition-colors",style:{borderLeftColor:m.color,borderLeftWidth:3},children:m.name},m.id)),W.length>3&&e.jsxs("span",{className:"text-xs text-slate-500",children:["+",W.length-3]})]})]}),e.jsx(re,{type:"text",placeholder:"192.168.1.0/24, 10.0.0.1-10.0.0.100, or hostname",value:l,onChange:m=>n(m.target.value),icon:e.jsx(Es,{className:"h-5 w-5"}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(re,{label:"Start Port",type:"number",min:1,max:65535,value:i,onChange:m=>{c(Number(m.target.value)),ae(null),H(null)}}),e.jsx(re,{label:"End Port",type:"number",min:1,max:65535,value:d,onChange:m=>{o(Number(m.target.value)),ae(null),H(null)}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Threads: ",j]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ks,{className:"h-5 w-5 text-slate-400"}),e.jsx("input",{type:"range",min:1,max:100,value:j,onChange:m=>{N(Number(m.target.value)),ae(null),H(null)},className:"w-full h-2 bg-dark-surface rounded-lg appearance-none cursor-pointer slider"})]})]}),e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ya,{className:"h-5 w-5 text-primary"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Scan Type"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:yr.map(m=>e.jsxs("button",{type:"button",onClick:()=>{x(m.id),ae(null),H(null)},className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${y===m.id?"bg-primary/20 border-primary text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium",children:m.label}),e.jsx("div",{className:"text-xs opacity-70",children:m.description})]},m.id))}),Qe&&e.jsxs("div",{className:"ml-4 space-y-3 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{className:"h-4 w-4 text-cyan-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-400",children:"UDP Options"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(re,{label:"UDP Start Port",type:"number",min:1,max:65535,value:g,onChange:m=>b(Number(m.target.value))}),e.jsx(re,{label:"UDP End Port",type:"number",min:1,max:65535,value:v,onChange:m=>k(Number(m.target.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:["UDP Retries: ",$]}),e.jsx("input",{type:"range",min:1,max:5,value:$,onChange:m=>w(Number(m.target.value)),className:"w-full h-2 bg-dark-surface rounded-lg appearance-none cursor-pointer slider"})]})]})]}),K.length>0&&e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-green-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"VPN Connection"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Route scan through VPN (optional)"}),e.jsxs("select",{value:oe,onChange:m=>Ze(m.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"No VPN - Direct connection"}),K.map(m=>e.jsxs("option",{value:m.id,children:[m.name," (",m.vpn_type.toUpperCase(),")",m.is_default?" (Default)":""]},m.id))]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"VPN connects before scan and disconnects when complete. Configure VPNs in Settings."})]})]}),(Ve.length>0||Oe.length>0)&&e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-5 w-5 text-purple-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Scan Execution"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{hs("local"),ps(""),bs("")},className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${Fe==="local"?"bg-purple-600/20 border-purple-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium",children:"Local"}),e.jsx("div",{className:"text-xs opacity-70",children:"Run on this server"})]}),e.jsxs("button",{type:"button",onClick:()=>{hs("agent"),bs("")},disabled:Ve.length===0,className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${Fe==="agent"?"bg-purple-600/20 border-purple-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"} ${Ve.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"font-medium",children:"Agent"}),e.jsxs("div",{className:"text-xs opacity-70",children:[Ve.length," online"]})]}),e.jsxs("button",{type:"button",onClick:()=>{hs("agent_group"),ps("")},disabled:Oe.length===0,className:`px-3 py-2 text-sm rounded-lg border transition-colors text-left ${Fe==="agent_group"?"bg-purple-600/20 border-purple-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"} ${Oe.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"font-medium",children:"Group"}),e.jsxs("div",{className:"text-xs opacity-70",children:[Oe.length," groups"]})]})]}),Fe==="agent"&&Ve.length>0&&e.jsxs("div",{className:"ml-4 animate-fadeIn",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Agent"}),e.jsxs("select",{value:us,onChange:m=>ps(m.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select an agent..."}),Ve.map(m=>e.jsxs("option",{value:m.id,children:[m.name,m.network_zones?` (${JSON.parse(m.network_zones).join(", ")})`:""]},m.id))]}),us&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Scan will be executed by the selected agent in its network zone."})]}),Fe==="agent_group"&&Oe.length>0&&e.jsxs("div",{className:"ml-4 animate-fadeIn",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Agent Group"}),e.jsxs("select",{value:gs,onChange:m=>bs(m.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a group..."}),Oe.map(m=>e.jsxs("option",{value:m.id,children:[m.name,m.network_ranges?` (${JSON.parse(m.network_ranges).join(", ")})`:""]},m.id))]}),gs&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Scan tasks will be distributed across agents in this group based on network zones."})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Configure agents in Settings > Agents for distributed scanning across network zones."})]}),e.jsxs("div",{className:"space-y-2 border-t border-dark-border pt-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Scan Options"}),e.jsx(Ie,{label:"Enable OS Detection",checked:u,onChange:h}),e.jsx(Ie,{label:"Enable Service Detection",checked:F,onChange:L}),e.jsx(Ie,{label:"Enable Vulnerability Scanning",checked:P,onChange:V})]}),e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-cyan-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Service Enumeration"})]}),e.jsx(Ie,{label:"Enable Deep Service Enumeration",checked:C,onChange:R}),C&&e.jsxs("div",{className:"ml-4 space-y-4 animate-fadeIn",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Enumeration Depth"}),e.jsxs("select",{value:p,onChange:m=>f(m.target.value),className:"w-full px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-transparent",children:[e.jsx("option",{value:"passive",children:"Passive - Banner analysis only"}),e.jsx("option",{value:"light",children:"Light - Common checks (default)"}),e.jsx("option",{value:"aggressive",children:"Aggressive - Full enumeration"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Services to Enumerate (leave empty for all detected)"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:vr.map(m=>e.jsx("button",{type:"button",onClick:()=>na(m.id),className:`px-3 py-1.5 text-sm rounded-md border transition-colors ${S.includes(m.id)?"bg-cyan-600 border-cyan-500 text-white":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:m.label},m.id))}),S.length>0&&e.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Selected: ",S.join(", ")]})]})]})]}),e.jsxs("div",{className:"space-y-3 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Js,{className:"h-5 w-5 text-purple-400"}),e.jsx("p",{className:"text-sm font-medium text-slate-300",children:"Save Configuration"})]}),e.jsx(Ie,{label:"Save this scan configuration as a template",checked:D,onChange:I}),D&&e.jsxs("div",{className:"ml-4 space-y-3 animate-fadeIn",children:[e.jsx(re,{label:"Template Name",type:"text",placeholder:"Production Network Scan Template",value:Z,onChange:m=>Y(m.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Template Description (Optional)"}),e.jsx("textarea",{value:Se,onChange:m=>Pe(m.target.value),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:2,placeholder:"Quick template for scanning production servers"})]})]})]}),e.jsx(Q,{type:"submit",variant:"primary",size:"lg",loading:_,className:"w-full",children:"Start Scan"})]})]})},wr=({scan:s,isActive:t,onClick:a,tags:l,onTagClick:n})=>{const i=JSON.parse(s.targets),c=s.status,d=()=>({pending:"Pending",running:"Running",completed:"Completed",failed:"Failed"})[s.status]||s.status;return e.jsxs("div",{onClick:a,className:`
        p-4 border rounded-lg cursor-pointer transition-all duration-200
        ${t?"bg-primary/10 border-primary shadow-lg":"bg-dark-surface border-dark-border hover:border-primary/50 hover:shadow-md"}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"text-white font-semibold truncate flex-1",children:s.name}),e.jsxs(ne,{variant:"status",type:c,children:[c==="running"&&e.jsx("span",{className:"inline-block w-2 h-2 bg-primary rounded-full animate-pulse-dot mr-1"}),d()]})]}),l&&l.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[l.slice(0,3).map(o=>e.jsxs("button",{type:"button",onClick:j=>{j.stopPropagation(),n==null||n(o.id)},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium hover:opacity-80 transition-opacity",style:{backgroundColor:o.color+"20",color:o.color},title:`Filter by ${o.name}`,children:[e.jsx(ns,{className:"h-3 w-3 mr-1"}),o.name]},o.id)),l.length>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs text-slate-400",children:["+",l.length-3," more"]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center text-slate-400",children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-mono text-xs",children:i[0]})]}),e.jsxs("div",{className:"flex items-center text-slate-500",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:Te(new Date(s.created_at),"MMM d, yyyy HH:mm")})]})]})]})},kr=({selectedIds:s,onSelectionChange:t})=>{const{scans:a,activeScan:l,setScans:n,setActiveScan:i}=ge(),[c,d]=r.useState(!0),[o,j]=r.useState(""),[N,y]=r.useState("all"),[x,g]=r.useState("all"),[b,v]=r.useState([]),[k,$]=r.useState({}),[w,u]=r.useState(!1),[h,F]=r.useState(""),[L,P]=r.useState("#06b6d4"),[V,C]=r.useState(null);r.useEffect(()=>{R(),p()},[]);const R=async()=>{try{const I=(await ve.getAllWithTags()).data;n(I.map(Y=>({...Y,tags:void 0})));const Z={};I.forEach(Y=>{Z[Y.id]=Y.tags||[]}),$(Z)}catch{try{const I=await ve.getAll();n(I.data)}catch{A.error("Failed to load scans")}}finally{d(!1)}},p=async()=>{try{const D=await ue.getAll();v(D.data)}catch(D){console.error("Failed to load tags:",D)}},f=async()=>{if(h.trim())try{const D=await ue.create({name:h.trim(),color:L});v([...b,D.data]),F(""),A.success("Tag created successfully")}catch{A.error("Failed to create tag")}},S=async D=>{try{await ue.delete(D),v(b.filter(I=>I.id!==D)),x===D&&g("all"),A.success("Tag deleted")}catch{A.error("Failed to delete tag")}},O=async(D,I)=>{D.stopPropagation(),C(I);try{const Y=(await ve.duplicate(I)).data;n([Y,...a]),k[I]&&$({...k,[Y.id]:k[I]}),A.success("Scan duplicated successfully")}catch{A.error("Failed to duplicate scan")}finally{C(null)}},_=a.filter(D=>{const I=D.name.toLowerCase().includes(o.toLowerCase())||D.targets.toLowerCase().includes(o.toLowerCase()),Z=N==="all"||D.status===N,Y=x==="all"||k[D.id]&&k[D.id].some(Se=>Se.id===x);return I&&Z&&Y}),E=D=>{t&&(D.target.checked?t(new Set(_.map(I=>I.id))):t(new Set))},W=(D,I)=>{if(!t||!s)return;const Z=new Set(s);I?Z.add(D):Z.delete(D),t(Z)},fe=["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444","#ec4899","#3b82f6","#84cc16"];return c?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ne,{})})}):e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scan History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>u(!w),className:"text-sm text-slate-400 hover:text-primary flex items-center gap-1",title:"Manage tags",children:[e.jsx(ns,{className:"h-4 w-4"}),"Tags"]}),e.jsxs("span",{className:"text-sm text-slate-400",children:[a.length," scans",s&&s.size>0&&` (${s.size} selected)`]})]})]}),w&&e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{type:"text",placeholder:"New tag name...",value:h,onChange:D=>F(D.target.value),className:"flex-1"}),e.jsx("div",{className:"flex gap-1",children:fe.map(D=>e.jsx("button",{onClick:()=>P(D),className:`w-6 h-6 rounded-full border-2 ${L===D?"border-white":"border-transparent"}`,style:{backgroundColor:D},title:D},D))}),e.jsx("button",{onClick:f,disabled:!h.trim(),className:"px-3 py-1.5 bg-primary text-white rounded hover:bg-primary/80 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(We,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.map(D=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:D.color+"20",color:D.color},children:[D.name,e.jsx("button",{onClick:()=>S(D.id),className:"hover:opacity-70",children:e.jsx(we,{className:"h-3 w-3"})})]},D.id)),b.length===0&&e.jsx("span",{className:"text-sm text-slate-500",children:"No tags yet"})]})]}),e.jsx(re,{type:"text",placeholder:"Search by name, target, or customer...",value:o,onChange:D=>j(D.target.value),icon:e.jsx(Ds,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ct,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-slate-400",children:"Status:"}),e.jsxs("select",{value:N,onChange:D=>y(D.target.value),className:"bg-dark-bg border border-dark-border text-slate-300 rounded px-2 py-1 focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),b.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-slate-400",children:"Tag:"}),e.jsxs("select",{value:x,onChange:D=>g(D.target.value),className:"bg-dark-bg border border-dark-border text-slate-300 rounded px-2 py-1 focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"all",children:"All Tags"}),b.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]})]})]}),t&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"select-all",checked:(s==null?void 0:s.size)===_.length&&_.length>0,onChange:E,className:"rounded border-dark-border bg-dark-bg text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"select-all",className:"text-sm text-slate-400 cursor-pointer",children:"Select All"})]})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:_.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:o||N!=="all"||x!=="all"?"No scans match your filters":"No scans yet. Create your first scan above."}):_.map(D=>e.jsxs("div",{className:"flex items-center space-x-2",children:[t&&e.jsx("input",{type:"checkbox",checked:(s==null?void 0:s.has(D.id))||!1,onChange:I=>W(D.id,I.target.checked),className:"rounded border-dark-border bg-dark-bg text-primary focus:ring-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(wr,{scan:D,isActive:(l==null?void 0:l.id)===D.id,onClick:()=>i(D),tags:k[D.id],onTagClick:I=>g(I)}),e.jsx("button",{onClick:I=>O(I,D.id),disabled:V===D.id,className:"absolute top-2 right-12 p-1.5 bg-dark-bg/90 border border-dark-border rounded opacity-0 group-hover:opacity-100 transition-opacity hover:border-primary hover:text-primary disabled:opacity-50",title:"Duplicate scan",children:V===D.id?e.jsx(Ne,{className:"h-4 w-4"}):e.jsx(Rs,{className:"h-4 w-4"})})]})]},D.id))})]})})},ss=[{name:"host_discovery",label:"Host Discovery",progressStart:0,progressEnd:20},{name:"port_scanning",label:"Port Scanning",progressStart:20,progressEnd:40},{name:"service_detection",label:"Service Detection",progressStart:40,progressEnd:60},{name:"enumeration",label:"Enumeration",progressStart:60,progressEnd:75},{name:"os_fingerprinting",label:"OS Fingerprinting",progressStart:75,progressEnd:85},{name:"vulnerability_scanning",label:"Vulnerability Scanning",progressStart:85,progressEnd:100}],Sr=({currentPhase:s,progress:t=0,isComplete:a=!1})=>{var d;const l=o=>o.toLowerCase().replace(/\s+/g,"_"),i=(()=>{if(a)return ss.length;if(!s)return-1;const o=l(s);return ss.findIndex(j=>j.name===o||l(j.label)===o)})(),c=o=>a||o<i?"completed":o===i?"active":"pending";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-6 left-0 right-0 h-0.5 bg-dark-border"}),e.jsx("div",{className:"absolute top-6 left-0 h-0.5 bg-gradient-to-r from-primary to-primary-light transition-all duration-500",style:{width:`${a?100:i/ss.length*100}%`}}),e.jsx("div",{className:"relative grid grid-cols-6 gap-2",children:ss.map((o,j)=>{const N=c(j);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-12 h-12 rounded-full border-2 transition-all duration-300
                    ${N==="completed"?"bg-green-500 border-green-500 shadow-lg shadow-green-500/50":N==="active"?"bg-primary border-primary shadow-lg shadow-primary/50 animate-pulse-glow":"bg-dark-surface border-dark-border"}
                  `,children:N==="completed"?e.jsx(Ts,{className:"h-6 w-6 text-white"}):N==="active"?e.jsx($t,{className:"h-6 w-6 text-white animate-spin"}):e.jsx(Na,{className:"h-6 w-6 text-slate-600"})}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("p",{className:`text-xs font-medium transition-colors ${N==="completed"?"text-green-500":N==="active"?"text-primary":"text-slate-500"}`,children:o.label}),N==="active"&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"In Progress..."}),N==="completed"&&e.jsx("p",{className:"text-xs text-green-500/70 mt-1",children:"Complete"})]})]},o.name)})})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:a?e.jsx("span",{className:"text-green-500 font-medium",children:"Scan Complete"}):s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary font-medium",children:((d=ss[i])==null?void 0:d.label)||s})," in progress..."]}):e.jsx("span",{className:"text-slate-500",children:"Initializing..."})}),e.jsxs("span",{className:"text-white font-semibold tabular-nums",children:[Math.round(t),"%"]})]}),e.jsx("div",{className:"relative h-3 bg-dark-surface rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary via-primary-light to-primary transition-all duration-500 ease-out",style:{width:`${a?100:t}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shimmer"})})})]})]})},ts=({value:s,duration:t=500})=>{const[a,l]=r.useState(0);return r.useEffect(()=>{if(a===s)return;const n=a,i=s-n,c=Date.now(),d=()=>{const o=Date.now()-c,j=Math.min(o/t,1),N=1-Math.pow(1-j,3),y=Math.round(n+i*N);l(y),j<1&&requestAnimationFrame(d)};requestAnimationFrame(d)},[s,t]),e.jsx("span",{className:"tabular-nums",children:a.toLocaleString()})},_r=({hostsFound:s,portsOpen:t,servicesDetected:a,vulnerabilitiesFound:l,criticalVulns:n=0,highVulns:i=0,mediumVulns:c=0,lowVulns:d=0})=>{const o=[{label:"Hosts Found",value:s,icon:ce,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/30"},{label:"Open Ports",value:t,icon:os,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/30"},{label:"Services Detected",value:a,icon:Qs,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/30"},{label:"Vulnerabilities",value:l,icon:U,color:l>0?"text-red-400":"text-slate-500",bgColor:l>0?"bg-red-500/10":"bg-slate-500/10",borderColor:l>0?"border-red-500/30":"border-slate-500/30"}],j=N=>{switch(N){case"critical":return"bg-severity-critical text-white";case"high":return"bg-severity-high text-white";case"medium":return"bg-severity-medium text-white";case"low":return"bg-severity-low text-white";default:return"bg-slate-600 text-white"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:o.map(N=>{const y=N.icon;return e.jsxs("div",{className:`relative overflow-hidden rounded-lg border ${N.borderColor} ${N.bgColor} p-4 transition-all duration-300 hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(y,{className:`h-5 w-5 ${N.color}`}),N.value>0&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-current animate-pulse-dot"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:e.jsx(ts,{value:N.value})}),e.jsx("p",{className:"text-xs text-slate-400 font-medium",children:N.label})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"})]},N.label)})}),l>0&&e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(G,{className:"h-4 w-4 text-red-400"}),e.jsx("h4",{className:"text-sm font-semibold text-white",children:"Vulnerability Breakdown"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${j("critical")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(ts,{value:n})})," Critical"]}),i>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${j("high")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(ts,{value:i})})," High"]}),c>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${j("medium")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(ts,{value:c})})," Medium"]}),d>0&&e.jsxs("div",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${j("low")}`,children:[e.jsx("span",{className:"font-bold",children:e.jsx(ts,{value:d})})," Low"]})]})]})]})};class Cr{constructor(t,a){Ce(this,"ws",null);Ce(this,"scanId");Ce(this,"token");Ce(this,"reconnectAttempts",0);Ce(this,"maxReconnectAttempts",10);Ce(this,"reconnectDelay",1e3);Ce(this,"messageHandlers",[]);Ce(this,"statusHandlers",[]);this.scanId=t,this.token=a||localStorage.getItem("token")||""}connect(){if(!this.token){console.error("WebSocket connection failed: No authentication token available"),this.updateStatus("failed");return}const t=window.location.protocol==="https:"?"wss:":"ws:",a=window.location.hostname,l=window.location.port||(t==="wss:"?"443":"80"),n=`${t}//${a}:${l}/api/ws/scans/${this.scanId}?token=${encodeURIComponent(this.token)}`;this.updateStatus("connecting");try{this.ws=new WebSocket(n),this.ws.onopen=()=>{console.log(`WebSocket connected for scan: ${this.scanId}`),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.updateStatus("connected")},this.ws.onmessage=i=>{try{const c=JSON.parse(i.data);this.messageHandlers.forEach(d=>d(c))}catch(c){console.error("Failed to parse WebSocket message:",c)}},this.ws.onerror=i=>{console.error("WebSocket error:",i)},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.updateStatus("disconnected"),this.attemptReconnect()}}catch(i){console.error("Failed to create WebSocket:",i),this.updateStatus("failed")}}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached"),this.updateStatus("failed");return}this.reconnectAttempts++;const t=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),8e3);console.log(`Reconnecting in ${t}ms... (Attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},t)}onMessage(t){this.messageHandlers.push(t)}onStatusChange(t){this.statusHandlers.push(t)}updateStatus(t){this.statusHandlers.forEach(a=>a(t))}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.messageHandlers=[],this.statusHandlers=[]}reconnect(){this.disconnect(),this.reconnectAttempts=0,this.connect()}}const $r=s=>{const[t,a]=r.useState("disconnected"),[l,n]=r.useState(null),i=r.useRef(null),{updateScanStatus:c,addHostToResults:d,updateHostInResults:o,results:j}=ge();r.useEffect(()=>{if(!s)return;const x=new Cr(s);return i.current=x,x.onStatusChange(g=>{a(g),n(g==="failed"?"Failed to connect to WebSocket":null)}),x.onMessage(g=>{N(s,g)}),x.connect(),()=>{x.disconnect(),i.current=null}},[s]);const N=(x,g)=>{switch(console.log("WebSocket message:",g),g.type){case"scanStarted":c(x,"running"),A.info("Scan started");break;case"phaseStarted":break;case"hostDiscovered":{const b={target:{ip:g.ip,hostname:g.hostname||null},is_alive:!0,os_guess:null,ports:[],vulnerabilities:[],scan_duration:{secs:0,nanos:0}};d(x,b);break}case"portFound":{const v=(j.get(x)||[]).find(k=>k.target.ip===g.ip);if(v){const k={port:g.port,protocol:g.protocol==="TCP"?"TCP":"UDP",state:g.state,service:null},$=[...v.ports,k];o(x,g.ip,{ports:$})}break}case"serviceDetected":{const v=(j.get(x)||[]).find(k=>k.target.ip===g.ip);if(v){const k=v.ports.map($=>$.port===g.port?{...$,service:{name:g.service_name,version:g.version||null,banner:null,cpe:null,ssl_info:null}}:$);o(x,g.ip,{ports:k})}break}case"vulnerabilityFound":{const v=(j.get(x)||[]).find(k=>k.target.ip===g.ip);if(v){const k={cve_id:g.cve_id||null,title:g.title,severity:g.severity,description:"",affected_service:null},$=[...v.vulnerabilities,k];o(x,g.ip,{vulnerabilities:$}),g.severity==="Critical"?A.error(` CRITICAL vulnerability found on ${g.ip}: ${g.title}`,{autoClose:8e3}):g.severity==="High"&&A.warning(` HIGH severity vulnerability found on ${g.ip}: ${g.title}`,{autoClose:6e3})}break}case"scanCompleted":c(x,"completed"),A.success(`Scan completed! Found ${g.total_hosts} hosts`);break;case"error":g.message&&!g.message.includes("channel")&&!g.message.includes("not found")?(c(x,"failed"),A.error(`Scan error: ${g.message}`)):console.log("WebSocket channel closed, fetching actual scan status from API");break;default:console.log("Unknown message type:",g.type)}};return{status:t,error:l,reconnect:()=>{i.current&&i.current.reconnect()}}},Fr=({scanId:s})=>{const{status:t,error:a,reconnect:l}=$r(s),{liveUpdates:n,scans:i}=ge(),[c,d]=r.useState(!0),o=r.useMemo(()=>i.find(h=>h.id===s),[i,s]),{currentPhase:j,progress:N,isComplete:y,metrics:x,currentActivity:g,estimatedTime:b}=r.useMemo(()=>{var I,Z,Y,Se,Pe,me;if(!s)return{currentPhase:void 0,progress:0,isComplete:!1,metrics:{hostsFound:0,portsOpen:0,servicesDetected:0,vulnerabilitiesFound:0,criticalVulns:0,highVulns:0,mediumVulns:0,lowVulns:0},currentActivity:"",estimatedTime:null};const h=n.get(s)||[],F=(o==null?void 0:o.status)==="completed",L=h.filter(q=>q.type==="phaseStarted"),P=L.length>0?L[L.length-1]:null,V=h.filter(q=>q.type==="scanProgress"),C=V.length>0?V[V.length-1]:null,R=h.filter(q=>q.type==="hostDiscovered"),p=h.filter(q=>q.type==="portFound"),f=h.filter(q=>q.type==="serviceDetected"),S=h.filter(q=>q.type==="vulnerabilityFound"),O=S.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="Critical"}).length,_=S.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="High"}).length,E=S.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="Medium"}).length,W=S.filter(q=>{var J;return((J=q.data)==null?void 0:J.severity)==="Low"}).length,fe=((I=C==null?void 0:C.data)==null?void 0:I.message)||((Z=P==null?void 0:P.data)==null?void 0:Z.phase)||"";let D=null;if(!F&&C&&((Y=C.data)==null?void 0:Y.progress)>0){const q=C.data.progress,J=h.find(ae=>ae.type==="scanStarted");if(J){const ae=new Date(J.timestamp).getTime(),H=(Date.now()-ae)/1e3,K=H/q*100;D=Math.max(0,K-H)}}return{currentPhase:(Se=P==null?void 0:P.data)==null?void 0:Se.phase,progress:((Pe=C==null?void 0:C.data)==null?void 0:Pe.progress)||((me=P==null?void 0:P.data)==null?void 0:me.progress)||0,isComplete:F,metrics:{hostsFound:R.length,portsOpen:p.length,servicesDetected:f.length,vulnerabilitiesFound:S.length,criticalVulns:O,highVulns:_,mediumVulns:E,lowVulns:W},currentActivity:fe,estimatedTime:D}},[s,n,o]),v=h=>h===null?"Calculating...":h<60?`~${Math.round(h)}s remaining`:h<3600?`~${Math.round(h/60)}m remaining`:`~${Math.round(h/3600)}h ${Math.round(h%3600/60)}m remaining`;if(!s)return e.jsx(M,{children:e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Select a scan to view real-time progress"})});const k=()=>{switch(t){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"disconnected":case"failed":return"text-red-500";default:return"text-slate-500"}},$=()=>t==="connected"?e.jsx(os,{className:"h-5 w-5"}):e.jsx(qs,{className:"h-5 w-5"}),w=()=>{switch(t){case"connected":return"Connected - Receiving live updates";case"connecting":return"Connecting to scan...";case"disconnected":return"Disconnected";case"failed":return"Connection failed";default:return"Unknown"}},u=(o==null?void 0:o.status)==="running"||(o==null?void 0:o.status)==="completed";return e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Real-Time Scan Progress"]}),e.jsxs(ne,{variant:"status",type:t==="connected"?"running":"pending",children:[t==="connected"&&e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse-dot mr-1"}),"Live"]})]}),e.jsx("button",{onClick:()=>d(!c),className:"p-2 hover:bg-dark-hover rounded-lg transition-colors",children:c?e.jsx(Le,{className:"h-5 w-5 text-slate-400"}):e.jsx(ke,{className:"h-5 w-5 text-slate-400"})})]}),e.jsxs("div",{className:`flex items-center space-x-2 ${k()}`,children:[$(),e.jsx("span",{className:"text-sm",children:w()})]}),a&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-500 text-sm",children:a}),e.jsx("button",{onClick:l,className:"mt-2 text-xs text-red-400 hover:text-red-300 underline",children:"Try reconnecting"})]}),c&&e.jsxs(e.Fragment,{children:[u&&!y&&g&&e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-primary mt-0.5 animate-pulse"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm text-slate-300",children:g})})]}),b!==null&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx(be,{className:"h-3 w-3"}),e.jsx("span",{children:v(b)})]})]}),u&&e.jsx(_r,{hostsFound:x.hostsFound,portsOpen:x.portsOpen,servicesDetected:x.servicesDetected,vulnerabilitiesFound:x.vulnerabilitiesFound,criticalVulns:x.criticalVulns,highVulns:x.highVulns,mediumVulns:x.mediumVulns,lowVulns:x.lowVulns}),u&&e.jsx("div",{className:"border-t border-dark-border pt-4",children:e.jsx(Sr,{currentPhase:j,progress:N,isComplete:y})}),t==="connected"&&!u&&e.jsxs("div",{className:"border-t border-dark-border pt-4 text-sm text-slate-400",children:[e.jsx("p",{children:"Listening for scan events:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-xs",children:[e.jsx("li",{children:" Host discoveries"}),e.jsx("li",{children:" Open ports"}),e.jsx("li",{children:" Service detections"}),e.jsx("li",{children:" Vulnerability findings"})]})]})]})]})})},Tr=({onScanSelect:s})=>{const{scans:t,liveUpdates:a,activeScan:l}=ge(),n=r.useMemo(()=>t.filter(j=>j.status==="running"),[t]),i=r.useMemo(()=>{const j=new Map;return n.forEach(N=>{var b;const x=(a.get(N.id)||[]).filter(v=>v.type==="scanProgress"||v.type==="phaseStarted"),g=x.length>0?x[x.length-1]:null;j.set(N.id,((b=g==null?void 0:g.data)==null?void 0:b.progress)||0)}),j},[n,a]),c=r.useMemo(()=>{let j=0,N=0,y=0;n.forEach(g=>{const b=a.get(g.id)||[];j+=i.get(g.id)||0,N+=b.filter(v=>v.type==="hostDiscovered").length,y+=b.filter(v=>v.type==="vulnerabilityFound").length});const x=n.length>0?j/n.length:0;return{totalScans:n.length,avgProgress:x,totalHosts:N,totalVulns:y}},[n,a,i]),d=j=>{switch(j){case"running":return e.jsx($t,{className:"h-4 w-4 text-primary animate-spin"});case"completed":return e.jsx(X,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(je,{className:"h-4 w-4 text-red-500"});default:return e.jsx(le,{className:"h-4 w-4 text-slate-400"})}},o=j=>{if(!j.started_at)return"";const N=new Date(j.started_at).getTime(),y=j.completed_at?new Date(j.completed_at).getTime():Date.now(),x=Math.floor((y-N)/1e3);return x<60?`${x}s`:x<3600?`${Math.floor(x/60)}m`:`${Math.floor(x/3600)}h ${Math.floor(x%3600/60)}m`};return n.length===0?null:e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Active Scans"}),e.jsxs(ne,{variant:"status",type:"running",children:[c.totalScans," Running"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pb-3 border-b border-dark-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(c.avgProgress),"%"]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Avg Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:c.totalHosts}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Hosts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-400",children:c.totalVulns}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Vulns"})]})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto custom-scrollbar",children:n.map(j=>{const N=i.get(j.id)||0,y=(l==null?void 0:l.id)===j.id;return e.jsxs("div",{onClick:()=>s==null?void 0:s(j.id),className:`
                  group relative p-3 rounded-lg border transition-all cursor-pointer
                  ${y?"bg-primary/10 border-primary":"bg-dark-surface border-dark-border hover:border-primary/50 hover:bg-dark-hover"}
                `,children:[e.jsx("div",{className:"absolute inset-0 bg-primary/5 rounded-lg transition-all duration-300",style:{width:`${N}%`}}),e.jsxs("div",{className:"relative flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[d(j.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:j.name}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:j.targets})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-primary tabular-nums",children:[Math.round(N),"%"]}),e.jsx("p",{className:"text-xs text-slate-500",children:o(j)})]}),e.jsx(qe,{className:`h-4 w-4 text-slate-400 transition-transform ${y?"text-primary":"group-hover:translate-x-1"}`})]})]}),e.jsx("div",{className:"relative mt-2 h-1 bg-dark-bg rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-primary to-primary-light transition-all duration-500",style:{width:`${N}%`}})})]},j.id)})})]})})},Ar=({scanId:s,maxItems:t=50})=>{const{liveUpdates:a}=ge(),[l,n]=r.useState(!1),i=r.useRef(null),[c,d]=r.useState(!0),o=s?a.get(s)||[]:[],N=(l?o.filter(b=>{var v,k;return b.type==="vulnerabilityFound"&&(((v=b.data)==null?void 0:v.severity)==="Critical"||((k=b.data)==null?void 0:k.severity)==="High")}):o).slice(-t);r.useEffect(()=>{c&&i.current&&i.current.scrollIntoView({behavior:"smooth"})},[N.length,c]);const y=b=>{switch(b){case"hostDiscovered":return e.jsx(ce,{className:"h-4 w-4 text-blue-400"});case"portFound":return e.jsx(os,{className:"h-4 w-4 text-green-400"});case"serviceDetected":return e.jsx(Qs,{className:"h-4 w-4 text-purple-400"});case"vulnerabilityFound":return e.jsx(U,{className:"h-4 w-4 text-red-400"});case"phaseStarted":return e.jsx(le,{className:"h-4 w-4 text-primary"});case"scanStarted":case"scanCompleted":return e.jsx(G,{className:"h-4 w-4 text-green-400"});case"vpnConnecting":return e.jsx(De,{className:"h-4 w-4 text-yellow-400 animate-pulse"});case"vpnConnected":return e.jsx(De,{className:"h-4 w-4 text-green-400"});case"vpnDisconnecting":return e.jsx(qs,{className:"h-4 w-4 text-yellow-400"});case"vpnDisconnected":return e.jsx(qs,{className:"h-4 w-4 text-slate-400"});case"vpnError":return e.jsx(De,{className:"h-4 w-4 text-red-400"});default:return e.jsx(le,{className:"h-4 w-4 text-slate-400"})}},x=b=>{var v,k,$,w,u,h,F,L,P,V,C,R,p,f,S,O,_,E,W,fe,D,I,Z,Y;switch(b.type){case"hostDiscovered":return e.jsxs(e.Fragment,{children:["Discovered host ",e.jsx("code",{className:"text-primary font-mono",children:(v=b.data)==null?void 0:v.ip}),((k=b.data)==null?void 0:k.hostname)&&` (${b.data.hostname})`]});case"portFound":return e.jsxs(e.Fragment,{children:["Found open port"," ",e.jsxs("code",{className:"text-green-400 font-mono",children:[($=b.data)==null?void 0:$.port,"/",(w=b.data)==null?void 0:w.protocol]})," ","on ",e.jsx("code",{className:"text-primary font-mono",children:(u=b.data)==null?void 0:u.ip})]});case"serviceDetected":return e.jsxs(e.Fragment,{children:["Detected service ",e.jsx("code",{className:"text-purple-400",children:(h=b.data)==null?void 0:h.service_name})," on"," ",e.jsx("code",{className:"text-primary font-mono",children:(F=b.data)==null?void 0:F.ip}),":",(L=b.data)==null?void 0:L.port]});case"vulnerabilityFound":return e.jsxs(e.Fragment,{children:["Found"," ",e.jsx(ne,{variant:"severity",type:((V=(P=b.data)==null?void 0:P.severity)==null?void 0:V.toLowerCase())||"low",children:(C=b.data)==null?void 0:C.severity})," ","vulnerability on ",e.jsx("code",{className:"text-primary font-mono",children:(R=b.data)==null?void 0:R.ip}),":"," ",e.jsx("span",{className:"text-white",children:(p=b.data)==null?void 0:p.title})]});case"phaseStarted":return e.jsxs(e.Fragment,{children:["Started phase: ",e.jsx("span",{className:"text-primary font-medium",children:(f=b.data)==null?void 0:f.phase})]});case"scanStarted":return e.jsx("span",{className:"text-green-400 font-medium",children:"Scan started"});case"scanCompleted":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-green-400 font-medium",children:"Scan completed"})," - Found"," ",((S=b.data)==null?void 0:S.total_hosts)||0," hosts in ",((O=b.data)==null?void 0:O.duration)||0,"s"]});case"error":return e.jsxs("span",{className:"text-red-400",children:["Error: ",(_=b.data)==null?void 0:_.message]});case"vpnConnecting":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-yellow-400",children:"Connecting to VPN:"})," ",e.jsx("span",{className:"text-white",children:(E=b.data)==null?void 0:E.config_name})]});case"vpnConnected":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-green-400 font-medium",children:"VPN connected"})," - ",(W=b.data)==null?void 0:W.config_name,((fe=b.data)==null?void 0:fe.assigned_ip)&&e.jsxs(e.Fragment,{children:[" (IP: ",e.jsx("code",{className:"text-primary font-mono",children:b.data.assigned_ip}),")"]})]});case"vpnDisconnecting":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-yellow-400",children:"Disconnecting from VPN:"})," ",e.jsx("span",{className:"text-white",children:(D=b.data)==null?void 0:D.config_name})]});case"vpnDisconnected":return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-400",children:"VPN disconnected:"})," ",e.jsx("span",{className:"text-white",children:(I=b.data)==null?void 0:I.config_name})]});case"vpnError":return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-red-400",children:["VPN Error (",(Z=b.data)==null?void 0:Z.config_name,"):"]})," ",(Y=b.data)==null?void 0:Y.message]});default:return e.jsx("span",{className:"text-slate-400",children:b.type})}},g=b=>{var v;if(b.type==="vulnerabilityFound")switch((v=b.data)==null?void 0:v.severity){case"Critical":return"border-l-severity-critical bg-severity-critical/5";case"High":return"border-l-severity-high bg-severity-high/5";case"Medium":return"border-l-severity-medium bg-severity-medium/5";default:return"border-l-severity-low bg-severity-low/5"}return b.type==="vpnConnecting"||b.type==="vpnDisconnecting"?"border-l-yellow-500 bg-yellow-500/5":b.type==="vpnConnected"?"border-l-green-500 bg-green-500/5":b.type==="vpnError"?"border-l-red-500 bg-red-500/5":"border-l-slate-600 bg-dark-bg"};return s?e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Live Activity Feed"}),e.jsxs("span",{className:"text-sm text-slate-400",children:["(",N.length," events)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n(!l),className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm transition-colors ${l?"bg-red-500/20 text-red-400 border border-red-500/50":"bg-dark-surface text-slate-400 border border-dark-border hover:border-primary"}`,children:[e.jsx(Ct,{className:"h-3 w-3"}),l?"Critical/High Only":"All Events"]}),e.jsx("button",{onClick:()=>d(!c),className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${c?"bg-primary text-white":"bg-dark-surface text-slate-400 border border-dark-border"}`,children:"Auto-scroll"})]})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto pr-2 custom-scrollbar",children:[N.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:l?"No critical/high severity findings yet":"Waiting for scan events..."}):N.map((b,v)=>e.jsx("div",{className:`border-l-4 rounded-r-lg p-3 transition-all hover:bg-dark-surface/50 ${g(b)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:y(b.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-slate-300",children:x(b)}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:Te(new Date(b.timestamp),"HH:mm:ss.SSS")})]})]})},v)),e.jsx("div",{ref:i})]})]}):e.jsx(M,{children:e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Select a running scan to view live activity"})})},Er={Critical:10,High:7,Medium:4,Low:1};function Us(s){let t=0;const a=s.vulnerabilities.reduce((i,c)=>i+Er[c.severity],0),l=s.ports.filter(i=>i.state==="Open").length,n=Math.min(l*2,30);return t=a+n,Math.min(Math.round(t),100)}function Dr(s){return s>=70?"Critical":s>=50?"High":s>=25?"Medium":"Low"}function Mt(s){const t={Critical:0,High:0,Medium:0,Low:0};return s.forEach(a=>{a.vulnerabilities.forEach(l=>{t[l.severity]++})}),t}function Rr(s){const t=new Map;return s.forEach(a=>{a.ports.filter(l=>l.state==="Open").forEach(l=>{var i;const n=t.get(l.port);n?n.count++:t.set(l.port,{count:1,service:((i=l.service)==null?void 0:i.name)||`Port ${l.port}`})})}),Array.from(t.entries()).map(([a,l])=>({port:a,...l})).sort((a,l)=>l.count-a.count).slice(0,10)}function Lr(s){const t=s.length,a=s.reduce((c,d)=>c+d.ports.filter(o=>o.state==="Open").length,0),l=Mt(s),n=Object.values(l).reduce((c,d)=>c+d,0),i=l.Critical;return{totalHosts:t,totalPorts:a,totalVulnerabilities:n,criticalVulnerabilities:i,vulnerabilities:l}}const Pr=({vulnerability:s,compact:t=!1})=>{const[a,l]=r.useState(!1),n=()=>{s.cve_id&&(navigator.clipboard.writeText(s.cve_id),A.success("CVE ID copied to clipboard"))},i=d=>`https://nvd.nist.gov/vuln/detail/${d}`,c=d=>{switch(d){case"Critical":return"border-severity-critical bg-severity-critical/10";case"High":return"border-severity-high bg-severity-high/10";case"Medium":return"border-severity-medium bg-severity-medium/10";case"Low":return"border-severity-low bg-severity-low/10";default:return"border-slate-600 bg-slate-600/10"}};return e.jsx("div",{className:`border-l-4 rounded-lg p-4 ${c(s.severity)}`,children:e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),e.jsx("h4",{className:"text-white font-semibold text-sm truncate",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[s.cve_id&&e.jsxs("div",{className:"flex items-center gap-1 bg-dark-surface px-2 py-1 rounded",children:[e.jsx("code",{className:"text-xs text-primary font-mono",children:s.cve_id}),e.jsx("button",{onClick:n,className:"text-slate-400 hover:text-white transition-colors",title:"Copy CVE ID",children:e.jsx(Rs,{className:"h-3 w-3"})}),e.jsx("a",{href:i(s.cve_id),target:"_blank",rel:"noopener noreferrer",className:"text-slate-400 hover:text-white transition-colors",title:"View on NVD",children:e.jsx(Ft,{className:"h-3 w-3"})})]}),e.jsx(ne,{variant:"severity",type:Lt(s.severity),children:s.severity}),s.affected_service&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Affects: ",e.jsx("span",{className:"text-slate-300 font-mono",children:s.affected_service})]})]}),!t&&s.description&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm text-slate-300 mt-2 ${a?"":"line-clamp-2"}`,children:s.description}),s.description.length>100&&e.jsx("button",{onClick:()=>l(!a),className:"flex items-center gap-1 text-xs text-primary hover:text-primary-light transition-colors mt-2",children:a?e.jsxs(e.Fragment,{children:["Show less ",e.jsx(Le,{className:"h-3 w-3"})]}):e.jsxs(e.Fragment,{children:["Show more ",e.jsx(ke,{className:"h-3 w-3"})]})})]})]})})})},Mr=({banner:s,service:t})=>{const[a,l]=r.useState(!1),n=()=>{navigator.clipboard.writeText(s),A.success("Service banner copied to clipboard")},i=s.length>100,c=a||!i?s:s.substring(0,100)+"...";return e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-3 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wa,{className:"h-4 w-4 text-green-400"}),e.jsxs("span",{className:"text-xs font-semibold text-slate-300",children:["Service Banner ",t&&`(${t})`]})]}),e.jsx("button",{onClick:n,className:"text-slate-400 hover:text-white transition-colors p-1 rounded hover:bg-dark-surface",title:"Copy banner",children:e.jsx(Rs,{className:"h-3 w-3"})})]}),e.jsx("pre",{className:"bg-slate-900 rounded p-2 overflow-x-auto",children:e.jsx("code",{className:"text-xs text-green-400 font-mono whitespace-pre-wrap break-all",children:c})}),i&&e.jsx("button",{onClick:()=>l(!a),className:"flex items-center gap-1 text-xs text-primary hover:text-primary-light transition-colors mt-2",children:a?e.jsxs(e.Fragment,{children:["Show less ",e.jsx(Le,{className:"h-3 w-3"})]}):e.jsxs(e.Fragment,{children:["Show full banner ",e.jsx(ke,{className:"h-3 w-3"})]})})]})};function zr(s){switch(s){case"A+":return{bg:"bg-emerald-500",text:"text-white",border:"border-emerald-600",glow:"shadow-emerald-500/50"};case"A":return{bg:"bg-green-500",text:"text-white",border:"border-green-600",glow:"shadow-green-500/50"};case"A-":return{bg:"bg-green-400",text:"text-white",border:"border-green-500",glow:"shadow-green-400/50"};case"B+":return{bg:"bg-lime-500",text:"text-white",border:"border-lime-600",glow:"shadow-lime-500/50"};case"B":return{bg:"bg-yellow-500",text:"text-gray-900",border:"border-yellow-600",glow:"shadow-yellow-500/50"};case"B-":return{bg:"bg-yellow-400",text:"text-gray-900",border:"border-yellow-500",glow:"shadow-yellow-400/50"};case"C":return{bg:"bg-orange-500",text:"text-white",border:"border-orange-600",glow:"shadow-orange-500/50"};case"D":return{bg:"bg-red-400",text:"text-white",border:"border-red-500",glow:"shadow-red-400/50"};case"F":return{bg:"bg-red-600",text:"text-white",border:"border-red-700",glow:"shadow-red-600/50"};case"T":return{bg:"bg-purple-600",text:"text-white",border:"border-purple-700",glow:"shadow-purple-600/50"};case"M":return{bg:"bg-fuchsia-600",text:"text-white",border:"border-fuchsia-700",glow:"shadow-fuchsia-600/50"};default:return{bg:"bg-gray-500",text:"text-white",border:"border-gray-600"}}}function jt(s){switch(s){case"A+":return"Excellent - Best possible SSL/TLS configuration with HSTS";case"A":return"Very Good - Strong SSL/TLS configuration";case"A-":return"Good - Minor improvements possible";case"B+":case"B":case"B-":return"Acceptable - Some security issues present";case"C":return"Weak - Significant security issues";case"D":return"Poor - Serious security vulnerabilities";case"F":return"Failed - Critical security issues";case"T":return"Trust Issue - Certificate not from a trusted CA (self-signed)";case"M":return"Mismatch - Certificate hostname does not match";default:return"Unknown - Grade could not be determined"}}function Hr(s){switch(s){case"T":return At;case"M":return ka;default:return null}}function Vr(s){return s>=90?"bg-emerald-500":s>=80?"bg-green-500":s>=70?"bg-lime-500":s>=60?"bg-yellow-500":s>=50?"bg-orange-500":"bg-red-500"}function Or(s){switch(s){case"Critical":return{bg:"bg-red-600",text:"text-white"};case"High":return{bg:"bg-orange-500",text:"text-white"};case"Medium":return{bg:"bg-yellow-500",text:"text-gray-900"};case"Low":return{bg:"bg-blue-500",text:"text-white"};case"Informational":return{bg:"bg-gray-500",text:"text-white"};default:return{bg:"bg-gray-500",text:"text-white"}}}function ks({label:s,score:t,icon:a}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:s})]}),e.jsxs("span",{className:"font-mono text-gray-200",children:[t,"/100"]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${Vr(t)} transition-all duration-300`,style:{width:`${t}%`}})})]})}function Br({vuln:s}){const t=Or(s.severity);return e.jsx("div",{className:"bg-gray-800 rounded-lg p-3 border border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${t.bg} ${t.text}`,children:s.severity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-200",children:s.name}),s.cve&&e.jsx("span",{className:"text-xs text-cyan-400 font-mono",children:s.cve})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s.description})]})]})})}function Ir({grade:s,showDetails:t=!0,compact:a=!1,animate:l=!0}){const[n,i]=r.useState(!1),[c,d]=r.useState(!l),o=zr(s.grade),j=Hr(s.grade),N=s.grade==="T"||s.grade==="M";return r.useEffect(()=>{if(l&&!c){const y=setTimeout(()=>d(!0),100);return()=>clearTimeout(y)}},[l,c]),a?e.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-lg font-bold text-sm
          ${o.bg} ${o.text} border ${o.border}
          ${c?"opacity-100 scale-100":"opacity-0 scale-75"}
          ${o.glow?`shadow-lg ${o.glow}`:""}
          transition-all duration-300 ease-out`,title:`SSL/TLS Grade: ${s.grade} - ${jt(s.grade)} (Score: ${s.overall_score}/100)`,children:j?e.jsx(j,{className:"w-4 h-4"}):s.grade}):e.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 ${t?"cursor-pointer hover:bg-gray-800/80":""} transition-colors`,onClick:()=>t&&i(!n),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-lg font-bold text-xl
              ${o.bg} ${o.text} border-2 ${o.border}
              ${c?"opacity-100 scale-100":"opacity-0 scale-75"}
              ${o.glow?`shadow-lg ${o.glow}`:""}
              transition-all duration-500 ease-out`,children:j?e.jsx(j,{className:"w-6 h-6"}):s.grade}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-200 font-medium",children:"SSL/TLS Grade"}),N&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.grade==="T"?"bg-purple-500/20 text-purple-400":"bg-fuchsia-500/20 text-fuchsia-400"}`,children:s.grade==="T"?"Trust Issue":"Hostname Mismatch"}),!N&&s.grade_capped&&e.jsx("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded",children:"Capped"})]}),e.jsx("div",{className:"text-sm text-gray-400",children:N?e.jsx("span",{children:jt(s.grade)}):e.jsxs(e.Fragment,{children:["Overall Score: ",s.overall_score,"/100",s.vulnerabilities_found.length>0&&e.jsxs("span",{className:"ml-2 text-red-400",children:["(",s.vulnerabilities_found.length," issue",s.vulnerabilities_found.length!==1?"s":"",")"]})]})})]})]}),t&&e.jsx("button",{className:"text-gray-400 hover:text-gray-200 p-1 transition-colors",children:n?e.jsx(Le,{className:"w-5 h-5"}):e.jsx(ke,{className:"w-5 h-5"})})]}),t&&n&&e.jsxs("div",{className:"border-t border-gray-700 p-4 space-y-4",children:[s.grade_capped&&s.cap_reason&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-400 font-medium",children:"Grade Capped"}),e.jsx("p",{className:"text-sm text-yellow-300/80 mt-1",children:s.cap_reason})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Score Breakdown"]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(ks,{label:"Protocol",score:s.protocol_score,icon:Re}),e.jsx(ks,{label:"Cipher Suites",score:s.cipher_score,icon:Ge}),e.jsx(ks,{label:"Certificate",score:s.certificate_score,icon:Zs}),e.jsx(ks,{label:"Key Exchange",score:s.key_exchange_score,icon:G})]})]}),s.vulnerabilities_found.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-red-400"}),"Issues Found (",s.vulnerabilities_found.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.vulnerabilities_found.map((y,x)=>e.jsx(Br,{vuln:y},`${y.id}-${x}`))})]}),s.recommendations.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-green-400"}),"Recommendations (",s.recommendations.length,")"]}),e.jsx("ul",{className:"space-y-2",children:s.recommendations.map((y,x)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-400",children:[e.jsx(Tt,{className:"w-4 h-4 text-cyan-400 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:y})]},x))})]}),s.vulnerabilities_found.length===0&&s.recommendations.length===0&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-3 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-emerald-500"}),e.jsx("span",{className:"text-emerald-400",children:"Excellent! No security issues or recommendations found."})]})]})]})}function Ur(s){return s>=90?"text-emerald-400":s>=80?"text-green-400":s>=70?"text-lime-400":s>=60?"text-yellow-400":s>=50?"text-orange-400":"text-red-400"}function Wr(s){return s>=90?"bg-emerald-500":s>=80?"bg-green-500":s>=70?"bg-lime-500":s>=60?"bg-yellow-500":s>=50?"bg-orange-500":"bg-red-500"}function Gr(s){switch(s){case"A+":return{bg:"bg-emerald-500",text:"text-white",border:"border-emerald-600"};case"A":return{bg:"bg-green-500",text:"text-white",border:"border-green-600"};case"A-":return{bg:"bg-green-400",text:"text-white",border:"border-green-500"};case"B+":return{bg:"bg-lime-500",text:"text-white",border:"border-lime-600"};case"B":return{bg:"bg-yellow-500",text:"text-gray-900",border:"border-yellow-600"};case"B-":return{bg:"bg-yellow-400",text:"text-gray-900",border:"border-yellow-500"};case"C":return{bg:"bg-orange-500",text:"text-white",border:"border-orange-600"};case"D":return{bg:"bg-red-400",text:"text-white",border:"border-red-500"};case"F":return{bg:"bg-red-600",text:"text-white",border:"border-red-700"};case"T":return{bg:"bg-purple-600",text:"text-white",border:"border-purple-700"};case"M":return{bg:"bg-fuchsia-600",text:"text-white",border:"border-fuchsia-700"};default:return{bg:"bg-gray-500",text:"text-white",border:"border-gray-600"}}}function Kr(s){switch(s){case"Critical":return"bg-red-600 text-white";case"High":return"bg-orange-500 text-white";case"Medium":return"bg-yellow-500 text-gray-900";case"Low":return"bg-blue-500 text-white";case"Informational":return"bg-gray-500 text-white";default:return"bg-gray-500 text-white"}}function Ss({label:s,score:t,icon:a,description:l}){return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-200",children:s})]}),e.jsxs("span",{className:`font-bold text-lg ${Ur(t)}`,children:[t,"/100"]})]}),e.jsx("div",{className:"h-3 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${Wr(t)} transition-all duration-500`,style:{width:`${t}%`}})}),l&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:l})]})}function qr({protocol:s,isWeak:t}){return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${t?"bg-red-500/10 border border-red-500/30":"bg-green-500/10 border border-green-500/30"}`,children:[t?e.jsx(je,{className:"w-4 h-4 text-red-400"}):e.jsx(X,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:t?"text-red-300":"text-green-300",children:s}),t&&e.jsx("span",{className:"text-xs text-red-400 ml-auto",children:"Weak"})]})}function Zr({cipher:s,isWeak:t}){return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded text-sm ${t?"bg-red-500/10 text-red-300":"bg-gray-700/50 text-gray-300"}`,children:[t&&e.jsx(U,{className:"w-3 h-3 text-red-400"}),e.jsx("span",{className:"font-mono text-xs truncate",children:s})]})}function Yr({sslInfo:s,hostname:t}){const a=s.ssl_grade;if(!a)return e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-6 border border-gray-700",children:e.jsx("p",{className:"text-gray-400 text-center",children:"SSL grade information not available"})});const l=Gr(a.grade),n=a.grade==="T"||a.grade==="M";return e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-800 to-gray-900 p-6 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`flex items-center justify-center w-24 h-24 rounded-xl font-bold text-4xl shadow-xl ${l.bg} ${l.text} border-4 ${l.border}`,children:a.grade}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-2",children:["SSL/TLS Security Grade",t&&e.jsxs("span",{className:"text-gray-400 font-normal ml-2",children:["for ",t]})]}),n?e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg ${a.grade==="T"?"bg-purple-500/20 text-purple-300":"bg-fuchsia-500/20 text-fuchsia-300"}`,children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:a.grade==="T"?"Certificate not trusted (self-signed or untrusted CA)":"Certificate hostname mismatch"})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:a.overall_score}),e.jsx("span",{className:"text-gray-500",children:"/100"})]}),a.grade_capped&&a.cap_reason&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"Grade capped"})]})]})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-cyan-400"}),"Score Breakdown"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ss,{label:"Protocol Support",score:a.protocol_score,icon:Re,description:"TLS version support and configuration"}),e.jsx(Ss,{label:"Cipher Strength",score:a.cipher_score,icon:Ge,description:"Encryption algorithms and key sizes"}),e.jsx(Ss,{label:"Certificate",score:a.certificate_score,icon:Zs,description:"Certificate validity and chain"}),e.jsx(Ss,{label:"Key Exchange",score:a.key_exchange_score,icon:G,description:"Forward secrecy and key exchange methods"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Zs,{className:"w-5 h-5 text-cyan-400"}),"Certificate Details"]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Subject"}),e.jsx("p",{className:"text-gray-200 font-mono text-sm truncate",title:s.subject,children:s.subject})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Issuer"}),e.jsx("p",{className:"text-gray-200 font-mono text-sm truncate",title:s.issuer,children:s.issuer})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Valid From"}),e.jsx("p",{className:"text-gray-200",children:new Date(s.valid_from).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Valid Until"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:s.cert_expired?"text-red-400":"text-gray-200",children:new Date(s.valid_until).toLocaleDateString()}),s.days_until_expiry!==null&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.cert_expired?"bg-red-500/20 text-red-400":s.days_until_expiry<30?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"}`,children:s.cert_expired?`Expired ${Math.abs(s.days_until_expiry)} days ago`:`${s.days_until_expiry} days`})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-gray-700",children:[s.self_signed&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded",children:[e.jsx(U,{className:"w-3 h-3"}),"Self-Signed"]}),s.hostname_mismatch&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-fuchsia-500/20 text-fuchsia-400 text-xs rounded",children:[e.jsx(je,{className:"w-3 h-3"}),"Hostname Mismatch"]}),s.hsts_enabled?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded",children:[e.jsx(X,{className:"w-3 h-3"}),"HSTS Enabled"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded",children:[e.jsx(U,{className:"w-3 h-3"}),"HSTS Not Enabled"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-cyan-400"}),"Protocol Support"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:s.protocols.map(i=>e.jsx(qr,{protocol:i,isWeak:s.weak_protocols.includes(i)},i))})]}),s.cipher_suites.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-cyan-400"}),"Cipher Suites",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",s.cipher_suites.length,")"]})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.cipher_suites.map(i=>e.jsx(Zr,{cipher:i,isWeak:s.weak_ciphers.includes(i)},i))})})]}),a.vulnerabilities_found.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-red-400"}),"Security Issues",e.jsxs("span",{className:"text-sm font-normal text-red-400",children:["(",a.vulnerabilities_found.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:a.vulnerabilities_found.map((i,c)=>e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded flex-shrink-0 ${Kr(i.severity)}`,children:i.severity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-200",children:i.name}),i.cve&&e.jsxs("a",{href:`https://nvd.nist.gov/vuln/detail/${i.cve}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 font-mono hover:underline flex items-center gap-1",children:[i.cve,e.jsx(Ft,{className:"w-3 h-3"})]})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:i.description})]})]})},`${i.id}-${c}`))})]}),a.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-green-400"}),"Recommendations"]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 space-y-2",children:a.recommendations.map((i,c)=>e.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[e.jsx(Tt,{className:"w-4 h-4 text-cyan-400 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-300",children:i})]},c))})]}),s.chain_issues.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-yellow-400"}),"Certificate Chain Issues"]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 space-y-2",children:s.chain_issues.map((i,c)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm text-yellow-300",children:[e.jsx(U,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:i})]},c))})]}),a.vulnerabilities_found.length===0&&a.recommendations.length===0&&s.chain_issues.length===0&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-6 flex items-center justify-center gap-3",children:[e.jsx(X,{className:"w-6 h-6 text-emerald-400"}),e.jsx("span",{className:"text-emerald-300 text-lg",children:"Excellent! SSL/TLS configuration meets best practices."})]})]})]})}const Jr=({sslInfo:s,port:t,hostname:a})=>{const[l,n]=r.useState(!1),c=s.cert_expired||s.hostname_mismatch?"critical":s.weak_protocols.length>0||s.weak_ciphers.length>0||s.self_signed?"warning":!s.hsts_enabled&&t===443?"info":"good",d=()=>s.cert_expired?"text-red-400":s.days_until_expiry?s.days_until_expiry<30?"text-yellow-400":s.days_until_expiry<90?"text-blue-400":"text-green-400":"text-slate-400";return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80",children:e.jsxs("div",{className:"relative w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 right-4 z-10 p-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-white transition-colors",children:e.jsx(je,{className:"w-6 h-6"})}),e.jsx(Yr,{sslInfo:s,hostname:a})]})}):e.jsxs("div",{className:"mt-3 space-y-3 border-t border-dark-border pt-3",children:[s.ssl_grade&&e.jsxs("div",{className:"relative",children:[e.jsx(Ir,{grade:s.ssl_grade,showDetails:!0,animate:!0}),e.jsx("button",{onClick:()=>n(!0),className:"absolute top-3 right-12 p-1.5 text-gray-400 hover:text-cyan-400 hover:bg-gray-700/50 rounded transition-colors",title:"View detailed SSL/TLS breakdown",children:e.jsx(Et,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:"SSL/TLS Certificate"}),!s.ssl_grade&&e.jsxs(e.Fragment,{children:[c==="critical"&&e.jsx(ne,{variant:"severity",type:"critical",children:"Critical Issues"}),c==="warning"&&e.jsx(ne,{variant:"severity",type:"high",children:"Security Issues"}),c==="good"&&e.jsx(ne,{variant:"severity",type:"low",children:"Secure"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[s.cert_valid&&!s.cert_expired?e.jsx(X,{className:"h-3 w-3 text-green-500"}):e.jsx(je,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Certificate Status"})]}),e.jsx("div",{className:s.cert_expired?"text-red-400":"text-green-400",children:s.cert_expired?"Expired":"Valid"})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(be,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Expires In"})]}),e.jsx("div",{className:d(),children:s.days_until_expiry!==null?s.cert_expired?`${Math.abs(s.days_until_expiry)} days ago`:`${s.days_until_expiry} days`:"Unknown"})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2 col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ce,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Subject"})]}),e.jsx("div",{className:"text-slate-400 truncate",title:s.subject,children:s.subject})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2 col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(G,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-300",children:"Issuer"})]}),e.jsx("div",{className:"text-slate-400 truncate",title:s.issuer,children:s.issuer})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("span",{className:"font-medium text-slate-300",children:"Valid From"}),e.jsx("div",{className:"text-slate-400 text-[10px] mt-1",children:new Date(s.valid_from).toLocaleDateString()})]}),e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("span",{className:"font-medium text-slate-300",children:"Valid Until"}),e.jsx("div",{className:"text-slate-400 text-[10px] mt-1",children:new Date(s.valid_until).toLocaleDateString()})]})]}),(s.self_signed||s.hostname_mismatch||s.weak_protocols.length>0||s.weak_ciphers.length>0||!s.hsts_enabled||s.chain_issues.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm font-medium text-yellow-400",children:[e.jsx(U,{className:"h-4 w-4"}),"Security Findings"]}),s.self_signed&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-yellow-400 font-medium",children:"Self-Signed Certificate"}),e.jsx("div",{className:"text-slate-400 mt-1",children:"Certificate is not from a trusted Certificate Authority"})]}),s.hostname_mismatch&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-red-400 font-medium",children:"Hostname Mismatch"}),e.jsx("div",{className:"text-slate-400 mt-1",children:"Certificate does not match the hostname"})]}),s.weak_protocols.length>0&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-red-400 font-medium",children:"Weak Protocols"}),e.jsx("div",{className:"text-slate-400 mt-1",children:s.weak_protocols.join(", ")})]}),s.weak_ciphers.length>0&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-yellow-400 font-medium",children:"Weak Ciphers"}),e.jsx("div",{className:"text-slate-400 mt-1 max-h-16 overflow-y-auto",children:s.weak_ciphers.join(", ")})]}),!s.hsts_enabled&&t===443&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-blue-400 font-medium",children:"HSTS Not Enabled"}),e.jsx("div",{className:"text-slate-400 mt-1",children:"HTTP Strict Transport Security header not detected"})]}),s.chain_issues.length>0&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-yellow-400 font-medium",children:"Certificate Chain Issues"}),e.jsx("div",{className:"text-slate-400 mt-1",children:s.chain_issues.join(", ")})]})]}),s.protocols.length>0&&e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-300 mb-1",children:"Supported Protocols"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.protocols.map(o=>e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] ${s.weak_protocols.includes(o)?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:o},o))})]}),s.hsts_enabled&&e.jsxs("div",{className:"bg-dark-bg rounded p-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-300 mb-1",children:"HSTS"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(X,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-green-400",children:"Enabled"}),s.hsts_max_age&&e.jsxs("span",{className:"text-slate-400",children:["(max-age: ",s.hsts_max_age.toLocaleString(),"s)"]})]})]})]})},Qr=({hosts:s,scanName:t="scan",scanId:a,disabled:l=!1})=>{const[n,i]=r.useState(!1),[c,d]=r.useState(!1),o=()=>{const b={scan:t,exportedAt:new Date().toISOString(),totalHosts:s.length,hosts:s.map(v=>({ip:v.target.ip,hostname:v.target.hostname,isAlive:v.is_alive,osGuess:v.os_guess,ports:v.ports.map(k=>({port:k.port,protocol:k.protocol,state:k.state,service:k.service})),vulnerabilities:v.vulnerabilities}))};x(JSON.stringify(b,null,2),`${t}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.json`,"application/json"),A.success("Exported as JSON")},j=()=>{let b=`IP,Hostname,Alive,OS,Ports,Vulnerabilities,Critical,High,Medium,Low
`;s.forEach(v=>{var w;const k=v.ports.filter(u=>u.state==="Open").map(u=>u.port).join(";"),$={Critical:v.vulnerabilities.filter(u=>u.severity==="Critical").length,High:v.vulnerabilities.filter(u=>u.severity==="High").length,Medium:v.vulnerabilities.filter(u=>u.severity==="Medium").length,Low:v.vulnerabilities.filter(u=>u.severity==="Low").length};b+=`"${v.target.ip}",`,b+=`"${v.target.hostname||""}",`,b+=`${v.is_alive},`,b+=`"${((w=v.os_guess)==null?void 0:w.os_family)||""}",`,b+=`"${k}",`,b+=`${v.vulnerabilities.length},`,b+=`${$.Critical},`,b+=`${$.High},`,b+=`${$.Medium},`,b+=`${$.Low}
`}),x(b,`${t}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.csv`,"text/csv"),A.success("Exported as CSV")},N=()=>{const b=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HeroForge Scan Report - ${t}</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      padding: 2rem;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: #3b82f6; margin-bottom: 0.5rem; }
    .meta { color: #94a3b8; margin-bottom: 2rem; }
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 1.5rem;
    }
    .card h3 { color: #cbd5e1; font-size: 0.875rem; margin-bottom: 0.5rem; }
    .card .value { font-size: 2rem; font-weight: bold; }
    .host {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    .host-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #334155;
    }
    .host-ip { font-family: monospace; font-size: 1.25rem; color: #3b82f6; }
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-critical { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .badge-high { background: rgba(249, 115, 22, 0.2); color: #f97316; }
    .badge-medium { background: rgba(234, 179, 8, 0.2); color: #eab308; }
    .badge-low { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .section { margin-top: 1rem; }
    .section h4 { color: #cbd5e1; margin-bottom: 0.5rem; font-size: 0.875rem; }
    .ports { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; }
    .port {
      background: #0f172a;
      padding: 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.875rem;
    }
    .vuln {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid #ef4444;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 4px;
    }
    .vuln-title { color: #fff; font-weight: 600; margin-bottom: 0.25rem; }
    .vuln-cve { color: #3b82f6; font-family: monospace; font-size: 0.875rem; }
    @media print {
      body { background: white; color: black; }
      .card, .host { border-color: #ccc; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> HeroForge Scan Report</h1>
    <p class="meta">
      Scan: ${t} |
      Generated: ${Te(new Date,"PPpp")} |
      Hosts: ${s.length}
    </p>

    <div class="summary">
      <div class="card">
        <h3>Total Hosts</h3>
        <div class="value" style="color: #3b82f6;">${s.length}</div>
      </div>
      <div class="card">
        <h3>Open Ports</h3>
        <div class="value" style="color: #22c55e;">
          ${s.reduce((v,k)=>v+k.ports.filter($=>$.state==="Open").length,0)}
        </div>
      </div>
      <div class="card">
        <h3>Total Vulnerabilities</h3>
        <div class="value" style="color: #eab308;">
          ${s.reduce((v,k)=>v+k.vulnerabilities.length,0)}
        </div>
      </div>
      <div class="card">
        <h3>Critical Findings</h3>
        <div class="value" style="color: #ef4444;">
          ${s.reduce((v,k)=>v+k.vulnerabilities.filter($=>$.severity==="Critical").length,0)}
        </div>
      </div>
    </div>

    <h2 style="color: #cbd5e1; margin-bottom: 1rem;">Discovered Hosts</h2>
    ${s.map(v=>`
      <div class="host">
        <div class="host-header">
          <div>
            <div class="host-ip">${v.target.ip}</div>
            ${v.target.hostname?`<div style="color: #94a3b8; font-size: 0.875rem;">${v.target.hostname}</div>`:""}
          </div>
          <div>
            ${v.vulnerabilities.length>0?`<span class="badge badge-critical">${v.vulnerabilities.length} vulnerabilities</span>`:""}
          </div>
        </div>

        ${v.os_guess?`
          <div class="section">
            <h4>OS Detection</h4>
            <p style="color: #94a3b8; font-size: 0.875rem;">
              ${v.os_guess.os_family} ${v.os_guess.os_version||""} (${v.os_guess.confidence}% confidence)
            </p>
          </div>
        `:""}

        ${v.ports.filter(k=>k.state==="Open").length>0?`
          <div class="section">
            <h4>Open Ports (${v.ports.filter(k=>k.state==="Open").length})</h4>
            <div class="ports">
              ${v.ports.filter(k=>k.state==="Open").map(k=>`
                <div class="port">
                  <strong>${k.port}/${k.protocol}</strong><br>
                  ${k.service?`<span style="color: #94a3b8;">${k.service.name} ${k.service.version||""}</span>`:""}
                </div>
              `).join("")}
            </div>
          </div>
        `:""}

        ${v.vulnerabilities.length>0?`
          <div class="section">
            <h4>Vulnerabilities (${v.vulnerabilities.length})</h4>
            ${v.vulnerabilities.map(k=>`
              <div class="vuln">
                <div class="vuln-title">${k.title}</div>
                ${k.cve_id?`<div class="vuln-cve">${k.cve_id}</div>`:""}
                <span class="badge badge-${k.severity.toLowerCase()}">${k.severity}</span>
              </div>
            `).join("")}
          </div>
        `:""}
      </div>
    `).join("")}

    <footer style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #334155; text-align: center; color: #64748b;">
      <p>Generated by HeroForge - Network Reconnaissance Tool</p>
      <p style="font-size: 0.875rem;">For authorized security testing only</p>
    </footer>
  </div>
</body>
</html>`;x(b,`${t}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.html`,"text/html"),A.success("Exported as HTML report")},y=async()=>{if(!a){A.error("Scan ID required for Markdown export");return}d(!0);try{const b=localStorage.getItem("token"),v=await sr.get(`/api/scans/${a}/export/markdown`,{headers:{Authorization:`Bearer ${b}`},responseType:"blob"}),k=v.headers["content-disposition"];let $=`${t}_${Te(new Date,"yyyy-MM-dd_HHmmss")}.md`;if(k){const h=k.match(/filename="?([^";\n]+)"?/);h&&($=h[1])}const w=window.URL.createObjectURL(new Blob([v.data])),u=document.createElement("a");u.href=w,u.setAttribute("download",$),document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(w),A.success("Exported as Markdown")}catch(b){console.error("Markdown export failed:",b),A.error("Failed to export as Markdown")}finally{d(!1)}},x=(b,v,k)=>{const $=new Blob([b],{type:k}),w=URL.createObjectURL($),u=document.createElement("a");u.href=w,u.download=v,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(w)},g=b=>{if(i(!1),s.length===0){A.error("No results to export");return}switch(b){case"json":o();break;case"csv":j();break;case"html":N();break;case"markdown":y();break}};return e.jsxs("div",{className:"relative",children:[e.jsxs(Q,{onClick:()=>i(!n),disabled:l||s.length===0,variant:"secondary",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Export Results"]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-dark-surface border border-dark-border rounded-lg shadow-xl z-20 overflow-hidden",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>g("json"),className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors",children:[e.jsx(Sa,{className:"h-4 w-4 text-blue-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"JSON"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Full data export"})]})]}),e.jsxs("button",{onClick:()=>g("csv"),className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors",children:[e.jsx(xe,{className:"h-4 w-4 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"CSV"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Spreadsheet format"})]})]}),e.jsxs("button",{onClick:()=>g("html"),className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors",children:[e.jsx(Qs,{className:"h-4 w-4 text-purple-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"HTML"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Printable report"})]})]}),e.jsxs("button",{onClick:()=>g("markdown"),disabled:!a||c,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(_a,{className:"h-4 w-4 text-cyan-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Markdown"}),e.jsx("div",{className:"text-xs text-slate-500",children:"GitHub-flavored MD"})]})]})]})})]})]})},Xr={tableOfContents:"Table of Contents",executiveSummary:"Executive Summary",riskOverview:"Risk Overview",hostInventory:"Host Inventory",portAnalysis:"Port Analysis",vulnerabilityFindings:"Vulnerability Findings",serviceEnumeration:"Service Enumeration",remediationRecommendations:"Remediation Recommendations",appendix:"Appendix"},el=({scanId:s,scanName:t,onClose:a,onReportCreated:l})=>{const[n,i]=r.useState([]),[c,d]=r.useState(!0),[o,j]=r.useState(!1),[N,y]=r.useState(!1),[x,g]=r.useState(`${t} Report`),[b,v]=r.useState(""),[k,$]=r.useState("pdf"),[w,u]=r.useState("technical"),[h,F]=r.useState([]),[L,P]=r.useState({include_charts:!0,company_name:"",assessor_name:"",classification:"Confidential"});r.useEffect(()=>{V()},[]),r.useEffect(()=>{const f=n.find(S=>S.id===w);f&&F(f.default_sections)},[w,n]);const V=async()=>{try{const f=await ls.getTemplates();i(f.data);const S=f.data.find(O=>O.id==="technical");S&&F(S.default_sections)}catch{A.error("Failed to load report templates")}finally{d(!1)}},C=f=>{F(S=>S.includes(f)?S.filter(O=>O!==f):[...S,f])},R=async()=>{var f,S;if(!x.trim()){A.error("Please enter a report name");return}if(h.length===0){A.error("Please select at least one section");return}j(!0);try{const O={scan_id:s,name:x.trim(),description:b.trim()||void 0,format:k,template_id:w,sections:h,options:L};await ls.create(O),A.success("Report generation started"),l==null||l(),a()}catch(O){const E=((S=(f=O.response)==null?void 0:f.data)==null?void 0:S.error)||"Failed to create report";A.error(E)}finally{j(!1)}},p=n.find(f=>f.id===w);return c?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx(M,{className:"w-full max-w-2xl mx-4",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ne,{})})})}):e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs(M,{className:"w-full max-w-2xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"h-6 w-6 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Generate Report"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-dark-surface rounded-lg transition-colors",children:e.jsx(we,{className:"h-5 w-5 text-slate-400"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Name"}),e.jsx(re,{type:"text",value:x,onChange:f=>g(f.target.value),placeholder:"Enter report name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description (optional)"}),e.jsx("textarea",{value:b,onChange:f=>v(f.target.value),placeholder:"Brief description of the report",className:"w-full bg-dark-surface border border-dark-border rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Template"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:n.map(f=>e.jsxs("button",{onClick:()=>u(f.id),className:`p-4 rounded-lg border text-left transition-all ${w===f.id?"border-primary bg-primary/10":"border-dark-border hover:border-primary/50"}`,children:[e.jsx("p",{className:"font-medium text-white",children:f.name}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:f.description})]},f.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Output Format"}),e.jsx("div",{className:"flex gap-3",children:p==null?void 0:p.supports_formats.map(f=>e.jsxs("button",{onClick:()=>$(f),className:`px-6 py-3 rounded-lg border font-medium transition-all flex items-center gap-2 ${k===f?"border-primary bg-primary/10 text-primary":"border-dark-border text-slate-400 hover:border-primary/50"}`,children:[e.jsx(He,{className:"h-4 w-4"}),f.toUpperCase()]},f))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Included Sections"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Xr).map(([f,S])=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${h.includes(S)?"border-primary bg-primary/10":"border-dark-border hover:border-primary/50"}`,children:[e.jsx("input",{type:"checkbox",checked:h.includes(S),onChange:()=>C(S),className:"w-4 h-4 rounded border-dark-border text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-white",children:S})]},f))})]}),e.jsxs("button",{onClick:()=>y(!N),className:"flex items-center gap-2 text-sm text-slate-400 hover:text-white transition-colors",children:[e.jsx(Ys,{className:"h-4 w-4"}),N?"Hide":"Show"," Advanced Options"]}),N&&e.jsxs("div",{className:"space-y-4 p-4 bg-dark-surface rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Company Name"}),e.jsx(re,{type:"text",value:L.company_name||"",onChange:f=>P({...L,company_name:f.target.value}),placeholder:"Your Company"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Assessor Name"}),e.jsx(re,{type:"text",value:L.assessor_name||"",onChange:f=>P({...L,assessor_name:f.target.value}),placeholder:"Security Analyst"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Classification"}),e.jsxs("select",{value:L.classification||"",onChange:f=>P({...L,classification:f.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"Public",children:"Public"}),e.jsx("option",{value:"Internal",children:"Internal"}),e.jsx("option",{value:"Confidential",children:"Confidential"}),e.jsx("option",{value:"Restricted",children:"Restricted"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:L.include_charts,onChange:f=>P({...L,include_charts:f.target.checked}),className:"w-4 h-4 rounded border-dark-border text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-white",children:"Include visual charts"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-border",children:[e.jsx(Q,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(Q,{onClick:R,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:"sm",className:"mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Generate Report"]})})]})]})]})})},sl=({scanId:s,onGenerateNew:t})=>{const[a,l]=r.useState([]),[n,i]=r.useState(!0),[c,d]=r.useState(null),[o,j]=r.useState(null),[N,y]=r.useState(null);r.useEffect(()=>{x();const w=setInterval(()=>{a.filter(h=>h.status==="pending"||h.status==="generating").length>0&&x()},5e3);return()=>clearInterval(w)},[s]);const x=async()=>{try{const w=await ls.getAll(s);l(w.data)}catch{A.error("Failed to load reports")}finally{i(!1)}},g=async w=>{if(w.status!=="completed"){A.warning("Report is not ready for download");return}d(w.id);try{const u=await ls.download(w.id),h=new Blob([u.data],{type:u.headers["content-type"]}),F=window.URL.createObjectURL(h),L=document.createElement("a");L.href=F,L.download=`${w.name.replace(/\s+/g,"_")}.${w.format}`,document.body.appendChild(L),L.click(),window.URL.revokeObjectURL(F),document.body.removeChild(L),A.success("Report downloaded")}catch{A.error("Failed to download report")}finally{d(null)}},b=async()=>{if(N){j(N.id);try{await ls.delete(N.id),l(w=>w.filter(u=>u.id!==N.id)),A.success(`Report "${N.name}" deleted`),y(null)}catch{A.error("Failed to delete report")}finally{j(null)}}},v=w=>{switch(w){case"completed":return e.jsx(X,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(je,{className:"h-4 w-4 text-red-500"});case"generating":return e.jsx(ie,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(be,{className:"h-4 w-4 text-slate-400"})}},k=w=>{switch(w){case"completed":return"completed";case"generating":return"running";case"failed":return"failed";default:return"pending"}},$=w=>w?w<1024?`${w} B`:w<1024*1024?`${(w/1024).toFixed(1)} KB`:`${(w/(1024*1024)).toFixed(1)} MB`:"-";return n?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ne,{})})}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-4 text-slate-500"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Reports Yet"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Generate a professional report from your scan results."}),t&&e.jsxs(Q,{onClick:t,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]})}):e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-primary"}),"Reports"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x,className:"p-2 hover:bg-dark-surface rounded-lg transition-colors",title:"Refresh",children:e.jsx(as,{className:"h-4 w-4 text-slate-400"})}),t&&e.jsxs(Q,{size:"sm",onClick:t,children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"New Report"]})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-surface rounded-lg border border-dark-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-dark-bg rounded-lg",children:v(w.status)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:w.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-400 mt-1",children:[e.jsx("span",{className:"uppercase font-mono",children:w.format}),e.jsx("span",{children:"|"}),e.jsx("span",{children:w.template_id}),e.jsx("span",{children:"|"}),e.jsx("span",{children:Te(new Date(w.created_at),"MMM d, yyyy HH:mm")}),w.file_size&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"|"}),e.jsx("span",{children:$(w.file_size)})]})]}),w.error_message&&e.jsx("p",{className:"text-sm text-red-400 mt-1",children:w.error_message})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{variant:"status",type:k(w.status),children:w.status}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>g(w),disabled:w.status!=="completed"||c===w.id,className:`p-2 rounded-lg transition-colors ${w.status==="completed"?"hover:bg-dark-bg text-slate-400 hover:text-white":"text-slate-600 cursor-not-allowed"}`,title:"Download",children:c===w.id?e.jsx(ie,{className:"h-4 w-4 animate-spin"}):e.jsx(He,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>y(w),disabled:o===w.id,className:"p-2 rounded-lg text-slate-400 hover:text-red-400 hover:bg-dark-bg transition-colors",title:"Delete","aria-label":`Delete report ${w.name}`,children:o===w.id?e.jsx(ie,{className:"h-4 w-4 animate-spin"}):e.jsx(Xs,{className:"h-4 w-4"})})]})]})]},w.id))}),e.jsx(tr,{isOpen:!!N,onClose:()=>y(null),onConfirm:b,title:"Delete Report",message:`Are you sure you want to delete the report "${N==null?void 0:N.name}"?`,confirmLabel:"Delete Report",variant:"danger",loading:!!o})]})},tl=({scanId:s,scanName:t,onClose:a})=>{const[l,n]=r.useState([]),[i,c]=r.useState(new Set),[d,o]=r.useState(!1),[j,N]=r.useState(!1),[y,x]=r.useState(null),[g,b]=r.useState(null),[v,k]=r.useState(!1),[$,w]=r.useState("pdf");r.useEffect(()=>{u()},[]);const u=async()=>{o(!0);try{const C=await fs.getFrameworks();n(C.data.frameworks),c(new Set(["pci_dss","nist_800_53","owasp_top10"]))}catch{A.error("Failed to load compliance frameworks")}finally{o(!1)}},h=async()=>{var C,R;if(i.size===0){A.warning("Please select at least one framework");return}N(!0);try{const p=await fs.analyzeScan(s,{frameworks:Array.from(i)});x(p.data),A.success("Compliance analysis completed")}catch(p){const f=p;A.error(((R=(C=f.response)==null?void 0:C.data)==null?void 0:R.error)||"Analysis failed")}finally{N(!1)}},F=C=>{const R=new Set(i);R.has(C)?R.delete(C):R.add(C),c(R)},L=C=>C>=80?"text-green-400":C>=60?"text-yellow-400":C>=40?"text-orange-400":"text-red-400",P=C=>C>=80?"completed":C>=60?"running":"failed",V=async()=>{var C,R;if(y){k(!0);try{const p=y.summary.frameworks.map(W=>String(W.framework).toLowerCase().replace(/_/g,"_")),f=await fs.generateReport(s,{frameworks:p,format:$,include_evidence:!0}),S=await fs.downloadReport(f.data.report_id),O=new Blob([S.data],{type:$==="pdf"?"application/pdf":$==="html"?"text/html":"application/json"}),_=window.URL.createObjectURL(O),E=document.createElement("a");E.href=_,E.download=`compliance_report_${s}.${$}`,document.body.appendChild(E),E.click(),document.body.removeChild(E),window.URL.revokeObjectURL(_),A.success(`${$.toUpperCase()} report generated and downloaded successfully`)}catch(p){const f=p;A.error(((R=(C=f.response)==null?void 0:C.data)==null?void 0:R.error)||"Failed to generate report")}finally{k(!1)}}};return d?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:e.jsx(M,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ne,{})})})}):e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:e.jsxs(M,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Compliance Analysis"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Scan: ",t]})]})]}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(je,{className:"h-6 w-6"})})]}),y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 p-4 bg-dark-bg rounded-lg border border-dark-border",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:`text-3xl font-bold ${L(y.summary.overall_score)}`,children:[y.summary.overall_score.toFixed(0),"%"]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Overall Score"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:y.summary.total_findings}),e.jsx("p",{className:"text-sm text-slate-400",children:"Total Findings"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-red-400",children:y.summary.critical_findings+y.summary.high_findings}),e.jsx("p",{className:"text-sm text-slate-400",children:"Critical/High"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:y.summary.medium_findings+y.summary.low_findings}),e.jsx("p",{className:"text-sm text-slate-400",children:"Medium/Low"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Framework Results"}),y.summary.frameworks.map(C=>e.jsxs("div",{className:"border border-dark-border rounded-lg overflow-hidden",children:[e.jsxs("div",{onClick:()=>b(g===C.framework?null:C.framework),className:"flex items-center justify-between p-4 bg-dark-surface cursor-pointer hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g===C.framework?e.jsx(ke,{className:"h-5 w-5 text-slate-400"}):e.jsx(qe,{className:"h-5 w-5 text-slate-400"}),e.jsx("span",{className:"font-medium text-white",children:C.framework})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ca,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-green-400",children:C.compliant})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(je,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-red-400",children:C.non_compliant})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(U,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400",children:C.partially_compliant})]}),e.jsxs(ne,{variant:"status",type:P(C.compliance_score),children:[C.compliance_score.toFixed(0),"%"]})]})]}),g===C.framework&&e.jsxs("div",{className:"p-4 bg-dark-bg border-t border-dark-border",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Total Controls"}),e.jsx("p",{className:"text-xl font-bold text-white",children:C.total_controls})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Compliant"}),e.jsx("p",{className:"text-xl font-bold text-green-400",children:C.compliant})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Non-Compliant"}),e.jsx("p",{className:"text-xl font-bold text-red-400",children:C.non_compliant})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Partially Compliant"}),e.jsx("p",{className:"text-xl font-bold text-yellow-400",children:C.partially_compliant})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Not Applicable"}),e.jsx("p",{className:"text-xl font-bold text-slate-400",children:C.not_applicable})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded-lg",children:[e.jsx("p",{className:"text-slate-400",children:"Not Assessed"}),e.jsx("p",{className:"text-xl font-bold text-slate-500",children:C.not_assessed})]})]}),C.by_category&&C.by_category.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"By Category"}),e.jsx("div",{className:"space-y-2",children:C.by_category.map(R=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-surface rounded",children:[e.jsx("span",{className:"text-sm text-white",children:R.category}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[R.compliant,"/",R.total," compliant"]}),e.jsx("div",{className:"w-24 bg-dark-border rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${R.percentage>=80?"bg-green-500":R.percentage>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${R.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-slate-300 w-12 text-right",children:[R.percentage.toFixed(0),"%"]})]})]},R.category))})]})]})]},C.framework))]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-dark-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Generate Compliance Report"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex gap-2",children:["pdf","html","json"].map(C=>e.jsx("button",{onClick:()=>w(C),className:`px-4 py-2 rounded-lg font-medium transition-colors ${$===C?"bg-primary text-white":"bg-dark-surface text-slate-400 hover:bg-dark-hover"}`,children:C.toUpperCase()},C))}),e.jsx(Q,{onClick:V,disabled:v,className:"ml-auto",children:v?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4 animate-spin mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx($a,{className:"h-4 w-4 mr-2"}),"Generate Report"]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-dark-border",children:[e.jsxs(Q,{variant:"secondary",onClick:()=>x(null),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Run New Analysis"]}),e.jsx(Q,{onClick:a,children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Compliance Frameworks"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:l.map(C=>e.jsx("div",{onClick:()=>F(C.id),className:`p-4 rounded-lg border cursor-pointer transition-all ${i.has(C.id)?"border-primary bg-primary/10":"border-dark-border hover:border-primary/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{checked:i.has(C.id),onChange:()=>F(C.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-white",children:C.name}),e.jsxs(ne,{variant:"status",type:"running",children:["v",C.version]})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:C.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:[C.control_count," controls"]}),e.jsxs("span",{children:[C.automated_percentage.toFixed(0),"% automated"]})]})]})]})},C.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Q,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(Q,{onClick:h,disabled:j||i.size===0,children:j?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4 animate-spin mr-2"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Run Analysis"]})})]})]})]})})},zt={router:st,switch:et,firewall:At,server:ce,database:Rt,cloud:La,workstation:dt,laptop:dt,mobile:Ra,iot:Ks,printer:Da,camera:Ea,wireless_ap:os,load_balancer:St,storage:Aa,container:Ta,virtual_machine:Ks,internet:De,vpn:Re,unknown:ce},al={external:{bg:"bg-red-500/10",border:"border-red-500",text:"text-red-400"},dmz:{bg:"bg-yellow-500/10",border:"border-yellow-500",text:"text-yellow-400"},internal:{bg:"bg-blue-500/10",border:"border-blue-500",text:"text-blue-400"},restricted:{bg:"bg-purple-500/10",border:"border-purple-500",text:"text-purple-400"},management:{bg:"bg-green-500/10",border:"border-green-500",text:"text-green-400"}},rl={compliant:"ring-green-500",non_compliant:"ring-red-500",partial:"ring-yellow-500",not_assessed:"ring-gray-500"},ll=({data:s,selected:t})=>{const a=zt[s.deviceType]||ce,l=al[s.securityZone],n=rl[s.complianceStatus],i=()=>{switch(s.complianceStatus){case"compliant":return e.jsx(X,{className:"w-3 h-3 text-green-400"});case"non_compliant":return e.jsx(je,{className:"w-3 h-3 text-red-400"});case"partial":return e.jsx(U,{className:"w-3 h-3 text-yellow-400"});default:return e.jsx(G,{className:"w-3 h-3 text-gray-400"})}},c=()=>(s.riskScore??0)>=75||(s.criticalVulns??0)>0?"border-red-500":(s.riskScore??0)>=50||(s.highVulns??0)>0?"border-orange-500":(s.riskScore??0)>=25?"border-yellow-500":l.border;return e.jsxs("div",{className:`relative px-4 py-3 rounded-lg border-2 ${l.bg} ${c()} ${t?"ring-2 ring-cyan-400":""} transition-all shadow-lg hover:shadow-xl`,children:[e.jsx(vs,{type:"target",position:Ns.Top,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx(vs,{type:"source",position:Ns.Bottom,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx(vs,{type:"target",position:Ns.Left,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx(vs,{type:"source",position:Ns.Right,className:"!bg-cyan-500 !w-3 !h-3"}),e.jsx("div",{className:`absolute -top-2 -right-2 p-1 rounded-full bg-gray-900 ring-2 ${n}`,children:e.jsx(i,{})}),s.isGateway&&e.jsx("div",{className:"absolute -top-2 -left-2 p-1 rounded-full bg-blue-600 ring-2 ring-blue-400",children:e.jsx(st,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[100px]",children:[e.jsx("div",{className:`p-3 rounded-lg bg-gray-800/80 ${c()} border`,children:e.jsx(a,{className:`w-8 h-8 ${l.text}`})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-white text-sm",children:s.label}),s.ipAddress&&e.jsx("div",{className:"text-xs text-gray-400 font-mono",children:s.ipAddress}),s.hostname&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[120px]",children:s.hostname}),s.os&&e.jsx("div",{className:"text-xs text-gray-600 truncate max-w-[120px]",children:s.os})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[(s.openPorts??0)>0&&e.jsxs("span",{className:"text-cyan-400 bg-cyan-500/20 px-2 py-0.5 rounded",children:[s.openPorts," ports"]}),(s.riskScore??0)>0&&e.jsxs("span",{className:`px-2 py-0.5 rounded ${(s.riskScore??0)>=75?"text-red-400 bg-red-500/20":(s.riskScore??0)>=50?"text-orange-400 bg-orange-500/20":(s.riskScore??0)>=25?"text-yellow-400 bg-yellow-500/20":"text-green-400 bg-green-500/20"}`,children:["Risk: ",Math.round(s.riskScore??0)]})]}),(s.vulnerabilities??0)>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-400 bg-red-500/20 px-2 py-0.5 rounded",children:[e.jsx(U,{className:"w-3 h-3"}),s.vulnerabilities," vulns",(s.criticalVulns??0)>0&&e.jsxs("span",{className:"text-red-300",children:["(",s.criticalVulns," crit)"]})]})]})]})},il={networkDevice:ll},nl=(s,t)=>{if(t)return"router";switch(s){case"server":return"server";case"workstation":return"workstation";case"network":return"switch";case"gateway":return"router";default:return"unknown"}},ft=(s,t)=>t||s.startsWith("10.0.0.")||s.startsWith("192.168.0.")?"dmz":s.startsWith("10.1.")||s.startsWith("192.168.1.")?"internal":s.startsWith("10.2.")||s.startsWith("192.168.2.")?"restricted":s.startsWith("10.255.")||s.startsWith("172.16.")?"management":"internal",yt=(s,t,a)=>t>0?"non_compliant":a>0||s>=50?"partial":s>0?"compliant":"not_assessed",cl=(s,t)=>{const a=new Map,l=new Map;s.forEach(o=>{const j=l.get(o.subnet)||[];j.push(o),l.set(o.subnet,j)});let n=100;const i=150,c=200,d=250;return t.forEach((o,j)=>{const N=l.get(o.subnet)||[];N.sort((y,x)=>y.is_gateway&&!x.is_gateway?-1:!y.is_gateway&&x.is_gateway?1:x.risk_score-y.risk_score),N.forEach((y,x)=>{const g=Math.ceil(Math.sqrt(N.length)),b=Math.floor(x/g),v=x%g;a.set(y.id,{x:i+v*c,y:n+b*150})}),n+=d+Math.ceil(N.length/Math.ceil(Math.sqrt(N.length)))*150}),a},ol=({scanId:s})=>{const[t,a]=r.useState(null),[l,n]=r.useState(!0),[i,c]=r.useState(null),[d,o]=r.useState(null),[j,N]=r.useState(""),[y,x]=r.useState(!1),[g,b]=r.useState(!1),[v,k,$]=ar([]),[w,u,h]=rr([]);r.useEffect(()=>{(async()=>{try{n(!0);const p=localStorage.getItem("token"),f=await fetch(`/api/scans/${s}/topology`,{headers:{Authorization:`Bearer ${p}`}});if(!f.ok)throw new Error("Failed to fetch topology data");const S=await f.json();a(S)}catch(p){c(p instanceof Error?p.message:"Unknown error")}finally{n(!1)}})()},[s]),r.useEffect(()=>{if(!t)return;const R=cl(t.nodes,t.subnets),p=t.nodes.map(S=>{const O=R.get(S.id)||{x:0,y:0};return{id:S.id,type:"networkDevice",position:O,data:{label:S.hostname||S.ip,deviceType:nl(S.node_type,S.is_gateway),securityZone:ft(S.subnet,S.is_gateway),ipAddress:S.ip,hostname:S.hostname||void 0,os:S.os||void 0,complianceStatus:yt(S.risk_score,S.critical_vulns,S.high_vulns),riskScore:S.risk_score,vulnerabilities:S.vuln_count,criticalVulns:S.critical_vulns,highVulns:S.high_vulns,openPorts:S.open_ports_count,isGateway:S.is_gateway,subnet:S.subnet}}}),f=t.edges.map((S,O)=>({id:`edge-${O}`,source:S.source,target:S.target,type:"smoothstep",animated:S.relationship_type==="gateway",style:{stroke:S.relationship_type==="gateway"?"#3b82f6":S.relationship_type==="shared_service"?"#8b5cf6":"#64748b",strokeWidth:S.strength*2},markerEnd:{type:lr.ArrowClosed,color:S.relationship_type==="gateway"?"#3b82f6":S.relationship_type==="shared_service"?"#8b5cf6":"#64748b"},data:{relationshipType:S.relationship_type}}));k(p),u(f)},[t,k,u]);const F=r.useCallback((R,p)=>{o(p)},[]),L=r.useMemo(()=>{if(!t)return null;const R=t.nodes.map(f=>({id:f.id,label:f.hostname||f.ip,device_type:f.node_type,security_zone:ft(f.subnet,f.is_gateway),ip_address:f.ip,hostname:f.hostname||void 0,os:f.os||void 0,compliance_status:yt(f.risk_score,f.critical_vulns,f.high_vulns),vulnerabilities:f.vuln_count,open_ports:[]})),p=t.edges.map(f=>({source:f.source,target:f.target,protocol:void 0,port:void 0,encrypted:void 0}));return{nodes:R,edges:p,metadata:{name:`Scan ${s}`}}},[t,s]),P=r.useCallback(()=>{if(!j||!v.length)return;const R=v.find(p=>{var f,S;return((f=p.data.ipAddress)==null?void 0:f.includes(j))||((S=p.data.hostname)==null?void 0:S.toLowerCase().includes(j.toLowerCase()))||p.data.label.toLowerCase().includes(j.toLowerCase())});R&&o(R)},[j,v]),V=r.useCallback(()=>{console.log("Export PNG not yet implemented")},[]);if(l)return e.jsx(M,{className:"p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"}),e.jsx("span",{className:"ml-4 text-gray-400",children:"Loading network topology..."})]})});if(i)return e.jsx(M,{className:"p-8",children:e.jsxs("div",{className:"text-center text-red-400",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-4"}),e.jsxs("p",{children:["Failed to load topology: ",i]})]})});if(!t||t.nodes.length===0)return e.jsx(M,{className:"p-8",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(et,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No topology data available for this scan."}),e.jsx("p",{className:"text-sm mt-2",children:"Run a scan to discover network hosts and connections."})]})});const C=y?"fixed inset-0 z-50 bg-gray-900":"relative";return e.jsx("div",{className:C,children:e.jsxs("div",{className:`flex gap-4 ${y?"h-full":""}`,children:[e.jsx(M,{className:`${y?"h-full rounded-none":"h-[700px]"} ${g?"flex-1":"w-full"} overflow-hidden transition-all duration-300`,children:e.jsxs(ir,{nodes:v,edges:w,onNodesChange:$,onEdgesChange:h,onNodeClick:F,nodeTypes:il,fitView:!0,fitViewOptions:{padding:.2},minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"smoothstep"},children:[e.jsx(nr,{variant:cr.Dots,gap:20,size:1,color:"#374151"}),e.jsx(or,{showZoom:!0,showFitView:!0,showInteractive:!1,className:"!bg-gray-800 !border-gray-700 !shadow-lg"}),e.jsx(dr,{nodeColor:R=>{const p=R.data;return(p.riskScore??0)>=75?"#ef4444":(p.riskScore??0)>=50?"#f97316":(p.riskScore??0)>=25?"#eab308":"#22c55e"},maskColor:"rgba(0, 0, 0, 0.8)",className:"!bg-gray-800 !border-gray-700"}),e.jsxs(ys,{position:"top-left",className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2 bg-gray-800 rounded-lg shadow-lg p-2 border border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Search IP or hostname...",value:j,onChange:R=>N(R.target.value),onKeyDown:R=>R.key==="Enter"&&P(),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder-gray-400 w-48"}),e.jsx("button",{onClick:P,className:"px-3 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700 transition-colors",children:e.jsx(Ds,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-800 rounded-lg shadow-lg p-2 border border-gray-700",children:[e.jsx("button",{onClick:()=>x(!y),className:"p-2 hover:bg-gray-700 rounded transition-colors",title:y?"Exit Fullscreen":"Fullscreen",children:y?e.jsx(we,{className:"w-5 h-5 text-gray-300"}):e.jsx(Et,{className:"w-5 h-5 text-gray-300"})}),e.jsx("button",{onClick:V,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Export as PNG",children:e.jsx(He,{className:"w-5 h-5 text-gray-300"})}),e.jsx("button",{onClick:()=>b(!g),className:`p-2 rounded transition-colors ${g?"bg-cyan-600 hover:bg-cyan-700":"hover:bg-gray-700"}`,title:"AI Red Team Advisor",children:e.jsx(Fa,{className:`w-5 h-5 ${g?"text-white":"text-gray-300"}`})})]})]}),e.jsx(ys,{position:"top-right",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-700 max-w-xs",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-white",children:"Legend"}),e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-300 mb-1",children:"Risk Level"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),e.jsx("span",{className:"text-gray-400",children:"Low (0-25)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-gray-400",children:"Medium (25-50)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-gray-400",children:"High (50-75)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("span",{className:"text-gray-400",children:"Critical (75+)"})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-700",children:[e.jsx("div",{className:"font-medium text-gray-300 mb-1",children:"Connections"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),e.jsx("span",{className:"text-gray-400",children:"Gateway"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-purple-500"}),e.jsx("span",{className:"text-gray-400",children:"Shared Service"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-gray-500"}),e.jsx("span",{className:"text-gray-400",children:"Same Subnet"})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-700",children:[e.jsx("div",{className:"font-medium text-gray-300 mb-1",children:"Security Zones"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-red-500 bg-red-500/20"}),e.jsx("span",{className:"text-gray-400",children:"External"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-yellow-500 bg-yellow-500/20"}),e.jsx("span",{className:"text-gray-400",children:"DMZ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-blue-500 bg-blue-500/20"}),e.jsx("span",{className:"text-gray-400",children:"Internal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-purple-500 bg-purple-500/20"}),e.jsx("span",{className:"text-gray-400",children:"Restricted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-green-500 bg-green-500/20"}),e.jsx("span",{className:"text-gray-400",children:"Management"})]})]})]})]})]})}),e.jsx(ys,{position:"bottom-right",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-700 max-w-xs",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2 text-white",children:["Subnets (",t.subnets.length,")"]}),e.jsx("div",{className:"space-y-1 text-xs max-h-32 overflow-y-auto",children:t.subnets.map(R=>e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{className:"font-mono",children:R.subnet}),e.jsxs("span",{className:"text-gray-500",children:[R.host_count," ",R.host_count===1?"host":"hosts"]})]},R.subnet))})]})}),d&&e.jsx(ys,{position:"bottom-left",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-700 max-w-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const R=zt[d.data.deviceType];return e.jsx(R,{className:"w-5 h-5 text-cyan-400"})})(),e.jsx("h3",{className:"text-sm font-semibold text-white",children:d.data.label})]}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-500 hover:text-gray-300",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-400",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-300",children:"IP:"})," ",d.data.ipAddress]}),d.data.hostname&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-300",children:"Hostname:"})," ",d.data.hostname]}),d.data.os&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-300",children:"OS:"})," ",d.data.os]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-300",children:"Subnet:"})," ",d.data.subnet]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-300",children:"Open Ports:"})," ",d.data.openPorts]}),(d.data.vulnerabilities??0)>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-gray-300",children:"Vulnerabilities:"})," ",d.data.vulnerabilities]}),(d.data.criticalVulns??0)>0&&e.jsxs("div",{className:"text-red-400",children:["Critical: ",d.data.criticalVulns]}),(d.data.highVulns??0)>0&&e.jsxs("div",{className:"text-orange-400",children:["High: ",d.data.highVulns]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("strong",{className:"text-gray-300",children:"Risk Score:"})," ",e.jsx("span",{className:(d.data.riskScore??0)>=75?"text-red-400":(d.data.riskScore??0)>=50?"text-orange-400":(d.data.riskScore??0)>=25?"text-yellow-400":"text-green-400",children:(d.data.riskScore??0).toFixed(1)})]})]}),d.data.isGateway&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-700",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-blue-900 text-blue-200 rounded text-xs font-medium",children:[e.jsx(st,{className:"w-3 h-3 mr-1"}),"Gateway"]})})]})]})})]})}),g&&L&&e.jsx("div",{className:`${y?"h-full":"h-[700px]"} w-[500px] flex-shrink-0`,children:e.jsx(xr,{topology:L,scanId:s,onClose:()=>b(!1)})})]})})},dl=({scanId:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(null),[i,c]=r.useState(!0),[d,o]=r.useState(""),[j,N]=r.useState(""),[y,x]=r.useState(""),[g,b]=r.useState(new Set),[v,k]=r.useState(null),[$,w]=r.useState(!1),u=r.useCallback(async()=>{try{c(!0);let E=(await es.getByScan(s)).data;d&&(E=E.filter(W=>W.status===d)),j&&(E=E.filter(W=>W.severity===j)),y&&(E=E.filter(W=>W.secret_type===y)),a(E)}catch(_){console.error("Failed to load secret findings:",_),A.error("Failed to load secret findings")}finally{c(!1)}},[s,d,j,y]),h=r.useCallback(async()=>{try{const _=await es.getStats(s);n(_.data)}catch(_){console.error("Failed to load secret finding stats:",_)}},[s]);r.useEffect(()=>{u(),h()},[u,h]);const F=(_,E)=>{const W=new Set(g);E?W.add(_):W.delete(_),b(W)},L=async(_,E)=>{try{w(!0),await es.update(_,{status:E}),A.success(`Status updated to ${E}`),u(),h()}catch(W){console.error("Failed to update status:",W),A.error("Failed to update status")}finally{w(!1)}},P=async _=>{if(g.size!==0)try{w(!0);const E=await es.bulkUpdateStatus(Array.from(g),_);A.success(E.data.message),b(new Set),u(),h()}catch(E){console.error("Failed to bulk update status:",E),A.error("Failed to update findings")}finally{w(!1)}},V=async(_,E)=>{try{w(!0),await es.update(_,{false_positive:E,status:E?"false_positive":"open"}),A.success(E?"Marked as false positive":"Unmarked false positive"),u(),h()}catch(W){console.error("Failed to update false positive status:",W),A.error("Failed to update")}finally{w(!1)}},C=_=>{const E="px-2 py-1 text-xs font-semibold rounded-full";switch(_.toLowerCase()){case"critical":return`${E} bg-red-500/20 text-red-400`;case"high":return`${E} bg-orange-500/20 text-orange-400`;case"medium":return`${E} bg-yellow-500/20 text-yellow-400`;case"low":return`${E} bg-blue-500/20 text-blue-400`;default:return`${E} bg-gray-500/20 text-gray-400`}},R=_=>{const E="px-2 py-1 text-xs font-semibold rounded-full";switch(_){case"open":return`${E} bg-red-500/20 text-red-400`;case"investigating":return`${E} bg-yellow-500/20 text-yellow-400`;case"resolved":return`${E} bg-green-500/20 text-green-400`;case"false_positive":return`${E} bg-gray-500/20 text-gray-400`;default:return`${E} bg-gray-500/20 text-gray-400`}},p=_=>{const E=_.toLowerCase();return E.includes("key")||E.includes("api")?e.jsx(Ge,{className:"h-4 w-4"}):E.includes("password")||E.includes("secret")?e.jsx(Re,{className:"h-4 w-4"}):E.includes("token")?e.jsx(G,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"})},f=_=>_.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),S=_=>{const E=Math.round(_*100);return E>=90?e.jsxs("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded",children:[E,"% confident"]}):E>=70?e.jsxs("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-0.5 rounded",children:[E,"% confident"]}):e.jsxs("span",{className:"text-xs text-gray-400 bg-gray-500/10 px-2 py-0.5 rounded",children:[E,"% confident"]})},O=[...new Set(t.map(_=>_.secret_type))];return i?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"})}):t.length===0&&!(l!=null&&l.total_findings)?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No exposed secrets detected in this scan."})]}):e.jsxs("div",{className:"space-y-4",children:[l&&l.total_findings>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Total Secrets"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.total_findings})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Critical"}),e.jsx("div",{className:"text-2xl font-bold text-red-500",children:l.critical_count})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"High"}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:l.high_count})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Open"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:l.open_count})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Resolved"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:l.resolved_count})]})]}),l&&l.by_type.length>0&&e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Secrets by Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.by_type.map(_=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700/50 px-3 py-1.5 rounded-full text-sm",children:[p(_.secret_type),e.jsx("span",{className:"text-gray-300",children:f(_.secret_type)}),e.jsx("span",{className:"bg-gray-600 px-2 py-0.5 rounded-full text-xs text-white",children:_.count})]},_.secret_type))})]}),e.jsx("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Status"}),e.jsxs("select",{value:d,onChange:_=>o(_.target.value),className:"block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Severity"}),e.jsxs("select",{value:j,onChange:_=>N(_.target.value),className:"block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Type"}),e.jsxs("select",{value:y,onChange:_=>x(_.target.value),className:"block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-cyan-500 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"All Types"}),O.map(_=>e.jsx("option",{value:_,children:f(_)},_))]})]}),g.size>0&&e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[g.size," selected"]}),e.jsx("button",{onClick:()=>P("resolved"),disabled:$,className:"px-3 py-1.5 text-sm bg-green-600 hover:bg-green-500 text-white rounded-md disabled:opacity-50",children:"Mark Resolved"}),e.jsx("button",{onClick:()=>P("false_positive"),disabled:$,className:"px-3 py-1.5 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded-md disabled:opacity-50",children:"False Positive"})]})]})}),e.jsx("div",{className:"space-y-2",children:t.map(_=>e.jsxs("div",{className:`bg-gray-800 border rounded-lg overflow-hidden transition-all ${_.false_positive?"border-gray-600 opacity-60":_.status==="resolved"?"border-green-700":"border-gray-700"}`,children:[e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsx("input",{type:"checkbox",checked:g.has(_.id),onChange:E=>F(_.id,E.target.checked),className:"rounded border-gray-600 bg-gray-700 text-cyan-500 focus:ring-cyan-500"}),e.jsx("div",{className:"flex items-center gap-2 text-gray-400",children:p(_.secret_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white",children:f(_.secret_type)}),e.jsx("span",{className:C(_.severity),children:_.severity.toUpperCase()}),e.jsx("span",{className:R(_.status),children:_.status.replace("_"," ").toUpperCase()}),S(_.confidence)]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("span",{className:"font-mono",children:_.host_ip}),_.port&&e.jsxs("span",{children:[":",_.port]}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsxs("span",{children:[_.source_type,": ",_.source_location]}),_.line_number&&e.jsxs("span",{className:"text-gray-500",children:[" (line ",_.line_number,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!_.false_positive&&_.status!=="resolved"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(_.id,"resolved"),disabled:$,className:"p-1.5 text-green-400 hover:bg-green-500/20 rounded transition-colors",title:"Mark Resolved",children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>V(_.id,!0),disabled:$,className:"p-1.5 text-gray-400 hover:bg-gray-500/20 rounded transition-colors",title:"Mark False Positive",children:e.jsx(we,{className:"h-4 w-4"})})]}),_.false_positive&&e.jsx("button",{onClick:()=>V(_.id,!1),disabled:$,className:"p-1.5 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Unmark False Positive",children:e.jsx(Pa,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>k(v===_.id?null:_.id),className:"p-1.5 text-gray-400 hover:bg-gray-500/20 rounded transition-colors",children:v===_.id?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(ke,{className:"h-4 w-4"})})]})]}),v===_.id&&e.jsxs("div",{className:"border-t border-gray-700 p-4 bg-gray-850",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Redacted Value"}),e.jsx("div",{className:"bg-gray-900 p-3 rounded font-mono text-sm text-cyan-400 break-all",children:_.redacted_value})]}),_.context&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Context"}),e.jsx("div",{className:"bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 whitespace-pre-wrap break-all max-h-32 overflow-y-auto",children:_.context})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Source Type:"}),e.jsx("span",{className:"ml-2 text-gray-300",children:_.source_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Location:"}),e.jsx("span",{className:"ml-2 text-gray-300 font-mono",children:_.source_location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Detected:"}),e.jsx("span",{className:"ml-2 text-gray-300",children:new Date(_.created_at).toLocaleString()})]}),_.resolved_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Resolved:"}),e.jsx("span",{className:"ml-2 text-gray-300",children:new Date(_.resolved_at).toLocaleString()})]})]}),_.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Ma,{className:"h-4 w-4"}),"Notes"]}),e.jsx("div",{className:"bg-gray-900 p-3 rounded text-sm text-gray-300",children:_.notes})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded",children:[e.jsxs("h4",{className:"text-sm font-medium text-yellow-400 mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Remediation Guidance"]}),e.jsxs("ul",{className:"text-sm text-gray-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Immediately rotate or revoke the exposed credential"}),e.jsx("li",{children:"Check audit logs for any unauthorized access using this credential"}),e.jsx("li",{children:"Review how the secret was exposed and fix the root cause"}),e.jsx("li",{children:"Implement secrets management best practices (e.g., HashiCorp Vault, AWS Secrets Manager)"}),e.jsx("li",{children:"Add pre-commit hooks to prevent secrets from being committed"})]})]})]})]},_.id))}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No findings match your current filters."})]})},xl=({score:s,category:t,confidence:a,priority:l,estimatedHours:n,compact:i=!1})=>{const c=j=>{switch(j.toLowerCase()){case"critical":return"text-red-400 bg-red-500/20 border-red-500/50";case"high":return"text-orange-400 bg-orange-500/20 border-orange-500/50";case"medium":return"text-yellow-400 bg-yellow-500/20 border-yellow-500/50";case"low":return"text-green-400 bg-green-500/20 border-green-500/50";default:return"text-gray-400 bg-gray-500/20 border-gray-500/50"}},d=j=>j>=80?"text-red-400":j>=60?"text-orange-400":j>=40?"text-yellow-400":"text-green-400",o=j=>j/100*180-90;return i?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`text-2xl font-bold ${d(s)}`,children:s.toFixed(0)}),e.jsx("div",{className:`px-2 py-1 rounded-md text-xs font-medium border ${c(t)}`,children:t.toUpperCase()}),e.jsxs("div",{className:"text-gray-500 text-sm",children:["#",l]})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("div",{className:"relative w-32 h-16 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-end justify-center",children:e.jsx("div",{className:"w-32 h-16 border-t-8 border-l-8 border-r-8 border-gray-700 rounded-t-full"})}),e.jsx("div",{className:"absolute inset-0 flex items-end justify-center origin-bottom",style:{transform:`rotate(${o(s)}deg)`},children:e.jsx("div",{className:`w-1 h-14 ${d(s)} bg-current rounded-t-full`})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 text-center",children:e.jsx("span",{className:`text-2xl font-bold ${d(s)}`,children:s.toFixed(0)})})]})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${c(t)}`,children:[t.toUpperCase()," RISK"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded p-2",children:[e.jsx(Ke,{className:"w-4 h-4 mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Priority"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:["#",l]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded p-2",children:[e.jsx(G,{className:"w-4 h-4 mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Confidence"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[a.toFixed(0),"%"]})]}),n!==void 0&&e.jsxs("div",{className:"bg-gray-900/50 rounded p-2",children:[e.jsx(be,{className:"w-4 h-4 mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Effort"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[n,"h"]})]})]})]})},ml=({scores:s,onSelectVulnerability:t,selectedId:a})=>{const[l,n]=r.useState(null),[i,c]=r.useState("all"),d=x=>{switch(x.toLowerCase()){case"critical":return"border-red-500 bg-red-500/10";case"high":return"border-orange-500 bg-orange-500/10";case"medium":return"border-yellow-500 bg-yellow-500/10";case"low":return"border-green-500 bg-green-500/10";default:return"border-gray-500 bg-gray-500/10"}},o=x=>{switch(x.toLowerCase()){case"critical":return"bg-red-500/20 text-red-400 border-red-500/50";case"high":return"bg-orange-500/20 text-orange-400 border-orange-500/50";case"medium":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/50";case"low":return"bg-green-500/20 text-green-400 border-green-500/50";default:return"bg-gray-500/20 text-gray-400 border-gray-500/50"}},j=i==="all"?s:s.filter(x=>x.risk_category.toLowerCase()===i),N=["all","critical","high","medium","low"],y={all:s.length,critical:s.filter(x=>x.risk_category.toLowerCase()==="critical").length,high:s.filter(x=>x.risk_category.toLowerCase()==="high").length,medium:s.filter(x=>x.risk_category.toLowerCase()==="medium").length,low:s.filter(x=>x.risk_category.toLowerCase()==="low").length};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:N.map(x=>e.jsxs("button",{onClick:()=>c(x),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${i===x?x==="all"?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50":o(x):"bg-gray-800 text-gray-400 border border-gray-700 hover:border-gray-600"}`,children:[x.charAt(0).toUpperCase()+x.slice(1),e.jsxs("span",{className:"ml-1.5 text-xs opacity-75",children:["(",y[x],")"]})]},x))}),e.jsx("div",{className:"space-y-2",children:j.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No vulnerabilities in this category"}):j.map(x=>e.jsxs("div",{className:`border-l-4 rounded-lg transition-all ${d(x.risk_category)} ${a===x.vulnerability_id?"ring-2 ring-cyan-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-800/50",onClick:()=>{t&&t(x.vulnerability_id),n(l===x.vulnerability_id?null:x.vulnerability_id)},children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gray-800 text-white font-bold text-sm",children:["#",x.remediation_priority]}),e.jsx(xl,{score:x.effective_risk_score,category:x.risk_category,confidence:x.confidence,priority:x.remediation_priority,compact:!0})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),x.estimated_effort.estimated_hours,"h"]}),e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(Es,{className:"w-4 h-4 mr-1"}),x.confidence.toFixed(0),"%"]}),l===x.vulnerability_id?e.jsx(Le,{className:"w-5 h-5 text-gray-400"}):e.jsx(ke,{className:"w-5 h-5 text-gray-400"})]})]}),l===x.vulnerability_id&&e.jsx("div",{className:"px-4 pb-4 border-t border-gray-700/50",children:e.jsxs("div",{className:"pt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Contributing Factors"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:x.factor_scores.slice(0,4).map((g,b)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 rounded p-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:g.factor_name}),e.jsx("span",{className:"text-xs font-medium text-white",children:g.normalized_value.toFixed(0)})]},b))})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${x.estimated_effort.effort_level==="low"?"bg-green-500/20 text-green-400":x.estimated_effort.effort_level==="medium"?"bg-yellow-500/20 text-yellow-400":x.estimated_effort.effort_level==="high"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:[x.estimated_effort.effort_level.replace("_"," ").toUpperCase()," EFFORT"]}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${x.estimated_effort.impact_level==="low"?"bg-green-500/20 text-green-400":x.estimated_effort.impact_level==="medium"?"bg-yellow-500/20 text-yellow-400":x.estimated_effort.impact_level==="high"?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:[x.estimated_effort.impact_level.toUpperCase()," IMPACT"]}),x.estimated_effort.requires_downtime&&e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-red-500/20 text-red-400",children:"DOWNTIME REQUIRED"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Calculated: ",new Date(x.calculated_at).toLocaleString()]})]})})]},x.vulnerability_id))})]})},hl=({score:s})=>{const t=s.factor_scores.map(n=>({name:n.factor_name.replace(" ",`
`),value:n.normalized_value,contribution:n.contribution,weight:n.weight})),a=n=>n>=80?"#ef4444":n>=60?"#f97316":n>=40?"#eab308":"#22c55e",l=({active:n,payload:i})=>{if(n&&i&&i.length){const c=i[0].payload;return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-medium text-white",children:c.name.replace(`
`," ")}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Score: ",e.jsx("span",{className:"text-white",children:c.value.toFixed(1)})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Weight: ",e.jsxs("span",{className:"text-white",children:[(c.weight*100).toFixed(0),"%"]})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Contribution: ",e.jsx("span",{className:"text-cyan-400",children:c.contribution.toFixed(1)})]})]})}return null};return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Score Breakdown"}),e.jsx("div",{className:"h-64 mb-4",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ms,{data:t,layout:"vertical",margin:{top:5,right:20,left:100,bottom:5},children:[e.jsx(pe,{type:"number",domain:[0,100],tick:{fill:"#9ca3af",fontSize:12},axisLine:{stroke:"#4b5563"},tickLine:{stroke:"#4b5563"}}),e.jsx(de,{type:"category",dataKey:"name",tick:{fill:"#9ca3af",fontSize:11},axisLine:{stroke:"#4b5563"},tickLine:{stroke:"#4b5563"},width:95}),e.jsx(te,{content:e.jsx(l,{})}),e.jsx(zs,{dataKey:"value",radius:[0,4,4,0],children:t.map((n,i)=>e.jsx(ds,{fill:a(n.value)},`cell-${i}`))})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left py-2 text-gray-400 font-medium",children:"Factor"}),e.jsx("th",{className:"text-right py-2 text-gray-400 font-medium",children:"Score"}),e.jsx("th",{className:"text-right py-2 text-gray-400 font-medium",children:"Weight"}),e.jsx("th",{className:"text-right py-2 text-gray-400 font-medium",children:"Contribution"})]})}),e.jsxs("tbody",{children:[s.factor_scores.map((n,i)=>e.jsxs("tr",{className:"border-b border-gray-700/50",children:[e.jsx("td",{className:"py-2 text-white",children:n.factor_name}),e.jsx("td",{className:"py-2 text-right text-gray-300",children:n.normalized_value.toFixed(1)}),e.jsxs("td",{className:"py-2 text-right text-gray-400",children:[(n.weight*100).toFixed(0),"%"]}),e.jsx("td",{className:"py-2 text-right text-cyan-400 font-medium",children:n.contribution.toFixed(1)})]},i)),e.jsxs("tr",{className:"font-medium",children:[e.jsx("td",{className:"py-2 text-white",children:"Total"}),e.jsx("td",{className:"py-2 text-right text-white",children:s.effective_risk_score.toFixed(1)}),e.jsx("td",{className:"py-2 text-right text-gray-400",children:"100%"}),e.jsx("td",{className:"py-2 text-right text-cyan-400",children:s.factor_scores.reduce((n,i)=>n+i.contribution,0).toFixed(1)})]})]})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-900/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Remediation Effort"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Estimated Hours:"}),e.jsxs("span",{className:"ml-2 text-white font-medium",children:[s.estimated_effort.estimated_hours,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Effort Level:"}),e.jsx("span",{className:"ml-2 text-white font-medium capitalize",children:s.estimated_effort.effort_level.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Impact Level:"}),e.jsx("span",{className:"ml-2 text-white font-medium capitalize",children:s.estimated_effort.impact_level})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[s.estimated_effort.requires_downtime&&e.jsx("span",{className:"text-red-400 text-xs",children:"Requires Downtime"}),s.estimated_effort.requires_testing&&e.jsx("span",{className:"text-yellow-400 text-xs",children:"Requires Testing"})]})]})]})]})},ul=({onConfigUpdate:s})=>{const[t,a]=r.useState(null),[l,n]=r.useState(!0),[i,c]=r.useState(!1),[d,o]=r.useState({cvss_weight:.25,exploit_weight:.2,asset_criticality_weight:.15,network_exposure_weight:.15,attack_path_weight:.1,compliance_weight:.08,business_context_weight:.07}),j={cvss_weight:.25,exploit_weight:.2,asset_criticality_weight:.15,network_exposure_weight:.15,attack_path_weight:.1,compliance_weight:.08,business_context_weight:.07};r.useEffect(()=>{N()},[]);const N=async()=>{try{n(!0);const $=await As.getConfig();a($.data),o($.data.weights)}catch($){console.error("Failed to load AI config:",$),A.error("Failed to load AI configuration")}finally{n(!1)}},y=($,w)=>{o(u=>({...u,[$]:w}))},x=async()=>{try{c(!0),await As.updateConfig({weights:d}),A.success("AI configuration updated"),s&&s()}catch($){console.error("Failed to save AI config:",$),A.error("Failed to save configuration")}finally{c(!1)}},g=()=>{o(j),A.info("Weights reset to defaults")},b=()=>Object.values(d).reduce(($,w)=>$+w,0),v={cvss_weight:"CVSS Score",exploit_weight:"Exploit Availability",asset_criticality_weight:"Asset Criticality",network_exposure_weight:"Network Exposure",attack_path_weight:"Attack Path Risk",compliance_weight:"Compliance Impact",business_context_weight:"Business Context"},k={cvss_weight:"Base vulnerability severity from CVE database",exploit_weight:"Whether exploits exist in the wild",asset_criticality_weight:"Importance of the affected asset",network_exposure_weight:"Internet-facing vs internal exposure",attack_path_weight:"Position in potential attack chains",compliance_weight:"Impact on regulatory compliance",business_context_weight:"Overall business risk context"};return l?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"})}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(za,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"AI Scoring Configuration"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(Q,{variant:"secondary",size:"sm",onClick:g,children:[e.jsx(Ha,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsxs(Q,{variant:"primary",size:"sm",onClick:x,loading:i,children:[e.jsx(Js,{className:"w-4 h-4 mr-1"}),"Save"]})]})]}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Weight"}),e.jsxs("span",{className:`text-lg font-bold ${Math.abs(b()-1)<.01?"text-green-400":"text-yellow-400"}`,children:[(b()*100).toFixed(0),"%"]})]}),Math.abs(b()-1)>=.01&&e.jsx("p",{className:"text-xs text-yellow-400 mt-1",children:"Weights should sum to 100% for optimal scoring"})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(d).map($=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white",children:v[$]}),e.jsx("p",{className:"text-xs text-gray-400",children:k[$]})]}),e.jsxs("span",{className:"text-sm font-mono text-cyan-400",children:[(d[$]*100).toFixed(0),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:d[$]*100,onChange:w=>y($,parseInt(w.target.value)/100),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer
                         [&::-webkit-slider-thumb]:appearance-none
                         [&::-webkit-slider-thumb]:w-4
                         [&::-webkit-slider-thumb]:h-4
                         [&::-webkit-slider-thumb]:rounded-full
                         [&::-webkit-slider-thumb]:bg-cyan-500
                         [&::-webkit-slider-thumb]:cursor-pointer
                         [&::-webkit-slider-thumb]:transition-transform
                         [&::-webkit-slider-thumb]:hover:scale-110`})]},$))}),t&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Configuration Name:"}),e.jsx("span",{className:"ml-2 text-white",children:t.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Last Updated:"}),e.jsx("span",{className:"ml-2 text-white",children:new Date(t.updated_at).toLocaleString()})]})]})})]})},pl=({scanId:s,onSelectVulnerability:t})=>{const[a,l]=r.useState(null),[n,i]=r.useState(!1),[c,d]=r.useState(!1),[o,j]=r.useState(null),[N,y]=r.useState(!1),[x,g]=r.useState("list"),b=r.useCallback(async()=>{var u;try{i(!0);const h=await As.getScores(s);l(h.data)}catch(h){((u=h.response)==null?void 0:u.status)!==404&&console.error("Failed to load AI scores:",h)}finally{i(!1)}},[s]);r.useEffect(()=>{b()},[b]);const v=async(u=!1)=>{try{d(!0);const h=await As.prioritize(s,{force_recalculate:u});l(h.data),A.success("AI prioritization calculated successfully")}catch(h){console.error("Failed to calculate prioritization:",h),A.error("Failed to calculate AI prioritization")}finally{d(!1)}},k=u=>{const h=a==null?void 0:a.scores.find(F=>F.vulnerability_id===u);j(h||null),t&&t(u)},$=u=>[{name:"Critical",value:u.critical_count,color:"#ef4444"},{name:"High",value:u.high_count,color:"#f97316"},{name:"Medium",value:u.medium_count,color:"#eab308"},{name:"Low",value:u.low_count,color:"#22c55e"}].filter(h=>h.value>0),w=u=>{var F;return u.length===0?[]:(((F=u[0])==null?void 0:F.factor_scores.map(L=>L.factor_name))||[]).map(L=>{const P=u.reduce((V,C)=>{const R=C.factor_scores.find(p=>p.factor_name===L);return V+((R==null?void 0:R.normalized_value)||0)},0)/u.length;return{factor:L.replace(" ",`
`),value:P,fullMark:100}})};return n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Fs,{className:"w-6 h-6 text-cyan-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"AI Vulnerability Prioritization"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a&&e.jsxs(Q,{variant:"secondary",size:"sm",onClick:()=>v(!0),loading:c,children:[e.jsx(as,{className:"w-4 h-4 mr-1"}),"Recalculate"]}),e.jsxs(Q,{variant:N?"primary":"secondary",size:"sm",onClick:()=>y(!N),children:[e.jsx(Ys,{className:"w-4 h-4 mr-1"}),"Configure"]})]})]}),N&&e.jsx(ul,{onConfigUpdate:()=>v(!0)}),!a&&!n&&e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-8 text-center",children:[e.jsx(Fs,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No AI Prioritization Data"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Calculate AI-based risk scores to prioritize vulnerabilities for remediation."}),e.jsxs(Q,{variant:"primary",onClick:()=>v(!1),loading:c,children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),"Calculate AI Prioritization"]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(U,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Critical"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:a.summary.critical_count})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Avg Risk Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.summary.average_risk_score.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Es,{className:"w-5 h-5 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Highest Score"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:a.summary.highest_risk_score.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ls,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Total Analyzed"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.summary.total_vulnerabilities})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Risk Distribution"}),e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(tt,{children:[e.jsx(at,{data:$(a.summary),cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,paddingAngle:2,dataKey:"value",children:$(a.summary).map((u,h)=>e.jsx(ds,{fill:u.color},`cell-${h}`))}),e.jsx(te,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px"},itemStyle:{color:"#fff"}})]})})}),e.jsx("div",{className:"flex justify-center space-x-4 mt-2",children:$(a.summary).map(u=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:u.color}}),e.jsxs("span",{className:"text-xs text-gray-400",children:[u.name," (",u.value,")"]})]},u.name))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Average Factor Scores"}),e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(mr,{data:w(a.scores),children:[e.jsx(hr,{stroke:"#374151"}),e.jsx(ur,{dataKey:"factor",tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(pr,{angle:30,domain:[0,100],tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(gr,{name:"Score",dataKey:"value",stroke:"#06b6d4",fill:"#06b6d4",fillOpacity:.3}),e.jsx(te,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px"},itemStyle:{color:"#fff"}})]})})})]})]}),e.jsxs("div",{className:"flex space-x-2 border-b border-gray-700",children:[e.jsx("button",{onClick:()=>g("list"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="list"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:"Prioritized List"}),e.jsx("button",{onClick:()=>g("matrix"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="matrix"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:"Impact vs Likelihood"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[x==="list"&&e.jsx(ml,{scores:a.scores,onSelectVulnerability:k,selectedId:o==null?void 0:o.vulnerability_id}),x==="matrix"&&e.jsx(gl,{scores:a.scores})]}),e.jsx("div",{className:"lg:col-span-1",children:o?e.jsx(hl,{score:o}):e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6 text-center",children:[e.jsx(qe,{className:"w-8 h-8 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Select a vulnerability to view detailed score breakdown"})]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:["Last calculated: ",new Date(a.calculated_at).toLocaleString()]})]})]})},gl=({scores:s})=>{const t=l=>{const n=l.factor_scores.find(o=>o.factor_name==="CVSS Score"),i=l.factor_scores.find(o=>o.factor_name==="Exploit Availability"),c=(n==null?void 0:n.normalized_value)||50,d=(i==null?void 0:i.normalized_value)||50;return{impact:c,likelihood:d}},a=l=>{switch(l.toLowerCase()){case"critical":return"#ef4444";case"high":return"#f97316";case"medium":return"#eab308";case"low":return"#22c55e";default:return"#6b7280"}};return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"Impact vs Likelihood Matrix"}),e.jsxs("div",{className:"relative w-full h-80 border border-gray-700 rounded-lg bg-gray-900/50",children:[e.jsx("div",{className:"absolute inset-0 grid grid-cols-5 grid-rows-5",children:Array.from({length:25}).map((l,n)=>{const i=Math.floor(n/5),c=n%5;let d="bg-gray-800/20";const o=(c+(4-i))/8;return o>.7?d="bg-red-500/10":o>.5?d="bg-orange-500/10":o>.3?d="bg-yellow-500/10":d="bg-green-500/10",e.jsx("div",{className:`border-r border-b border-gray-700/50 ${d}`},n)})}),e.jsx("div",{className:"absolute -bottom-6 inset-x-0 text-center text-xs text-gray-400",children:"Likelihood (Exploit Availability) "}),e.jsx("div",{className:"absolute -left-6 inset-y-0 flex items-center text-xs text-gray-400",style:{writingMode:"vertical-rl",transform:"rotate(180deg)"},children:"Impact (CVSS Score) "}),s.map(l=>{const{impact:n,likelihood:i}=t(l),c=i/100*100,d=n/100*100;return e.jsx("div",{className:"absolute w-3 h-3 rounded-full transform -translate-x-1/2 translate-y-1/2 cursor-pointer hover:scale-150 transition-transform",style:{left:`${c}%`,bottom:`${d}%`,backgroundColor:a(l.risk_category)},title:`Priority #${l.remediation_priority} - Score: ${l.effective_risk_score.toFixed(1)}`},l.vulnerability_id)})]}),e.jsx("div",{className:"flex justify-center space-x-4 mt-6",children:["critical","high","medium","low"].map(l=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a(l)}}),e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:l})]},l))})]})},bl=()=>{const{activeScan:s,results:t}=ge(),[a,l]=r.useState(!1),[n,i]=r.useState(null),[c,d]=r.useState(""),[o,j]=r.useState("risk"),[N,y]=r.useState("all"),[x,g]=r.useState(!1),[b,v]=r.useState(!1),[k,$]=r.useState(!1),[w,u]=r.useState(0),[h,F]=r.useState("results"),[L,P]=r.useState(!1),[V,C]=r.useState([]),[R,p]=r.useState([]),[f,S]=r.useState(!1),[O,_]=r.useState(!1),E=s?t.get(s.id)||[]:[];r.useEffect(()=>{s&&s.status==="completed"&&E.length===0&&Se(),s&&(W(),fe())},[s]);const W=async()=>{if(s)try{const T=await ue.getTagsForScan(s.id);C(T.data)}catch(T){console.error("Failed to load scan tags:",T)}},fe=async()=>{try{const T=await ue.getAll();p(T.data)}catch(T){console.error("Failed to load all tags:",T)}},D=async T=>{if(s)try{const H=await ue.addTagsToScan(s.id,{tag_ids:[T]});C(H.data),S(!1),A.success("Tag added")}catch{A.error("Failed to add tag")}},I=async T=>{if(s)try{await ue.removeTagFromScan(s.id,T),C(V.filter(H=>H.id!==T)),A.success("Tag removed")}catch{A.error("Failed to remove tag")}},Z=async()=>{if(s){_(!0);try{const T=await ve.duplicate(s.id);A.success(`Scan duplicated as "${T.data.name}"`),ge.getState().setActiveScan(T.data)}catch{A.error("Failed to duplicate scan")}finally{_(!1)}}},Y=R.filter(T=>!V.some(H=>H.id===T.id)),Se=async()=>{if(s){l(!0);try{const T=await ve.getResults(s.id);ge.getState().setResults(s.id,T.data)}catch{A.error("Failed to load scan results")}finally{l(!1)}}},Pe=async()=>{var T,H,K;if(s){P(!0);try{const B=await Xa.exportScan(s.id);B.data.success?A.success(`Exported ${B.data.events_count} events to ${B.data.exported_to} SIEM integration(s)`):A.warning("Export completed with issues. Check SIEM settings."),B.data.errors&&B.data.errors.length>0&&B.data.errors.forEach(oe=>{A.error(`SIEM export error: ${oe}`)})}catch(B){const oe=B;((T=oe.response)==null?void 0:T.status)===404?A.error("No SIEM integrations configured. Go to Settings > SIEM Integration to set up."):A.error(((K=(H=oe.response)==null?void 0:H.data)==null?void 0:K.error)||"Failed to export to SIEM")}finally{P(!1)}}},me=r.useMemo(()=>{let T=[...E];switch(c&&(T=T.filter(H=>{var K;return H.target.ip.includes(c)||((K=H.target.hostname)==null?void 0:K.toLowerCase().includes(c.toLowerCase()))})),N){case"with-vulns":T=T.filter(H=>H.vulnerabilities.length>0);break;case"critical":T=T.filter(H=>H.vulnerabilities.some(K=>K.severity==="Critical"));break;case"high":T=T.filter(H=>H.vulnerabilities.some(K=>K.severity==="Critical"||K.severity==="High"));break}return T.sort((H,K)=>{switch(o){case"risk":return Us(K)-Us(H);case"vulns":return K.vulnerabilities.length-H.vulnerabilities.length;case"ports":return K.ports.filter(B=>B.state==="Open").length-H.ports.filter(B=>B.state==="Open").length;case"ip":default:return H.target.ip.localeCompare(K.target.ip)}}),T},[E,c,o,N]);if(!s)return e.jsx(M,{children:e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Select a scan from the list to view results"})});if(a)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ne,{})})});if(E.length===0)return e.jsx(M,{children:e.jsx("div",{className:"text-center py-12 text-slate-500",children:s.status==="running"?"Scan in progress... Results will appear here as hosts are discovered":s.status==="pending"?"Scan is pending...":s.status==="failed"?`Scan failed: ${s.error_message||"Unknown error"}`:"No results available"})});const q=E.filter(T=>T.is_alive).length,J=E.reduce((T,H)=>T+H.ports.filter(K=>K.state==="Open").length,0),ae=E.reduce((T,H)=>T+H.vulnerabilities.length,0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s==null?void 0:s.name}),e.jsxs("button",{onClick:Z,disabled:O,className:"flex items-center gap-1 px-3 py-1.5 text-sm border border-dark-border rounded hover:border-primary hover:text-primary transition-colors disabled:opacity-50",title:"Duplicate this scan",children:[O?e.jsx(Ne,{className:"h-4 w-4"}):e.jsx(Rs,{className:"h-4 w-4"}),"Duplicate"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsx(ns,{className:"h-4 w-4 text-slate-400"}),V.map(T=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:T.color+"20",color:T.color},children:[T.name,e.jsx("button",{onClick:()=>I(T.id),className:"hover:opacity-70",title:"Remove tag",children:e.jsx(we,{className:"h-3 w-3"})})]},T.id)),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>S(!f),className:"inline-flex items-center gap-1 px-2 py-1 rounded text-sm border border-dashed border-dark-border text-slate-400 hover:border-primary hover:text-primary",children:[e.jsx(We,{className:"h-3 w-3"}),"Add Tag"]}),f&&Y.length>0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-10 bg-dark-surface border border-dark-border rounded-lg shadow-lg min-w-[150px] max-h-[200px] overflow-y-auto",children:Y.map(T=>e.jsxs("button",{onClick:()=>D(T.id),className:"w-full text-left px-3 py-2 hover:bg-dark-hover flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:T.color}}),e.jsx("span",{className:"text-sm text-slate-300",children:T.name})]},T.id))}),f&&Y.length===0&&e.jsx("div",{className:"absolute top-full left-0 mt-1 z-10 bg-dark-surface border border-dark-border rounded-lg shadow-lg p-3",children:e.jsx("span",{className:"text-sm text-slate-500",children:"No more tags available"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx(ce,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:q}),e.jsx("p",{className:"text-sm text-slate-400",children:"Alive Hosts"})]}),e.jsxs("div",{children:[e.jsx(G,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:J}),e.jsx("p",{className:"text-sm text-slate-400",children:"Open Ports"})]}),e.jsxs("div",{children:[e.jsx(U,{className:"h-8 w-8 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:ae}),e.jsx("p",{className:"text-sm text-slate-400",children:"Vulnerabilities"})]})]})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex gap-2 border-b border-dark-border pb-2",children:[e.jsxs("button",{onClick:()=>F("results"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="results"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(Va,{className:"h-4 w-4"}),"Results"]}),e.jsxs("button",{onClick:()=>F("topology"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="topology"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(et,{className:"h-4 w-4"}),"Topology"]}),e.jsxs("button",{onClick:()=>F("secrets"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="secrets"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(Ge,{className:"h-4 w-4"}),"Secrets"]}),e.jsxs("button",{onClick:()=>F("ai-priority"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${h==="ai-priority"?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(Fs,{className:"h-4 w-4"}),"AI Priority"]})]})}),h==="topology"&&s&&e.jsx(ol,{scanId:s.id}),h==="secrets"&&s&&e.jsxs(M,{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-yellow-400"}),"Exposed Secrets"]}),e.jsx(dl,{scanId:s.id})]}),h==="ai-priority"&&s&&e.jsx(M,{children:e.jsx(pl,{scanId:s.id})}),h==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(re,{type:"text",placeholder:"Search by IP or hostname...",value:c,onChange:T=>d(T.target.value),icon:e.jsx(Ds,{className:"h-4 w-4"})})}),e.jsx(Qr,{hosts:me,scanName:s==null?void 0:s.name,scanId:s==null?void 0:s.id,disabled:me.length===0}),e.jsxs("button",{onClick:()=>$(!0),disabled:(s==null?void 0:s.status)!=="completed",className:"px-4 py-2 rounded-lg border border-green-500 text-green-500 hover:bg-green-500/10 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Dt,{className:"h-4 w-4"}),"Compliance"]}),e.jsxs("button",{onClick:Pe,disabled:(s==null?void 0:s.status)!=="completed"||L,className:"px-4 py-2 rounded-lg border border-purple-500 text-purple-500 hover:bg-purple-500/10 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"Export scan results to configured SIEM integrations",children:[L?e.jsx(Ne,{}):e.jsx(Rt,{className:"h-4 w-4"}),L?"Exporting...":"SIEM"]}),e.jsxs("button",{onClick:()=>v(!0),disabled:(s==null?void 0:s.status)!=="completed",className:"px-4 py-2 rounded-lg border border-primary text-primary hover:bg-primary/10 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(xe,{className:"h-4 w-4"}),"Report"]}),e.jsxs("button",{onClick:()=>g(!x),className:`px-4 py-2 rounded-lg border transition-colors flex items-center gap-2 ${x?"bg-primary border-primary text-white":"border-dark-border text-slate-400 hover:border-primary hover:text-white"}`,children:[e.jsx(Oa,{className:"h-4 w-4"}),"Filters"]})]}),x&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t border-dark-border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Sort by"}),e.jsxs("select",{value:o,onChange:T=>j(T.target.value),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"risk",children:"Risk Score (High to Low)"}),e.jsx("option",{value:"vulns",children:"Vulnerability Count"}),e.jsx("option",{value:"ports",children:"Port Count"}),e.jsx("option",{value:"ip",children:"IP Address"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Filter by"}),e.jsxs("select",{value:N,onChange:T=>y(T.target.value),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Hosts"}),e.jsx("option",{value:"with-vulns",children:"With Vulnerabilities"}),e.jsx("option",{value:"high",children:"High/Critical Severity"}),e.jsx("option",{value:"critical",children:"Critical Only"})]})]})]}),e.jsxs("div",{className:"text-sm text-slate-400",children:["Showing ",me.length," of ",E.length," hosts"]})]})}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Discovered Hosts"}),e.jsxs("div",{className:"space-y-3",children:[me.map(T=>{const H=Us(T),K=Dr(H);return e.jsxs("div",{className:`bg-dark-bg border rounded-lg p-4 cursor-pointer hover:border-primary/50 transition-all ${K==="Critical"?"border-severity-critical":K==="High"?"border-severity-high":"border-dark-border"}`,onClick:()=>i(n===T.target.ip?null:T.target.ip),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-mono font-semibold",children:T.target.ip}),T.target.hostname&&e.jsx("p",{className:"text-sm text-slate-400",children:T.target.hostname})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ne,{variant:"severity",type:Lt(K),children:["Risk: ",H]}),e.jsx(ne,{variant:"status",type:T.is_alive?"completed":"failed",children:T.is_alive?"Alive":"Down"}),T.ports.filter(B=>B.state==="Open").length>0&&e.jsxs("span",{className:"text-sm text-slate-400",children:[T.ports.filter(B=>B.state==="Open").length," ports"]}),T.vulnerabilities.length>0&&e.jsxs("span",{className:"text-sm text-red-400",children:[T.vulnerabilities.length," vulns"]})]})]}),n===T.target.ip&&e.jsxs("div",{className:"mt-4 border-t border-dark-border pt-4 space-y-4",children:[T.os_guess&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-1",children:"OS Detection"}),e.jsxs("p",{className:"text-sm text-slate-400",children:[T.os_guess.os_family," ",T.os_guess.os_version," (",T.os_guess.confidence,"% confidence)"]})]}),T.ports.filter(B=>B.state==="Open").length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"Open Ports"}),e.jsx("div",{className:"space-y-2",children:T.ports.filter(B=>B.state==="Open").map(B=>{var oe,Ze;return e.jsx("div",{children:e.jsxs("div",{className:"bg-dark-surface rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-mono font-semibold",children:[B.port,"/",B.protocol]}),B.service&&e.jsxs("span",{className:"text-slate-400",children:[B.service.name," ",B.service.version&&e.jsxs("span",{className:"text-slate-500",children:["v",B.service.version]})]})]}),((oe=B.service)==null?void 0:oe.banner)&&e.jsx(Mr,{banner:B.service.banner,port:B.port,service:B.service.name}),((Ze=B.service)==null?void 0:Ze.ssl_info)&&e.jsx(Jr,{sslInfo:B.service.ssl_info,port:B.port})]})},B.port)})})]}),T.vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-slate-300 mb-3",children:["Vulnerabilities (",T.vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-3",children:T.vulnerabilities.map((B,oe)=>e.jsx(Pr,{vulnerability:B},oe))})]})]})]},T.target.ip)}),me.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400",children:"No hosts match the current filters"})]})]}),(s==null?void 0:s.status)==="completed"&&e.jsx(sl,{scanId:s.id,onGenerateNew:()=>v(!0)},w)]}),b&&s&&e.jsx(el,{scanId:s.id,scanName:s.name,onClose:()=>v(!1),onReportCreated:()=>u(T=>T+1)}),k&&s&&e.jsx(tl,{scanId:s.id,scanName:s.name,onClose:()=>$(!1)})]})},_s=({title:s,value:t,icon:a,color:l,subtitle:n,to:i,onClick:c})=>{const d=i||c,o=e.jsx(M,{variant:d?"interactive":"default",className:"p-6 group",onClick:c,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${l} mb-1`,children:t}),n&&e.jsx("p",{className:"text-slate-500 text-xs",children:n})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`${l.replace("text-","bg-")}/20 p-3 rounded-lg`,children:a}),d&&e.jsx(qe,{className:"h-5 w-5 text-slate-500 group-hover:text-primary transition-colors"})]})]})});return i?e.jsx(pa,{to:i,className:"block",children:o}):o},jl=()=>{const{scans:s,results:t}=ge(),a=r.useMemo(()=>{const l=s.filter(i=>i.status==="completed"),n=Array.from(t.values()).flat();return{...Lr(n),completedScans:l.length}},[s,t]);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(_s,{title:"Completed Scans",value:a.completedScans,icon:e.jsx(le,{className:"h-6 w-6 text-primary"}),color:"text-primary",subtitle:`${s.filter(l=>l.status==="running").length} running`,to:"/dashboard?tab=scans"}),e.jsx(_s,{title:"Hosts Discovered",value:a.totalHosts,icon:e.jsx(ce,{className:"h-6 w-6 text-blue-400"}),color:"text-blue-400",subtitle:`${a.totalPorts} open ports`,to:"/assets"}),e.jsx(_s,{title:"Total Vulnerabilities",value:a.totalVulnerabilities,icon:e.jsx(U,{className:"h-6 w-6 text-yellow-400"}),color:"text-yellow-400",subtitle:"Across all scans",to:"/vulnerabilities"}),e.jsx(_s,{title:"Critical Findings",value:a.criticalVulnerabilities,icon:e.jsx(G,{className:"h-6 w-6 text-severity-critical"}),color:"text-severity-critical",subtitle:"Requires immediate attention",to:"/vulnerabilities?severity=critical"})]})},fl={Critical:"#ef4444",High:"#f97316",Medium:"#eab308",Low:"#3b82f6"},yl=({hosts:s,onSeverityClick:t})=>{const a=kt(),l=r.useMemo(()=>{const c=Mt(s);return Object.entries(c).filter(([d,o])=>o>0).map(([d,o])=>({name:d,value:o,color:fl[d]}))},[s]),n=l.reduce((c,d)=>c+d.value,0),i=c=>{t?t(c.name.toLowerCase()):a(`/vulnerabilities?severity=${c.name.toLowerCase()}`)};return n===0?e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerability Distribution"}),e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No vulnerabilities found"})})]}):e.jsxs(M,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Vulnerability Distribution",e.jsxs("span",{className:"text-sm font-normal text-slate-400 ml-2",children:["(",n," total)"]})]}),e.jsx(se,{width:"100%",height:300,children:e.jsxs(tt,{children:[e.jsx(at,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:({name:c,percent:d})=>`${c}: ${(d*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",onClick:i,style:{cursor:"pointer"},children:l.map((c,d)=>e.jsx(ds,{fill:c.color,style:{cursor:"pointer"},className:"hover:opacity-80 transition-opacity"},`cell-${d}`))}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},formatter:c=>[`${c} vulnerabilities`,"Count"],wrapperStyle:{cursor:"pointer"}}),e.jsx(is,{verticalAlign:"bottom",height:36,formatter:(c,d)=>{var o;return e.jsxs("span",{style:{color:"#cbd5e1"},children:[c,": ",((o=d==null?void 0:d.payload)==null?void 0:o.value)??0]})}})]})})]})},vl={21:"#f97316",22:"#22c55e",23:"#ef4444",25:"#3b82f6",53:"#8b5cf6",80:"#06b6d4",110:"#3b82f6",143:"#3b82f6",443:"#10b981",445:"#f59e0b",3306:"#ec4899",3389:"#ef4444",5432:"#3b82f6",8080:"#06b6d4"},Nl="#64748b",wl=({hosts:s})=>{const t=r.useMemo(()=>Rr(s).map(a=>({...a,displayName:`${a.port} (${a.service})`,color:vl[a.port]||Nl})),[s]);return t.length===0?e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Port Distribution"}),e.jsx("div",{className:"flex items-center justify-center h-64 text-slate-400",children:e.jsx("p",{children:"No open ports found"})})]}):e.jsxs(M,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Top Open Ports",e.jsx("span",{className:"text-sm font-normal text-slate-400 ml-2",children:"(Across all hosts)"})]}),e.jsx(se,{width:"100%",height:300,children:e.jsxs(Ms,{data:t,layout:"vertical",margin:{top:5,right:30,left:100,bottom:5},children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{type:"number",stroke:"#cbd5e1"}),e.jsx(de,{dataKey:"displayName",type:"category",width:90,stroke:"#cbd5e1",tick:{fontSize:12}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},formatter:(a,l,n)=>{var i;return[`${a} hosts`,((i=n==null?void 0:n.payload)==null?void 0:i.service)??""]},labelFormatter:a=>{var l;return`Port ${(l=t.find(n=>n.displayName===a))==null?void 0:l.port}`}}),e.jsx(zs,{dataKey:"count",radius:[0,4,4,0],children:t.map((a,l)=>e.jsx(ds,{fill:a.color},`cell-${l}`))})]})})]})},kl=s=>s.some(t=>t.total>0||t.new>0||t.resolved>0||t.open>0),Sl=s=>s.some(t=>t.critical>0||t.high>0||t.medium>0||t.low>0),_l=s=>s.total_found>0||s.current_open>0||s.total_resolved>0,Ws=({title:s,value:t,subtitle:a,icon:l,color:n,trend:i})=>e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${n} mb-1`,children:t}),a&&e.jsx("p",{className:"text-slate-500 text-xs",children:a}),i&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs ${i.isPositive?"text-green-400":"text-red-400"}`,children:[e.jsx(Ke,{className:`h-3 w-3 ${!i.isPositive&&"rotate-180"}`}),e.jsxs("span",{children:[i.isPositive?"+":"",i.value.toFixed(1),"%"]})]})]}),e.jsx("div",{className:`${n.replace("text-","bg-")}/20 p-3 rounded-lg`,children:l})]})}),Cl=({height:s=300})=>e.jsx("div",{className:"animate-pulse",style:{height:s},children:e.jsx("div",{className:"h-full bg-slate-700/50 rounded-lg"})}),he={critical:"#ef4444",high:"#f97316",medium:"#eab308",low:"#3b82f6"},$l=()=>{const[s,t]=r.useState(30),[a,l]=r.useState(!0),[n,i]=r.useState(null),[c,d]=r.useState(null),o=r.useCallback(async()=>{var u,h;l(!0),i(null);try{const F=await Be.getVulnerabilityTrendsDashboard(s);d(F.data)}catch(F){const L=F;console.error("Failed to load vulnerability trends:",F),i(((h=(u=L.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to load vulnerability trends")}finally{l(!1)}},[s]);r.useEffect(()=>{o()},[o]);const j=u=>{if(u.includes("-W")){const[,F]=u.split("-W");return`W${F}`}return new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric"})},N=u=>{switch(u){case"improving":return e.jsx(Ia,{className:"h-5 w-5 text-green-400"});case"declining":return e.jsx(Ke,{className:"h-5 w-5 text-red-400"});default:return e.jsx(Ba,{className:"h-5 w-5 text-yellow-400"})}},y=u=>{switch(u){case"improving":return"text-green-400";case"declining":return"text-red-400";default:return"text-yellow-400"}},x=u=>{switch(u){case"improving":return"Improving";case"declining":return"Declining";default:return"Stable"}};if(a)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-64 bg-slate-700 rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-4 w-48 bg-slate-700 rounded animate-pulse"})]}),e.jsx("div",{className:"h-10 w-72 bg-slate-700 rounded animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(u=>e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 w-24 bg-slate-700 rounded mb-3"}),e.jsx("div",{className:"h-8 w-16 bg-slate-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-32 bg-slate-700 rounded"})]})},u))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[1,2,3,4].map(u=>e.jsxs(M,{className:"p-6",children:[e.jsx("div",{className:"h-6 w-48 bg-slate-700 rounded animate-pulse mb-4"}),e.jsx(Cl,{})]},u))})]});if(n)return e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"h-12 w-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Failed to Load Vulnerability Trends"}),e.jsx("p",{className:"text-slate-400 mb-4",children:n}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors",children:"Retry"})]})});if(!c)return null;const{summary:g,daily_counts:b,severity_trends:v,remediation_rates:k,top_recurring:$}=c;if(!_l(g))return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Vulnerability Trends"}),e.jsx("p",{className:"text-slate-400",children:"Historical analysis and remediation metrics"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-slate-800 border border-slate-700 rounded-lg p-1",children:[7,30,90,180].map(u=>e.jsxs("button",{onClick:()=>t(u),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${s===u?"bg-cyan-600 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:[e.jsx(ze,{className:"h-4 w-4"}),u,"d"]},u))})]}),e.jsx(M,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ue,{className:"h-16 w-16 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Vulnerability Data Available"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:"Vulnerability trends will appear here once you've completed some security scans. Run scans to discover and track vulnerabilities over time."}),e.jsxs("a",{href:"/dashboard",className:"inline-flex items-center gap-2 px-6 py-3 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors",children:[e.jsx(G,{className:"h-5 w-5"}),"Go to Dashboard"]})]})})]});const w=[{name:"Critical",value:g.critical_open,color:he.critical},{name:"High",value:g.high_open,color:he.high},{name:"Medium",value:g.current_open-g.critical_open-g.high_open,color:he.medium}].filter(u=>u.value>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Vulnerability Trends"}),e.jsx("p",{className:"text-slate-400",children:"Historical analysis and remediation metrics"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-slate-800 border border-slate-700 rounded-lg p-1",children:[7,30,90,180].map(u=>e.jsxs("button",{onClick:()=>t(u),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${s===u?"bg-cyan-600 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:[e.jsx(ze,{className:"h-4 w-4"}),u,"d"]},u))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ws,{title:"Current Open",value:g.current_open,subtitle:`${g.critical_open} critical, ${g.high_open} high`,icon:e.jsx(Ue,{className:"h-6 w-6 text-yellow-400"}),color:"text-yellow-400"}),e.jsx(Ws,{title:"Remediation Rate",value:`${g.remediation_rate.toFixed(1)}%`,subtitle:`${g.total_resolved} of ${g.total_found} resolved`,icon:e.jsx(X,{className:"h-6 w-6 text-green-400"}),color:"text-green-400"}),e.jsx(Ws,{title:"Avg. MTTR",value:`${g.avg_mttr_days.toFixed(1)}`,subtitle:"Days to remediate",icon:e.jsx(be,{className:"h-6 w-6 text-blue-400"}),color:"text-blue-400"}),e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:"Trend"}),e.jsxs("div",{className:"flex items-center gap-2",children:[N(g.trend_direction),e.jsx("span",{className:`text-2xl font-bold ${y(g.trend_direction)}`,children:x(g.trend_direction)})]}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"Compared to previous period"})]}),e.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg",children:e.jsx(G,{className:"h-6 w-6 text-slate-400"})})]})})]}),(g.critical_open>0||g.high_open>0)&&e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Critical Issues Requiring Attention"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Critical"}),e.jsx(je,{className:"h-4 w-4 text-red-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:g.critical_open})]}),e.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"High"}),e.jsx(U,{className:"h-4 w-4 text-orange-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:g.high_open})]}),e.jsxs("div",{className:"bg-slate-700/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Total Found"}),e.jsx(Ue,{className:"h-4 w-4 text-slate-400"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:g.total_found})]}),e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Resolved"}),e.jsx(X,{className:"h-4 w-4 text-green-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:g.total_resolved})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerabilities Over Time"}),kl(b)?e.jsx(se,{width:"100%",height:300,children:e.jsxs(cs,{data:b,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{dataKey:"date",tickFormatter:j,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:j}),e.jsx(is,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(Ae,{type:"monotone",dataKey:"open",stroke:"#f97316",strokeWidth:2,dot:{fill:"#f97316",r:3},activeDot:{r:5},name:"Open"}),e.jsx(Ae,{type:"monotone",dataKey:"new",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:3},activeDot:{r:5},name:"New"}),e.jsx(Ae,{type:"monotone",dataKey:"resolved",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e",r:3},activeDot:{r:5},name:"Resolved"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(Ke,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No vulnerability activity yet"})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Severity Distribution Over Time"}),Sl(v)?e.jsx(se,{width:"100%",height:300,children:e.jsxs(Pt,{data:v,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{dataKey:"date",tickFormatter:j,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:j}),e.jsx(is,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(Ee,{type:"monotone",dataKey:"critical",stackId:"1",stroke:he.critical,fill:he.critical,fillOpacity:.6,name:"Critical"}),e.jsx(Ee,{type:"monotone",dataKey:"high",stackId:"1",stroke:he.high,fill:he.high,fillOpacity:.6,name:"High"}),e.jsx(Ee,{type:"monotone",dataKey:"medium",stackId:"1",stroke:he.medium,fill:he.medium,fillOpacity:.6,name:"Medium"}),e.jsx(Ee,{type:"monotone",dataKey:"low",stackId:"1",stroke:he.low,fill:he.low,fillOpacity:.6,name:"Low"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(U,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No severity data available"})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Remediation Rate Over Time"}),k.length>0?e.jsx(se,{width:"100%",height:300,children:e.jsxs(cs,{data:k,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{dataKey:"date",tickFormatter:j,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{yAxisId:"left",stroke:"#94a3b8",style:{fontSize:"12px"},domain:[0,100],tickFormatter:u=>`${u}%`}),e.jsx(de,{yAxisId:"right",orientation:"right",stroke:"#94a3b8",style:{fontSize:"12px"},tickFormatter:u=>`${u}d`}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:j,formatter:(u,h)=>h==="Remediation Rate"?[`${u.toFixed(1)}%`,h]:h==="MTTR (days)"?[`${u.toFixed(1)} days`,h]:[u,h]}),e.jsx(is,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(Ae,{yAxisId:"left",type:"monotone",dataKey:"remediation_rate",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e",r:3},activeDot:{r:5},name:"Remediation Rate"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"mttr_days",stroke:"#06b6d4",strokeWidth:2,dot:{fill:"#06b6d4",r:3},activeDot:{r:5},name:"MTTR (days)"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(X,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No remediation data yet"})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Top Recurring Vulnerabilities"}),$.length>0?e.jsx(se,{width:"100%",height:300,children:e.jsxs(Ms,{data:$,layout:"vertical",children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{type:"number",stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{dataKey:"title",type:"category",stroke:"#94a3b8",style:{fontSize:"11px"},width:140,tickFormatter:u=>u.length>20?`${u.substring(0,20)}...`:u}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},content:({active:u,payload:h})=>{if(!u||!h||!h[0])return null;const F=h[0].payload;return e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-3 text-white text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:F.title}),e.jsxs("div",{className:"space-y-1 text-slate-300",children:[e.jsxs("div",{children:["Occurrences: ",F.count]}),e.jsxs("div",{children:["Severity: ",F.severity]}),e.jsxs("div",{children:["Affected Hosts: ",F.affected_hosts]}),F.avg_resolution_days!==null&&e.jsxs("div",{children:["Avg Resolution: ",F.avg_resolution_days.toFixed(1)," days"]})]})]})}}),e.jsx(zs,{dataKey:"count",fill:"#06b6d4",radius:[0,4,4,0],name:"Occurrences"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(Ue,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No recurring vulnerabilities found"})]})]})]}),w.length>0&&e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Current Open Vulnerabilities by Severity"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(se,{width:"100%",height:250,children:e.jsxs(tt,{children:[e.jsx(at,{data:w,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",nameKey:"name",label:({name:u,percent:h})=>`${u} ${(h*100).toFixed(0)}%`,labelLine:!1,children:w.map((u,h)=>e.jsx(ds,{fill:u.color},`cell-${h}`))}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"}})]})}),e.jsxs("div",{className:"flex flex-col justify-center space-y-4",children:[w.map(u=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:u.color}}),e.jsx("span",{className:"text-slate-300",children:u.name})]}),e.jsx("span",{className:"text-white font-semibold",children:u.value})]},u.name)),e.jsx("div",{className:"border-t border-slate-700 pt-4 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-300 font-medium",children:"Total Open"}),e.jsx("span",{className:"text-white font-bold text-lg",children:g.current_open})]})})]})]})]}),$.length>0&&e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Recurring Vulnerability Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Vulnerability"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Severity"}),e.jsx("th",{className:"text-center py-3 px-4 text-slate-400 font-medium",children:"Occurrences"}),e.jsx("th",{className:"text-center py-3 px-4 text-slate-400 font-medium",children:"Affected Hosts"}),e.jsx("th",{className:"text-center py-3 px-4 text-slate-400 font-medium",children:"Avg. Resolution"})]})}),e.jsx("tbody",{children:$.map((u,h)=>e.jsxs("tr",{className:"border-b border-slate-700/50 hover:bg-slate-800/50",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("span",{className:"text-white font-medium",children:u.title}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:u.vulnerability_id})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${u.severity==="critical"?"bg-red-500/20 text-red-400":u.severity==="high"?"bg-orange-500/20 text-orange-400":u.severity==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-blue-500/20 text-blue-400"}`,children:u.severity})}),e.jsx("td",{className:"py-3 px-4 text-center text-white",children:u.count}),e.jsx("td",{className:"py-3 px-4 text-center text-white",children:u.affected_hosts}),e.jsx("td",{className:"py-3 px-4 text-center text-white",children:u.avg_resolution_days!==null?`${u.avg_resolution_days.toFixed(1)} days`:"-"})]},h))})]})})]})]})},Cs=({title:s,value:t,subtitle:a,icon:l,color:n,trend:i})=>e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-1",children:s}),e.jsx("p",{className:`text-3xl font-bold ${n} mb-1`,children:t}),a&&e.jsx("p",{className:"text-slate-500 text-xs",children:a}),i&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-xs ${i.isPositive?"text-green-400":"text-red-400"}`,children:[e.jsx(Ke,{className:`h-3 w-3 ${!i.isPositive&&"rotate-180"}`}),e.jsxs("span",{children:[i.isPositive?"+":"",i.value,"%"]})]})]}),e.jsx("div",{className:`${n.replace("text-","bg-")}/20 p-3 rounded-lg`,children:l})]})}),vt=s=>s.some(t=>t.value>0),Fl=s=>s.some(t=>t.critical>0||t.high>0||t.medium>0||t.low>0),Tl=s=>s.total_scans>0||s.total_hosts>0||s.total_vulnerabilities>0,Al=()=>{const[s,t]=r.useState("overview"),[a,l]=r.useState(30),[n,i]=r.useState(!0),[c,d]=r.useState(null),[o,j]=r.useState(null),[N,y]=r.useState([]),[x,g]=r.useState([]),[b,v]=r.useState([]),[k,$]=r.useState([]),w=r.useCallback(async()=>{var F,L;i(!0),d(null);try{const[P,V,C,R,p]=await Promise.all([Be.getSummary(a),Be.getHosts(a),Be.getVulnerabilities(a),Be.getServices(10),Be.getFrequency(a)]);j(P.data),y(V.data),g(C.data),v(R.data),$(p.data)}catch(P){const V=P;console.error("Failed to load analytics:",P),d(((L=(F=V.response)==null?void 0:F.data)==null?void 0:L.message)||"Failed to load analytics data")}finally{i(!1)}},[a]);r.useEffect(()=>{s==="overview"&&w()},[s,w]);const u=F=>new Date(F).toLocaleDateString("en-US",{month:"short",day:"numeric"}),h=()=>e.jsxs("div",{className:"flex gap-2 border-b border-slate-700 pb-2 mb-6",children:[e.jsxs("button",{onClick:()=>t("overview"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${s==="overview"?"bg-slate-800 text-cyan-400 border-b-2 border-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-800/50"}`,children:[e.jsx(Ls,{className:"h-4 w-4"}),"Overview"]}),e.jsxs("button",{onClick:()=>t("vulnerability-trends"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${s==="vulnerability-trends"?"bg-slate-800 text-cyan-400 border-b-2 border-cyan-400":"text-slate-400 hover:text-white hover:bg-slate-800/50"}`,children:[e.jsx(Ue,{className:"h-4 w-4"}),"Vulnerability Trends"]})]});return s==="vulnerability-trends"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx($l,{})]}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Ne,{size:"lg"})})]}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"h-12 w-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Failed to Load Analytics"}),e.jsx("p",{className:"text-slate-400 mb-4",children:c}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors",children:"Retry"})]})})]}):!o||!Tl(o)?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsx(M,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"h-16 w-16 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Scan Data Available"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:"Analytics will appear here once you've completed some security scans. Start by creating a new scan to discover hosts and vulnerabilities."}),e.jsxs("a",{href:"/dashboard",className:"inline-flex items-center gap-2 px-6 py-3 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors",children:[e.jsx(le,{className:"h-5 w-5"}),"Go to Dashboard"]})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-slate-400",children:"Insights and trends from your security scans"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-dark-surface border border-dark-border rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>l(7),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${a===7?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(ze,{className:"h-4 w-4"}),"7 Days"]}),e.jsxs("button",{onClick:()=>l(30),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${a===30?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(ze,{className:"h-4 w-4"}),"30 Days"]}),e.jsxs("button",{onClick:()=>l(90),className:`flex items-center gap-2 px-3 py-2 rounded transition-colors ${a===90?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:[e.jsx(ze,{className:"h-4 w-4"}),"90 Days"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Cs,{title:"Total Scans",value:o.total_scans,subtitle:`${o.scans_this_week} this week`,icon:e.jsx(le,{className:"h-6 w-6 text-primary"}),color:"text-primary"}),e.jsx(Cs,{title:"Hosts Discovered",value:o.total_hosts,subtitle:`${o.total_ports} open ports`,icon:e.jsx(ce,{className:"h-6 w-6 text-blue-400"}),color:"text-blue-400"}),e.jsx(Cs,{title:"Total Vulnerabilities",value:o.total_vulnerabilities,subtitle:`${o.critical_vulns} critical`,icon:e.jsx(U,{className:"h-6 w-6 text-yellow-400"}),color:"text-yellow-400"}),e.jsx(Cs,{title:"Critical Findings",value:o.critical_vulns,subtitle:"Requires immediate attention",icon:e.jsx(G,{className:"h-6 w-6 text-severity-critical"}),color:"text-severity-critical"})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerability Severity Breakdown"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Critical"}),e.jsx(G,{className:"h-4 w-4 text-severity-critical"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-critical",children:o.critical_vulns})]}),e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"High"}),e.jsx(G,{className:"h-4 w-4 text-severity-high"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-high",children:o.high_vulns})]}),e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Medium"}),e.jsx(G,{className:"h-4 w-4 text-severity-medium"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-medium",children:o.medium_vulns})]}),e.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Low"}),e.jsx(G,{className:"h-4 w-4 text-severity-low"})]}),e.jsx("p",{className:"text-2xl font-bold text-severity-low",children:o.low_vulns})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Hosts Discovered Over Time"}),vt(N)?e.jsx(se,{width:"100%",height:300,children:e.jsxs(cs,{data:N,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{dataKey:"date",tickFormatter:u,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:u}),e.jsx(Ae,{type:"monotone",dataKey:"value",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"Hosts"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(ce,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No hosts discovered yet"})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Scan Frequency"}),vt(k)?e.jsx(se,{width:"100%",height:300,children:e.jsxs(cs,{data:k,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{dataKey:"date",tickFormatter:u,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:u}),e.jsx(Ae,{type:"monotone",dataKey:"value",stroke:"#8b5cf6",strokeWidth:2,dot:{fill:"#8b5cf6",r:4},activeDot:{r:6},name:"Scans"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(le,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No scans completed yet"})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Vulnerability Trends by Severity"}),Fl(x)?e.jsx(se,{width:"100%",height:300,children:e.jsxs(Pt,{data:x,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{dataKey:"date",tickFormatter:u,stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"},labelFormatter:u}),e.jsx(is,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{fontSize:"12px",color:"#cbd5e1"}}),e.jsx(Ee,{type:"monotone",dataKey:"critical",stackId:"1",stroke:"#ef4444",fill:"#ef4444",fillOpacity:.6,name:"Critical"}),e.jsx(Ee,{type:"monotone",dataKey:"high",stackId:"1",stroke:"#f97316",fill:"#f97316",fillOpacity:.6,name:"High"}),e.jsx(Ee,{type:"monotone",dataKey:"medium",stackId:"1",stroke:"#eab308",fill:"#eab308",fillOpacity:.6,name:"Medium"}),e.jsx(Ee,{type:"monotone",dataKey:"low",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Low"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(U,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No vulnerabilities found yet"})]})]}),e.jsxs(M,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Top Services Discovered"}),b.length>0?e.jsx(se,{width:"100%",height:300,children:e.jsxs(Ms,{data:b,layout:"vertical",children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(pe,{type:"number",stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(de,{dataKey:"service",type:"category",stroke:"#94a3b8",style:{fontSize:"12px"},width:100}),e.jsx(te,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#fff"}}),e.jsx(zs,{dataKey:"count",fill:"#06b6d4",radius:[0,4,4,0],name:"Count"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(G,{className:"h-10 w-10 mb-2 text-slate-600"}),e.jsx("p",{children:"No services detected yet"})]})]})]})]})};var El=br();const Dl=ga(El),$e=({title:s,icon:t,children:a,onRemove:l,className:n=""})=>e.jsxs("div",{className:`bg-dark-surface border border-dark-border rounded-lg shadow-lg h-full flex flex-col ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ua,{className:"h-4 w-4 text-slate-400 cursor-move drag-handle"}),t&&e.jsx("div",{className:"text-primary",children:t}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:s})]}),l&&e.jsx("button",{onClick:l,className:"p-1 text-slate-400 hover:text-white hover:bg-dark-hover rounded transition-colors",children:e.jsx(we,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 p-4 overflow-auto",children:a})]}),Rl=({onRemove:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const o=await(await fetch("/api/dashboard/data/recent_scans",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(o.scans||[])}catch(d){console.error("Failed to fetch recent scans:",d)}finally{n(!1)}},c=d=>{switch(d){case"completed":return e.jsx(X,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(je,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(ie,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(be,{className:"h-4 w-4 text-yellow-500"})}};return e.jsx($e,{title:"Recent Scans",icon:e.jsx(le,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No recent scans"}):e.jsx("div",{className:"space-y-2",children:t.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[c(d.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:d.name}),e.jsx("div",{className:"text-xs text-slate-400",children:Ps(new Date(d.created_at),{addSuffix:!0})})]})]}),e.jsx("div",{className:"text-xs text-slate-400 capitalize",children:d.status})]},d.id))})})},Ll=({onRemove:s})=>{const[t,a]=r.useState(null),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const d=await(await fetch("/api/dashboard/data/vulnerability_summary",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(d)}catch(c){console.error("Failed to fetch vulnerability summary:",c)}finally{n(!1)}};return e.jsx($e,{title:"Vulnerability Summary",icon:e.jsx(G,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:t.total}),e.jsx("div",{className:"text-sm text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-bg rounded-lg border border-red-900/30",children:[e.jsx("div",{className:"text-3xl font-bold text-red-500",children:t.critical}),e.jsx("div",{className:"text-sm text-slate-400",children:"Critical"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"High"})]}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.high})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Medium"})]}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.medium})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Low"})]}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.low})]})]})]}):e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No vulnerability data"})})},Pl=({onRemove:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const j=await(await fetch("/api/dashboard/data/compliance_scores",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(j.scores||[])}catch(o){console.error("Failed to fetch compliance scores:",o)}finally{n(!1)}},c=o=>o>=90?"text-green-500":o>=70?"text-yellow-500":"text-red-500",d=o=>o>=90?"bg-green-500":o>=70?"bg-yellow-500":"bg-red-500";return e.jsx($e,{title:"Compliance Scores",icon:e.jsx(Wa,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No compliance data"}):e.jsx("div",{className:"space-y-4",children:t.map(o=>{const j=o.score/o.total*100;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:o.framework}),e.jsxs("span",{className:`text-sm font-bold ${c(j)}`,children:[o.score,"/",o.total," (",j.toFixed(0),"%)"]})]}),e.jsx("div",{className:"w-full bg-dark-bg rounded-full h-2",children:e.jsx("div",{className:`${d(j)} h-2 rounded-full transition-all duration-300`,style:{width:`${j}%`}})})]},o.framework)})})})},Ml=({onRemove:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const d=await(await fetch("/api/dashboard/data/scan_activity_chart",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(d.data||[])}catch(c){console.error("Failed to fetch scan activity:",c)}finally{n(!1)}};return e.jsx($e,{title:"Scan Activity (Last 30 Days)",icon:e.jsx(Ls,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No scan activity data"}):e.jsx(se,{width:"100%",height:200,children:e.jsxs(cs,{data:t,children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(pe,{dataKey:"date",stroke:"#9ca3af",tick:{fill:"#9ca3af",fontSize:12},tickFormatter:c=>{const d=new Date(c);return`${d.getMonth()+1}/${d.getDate()}`}}),e.jsx(de,{stroke:"#9ca3af",tick:{fill:"#9ca3af",fontSize:12}}),e.jsx(te,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.5rem",color:"#fff"}}),e.jsx(Ae,{type:"monotone",dataKey:"count",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4}})]})})})},zl=({onRemove:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const o=await(await fetch("/api/dashboard/data/top_risky_hosts",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(o.hosts||[])}catch(d){console.error("Failed to fetch risky hosts:",d)}finally{n(!1)}},c=d=>d>=50?"text-red-500":d>=20?"text-orange-500":"text-yellow-500";return e.jsx($e,{title:"Top Risky Hosts",icon:e.jsx(U,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No risky hosts found"}):e.jsx("div",{className:"space-y-2",children:t.map((d,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`text-xl font-bold ${c(d.risk_score)}`,children:o+1}),e.jsx(ce,{className:"h-4 w-4 text-slate-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:d.hostname||d.ip}),d.hostname&&e.jsx("div",{className:"text-xs text-slate-400",children:d.ip})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"text-sm font-semibold text-white",children:[d.vulnerability_count," vulns"]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[d.critical_count>0&&e.jsxs("span",{className:"text-red-500",children:[d.critical_count,"C"]}),d.high_count>0&&e.jsxs("span",{className:"text-orange-500",children:[d.high_count,"H"]})]})]})]},d.ip))})})},Hl=({onRemove:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const d=await(await fetch("/api/dashboard/data/critical_vulns",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(d.vulnerabilities||[])}catch(c){console.error("Failed to fetch critical vulnerabilities:",c)}finally{n(!1)}};return e.jsx($e,{title:"Critical Vulnerabilities",icon:e.jsx(xt,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No critical vulnerabilities"}):e.jsx("div",{className:"space-y-2",children:t.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-red-900/30 hover:border-red-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(xt,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:c.vulnerability_id}),e.jsxs("div",{className:"text-xs text-slate-400",children:[c.host_ip,"  ",Ps(new Date(c.created_at),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("div",{className:"px-2 py-1 bg-red-900/30 text-red-500 text-xs font-semibold rounded",children:c.severity.toUpperCase()}),e.jsx("div",{className:"text-xs text-slate-400 capitalize",children:c.status.replace("_"," ")})]})]},c.id))})})},Vl=({onRemove:s})=>{const[t,a]=r.useState([]),[l,n]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{try{const d=await(await fetch("/api/dashboard/data/upcoming_scheduled_scans",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();a(d.scans||[])}catch(c){console.error("Failed to fetch upcoming scans:",c)}finally{n(!1)}};return e.jsx($e,{title:"Upcoming Scheduled Scans",icon:e.jsx(ze,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"No upcoming scans"}):e.jsx("div",{className:"space-y-2",children:t.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(be,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:c.name}),e.jsxs("div",{className:"text-xs text-slate-400 capitalize",children:[c.schedule_type," scan"]})]})]}),e.jsx("div",{className:"text-xs text-slate-400",children:Ps(new Date(c.next_run_at),{addSuffix:!0})})]},c.id))})})},Nt={critical:"bg-red-900/30 text-red-500 border-red-500/50",high:"bg-orange-900/30 text-orange-500 border-orange-500/50",medium:"bg-yellow-900/30 text-yellow-500 border-yellow-500/50",low:"bg-blue-900/30 text-blue-500 border-blue-500/50",info:"bg-slate-700/30 text-slate-400 border-slate-500/50"},Ol={exposed_service:e.jsx(De,{className:"h-4 w-4"}),exploit_available:e.jsx(Ue,{className:"h-4 w-4"}),known_exploited_vulnerability:e.jsx(mt,{className:"h-4 w-4"}),critical_cve:e.jsx(U,{className:"h-4 w-4"}),new_cve:e.jsx(U,{className:"h-4 w-4"}),ransomware_threat:e.jsx(mt,{className:"h-4 w-4"}),misconfiguration:e.jsx(G,{className:"h-4 w-4"})},Bl=({onRemove:s,limit:t=5})=>{const{data:a,isLoading:l,error:n}=ma({queryKey:["threatAlerts","widget",t],queryFn:async()=>(await er.getAlerts({limit:t})).data,refetchInterval:6e4}),i=(a==null?void 0:a.alerts)||[],c=(a==null?void 0:a.total)||0,d=i.filter(y=>y.severity==="critical").length,o=i.filter(y=>y.severity==="high").length,j=i.filter(y=>y.in_cisa_kev).length,N=i.filter(y=>y.exploit_available).length;return e.jsx($e,{title:"Threat Intelligence",icon:e.jsx(G,{className:"h-5 w-5"}),onRemove:s,children:l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):n?e.jsx("div",{className:"text-center text-red-400 py-8",children:"Failed to load threat alerts"}):i.length===0?e.jsxs("div",{className:"text-center text-slate-400 py-8",children:[e.jsx(G,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No active threat alerts"}),e.jsx("p",{className:"text-xs mt-1",children:"Run threat intel enrichment on your scans to generate alerts"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:d}),e.jsx("div",{className:"text-xs text-slate-400",children:"Critical"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:o}),e.jsx("div",{className:"text-xs text-slate-400",children:"High"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:j}),e.jsx("div",{className:"text-xs text-slate-400",children:"KEV"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-2 text-center border border-dark-border",children:[e.jsx("div",{className:"text-lg font-bold text-primary",children:N}),e.jsx("div",{className:"text-xs text-slate-400",children:"Exploits"})]})]}),e.jsx("div",{className:"space-y-2",children:i.slice(0,t).map(y=>e.jsx(Il,{alert:y},y.id))}),c>t&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("a",{href:"/threat-intel",className:"text-sm text-primary hover:underline flex items-center justify-center gap-1",children:["View all ",c," alerts",e.jsx(qe,{className:"h-4 w-4"})]})})]})})},Il=({alert:s})=>{const t=Ol[s.alert_type]||e.jsx(U,{className:"h-4 w-4"}),a=Nt[s.severity]||Nt.info;return e.jsxs("div",{className:`flex items-center justify-between p-3 bg-dark-bg rounded-lg border ${s.severity==="critical"?"border-red-900/50":s.severity==="high"?"border-orange-900/50":"border-dark-border"} hover:border-primary/50 transition-colors`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`p-1.5 rounded ${a}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white text-sm truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"text-xs text-slate-400 flex items-center gap-2",children:[e.jsx("span",{children:s.source}),e.jsx("span",{className:"text-slate-600",children:"|"}),e.jsx("span",{children:Ps(new Date(s.created_at),{addSuffix:!0})})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 ml-2",children:[e.jsx("div",{className:`px-2 py-0.5 text-xs font-semibold rounded ${a}`,children:s.severity.toUpperCase()}),e.jsxs("div",{className:"flex gap-1",children:[s.in_cisa_kev&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-red-900/30 text-red-400 rounded",children:"KEV"}),s.exploit_available&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-purple-900/30 text-purple-400 rounded",children:"Exploit"})]})]})]})},Ul=({onRemove:s})=>{const t=kt(),[a,l]=r.useState(null),[n,i]=r.useState([]),[c,d]=r.useState(!0),o=r.useCallback(async()=>{try{d(!0);const x=await bt.getMyAssignments({status:""});l(x.data.stats),i(x.data.assignments.slice(0,5))}catch(x){console.error("Failed to fetch assignments:",x)}finally{d(!1)}},[]);r.useEffect(()=>{o()},[o]);const j=async(x,g,b)=>{x.stopPropagation();try{await bt.updateAssignment(g,{status:b}),A.success("Status updated"),o()}catch(v){console.error("Failed to update status:",v),A.error("Failed to update status")}},N=x=>{const g="px-2 py-0.5 text-xs font-semibold rounded-full";switch(x.toLowerCase()){case"critical":return`${g} bg-red-500/20 text-red-400`;case"high":return`${g} bg-orange-500/20 text-orange-400`;case"medium":return`${g} bg-yellow-500/20 text-yellow-400`;case"low":return`${g} bg-blue-500/20 text-blue-400`;default:return`${g} bg-gray-500/20 text-gray-400`}},y=(x,g,b)=>{if(!x)return null;const k=new Date(x).toLocaleDateString();if(b)return e.jsxs("span",{className:"text-red-400 flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),"Overdue"]});if(g!==null){if(g===0)return e.jsx("span",{className:"text-yellow-400",children:"Today"});if(g<=3)return e.jsxs("span",{className:"text-yellow-400",children:[g,"d"]})}return e.jsx("span",{className:"text-gray-400",children:k})};return e.jsx($e,{title:"My Assignments",icon:e.jsx(Ga,{className:"h-5 w-5"}),onRemove:s,children:c?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ie,{className:"h-6 w-6 text-primary animate-spin"})}):e.jsxs(e.Fragment,{children:[a&&e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4 p-3 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-white",children:a.total}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:a.overdue}),e.jsx("div",{className:"text-xs text-slate-400",children:"Overdue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:a.in_progress}),e.jsx("div",{className:"text-xs text-slate-400",children:"In Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-cyan-400",children:a.critical+a.high}),e.jsx("div",{className:"text-xs text-slate-400",children:"High+"})]})]}),n.length===0?e.jsxs("div",{className:"text-center text-slate-400 py-8",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-2 text-green-500/50"}),e.jsx("p",{children:"No assignments"}),e.jsx("p",{className:"text-sm mt-1",children:"You are all caught up!"})]}):e.jsx("div",{className:"space-y-2",children:n.map(x=>e.jsxs("div",{className:`flex items-center justify-between p-3 bg-dark-bg rounded-lg border border-dark-border hover:border-primary cursor-pointer transition-colors ${x.is_overdue?"border-red-900/50":""}`,onClick:()=>t(`/remediation?vuln=${x.id}`),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:N(x.severity),children:x.severity.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate text-sm",children:x.vulnerability_id}),e.jsxs("div",{className:"text-xs text-slate-400",children:[x.host_ip,x.port?`:${x.port}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"text-xs",children:[e.jsx(ze,{className:"h-3 w-3 inline mr-1 text-gray-500"}),y(x.due_date,x.days_until_due,x.is_overdue)||e.jsx("span",{className:"text-gray-500",children:"--"})]}),x.status==="open"&&e.jsx("button",{onClick:g=>j(g,x.id,"in_progress"),className:"p-1 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Start Working",children:e.jsx(Gs,{className:"h-4 w-4"})}),x.status==="in_progress"&&e.jsx("button",{onClick:g=>j(g,x.id,"resolved"),className:"p-1 text-green-400 hover:bg-green-500/20 rounded transition-colors",title:"Mark Resolved",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(qe,{className:"h-4 w-4 text-gray-500"})]})]},x.id))}),a&&a.total>5&&e.jsx("div",{className:"pt-3 text-center",children:e.jsxs("button",{onClick:()=>t("/remediation?assigned=me"),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:["View all ",a.total," assignments"]})})]})})},wt=[{type:"recent_scans",label:"Recent Scans",minW:4,minH:2},{type:"vulnerability_summary",label:"Vulnerability Summary",minW:4,minH:2},{type:"compliance_scores",label:"Compliance Scores",minW:4,minH:2},{type:"scan_activity_chart",label:"Scan Activity",minW:6,minH:3},{type:"top_risky_hosts",label:"Top Risky Hosts",minW:4,minH:3},{type:"critical_vulns",label:"Critical Vulnerabilities",minW:4,minH:2},{type:"upcoming_scheduled_scans",label:"Upcoming Scans",minW:4,minH:2},{type:"threat_intel",label:"Threat Intelligence",minW:4,minH:3},{type:"my_assignments",label:"My Assignments",minW:4,minH:3}],Wl=({editMode:s=!1,onEditModeChange:t})=>{const[a,l]=r.useState([]),[n,i]=r.useState(!0),[c,d]=r.useState(!1),[o,j]=r.useState(s),[N,y]=r.useState(!1);r.useEffect(()=>{x()},[]),r.useEffect(()=>{j(s)},[s]);const x=async()=>{try{const F=await(await fetch("/api/dashboard/widgets",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();l(F.widgets||[])}catch(h){console.error("Failed to fetch dashboard config:",h)}finally{i(!1)}},g=async()=>{d(!0);try{await fetch("/api/dashboard/widgets",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({widgets:a})})}catch(h){console.error("Failed to save dashboard config:",h)}finally{d(!1)}},b=h=>{if(!o)return;const F=a.map(L=>{const P=h.find(V=>V.i===L.id);return P?{...L,x:P.x,y:P.y,w:P.w,h:P.h}:L});l(F)},v=h=>{const F=wt.find(P=>P.type===h);if(!F)return;const L={id:`${h}_${Date.now()}`,widget_type:h,x:0,y:1/0,w:F.minW,h:F.minH};l([...a,L]),y(!1)},k=h=>{l(a.filter(F=>F.id!==h))},$=()=>{const h=!o;j(h),t&&t(h)},w=h=>{const F={onRemove:o?()=>k(h.id):void 0};switch(h.widget_type){case"recent_scans":return e.jsx(Rl,{...F});case"vulnerability_summary":return e.jsx(Ll,{...F});case"compliance_scores":return e.jsx(Pl,{...F});case"scan_activity_chart":return e.jsx(Ml,{...F});case"top_risky_hosts":return e.jsx(zl,{...F});case"critical_vulns":return e.jsx(Hl,{...F});case"upcoming_scheduled_scans":return e.jsx(Vl,{...F});case"threat_intel":return e.jsx(Bl,{...F});case"my_assignments":return e.jsx(Ul,{...F});default:return null}};if(n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"Loading dashboard..."})});const u=a.map(h=>({i:h.id,x:h.x,y:h.y,w:h.w,h:h.h}));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:$,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${o?"bg-primary text-white":"bg-dark-surface text-slate-300 hover:text-white border border-dark-border"}`,children:[e.jsx(ht,{className:"h-4 w-4"}),o?"Exit Edit Mode":"Customize Dashboard"]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>y(!N),className:"flex items-center gap-2 px-4 py-2 bg-dark-surface text-slate-300 hover:text-white border border-dark-border rounded-lg transition-colors",children:[e.jsx(We,{className:"h-4 w-4"}),"Add Widget"]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>y(!1)}),e.jsx("div",{className:"absolute top-full mt-2 left-0 bg-dark-surface border border-dark-border rounded-lg shadow-xl z-50 min-w-[200px]",children:wt.map(h=>e.jsx("button",{onClick:()=>v(h.type),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:text-white hover:bg-dark-hover transition-colors first:rounded-t-lg last:rounded-b-lg",children:h.label},h.type))})]})]}),e.jsxs("button",{onClick:g,disabled:c,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Js,{className:"h-4 w-4"}),c?"Saving...":"Save Layout"]})]})]}),o&&e.jsx("div",{className:"text-sm text-slate-400",children:"Drag widgets to reposition, resize from corners"})]}),e.jsx(Dl,{className:"layout",layout:u,cols:12,rowHeight:100,width:1200,isDraggable:o,isResizable:o,onLayoutChange:b,draggableHandle:".drag-handle",children:a.map(h=>e.jsx("div",{className:o?"cursor-move":"",children:w(h)},h.id))}),a.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(ht,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No widgets added yet"}),o&&e.jsx("button",{onClick:()=>y(!0),className:"mt-4 text-primary hover:underline",children:"Add your first widget"})]})]})},Gl=({selectedCount:s,onClear:t,actions:a,onAction:l,isProcessing:n=!1})=>{const[i,c]=r.useState(null);if(s===0)return null;const d=y=>{y.requiresConfirmation?c(y.id):l(y.id)},o=()=>{i&&(l(i),c(null))},j=y=>{if(y.icon)return y.icon;switch(y.id){case"delete":return e.jsx(Xs,{className:"h-4 w-4"});case"export":return e.jsx(He,{className:"h-4 w-4"});default:return null}},N=a.find(y=>y.id===i);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-dark-card border border-dark-border rounded-lg shadow-2xl px-6 py-4 min-w-[400px]",children:e.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-primary/10 text-primary rounded-full w-8 h-8 flex items-center justify-center font-semibold text-sm",children:s}),e.jsxs("span",{className:"text-white font-medium",children:[s," item",s!==1?"s":""," selected"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.map(y=>e.jsxs(Q,{variant:y.variant||"secondary",onClick:()=>d(y),disabled:n,className:"flex items-center space-x-2",children:[j(y),e.jsx("span",{children:y.label})]},y.id)),e.jsx("button",{onClick:t,disabled:n,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-dark-bg disabled:opacity-50",title:"Clear selection",children:e.jsx(we,{className:"h-5 w-5"})})]})]})})}),i&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Confirm Action"}),e.jsx("p",{className:"text-slate-300 mb-6",children:N.confirmationMessage||`Are you sure you want to ${N.label.toLowerCase()} ${s} item${s!==1?"s":""}?`}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(Q,{variant:"secondary",onClick:()=>c(null),disabled:n,children:"Cancel"}),e.jsx(Q,{variant:N.variant||"primary",onClick:o,disabled:n,children:"Confirm"})]})]})})]})},Kl=({shortcuts:s,enabled:t=!0})=>{r.useEffect(()=>{if(!t)return;const a=l=>{if(!(l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement||l.target instanceof HTMLSelectElement))for(const n of s){const i=n.ctrl===void 0||n.ctrl===(l.ctrlKey||l.metaKey),c=n.shift===void 0||n.shift===l.shiftKey,d=n.alt===void 0||n.alt===l.altKey,o=l.key.toLowerCase()===n.key.toLowerCase();if(i&&c&&d&&o){l.preventDefault(),n.action();break}}};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[s,t])},ql=s=>{const t=[];return s.ctrl&&t.push("Ctrl"),s.shift&&t.push("Shift"),s.alt&&t.push("Alt"),t.push(s.key.toUpperCase()),t.join("+")},xi=()=>{const{activeScan:s,results:t,setActiveScan:a,scans:l,setScans:n}=ge(),[i,c]=r.useState(!1),[d,o]=r.useState("overview"),[j,N]=r.useState(new Set),[y,x]=r.useState(!1),g=h=>{const F=l.find(L=>L.id===h);F&&a(F)},b=async h=>{if(j.size!==0){x(!0);try{switch(h){case"delete":await v();break;case"export-json":await k("json");break;case"export-csv":await k("csv");break;default:A.warning("Unknown action")}}catch(F){console.error("Bulk action failed:",F),A.error("Bulk action failed")}finally{x(!1)}}},v=async()=>{try{const h=await ve.bulkDelete(Array.from(j));h.data.failed&&h.data.failed>0?A.warning(h.data.message):A.success(h.data.message);const F=await ve.getAll();n(F.data),N(new Set)}catch(h){throw A.error("Failed to delete scans"),h}},k=async h=>{try{const F=await ve.bulkExport(Array.from(j),h,{include_vulnerabilities:!0,include_services:!0}),L=window.URL.createObjectURL(new Blob([F.data])),P=document.createElement("a");P.href=L,P.setAttribute("download","scans_export.zip"),document.body.appendChild(P),P.click(),P.remove(),window.URL.revokeObjectURL(L),A.success(`Exported ${j.size} scan(s) successfully`),N(new Set)}catch(F){throw A.error("Failed to export scans"),F}},$=[{id:"delete",label:"Delete",icon:e.jsx(Xs,{className:"h-4 w-4"}),variant:"danger",requiresConfirmation:!0,confirmationMessage:`Are you sure you want to delete ${j.size} scan${j.size!==1?"s":""}? This action cannot be undone.`},{id:"export-json",label:"Export JSON",icon:e.jsx(He,{className:"h-4 w-4"}),variant:"secondary"},{id:"export-csv",label:"Export CSV",icon:e.jsx(He,{className:"h-4 w-4"}),variant:"secondary"}],w=r.useMemo(()=>s&&t.has(s.id)?t.get(s.id)||[]:Array.from(t.values()).flat(),[s,t]),u=[{key:"f",ctrl:!0,action:()=>{const h=document.querySelector('input[placeholder*="Search"]');h&&(h.focus(),h.select())},description:"Focus search"},{key:"k",ctrl:!0,action:()=>c(!i),description:"Show keyboard shortcuts"},{key:"Escape",action:()=>c(!1),description:"Close modals"}];return Kl({shortcuts:u}),e.jsx(Za,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"Network Triage Dashboard"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Create scans, monitor progress, and analyze results in real-time"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-3 py-2 text-sm text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors border border-light-border dark:border-dark-border hover:border-primary rounded-lg",children:[e.jsx(ut,{className:"h-4 w-4"}),"Shortcuts"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-light-border dark:border-dark-border pb-2",children:[e.jsxs("button",{onClick:()=>o("overview"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${d==="overview"?"bg-light-surface dark:bg-dark-surface text-primary border-b-2 border-primary":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[e.jsx(Ka,{className:"h-4 w-4"}),"Overview"]}),e.jsxs("button",{onClick:()=>o("scans"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${d==="scans"?"bg-light-surface dark:bg-dark-surface text-primary border-b-2 border-primary":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[e.jsx(qa,{className:"h-4 w-4"}),"Scans"]}),e.jsxs("button",{onClick:()=>o("analytics"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${d==="analytics"?"bg-light-surface dark:bg-dark-surface text-primary border-b-2 border-primary":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[e.jsx(Ls,{className:"h-4 w-4"}),"Analytics"]})]}),d==="overview"&&e.jsx(Wl,{}),d==="scans"&&e.jsxs(e.Fragment,{children:[e.jsx(jl,{}),e.jsx(Tr,{onScanSelect:g}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(Nr,{}),e.jsx(kr,{selectedIds:j,onSelectionChange:N})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(Fr,{scanId:(s==null?void 0:s.id)||null}),(s==null?void 0:s.status)==="running"&&e.jsx(Ar,{scanId:s.id}),w.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(yl,{hosts:w}),e.jsx(wl,{hosts:w})]}),e.jsx(bl,{})]})]})]}),d==="analytics"&&e.jsx(Al,{}),e.jsx(Gl,{selectedCount:j.size,onClear:()=>N(new Set),actions:$,onAction:b,isProcessing:y}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 animate-fadeIn",onClick:()=>c(!1)}),e.jsxs("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-2xl p-6 w-full max-w-md animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5 text-primary"}),"Keyboard Shortcuts"]}),e.jsx("button",{onClick:()=>c(!1),className:"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"space-y-2",children:u.map((h,F)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-light-bg dark:bg-dark-bg rounded border border-light-border dark:border-dark-border",children:[e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:h.description}),e.jsx("kbd",{className:"px-2 py-1 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded text-xs font-mono text-primary",children:ql(h)})]},F))}),e.jsxs("p",{className:"text-xs text-slate-500 mt-4 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded text-xs font-mono",children:"Esc"})," to close"]})]})]})]})})};export{xi as default};
