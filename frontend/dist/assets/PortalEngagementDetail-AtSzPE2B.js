import{j as e}from"./vendor-state-DdX3IZQk.js";import{j as f,r,L as o}from"./vendor-react-Da1CiaFS.js";import{P as n}from"./PortalLayout-UqTTZJkV.js";import{aa as x}from"./index-Rk50pbPR.js";import"./vendor-ui-M-o_--rZ.js";import"./vendor-charts-PE5xD9Ly.js";const N={pending:"bg-yellow-900/50 text-yellow-200",in_progress:"bg-blue-900/50 text-blue-200",completed:"bg-green-900/50 text-green-200"};function _(){const{id:a}=f(),[s,g]=r.useState(null),[m,p]=r.useState(!0),[l,u]=r.useState(""),[i,d]=r.useState(null);r.useEffect(()=>{a&&c()},[a]);const c=async()=>{if(a)try{const t=await x.getById(a);g(t.data)}catch(t){u("Failed to load engagement"),console.error(t)}finally{p(!1)}},h=async(t,j)=>{if(a){d(t.id);try{await x.updateMilestone(a,t.id,{status:j}),c()}catch(b){console.error("Failed to update milestone:",b)}finally{d(null)}}};return m?e.jsx(n,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})}):l||!s?e.jsx(n,{children:e.jsx("div",{className:"bg-red-900/50 text-red-200 p-4 rounded-lg",children:l||"Engagement not found"})}):e.jsx(n,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{to:"/portal/engagements",className:"text-gray-400 hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:s.engagement.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Status"}),e.jsx("p",{className:"text-lg font-semibold text-white capitalize",children:s.engagement.status.replace("_"," ")})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Scans"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:s.scan_count})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Vulnerabilities"}),e.jsx(o,{to:`/portal/vulnerabilities?engagement_id=${a}`,className:"text-lg font-semibold text-blue-400 hover:text-blue-300",children:s.vulnerability_count})]})]}),s.engagement.scope&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Scope"}),e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:s.engagement.scope})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Milestones"}),s.milestones.length===0?e.jsx("p",{className:"text-gray-400",children:"No milestones defined"}):e.jsx("div",{className:"space-y-4",children:s.milestones.map(t=>e.jsx("div",{className:"border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-white",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:t.description}),t.due_date&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${N[t.status]||"bg-gray-700 text-gray-300"}`,children:t.status}),t.status!=="completed"&&e.jsx("button",{onClick:()=>h(t,"completed"),disabled:i===t.id,className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white text-xs rounded disabled:opacity-50",children:i===t.id?"...":"Complete"})]})]})},t.id))})]})]})})}export{_ as default};
