import{j as e}from"./vendor-state-oFDmcCcB.js";import{r as c}from"./vendor-react-5KxtEOLM.js";import{B as n,F as w,m as M,X as O,az as ee,M as k,D as ae,p as se,a$ as te,aY as le,aZ as re,aN as ie,ac as ne}from"./vendor-ui-BlFJDRaq.js";import{P as u,B as b}from"./index-DU1ke8Sf.js";import{C as m}from"./Card-Diy4jxHS.js";import{B as L}from"./Badge-DPBIV1xM.js";import{L as B}from"./LoadingSpinner-Cy32pNXE.js";import{C as ce}from"./ConfirmationDialog-C1KfPD_c.js";import{b as de}from"./vendor-utils-DfRopTPV.js";const z={name:"",description:"",report_type:"vulnerability",format:"pdf",schedule:"0 8 * * *",recipients:[],filters:{days_back:30},include_charts:!0},C=[{value:"vulnerability",label:"Vulnerability Report",description:"All discovered vulnerabilities with severity and remediation"},{value:"scan_summary",label:"Scan Summary",description:"Overview of completed scans and their results"},{value:"compliance",label:"Compliance Report",description:"Compliance framework analysis and control mappings"},{value:"executive",label:"Executive Summary",description:"High-level security posture overview"}],oe=[{value:"pdf",label:"PDF"},{value:"html",label:"HTML"},{value:"csv",label:"CSV"}],ue=[{value:"",label:"All Severities"},{value:"low",label:"Low and above"},{value:"medium",label:"Medium and above"},{value:"high",label:"High and above"},{value:"critical",label:"Critical only"}],me=[{value:"cis",label:"CIS Benchmarks"},{value:"nist_800_53",label:"NIST 800-53"},{value:"nist_csf",label:"NIST CSF"},{value:"pci_dss",label:"PCI-DSS 4.0"},{value:"hipaa",label:"HIPAA"},{value:"ferpa",label:"FERPA"},{value:"soc2",label:"SOC 2"},{value:"owasp_top10",label:"OWASP Top 10"},{value:"hitrust_csf",label:"HITRUST CSF"},{value:"iso_27001",label:"ISO 27001:2022"},{value:"gdpr",label:"GDPR"},{value:"dod_stig",label:"DoD STIG"},{value:"fedramp",label:"FedRAMP"},{value:"cmmc",label:"CMMC 2.0"},{value:"fisma",label:"FISMA"},{value:"nist_800_171",label:"NIST 800-171"},{value:"nist_800_82",label:"NIST 800-82"},{value:"nist_800_61",label:"NIST 800-61"},{value:"stateramp",label:"StateRAMP"},{value:"itar",label:"ITAR"},{value:"ear",label:"EAR"},{value:"dfars",label:"DFARS 252.204-7012"},{value:"icd_503",label:"ICD 503"},{value:"cnssi_1253",label:"CNSSI 1253"},{value:"rmf",label:"Risk Management Framework"},{value:"disa_cloud_srg",label:"DISA Cloud SRG"},{value:"dod_zero_trust",label:"DoD Zero Trust"},{value:"nist_privacy",label:"NIST Privacy Framework"},{value:"csa_ccm",label:"CSA CCM"},{value:"nerc_cip",label:"NERC CIP"},{value:"iec_62443",label:"IEC 62443"},{value:"tsa_pipeline",label:"TSA Pipeline Security"},{value:"cisa_cpgs",label:"CISA CPGs"},{value:"eo_14028",label:"EO 14028"},{value:"sox",label:"SOX IT Controls"},{value:"glba",label:"GLBA"},{value:"cyber_essentials",label:"Cyber Essentials (UK)"},{value:"ism_australia",label:"Australian ISM"},{value:"irap",label:"IRAP"},{value:"nis2",label:"NIS2 Directive"},{value:"ens_spain",label:"ENS (Spain)"},{value:"bsi_grundschutz",label:"BSI IT-Grundschutz"},{value:"c5",label:"C5"},{value:"secnumcloud",label:"SecNumCloud"},{value:"nato_cyber",label:"NATO Cyber Defence"}],Se=()=>{var $;const[R,G]=c.useState([]),[v,H]=c.useState([]),[U,I]=c.useState(!0),[f,g]=c.useState(!1),[x,D]=c.useState(null),[s,i]=c.useState(z),[A,y]=c.useState(""),[o,j]=c.useState(null),[W,T]=c.useState(!1),[F,P]=c.useState(null),[N,p]=c.useState(!1);c.useEffect(()=>{h()},[]);const h=async()=>{I(!0);try{const[a,l]=await Promise.all([u.getAll(),u.getPresets()]);G(a.data),H(l.data)}catch(a){n.error("Failed to load scheduled reports"),console.error(a)}finally{I(!1)}},S=()=>{i(z),D(null),g(!1),y(""),p(!1)},V=a=>{const l=JSON.parse(a.recipients),t=a.filters?JSON.parse(a.filters):{};i({name:a.name,description:a.description||"",report_type:a.report_type,format:a.format,schedule:a.schedule,recipients:l,filters:t,include_charts:a.include_charts});const r=v.some(d=>d.cron===a.schedule);p(!r),D(a.id),g(!0)},E=()=>{const a=A.trim().toLowerCase();if(!a)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){n.error("Please enter a valid email address");return}if(s.recipients.includes(a)){n.warning("Email already added");return}i(t=>({...t,recipients:[...t.recipients,a]})),y("")},Y=a=>{i(l=>({...l,recipients:l.recipients.filter(t=>t!==a)}))},J=async a=>{var l,t;if(a.preventDefault(),!s.name.trim()){n.error("Name is required");return}if(s.recipients.length===0){n.error("At least one recipient is required");return}try{x?(await u.update(x,{name:s.name,description:s.description||void 0,report_type:s.report_type,format:s.format,schedule:s.schedule,recipients:s.recipients,filters:s.filters,include_charts:s.include_charts}),n.success("Scheduled report updated")):(await u.create({name:s.name,description:s.description||void 0,report_type:s.report_type,format:s.format,schedule:s.schedule,recipients:s.recipients,filters:s.filters,include_charts:s.include_charts}),n.success("Scheduled report created")),S(),h()}catch(r){const d=r;n.error(((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to save scheduled report")}},K=async a=>{var l,t;try{await u.update(a.id,{is_active:!a.is_active}),n.success(`Scheduled report ${a.is_active?"paused":"activated"}`),h()}catch(r){const d=r;n.error(((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to update")}},q=async a=>{var l,t;P(a.id);try{await u.runNow(a.id),n.success("Report generation started. You will receive it via email shortly.")}catch(r){const d=r;n.error(((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to run report")}finally{P(null)}},X=async()=>{var a,l;if(o){T(!0);try{await u.delete(o.id),n.success(`Scheduled report "${o.name}" deleted`),h(),j(null)}catch(t){const r=t;n.error(((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.error)||"Failed to delete")}finally{T(!1)}}},Z=a=>{const l=v.find(r=>r.cron===a);if(l)return l.label;const t=a.split(" ");if(t.length===5){const[r,d]=t,_=`${d.padStart(2,"0")}:${r.padStart(2,"0")}`;if(t[4]==="*"&&t[3]==="*"&&t[2]==="*")return`Daily at ${_}`;if(t[4]!=="*")return`Weekly on ${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][parseInt(t[4])]} at ${_}`;if(t[2]!=="*")return`Monthly on day ${t[2]} at ${_}`}return a},Q=a=>{var l;return((l=C.find(t=>t.value===a))==null?void 0:l.label)||a};return U?e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scheduled Reports"})]}),!f&&e.jsxs(b,{variant:"primary",onClick:()=>g(!0),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"New Scheduled Report"]})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Automatically generate and email reports on a schedule"})]}),f&&e.jsx(m,{children:e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:x?"Edit Scheduled Report":"Create Scheduled Report"}),e.jsx("button",{type:"button",onClick:S,className:"text-slate-400 hover:text-white",children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>i({...s,name:a.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Weekly Vulnerability Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:s.description,onChange:a=>i({...s,description:a.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Optional description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Report Type"}),e.jsx("select",{value:s.report_type,onChange:a=>i({...s,report_type:a.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",children:C.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:($=C.find(a=>a.value===s.report_type))==null?void 0:$.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Format"}),e.jsx("div",{className:"flex gap-2",children:oe.map(a=>e.jsx("button",{type:"button",onClick:()=>i({...s,format:a.value}),className:`flex-1 px-4 py-2 rounded-lg border transition-colors ${s.format===a.value?"bg-primary/20 border-primary text-primary":"bg-dark-bg border-dark-border text-slate-400 hover:border-slate-500"}`,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"})," Schedule"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[v.map(a=>e.jsx("button",{type:"button",onClick:()=>{i({...s,schedule:a.cron}),p(!1)},className:`px-3 py-1.5 rounded-lg border text-sm transition-colors ${s.schedule===a.cron&&!N?"bg-primary/20 border-primary text-primary":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,title:a.description,children:a.label},a.id)),e.jsx("button",{type:"button",onClick:()=>p(!0),className:`px-3 py-1.5 rounded-lg border text-sm transition-colors ${N?"bg-primary/20 border-primary text-primary":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:"Custom"})]}),N&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Cron Expression"}),e.jsx("input",{type:"text",value:s.schedule,onChange:a=>i({...s,schedule:a.target.value}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white font-mono text-sm",placeholder:"0 8 * * *"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:'Format: minute hour day-of-month month day-of-week (e.g., "0 8 * * *" for daily at 8am)'})]})]})]}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"})," Recipients"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"email",value:A,onChange:a=>y(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),E())},className:"flex-1 bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",placeholder:"email@example.com"}),e.jsx(b,{type:"button",variant:"secondary",onClick:E,children:e.jsx(M,{className:"h-4 w-4"})})]}),s.recipients.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.recipients.map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-dark-surface rounded-lg text-sm text-slate-300",children:[e.jsx(k,{className:"h-3 w-3"}),a,e.jsx("button",{type:"button",onClick:()=>Y(a),className:"ml-1 text-slate-500 hover:text-red-400",children:e.jsx(O,{className:"h-3 w-3"})})]},a))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No recipients added"})]}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-3",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Time Period"}),e.jsxs("select",{value:s.filters.days_back||30,onChange:a=>i({...s,filters:{...s.filters,days_back:parseInt(a.target.value)}}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:14,children:"Last 14 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:60,children:"Last 60 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]})]}),s.report_type==="vulnerability"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Minimum Severity"}),e.jsx("select",{value:s.filters.min_severity||"",onChange:a=>i({...s,filters:{...s.filters,min_severity:a.target.value||void 0}}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:ue.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),s.report_type==="compliance"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Frameworks"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:me.map(a=>{var l;return e.jsx("button",{type:"button",onClick:()=>{const t=s.filters.frameworks||[],r=t.includes(a.value)?t.filter(d=>d!==a.value):[...t,a.value];i({...s,filters:{...s.filters,frameworks:r}})},className:`px-2 py-1 rounded text-xs border transition-colors ${(l=s.filters.frameworks)!=null&&l.includes(a.value)?"bg-primary/20 border-primary text-primary":"bg-dark-surface border-dark-border text-slate-400 hover:border-slate-500"}`,children:a.label},a.value)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"include_charts",checked:s.include_charts,onChange:a=>i({...s,include_charts:a.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-bg text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"include_charts",className:"text-sm text-slate-300",children:"Include charts and visualizations"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{type:"button",variant:"secondary",onClick:S,children:"Cancel"}),e.jsxs(b,{type:"submit",variant:"primary",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),x?"Update":"Create"]})]})]})}),R.length===0&&!f?e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No scheduled reports"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create automated reports to receive regular updates via email"})]})}):e.jsx("div",{className:"space-y-3",children:R.map(a=>{const l=JSON.parse(a.recipients);return e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.is_active?"bg-green-500/20":"bg-slate-500/20"}`,children:e.jsx(w,{className:`h-5 w-5 ${a.is_active?"text-green-400":"text-slate-400"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-white",children:a.name}),e.jsx(L,{variant:"status",type:a.is_active?"completed":"pending",children:a.is_active?"Active":"Paused"}),e.jsx(L,{variant:"primary",children:a.format.toUpperCase()})]}),e.jsxs("p",{className:"text-sm text-slate-400",children:[Q(a.report_type)," - ",Z(a.schedule)]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),l.length," recipient",l.length!==1?"s":""]}),a.last_run_at&&e.jsxs("span",{className:"ml-3",children:[e.jsx(se,{className:"h-3 w-3 inline mr-1"}),"Last run ",de(new Date(a.last_run_at))," ago"]}),e.jsxs("span",{className:"ml-3",children:["Next: ",new Date(a.next_run_at).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(a),disabled:F===a.id,className:"p-2 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors disabled:opacity-50",title:"Run Now",children:F===a.id?e.jsx(B,{size:"sm"}):e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>K(a),className:`p-2 rounded transition-colors ${a.is_active?"text-yellow-400 hover:bg-yellow-500/20":"text-green-400 hover:bg-green-500/20"}`,title:a.is_active?"Pause":"Activate",children:a.is_active?e.jsx(le,{className:"h-4 w-4"}):e.jsx(re,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>V(a),className:"p-2 text-slate-400 hover:text-primary transition-colors",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j(a),className:"p-2 text-slate-400 hover:text-red-400 transition-colors","aria-label":`Delete scheduled report ${a.name}`,children:e.jsx(ne,{className:"h-4 w-4"})})]})]})},a.id)})}),e.jsx(ce,{isOpen:!!o,onClose:()=>j(null),onConfirm:X,title:"Delete Scheduled Report",message:`Are you sure you want to delete the scheduled report "${o==null?void 0:o.name}"? Future reports will no longer be generated.`,confirmLabel:"Delete Report",variant:"warning",loading:W})]})};export{Se as S};
