import{j as e,b as we,u as W,d as L}from"./vendor-state-BjT_zREg.js";import{R as X,r as _}from"./vendor-react-5KxtEOLM.js";import{x as F,cg as be,ce as _e,w as Ce,Z as H,af as G,p as V,V as Y,Y as ee,L as Se,W as Ae,e as K,ar as pe,a9 as M,s as ae,ab as $e,i as te,O as je,g as ke,l as Le,_ as Me,v as Te,ch as De,aY as ze,X as fe,z as ve,cf as Fe,D as oe,m as se,y as Qe,B as p}from"./vendor-ui-CaTPr3iI.js";import{L as Pe}from"./Layout-DF6EApG0.js";import{B as k}from"./index-BgPDfr41.js";import{B as q}from"./Badge-Bi3Nk-Vg.js";import{a as Ee}from"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const xe={online:{label:"Online",variant:"success",icon:e.jsx(Ae,{className:"w-3 h-3"})},busy:{label:"Busy",variant:"warning",icon:e.jsx(Y,{className:"w-3 h-3"})},offline:{label:"Offline",variant:"danger",icon:e.jsx(ee,{className:"w-3 h-3"})},joining:{label:"Joining",variant:"info",icon:e.jsx(Se,{className:"w-3 h-3 animate-spin"})},leaving:{label:"Leaving",variant:"secondary",icon:e.jsx(ee,{className:"w-3 h-3"})},disconnected:{label:"Disconnected",variant:"danger",icon:e.jsx(ee,{className:"w-3 h-3"})},unknown:{label:"Unknown",variant:"secondary",icon:e.jsx(Y,{className:"w-3 h-3"})}},me=({agent:s,isLeader:a=!1,onClick:r,onPing:o,onRemove:y,showActions:C=!0})=>{const[g,x]=X.useState(!1),d=X.useRef(null);X.useEffect(()=>{const u=v=>{d.current&&!d.current.contains(v.target)&&x(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const j=xe[s.status]||xe.unknown,f=Math.round(s.load*100),w=s.max_tasks>0?s.current_tasks/s.max_tasks*100:0,h=u=>{const v=new Date(u),b=new Date().getTime()-v.getTime(),T=Math.floor(b/6e4);if(T<1)return"Just now";if(T<60)return`${T}m ago`;const D=Math.floor(T/60);return D<24?`${D}h ago`:v.toLocaleDateString()};return e.jsxs("div",{className:`relative bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4 transition-all ${r?"cursor-pointer hover:border-primary/50 hover:shadow-lg":""}`,onClick:r,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.status==="online"?"bg-green-500/20":s.status==="busy"?"bg-yellow-500/20":"bg-slate-500/20"}`,children:e.jsx(F,{className:`w-5 h-5 ${s.status==="online"?"text-green-400":s.status==="busy"?"text-yellow-400":"text-slate-400"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:s.name}),a&&e.jsx("span",{title:"Cluster Leader",children:e.jsx(be,{className:"w-4 h-4 text-yellow-400"})})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[s.address,":",s.mesh_port]})]})]}),C&&e.jsxs("div",{className:"relative",ref:d,children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),x(!g)},className:"p-1 rounded hover:bg-light-hover dark:hover:bg-dark-hover",children:e.jsx(_e,{className:"w-4 h-4 text-slate-400"})}),g&&e.jsxs("div",{className:"absolute right-0 mt-1 w-40 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-lg py-1 z-10",children:[o&&e.jsx("button",{onClick:u=>{u.stopPropagation(),o(),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-light-hover dark:hover:bg-dark-hover",children:"Ping Agent"}),y&&e.jsx("button",{onClick:u=>{u.stopPropagation(),y(),x(!1)},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-light-hover dark:hover:bg-dark-hover",children:"Remove Agent"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs(q,{variant:j.variant,children:[j.icon,e.jsx("span",{className:"ml-1",children:j.label})]}),s.latency_ms!==null&&s.status==="online"&&e.jsxs("span",{className:"text-xs text-slate-400",children:[s.latency_ms,"ms"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-light-hover dark:bg-dark-hover rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),"Load"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${f>80?"bg-red-500":f>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${f}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:[f,"%"]})]})]}),e.jsxs("div",{className:"bg-light-hover dark:bg-dark-hover rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(H,{className:"w-3 h-3"}),"Tasks"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${w>80?"bg-red-500":w>50?"bg-yellow-500":"bg-cyan-500"}`,style:{width:`${w}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:[s.current_tasks,"/",s.max_tasks]})]})]})]}),s.capabilities.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1.5",children:[e.jsx(H,{className:"w-3 h-3"}),"Capabilities"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.capabilities.slice(0,4).map(u=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-cyan-500/10 text-cyan-400 rounded",children:u},u)),s.capabilities.length>4&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-slate-500/10 text-slate-400 rounded",children:["+",s.capabilities.length-4," more"]})]})]}),s.network_zones.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1.5",children:[e.jsx(G,{className:"w-3 h-3"}),"Network Zones"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.network_zones.map(u=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-purple-500/10 text-purple-400 rounded",children:u},u))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-light-border dark:border-dark-border text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),h(s.last_seen)]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-slate-400",children:["v",s.protocol_version]})})]})]})},qe=({cluster:s,onViewDetails:a,onEditConfig:r,onDelete:o,onElectLeader:y,showActions:C=!0})=>{const g=s.health,x=s.config,d=g.online_members+g.offline_members,j=d>0?Math.round(g.online_members/d*100):0,f=Math.round(g.average_load*100),h=g.is_healthy?g.offline_members>0?{label:"Degraded",variant:"warning",icon:e.jsx(je,{className:"w-4 h-4"})}:{label:"Healthy",variant:"success",icon:e.jsx(ke,{className:"w-4 h-4"})}:{label:"Unhealthy",variant:"danger",icon:e.jsx(te,{className:"w-4 h-4"})},u=d>=((x==null?void 0:x.min_quorum_size)||1),v=s.members.find(N=>N.agent_id===s.leader_agent_id);return e.jsxs("div",{className:`bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg overflow-hidden ${a?"cursor-pointer hover:border-primary/50":""}`,onClick:a,children:[e.jsx("div",{className:"p-4 border-b border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${g.is_healthy?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx(K,{className:`w-5 h-5 ${g.is_healthy?"text-green-400":"text-red-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 line-clamp-1",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(q,{variant:h.variant,children:[h.icon,e.jsx("span",{className:"ml-1",children:h.label})]})})]})}),e.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(F,{className:"w-3 h-3"}),"Members"]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[g.online_members,e.jsxs("span",{className:"text-sm font-normal text-slate-400",children:["/",d]})]}),e.jsx("div",{className:"mt-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${j===100?"bg-green-500":j>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${j}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(H,{className:"w-3 h-3"}),"Tasks"]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:g.total_tasks}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"Avg Load"]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[f,"%"]}),e.jsx("div",{className:"mt-1 h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${f>80?"bg-red-500":f>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${f}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(Y,{className:"w-3 h-3"}),"Quorum"]}),e.jsx("div",{className:`text-2xl font-bold ${u?"text-green-400":"text-red-400"}`,children:u?"Yes":"No"}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["min: ",(x==null?void 0:x.min_quorum_size)||1]})]})]}),v&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-yellow-500/10 rounded-lg",children:[e.jsx(be,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Leader:"}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:v.name}),e.jsxs("span",{className:"text-xs text-slate-400",children:["(",v.address,":",v.mesh_port,")"]})]})}),x&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[x.enable_work_stealing&&e.jsx("span",{className:"px-2 py-1 bg-cyan-500/10 text-cyan-400 rounded",children:"Work Stealing"}),x.enable_gossip&&e.jsx("span",{className:"px-2 py-1 bg-purple-500/10 text-purple-400 rounded",children:"Gossip Protocol"}),x.enable_mdns&&e.jsx("span",{className:"px-2 py-1 bg-blue-500/10 text-blue-400 rounded",children:"mDNS Discovery"}),x.auto_elect_leader&&e.jsx("span",{className:"px-2 py-1 bg-yellow-500/10 text-yellow-400 rounded",children:"Auto Leader Election"})]})}),C&&e.jsxs("div",{className:"px-4 pb-4 flex items-center gap-2",children:[y&&e.jsxs(k,{size:"sm",variant:"outline",onClick:N=>{N.stopPropagation(),y()},children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Elect Leader"]}),r&&e.jsxs(k,{size:"sm",variant:"outline",onClick:N=>{N.stopPropagation(),r()},children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Configure"]}),o&&e.jsxs(k,{size:"sm",variant:"ghost",onClick:N=>{N.stopPropagation(),o()},className:"text-red-400 hover:text-red-300",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Delete"]})]}),g.last_check&&e.jsxs("div",{className:"px-4 pb-3 text-xs text-slate-400",children:["Last health check: ",new Date(g.last_check).toLocaleString()]})]})},he={pending:{label:"Pending",variant:"warning",icon:e.jsx(V,{className:"w-3 h-3"})},running:{label:"Running",variant:"info",icon:e.jsx(ze,{className:"w-3 h-3"})},completed:{label:"Completed",variant:"success",icon:e.jsx(ke,{className:"w-3 h-3"})},failed:{label:"Failed",variant:"danger",icon:e.jsx(je,{className:"w-3 h-3"})}},ue=({tasks:s,agents:a=[],isLoading:r=!1,onCancelTask:o,onRetryTask:y,onReassignTask:C,onBulkCancel:g,onRefresh:x})=>{const[d,j]=_.useState(new Set),[f,w]=_.useState(null),[h,u]=_.useState(null),[v,N]=_.useState("all"),b=s.filter(l=>v==="all"?!0:l.status===v),T=s.filter(l=>l.status==="pending").length,D=s.filter(l=>l.status==="running").length,I=s.filter(l=>l.status==="completed").length,J=s.filter(l=>l.status==="failed").length,R=l=>{const i=new Set(d);i.has(l)?i.delete(l):i.add(l),j(i)},B=()=>{d.size===b.length?j(new Set):j(new Set(b.map(l=>l.task.id)))},Z=()=>{g&&d.size>0&&(g(Array.from(d)),j(new Set))},O=l=>{const i=new Date(l),z=new Date().getTime()-i.getTime(),A=Math.floor(z/6e4),m=Math.floor(A/60);return A<1?"Just now":A<60?`${A}m`:m<24?`${m}h ${A%60}m`:`${Math.floor(m/24)}d ${m%24}h`};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Task Queue"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.size>0&&g&&e.jsxs(k,{size:"sm",variant:"danger",onClick:Z,children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"Cancel Selected (",d.size,")"]}),x&&e.jsxs(k,{size:"sm",variant:"outline",onClick:x,disabled:r,children:[e.jsx(M,{className:`w-3 h-3 mr-1 ${r?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("button",{onClick:()=>N("all"),className:`px-3 py-1 rounded-full transition-colors ${v==="all"?"bg-slate-500/20 text-slate-200":"text-slate-400 hover:text-slate-200"}`,children:["All (",s.length,")"]}),e.jsxs("button",{onClick:()=>N("pending"),className:`px-3 py-1 rounded-full transition-colors ${v==="pending"?"bg-yellow-500/20 text-yellow-400":"text-slate-400 hover:text-yellow-400"}`,children:["Pending (",T,")"]}),e.jsxs("button",{onClick:()=>N("running"),className:`px-3 py-1 rounded-full transition-colors ${v==="running"?"bg-blue-500/20 text-blue-400":"text-slate-400 hover:text-blue-400"}`,children:["Running (",D,")"]}),e.jsxs("button",{onClick:()=>N("completed"),className:`px-3 py-1 rounded-full transition-colors ${v==="completed"?"bg-green-500/20 text-green-400":"text-slate-400 hover:text-green-400"}`,children:["Completed (",I,")"]}),e.jsxs("button",{onClick:()=>N("failed"),className:`px-3 py-1 rounded-full transition-colors ${v==="failed"?"bg-red-500/20 text-red-400":"text-slate-400 hover:text-red-400"}`,children:["Failed (",J,")"]})]})]}),e.jsxs("div",{className:"divide-y divide-light-border dark:divide-dark-border",children:[b.length>0&&e.jsxs("div",{className:"px-4 py-2 bg-light-hover dark:bg-dark-hover flex items-center gap-3 text-sm",children:[e.jsx("input",{type:"checkbox",checked:d.size===b.length&&b.length>0,onChange:B,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:d.size>0?`${d.size} selected`:"Select all"})]}),r&&s.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(M,{className:"w-8 h-8 text-slate-400 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"Loading tasks..."})]}):b.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(V,{className:"w-8 h-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"No tasks in queue"})]}):b.map(l=>{const i=l.task,P=he[l.status]||he.pending,z=f===i.id,A=a.find(m=>m.agent_id===l.assigned_agent_id);return e.jsxs("div",{className:"hover:bg-light-hover dark:hover:bg-dark-hover",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:d.has(i.id),onChange:()=>R(i.id),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("button",{onClick:()=>w(z?null:i.id),className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded",children:z?e.jsx(Le,{className:"w-4 h-4 text-slate-400"}):e.jsx(Me,{className:"w-4 h-4 text-slate-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white truncate",children:i.task_type}),e.jsxs(q,{variant:P.variant,size:"sm",children:[P.icon,e.jsx("span",{className:"ml-1",children:P.label})]}),e.jsxs(q,{variant:"secondary",size:"sm",children:["P",i.priority]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-3 h-3"}),i.targets.slice(0,3).join(", "),i.targets.length>3&&` +${i.targets.length-3}`]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),O(l.queued_at)]}),A&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),A.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[l.status==="failed"&&y&&e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>y(i.id),title:"Retry task",children:e.jsx(M,{className:"w-4 h-4"})}),C&&a.length>0&&(l.status==="pending"||l.status==="failed")&&e.jsxs("div",{className:"relative",children:[e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>u(h===i.id?null:i.id),title:"Reassign task",children:e.jsx(De,{className:"w-4 h-4"})}),h===i.id&&e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg shadow-lg py-1 z-10",children:a.filter(m=>m.status==="online"||m.status==="busy").map(m=>e.jsxs("button",{onClick:()=>{C(i.id,m.agent_id),u(null)},className:"w-full px-3 py-2 text-left text-sm text-slate-600 dark:text-slate-300 hover:bg-light-hover dark:hover:bg-dark-hover flex items-center gap-2",children:[e.jsx(F,{className:"w-3 h-3"}),m.name,e.jsx("span",{className:`ml-auto text-xs ${m.status==="online"?"text-green-400":"text-yellow-400"}`,children:m.status})]},m.agent_id))})]}),o&&(l.status==="pending"||l.status==="running")&&e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>o(i.id),className:"text-red-400 hover:text-red-300",title:"Cancel task",children:e.jsx(te,{className:"w-4 h-4"})})]})]}),z&&e.jsxs("div",{className:"px-4 pb-3 ml-12 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Scan ID"}),e.jsx("p",{className:"font-mono text-slate-900 dark:text-white text-xs",children:i.scan_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Timeout"}),e.jsxs("p",{className:"text-slate-900 dark:text-white",children:[i.timeout_seconds,"s"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Attempts"}),e.jsx("p",{className:"text-slate-900 dark:text-white",children:l.attempts})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Queued At"}),e.jsx("p",{className:"text-slate-900 dark:text-white",children:new Date(l.queued_at).toLocaleString()})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.required_capabilities.map(m=>e.jsx("span",{className:"text-xs px-2 py-1 bg-cyan-500/10 text-cyan-400 rounded",children:m},m)),i.required_zones.map(m=>e.jsx("span",{className:"text-xs px-2 py-1 bg-purple-500/10 text-purple-400 rounded",children:m},m))]}),l.last_error&&e.jsxs("div",{className:"p-2 bg-red-500/10 border border-red-500/20 rounded text-sm text-red-400",children:[e.jsx("strong",{children:"Error:"})," ",l.last_error]}),i.targets.length>3&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"All Targets:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:i.targets.map(m=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-slate-500/10 text-slate-400 rounded",children:m},m))})]})]})]},i.id)})]})]})},Re=({config:s,onChange:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Cluster Configuration"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Min Quorum Size"}),e.jsx("input",{type:"number",min:1,value:s.min_quorum_size??1,onChange:r=>a({...s,min_quorum_size:parseInt(r.target.value)||1}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Heartbeat Interval (secs)"}),e.jsx("input",{type:"number",min:1,value:s.heartbeat_interval_secs??10,onChange:r=>a({...s,heartbeat_interval_secs:parseInt(r.target.value)||10}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Peer Timeout (secs)"}),e.jsx("input",{type:"number",min:1,value:s.peer_timeout_secs??30,onChange:r=>a({...s,peer_timeout_secs:parseInt(r.target.value)||30}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Gossip Fanout"}),e.jsx("input",{type:"number",min:1,value:s.gossip_fanout??3,onChange:r=>a({...s,gossip_fanout:parseInt(r.target.value)||3}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Max Steal Batch"}),e.jsx("input",{type:"number",min:1,value:s.max_steal_batch??5,onChange:r=>a({...s,max_steal_batch:parseInt(r.target.value)||5}),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Registry URL (optional)"}),e.jsx("input",{type:"url",value:s.registry_url??"",onChange:r=>a({...s,registry_url:r.target.value||null}),placeholder:"https://heroforge.example.com",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.auto_elect_leader??!0,onChange:r=>a({...s,auto_elect_leader:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Auto Elect Leader"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enable_work_stealing??!0,onChange:r=>a({...s,enable_work_stealing:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Work Stealing"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enable_gossip??!0,onChange:r=>a({...s,enable_gossip:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Gossip Protocol"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enable_mdns??!0,onChange:r=>a({...s,enable_mdns:r.target.checked}),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"mDNS Discovery"})]})]})]}),Ke=({existingConfig:s,agentId:a,onSave:r,onCancel:o,isLoading:y=!1})=>{const[C,g]=_.useState((s==null?void 0:s.enabled)??!0),[x,d]=_.useState((s==null?void 0:s.mesh_port)??9876),[j,f]=_.useState((s==null?void 0:s.external_address)??""),[w,h]=_.useState((s==null?void 0:s.cluster_id)??""),[u,v]=_.useState((s==null?void 0:s.cluster_role)??"member"),N=b=>{b.preventDefault(),r(s?{enabled:C,mesh_port:x,external_address:j||void 0,cluster_id:w||void 0,cluster_role:u||void 0}:{agent_id:a,enabled:C,mesh_port:x,external_address:j||void 0,cluster_id:w||void 0})};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),s?"Edit Mesh Configuration":"Create Mesh Configuration"]}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-light-hover dark:hover:bg-dark-hover rounded",children:e.jsx(fe,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:N,className:"p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Basic Settings"]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:b=>g(b.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:"Enable Mesh Networking"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Allow this agent to participate in the mesh network"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Mesh Port"}),e.jsx("input",{type:"number",min:1,max:65535,value:x,onChange:b=>d(parseInt(b.target.value)||9876),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Default: 9876"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"External Address (optional)"}),e.jsx("input",{type:"text",value:j,onChange:b=>f(b.target.value),placeholder:"e.g., 10.0.0.5",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Override auto-detected address"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Cluster Settings"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Cluster ID (optional)"}),e.jsx("input",{type:"text",value:w,onChange:b=>h(b.target.value),placeholder:"Leave empty for standalone",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Cluster Role"}),e.jsxs("select",{value:u,onChange:b=>v(b.target.value),className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"leader",children:"Leader"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(k,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsxs(k,{type:"submit",loading:y,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Save Configuration"]})]})]})]})},ge=({onSubmit:s,onCancel:a,isLoading:r=!1,existingCluster:o})=>{const[y,C]=_.useState((o==null?void 0:o.name)??""),[g,x]=_.useState((o==null?void 0:o.description)??""),[d,j]=_.useState((o==null?void 0:o.config)??{}),f=w=>{w.preventDefault(),s({name:y,description:g||void 0,config:Object.keys(d).length>0?d:void 0})};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),o?"Edit Cluster":"Create New Cluster"]}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-light-hover dark:hover:bg-dark-hover rounded",children:e.jsx(fe,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:f,className:"p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Cluster Name *"}),e.jsx("input",{type:"text",value:y,onChange:w=>C(w.target.value),required:!0,placeholder:"e.g., Production Scanners",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:g,onChange:w=>x(w.target.value),rows:2,placeholder:"Describe the purpose of this cluster...",className:"w-full px-3 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]})]}),e.jsx(Re,{config:d,onChange:j}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(k,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsxs(k,{type:"submit",loading:r,disabled:!y.trim(),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),o?"Update Cluster":"Create Cluster"]})]})]})]})},c=Ee.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(s=>{const a=localStorage.getItem("token");return a&&(s.headers.Authorization=`Bearer ${a}`),s});const Ie=()=>c.get("/agents/mesh/dashboard"),Be=()=>c.get("/agents/mesh/work-stealing/stats"),Oe=s=>c.get("/agents/mesh/agents",{params:s}),Ue=s=>c.get(`/agents/mesh/agents/${s}`),We=s=>c.get(`/agents/mesh/agents/${s}/config`),He=s=>c.post("/agents/mesh/config",s),Ve=(s,a)=>c.patch(`/agents/mesh/agents/${s}/config`,a),Ye=s=>c.delete(`/agents/mesh/agents/${s}/config`),Ge=s=>c.get(`/agents/mesh/agents/${s}/peer-stats`),Je=s=>c.post(`/agents/mesh/agents/${s}/ping`),Ze=s=>c.delete(`/agents/mesh/agents/${s}`),Xe=s=>c.get("/agents/mesh/clusters",{params:s}),es=s=>c.get(`/agents/mesh/clusters/${s}`),ss=s=>c.post("/agents/mesh/clusters",s),ts=(s,a)=>c.patch(`/agents/mesh/clusters/${s}`,a),as=s=>c.delete(`/agents/mesh/clusters/${s}`),rs=s=>c.get(`/agents/mesh/clusters/${s}/config`),ls=(s,a)=>c.patch(`/agents/mesh/clusters/${s}/config`,a),ns=(s,a)=>c.post(`/agents/mesh/clusters/${s}/agents/${a}`),ds=(s,a)=>c.delete(`/agents/mesh/clusters/${s}/agents/${a}`),is=(s,a)=>c.post(`/agents/mesh/clusters/${s}/leader`,{agent_id:a}),cs=s=>c.post(`/agents/mesh/clusters/${s}/elect-leader`),os=s=>c.get("/agents/mesh/tasks",{params:s}),xs=s=>c.get(`/agents/mesh/tasks/${s}`),ms=s=>c.post(`/agents/mesh/tasks/${s}/cancel`),hs=s=>c.post(`/agents/mesh/tasks/${s}/retry`),us=(s,a)=>c.post(`/agents/mesh/tasks/${s}/reassign`,{agent_id:a}),gs=s=>c.post("/agents/mesh/tasks/bulk-cancel",{task_ids:s}),bs=()=>c.post("/agents/mesh/discovery/trigger"),ps=()=>c.get("/agents/mesh/discovery/status"),S={getDashboardStats:Ie,getWorkStealingStats:Be,listAgents:Oe,getAgent:Ue,getAgentMeshConfig:We,createMeshConfig:He,updateMeshConfig:Ve,deleteMeshConfig:Ye,getAgentPeerStats:Ge,pingAgent:Je,removeAgent:Ze,listClusters:Xe,getCluster:es,createCluster:ss,updateCluster:ts,deleteCluster:as,getClusterConfig:rs,updateClusterConfig:ls,addAgentToCluster:ns,removeAgentFromCluster:ds,setClusterLeader:is,triggerLeaderElection:cs,getTaskQueue:os,getTask:xs,cancelTask:ms,retryTask:hs,reassignTask:us,bulkCancelTasks:gs,triggerDiscovery:bs,getDiscoveryStatus:ps};function Cs(){var de,ie,ce;const[s,a]=_.useState("dashboard"),[r,o]=_.useState(!1),[y,C]=_.useState(null),[g,x]=_.useState(null),[d,j]=_.useState(null),[f,w]=_.useState(""),h=we(),{data:u,isLoading:v}=W({queryKey:["meshDashboardStats"],queryFn:()=>S.getDashboardStats().then(t=>t.data),refetchInterval:1e4}),{data:N,isLoading:b,refetch:T}=W({queryKey:["meshAgents"],queryFn:()=>S.listAgents().then(t=>t.data),refetchInterval:15e3}),{data:D,isLoading:I,refetch:J}=W({queryKey:["meshClusters"],queryFn:()=>S.listClusters().then(t=>t.data),refetchInterval:3e4}),{data:R,isLoading:B,refetch:Z}=W({queryKey:["meshTaskQueue"],queryFn:()=>S.getTaskQueue().then(t=>t.data),refetchInterval:5e3}),O=L({mutationFn:t=>S.createCluster(t).then($=>$.data),onSuccess:()=>{h.invalidateQueries({queryKey:["meshClusters"]}),h.invalidateQueries({queryKey:["meshDashboardStats"]}),p.success("Cluster created successfully"),o(!1)},onError:()=>{p.error("Failed to create cluster")}}),l=L({mutationFn:t=>S.deleteCluster(t),onSuccess:()=>{h.invalidateQueries({queryKey:["meshClusters"]}),h.invalidateQueries({queryKey:["meshDashboardStats"]}),p.success("Cluster deleted"),x(null)},onError:()=>{p.error("Failed to delete cluster")}}),i=L({mutationFn:t=>S.pingAgent(t).then($=>$.data),onSuccess:t=>{p.success(`Agent responded in ${t.latency_ms}ms`),h.invalidateQueries({queryKey:["meshAgents"]})},onError:()=>{p.error("Agent did not respond")}}),P=L({mutationFn:t=>S.removeAgent(t),onSuccess:()=>{h.invalidateQueries({queryKey:["meshAgents"]}),h.invalidateQueries({queryKey:["meshDashboardStats"]}),p.success("Agent removed from mesh")},onError:()=>{p.error("Failed to remove agent")}}),z=L({mutationFn:t=>S.cancelTask(t),onSuccess:()=>{h.invalidateQueries({queryKey:["meshTaskQueue"]}),p.success("Task cancelled")},onError:()=>{p.error("Failed to cancel task")}}),A=L({mutationFn:t=>S.retryTask(t),onSuccess:()=>{h.invalidateQueries({queryKey:["meshTaskQueue"]}),p.success("Task queued for retry")},onError:()=>{p.error("Failed to retry task")}}),m=L({mutationFn:()=>S.triggerDiscovery(),onSuccess:()=>{p.success("Discovery triggered"),setTimeout(()=>{h.invalidateQueries({queryKey:["meshAgents"]})},2e3)},onError:()=>{p.error("Failed to trigger discovery")}}),Ne=L({mutationFn:t=>S.triggerLeaderElection(t),onSuccess:()=>{h.invalidateQueries({queryKey:["meshClusters"]}),p.success("Leader election triggered")},onError:()=>{p.error("Failed to trigger leader election")}}),re=L({mutationFn:({agentId:t,config:$})=>S.updateMeshConfig(t,$),onSuccess:()=>{h.invalidateQueries({queryKey:["meshAgents"]}),h.invalidateQueries({queryKey:["meshDashboardStats"]}),p.success("Agent configuration saved"),C(null)},onError:()=>{p.error("Failed to save agent configuration")}}),le=L({mutationFn:({clusterId:t,data:$})=>S.updateCluster(t,$),onSuccess:()=>{h.invalidateQueries({queryKey:["meshClusters"]}),h.invalidateQueries({queryKey:["meshDashboardStats"]}),p.success("Cluster updated"),j(null)},onError:()=>{p.error("Failed to update cluster")}}),E=(N==null?void 0:N.agents)||[],Q=(D==null?void 0:D.clusters)||[],U=(R==null?void 0:R.tasks)||[],ne=E.filter(t=>t.name.toLowerCase().includes(f.toLowerCase())||t.address.toLowerCase().includes(f.toLowerCase())),ye=[{id:"dashboard",label:"Dashboard",icon:e.jsx(Y,{className:"w-4 h-4"})},{id:"agents",label:"Agents",icon:e.jsx(F,{className:"w-4 h-4"}),count:E.length},{id:"clusters",label:"Clusters",icon:e.jsx(K,{className:"w-4 h-4"}),count:Q.length},{id:"tasks",label:"Task Queue",icon:e.jsx(Fe,{className:"w-4 h-4"}),count:U.length}],n=u;return e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3",children:[e.jsx(G,{className:"w-8 h-8 text-cyan-400"}),"Distributed Scanning Mesh"]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Manage distributed scanning agents, clusters, and task distribution"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",onClick:()=>m.mutate(),disabled:m.isPending,children:[e.jsx(oe,{className:`w-4 h-4 mr-2 ${m.isPending?"animate-pulse":""}`}),"Discover Peers"]}),e.jsxs(k,{onClick:()=>o(!0),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"New Cluster"]})]})]}),e.jsx("div",{className:"border-b border-light-border dark:border-dark-border",children:e.jsx("nav",{className:"flex gap-4",children:ye.map(t=>e.jsxs("button",{onClick:()=>a(t.id),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${s===t.id?"border-cyan-500 text-cyan-400":"border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:[t.icon,t.label,t.count!==void 0&&e.jsx(q,{variant:"secondary",size:"sm",children:t.count})]},t.id))})}),s==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Total Agents"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:(n==null?void 0:n.total_agents)??0}),e.jsxs("div",{className:"mt-2 flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-green-400",children:[(n==null?void 0:n.online_agents)??0," online"]}),e.jsxs("span",{className:"text-yellow-400",children:[(n==null?void 0:n.busy_agents)??0," busy"]}),e.jsxs("span",{className:"text-slate-400",children:[(n==null?void 0:n.offline_agents)??0," offline"]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Clusters"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:(n==null?void 0:n.total_clusters)??0}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Avg load: ",Math.round(((n==null?void 0:n.average_cluster_load)??0)*100),"%"]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Tasks"]}),e.jsxs("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:[(n==null?void 0:n.total_tasks_running)??0,e.jsxs("span",{className:"text-lg font-normal text-slate-400",children:["/",(n==null?void 0:n.total_tasks_queued)??0]})]}),e.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"running / queued"})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Work Stealing"]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:((de=n==null?void 0:n.work_stealing_stats)==null?void 0:de.tasks_delegated)??0}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("span",{className:"text-cyan-400",children:[((ie=n==null?void 0:n.work_stealing_stats)==null?void 0:ie.tasks_stolen)??0," stolen"]}),e.jsx("span",{className:"text-slate-400 mx-1",children:"|"}),e.jsxs("span",{className:"text-red-400",children:[((ce=n==null?void 0:n.work_stealing_stats)==null?void 0:ce.delegation_failures)??0," failed"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Online Agents"}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>a("agents"),children:"View All"})]}),e.jsx("div",{className:"p-4 grid gap-3",children:b?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(M,{className:"w-6 h-6 text-slate-400 animate-spin"})}):E.filter(t=>t.status==="online").length===0?e.jsx("div",{className:"text-center py-4 text-slate-400",children:"No online agents"}):E.filter(t=>t.status==="online").slice(0,3).map(t=>e.jsx(me,{agent:t,showActions:!1,onClick:()=>{C(t.agent_id),a("agents")}},t.agent_id))})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-light-border dark:border-dark-border flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Clusters"}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>a("clusters"),children:"View All"})]}),e.jsx("div",{className:"p-4 space-y-3",children:I?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(M,{className:"w-6 h-6 text-slate-400 animate-spin"})}):Q.length===0?e.jsxs("div",{className:"text-center py-4 text-slate-400",children:[e.jsx(K,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No clusters configured"}),e.jsx(k,{size:"sm",className:"mt-2",onClick:()=>o(!0),children:"Create Cluster"})]}):Q.slice(0,2).map(t=>e.jsxs("div",{className:"p-3 bg-light-hover dark:bg-dark-hover rounded-lg cursor-pointer hover:ring-1 ring-primary/50",onClick:()=>{x(t),a("clusters")},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:t.name}),e.jsx(q,{variant:"success",size:"sm",children:"Active"})]}),t.description&&e.jsx("p",{className:"text-sm text-slate-400 mt-1 line-clamp-1",children:t.description})]},t.id))})]})]}),U.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-4",children:"Recent Tasks"}),e.jsx(ue,{tasks:U.slice(0,5),agents:E,isLoading:B,onCancelTask:t=>z.mutate(t),onRetryTask:t=>A.mutate(t)})]})]}),s==="agents"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search agents...",value:f,onChange:t=>w(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50"})]}),e.jsxs(k,{variant:"outline",onClick:()=>T(),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 text-slate-400 animate-spin"})}):ne.length===0?e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(F,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No Agents Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:f?"No agents match your search query":"No agents are connected to the mesh network"}),e.jsxs(k,{variant:"outline",onClick:()=>m.mutate(),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Discover Peers"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ne.map(t=>e.jsx(me,{agent:t,isLeader:Q.some($=>$.leader_agent_id===t.agent_id),onPing:()=>i.mutate(t.agent_id),onRemove:()=>{confirm(`Remove agent "${t.name}" from the mesh?`)&&P.mutate(t.agent_id)},onClick:()=>C(t.agent_id)},t.agent_id))}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsx(Ke,{agentId:y,existingConfig:void 0,onSave:t=>{re.mutate({agentId:y,config:t})},onCancel:()=>C(null),isLoading:re.isPending})})})]}),s==="clusters"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white",children:["Clusters (",Q.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",onClick:()=>J(),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(k,{onClick:()=>o(!0),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"New Cluster"]})]})]}),I?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 text-slate-400 animate-spin"})}):Q.length===0?e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(K,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No Clusters"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Create a cluster to group agents and enable distributed task scheduling"}),e.jsxs(k,{onClick:()=>o(!0),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Create Your First Cluster"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Q.map(t=>e.jsx(qe,{cluster:t,onViewDetails:()=>x(t),onEditConfig:()=>j(t),onDelete:()=>{confirm(`Delete cluster "${t.name}"? Agents will be removed from the cluster.`)&&l.mutate(t.id)},onElectLeader:()=>Ne.mutate(t.id)},t.id))})]}),s==="tasks"&&e.jsx(ue,{tasks:U,agents:E,isLoading:B,onCancelTask:t=>z.mutate(t),onRetryTask:t=>A.mutate(t),onReassignTask:(t,$)=>{S.reassignTask(t,$).then(()=>{h.invalidateQueries({queryKey:["meshTaskQueue"]}),p.success("Task reassigned")}).catch(()=>{p.error("Failed to reassign task")})},onBulkCancel:t=>{S.bulkCancelTasks(t).then(()=>{h.invalidateQueries({queryKey:["meshTaskQueue"]}),p.success(`${t.length} tasks cancelled`)}).catch(()=>{p.error("Failed to cancel tasks")})},onRefresh:()=>Z()}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsx(ge,{onSubmit:t=>O.mutate(t),onCancel:()=>o(!1),isLoading:O.isPending})})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsx(ge,{existingCluster:{name:d.name,description:d.description,config:d.config},onSubmit:t=>{le.mutate({clusterId:d.id,data:{name:t.name,description:t.description}})},onCancel:()=>j(null),isLoading:le.isPending})})})]})})}export{Cs as default};
