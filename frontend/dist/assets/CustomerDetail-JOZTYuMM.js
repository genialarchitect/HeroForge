import{j as e}from"./vendor-state-DdX3IZQk.js";import{j as B,u as I,r as c,L as D}from"./vendor-react-Da1CiaFS.js";import{T as h,d as P}from"./index-B8rNv6iC.js";import"./vendor-ui-BHPtL6kl.js";import"./vendor-charts-DdTkGt7c.js";function Y(){const{id:t}=B(),o=I(),[a,y]=c.useState(null),[m,n]=c.useState([]),[r,x]=c.useState([]),[u,j]=c.useState([]),[i,d]=c.useState([]),[l,N]=c.useState(null),[v,f]=c.useState([]),[b,A]=c.useState("overview"),[$,C]=c.useState(!0),[S,s]=c.useState(null);c.useEffect(()=>{t&&g()},[t]);const g=async()=>{if(t)try{C(!0);const[p,_,E,U,T,R,F]=await Promise.all([h.customers.getById(t),h.contacts.getByCustomer(t),h.engagements.getByCustomer(t),h.contracts.getByCustomer(t),h.communications.getByCustomer(t),h.sla.getByCustomer(t),h.portalUsers.getByCustomer(t)]);y(p.data),n(_.data),x(E.data),j(U.data),d(T.data),N(R.data),f(F.data)}catch(p){const _=p instanceof Error?p.message:"Failed to load customer";s(_)}finally{C(!1)}},w=async()=>{if(!(!t||!a)&&confirm(`Are you sure you want to delete ${a.name}? This will also delete all related data.`))try{await h.customers.delete(t),o("/crm/customers")}catch(p){const _=p instanceof Error?p.message:"Failed to delete customer";s(_)}},L=p=>{switch(p){case"active":case"completed":return"bg-green-100 text-green-800";case"inactive":case"cancelled":return"bg-gray-100 text-gray-800";case"prospect":case"planning":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"on_hold":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};if($)return e.jsx(P,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})})});if(S||!a)return e.jsx(P,{children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-red-800",children:S||"Customer not found"}),e.jsx(D,{to:"/crm/customers",className:"mt-2 text-red-600 hover:text-red-800",children:"Back to Customers"})]})});const k=[{id:"overview",label:"Overview"},{id:"contacts",label:`Contacts (${m.length})`},{id:"engagements",label:`Engagements (${r.length})`},{id:"contracts",label:`Contracts (${u.length})`},{id:"communications",label:`Activity (${i.length})`},{id:"sla",label:"SLA"},{id:"portal-users",label:`Portal Users (${v.length})`}];return e.jsx(P,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl text-indigo-600 font-bold",children:a.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a.name}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${L(a.status)}`,children:a.status}),a.industry&&e.jsx("span",{className:"text-sm text-gray-500",children:a.industry}),a.company_size&&e.jsx("span",{className:"text-sm text-gray-500",children:a.company_size.charAt(0).toUpperCase()+a.company_size.slice(1)})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(D,{to:`/dashboard?customer=${a.id}`,className:"px-4 py-2 text-sm font-medium text-indigo-600 border border-indigo-600 rounded-md hover:bg-indigo-50",children:"New Scan"}),e.jsx("button",{onClick:w,className:"px-4 py-2 text-sm font-medium text-red-600 border border-red-300 rounded-md hover:bg-red-50",children:"Delete"})]})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:k.map(p=>e.jsx("button",{onClick:()=>A(p.id),className:`py-4 px-1 border-b-2 font-medium text-sm ${b===p.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:p.label},p.id))})}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[b==="overview"&&e.jsx(q,{customer:a,engagements:r,contracts:u}),b==="contacts"&&e.jsx(z,{customerId:a.id,contacts:m,onUpdate:g}),b==="engagements"&&e.jsx(O,{customerId:a.id,engagements:r,onUpdate:g}),b==="contracts"&&e.jsx(H,{contracts:u}),b==="communications"&&e.jsx(M,{customerId:a.id,communications:i,contacts:m,onUpdate:g}),b==="sla"&&e.jsx(V,{sla:l}),b==="portal-users"&&e.jsx(W,{customerId:a.id,portalUsers:v,contacts:m,onUpdate:g})]})]})})}function q({customer:t,engagements:o,contracts:a}){const y=o.filter(n=>n.status==="in_progress"),m=a.reduce((n,r)=>n+(r.value||0),0);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Customer Details"}),e.jsxs("dl",{className:"space-y-3",children:[t.website&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Website"}),e.jsx("dd",{className:"mt-1",children:e.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:text-indigo-800",children:t.website})})]}),t.address&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Address"}),e.jsx("dd",{className:"mt-1 text-gray-900",children:t.address})]}),t.notes&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Notes"}),e.jsx("dd",{className:"mt-1 text-gray-900 whitespace-pre-wrap",children:t.notes})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Created"}),e.jsx("dd",{className:"mt-1 text-gray-900",children:new Date(t.created_at).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Active Engagements"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y.length})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Engagements"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:o.length})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Contracts"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:a.length})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Contract Value"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:["$",m.toLocaleString()]})]})]})]})]})}function z({customerId:t,contacts:o,onUpdate:a}){const[y,m]=c.useState(!1),[n,r]=c.useState({first_name:"",last_name:"",email:"",phone:"",title:"",is_primary:!1}),[x,u]=c.useState(!1),j=async i=>{i.preventDefault();try{u(!0),await h.contacts.create(t,n),m(!1),r({first_name:"",last_name:"",email:"",phone:"",title:"",is_primary:!1}),a()}catch(d){console.error("Failed to add contact:",d)}finally{u(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Contacts"}),e.jsx("button",{onClick:()=>m(!0),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"+ Add Contact"})]}),y&&e.jsxs("form",{onSubmit:j,className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:"First Name *",value:n.first_name,onChange:i=>r({...n,first_name:i.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",required:!0}),e.jsx("input",{type:"text",placeholder:"Last Name *",value:n.last_name,onChange:i=>r({...n,last_name:i.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",required:!0}),e.jsx("input",{type:"email",placeholder:"Email",value:n.email||"",onChange:i=>r({...n,email:i.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white"}),e.jsx("input",{type:"tel",placeholder:"Phone",value:n.phone||"",onChange:i=>r({...n,phone:i.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white"}),e.jsx("input",{type:"text",placeholder:"Title",value:n.title||"",onChange:i=>r({...n,title:i.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white"}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:n.is_primary||!1,onChange:i=>r({...n,is_primary:i.target.checked}),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Primary Contact"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:x,className:"px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 disabled:opacity-50",children:x?"Adding...":"Add"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-3 py-1 text-gray-600 hover:text-gray-800 text-sm",children:"Cancel"})]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:o.length===0?e.jsx("p",{className:"text-gray-500 py-4",children:"No contacts yet."}):o.map(i=>e.jsx("div",{className:"py-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[i.first_name," ",i.last_name,i.is_primary&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-indigo-100 text-indigo-800 rounded",children:"Primary"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:i.title}),e.jsxs("div",{className:"flex space-x-4 mt-1 text-sm text-gray-500",children:[i.email&&e.jsx("span",{children:i.email}),i.phone&&e.jsx("span",{children:i.phone})]})]})},i.id))})]})}function O({customerId:t,engagements:o,onUpdate:a}){const[y,m]=c.useState(!1),[n,r]=c.useState({name:"",engagement_type:"pentest",status:"planning"}),[x,u]=c.useState(!1),j=async d=>{d.preventDefault();try{u(!0),await h.engagements.create(t,n),m(!1),r({name:"",engagement_type:"pentest",status:"planning"}),a()}catch(l){console.error("Failed to add engagement:",l)}finally{u(!1)}},i=d=>{switch(d){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-blue-100 text-blue-800";case"planning":return"bg-yellow-100 text-yellow-800";case"on_hold":return"bg-orange-100 text-orange-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Engagements"}),e.jsx("button",{onClick:()=>m(!0),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"+ New Engagement"})]}),y&&e.jsxs("form",{onSubmit:j,className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Engagement Name *",value:n.name,onChange:d=>r({...n,name:d.target.value}),className:"w-full rounded-md border-gray-300 text-sm text-gray-900 bg-white",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("select",{value:n.engagement_type,onChange:d=>r({...n,engagement_type:d.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"pentest",children:"Penetration Test"}),e.jsx("option",{value:"vuln_assessment",children:"Vulnerability Assessment"}),e.jsx("option",{value:"red_team",children:"Red Team"}),e.jsx("option",{value:"compliance_audit",children:"Compliance Audit"}),e.jsx("option",{value:"consulting",children:"Consulting"})]}),e.jsxs("select",{value:n.status,onChange:d=>r({...n,status:d.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:x,className:"px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 disabled:opacity-50",children:x?"Creating...":"Create"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-3 py-1 text-gray-600 hover:text-gray-800 text-sm",children:"Cancel"})]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:o.length===0?e.jsx("p",{className:"text-gray-500 py-4",children:"No engagements yet."}):o.map(d=>e.jsxs("div",{className:"py-4 flex items-center justify-between -mx-2 px-2 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:d.engagement_type.replace("_"," ")}),d.start_date&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Started: ",new Date(d.start_date).toLocaleDateString()]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${i(d.status)}`,children:d.status.replace("_"," ")})})]},d.id))})]})}function H({contracts:t}){const o=a=>{switch(a){case"active":return"bg-green-100 text-green-800";case"expired":case"terminated":return"bg-red-100 text-red-800";case"pending_signature":return"bg-yellow-100 text-yellow-800";case"draft":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Contracts"}),e.jsx("div",{className:"divide-y divide-gray-200",children:t.length===0?e.jsx("p",{className:"text-gray-500 py-4",children:"No contracts yet."}):t.map(a=>e.jsxs("div",{className:"py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 uppercase",children:a.contract_type})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a.value&&e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",a.value.toLocaleString()]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${o(a.status)}`,children:a.status.replace("_"," ")})]})]},a.id))})]})}function M({customerId:t,communications:o,contacts:a,onUpdate:y}){const[m,n]=c.useState(!1),[r,x]=c.useState({comm_type:"note",subject:"",content:"",comm_date:new Date().toISOString().split("T")[0]}),[u,j]=c.useState(!1),i=async l=>{l.preventDefault();try{j(!0),await h.communications.create(t,r),n(!1),x({comm_type:"note",subject:"",content:"",comm_date:new Date().toISOString().split("T")[0]}),y()}catch(N){console.error("Failed to add communication:",N)}finally{j(!1)}},d=l=>{switch(l){case"email":return"ðŸ“§";case"call":return"ðŸ“ž";case"meeting":return"ðŸ¤";case"note":return"ðŸ“";default:return"ðŸ’¬"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Activity Log"}),e.jsx("button",{onClick:()=>n(!0),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"+ Log Activity"})]}),m&&e.jsxs("form",{onSubmit:i,className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("select",{value:r.comm_type,onChange:l=>x({...r,comm_type:l.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"note",children:"Note"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"call",children:"Call"}),e.jsx("option",{value:"meeting",children:"Meeting"})]}),e.jsx("input",{type:"date",value:r.comm_date,onChange:l=>x({...r,comm_date:l.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white"})]}),e.jsx("input",{type:"text",placeholder:"Subject",value:r.subject||"",onChange:l=>x({...r,subject:l.target.value}),className:"w-full rounded-md border-gray-300 text-sm text-gray-900 bg-white"}),e.jsx("textarea",{placeholder:"Content",value:r.content||"",onChange:l=>x({...r,content:l.target.value}),rows:3,className:"w-full rounded-md border-gray-300 text-sm text-gray-900 bg-white"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:u,className:"px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 disabled:opacity-50",children:u?"Adding...":"Add"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-3 py-1 text-gray-600 hover:text-gray-800 text-sm",children:"Cancel"})]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:o.length===0?e.jsx("p",{className:"text-gray-500 py-4",children:"No activity logged yet."}):o.map(l=>e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("span",{className:"text-xl",children:d(l.comm_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.subject||`${l.comm_type.charAt(0).toUpperCase()+l.comm_type.slice(1)} logged`}),l.content&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 whitespace-pre-wrap",children:l.content}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(l.comm_date).toLocaleDateString()})]})]})},l.id))})]})}function V({sla:t}){return t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),t.description&&e.jsx("p",{className:"text-gray-600",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Response Times"}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Critical"}),e.jsx("dd",{className:"text-sm font-medium",children:t.response_time_critical?`${t.response_time_critical} min`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"High"}),e.jsx("dd",{className:"text-sm font-medium",children:t.response_time_high?`${t.response_time_high} min`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Medium"}),e.jsx("dd",{className:"text-sm font-medium",children:t.response_time_medium?`${t.response_time_medium} min`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Low"}),e.jsx("dd",{className:"text-sm font-medium",children:t.response_time_low?`${t.response_time_low} min`:"-"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Resolution Times"}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Critical"}),e.jsx("dd",{className:"text-sm font-medium",children:t.resolution_time_critical?`${t.resolution_time_critical} min`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"High"}),e.jsx("dd",{className:"text-sm font-medium",children:t.resolution_time_high?`${t.resolution_time_high} min`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Medium"}),e.jsx("dd",{className:"text-sm font-medium",children:t.resolution_time_medium?`${t.resolution_time_medium} min`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Low"}),e.jsx("dd",{className:"text-sm font-medium",children:t.resolution_time_low?`${t.resolution_time_low} min`:"-"})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:"No SLA defined for this customer."}),e.jsx("button",{className:"mt-4 text-sm text-indigo-600 hover:text-indigo-800",children:"+ Set SLA"})]})}function W({customerId:t,portalUsers:o,contacts:a,onUpdate:y}){const[m,n]=c.useState(!1),[r,x]=c.useState({email:"",password:"",contact_id:void 0}),[u,j]=c.useState(!1),[i,d]=c.useState(null),[l,N]=c.useState(null),[v,f]=c.useState(""),b=async s=>{s.preventDefault(),d(null);try{j(!0),await h.portalUsers.create(t,r),n(!1),x({email:"",password:"",contact_id:void 0}),y()}catch(g){const w=g instanceof Error?g.message:"Failed to create portal user";d(w)}finally{j(!1)}},A=async s=>{try{s.is_active?await h.portalUsers.deactivate(t,s.id):await h.portalUsers.activate(t,s.id),y()}catch(g){console.error("Failed to toggle user status:",g)}},$=async s=>{if(confirm(`Are you sure you want to delete portal user ${s.email}?`))try{await h.portalUsers.delete(t,s.id),y()}catch(g){console.error("Failed to delete portal user:",g)}},C=async s=>{if(s.preventDefault(),!!l)try{j(!0),await h.portalUsers.resetPassword(t,l,{new_password:v}),N(null),f(""),alert("Password reset successfully")}catch(g){console.error("Failed to reset password:",g),alert("Failed to reset password")}finally{j(!1)}},S=s=>{if(!s)return null;const g=a.find(w=>w.id===s);return g?`${g.first_name} ${g.last_name}`:null};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Portal Users"}),e.jsx("button",{onClick:()=>n(!0),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"+ Add Portal User"})]}),i&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-800",children:i})}),m&&e.jsxs("form",{onSubmit:b,className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"email",placeholder:"Email *",value:r.email,onChange:s=>x({...r,email:s.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",required:!0}),e.jsx("input",{type:"password",placeholder:"Password * (min 8 chars)",value:r.password,onChange:s=>x({...r,password:s.target.value}),className:"rounded-md border-gray-300 text-sm text-gray-900 bg-white",required:!0,minLength:8})]}),e.jsxs("select",{value:r.contact_id||"",onChange:s=>x({...r,contact_id:s.target.value||void 0}),className:"w-full rounded-md border-gray-300 text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Link to contact (optional)"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name," ",s.email?`(${s.email})`:""]},s.id))]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:u,className:"px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 disabled:opacity-50",children:u?"Creating...":"Create User"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),d(null)},className:"px-3 py-1 text-gray-600 hover:text-gray-800 text-sm",children:"Cancel"})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Reset Password"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("input",{type:"password",placeholder:"New Password (min 8 chars)",value:v,onChange:s=>f(s.target.value),className:"w-full rounded-md border-gray-300 text-sm text-gray-900 bg-white",required:!0,minLength:8}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>{N(null),f("")},className:"px-4 py-2 text-gray-600 hover:text-gray-800 text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 disabled:opacity-50",children:u?"Resetting...":"Reset Password"})]})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:o.length===0?e.jsx("p",{className:"text-gray-500 py-4",children:"No portal users yet. Create one to allow customer access to the portal."}):o.map(s=>e.jsxs("div",{className:"py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.email}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.is_active?"Active":"Inactive"})]}),s.contact_id&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Linked to: ",S(s.contact_id)||s.contact_id]}),s.first_name&&e.jsxs("p",{className:"text-sm text-gray-500",children:[s.first_name," ",s.last_name," ",s.title?`- ${s.title}`:""]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Created: ",new Date(s.created_at).toLocaleDateString(),s.last_login&&` | Last login: ${new Date(s.last_login).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>A(s),className:`px-2 py-1 text-xs rounded ${s.is_active?"text-orange-600 border border-orange-300 hover:bg-orange-50":"text-green-600 border border-green-300 hover:bg-green-50"}`,children:s.is_active?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>N(s.id),className:"px-2 py-1 text-xs text-indigo-600 border border-indigo-300 rounded hover:bg-indigo-50",children:"Reset Password"}),e.jsx("button",{onClick:()=>$(s),className:"px-2 py-1 text-xs text-red-600 border border-red-300 rounded hover:bg-red-50",children:"Delete"})]})]},s.id))})]})}export{Y as default};
