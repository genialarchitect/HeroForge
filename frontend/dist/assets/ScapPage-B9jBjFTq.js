import{b as D,u as S,d as T,j as e}from"./vendor-state-BjT_zREg.js";import{r as c}from"./vendor-react-5KxtEOLM.js";import{B as y,S as R,b1 as F,bg as _,x as k,y as q,F as E,aY as $,ab as M,a6 as O,aN as K,i as Q,g as V,a9 as B,p as X}from"./vendor-ui-C4nf_tR6.js";import{N as p}from"./index-RI0GBk2h.js";import{L as z}from"./Layout-DQwy8A8G.js";import{A as I}from"./AcasNavigation-8WwwDinJ.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const h={listContent:()=>p.get("/api/scap/content").then(t=>t.data),getContent:t=>p.get(`/api/scap/content/${t}`).then(a=>a.data),uploadContent:t=>p.post("/api/scap/content/upload",t).then(a=>a.data),deleteContent:t=>p.delete(`/api/scap/content/${t}`).then(a=>a.data),getProfiles:t=>p.get(`/api/scap/content/${t}/profiles`).then(a=>a.data),runScan:t=>p.post("/api/scap/execute",t).then(a=>a.data),listExecutions:()=>p.get("/api/scap/executions").then(t=>t.data),getExecution:t=>p.get(`/api/scap/executions/${t}`).then(a=>a.data),downloadArf:t=>p.get(`/api/scap/executions/${t}/arf`,{responseType:"blob"}).then(a=>a.data)},H=({status:t})=>{const a={pending:{bg:"bg-gray-700 text-gray-300",icon:e.jsx(X,{className:"w-3 h-3"})},running:{bg:"bg-blue-900/50 text-blue-400",icon:e.jsx(B,{className:"w-3 h-3 animate-spin"})},completed:{bg:"bg-green-900/50 text-green-400",icon:e.jsx(V,{className:"w-3 h-3"})},failed:{bg:"bg-red-900/50 text-red-400",icon:e.jsx(Q,{className:"w-3 h-3"})}},r=a[t]||a.pending;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs ${r.bg}`,children:[r.icon,t.charAt(0).toUpperCase()+t.slice(1)]})},Y=({type:t})=>{const a={xccdf:"bg-purple-900/50 text-purple-400",oval:"bg-cyan-900/50 text-cyan-400",datastream:"bg-amber-900/50 text-amber-400",cpe:"bg-pink-900/50 text-pink-400"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs ${a[t]||"bg-gray-700"}`,children:t.toUpperCase()})},G=({isOpen:t,onClose:a,onSuccess:r})=>{const[d,x]=c.useState(null),[u,m]=c.useState(!1),g=async()=>{var i,n;if(d){m(!0);try{const o=new FormData;o.append("file",d),await h.uploadContent(o),y.success("SCAP content uploaded successfully"),r(),a()}catch(o){y.error(((n=(i=o.response)==null?void 0:i.data)==null?void 0:n.error)||"Upload failed")}finally{m(!1)}}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100 mb-4",children:"Upload SCAP Content"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:".xml,.zip",onChange:i=>{var n;return x(((n=i.target.files)==null?void 0:n[0])||null)},className:"hidden",id:"scap-upload"}),e.jsxs("label",{htmlFor:"scap-upload",className:"cursor-pointer",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-400",children:d?d.name:"Click to select XCCDF, OVAL, or Data Stream file"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:g,disabled:!d||u,className:"px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 disabled:opacity-50",children:u?"Uploading...":"Upload"})]})]})]})}):null},J=({isOpen:t,onClose:a,content:r,onSuccess:d})=>{const[x,u]=c.useState(""),[m,g]=c.useState(""),[i,n]=c.useState(!1),{data:o}=S({queryKey:["scap-profiles",r==null?void 0:r.id],queryFn:()=>r?h.getProfiles(r.id):Promise.resolve([]),enabled:!!r}),j=async()=>{var l,b;if(!(!r||!x)){n(!0);try{await h.runScan({content_id:r.id,target:x,profile_id:m||void 0}),y.success("SCAP scan started"),d(),a()}catch(f){y.error(((b=(l=f.response)==null?void 0:l.data)==null?void 0:b.error)||"Failed to start scan")}finally{n(!1)}}};return!t||!r?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100 mb-4",children:"Run SCAP Scan"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Content"}),e.jsx("p",{className:"text-gray-200",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Target Host"}),e.jsx("input",{type:"text",value:x,onChange:l=>u(l.target.value),placeholder:"192.168.1.100 or hostname",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),o&&o.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Profile"}),e.jsxs("select",{value:m,onChange:l=>g(l.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"Default Profile"}),o.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:!x||i,className:"px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 disabled:opacity-50",children:i?"Starting...":"Start Scan"})]})]})]})})},ne=()=>{const t=D(),[a,r]=c.useState("content"),[d,x]=c.useState(!1),[u,m]=c.useState(!1),[g,i]=c.useState(null),[n,o]=c.useState(""),[j,l]=c.useState(""),{data:b=[],isLoading:f}=S({queryKey:["scap-content"],queryFn:h.listContent}),{data:v=[],isLoading:P}=S({queryKey:["scap-executions"],queryFn:h.listExecutions,refetchInterval:1e4}),U=T({mutationFn:h.deleteContent,onSuccess:()=>{t.invalidateQueries({queryKey:["scap-content"]}),y.success("Content deleted")},onError:()=>y.error("Failed to delete content")}),A=b.filter(s=>{const C=s.name.toLowerCase().includes(n.toLowerCase()),N=!j||s.content_type===j;return C&&N}),L=async s=>{try{const C=await h.downloadArf(s),N=window.URL.createObjectURL(C),w=document.createElement("a");w.href=N,w.download=`scap_result_${s}.xml`,w.click(),window.URL.revokeObjectURL(N)}catch{y.error("Failed to download ARF")}};return e.jsx(z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-8 h-8 text-cyan-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"SCAP Compliance Scanner"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Security Content Automation Protocol assessment and reporting"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500",children:[e.jsx(F,{className:"w-4 h-4"}),"Upload Content"]})]}),e.jsx("div",{className:"border-b border-gray-700",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>r("content"),className:`px-4 py-2 border-b-2 transition-colors ${a==="content"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Content Library (",b.length,")"]})}),e.jsx("button",{onClick:()=>r("executions"),className:`px-4 py-2 border-b-2 transition-colors ${a==="executions"?"border-cyan-500 text-cyan-400":"border-transparent text-gray-400 hover:text-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Scan History (",v.length,")"]})})]})}),a==="content"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:s=>o(s.target.value),placeholder:"Search content...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("select",{value:j,onChange:s=>l(s.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded text-gray-200 focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"xccdf",children:"XCCDF"}),e.jsx("option",{value:"oval",children:"OVAL"}),e.jsx("option",{value:"datastream",children:"Data Stream"}),e.jsx("option",{value:"cpe",children:"CPE"})]})]}),f?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading..."}):A.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-4 text-gray-600"}),e.jsx("p",{className:"text-gray-400",children:"No SCAP content found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Upload XCCDF, OVAL, or SCAP Data Stream files to get started"})]}):e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Version"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Rules"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Uploaded"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:A.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-gray-200",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.description})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Y,{type:s.content_type})}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:s.version||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:s.rule_count||s.definition_count||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>{i(s),m(!0)},className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"Run Scan",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U.mutate(s.id),className:"p-2 text-gray-400 hover:text-red-400 rounded",title:"Delete",children:e.jsx(M,{className:"w-4 h-4"})})]})})]},s.id))})]})})]}),a==="executions"&&e.jsx("div",{className:"space-y-4",children:P?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading..."}):v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-gray-600"}),e.jsx("p",{className:"text-gray-400",children:"No scan history"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Run a SCAP scan to see results here"})]}):e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Target"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Pass"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Fail"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Started"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:v.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-200",children:s.target}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(H,{status:s.status})}),e.jsx("td",{className:"px-4 py-3 text-green-400",children:s.pass_count??"-"}),e.jsx("td",{className:"px-4 py-3 text-red-400",children:s.fail_count??"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.started_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>L(s.id),className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"Download ARF Report",disabled:s.status!=="completed",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"View Details",children:e.jsx(K,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),e.jsx(G,{isOpen:d,onClose:()=>x(!1),onSuccess:()=>t.invalidateQueries({queryKey:["scap-content"]})}),e.jsx(J,{isOpen:u,onClose:()=>{m(!1),i(null)},content:g,onSuccess:()=>t.invalidateQueries({queryKey:["scap-executions"]})})]})})};export{ne as default};
