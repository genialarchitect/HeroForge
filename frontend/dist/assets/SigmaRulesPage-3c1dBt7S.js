import{b as Te,u as j,d as u,j as e}from"./vendor-state-DdX3IZQk.js";import{r}from"./vendor-react-Da1CiaFS.js";import{_ as ne,aK as Le,P as ie,x as ce,bi as Fe,T as Me,cb as Pe,J as de,d as Ee,ay as Ae,bc as oe,aJ as xe,aA as De,az as me,Z as Ke,au as P,aw as ze,B as i,aj as Qe}from"./vendor-ui-lsB8cOhM.js";import{d as $e,b as l,a1 as x}from"./index-C9Xiq5-B.js";import"./vendor-charts-Dz0yD7_L.js";const ge={low:{bg:"bg-blue-500/20",text:"text-blue-400"},medium:{bg:"bg-yellow-500/20",text:"text-yellow-400"},high:{bg:"bg-orange-500/20",text:"text-orange-400"},critical:{bg:"bg-red-500/20",text:"text-red-400"}},v=[{value:"splunk",label:"Splunk SPL"},{value:"elastic_lucene",label:"Elasticsearch Lucene"},{value:"elastic_eql",label:"Elasticsearch EQL"},{value:"microsoft_sentinel",label:"Microsoft Sentinel KQL"},{value:"qradar_aql",label:"QRadar AQL"},{value:"logpoint",label:"LogPoint"},{value:"crowdstrike",label:"CrowdStrike"}],k=({isOpen:m,onClose:c,title:_,children:R,size:g="lg"})=>{if(!m)return null;const q=g==="xl"?"max-w-4xl":g==="lg"?"max-w-2xl":"max-w-md";return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:c}),e.jsxs("div",{className:`relative bg-gray-800 border border-gray-700 rounded-lg shadow-xl w-full ${q} max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:_}),e.jsx("button",{onClick:c,className:"p-1 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-white",children:e.jsx(Qe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:R})]})]})};function Xe(){var re,le;const m=Te(),[c,_]=r.useState("rules"),[R,g]=r.useState(!1),[q,E]=r.useState(!1),[he,N]=r.useState(!1),[ue,y]=r.useState(!1),[n,A]=r.useState(null),[T,pe]=r.useState(new Set),[h,D]=r.useState(""),[f,K]=r.useState("splunk"),[d,z]=r.useState(null),[Q,ye]=r.useState([]),[$,be]=r.useState(""),[O,je]=r.useState(""),[B,ve]=r.useState(),[W,I]=r.useState(""),[Y,J]=r.useState(""),[b,L]=r.useState([]),[X,Z]=r.useState("sequence"),[G,H]=r.useState(300),{data:w=[],isLoading:Ne,refetch:fe}=j({queryKey:["sigma-rules"],queryFn:()=>x.listSigmaRules().then(s=>s.data)}),{data:p,isLoading:we}=j({queryKey:["sigma-coverage"],queryFn:()=>x.getAttackCoverage().then(s=>s.data),enabled:c==="coverage"}),{data:U=[],isLoading:Ce}=j({queryKey:["sigma-tuning"],queryFn:()=>x.getTuningRecommendations().then(s=>s.data),enabled:c==="tuning"}),{data:V=[],isLoading:Se,refetch:Oe}=j({queryKey:["sigma-chains"],queryFn:()=>x.listRuleChains().then(s=>s.data),enabled:c==="chains"}),{data:ee=[]}=j({queryKey:["sigma-test-results",n==null?void 0:n.id],queryFn:()=>n?x.getSigmaRuleTestResults(n.id).then(s=>s.data):Promise.resolve([]),enabled:!!n&&c==="testing"}),se=u({mutationFn:s=>x.createSigmaRule(s),onSuccess:()=>{i.success("Sigma rule created"),m.invalidateQueries({queryKey:["sigma-rules"]}),g(!1)},onError:()=>i.error("Failed to create rule")}),ke=u({mutationFn:s=>x.deleteSigmaRule(s),onSuccess:()=>{i.success("Sigma rule deleted"),m.invalidateQueries({queryKey:["sigma-rules"]})},onError:()=>i.error("Failed to delete rule")}),C=u({mutationFn:s=>x.convertSigmaRule({rule_content:s.rule_content,backend:s.backend}),onSuccess:s=>{z(s.data),i.success("Rule converted successfully")},onError:()=>i.error("Failed to convert rule")}),S=u({mutationFn:s=>x.convertSigmaRuleAll({rule_content:s}),onSuccess:s=>{ye(s.data.conversions),i.success("Rule converted to all backends")},onError:()=>i.error("Failed to convert rule")}),ae=u({mutationFn:s=>x.testSigmaRuleWithStorage(s.id,{test_name:s.test_name,sample_logs:s.sample_logs,expected_matches:s.expected_matches}),onSuccess:()=>{i.success("Test completed"),m.invalidateQueries({queryKey:["sigma-test-results"]}),N(!1)},onError:()=>i.error("Failed to run test")}),te=u({mutationFn:s=>x.createRuleChain(s),onSuccess:()=>{i.success("Rule chain created"),m.invalidateQueries({queryKey:["sigma-chains"]}),y(!1),F()},onError:()=>i.error("Failed to create chain")}),_e=u({mutationFn:s=>x.deleteRuleChain(s),onSuccess:()=>{i.success("Rule chain deleted"),m.invalidateQueries({queryKey:["sigma-chains"]})},onError:()=>i.error("Failed to delete chain")}),F=()=>{I(""),J(""),L([]),Z("sequence"),H(300)},Re=s=>{const a=new Set(T);a.has(s)?a.delete(s):a.add(s),pe(a)},M=s=>{navigator.clipboard.writeText(s),i.success("Copied to clipboard")},qe=[{id:"rules",label:"Rules",icon:ne},{id:"convert",label:"Convert",icon:ce},{id:"testing",label:"Testing",icon:Fe},{id:"coverage",label:"ATT&CK Coverage",icon:Me},{id:"tuning",label:"Tuning",icon:Pe},{id:"chains",label:"Rule Chains",icon:de}];return e.jsx($e,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(ne,{className:"w-6 h-6 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Sigma Rules"}),e.jsx("p",{className:"text-gray-400",children:"Detection rule management and conversion"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"secondary",size:"sm",onClick:()=>fe(),children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsxs(l,{variant:"primary",size:"sm",onClick:()=>g(!0),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add Rule"]})]})]}),e.jsx("div",{className:"border-b border-gray-700",children:e.jsx("nav",{className:"flex space-x-4",children:qe.map(s=>e.jsxs("button",{onClick:()=>_(s.id),className:`flex items-center gap-2 px-4 py-2 border-b-2 transition-colors ${c===s.id?"border-purple-500 text-purple-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id))})}),c==="rules"&&e.jsx("div",{className:"space-y-4",children:Ne?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading rules..."}):w.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No Sigma rules found. Create one to get started."}):e.jsx("div",{className:"space-y-2",children:w.map(s=>{var a,t;return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:()=>Re(s.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[T.has(s.id)?e.jsx(Ee,{className:"w-4 h-4 text-gray-400"}):e.jsx(Ae,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:s.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${((a=ge[s.severity])==null?void 0:a.bg)||"bg-gray-500/20"} ${((t=ge[s.severity])==null?void 0:t.text)||"text-gray-400"}`,children:s.severity}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:s.enabled?"Enabled":"Disabled"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),A(s),D(s.content),E(!0)},className:"p-1 rounded hover:bg-gray-700 text-gray-400 hover:text-cyan-400",title:"Convert",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),A(s),N(!0)},className:"p-1 rounded hover:bg-gray-700 text-gray-400 hover:text-green-400",title:"Test",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),ke.mutate(s.id)},className:"p-1 rounded hover:bg-gray-700 text-gray-400 hover:text-red-400",title:"Delete",children:e.jsx(xe,{className:"w-4 h-4"})})]})]})]}),T.has(s.id)&&e.jsxs("div",{className:"px-4 pb-4 border-t border-gray-700 pt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Category:"}),e.jsx("span",{className:"text-gray-300 ml-2",children:s.logsource_category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Product:"}),e.jsx("span",{className:"text-gray-300 ml-2",children:s.logsource_product})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("span",{className:"text-gray-300 ml-2",children:s.status})]})]}),s.mitre_attack_ids.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"MITRE ATT&CK:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.mitre_attack_ids.map(o=>e.jsx("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded text-xs",children:o},o))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Rule Content:"}),e.jsx("pre",{className:"mt-1 p-3 bg-gray-900 rounded text-xs text-gray-300 overflow-x-auto",children:s.content})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-400",children:[e.jsx(De,{className:"w-4 h-4 inline mr-1"}),s.true_positive_count," TP"]}),e.jsxs("span",{className:"text-red-400",children:[e.jsx(me,{className:"w-4 h-4 inline mr-1"}),s.false_positive_count," FP"]})]})]})]},s.id)})})}),c==="convert"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Convert Sigma Rule"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Sigma Rule Content (YAML)"}),e.jsx("textarea",{value:h,onChange:s=>D(s.target.value),className:"w-full h-64 bg-gray-900 border border-gray-600 rounded-lg p-3 text-gray-300 font-mono text-sm",placeholder:"Paste your Sigma rule YAML here..."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("select",{value:f,onChange:s=>K(s.target.value),className:"bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-gray-300",children:v.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs(l,{variant:"primary",onClick:()=>C.mutate({rule_content:h,backend:f}),disabled:!h||C.isPending,children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Convert"]}),e.jsx(l,{variant:"secondary",onClick:()=>S.mutate(h),disabled:!h||S.isPending,children:"Convert to All"})]})]})]}),d&&e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:((re=v.find(s=>s.value===d.backend))==null?void 0:re.label)||d.backend}),e.jsxs(l,{variant:"secondary",size:"sm",onClick:()=>M(d.query),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Copy"]})]}),e.jsx("pre",{className:"bg-gray-900 p-4 rounded text-sm text-gray-300 overflow-x-auto",children:d.query}),d.warnings.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 mb-2",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Warnings"})]}),e.jsx("ul",{className:"list-disc list-inside text-yellow-300 text-sm",children:d.warnings.map((s,a)=>e.jsx("li",{children:s},a))})]}),d.errors.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400 mb-2",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Errors"})]}),e.jsx("ul",{className:"list-disc list-inside text-red-300 text-sm",children:d.errors.map((s,a)=>e.jsx("li",{children:s},a))})]})]}),Q.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"All Backend Conversions"}),Q.map((s,a)=>{var t;return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-purple-400 font-medium",children:((t=v.find(o=>o.value===s.backend))==null?void 0:t.label)||s.backend}),e.jsx(l,{variant:"secondary",size:"sm",onClick:()=>M(s.query),children:e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("pre",{className:"bg-gray-900 p-3 rounded text-xs text-gray-300 overflow-x-auto",children:s.query||"(conversion failed)"}),s.errors.length>0&&e.jsx("p",{className:"text-red-400 text-xs mt-2",children:s.errors.join(", ")})]},a)})]})]}),c==="testing"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Rule Testing"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Select a rule from the Rules tab and click the play button to test it against sample logs."}),n&&e.jsxs("div",{className:"p-4 bg-gray-900 rounded-lg mb-4",children:[e.jsx("span",{className:"text-gray-500",children:"Selected Rule:"}),e.jsx("span",{className:"text-white ml-2",children:n.name})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-white font-medium",children:"Recent Test Results"}),ee.length===0?e.jsx("p",{className:"text-gray-400",children:"No test results yet."}):e.jsx("div",{className:"space-y-2",children:ee.map(s=>e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-white font-medium",children:s.test_name}),e.jsx("p",{className:"text-gray-400 text-sm",children:new Date(s.tested_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-2 py-1 rounded text-sm ${s.passed?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:s.passed?"Passed":"Failed"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:[s.actual_matches," / ",s.expected_matches??"?"," matches"]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:[s.execution_time_ms,"ms"]})]})]})},s.id))})]})]})}),c==="coverage"&&e.jsx("div",{className:"space-y-6",children:we?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading coverage data..."}):p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-400",children:p.total_techniques_covered}),e.jsx("div",{className:"text-gray-400",children:"Techniques Covered"})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-cyan-400",children:p.total_rules}),e.jsx("div",{className:"text-gray-400",children:"Total Rules"})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:Object.keys(p.coverage_by_tactic).length}),e.jsx("div",{className:"text-gray-400",children:"Tactics Covered"})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Coverage by Tactic"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(p.coverage_by_tactic).map(([s,a])=>e.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:a}),e.jsx("div",{className:"text-gray-400 text-sm capitalize",children:s.replace(/_/g," ")})]},s))})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Covered Techniques"}),e.jsx("div",{className:"space-y-2",children:p.techniques.map(s=>e.jsxs("div",{className:"bg-gray-900 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-400 font-mono",children:s.technique_id}),e.jsx("span",{className:"text-white ml-2",children:s.technique_name}),e.jsxs("span",{className:"text-gray-500 ml-2 text-sm",children:["(",s.tactic,")"]})]}),e.jsxs("span",{className:"text-gray-400",children:[s.rule_count," rules"]})]},s.technique_id))})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No coverage data available."})}),c==="tuning"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Rule Tuning Recommendations"}),Ce?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading recommendations..."}):U.length===0?e.jsx("p",{className:"text-gray-400",children:"No tuning recommendations at this time. Rules are performing well!"}):e.jsx("div",{className:"space-y-4",children:U.map((s,a)=>e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:s.rule_name}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:s.description}),s.current_value&&s.suggested_value&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Current:"}),e.jsx("code",{className:"text-red-400 ml-2",children:s.current_value}),e.jsx("span",{className:"text-gray-500 mx-2",children:"→"}),e.jsx("span",{className:"text-gray-500",children:"Suggested:"}),e.jsx("code",{className:"text-green-400 ml-2",children:s.suggested_value})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.recommendation_type==="increase_specificity"?"bg-yellow-500/20 text-yellow-400":s.recommendation_type==="add_exclusion"?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"}`,children:s.recommendation_type.replace(/_/g," ")}),e.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:["FP Rate: ",(s.fp_rate*100).toFixed(1),"%"]})]})]})},a))})]})}),c==="chains"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Rule Chains (Correlation)"}),e.jsxs(l,{variant:"primary",size:"sm",onClick:()=>y(!0),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Create Chain"]})]}),Se?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading chains..."}):V.length===0?e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-8 text-center",children:[e.jsx(de,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h4",{className:"text-white font-medium mb-2",children:"No Rule Chains"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Create rule chains to correlate multiple Sigma rules and detect complex attack patterns."}),e.jsx(l,{variant:"primary",onClick:()=>y(!0),children:"Create Your First Chain"})]}):e.jsx("div",{className:"space-y-4",children:V.map(s=>e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:s.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.enabled?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:s.enabled?"Enabled":"Disabled"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:[s.chain_logic," • ",s.time_window_secs,"s window"]}),e.jsx("button",{onClick:()=>_e.mutate(s.id),className:"p-1 rounded hover:bg-gray-700 text-gray-400 hover:text-red-400",children:e.jsx(xe,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:s.rule_ids.map(a=>{const t=w.find(o=>o.id===a);return e.jsx("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs",children:(t==null?void 0:t.name)||a},a)})})]},s.id))})]}),e.jsx(k,{isOpen:R,onClose:()=>g(!1),title:"Create Sigma Rule",size:"xl",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault();const a=s.target,t=new FormData(a);se.mutate({name:t.get("name"),description:t.get("description"),content:t.get("content"),severity:t.get("severity"),enabled:t.get("enabled")==="on"})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Name"}),e.jsx("input",{name:"name",type:"text",required:!0,className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("input",{name:"description",type:"text",className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Severity"}),e.jsxs("select",{name:"severity",className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Rule Content (YAML)"}),e.jsx("textarea",{name:"content",required:!0,rows:10,className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-sm",placeholder:`title: My Detection Rule
status: experimental
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains: 'suspicious'
  condition: selection`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{name:"enabled",type:"checkbox",defaultChecked:!0,className:"rounded bg-gray-900 border-gray-600"}),e.jsx("label",{className:"text-gray-400",children:"Enabled"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(l,{variant:"secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx(l,{type:"submit",variant:"primary",disabled:se.isPending,children:"Create Rule"})]})]})}),e.jsx(k,{isOpen:he,onClose:()=>N(!1),title:`Test Rule: ${(n==null?void 0:n.name)||""}`,size:"xl",children:e.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),!n)return;const a=O.split(`
`).filter(t=>t.trim());ae.mutate({id:n.id,test_name:$,sample_logs:a,expected_matches:B})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Test Name"}),e.jsx("input",{type:"text",required:!0,value:$,onChange:s=>be(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sample Logs (one per line, JSON format)"}),e.jsx("textarea",{required:!0,value:O,onChange:s=>je(s.target.value),rows:8,className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-sm",placeholder:'{"CommandLine": "cmd.exe /c suspicious.bat", "Image": "C:\\\\Windows\\\\System32\\\\cmd.exe"}'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Expected Matches (optional)"}),e.jsx("input",{type:"number",min:0,value:B??"",onChange:s=>ve(s.target.value?parseInt(s.target.value):void 0),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(l,{variant:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(l,{type:"submit",variant:"primary",disabled:ae.isPending,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Run Test"]})]})]})}),e.jsx(k,{isOpen:ue,onClose:()=>{y(!1),F()},title:"Create Rule Chain",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),te.mutate({name:W,description:Y||void 0,rule_ids:b,chain_logic:X,time_window_secs:G,enabled:!0})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Chain Name"}),e.jsx("input",{type:"text",required:!0,value:W,onChange:s=>I(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:Y,onChange:s=>J(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Select Rules"}),e.jsx("div",{className:"max-h-48 overflow-y-auto bg-gray-900 border border-gray-600 rounded-lg p-2 space-y-1",children:w.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.includes(s.id),onChange:a=>{a.target.checked?L([...b,s.id]):L(b.filter(t=>t!==s.id))},className:"rounded bg-gray-700 border-gray-600"}),e.jsx("span",{className:"text-white",children:s.name})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Chain Logic"}),e.jsxs("select",{value:X,onChange:s=>Z(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"sequence",children:"Sequence (rules must fire in order)"}),e.jsx("option",{value:"parallel",children:"Parallel (all rules must fire within window)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Time Window (seconds)"}),e.jsx("input",{type:"number",min:1,value:G,onChange:s=>H(parseInt(s.target.value)),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(l,{variant:"secondary",onClick:()=>{y(!1),F()},children:"Cancel"}),e.jsx(l,{type:"submit",variant:"primary",disabled:te.isPending||b.length<2,children:"Create Chain"})]})]})}),e.jsx(k,{isOpen:q,onClose:()=>{E(!1),z(null)},title:`Convert: ${(n==null?void 0:n.name)||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("select",{value:f,onChange:s=>K(s.target.value),className:"bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-gray-300",children:v.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx(l,{variant:"primary",onClick:()=>C.mutate({rule_content:h,backend:f}),disabled:C.isPending,children:"Convert"}),e.jsx(l,{variant:"secondary",onClick:()=>S.mutate(h),disabled:S.isPending,children:"Convert to All"})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-400 font-medium",children:(le=v.find(s=>s.value===d.backend))==null?void 0:le.label}),e.jsxs(l,{variant:"secondary",size:"sm",onClick:()=>M(d.query),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Copy"]})]}),e.jsx("pre",{className:"bg-gray-900 p-4 rounded text-sm text-gray-300 overflow-x-auto",children:d.query})]})]})})]})})}export{Xe as default};
