import{b as ar,d as cr,j as h,e as lr,u as Ut,f as Ze}from"./vendor-state-oFDmcCcB.js";import{R as dr,r as I}from"./vendor-react-5KxtEOLM.js";import{s as it,p as Fn,z as On,i as ur,d as Yn,t as fr}from"./vendor-viz-CGXVP_K3.js";import{f as xt,t as yt}from"./vendor-charts-KsrMNFEc.js";import{B as ye,av as wt,X as Jt,t as gr,L as bt,d as hr,V as pr,$ as Wn,S as en,aZ as mr,bU as xr,w as Xn,p as yr,l as wr,a1 as br,g as vt,i as tn}from"./vendor-ui-BlFJDRaq.js";import{N as Se,B as Me}from"./index-DU1ke8Sf.js";function re(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=re(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const le={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Re=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],qn=["Enter"," ","Escape"],Gn={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ke;(function(e){e.Strict="strict",e.Loose="loose"})(ke||(ke={}));var be;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(be||(be={}));var Be;(function(e){e.Partial="partial",e.Full="full"})(Be||(Be={}));const Kn={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var pe;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(pe||(pe={}));var tt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(tt||(tt={}));var F;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(F||(F={}));const nn={[F.Left]:F.Right,[F.Right]:F.Left,[F.Top]:F.Bottom,[F.Bottom]:F.Top};function Zn(e){return e===null?null:e?"valid":"invalid"}const Qn=e=>"id"in e&&"source"in e&&"target"in e,vr=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),$t=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Ye=(e,t=[0,0])=>{const{width:n,height:s}=ue(e),o=e.origin??t,r=n*o[0],i=s*o[1];return{x:e.position.x-r,y:e.position.y-i}},Nr=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,o)=>{const r=typeof o=="string";let i=!t.nodeLookup&&!r?o:void 0;t.nodeLookup&&(i=r?t.nodeLookup.get(o):$t(o)?o:t.nodeLookup.get(o.id));const a=i?nt(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return at(s,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ct(n)},We=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(o=>{(t.filter===void 0||t.filter(o))&&(n=at(n,nt(o)),s=!0)}),s?ct(n):{x:0,y:0,width:0,height:0}},Lt=(e,t,[n,s,o]=[0,0,1],r=!1,i=!1)=>{const a={...qe(t,[n,s,o]),width:t.width/o,height:t.height/o},d=[];for(const f of e.values()){const{measured:p,selectable:c=!0,hidden:l=!1}=f;if(i&&!c||l)continue;const m=p.width??f.width??f.initialWidth??null,g=p.height??f.height??f.initialHeight??null,w=Ve(a,_e(f)),x=(m??0)*(g??0),y=r&&w>0;(!f.internals.handleBounds||y||w>=x||f.dragging)&&d.push(f)}return d},Er=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function Sr(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!o.hidden)&&(!s||s.has(o.id))&&n.set(o.id,o)}),n}async function Cr({nodes:e,width:t,height:n,panZoom:s,minZoom:o,maxZoom:r},i){if(e.size===0)return Promise.resolve(!0);const a=Sr(e,i),d=We(a),f=zt(d,t,n,(i==null?void 0:i.minZoom)??o,(i==null?void 0:i.maxZoom)??r,(i==null?void 0:i.padding)??.1);return await s.setViewport(f,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function Un({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:o,onError:r}){const i=n.get(e),a=i.parentId?n.get(i.parentId):void 0,{x:d,y:f}=a?a.internals.positionAbsolute:{x:0,y:0},p=i.origin??s;let c=i.extent||o;if(i.extent==="parent"&&!i.expandParent)if(!a)r==null||r("005",le.error005());else{const m=a.measured.width,g=a.measured.height;m&&g&&(c=[[d,f],[d+m,f+g]])}else a&&Pe(i.extent)&&(c=[[i.extent[0][0]+d,i.extent[0][1]+f],[i.extent[1][0]+d,i.extent[1][1]+f]]);const l=Pe(c)?ve(t,c,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&(r==null||r("015",le.error015())),{position:{x:l.x-d+(i.measured.width??0)*p[0],y:l.y-f+(i.measured.height??0)*p[1]},positionAbsolute:l}}async function Mr({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:o}){const r=new Set(e.map(l=>l.id)),i=[];for(const l of n){if(l.deletable===!1)continue;const m=r.has(l.id),g=!m&&l.parentId&&i.find(w=>w.id===l.parentId);(m||g)&&i.push(l)}const a=new Set(t.map(l=>l.id)),d=s.filter(l=>l.deletable!==!1),p=Er(i,d);for(const l of d)a.has(l.id)&&!p.find(g=>g.id===l.id)&&p.push(l);if(!o)return{edges:p,nodes:i};const c=await o({nodes:i,edges:p});return typeof c=="boolean"?c?{edges:p,nodes:i}:{edges:[],nodes:[]}:c}const Ae=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),ve=(e={x:0,y:0},t,n)=>({x:Ae(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Ae(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function Jn(e,t,n){const{width:s,height:o}=ue(n),{x:r,y:i}=n.internals.positionAbsolute;return ve(e,[[r,i],[r+s,i+o]],t)}const sn=(e,t,n)=>e<t?Ae(Math.abs(e-t),1,t)/t:e>n?-Ae(Math.abs(e-n),1,t)/t:0,es=(e,t,n=15,s=40)=>{const o=sn(e.x,s,t.width-s)*n,r=sn(e.y,s,t.height-s)*n;return[o,r]},at=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),jt=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),ct=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),_e=(e,t=[0,0])=>{var o,r;const{x:n,y:s}=$t(e)?e.internals.positionAbsolute:Ye(e,t);return{x:n,y:s,width:((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0,height:((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0}},nt=(e,t=[0,0])=>{var o,r;const{x:n,y:s}=$t(e)?e.internals.positionAbsolute:Ye(e,t);return{x:n,y:s,x2:n+(((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0),y2:s+(((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0)}},ts=(e,t)=>ct(at(jt(e),jt(t))),Ve=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},on=e=>ae(e.width)&&ae(e.height)&&ae(e.x)&&ae(e.y),ae=e=>!isNaN(e)&&isFinite(e),jr=(e,t)=>{},Xe=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),qe=({x:e,y:t},[n,s,o],r=!1,i=[1,1])=>{const a={x:(e-n)/o,y:(t-s)/o};return r?Xe(a,i):a},st=({x:e,y:t},[n,s,o])=>({x:e*o+n,y:t*o+s});function Ce(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Ir(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=Ce(e,n),o=Ce(e,t);return{top:s,right:o,bottom:s,left:o,x:o*2,y:s*2}}if(typeof e=="object"){const s=Ce(e.top??e.y??0,n),o=Ce(e.bottom??e.y??0,n),r=Ce(e.left??e.x??0,t),i=Ce(e.right??e.x??0,t);return{top:s,right:i,bottom:o,left:r,x:r+i,y:s+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function kr(e,t,n,s,o,r){const{x:i,y:a}=st(e,[t,n,s]),{x:d,y:f}=st({x:e.x+e.width,y:e.y+e.height},[t,n,s]),p=o-d,c=r-f;return{left:Math.floor(i),top:Math.floor(a),right:Math.floor(p),bottom:Math.floor(c)}}const zt=(e,t,n,s,o,r)=>{const i=Ir(r,t,n),a=(t-i.x)/e.width,d=(n-i.y)/e.height,f=Math.min(a,d),p=Ae(f,s,o),c=e.x+e.width/2,l=e.y+e.height/2,m=t/2-c*p,g=n/2-l*p,w=kr(e,m,g,p,t,n),x={left:Math.min(w.left-i.left,0),top:Math.min(w.top-i.top,0),right:Math.min(w.right-i.right,0),bottom:Math.min(w.bottom-i.bottom,0)};return{x:m-x.left+x.right,y:g-x.top+x.bottom,zoom:p}},Fe=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Pe(e){return e!=null&&e!=="parent"}function ue(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function ns(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function ss(e,t={width:0,height:0},n,s,o){const r={...e},i=s.get(n);if(i){const a=i.origin||o;r.x+=i.internals.positionAbsolute.x-(t.width??0)*a[0],r.y+=i.internals.positionAbsolute.y-(t.height??0)*a[1]}return r}function rn(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ar(){let e,t;return{promise:new Promise((s,o)=>{e=s,t=o}),resolve:e,reject:t}}function _r(e){return{...Gn,...e||{}}}function Te(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:o}){const{x:r,y:i}=ce(e),a=qe({x:r-((o==null?void 0:o.left)??0),y:i-((o==null?void 0:o.top)??0)},s),{x:d,y:f}=n?Xe(a,t):a;return{xSnapped:d,ySnapped:f,...a}}const Ht=e=>({width:e.offsetWidth,height:e.offsetHeight}),os=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},Pr=["INPUT","SELECT","TEXTAREA"];function rs(e){var s,o;const t=((o=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:o[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:Pr.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const is=e=>"clientX"in e,ce=(e,t)=>{var r,i;const n=is(e),s=n?e.clientX:(r=e.touches)==null?void 0:r[0].clientX,o=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},an=(e,t,n,s,o)=>{const r=t.querySelectorAll(`.${e}`);return!r||!r.length?null:Array.from(r).map(i=>{const a=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(a.left-n.left)/s,y:(a.top-n.top)/s,...Ht(i)}})};function as({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:o,sourceControlY:r,targetControlX:i,targetControlY:a}){const d=e*.125+o*.375+i*.375+n*.125,f=t*.125+r*.375+a*.375+s*.125,p=Math.abs(d-e),c=Math.abs(f-t);return[d,f,p,c]}function Qe(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function cn({pos:e,x1:t,y1:n,x2:s,y2:o,c:r}){switch(e){case F.Left:return[t-Qe(t-s,r),n];case F.Right:return[t+Qe(s-t,r),n];case F.Top:return[t,n-Qe(n-o,r)];case F.Bottom:return[t,n+Qe(o-n,r)]}}function cs({sourceX:e,sourceY:t,sourcePosition:n=F.Bottom,targetX:s,targetY:o,targetPosition:r=F.Top,curvature:i=.25}){const[a,d]=cn({pos:n,x1:e,y1:t,x2:s,y2:o,c:i}),[f,p]=cn({pos:r,x1:s,y1:o,x2:e,y2:t,c:i}),[c,l,m,g]=as({sourceX:e,sourceY:t,targetX:s,targetY:o,sourceControlX:a,sourceControlY:d,targetControlX:f,targetControlY:p});return[`M${e},${t} C${a},${d} ${f},${p} ${s},${o}`,c,l,m,g]}function ls({sourceX:e,sourceY:t,targetX:n,targetY:s}){const o=Math.abs(n-e)/2,r=n<e?n+o:n-o,i=Math.abs(s-t)/2,a=s<t?s+i:s-i;return[r,a,o,i]}function $r({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s=0,elevateOnSelect:o=!1,zIndexMode:r="basic"}){if(r==="manual")return s;const i=o&&n?s+1e3:s,a=Math.max(e.parentId||o&&e.selected?e.internals.z:0,t.parentId||o&&t.selected?t.internals.z:0);return i+a}function Lr({sourceNode:e,targetNode:t,width:n,height:s,transform:o}){const r=at(nt(e),nt(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:s/o[2]};return Ve(i,ct(r))>0}const zr=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,Hr=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Dr=(e,t,n={})=>{if(!e.source||!e.target)return t;const s=n.getEdgeId||zr;let o;return Qn(e)?o={...e}:o={...e,id:s(e)},Hr(o,t)?t:(o.sourceHandle===null&&delete o.sourceHandle,o.targetHandle===null&&delete o.targetHandle,t.concat(o))};function ds({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[o,r,i,a]=ls({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,o,r,i,a]}const ln={[F.Left]:{x:-1,y:0},[F.Right]:{x:1,y:0},[F.Top]:{x:0,y:-1},[F.Bottom]:{x:0,y:1}},Tr=({source:e,sourcePosition:t=F.Bottom,target:n})=>t===F.Left||t===F.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},dn=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Rr({source:e,sourcePosition:t=F.Bottom,target:n,targetPosition:s=F.Top,center:o,offset:r,stepPosition:i}){const a=ln[t],d=ln[s],f={x:e.x+a.x*r,y:e.y+a.y*r},p={x:n.x+d.x*r,y:n.y+d.y*r},c=Tr({source:f,sourcePosition:t,target:p}),l=c.x!==0?"x":"y",m=c[l];let g=[],w,x;const y={x:0,y:0},b={x:0,y:0},[,,u,v]=ls({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[l]*d[l]===-1){l==="x"?(w=o.x??f.x+(p.x-f.x)*i,x=o.y??(f.y+p.y)/2):(w=o.x??(f.x+p.x)/2,x=o.y??f.y+(p.y-f.y)*i);const E=[{x:w,y:f.y},{x:w,y:p.y}],M=[{x:f.x,y:x},{x:p.x,y:x}];a[l]===m?g=l==="x"?E:M:g=l==="x"?M:E}else{const E=[{x:f.x,y:p.y}],M=[{x:p.x,y:f.y}];if(l==="x"?g=a.x===m?M:E:g=a.y===m?E:M,t===s){const S=Math.abs(e[l]-n[l]);if(S<=r){const P=Math.min(r-1,r-S);a[l]===m?y[l]=(f[l]>e[l]?-1:1)*P:b[l]=(p[l]>n[l]?-1:1)*P}}if(t!==s){const S=l==="x"?"y":"x",P=a[l]===d[S],L=f[S]>p[S],$=f[S]<p[S];(a[l]===1&&(!P&&L||P&&$)||a[l]!==1&&(!P&&$||P&&L))&&(g=l==="x"?E:M)}const N={x:f.x+y.x,y:f.y+y.y},A={x:p.x+b.x,y:p.y+b.y},D=Math.max(Math.abs(N.x-g[0].x),Math.abs(A.x-g[0].x)),C=Math.max(Math.abs(N.y-g[0].y),Math.abs(A.y-g[0].y));D>=C?(w=(N.x+A.x)/2,x=g[0].y):(w=g[0].x,x=(N.y+A.y)/2)}return[[e,{x:f.x+y.x,y:f.y+y.y},...g,{x:p.x+b.x,y:p.y+b.y},n],w,x,u,v]}function Br(e,t,n,s){const o=Math.min(dn(e,t)/2,dn(t,n)/2,s),{x:r,y:i}=t;if(e.x===r&&r===n.x||e.y===i&&i===n.y)return`L${r} ${i}`;if(e.y===i){const f=e.x<n.x?-1:1,p=e.y<n.y?1:-1;return`L ${r+o*f},${i}Q ${r},${i} ${r},${i+o*p}`}const a=e.x<n.x?1:-1,d=e.y<n.y?-1:1;return`L ${r},${i+o*d}Q ${r},${i} ${r+o*a},${i}`}function It({sourceX:e,sourceY:t,sourcePosition:n=F.Bottom,targetX:s,targetY:o,targetPosition:r=F.Top,borderRadius:i=5,centerX:a,centerY:d,offset:f=20,stepPosition:p=.5}){const[c,l,m,g,w]=Rr({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:o},targetPosition:r,center:{x:a,y:d},offset:f,stepPosition:p});return[c.reduce((y,b,u)=>{let v="";return u>0&&u<c.length-1?v=Br(c[u-1],b,c[u+1],i):v=`${u===0?"M":"L"}${b.x} ${b.y}`,y+=v,y},""),l,m,g,w]}function un(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Vr(e){var c;const{sourceNode:t,targetNode:n}=e;if(!un(t)||!un(n))return null;const s=t.internals.handleBounds||fn(t.handles),o=n.internals.handleBounds||fn(n.handles),r=gn((s==null?void 0:s.source)??[],e.sourceHandle),i=gn(e.connectionMode===ke.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),e.targetHandle);if(!r||!i)return(c=e.onError)==null||c.call(e,"008",le.error008(r?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(r==null?void 0:r.position)||F.Bottom,d=(i==null?void 0:i.position)||F.Top,f=Ne(t,r,a),p=Ne(n,i,d);return{sourceX:f.x,sourceY:f.y,targetX:p.x,targetY:p.y,sourcePosition:a,targetPosition:d}}function fn(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function Ne(e,t,n=F.Left,s=!1){const o=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,r=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:i,height:a}=t??ue(e);if(s)return{x:o+i/2,y:r+a/2};switch((t==null?void 0:t.position)??n){case F.Top:return{x:o+i/2,y:r};case F.Right:return{x:o+i,y:r+a/2};case F.Bottom:return{x:o+i/2,y:r+a};case F.Left:return{x:o,y:r+a/2}}}function gn(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function kt(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function Fr(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:o}){const r=new Set;return e.reduce((i,a)=>([a.markerStart||s,a.markerEnd||o].forEach(d=>{if(d&&typeof d=="object"){const f=kt(d,t);r.has(f)||(i.push({id:f,color:d.color||n,...d}),r.add(f))}}),i),[]).sort((i,a)=>i.id.localeCompare(a.id))}const us=1e3,Or=10,Dt={nodeOrigin:[0,0],nodeExtent:Re,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Yr={...Dt,checkEquality:!0};function Tt(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function Wr(e,t,n){const s=Tt(Dt,n);for(const o of e.values())if(o.parentId)Bt(o,e,t,s);else{const r=Ye(o,s.nodeOrigin),i=Pe(o.extent)?o.extent:s.nodeExtent,a=ve(r,i,ue(o));o.internals.positionAbsolute=a}}function Xr(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const o of e.handles){const r={id:o.id,width:o.width??1,height:o.height??1,nodeId:e.id,x:o.x,y:o.y,position:o.position,type:o.type};o.type==="source"?n.push(r):o.type==="target"&&s.push(r)}return{source:n,target:s}}function Rt(e){return e==="manual"}function At(e,t,n,s={}){var f,p;const o=Tt(Yr,s),r={i:0},i=new Map(t),a=o!=null&&o.elevateNodesOnSelect&&!Rt(o.zIndexMode)?us:0;let d=e.length>0;t.clear(),n.clear();for(const c of e){let l=i.get(c.id);if(o.checkEquality&&c===(l==null?void 0:l.internals.userNode))t.set(c.id,l);else{const m=Ye(c,o.nodeOrigin),g=Pe(c.extent)?c.extent:o.nodeExtent,w=ve(m,g,ue(c));l={...o.defaults,...c,measured:{width:(f=c.measured)==null?void 0:f.width,height:(p=c.measured)==null?void 0:p.height},internals:{positionAbsolute:w,handleBounds:Xr(c,l),z:fs(c,a,o.zIndexMode),userNode:c}},t.set(c.id,l)}(l.measured===void 0||l.measured.width===void 0||l.measured.height===void 0)&&!l.hidden&&(d=!1),c.parentId&&Bt(l,t,n,s,r)}return d}function qr(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Bt(e,t,n,s,o){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:a,zIndexMode:d}=Tt(Dt,s),f=e.parentId,p=t.get(f);if(!p){console.warn(`Parent node ${f} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}qr(e,n),o&&!p.parentId&&p.internals.rootParentIndex===void 0&&d==="auto"&&(p.internals.rootParentIndex=++o.i,p.internals.z=p.internals.z+o.i*Or),o&&p.internals.rootParentIndex!==void 0&&(o.i=p.internals.rootParentIndex);const c=r&&!Rt(d)?us:0,{x:l,y:m,z:g}=Gr(e,p,i,a,c,d),{positionAbsolute:w}=e.internals,x=l!==w.x||m!==w.y;(x||g!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:x?{x:l,y:m}:w,z:g}})}function fs(e,t,n){const s=ae(e.zIndex)?e.zIndex:0;return Rt(n)?s:s+(e.selected?t:0)}function Gr(e,t,n,s,o,r){const{x:i,y:a}=t.internals.positionAbsolute,d=ue(e),f=Ye(e,n),p=Pe(e.extent)?ve(f,e.extent,d):f;let c=ve({x:i+p.x,y:a+p.y},s,d);e.extent==="parent"&&(c=Jn(c,d,t));const l=fs(e,o,r),m=t.internals.z??0;return{x:c.x,y:c.y,z:m>=l?m+1:l}}function Vt(e,t,n,s=[0,0]){var i;const o=[],r=new Map;for(const a of e){const d=t.get(a.parentId);if(!d)continue;const f=((i=r.get(a.parentId))==null?void 0:i.expandedRect)??_e(d),p=ts(f,a.rect);r.set(a.parentId,{expandedRect:p,parent:d})}return r.size>0&&r.forEach(({expandedRect:a,parent:d},f)=>{var u;const p=d.internals.positionAbsolute,c=ue(d),l=d.origin??s,m=a.x<p.x?Math.round(Math.abs(p.x-a.x)):0,g=a.y<p.y?Math.round(Math.abs(p.y-a.y)):0,w=Math.max(c.width,Math.round(a.width)),x=Math.max(c.height,Math.round(a.height)),y=(w-c.width)*l[0],b=(x-c.height)*l[1];(m>0||g>0||y||b)&&(o.push({id:f,type:"position",position:{x:d.position.x-m+y,y:d.position.y-g+b}}),(u=n.get(f))==null||u.forEach(v=>{e.some(j=>j.id===v.id)||o.push({id:v.id,type:"position",position:{x:v.position.x+m,y:v.position.y+g}})})),(c.width<a.width||c.height<a.height||m||g)&&o.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:w+(m?l[0]*m-y:0),height:x+(g?l[1]*g-b:0)}})}),o}function Kr(e,t,n,s,o,r,i){const a=s==null?void 0:s.querySelector(".xyflow__viewport");let d=!1;if(!a)return{changes:[],updatedInternals:d};const f=[],p=window.getComputedStyle(a),{m22:c}=new window.DOMMatrixReadOnly(p.transform),l=[];for(const m of e.values()){const g=t.get(m.id);if(!g)continue;if(g.hidden){t.set(g.id,{...g,internals:{...g.internals,handleBounds:void 0}}),d=!0;continue}const w=Ht(m.nodeElement),x=g.measured.width!==w.width||g.measured.height!==w.height;if(!!(w.width&&w.height&&(x||!g.internals.handleBounds||m.force))){const b=m.nodeElement.getBoundingClientRect(),u=Pe(g.extent)?g.extent:r;let{positionAbsolute:v}=g.internals;g.parentId&&g.extent==="parent"?v=Jn(v,w,t.get(g.parentId)):u&&(v=ve(v,u,w));const j={...g,measured:w,internals:{...g.internals,positionAbsolute:v,handleBounds:{source:an("source",m.nodeElement,b,c,g.id),target:an("target",m.nodeElement,b,c,g.id)}}};t.set(g.id,j),g.parentId&&Bt(j,t,n,{nodeOrigin:o,zIndexMode:i}),d=!0,x&&(f.push({id:g.id,type:"dimensions",dimensions:w}),g.expandParent&&g.parentId&&l.push({id:g.id,parentId:g.parentId,rect:_e(j,o)}))}}if(l.length>0){const m=Vt(l,t,n,o);f.push(...m)}return{changes:f,updatedInternals:d}}async function Zr({delta:e,panZoom:t,transform:n,translateExtent:s,width:o,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[o,r]],s),a=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(a)}function hn(e,t,n,s,o,r){let i=o;const a=s.get(i)||new Map;s.set(i,a.set(n,t)),i=`${o}-${e}`;const d=s.get(i)||new Map;if(s.set(i,d.set(n,t)),r){i=`${o}-${e}-${r}`;const f=s.get(i)||new Map;s.set(i,f.set(n,t))}}function gs(e,t,n){e.clear(),t.clear();for(const s of n){const{source:o,target:r,sourceHandle:i=null,targetHandle:a=null}=s,d={edgeId:s.id,source:o,target:r,sourceHandle:i,targetHandle:a},f=`${o}-${i}--${r}-${a}`,p=`${r}-${a}--${o}-${i}`;hn("source",d,p,e,o,i),hn("target",d,f,e,r,a),t.set(s.id,s)}}function hs(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:hs(n,t):!1}function pn(e,t,n){var o;let s=e;do{if((o=s==null?void 0:s.matches)!=null&&o.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function Qr(e,t,n,s){const o=new Map;for(const[r,i]of e)if((i.selected||i.id===s)&&(!i.parentId||!hs(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const a=e.get(r);a&&o.set(r,{id:r,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return o}function Nt({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var i,a,d;const o=[];for(const[f,p]of t){const c=(i=n.get(f))==null?void 0:i.internals.userNode;c&&o.push({...c,position:p.position,dragging:s})}if(!e)return[o[0],o];const r=(a=n.get(e))==null?void 0:a.internals.userNode;return[r?{...r,position:((d=t.get(e))==null?void 0:d.position)||r.position,dragging:s}:o[0],o]}function Ur({dragItems:e,snapGrid:t,x:n,y:s}){const o=e.values().next().value;if(!o)return null;const r={x:n-o.distance.x,y:s-o.distance.y},i=Xe(r,t);return{x:i.x-r.x,y:i.y-r.y}}function Jr({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:o}){let r={x:null,y:null},i=0,a=new Map,d=!1,f={x:0,y:0},p=null,c=!1,l=null,m=!1,g=!1,w=null;function x({noDragClassName:b,handleSelector:u,domNode:v,isSelectable:j,nodeId:E,nodeClickDistance:M=0}){l=it(v);function N({x:S,y:P}){const{nodeLookup:L,nodeExtent:$,snapGrid:T,snapToGrid:z,nodeOrigin:_,onNodeDrag:k,onSelectionDrag:R,onError:V,updateNodePositions:H}=t();r={x:S,y:P};let O=!1;const W=a.size>1,K=W&&$?jt(We(a)):null,Z=W&&z?Ur({dragItems:a,snapGrid:T,x:S,y:P}):null;for(const[Q,B]of a){if(!L.has(Q))continue;let q={x:S-B.distance.x,y:P-B.distance.y};z&&(q=Z?{x:Math.round(q.x+Z.x),y:Math.round(q.y+Z.y)}:Xe(q,T));let U=null;if(W&&$&&!B.extent&&K){const{positionAbsolute:Y}=B.internals,te=Y.x-K.x+$[0][0],ne=Y.x+B.measured.width-K.x2+$[1][0],ee=Y.y-K.y+$[0][1],ie=Y.y+B.measured.height-K.y2+$[1][1];U=[[te,ee],[ne,ie]]}const{position:G,positionAbsolute:X}=Un({nodeId:Q,nextPosition:q,nodeLookup:L,nodeExtent:U||$,nodeOrigin:_,onError:V});O=O||B.position.x!==G.x||B.position.y!==G.y,B.position=G,B.internals.positionAbsolute=X}if(g=g||O,!!O&&(H(a,!0),w&&(s||k||!E&&R))){const[Q,B]=Nt({nodeId:E,dragItems:a,nodeLookup:L});s==null||s(w,a,Q,B),k==null||k(w,Q,B),E||R==null||R(w,B)}}async function A(){if(!p)return;const{transform:S,panBy:P,autoPanSpeed:L,autoPanOnNodeDrag:$}=t();if(!$){d=!1,cancelAnimationFrame(i);return}const[T,z]=es(f,p,L);(T!==0||z!==0)&&(r.x=(r.x??0)-T/S[2],r.y=(r.y??0)-z/S[2],await P({x:T,y:z})&&N(r)),i=requestAnimationFrame(A)}function D(S){var W;const{nodeLookup:P,multiSelectionActive:L,nodesDraggable:$,transform:T,snapGrid:z,snapToGrid:_,selectNodesOnDrag:k,onNodeDragStart:R,onSelectionDragStart:V,unselectNodesAndEdges:H}=t();c=!0,(!k||!j)&&!L&&E&&((W=P.get(E))!=null&&W.selected||H()),j&&k&&E&&(e==null||e(E));const O=Te(S.sourceEvent,{transform:T,snapGrid:z,snapToGrid:_,containerBounds:p});if(r=O,a=Qr(P,$,O,E),a.size>0&&(n||R||!E&&V)){const[K,Z]=Nt({nodeId:E,dragItems:a,nodeLookup:P});n==null||n(S.sourceEvent,a,K,Z),R==null||R(S.sourceEvent,K,Z),E||V==null||V(S.sourceEvent,Z)}}const C=Yn().clickDistance(M).on("start",S=>{const{domNode:P,nodeDragThreshold:L,transform:$,snapGrid:T,snapToGrid:z}=t();p=(P==null?void 0:P.getBoundingClientRect())||null,m=!1,g=!1,w=S.sourceEvent,L===0&&D(S),r=Te(S.sourceEvent,{transform:$,snapGrid:T,snapToGrid:z,containerBounds:p}),f=ce(S.sourceEvent,p)}).on("drag",S=>{const{autoPanOnNodeDrag:P,transform:L,snapGrid:$,snapToGrid:T,nodeDragThreshold:z,nodeLookup:_}=t(),k=Te(S.sourceEvent,{transform:L,snapGrid:$,snapToGrid:T,containerBounds:p});if(w=S.sourceEvent,(S.sourceEvent.type==="touchmove"&&S.sourceEvent.touches.length>1||E&&!_.has(E))&&(m=!0),!m){if(!d&&P&&c&&(d=!0,A()),!c){const R=ce(S.sourceEvent,p),V=R.x-f.x,H=R.y-f.y;Math.sqrt(V*V+H*H)>z&&D(S)}(r.x!==k.xSnapped||r.y!==k.ySnapped)&&a&&c&&(f=ce(S.sourceEvent,p),N(k))}}).on("end",S=>{if(!(!c||m)&&(d=!1,c=!1,cancelAnimationFrame(i),a.size>0)){const{nodeLookup:P,updateNodePositions:L,onNodeDragStop:$,onSelectionDragStop:T}=t();if(g&&(L(a,!1),g=!1),o||$||!E&&T){const[z,_]=Nt({nodeId:E,dragItems:a,nodeLookup:P,dragging:!1});o==null||o(S.sourceEvent,a,z,_),$==null||$(S.sourceEvent,z,_),E||T==null||T(S.sourceEvent,_)}}}).filter(S=>{const P=S.target;return!S.button&&(!b||!pn(P,`.${b}`,v))&&(!u||pn(P,u,v))});l.call(C)}function y(){l==null||l.on(".drag",null)}return{update:x,destroy:y}}function ei(e,t,n){const s=[],o={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const r of t.values())Ve(o,_e(r))>0&&s.push(r);return s}const ti=250;function ni(e,t,n,s){var a,d;let o=[],r=1/0;const i=ei(e,n,t+ti);for(const f of i){const p=[...((a=f.internals.handleBounds)==null?void 0:a.source)??[],...((d=f.internals.handleBounds)==null?void 0:d.target)??[]];for(const c of p){if(s.nodeId===c.nodeId&&s.type===c.type&&s.id===c.id)continue;const{x:l,y:m}=Ne(f,c,c.position,!0),g=Math.sqrt(Math.pow(l-e.x,2)+Math.pow(m-e.y,2));g>t||(g<r?(o=[{...c,x:l,y:m}],r=g):g===r&&o.push({...c,x:l,y:m}))}}if(!o.length)return null;if(o.length>1){const f=s.type==="source"?"target":"source";return o.find(p=>p.type===f)??o[0]}return o[0]}function ps(e,t,n,s,o,r=!1){var f,p,c;const i=s.get(e);if(!i)return null;const a=o==="strict"?(f=i.internals.handleBounds)==null?void 0:f[t]:[...((p=i.internals.handleBounds)==null?void 0:p.source)??[],...((c=i.internals.handleBounds)==null?void 0:c.target)??[]],d=(n?a==null?void 0:a.find(l=>l.id===n):a==null?void 0:a[0])??null;return d&&r?{...d,...Ne(i,d,d.position,!0)}:d}function ms(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function si(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const xs=()=>!0;function oi(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:o,edgeUpdaterType:r,isTarget:i,domNode:a,nodeLookup:d,lib:f,autoPanOnConnect:p,flowId:c,panBy:l,cancelConnection:m,onConnectStart:g,onConnect:w,onConnectEnd:x,isValidConnection:y=xs,onReconnectEnd:b,updateConnection:u,getTransform:v,getFromHandle:j,autoPanSpeed:E,dragThreshold:M=1,handleDomNode:N}){const A=os(e.target);let D=0,C;const{x:S,y:P}=ce(e),L=ms(r,N),$=a==null?void 0:a.getBoundingClientRect();let T=!1;if(!$||!L)return;const z=ps(o,L,s,d,t);if(!z)return;let _=ce(e,$),k=!1,R=null,V=!1,H=null;function O(){if(!p||!$)return;const[G,X]=es(_,$,E);l({x:G,y:X}),D=requestAnimationFrame(O)}const W={...z,nodeId:o,type:L,position:z.position},K=d.get(o);let Q={inProgress:!0,isValid:null,from:Ne(K,W,F.Left,!0),fromHandle:W,fromPosition:W.position,fromNode:K,to:_,toHandle:null,toPosition:nn[W.position],toNode:null,pointer:_};function B(){T=!0,u(Q),g==null||g(e,{nodeId:o,handleId:s,handleType:L})}M===0&&B();function q(G){if(!T){const{x:ie,y:fe}=ce(G),de=ie-S,xe=fe-P;if(!(de*de+xe*xe>M*M))return;B()}if(!j()||!W){U(G);return}const X=v();_=ce(G,$),C=ni(qe(_,X,!1,[1,1]),n,d,W),k||(O(),k=!0);const Y=ys(G,{handle:C,connectionMode:t,fromNodeId:o,fromHandleId:s,fromType:i?"target":"source",isValidConnection:y,doc:A,lib:f,flowId:c,nodeLookup:d});H=Y.handleDomNode,R=Y.connection,V=si(!!C,Y.isValid);const te=d.get(o),ne=te?Ne(te,W,F.Left,!0):Q.from,ee={...Q,from:ne,isValid:V,to:Y.toHandle&&V?st({x:Y.toHandle.x,y:Y.toHandle.y},X):_,toHandle:Y.toHandle,toPosition:V&&Y.toHandle?Y.toHandle.position:nn[W.position],toNode:Y.toHandle?d.get(Y.toHandle.nodeId):null,pointer:_};u(ee),Q=ee}function U(G){if(!("touches"in G&&G.touches.length>0)){if(T){(C||H)&&R&&V&&(w==null||w(R));const{inProgress:X,...Y}=Q,te={...Y,toPosition:Q.toHandle?Q.toPosition:null};x==null||x(G,te),r&&(b==null||b(G,te))}m(),cancelAnimationFrame(D),k=!1,V=!1,R=null,H=null,A.removeEventListener("mousemove",q),A.removeEventListener("mouseup",U),A.removeEventListener("touchmove",q),A.removeEventListener("touchend",U)}}A.addEventListener("mousemove",q),A.addEventListener("mouseup",U),A.addEventListener("touchmove",q),A.addEventListener("touchend",U)}function ys(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:o,fromType:r,doc:i,lib:a,flowId:d,isValidConnection:f=xs,nodeLookup:p}){const c=r==="target",l=t?i.querySelector(`.${a}-flow__handle[data-id="${d}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:m,y:g}=ce(e),w=i.elementFromPoint(m,g),x=w!=null&&w.classList.contains(`${a}-flow__handle`)?w:l,y={handleDomNode:x,isValid:!1,connection:null,toHandle:null};if(x){const b=ms(void 0,x),u=x.getAttribute("data-nodeid"),v=x.getAttribute("data-handleid"),j=x.classList.contains("connectable"),E=x.classList.contains("connectableend");if(!u||!b)return y;const M={source:c?u:s,sourceHandle:c?v:o,target:c?s:u,targetHandle:c?o:v};y.connection=M;const A=j&&E&&(n===ke.Strict?c&&b==="source"||!c&&b==="target":u!==s||v!==o);y.isValid=A&&f(M),y.toHandle=ps(u,b,v,p,n,!0)}return y}const _t={onPointerDown:oi,isValid:ys};function ri({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const o=it(e);function r({translateExtent:a,width:d,height:f,zoomStep:p=1,pannable:c=!0,zoomable:l=!0,inversePan:m=!1}){const g=u=>{if(u.sourceEvent.type!=="wheel"||!t)return;const v=n(),j=u.sourceEvent.ctrlKey&&Fe()?10:1,E=-u.sourceEvent.deltaY*(u.sourceEvent.deltaMode===1?.05:u.sourceEvent.deltaMode?1:.002)*p,M=v[2]*Math.pow(2,E*j);t.scaleTo(M)};let w=[0,0];const x=u=>{(u.sourceEvent.type==="mousedown"||u.sourceEvent.type==="touchstart")&&(w=[u.sourceEvent.clientX??u.sourceEvent.touches[0].clientX,u.sourceEvent.clientY??u.sourceEvent.touches[0].clientY])},y=u=>{const v=n();if(u.sourceEvent.type!=="mousemove"&&u.sourceEvent.type!=="touchmove"||!t)return;const j=[u.sourceEvent.clientX??u.sourceEvent.touches[0].clientX,u.sourceEvent.clientY??u.sourceEvent.touches[0].clientY],E=[j[0]-w[0],j[1]-w[1]];w=j;const M=s()*Math.max(v[2],Math.log(v[2]))*(m?-1:1),N={x:v[0]-E[0]*M,y:v[1]-E[1]*M},A=[[0,0],[d,f]];t.setViewportConstrained({x:N.x,y:N.y,zoom:v[2]},A,a)},b=On().on("start",x).on("zoom",c?y:null).on("zoom.wheel",l?g:null);o.call(b,{})}function i(){o.on("zoom",null)}return{update:r,destroy:i,pointer:Fn}}const lt=e=>({x:e.x,y:e.y,zoom:e.k}),Et=({x:e,y:t,zoom:n})=>ur.translate(e,t).scale(n),je=(e,t)=>e.target.closest(`.${t}`),ws=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),ii=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,St=(e,t=0,n=ii,s=()=>{})=>{const o=typeof t=="number"&&t>0;return o||s(),o?e.transition().duration(t).ease(n).on("end",s):e},bs=e=>{const t=e.ctrlKey&&Fe()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function ai({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:o,panOnScrollSpeed:r,zoomOnPinch:i,onPanZoomStart:a,onPanZoom:d,onPanZoomEnd:f}){return p=>{if(je(p,t))return p.ctrlKey&&p.preventDefault(),!1;p.preventDefault(),p.stopImmediatePropagation();const c=n.property("__zoom").k||1;if(p.ctrlKey&&i){const x=Fn(p),y=bs(p),b=c*Math.pow(2,y);s.scaleTo(n,b,x,p);return}const l=p.deltaMode===1?20:1;let m=o===be.Vertical?0:p.deltaX*l,g=o===be.Horizontal?0:p.deltaY*l;!Fe()&&p.shiftKey&&o!==be.Vertical&&(m=p.deltaY*l,g=0),s.translateBy(n,-(m/c)*r,-(g/c)*r,{internal:!0});const w=lt(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(d==null||d(p,w),e.panScrollTimeout=setTimeout(()=>{f==null||f(p,w),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,a==null||a(p,w))}}function ci({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,o){const r=s.type==="wheel",i=!t&&r&&!s.ctrlKey,a=je(s,e);if(s.ctrlKey&&r&&a&&s.preventDefault(),i||a)return null;s.preventDefault(),n.call(this,s,o)}}function li({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var r,i,a;if((r=s.sourceEvent)!=null&&r.internal)return;const o=lt(s.transform);e.mouseButton=((i=s.sourceEvent)==null?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=o,((a=s.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,o))}}function di({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:o}){return r=>{var i,a;e.usedRightMouseButton=!!(n&&ws(t,e.mouseButton??0)),(i=r.sourceEvent)!=null&&i.sync||s([r.transform.x,r.transform.y,r.transform.k]),o&&!((a=r.sourceEvent)!=null&&a.internal)&&(o==null||o(r.sourceEvent,lt(r.transform)))}}function ui({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:o,onPaneContextMenu:r}){return i=>{var a;if(!((a=i.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,r&&ws(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&r(i.sourceEvent),e.usedRightMouseButton=!1,s(!1),o)){const d=lt(i.transform);e.prevViewport=d,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o==null||o(i.sourceEvent,d)},n?150:0)}}}function fi({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:o,zoomOnDoubleClick:r,userSelectionActive:i,noWheelClassName:a,noPanClassName:d,lib:f,connectionInProgress:p}){return c=>{var x;const l=e||t,m=n&&c.ctrlKey,g=c.type==="wheel";if(c.button===1&&c.type==="mousedown"&&(je(c,`${f}-flow__node`)||je(c,`${f}-flow__edge`)))return!0;if(!s&&!l&&!o&&!r&&!n||i||p&&!g||je(c,a)&&g||je(c,d)&&(!g||o&&g&&!e)||!n&&c.ctrlKey&&g)return!1;if(!n&&c.type==="touchstart"&&((x=c.touches)==null?void 0:x.length)>1)return c.preventDefault(),!1;if(!l&&!o&&!m&&g||!s&&(c.type==="mousedown"||c.type==="touchstart")||Array.isArray(s)&&!s.includes(c.button)&&c.type==="mousedown")return!1;const w=Array.isArray(s)&&s.includes(c.button)||!c.button||c.button<=1;return(!c.ctrlKey||g)&&w}}function gi({domNode:e,minZoom:t,maxZoom:n,translateExtent:s,viewport:o,onPanZoom:r,onPanZoomStart:i,onPanZoomEnd:a,onDraggingChange:d}){const f={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},p=e.getBoundingClientRect(),c=On().scaleExtent([t,n]).translateExtent(s),l=it(e).call(c);b({x:o.x,y:o.y,zoom:Ae(o.zoom,t,n)},[[0,0],[p.width,p.height]],s);const m=l.on("wheel.zoom"),g=l.on("dblclick.zoom");c.wheelDelta(bs);function w(C,S){return l?new Promise(P=>{c==null||c.interpolate((S==null?void 0:S.interpolate)==="linear"?yt:xt).transform(St(l,S==null?void 0:S.duration,S==null?void 0:S.ease,()=>P(!0)),C)}):Promise.resolve(!1)}function x({noWheelClassName:C,noPanClassName:S,onPaneContextMenu:P,userSelectionActive:L,panOnScroll:$,panOnDrag:T,panOnScrollMode:z,panOnScrollSpeed:_,preventScrolling:k,zoomOnPinch:R,zoomOnScroll:V,zoomOnDoubleClick:H,zoomActivationKeyPressed:O,lib:W,onTransformChange:K,connectionInProgress:Z,paneClickDistance:Q,selectionOnDrag:B}){L&&!f.isZoomingOrPanning&&y();const q=$&&!O&&!L;c.clickDistance(B?1/0:!ae(Q)||Q<0?0:Q);const U=q?ai({zoomPanValues:f,noWheelClassName:C,d3Selection:l,d3Zoom:c,panOnScrollMode:z,panOnScrollSpeed:_,zoomOnPinch:R,onPanZoomStart:i,onPanZoom:r,onPanZoomEnd:a}):ci({noWheelClassName:C,preventScrolling:k,d3ZoomHandler:m});if(l.on("wheel.zoom",U,{passive:!1}),!L){const X=li({zoomPanValues:f,onDraggingChange:d,onPanZoomStart:i});c.on("start",X);const Y=di({zoomPanValues:f,panOnDrag:T,onPaneContextMenu:!!P,onPanZoom:r,onTransformChange:K});c.on("zoom",Y);const te=ui({zoomPanValues:f,panOnDrag:T,panOnScroll:$,onPaneContextMenu:P,onPanZoomEnd:a,onDraggingChange:d});c.on("end",te)}const G=fi({zoomActivationKeyPressed:O,panOnDrag:T,zoomOnScroll:V,panOnScroll:$,zoomOnDoubleClick:H,zoomOnPinch:R,userSelectionActive:L,noPanClassName:S,noWheelClassName:C,lib:W,connectionInProgress:Z});c.filter(G),H?l.on("dblclick.zoom",g):l.on("dblclick.zoom",null)}function y(){c.on("zoom",null)}async function b(C,S,P){const L=Et(C),$=c==null?void 0:c.constrain()(L,S,P);return $&&await w($),new Promise(T=>T($))}async function u(C,S){const P=Et(C);return await w(P,S),new Promise(L=>L(P))}function v(C){if(l){const S=Et(C),P=l.property("__zoom");(P.k!==C.zoom||P.x!==C.x||P.y!==C.y)&&(c==null||c.transform(l,S,null,{sync:!0}))}}function j(){const C=l?fr(l.node()):{x:0,y:0,k:1};return{x:C.x,y:C.y,zoom:C.k}}function E(C,S){return l?new Promise(P=>{c==null||c.interpolate((S==null?void 0:S.interpolate)==="linear"?yt:xt).scaleTo(St(l,S==null?void 0:S.duration,S==null?void 0:S.ease,()=>P(!0)),C)}):Promise.resolve(!1)}function M(C,S){return l?new Promise(P=>{c==null||c.interpolate((S==null?void 0:S.interpolate)==="linear"?yt:xt).scaleBy(St(l,S==null?void 0:S.duration,S==null?void 0:S.ease,()=>P(!0)),C)}):Promise.resolve(!1)}function N(C){c==null||c.scaleExtent(C)}function A(C){c==null||c.translateExtent(C)}function D(C){const S=!ae(C)||C<0?0:C;c==null||c.clickDistance(S)}return{update:x,destroy:y,setViewport:u,setViewportConstrained:b,getViewport:j,scaleTo:E,scaleBy:M,setScaleExtent:N,setTranslateExtent:A,syncViewport:v,setClickDistance:D}}var $e;(function(e){e.Line="line",e.Handle="handle"})($e||($e={}));function hi({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:o,affectsY:r}){const i=e-t,a=n-s,d=[i>0?1:i<0?-1:0,a>0?1:a<0?-1:0];return i&&o&&(d[0]=d[0]*-1),a&&r&&(d[1]=d[1]*-1),d}function mn(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:o}}function ge(e,t){return Math.max(0,t-e)}function he(e,t){return Math.max(0,e-t)}function Ue(e,t,n){return Math.max(0,t-e,e-n)}function xn(e,t){return e?!t:t}function pi(e,t,n,s,o,r,i,a){let{affectsX:d,affectsY:f}=t;const{isHorizontal:p,isVertical:c}=t,l=p&&c,{xSnapped:m,ySnapped:g}=n,{minWidth:w,maxWidth:x,minHeight:y,maxHeight:b}=s,{x:u,y:v,width:j,height:E,aspectRatio:M}=e;let N=Math.floor(p?m-e.pointerX:0),A=Math.floor(c?g-e.pointerY:0);const D=j+(d?-N:N),C=E+(f?-A:A),S=-r[0]*j,P=-r[1]*E;let L=Ue(D,w,x),$=Ue(C,y,b);if(i){let _=0,k=0;d&&N<0?_=ge(u+N+S,i[0][0]):!d&&N>0&&(_=he(u+D+S,i[1][0])),f&&A<0?k=ge(v+A+P,i[0][1]):!f&&A>0&&(k=he(v+C+P,i[1][1])),L=Math.max(L,_),$=Math.max($,k)}if(a){let _=0,k=0;d&&N>0?_=he(u+N,a[0][0]):!d&&N<0&&(_=ge(u+D,a[1][0])),f&&A>0?k=he(v+A,a[0][1]):!f&&A<0&&(k=ge(v+C,a[1][1])),L=Math.max(L,_),$=Math.max($,k)}if(o){if(p){const _=Ue(D/M,y,b)*M;if(L=Math.max(L,_),i){let k=0;!d&&!f||d&&!f&&l?k=he(v+P+D/M,i[1][1])*M:k=ge(v+P+(d?N:-N)/M,i[0][1])*M,L=Math.max(L,k)}if(a){let k=0;!d&&!f||d&&!f&&l?k=ge(v+D/M,a[1][1])*M:k=he(v+(d?N:-N)/M,a[0][1])*M,L=Math.max(L,k)}}if(c){const _=Ue(C*M,w,x)/M;if($=Math.max($,_),i){let k=0;!d&&!f||f&&!d&&l?k=he(u+C*M+S,i[1][0])/M:k=ge(u+(f?A:-A)*M+S,i[0][0])/M,$=Math.max($,k)}if(a){let k=0;!d&&!f||f&&!d&&l?k=ge(u+C*M,a[1][0])/M:k=he(u+(f?A:-A)*M,a[0][0])/M,$=Math.max($,k)}}}A=A+(A<0?$:-$),N=N+(N<0?L:-L),o&&(l?D>C*M?A=(xn(d,f)?-N:N)/M:N=(xn(d,f)?-A:A)*M:p?(A=N/M,f=d):(N=A*M,d=f));const T=d?u+N:u,z=f?v+A:v;return{width:j+(d?-N:N),height:E+(f?-A:A),x:r[0]*N*(d?-1:1)+T,y:r[1]*A*(f?-1:1)+z}}const vs={width:0,height:0,x:0,y:0},mi={...vs,pointerX:0,pointerY:0,aspectRatio:1};function xi(e){return[[0,0],[e.measured.width,e.measured.height]]}function yi(e,t,n){const s=t.position.x+e.position.x,o=t.position.y+e.position.y,r=e.measured.width??0,i=e.measured.height??0,a=n[0]*r,d=n[1]*i;return[[s-a,o-d],[s+r-a,o+i-d]]}function wi({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:o}){const r=it(e);let i={controlDirection:mn("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:f,boundaries:p,keepAspectRatio:c,resizeDirection:l,onResizeStart:m,onResize:g,onResizeEnd:w,shouldResize:x}){let y={...vs},b={...mi};i={boundaries:p,resizeDirection:l,keepAspectRatio:c,controlDirection:mn(f)};let u,v=null,j=[],E,M,N,A=!1;const D=Yn().on("start",C=>{const{nodeLookup:S,transform:P,snapGrid:L,snapToGrid:$,nodeOrigin:T,paneDomNode:z}=n();if(u=S.get(t),!u)return;v=(z==null?void 0:z.getBoundingClientRect())??null;const{xSnapped:_,ySnapped:k}=Te(C.sourceEvent,{transform:P,snapGrid:L,snapToGrid:$,containerBounds:v});y={width:u.measured.width??0,height:u.measured.height??0,x:u.position.x??0,y:u.position.y??0},b={...y,pointerX:_,pointerY:k,aspectRatio:y.width/y.height},E=void 0,u.parentId&&(u.extent==="parent"||u.expandParent)&&(E=S.get(u.parentId),M=E&&u.extent==="parent"?xi(E):void 0),j=[],N=void 0;for(const[R,V]of S)if(V.parentId===t&&(j.push({id:R,position:{...V.position},extent:V.extent}),V.extent==="parent"||V.expandParent)){const H=yi(V,u,V.origin??T);N?N=[[Math.min(H[0][0],N[0][0]),Math.min(H[0][1],N[0][1])],[Math.max(H[1][0],N[1][0]),Math.max(H[1][1],N[1][1])]]:N=H}m==null||m(C,{...y})}).on("drag",C=>{const{transform:S,snapGrid:P,snapToGrid:L,nodeOrigin:$}=n(),T=Te(C.sourceEvent,{transform:S,snapGrid:P,snapToGrid:L,containerBounds:v}),z=[];if(!u)return;const{x:_,y:k,width:R,height:V}=y,H={},O=u.origin??$,{width:W,height:K,x:Z,y:Q}=pi(b,i.controlDirection,T,i.boundaries,i.keepAspectRatio,O,M,N),B=W!==R,q=K!==V,U=Z!==_&&B,G=Q!==k&&q;if(!U&&!G&&!B&&!q)return;if((U||G||O[0]===1||O[1]===1)&&(H.x=U?Z:y.x,H.y=G?Q:y.y,y.x=H.x,y.y=H.y,j.length>0)){const ne=Z-_,ee=Q-k;for(const ie of j)ie.position={x:ie.position.x-ne+O[0]*(W-R),y:ie.position.y-ee+O[1]*(K-V)},z.push(ie)}if((B||q)&&(H.width=B&&(!i.resizeDirection||i.resizeDirection==="horizontal")?W:y.width,H.height=q&&(!i.resizeDirection||i.resizeDirection==="vertical")?K:y.height,y.width=H.width,y.height=H.height),E&&u.expandParent){const ne=O[0]*(H.width??0);H.x&&H.x<ne&&(y.x=ne,b.x=b.x-(H.x-ne));const ee=O[1]*(H.height??0);H.y&&H.y<ee&&(y.y=ee,b.y=b.y-(H.y-ee))}const X=hi({width:y.width,prevWidth:R,height:y.height,prevHeight:V,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),Y={...y,direction:X};(x==null?void 0:x(C,Y))!==!1&&(A=!0,g==null||g(C,Y),s(H,z))}).on("end",C=>{A&&(w==null||w(C,{...y}),o==null||o({...y}),A=!1)});r.call(D)}function d(){r.on(".drag",null)}return{update:a,destroy:d}}const{useDebugValue:bi}=dr,{useSyncExternalStoreWithSelector:vi}=cr,Ni=e=>e;function Ns(e,t=Ni,n){const s=vi(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return bi(s),s}const yn=(e,t)=>{const n=ar(e),s=(o,r=t)=>Ns(n,o,r);return Object.assign(s,n),s},Ei=(e,t)=>e?yn(e,t):yn;function se(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,o]of e)if(!Object.is(o,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const dt=I.createContext(null),Si=dt.Provider,Es=le.error001();function J(e,t){const n=I.useContext(dt);if(n===null)throw new Error(Es);return Ns(n,e,t)}function oe(){const e=I.useContext(dt);if(e===null)throw new Error(Es);return I.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const wn={display:"none"},Ci={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ss="react-flow__node-desc",Cs="react-flow__edge-desc",Mi="react-flow__aria-live",ji=e=>e.ariaLiveMessage,Ii=e=>e.ariaLabelConfig;function ki({rfId:e}){const t=J(ji);return h.jsx("div",{id:`${Mi}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Ci,children:t})}function Ai({rfId:e,disableKeyboardA11y:t}){const n=J(Ii);return h.jsxs(h.Fragment,{children:[h.jsx("div",{id:`${Ss}-${e}`,style:wn,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),h.jsx("div",{id:`${Cs}-${e}`,style:wn,children:n["edge.a11yDescription.default"]}),!t&&h.jsx(ki,{rfId:e})]})}const ut=I.forwardRef(({position:e="top-left",children:t,className:n,style:s,...o},r)=>{const i=`${e}`.split("-");return h.jsx("div",{className:re(["react-flow__panel",n,...i]),style:s,ref:r,...o,children:t})});ut.displayName="Panel";function _i({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:h.jsx(ut,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:h.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Pi=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},Je=e=>e.id;function $i(e,t){return se(e.selectedNodes.map(Je),t.selectedNodes.map(Je))&&se(e.selectedEdges.map(Je),t.selectedEdges.map(Je))}function Li({onSelectionChange:e}){const t=oe(),{selectedNodes:n,selectedEdges:s}=J(Pi,$i);return I.useEffect(()=>{const o={nodes:n,edges:s};e==null||e(o),t.getState().onSelectionChangeHandlers.forEach(r=>r(o))},[n,s,e]),null}const zi=e=>!!e.onSelectionChangeHandlers;function Hi({onSelectionChange:e}){const t=J(zi);return e||t?h.jsx(Li,{onSelectionChange:e}):null}const Ms=[0,0],Di={x:0,y:0,zoom:1},Ti=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],bn=[...Ti,"rfId"],Ri=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),vn={translateExtent:Re,nodeOrigin:Ms,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function Bi(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:o,setTranslateExtent:r,setNodeExtent:i,reset:a,setDefaultNodesAndEdges:d}=J(Ri,se),f=oe();I.useEffect(()=>(d(e.defaultNodes,e.defaultEdges),()=>{p.current=vn,a()}),[]);const p=I.useRef(vn);return I.useEffect(()=>{for(const c of bn){const l=e[c],m=p.current[c];l!==m&&(typeof e[c]>"u"||(c==="nodes"?t(l):c==="edges"?n(l):c==="minZoom"?s(l):c==="maxZoom"?o(l):c==="translateExtent"?r(l):c==="nodeExtent"?i(l):c==="ariaLabelConfig"?f.setState({ariaLabelConfig:_r(l)}):c==="fitView"?f.setState({fitViewQueued:l}):c==="fitViewOptions"?f.setState({fitViewOptions:l}):f.setState({[c]:l})))}p.current=e},bn.map(c=>e[c])),null}function Nn(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Vi(e){var s;const[t,n]=I.useState(e==="system"?null:e);return I.useEffect(()=>{if(e!=="system"){n(e);return}const o=Nn(),r=()=>n(o!=null&&o.matches?"dark":"light");return r(),o==null||o.addEventListener("change",r),()=>{o==null||o.removeEventListener("change",r)}},[e]),t!==null?t:(s=Nn())!=null&&s.matches?"dark":"light"}const En=typeof document<"u"?document:null;function Oe(e=null,t={target:En,actInsideInputWithModifier:!0}){const[n,s]=I.useState(!1),o=I.useRef(!1),r=I.useRef(new Set([])),[i,a]=I.useMemo(()=>{if(e!==null){const f=(Array.isArray(e)?e:[e]).filter(c=>typeof c=="string").map(c=>c.replace("+",`
`).replace(`

`,`
+`).split(`
`)),p=f.reduce((c,l)=>c.concat(...l),[]);return[f,p]}return[[],[]]},[e]);return I.useEffect(()=>{const d=(t==null?void 0:t.target)??En,f=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const p=m=>{var x,y;if(o.current=m.ctrlKey||m.metaKey||m.shiftKey||m.altKey,(!o.current||o.current&&!f)&&rs(m))return!1;const w=Cn(m.code,a);if(r.current.add(m[w]),Sn(i,r.current,!1)){const b=((y=(x=m.composedPath)==null?void 0:x.call(m))==null?void 0:y[0])||m.target,u=(b==null?void 0:b.nodeName)==="BUTTON"||(b==null?void 0:b.nodeName)==="A";t.preventDefault!==!1&&(o.current||!u)&&m.preventDefault(),s(!0)}},c=m=>{const g=Cn(m.code,a);Sn(i,r.current,!0)?(s(!1),r.current.clear()):r.current.delete(m[g]),m.key==="Meta"&&r.current.clear(),o.current=!1},l=()=>{r.current.clear(),s(!1)};return d==null||d.addEventListener("keydown",p),d==null||d.addEventListener("keyup",c),window.addEventListener("blur",l),window.addEventListener("contextmenu",l),()=>{d==null||d.removeEventListener("keydown",p),d==null||d.removeEventListener("keyup",c),window.removeEventListener("blur",l),window.removeEventListener("contextmenu",l)}}},[e,s]),n}function Sn(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(o=>t.has(o)))}function Cn(e,t){return t.includes(e)?"code":"key"}const Fi=()=>{const e=oe();return I.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,o,r],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??s,y:t.y??o,zoom:t.zoom??r},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:o,minZoom:r,maxZoom:i,panZoom:a}=e.getState(),d=zt(t,s,o,r,i,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(d,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:o,snapToGrid:r,domNode:i}=e.getState();if(!i)return t;const{x:a,y:d}=i.getBoundingClientRect(),f={x:t.x-a,y:t.y-d},p=n.snapGrid??o,c=n.snapToGrid??r;return qe(f,s,c,p)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:o,y:r}=s.getBoundingClientRect(),i=st(t,n);return{x:i.x+o,y:i.y+r}}}),[])};function js(e,t){const n=[],s=new Map,o=[];for(const r of e)if(r.type==="add"){o.push(r);continue}else if(r.type==="remove"||r.type==="replace")s.set(r.id,[r]);else{const i=s.get(r.id);i?i.push(r):s.set(r.id,[r])}for(const r of t){const i=s.get(r.id);if(!i){n.push(r);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const a={...r};for(const d of i)Oi(d,a);n.push(a)}return o.length&&o.forEach(r=>{r.index!==void 0?n.splice(r.index,0,{...r.item}):n.push({...r.item})}),n}function Oi(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Is(e,t){return js(e,t)}function ks(e,t){return js(e,t)}function we(e,t){return{id:e,type:"select",selected:t}}function Ie(e,t=new Set,n=!1){const s=[];for(const[o,r]of e){const i=t.has(o);!(r.selected===void 0&&!i)&&r.selected!==i&&(n&&(r.selected=i),s.push(we(r.id,i)))}return s}function Mn({items:e=[],lookup:t}){var o;const n=[],s=new Map(e.map(r=>[r.id,r]));for(const[r,i]of e.entries()){const a=t.get(i.id),d=((o=a==null?void 0:a.internals)==null?void 0:o.userNode)??a;d!==void 0&&d!==i&&n.push({id:i.id,item:i,type:"replace"}),d===void 0&&n.push({item:i,type:"add",index:r})}for(const[r]of t)s.get(r)===void 0&&n.push({id:r,type:"remove"});return n}function jn(e){return{id:e.id,type:"remove"}}const In=e=>vr(e),Yi=e=>Qn(e);function As(e){return I.forwardRef(e)}const Wi=typeof window<"u"?I.useLayoutEffect:I.useEffect;function kn(e){const[t,n]=I.useState(BigInt(0)),[s]=I.useState(()=>Xi(()=>n(o=>o+BigInt(1))));return Wi(()=>{const o=s.get();o.length&&(e(o),s.reset())},[t]),s}function Xi(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const _s=I.createContext(null);function qi({children:e}){const t=oe(),n=I.useCallback(a=>{const{nodes:d=[],setNodes:f,hasDefaultNodes:p,onNodesChange:c,nodeLookup:l,fitViewQueued:m,onNodesChangeMiddlewareMap:g}=t.getState();let w=d;for(const y of a)w=typeof y=="function"?y(w):y;let x=Mn({items:w,lookup:l});for(const y of g.values())x=y(x);p&&f(w),x.length>0?c==null||c(x):m&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:b,setNodes:u}=t.getState();y&&u(b)})},[]),s=kn(n),o=I.useCallback(a=>{const{edges:d=[],setEdges:f,hasDefaultEdges:p,onEdgesChange:c,edgeLookup:l}=t.getState();let m=d;for(const g of a)m=typeof g=="function"?g(m):g;p?f(m):c&&c(Mn({items:m,lookup:l}))},[]),r=kn(o),i=I.useMemo(()=>({nodeQueue:s,edgeQueue:r}),[]);return h.jsx(_s.Provider,{value:i,children:e})}function Gi(){const e=I.useContext(_s);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Ki=e=>!!e.panZoom;function Ft(){const e=Fi(),t=oe(),n=Gi(),s=J(Ki),o=I.useMemo(()=>{const r=c=>t.getState().nodeLookup.get(c),i=c=>{n.nodeQueue.push(c)},a=c=>{n.edgeQueue.push(c)},d=c=>{var y,b;const{nodeLookup:l,nodeOrigin:m}=t.getState(),g=In(c)?c:l.get(c.id),w=g.parentId?ss(g.position,g.measured,g.parentId,l,m):g.position,x={...g,position:w,width:((y=g.measured)==null?void 0:y.width)??g.width,height:((b=g.measured)==null?void 0:b.height)??g.height};return _e(x)},f=(c,l,m={replace:!1})=>{i(g=>g.map(w=>{if(w.id===c){const x=typeof l=="function"?l(w):l;return m.replace&&In(x)?x:{...w,...x}}return w}))},p=(c,l,m={replace:!1})=>{a(g=>g.map(w=>{if(w.id===c){const x=typeof l=="function"?l(w):l;return m.replace&&Yi(x)?x:{...w,...x}}return w}))};return{getNodes:()=>t.getState().nodes.map(c=>({...c})),getNode:c=>{var l;return(l=r(c))==null?void 0:l.internals.userNode},getInternalNode:r,getEdges:()=>{const{edges:c=[]}=t.getState();return c.map(l=>({...l}))},getEdge:c=>t.getState().edgeLookup.get(c),setNodes:i,setEdges:a,addNodes:c=>{const l=Array.isArray(c)?c:[c];n.nodeQueue.push(m=>[...m,...l])},addEdges:c=>{const l=Array.isArray(c)?c:[c];n.edgeQueue.push(m=>[...m,...l])},toObject:()=>{const{nodes:c=[],edges:l=[],transform:m}=t.getState(),[g,w,x]=m;return{nodes:c.map(y=>({...y})),edges:l.map(y=>({...y})),viewport:{x:g,y:w,zoom:x}}},deleteElements:async({nodes:c=[],edges:l=[]})=>{const{nodes:m,edges:g,onNodesDelete:w,onEdgesDelete:x,triggerNodeChanges:y,triggerEdgeChanges:b,onDelete:u,onBeforeDelete:v}=t.getState(),{nodes:j,edges:E}=await Mr({nodesToRemove:c,edgesToRemove:l,nodes:m,edges:g,onBeforeDelete:v}),M=E.length>0,N=j.length>0;if(M){const A=E.map(jn);x==null||x(E),b(A)}if(N){const A=j.map(jn);w==null||w(j),y(A)}return(N||M)&&(u==null||u({nodes:j,edges:E})),{deletedNodes:j,deletedEdges:E}},getIntersectingNodes:(c,l=!0,m)=>{const g=on(c),w=g?c:d(c),x=m!==void 0;return w?(m||t.getState().nodes).filter(y=>{const b=t.getState().nodeLookup.get(y.id);if(b&&!g&&(y.id===c.id||!b.internals.positionAbsolute))return!1;const u=_e(x?y:b),v=Ve(u,w);return l&&v>0||v>=u.width*u.height||v>=w.width*w.height}):[]},isNodeIntersecting:(c,l,m=!0)=>{const w=on(c)?c:d(c);if(!w)return!1;const x=Ve(w,l);return m&&x>0||x>=l.width*l.height||x>=w.width*w.height},updateNode:f,updateNodeData:(c,l,m={replace:!1})=>{f(c,g=>{const w=typeof l=="function"?l(g):l;return m.replace?{...g,data:w}:{...g,data:{...g.data,...w}}},m)},updateEdge:p,updateEdgeData:(c,l,m={replace:!1})=>{p(c,g=>{const w=typeof l=="function"?l(g):l;return m.replace?{...g,data:w}:{...g,data:{...g.data,...w}}},m)},getNodesBounds:c=>{const{nodeLookup:l,nodeOrigin:m}=t.getState();return Nr(c,{nodeLookup:l,nodeOrigin:m})},getHandleConnections:({type:c,id:l,nodeId:m})=>{var g;return Array.from(((g=t.getState().connectionLookup.get(`${m}-${c}${l?`-${l}`:""}`))==null?void 0:g.values())??[])},getNodeConnections:({type:c,handleId:l,nodeId:m})=>{var g;return Array.from(((g=t.getState().connectionLookup.get(`${m}${c?l?`-${c}-${l}`:`-${c}`:""}`))==null?void 0:g.values())??[])},fitView:async c=>{const l=t.getState().fitViewResolver??Ar();return t.setState({fitViewQueued:!0,fitViewOptions:c,fitViewResolver:l}),n.nodeQueue.push(m=>[...m]),l.promise}}},[]);return I.useMemo(()=>({...o,...e,viewportInitialized:s}),[s])}const An=e=>e.selected,Zi=typeof window<"u"?window:void 0;function Qi({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=oe(),{deleteElements:s}=Ft(),o=Oe(e,{actInsideInputWithModifier:!1}),r=Oe(t,{target:Zi});I.useEffect(()=>{if(o){const{edges:i,nodes:a}=n.getState();s({nodes:a.filter(An),edges:i.filter(An)}),n.setState({nodesSelectionActive:!1})}},[o]),I.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}function Ui(e){const t=oe();I.useEffect(()=>{const n=()=>{var o,r,i,a;if(!e.current||!(((r=(o=e.current).checkVisibility)==null?void 0:r.call(o))??!0))return!1;const s=Ht(e.current);(s.height===0||s.width===0)&&((a=(i=t.getState()).onError)==null||a.call(i,"004",le.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const ft={position:"absolute",width:"100%",height:"100%",top:0,left:0},Ji=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function ea({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:o=.5,panOnScrollMode:r=be.Free,zoomOnDoubleClick:i=!0,panOnDrag:a=!0,defaultViewport:d,translateExtent:f,minZoom:p,maxZoom:c,zoomActivationKeyCode:l,preventScrolling:m=!0,children:g,noWheelClassName:w,noPanClassName:x,onViewportChange:y,isControlledViewport:b,paneClickDistance:u,selectionOnDrag:v}){const j=oe(),E=I.useRef(null),{userSelectionActive:M,lib:N,connectionInProgress:A}=J(Ji,se),D=Oe(l),C=I.useRef();Ui(E);const S=I.useCallback(P=>{y==null||y({x:P[0],y:P[1],zoom:P[2]}),b||j.setState({transform:P})},[y,b]);return I.useEffect(()=>{if(E.current){C.current=gi({domNode:E.current,minZoom:p,maxZoom:c,translateExtent:f,viewport:d,onDraggingChange:T=>j.setState({paneDragging:T}),onPanZoomStart:(T,z)=>{const{onViewportChangeStart:_,onMoveStart:k}=j.getState();k==null||k(T,z),_==null||_(z)},onPanZoom:(T,z)=>{const{onViewportChange:_,onMove:k}=j.getState();k==null||k(T,z),_==null||_(z)},onPanZoomEnd:(T,z)=>{const{onViewportChangeEnd:_,onMoveEnd:k}=j.getState();k==null||k(T,z),_==null||_(z)}});const{x:P,y:L,zoom:$}=C.current.getViewport();return j.setState({panZoom:C.current,transform:[P,L,$],domNode:E.current.closest(".react-flow")}),()=>{var T;(T=C.current)==null||T.destroy()}}},[]),I.useEffect(()=>{var P;(P=C.current)==null||P.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:o,panOnScrollMode:r,zoomOnDoubleClick:i,panOnDrag:a,zoomActivationKeyPressed:D,preventScrolling:m,noPanClassName:x,userSelectionActive:M,noWheelClassName:w,lib:N,onTransformChange:S,connectionInProgress:A,selectionOnDrag:v,paneClickDistance:u})},[e,t,n,s,o,r,i,a,D,m,x,M,w,N,S,A,v,u]),h.jsx("div",{className:"react-flow__renderer",ref:E,style:ft,children:g})}const ta=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function na(){const{userSelectionActive:e,userSelectionRect:t}=J(ta,se);return e&&t?h.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Ct=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},sa=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function oa({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Be.Full,panOnDrag:s,paneClickDistance:o,selectionOnDrag:r,onSelectionStart:i,onSelectionEnd:a,onPaneClick:d,onPaneContextMenu:f,onPaneScroll:p,onPaneMouseEnter:c,onPaneMouseMove:l,onPaneMouseLeave:m,children:g}){const w=oe(),{userSelectionActive:x,elementsSelectable:y,dragging:b,connectionInProgress:u}=J(sa,se),v=y&&(e||x),j=I.useRef(null),E=I.useRef(),M=I.useRef(new Set),N=I.useRef(new Set),A=I.useRef(!1),D=_=>{if(A.current||u){A.current=!1;return}d==null||d(_),w.getState().resetSelectedElements(),w.setState({nodesSelectionActive:!1})},C=_=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){_.preventDefault();return}f==null||f(_)},S=p?_=>p(_):void 0,P=_=>{A.current&&(_.stopPropagation(),A.current=!1)},L=_=>{var K,Z;const{domNode:k}=w.getState();if(E.current=k==null?void 0:k.getBoundingClientRect(),!E.current)return;const R=_.target===j.current;if(!R&&!!_.target.closest(".nokey")||!e||!(r&&R||t)||_.button!==0||!_.isPrimary)return;(Z=(K=_.target)==null?void 0:K.setPointerCapture)==null||Z.call(K,_.pointerId),A.current=!1;const{x:O,y:W}=ce(_.nativeEvent,E.current);w.setState({userSelectionRect:{width:0,height:0,startX:O,startY:W,x:O,y:W}}),R||(_.stopPropagation(),_.preventDefault())},$=_=>{const{userSelectionRect:k,transform:R,nodeLookup:V,edgeLookup:H,connectionLookup:O,triggerNodeChanges:W,triggerEdgeChanges:K,defaultEdgeOptions:Z,resetSelectedElements:Q}=w.getState();if(!E.current||!k)return;const{x:B,y:q}=ce(_.nativeEvent,E.current),{startX:U,startY:G}=k;if(!A.current){const ee=t?0:o;if(Math.hypot(B-U,q-G)<=ee)return;Q(),i==null||i(_)}A.current=!0;const X={startX:U,startY:G,x:B<U?B:U,y:q<G?q:G,width:Math.abs(B-U),height:Math.abs(q-G)},Y=M.current,te=N.current;M.current=new Set(Lt(V,X,R,n===Be.Partial,!0).map(ee=>ee.id)),N.current=new Set;const ne=(Z==null?void 0:Z.selectable)??!0;for(const ee of M.current){const ie=O.get(ee);if(ie)for(const{edgeId:fe}of ie.values()){const de=H.get(fe);de&&(de.selectable??ne)&&N.current.add(fe)}}if(!rn(Y,M.current)){const ee=Ie(V,M.current,!0);W(ee)}if(!rn(te,N.current)){const ee=Ie(H,N.current);K(ee)}w.setState({userSelectionRect:X,userSelectionActive:!0,nodesSelectionActive:!1})},T=_=>{var k,R;_.button===0&&((R=(k=_.target)==null?void 0:k.releasePointerCapture)==null||R.call(k,_.pointerId),!x&&_.target===j.current&&w.getState().userSelectionRect&&(D==null||D(_)),w.setState({userSelectionActive:!1,userSelectionRect:null}),A.current&&(a==null||a(_),w.setState({nodesSelectionActive:M.current.size>0})))},z=s===!0||Array.isArray(s)&&s.includes(0);return h.jsxs("div",{className:re(["react-flow__pane",{draggable:z,dragging:b,selection:e}]),onClick:v?void 0:Ct(D,j),onContextMenu:Ct(C,j),onWheel:Ct(S,j),onPointerEnter:v?void 0:c,onPointerMove:v?$:l,onPointerUp:v?T:void 0,onPointerDownCapture:v?L:void 0,onClickCapture:v?P:void 0,onPointerLeave:m,ref:j,style:ft,children:[g,h.jsx(na,{})]})}function Pt({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:o,unselectNodesAndEdges:r,multiSelectionActive:i,nodeLookup:a,onError:d}=t.getState(),f=a.get(e);if(!f){d==null||d("012",le.error012(e));return}t.setState({nodesSelectionActive:!1}),f.selected?(n||f.selected&&i)&&(r({nodes:[f],edges:[]}),requestAnimationFrame(()=>{var p;return(p=s==null?void 0:s.current)==null?void 0:p.blur()})):o([e])}function Ps({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:o,isSelectable:r,nodeClickDistance:i}){const a=oe(),[d,f]=I.useState(!1),p=I.useRef();return I.useEffect(()=>{p.current=Jr({getStoreItems:()=>a.getState(),onNodeMouseDown:c=>{Pt({id:c,store:a,nodeRef:e})},onDragStart:()=>{f(!0)},onDragStop:()=>{f(!1)}})},[]),I.useEffect(()=>{var c,l;if(t)(c=p.current)==null||c.destroy();else if(e.current)return(l=p.current)==null||l.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:r,nodeId:o,nodeClickDistance:i}),()=>{var m;(m=p.current)==null||m.destroy()}},[n,s,t,r,e,o]),d}const ra=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function $s(){const e=oe();return I.useCallback(n=>{const{nodeExtent:s,snapToGrid:o,snapGrid:r,nodesDraggable:i,onError:a,updateNodePositions:d,nodeLookup:f,nodeOrigin:p}=e.getState(),c=new Map,l=ra(i),m=o?r[0]:5,g=o?r[1]:5,w=n.direction.x*m*n.factor,x=n.direction.y*g*n.factor;for(const[,y]of f){if(!l(y))continue;let b={x:y.internals.positionAbsolute.x+w,y:y.internals.positionAbsolute.y+x};o&&(b=Xe(b,r));const{position:u,positionAbsolute:v}=Un({nodeId:y.id,nextPosition:b,nodeLookup:f,nodeExtent:s,nodeOrigin:p,onError:a});y.position=u,y.internals.positionAbsolute=v,c.set(y.id,y)}d(c)},[])}const Ot=I.createContext(null),ia=Ot.Provider;Ot.Consumer;const Ls=()=>I.useContext(Ot),aa=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),ca=(e,t,n)=>s=>{const{connectionClickStartHandle:o,connectionMode:r,connection:i}=s,{fromHandle:a,toHandle:d,isValid:f}=i,p=(d==null?void 0:d.nodeId)===e&&(d==null?void 0:d.id)===t&&(d==null?void 0:d.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:p,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===n,isPossibleEndHandle:r===ke.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!o,valid:p&&f}};function la({type:e="source",position:t=F.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:o=!0,isConnectableEnd:r=!0,id:i,onConnect:a,children:d,className:f,onMouseDown:p,onTouchStart:c,...l},m){var $,T;const g=i||null,w=e==="target",x=oe(),y=Ls(),{connectOnClick:b,noPanClassName:u,rfId:v}=J(aa,se),{connectingFrom:j,connectingTo:E,clickConnecting:M,isPossibleEndHandle:N,connectionInProcess:A,clickConnectionInProcess:D,valid:C}=J(ca(y,g,e),se);y||(T=($=x.getState()).onError)==null||T.call($,"010",le.error010());const S=z=>{const{defaultEdgeOptions:_,onConnect:k,hasDefaultEdges:R}=x.getState(),V={..._,...z};if(R){const{edges:H,setEdges:O}=x.getState();O(Dr(V,H))}k==null||k(V),a==null||a(V)},P=z=>{if(!y)return;const _=is(z.nativeEvent);if(o&&(_&&z.button===0||!_)){const k=x.getState();_t.onPointerDown(z.nativeEvent,{handleDomNode:z.currentTarget,autoPanOnConnect:k.autoPanOnConnect,connectionMode:k.connectionMode,connectionRadius:k.connectionRadius,domNode:k.domNode,nodeLookup:k.nodeLookup,lib:k.lib,isTarget:w,handleId:g,nodeId:y,flowId:k.rfId,panBy:k.panBy,cancelConnection:k.cancelConnection,onConnectStart:k.onConnectStart,onConnectEnd:k.onConnectEnd,updateConnection:k.updateConnection,onConnect:S,isValidConnection:n||k.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:k.autoPanSpeed,dragThreshold:k.connectionDragThreshold})}_?p==null||p(z):c==null||c(z)},L=z=>{const{onClickConnectStart:_,onClickConnectEnd:k,connectionClickStartHandle:R,connectionMode:V,isValidConnection:H,lib:O,rfId:W,nodeLookup:K,connection:Z}=x.getState();if(!y||!R&&!o)return;if(!R){_==null||_(z.nativeEvent,{nodeId:y,handleId:g,handleType:e}),x.setState({connectionClickStartHandle:{nodeId:y,type:e,id:g}});return}const Q=os(z.target),B=n||H,{connection:q,isValid:U}=_t.isValid(z.nativeEvent,{handle:{nodeId:y,id:g,type:e},connectionMode:V,fromNodeId:R.nodeId,fromHandleId:R.id||null,fromType:R.type,isValidConnection:B,flowId:W,doc:Q,lib:O,nodeLookup:K});U&&q&&S(q);const G=structuredClone(Z);delete G.inProgress,G.toPosition=G.toHandle?G.toHandle.position:null,k==null||k(z,G),x.setState({connectionClickStartHandle:null})};return h.jsx("div",{"data-handleid":g,"data-nodeid":y,"data-handlepos":t,"data-id":`${v}-${y}-${g}-${e}`,className:re(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",u,f,{source:!w,target:w,connectable:s,connectablestart:o,connectableend:r,clickconnecting:M,connectingfrom:j,connectingto:E,valid:C,connectionindicator:s&&(!A||N)&&(A||D?r:o)}]),onMouseDown:P,onTouchStart:P,onClick:b?L:void 0,ref:m,...l,children:d})}const ot=I.memo(As(la));function da({data:e,isConnectable:t,sourcePosition:n=F.Bottom}){return h.jsxs(h.Fragment,{children:[e==null?void 0:e.label,h.jsx(ot,{type:"source",position:n,isConnectable:t})]})}function ua({data:e,isConnectable:t,targetPosition:n=F.Top,sourcePosition:s=F.Bottom}){return h.jsxs(h.Fragment,{children:[h.jsx(ot,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,h.jsx(ot,{type:"source",position:s,isConnectable:t})]})}function fa(){return null}function ga({data:e,isConnectable:t,targetPosition:n=F.Top}){return h.jsxs(h.Fragment,{children:[h.jsx(ot,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const rt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},_n={input:da,default:ua,output:ga,group:fa};function ha(e){var t,n,s,o;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((o=e.style)==null?void 0:o.height)}}const pa=e=>{const{width:t,height:n,x:s,y:o}=We(e.nodeLookup,{filter:r=>!!r.selected});return{width:ae(t)?t:null,height:ae(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${o}px)`}};function ma({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=oe(),{width:o,height:r,transformString:i,userSelectionActive:a}=J(pa,se),d=$s(),f=I.useRef(null);if(I.useEffect(()=>{var l;n||(l=f.current)==null||l.focus({preventScroll:!0})},[n]),Ps({nodeRef:f}),a||!o||!r)return null;const p=e?l=>{const m=s.getState().nodes.filter(g=>g.selected);e(l,m)}:void 0,c=l=>{Object.prototype.hasOwnProperty.call(rt,l.key)&&(l.preventDefault(),d({direction:rt[l.key],factor:l.shiftKey?4:1}))};return h.jsx("div",{className:re(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:h.jsx("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:n?void 0:-1,onKeyDown:n?void 0:c,style:{width:o,height:r}})})}const Pn=typeof window<"u"?window:void 0,xa=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function zs({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:r,onPaneScroll:i,paneClickDistance:a,deleteKeyCode:d,selectionKeyCode:f,selectionOnDrag:p,selectionMode:c,onSelectionStart:l,onSelectionEnd:m,multiSelectionKeyCode:g,panActivationKeyCode:w,zoomActivationKeyCode:x,elementsSelectable:y,zoomOnScroll:b,zoomOnPinch:u,panOnScroll:v,panOnScrollSpeed:j,panOnScrollMode:E,zoomOnDoubleClick:M,panOnDrag:N,defaultViewport:A,translateExtent:D,minZoom:C,maxZoom:S,preventScrolling:P,onSelectionContextMenu:L,noWheelClassName:$,noPanClassName:T,disableKeyboardA11y:z,onViewportChange:_,isControlledViewport:k}){const{nodesSelectionActive:R,userSelectionActive:V}=J(xa,se),H=Oe(f,{target:Pn}),O=Oe(w,{target:Pn}),W=O||N,K=O||v,Z=p&&W!==!0,Q=H||V||Z;return Qi({deleteKeyCode:d,multiSelectionKeyCode:g}),h.jsx(ea,{onPaneContextMenu:r,elementsSelectable:y,zoomOnScroll:b,zoomOnPinch:u,panOnScroll:K,panOnScrollSpeed:j,panOnScrollMode:E,zoomOnDoubleClick:M,panOnDrag:!H&&W,defaultViewport:A,translateExtent:D,minZoom:C,maxZoom:S,zoomActivationKeyCode:x,preventScrolling:P,noWheelClassName:$,noPanClassName:T,onViewportChange:_,isControlledViewport:k,paneClickDistance:a,selectionOnDrag:Z,children:h.jsxs(oa,{onSelectionStart:l,onSelectionEnd:m,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:r,onPaneScroll:i,panOnDrag:W,isSelecting:!!Q,selectionMode:c,selectionKeyPressed:H,paneClickDistance:a,selectionOnDrag:Z,children:[e,R&&h.jsx(ma,{onSelectionContextMenu:L,noPanClassName:T,disableKeyboardA11y:z})]})})}zs.displayName="FlowRenderer";const ya=I.memo(zs),wa=e=>t=>e?Lt(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function ba(e){return J(I.useCallback(wa(e),[e]),se)}const va=e=>e.updateNodeInternals;function Na(){const e=J(va),[t]=I.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(o=>{const r=o.target.getAttribute("data-id");s.set(r,{id:r,nodeElement:o.target,force:!0})}),e(s)}));return I.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function Ea({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const o=oe(),r=I.useRef(null),i=I.useRef(null),a=I.useRef(e.sourcePosition),d=I.useRef(e.targetPosition),f=I.useRef(t),p=n&&!!e.internals.handleBounds;return I.useEffect(()=>{r.current&&!e.hidden&&(!p||i.current!==r.current)&&(i.current&&(s==null||s.unobserve(i.current)),s==null||s.observe(r.current),i.current=r.current)},[p,e.hidden]),I.useEffect(()=>()=>{i.current&&(s==null||s.unobserve(i.current),i.current=null)},[]),I.useEffect(()=>{if(r.current){const c=f.current!==t,l=a.current!==e.sourcePosition,m=d.current!==e.targetPosition;(c||l||m)&&(f.current=t,a.current=e.sourcePosition,d.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}function Sa({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:o,onContextMenu:r,onDoubleClick:i,nodesDraggable:a,elementsSelectable:d,nodesConnectable:f,nodesFocusable:p,resizeObserver:c,noDragClassName:l,noPanClassName:m,disableKeyboardA11y:g,rfId:w,nodeTypes:x,nodeClickDistance:y,onError:b}){const{node:u,internals:v,isParent:j}=J(B=>{const q=B.nodeLookup.get(e),U=B.parentLookup.has(e);return{node:q,internals:q.internals,isParent:U}},se);let E=u.type||"default",M=(x==null?void 0:x[E])||_n[E];M===void 0&&(b==null||b("003",le.error003(E)),E="default",M=(x==null?void 0:x.default)||_n.default);const N=!!(u.draggable||a&&typeof u.draggable>"u"),A=!!(u.selectable||d&&typeof u.selectable>"u"),D=!!(u.connectable||f&&typeof u.connectable>"u"),C=!!(u.focusable||p&&typeof u.focusable>"u"),S=oe(),P=ns(u),L=Ea({node:u,nodeType:E,hasDimensions:P,resizeObserver:c}),$=Ps({nodeRef:L,disabled:u.hidden||!N,noDragClassName:l,handleSelector:u.dragHandle,nodeId:e,isSelectable:A,nodeClickDistance:y}),T=$s();if(u.hidden)return null;const z=ue(u),_=ha(u),k=A||N||t||n||s||o,R=n?B=>n(B,{...v.userNode}):void 0,V=s?B=>s(B,{...v.userNode}):void 0,H=o?B=>o(B,{...v.userNode}):void 0,O=r?B=>r(B,{...v.userNode}):void 0,W=i?B=>i(B,{...v.userNode}):void 0,K=B=>{const{selectNodesOnDrag:q,nodeDragThreshold:U}=S.getState();A&&(!q||!N||U>0)&&Pt({id:e,store:S,nodeRef:L}),t&&t(B,{...v.userNode})},Z=B=>{if(!(rs(B.nativeEvent)||g)){if(qn.includes(B.key)&&A){const q=B.key==="Escape";Pt({id:e,store:S,unselect:q,nodeRef:L})}else if(N&&u.selected&&Object.prototype.hasOwnProperty.call(rt,B.key)){B.preventDefault();const{ariaLabelConfig:q}=S.getState();S.setState({ariaLiveMessage:q["node.a11yDescription.ariaLiveMessage"]({direction:B.key.replace("Arrow","").toLowerCase(),x:~~v.positionAbsolute.x,y:~~v.positionAbsolute.y})}),T({direction:rt[B.key],factor:B.shiftKey?4:1})}}},Q=()=>{var te;if(g||!((te=L.current)!=null&&te.matches(":focus-visible")))return;const{transform:B,width:q,height:U,autoPanOnNodeFocus:G,setCenter:X}=S.getState();if(!G)return;Lt(new Map([[e,u]]),{x:0,y:0,width:q,height:U},B,!0).length>0||X(u.position.x+z.width/2,u.position.y+z.height/2,{zoom:B[2]})};return h.jsx("div",{className:re(["react-flow__node",`react-flow__node-${E}`,{[m]:N},u.className,{selected:u.selected,selectable:A,parent:j,draggable:N,dragging:$}]),ref:L,style:{zIndex:v.z,transform:`translate(${v.positionAbsolute.x}px,${v.positionAbsolute.y}px)`,pointerEvents:k?"all":"none",visibility:P?"visible":"hidden",...u.style,..._},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:R,onMouseMove:V,onMouseLeave:H,onContextMenu:O,onClick:K,onDoubleClick:W,onKeyDown:C?Z:void 0,tabIndex:C?0:void 0,onFocus:C?Q:void 0,role:u.ariaRole??(C?"group":void 0),"aria-roledescription":"node","aria-describedby":g?void 0:`${Ss}-${w}`,"aria-label":u.ariaLabel,...u.domAttributes,children:h.jsx(ia,{value:e,children:h.jsx(M,{id:e,data:u.data,type:E,positionAbsoluteX:v.positionAbsolute.x,positionAbsoluteY:v.positionAbsolute.y,selected:u.selected??!1,selectable:A,draggable:N,deletable:u.deletable??!0,isConnectable:D,sourcePosition:u.sourcePosition,targetPosition:u.targetPosition,dragging:$,dragHandle:u.dragHandle,zIndex:v.z,parentId:u.parentId,...z})})})}var Ca=I.memo(Sa);const Ma=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Hs(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:o,onError:r}=J(Ma,se),i=ba(e.onlyRenderVisibleElements),a=Na();return h.jsx("div",{className:"react-flow__nodes",style:ft,children:i.map(d=>h.jsx(Ca,{id:d,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:r},d))})}Hs.displayName="NodeRenderer";const ja=I.memo(Hs);function Ia(e){return J(I.useCallback(n=>{if(!e)return n.edges.map(o=>o.id);const s=[];if(n.width&&n.height)for(const o of n.edges){const r=n.nodeLookup.get(o.source),i=n.nodeLookup.get(o.target);r&&i&&Lr({sourceNode:r,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&s.push(o.id)}return s},[e]),se)}const ka=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return h.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Aa=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return h.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},$n={[tt.Arrow]:ka,[tt.ArrowClosed]:Aa};function _a(e){const t=oe();return I.useMemo(()=>{var o,r;return Object.prototype.hasOwnProperty.call($n,e)?$n[e]:((r=(o=t.getState()).onError)==null||r.call(o,"009",le.error009(e)),null)},[e])}const Pa=({id:e,type:t,color:n,width:s=12.5,height:o=12.5,markerUnits:r="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const d=_a(t);return d?h.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:a,refX:"0",refY:"0",children:h.jsx(d,{color:n,strokeWidth:i})}):null},Ds=({defaultColor:e,rfId:t})=>{const n=J(r=>r.edges),s=J(r=>r.defaultEdgeOptions),o=I.useMemo(()=>Fr(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return o.length?h.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:h.jsx("defs",{children:o.map(r=>h.jsx(Pa,{id:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient},r.id))})}):null};Ds.displayName="MarkerDefinitions";var $a=I.memo(Ds);function Ts({x:e,y:t,label:n,labelStyle:s,labelShowBg:o=!0,labelBgStyle:r,labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:d,className:f,...p}){const[c,l]=I.useState({x:1,y:0,width:0,height:0}),m=re(["react-flow__edge-textwrapper",f]),g=I.useRef(null);return I.useEffect(()=>{if(g.current){const w=g.current.getBBox();l({x:w.x,y:w.y,width:w.width,height:w.height})}},[n]),n?h.jsxs("g",{transform:`translate(${e-c.width/2} ${t-c.height/2})`,className:m,visibility:c.width?"visible":"hidden",...p,children:[o&&h.jsx("rect",{width:c.width+2*i[0],x:-i[0],y:-i[1],height:c.height+2*i[1],className:"react-flow__edge-textbg",style:r,rx:a,ry:a}),h.jsx("text",{className:"react-flow__edge-text",y:c.height/2,dy:"0.3em",ref:g,style:s,children:n}),d]}):null}Ts.displayName="EdgeText";const La=I.memo(Ts);function gt({path:e,labelX:t,labelY:n,label:s,labelStyle:o,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:d,interactionWidth:f=20,...p}){return h.jsxs(h.Fragment,{children:[h.jsx("path",{...p,d:e,fill:"none",className:re(["react-flow__edge-path",p.className])}),f?h.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}):null,s&&ae(t)&&ae(n)?h.jsx(La,{x:t,y:n,label:s,labelStyle:o,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:d}):null]})}function Ln({pos:e,x1:t,y1:n,x2:s,y2:o}){return e===F.Left||e===F.Right?[.5*(t+s),n]:[t,.5*(n+o)]}function Rs({sourceX:e,sourceY:t,sourcePosition:n=F.Bottom,targetX:s,targetY:o,targetPosition:r=F.Top}){const[i,a]=Ln({pos:n,x1:e,y1:t,x2:s,y2:o}),[d,f]=Ln({pos:r,x1:s,y1:o,x2:e,y2:t}),[p,c,l,m]=as({sourceX:e,sourceY:t,targetX:s,targetY:o,sourceControlX:i,sourceControlY:a,targetControlX:d,targetControlY:f});return[`M${e},${t} C${i},${a} ${d},${f} ${s},${o}`,p,c,l,m]}function Bs(e){return I.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,sourcePosition:i,targetPosition:a,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:m,style:g,markerEnd:w,markerStart:x,interactionWidth:y})=>{const[b,u,v]=Rs({sourceX:n,sourceY:s,sourcePosition:i,targetX:o,targetY:r,targetPosition:a}),j=e.isInternal?void 0:t;return h.jsx(gt,{id:j,path:b,labelX:u,labelY:v,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:m,style:g,markerEnd:w,markerStart:x,interactionWidth:y})})}const za=Bs({isInternal:!1}),Vs=Bs({isInternal:!0});za.displayName="SimpleBezierEdge";Vs.displayName="SimpleBezierEdgeInternal";function Fs(e){return I.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,label:i,labelStyle:a,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:c,style:l,sourcePosition:m=F.Bottom,targetPosition:g=F.Top,markerEnd:w,markerStart:x,pathOptions:y,interactionWidth:b})=>{const[u,v,j]=It({sourceX:n,sourceY:s,sourcePosition:m,targetX:o,targetY:r,targetPosition:g,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset,stepPosition:y==null?void 0:y.stepPosition}),E=e.isInternal?void 0:t;return h.jsx(gt,{id:E,path:u,labelX:v,labelY:j,label:i,labelStyle:a,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:c,style:l,markerEnd:w,markerStart:x,interactionWidth:b})})}const Os=Fs({isInternal:!1}),Ys=Fs({isInternal:!0});Os.displayName="SmoothStepEdge";Ys.displayName="SmoothStepEdgeInternal";function Ws(e){return I.memo(({id:t,...n})=>{var o;const s=e.isInternal?void 0:t;return h.jsx(Os,{...n,id:s,pathOptions:I.useMemo(()=>{var r;return{borderRadius:0,offset:(r=n.pathOptions)==null?void 0:r.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const Ha=Ws({isInternal:!1}),Xs=Ws({isInternal:!0});Ha.displayName="StepEdge";Xs.displayName="StepEdgeInternal";function qs(e){return I.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,label:i,labelStyle:a,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:c,style:l,markerEnd:m,markerStart:g,interactionWidth:w})=>{const[x,y,b]=ds({sourceX:n,sourceY:s,targetX:o,targetY:r}),u=e.isInternal?void 0:t;return h.jsx(gt,{id:u,path:x,labelX:y,labelY:b,label:i,labelStyle:a,labelShowBg:d,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:c,style:l,markerEnd:m,markerStart:g,interactionWidth:w})})}const Da=qs({isInternal:!1}),Gs=qs({isInternal:!0});Da.displayName="StraightEdge";Gs.displayName="StraightEdgeInternal";function Ks(e){return I.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,sourcePosition:i=F.Bottom,targetPosition:a=F.Top,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:m,style:g,markerEnd:w,markerStart:x,pathOptions:y,interactionWidth:b})=>{const[u,v,j]=cs({sourceX:n,sourceY:s,sourcePosition:i,targetX:o,targetY:r,targetPosition:a,curvature:y==null?void 0:y.curvature}),E=e.isInternal?void 0:t;return h.jsx(gt,{id:E,path:u,labelX:v,labelY:j,label:d,labelStyle:f,labelShowBg:p,labelBgStyle:c,labelBgPadding:l,labelBgBorderRadius:m,style:g,markerEnd:w,markerStart:x,interactionWidth:b})})}const Ta=Ks({isInternal:!1}),Zs=Ks({isInternal:!0});Ta.displayName="BezierEdge";Zs.displayName="BezierEdgeInternal";const zn={default:Zs,straight:Gs,step:Xs,smoothstep:Ys,simplebezier:Vs},Hn={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Ra=(e,t,n)=>n===F.Left?e-t:n===F.Right?e+t:e,Ba=(e,t,n)=>n===F.Top?e-t:n===F.Bottom?e+t:e,Dn="react-flow__edgeupdater";function Tn({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:o,onMouseEnter:r,onMouseOut:i,type:a}){return h.jsx("circle",{onMouseDown:o,onMouseEnter:r,onMouseOut:i,className:re([Dn,`${Dn}-${a}`]),cx:Ra(t,s,e),cy:Ba(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function Va({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:o,targetX:r,targetY:i,sourcePosition:a,targetPosition:d,onReconnect:f,onReconnectStart:p,onReconnectEnd:c,setReconnecting:l,setUpdateHover:m}){const g=oe(),w=(v,j)=>{if(v.button!==0)return;const{autoPanOnConnect:E,domNode:M,isValidConnection:N,connectionMode:A,connectionRadius:D,lib:C,onConnectStart:S,onConnectEnd:P,cancelConnection:L,nodeLookup:$,rfId:T,panBy:z,updateConnection:_}=g.getState(),k=j.type==="target",R=(O,W)=>{l(!1),c==null||c(O,n,j.type,W)},V=O=>f==null?void 0:f(n,O),H=(O,W)=>{l(!0),p==null||p(v,n,j.type),S==null||S(O,W)};_t.onPointerDown(v.nativeEvent,{autoPanOnConnect:E,connectionMode:A,connectionRadius:D,domNode:M,handleId:j.id,nodeId:j.nodeId,nodeLookup:$,isTarget:k,edgeUpdaterType:j.type,lib:C,flowId:T,cancelConnection:L,panBy:z,isValidConnection:N,onConnect:V,onConnectStart:H,onConnectEnd:P,onReconnectEnd:R,updateConnection:_,getTransform:()=>g.getState().transform,getFromHandle:()=>g.getState().connection.fromHandle,dragThreshold:g.getState().connectionDragThreshold,handleDomNode:v.currentTarget})},x=v=>w(v,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=v=>w(v,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),b=()=>m(!0),u=()=>m(!1);return h.jsxs(h.Fragment,{children:[(e===!0||e==="source")&&h.jsx(Tn,{position:a,centerX:s,centerY:o,radius:t,onMouseDown:x,onMouseEnter:b,onMouseOut:u,type:"source"}),(e===!0||e==="target")&&h.jsx(Tn,{position:d,centerX:r,centerY:i,radius:t,onMouseDown:y,onMouseEnter:b,onMouseOut:u,type:"target"})]})}function Fa({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:o,onDoubleClick:r,onContextMenu:i,onMouseEnter:a,onMouseMove:d,onMouseLeave:f,reconnectRadius:p,onReconnect:c,onReconnectStart:l,onReconnectEnd:m,rfId:g,edgeTypes:w,noPanClassName:x,onError:y,disableKeyboardA11y:b}){let u=J(X=>X.edgeLookup.get(e));const v=J(X=>X.defaultEdgeOptions);u=v?{...v,...u}:u;let j=u.type||"default",E=(w==null?void 0:w[j])||zn[j];E===void 0&&(y==null||y("011",le.error011(j)),j="default",E=(w==null?void 0:w.default)||zn.default);const M=!!(u.focusable||t&&typeof u.focusable>"u"),N=typeof c<"u"&&(u.reconnectable||n&&typeof u.reconnectable>"u"),A=!!(u.selectable||s&&typeof u.selectable>"u"),D=I.useRef(null),[C,S]=I.useState(!1),[P,L]=I.useState(!1),$=oe(),{zIndex:T,sourceX:z,sourceY:_,targetX:k,targetY:R,sourcePosition:V,targetPosition:H}=J(I.useCallback(X=>{const Y=X.nodeLookup.get(u.source),te=X.nodeLookup.get(u.target);if(!Y||!te)return{zIndex:u.zIndex,...Hn};const ne=Vr({id:e,sourceNode:Y,targetNode:te,sourceHandle:u.sourceHandle||null,targetHandle:u.targetHandle||null,connectionMode:X.connectionMode,onError:y});return{zIndex:$r({selected:u.selected,zIndex:u.zIndex,sourceNode:Y,targetNode:te,elevateOnSelect:X.elevateEdgesOnSelect,zIndexMode:X.zIndexMode}),...ne||Hn}},[u.source,u.target,u.sourceHandle,u.targetHandle,u.selected,u.zIndex]),se),O=I.useMemo(()=>u.markerStart?`url('#${kt(u.markerStart,g)}')`:void 0,[u.markerStart,g]),W=I.useMemo(()=>u.markerEnd?`url('#${kt(u.markerEnd,g)}')`:void 0,[u.markerEnd,g]);if(u.hidden||z===null||_===null||k===null||R===null)return null;const K=X=>{var ee;const{addSelectedEdges:Y,unselectNodesAndEdges:te,multiSelectionActive:ne}=$.getState();A&&($.setState({nodesSelectionActive:!1}),u.selected&&ne?(te({nodes:[],edges:[u]}),(ee=D.current)==null||ee.blur()):Y([e])),o&&o(X,u)},Z=r?X=>{r(X,{...u})}:void 0,Q=i?X=>{i(X,{...u})}:void 0,B=a?X=>{a(X,{...u})}:void 0,q=d?X=>{d(X,{...u})}:void 0,U=f?X=>{f(X,{...u})}:void 0,G=X=>{var Y;if(!b&&qn.includes(X.key)&&A){const{unselectNodesAndEdges:te,addSelectedEdges:ne}=$.getState();X.key==="Escape"?((Y=D.current)==null||Y.blur(),te({edges:[u]})):ne([e])}};return h.jsx("svg",{style:{zIndex:T},children:h.jsxs("g",{className:re(["react-flow__edge",`react-flow__edge-${j}`,u.className,x,{selected:u.selected,animated:u.animated,inactive:!A&&!o,updating:C,selectable:A}]),onClick:K,onDoubleClick:Z,onContextMenu:Q,onMouseEnter:B,onMouseMove:q,onMouseLeave:U,onKeyDown:M?G:void 0,tabIndex:M?0:void 0,role:u.ariaRole??(M?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":u.ariaLabel===null?void 0:u.ariaLabel||`Edge from ${u.source} to ${u.target}`,"aria-describedby":M?`${Cs}-${g}`:void 0,ref:D,...u.domAttributes,children:[!P&&h.jsx(E,{id:e,source:u.source,target:u.target,type:u.type,selected:u.selected,animated:u.animated,selectable:A,deletable:u.deletable??!0,label:u.label,labelStyle:u.labelStyle,labelShowBg:u.labelShowBg,labelBgStyle:u.labelBgStyle,labelBgPadding:u.labelBgPadding,labelBgBorderRadius:u.labelBgBorderRadius,sourceX:z,sourceY:_,targetX:k,targetY:R,sourcePosition:V,targetPosition:H,data:u.data,style:u.style,sourceHandleId:u.sourceHandle,targetHandleId:u.targetHandle,markerStart:O,markerEnd:W,pathOptions:"pathOptions"in u?u.pathOptions:void 0,interactionWidth:u.interactionWidth}),N&&h.jsx(Va,{edge:u,isReconnectable:N,reconnectRadius:p,onReconnect:c,onReconnectStart:l,onReconnectEnd:m,sourceX:z,sourceY:_,targetX:k,targetY:R,sourcePosition:V,targetPosition:H,setUpdateHover:S,setReconnecting:L})]})})}var Oa=I.memo(Fa);const Ya=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function Qs({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:o,onReconnect:r,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:d,onEdgeMouseLeave:f,onEdgeClick:p,reconnectRadius:c,onEdgeDoubleClick:l,onReconnectStart:m,onReconnectEnd:g,disableKeyboardA11y:w}){const{edgesFocusable:x,edgesReconnectable:y,elementsSelectable:b,onError:u}=J(Ya,se),v=Ia(t);return h.jsxs("div",{className:"react-flow__edges",children:[h.jsx($a,{defaultColor:e,rfId:n}),v.map(j=>h.jsx(Oa,{id:j,edgesFocusable:x,edgesReconnectable:y,elementsSelectable:b,noPanClassName:o,onReconnect:r,onContextMenu:i,onMouseEnter:a,onMouseMove:d,onMouseLeave:f,onClick:p,reconnectRadius:c,onDoubleClick:l,onReconnectStart:m,onReconnectEnd:g,rfId:n,onError:u,edgeTypes:s,disableKeyboardA11y:w},j))]})}Qs.displayName="EdgeRenderer";const Wa=I.memo(Qs),Xa=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function qa({children:e}){const t=J(Xa);return h.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Ga(e){const t=Ft(),n=I.useRef(!1);I.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Ka=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function Za(e){const t=J(Ka),n=oe();return I.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Qa(e){return e.connection.inProgress?{...e.connection,to:qe(e.connection.to,e.transform)}:{...e.connection}}function Ua(e){return Qa}function Ja(e){const t=Ua();return J(t,se)}const ec=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function tc({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:o,width:r,height:i,isValid:a,inProgress:d}=J(ec,se);return!(r&&o&&d)?null:h.jsx("svg",{style:e,width:r,height:i,className:"react-flow__connectionline react-flow__container",children:h.jsx("g",{className:re(["react-flow__connection",Zn(a)]),children:h.jsx(Us,{style:t,type:n,CustomComponent:s,isValid:a})})})}const Us=({style:e,type:t=pe.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:o,from:r,fromNode:i,fromHandle:a,fromPosition:d,to:f,toNode:p,toHandle:c,toPosition:l,pointer:m}=Ja();if(!o)return;if(n)return h.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:a,fromX:r.x,fromY:r.y,toX:f.x,toY:f.y,fromPosition:d,toPosition:l,connectionStatus:Zn(s),toNode:p,toHandle:c,pointer:m});let g="";const w={sourceX:r.x,sourceY:r.y,sourcePosition:d,targetX:f.x,targetY:f.y,targetPosition:l};switch(t){case pe.Bezier:[g]=cs(w);break;case pe.SimpleBezier:[g]=Rs(w);break;case pe.Step:[g]=It({...w,borderRadius:0});break;case pe.SmoothStep:[g]=It(w);break;default:[g]=ds(w)}return h.jsx("path",{d:g,fill:"none",className:"react-flow__connection-path",style:e})};Us.displayName="ConnectionLine";const nc={};function Rn(e=nc){I.useRef(e),oe(),I.useEffect(()=>{},[e])}function sc(){oe(),I.useRef(!1),I.useEffect(()=>{},[])}function Js({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:o,onNodeDoubleClick:r,onEdgeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:d,onNodeMouseLeave:f,onNodeContextMenu:p,onSelectionContextMenu:c,onSelectionStart:l,onSelectionEnd:m,connectionLineType:g,connectionLineStyle:w,connectionLineComponent:x,connectionLineContainerStyle:y,selectionKeyCode:b,selectionOnDrag:u,selectionMode:v,multiSelectionKeyCode:j,panActivationKeyCode:E,zoomActivationKeyCode:M,deleteKeyCode:N,onlyRenderVisibleElements:A,elementsSelectable:D,defaultViewport:C,translateExtent:S,minZoom:P,maxZoom:L,preventScrolling:$,defaultMarkerColor:T,zoomOnScroll:z,zoomOnPinch:_,panOnScroll:k,panOnScrollSpeed:R,panOnScrollMode:V,zoomOnDoubleClick:H,panOnDrag:O,onPaneClick:W,onPaneMouseEnter:K,onPaneMouseMove:Z,onPaneMouseLeave:Q,onPaneScroll:B,onPaneContextMenu:q,paneClickDistance:U,nodeClickDistance:G,onEdgeContextMenu:X,onEdgeMouseEnter:Y,onEdgeMouseMove:te,onEdgeMouseLeave:ne,reconnectRadius:ee,onReconnect:ie,onReconnectStart:fe,onReconnectEnd:de,noDragClassName:xe,noWheelClassName:Le,noPanClassName:ze,disableKeyboardA11y:He,nodeExtent:ht,rfId:Ge,viewport:Ee,onViewportChange:De}){return Rn(e),Rn(t),sc(),Ga(n),Za(Ee),h.jsx(ya,{onPaneClick:W,onPaneMouseEnter:K,onPaneMouseMove:Z,onPaneMouseLeave:Q,onPaneContextMenu:q,onPaneScroll:B,paneClickDistance:U,deleteKeyCode:N,selectionKeyCode:b,selectionOnDrag:u,selectionMode:v,onSelectionStart:l,onSelectionEnd:m,multiSelectionKeyCode:j,panActivationKeyCode:E,zoomActivationKeyCode:M,elementsSelectable:D,zoomOnScroll:z,zoomOnPinch:_,zoomOnDoubleClick:H,panOnScroll:k,panOnScrollSpeed:R,panOnScrollMode:V,panOnDrag:O,defaultViewport:C,translateExtent:S,minZoom:P,maxZoom:L,onSelectionContextMenu:c,preventScrolling:$,noDragClassName:xe,noWheelClassName:Le,noPanClassName:ze,disableKeyboardA11y:He,onViewportChange:De,isControlledViewport:!!Ee,children:h.jsxs(qa,{children:[h.jsx(Wa,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:ie,onReconnectStart:fe,onReconnectEnd:de,onlyRenderVisibleElements:A,onEdgeContextMenu:X,onEdgeMouseEnter:Y,onEdgeMouseMove:te,onEdgeMouseLeave:ne,reconnectRadius:ee,defaultMarkerColor:T,noPanClassName:ze,disableKeyboardA11y:He,rfId:Ge}),h.jsx(tc,{style:w,type:g,component:x,containerStyle:y}),h.jsx("div",{className:"react-flow__edgelabel-renderer"}),h.jsx(ja,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:r,onNodeMouseEnter:a,onNodeMouseMove:d,onNodeMouseLeave:f,onNodeContextMenu:p,nodeClickDistance:G,onlyRenderVisibleElements:A,noPanClassName:ze,noDragClassName:xe,disableKeyboardA11y:He,nodeExtent:ht,rfId:Ge}),h.jsx("div",{className:"react-flow__viewport-portal"})]})})}Js.displayName="GraphView";const oc=I.memo(Js),Bn=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:d=.5,maxZoom:f=2,nodeOrigin:p,nodeExtent:c,zIndexMode:l="basic"}={})=>{const m=new Map,g=new Map,w=new Map,x=new Map,y=s??t??[],b=n??e??[],u=p??[0,0],v=c??Re;gs(w,x,y);const j=At(b,m,g,{nodeOrigin:u,nodeExtent:v,zIndexMode:l});let E=[0,0,1];if(i&&o&&r){const M=We(m,{filter:C=>!!((C.width||C.initialWidth)&&(C.height||C.initialHeight))}),{x:N,y:A,zoom:D}=zt(M,o,r,d,f,(a==null?void 0:a.padding)??.1);E=[N,A,D]}return{rfId:"1",width:o??0,height:r??0,transform:E,nodes:b,nodesInitialized:j,nodeLookup:m,parentLookup:g,edges:y,edgeLookup:x,connectionLookup:w,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:d,maxZoom:f,translateExtent:Re,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:ke.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:u,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Kn},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:jr,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Gn,zIndexMode:l,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},rc=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:d,maxZoom:f,nodeOrigin:p,nodeExtent:c,zIndexMode:l})=>Ei((m,g)=>{async function w(){const{nodeLookup:x,panZoom:y,fitViewOptions:b,fitViewResolver:u,width:v,height:j,minZoom:E,maxZoom:M}=g();y&&(await Cr({nodes:x,width:v,height:j,panZoom:y,minZoom:E,maxZoom:M},b),u==null||u.resolve(!0),m({fitViewResolver:null}))}return{...Bn({nodes:e,edges:t,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:d,maxZoom:f,nodeOrigin:p,nodeExtent:c,defaultNodes:n,defaultEdges:s,zIndexMode:l}),setNodes:x=>{const{nodeLookup:y,parentLookup:b,nodeOrigin:u,elevateNodesOnSelect:v,fitViewQueued:j,zIndexMode:E}=g(),M=At(x,y,b,{nodeOrigin:u,nodeExtent:c,elevateNodesOnSelect:v,checkEquality:!0,zIndexMode:E});j&&M?(w(),m({nodes:x,nodesInitialized:M,fitViewQueued:!1,fitViewOptions:void 0})):m({nodes:x,nodesInitialized:M})},setEdges:x=>{const{connectionLookup:y,edgeLookup:b}=g();gs(y,b,x),m({edges:x})},setDefaultNodesAndEdges:(x,y)=>{if(x){const{setNodes:b}=g();b(x),m({hasDefaultNodes:!0})}if(y){const{setEdges:b}=g();b(y),m({hasDefaultEdges:!0})}},updateNodeInternals:x=>{const{triggerNodeChanges:y,nodeLookup:b,parentLookup:u,domNode:v,nodeOrigin:j,nodeExtent:E,debug:M,fitViewQueued:N,zIndexMode:A}=g(),{changes:D,updatedInternals:C}=Kr(x,b,u,v,j,E,A);C&&(Wr(b,u,{nodeOrigin:j,nodeExtent:E,zIndexMode:A}),N?(w(),m({fitViewQueued:!1,fitViewOptions:void 0})):m({}),(D==null?void 0:D.length)>0&&(M&&console.log("React Flow: trigger node changes",D),y==null||y(D)))},updateNodePositions:(x,y=!1)=>{const b=[];let u=[];const{nodeLookup:v,triggerNodeChanges:j,connection:E,updateConnection:M,onNodesChangeMiddlewareMap:N}=g();for(const[A,D]of x){const C=v.get(A),S=!!(C!=null&&C.expandParent&&(C!=null&&C.parentId)&&(D!=null&&D.position)),P={id:A,type:"position",position:S?{x:Math.max(0,D.position.x),y:Math.max(0,D.position.y)}:D.position,dragging:y};if(C&&E.inProgress&&E.fromNode.id===C.id){const L=Ne(C,E.fromHandle,F.Left,!0);M({...E,from:L})}S&&C.parentId&&b.push({id:A,parentId:C.parentId,rect:{...D.internals.positionAbsolute,width:D.measured.width??0,height:D.measured.height??0}}),u.push(P)}if(b.length>0){const{parentLookup:A,nodeOrigin:D}=g(),C=Vt(b,v,A,D);u.push(...C)}for(const A of N.values())u=A(u);j(u)},triggerNodeChanges:x=>{const{onNodesChange:y,setNodes:b,nodes:u,hasDefaultNodes:v,debug:j}=g();if(x!=null&&x.length){if(v){const E=Is(x,u);b(E)}j&&console.log("React Flow: trigger node changes",x),y==null||y(x)}},triggerEdgeChanges:x=>{const{onEdgesChange:y,setEdges:b,edges:u,hasDefaultEdges:v,debug:j}=g();if(x!=null&&x.length){if(v){const E=ks(x,u);b(E)}j&&console.log("React Flow: trigger edge changes",x),y==null||y(x)}},addSelectedNodes:x=>{const{multiSelectionActive:y,edgeLookup:b,nodeLookup:u,triggerNodeChanges:v,triggerEdgeChanges:j}=g();if(y){const E=x.map(M=>we(M,!0));v(E);return}v(Ie(u,new Set([...x]),!0)),j(Ie(b))},addSelectedEdges:x=>{const{multiSelectionActive:y,edgeLookup:b,nodeLookup:u,triggerNodeChanges:v,triggerEdgeChanges:j}=g();if(y){const E=x.map(M=>we(M,!0));j(E);return}j(Ie(b,new Set([...x]))),v(Ie(u,new Set,!0))},unselectNodesAndEdges:({nodes:x,edges:y}={})=>{const{edges:b,nodes:u,nodeLookup:v,triggerNodeChanges:j,triggerEdgeChanges:E}=g(),M=x||u,N=y||b,A=M.map(C=>{const S=v.get(C.id);return S&&(S.selected=!1),we(C.id,!1)}),D=N.map(C=>we(C.id,!1));j(A),E(D)},setMinZoom:x=>{const{panZoom:y,maxZoom:b}=g();y==null||y.setScaleExtent([x,b]),m({minZoom:x})},setMaxZoom:x=>{const{panZoom:y,minZoom:b}=g();y==null||y.setScaleExtent([b,x]),m({maxZoom:x})},setTranslateExtent:x=>{var y;(y=g().panZoom)==null||y.setTranslateExtent(x),m({translateExtent:x})},resetSelectedElements:()=>{const{edges:x,nodes:y,triggerNodeChanges:b,triggerEdgeChanges:u,elementsSelectable:v}=g();if(!v)return;const j=y.reduce((M,N)=>N.selected?[...M,we(N.id,!1)]:M,[]),E=x.reduce((M,N)=>N.selected?[...M,we(N.id,!1)]:M,[]);b(j),u(E)},setNodeExtent:x=>{const{nodes:y,nodeLookup:b,parentLookup:u,nodeOrigin:v,elevateNodesOnSelect:j,nodeExtent:E,zIndexMode:M}=g();x[0][0]===E[0][0]&&x[0][1]===E[0][1]&&x[1][0]===E[1][0]&&x[1][1]===E[1][1]||(At(y,b,u,{nodeOrigin:v,nodeExtent:x,elevateNodesOnSelect:j,checkEquality:!1,zIndexMode:M}),m({nodeExtent:x}))},panBy:x=>{const{transform:y,width:b,height:u,panZoom:v,translateExtent:j}=g();return Zr({delta:x,panZoom:v,transform:y,translateExtent:j,width:b,height:u})},setCenter:async(x,y,b)=>{const{width:u,height:v,maxZoom:j,panZoom:E}=g();if(!E)return Promise.resolve(!1);const M=typeof(b==null?void 0:b.zoom)<"u"?b.zoom:j;return await E.setViewport({x:u/2-x*M,y:v/2-y*M,zoom:M},{duration:b==null?void 0:b.duration,ease:b==null?void 0:b.ease,interpolate:b==null?void 0:b.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{m({connection:{...Kn}})},updateConnection:x=>{m({connection:x})},reset:()=>m({...Bn()})}},Object.is);function ic({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:o,initialHeight:r,initialMinZoom:i,initialMaxZoom:a,initialFitViewOptions:d,fitView:f,nodeOrigin:p,nodeExtent:c,zIndexMode:l,children:m}){const[g]=I.useState(()=>rc({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:f,minZoom:i,maxZoom:a,fitViewOptions:d,nodeOrigin:p,nodeExtent:c,zIndexMode:l}));return h.jsx(Si,{value:g,children:h.jsx(qi,{children:m})})}function ac({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:o,width:r,height:i,fitView:a,fitViewOptions:d,minZoom:f,maxZoom:p,nodeOrigin:c,nodeExtent:l,zIndexMode:m}){return I.useContext(dt)?h.jsx(h.Fragment,{children:e}):h.jsx(ic,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:o,initialWidth:r,initialHeight:i,fitView:a,initialFitViewOptions:d,initialMinZoom:f,initialMaxZoom:p,nodeOrigin:c,nodeExtent:l,zIndexMode:m,children:e})}const cc={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function lc({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:o,nodeTypes:r,edgeTypes:i,onNodeClick:a,onEdgeClick:d,onInit:f,onMove:p,onMoveStart:c,onMoveEnd:l,onConnect:m,onConnectStart:g,onConnectEnd:w,onClickConnectStart:x,onClickConnectEnd:y,onNodeMouseEnter:b,onNodeMouseMove:u,onNodeMouseLeave:v,onNodeContextMenu:j,onNodeDoubleClick:E,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:A,onNodesDelete:D,onEdgesDelete:C,onDelete:S,onSelectionChange:P,onSelectionDragStart:L,onSelectionDrag:$,onSelectionDragStop:T,onSelectionContextMenu:z,onSelectionStart:_,onSelectionEnd:k,onBeforeDelete:R,connectionMode:V,connectionLineType:H=pe.Bezier,connectionLineStyle:O,connectionLineComponent:W,connectionLineContainerStyle:K,deleteKeyCode:Z="Backspace",selectionKeyCode:Q="Shift",selectionOnDrag:B=!1,selectionMode:q=Be.Full,panActivationKeyCode:U="Space",multiSelectionKeyCode:G=Fe()?"Meta":"Control",zoomActivationKeyCode:X=Fe()?"Meta":"Control",snapToGrid:Y,snapGrid:te,onlyRenderVisibleElements:ne=!1,selectNodesOnDrag:ee,nodesDraggable:ie,autoPanOnNodeFocus:fe,nodesConnectable:de,nodesFocusable:xe,nodeOrigin:Le=Ms,edgesFocusable:ze,edgesReconnectable:He,elementsSelectable:ht=!0,defaultViewport:Ge=Di,minZoom:Ee=.5,maxZoom:De=2,translateExtent:Yt=Re,preventScrolling:so=!0,nodeExtent:pt,defaultMarkerColor:oo="#b1b1b7",zoomOnScroll:ro=!0,zoomOnPinch:io=!0,panOnScroll:ao=!1,panOnScrollSpeed:co=.5,panOnScrollMode:lo=be.Free,zoomOnDoubleClick:uo=!0,panOnDrag:fo=!0,onPaneClick:go,onPaneMouseEnter:ho,onPaneMouseMove:po,onPaneMouseLeave:mo,onPaneScroll:xo,onPaneContextMenu:yo,paneClickDistance:wo=1,nodeClickDistance:bo=0,children:vo,onReconnect:No,onReconnectStart:Eo,onReconnectEnd:So,onEdgeContextMenu:Co,onEdgeDoubleClick:Mo,onEdgeMouseEnter:jo,onEdgeMouseMove:Io,onEdgeMouseLeave:ko,reconnectRadius:Ao=10,onNodesChange:_o,onEdgesChange:Po,noDragClassName:$o="nodrag",noWheelClassName:Lo="nowheel",noPanClassName:Wt="nopan",fitView:Xt,fitViewOptions:qt,connectOnClick:zo,attributionPosition:Ho,proOptions:Do,defaultEdgeOptions:To,elevateNodesOnSelect:Ro=!0,elevateEdgesOnSelect:Bo=!1,disableKeyboardA11y:Gt=!1,autoPanOnConnect:Vo,autoPanOnNodeDrag:Fo,autoPanSpeed:Oo,connectionRadius:Yo,isValidConnection:Wo,onError:Xo,style:qo,id:Kt,nodeDragThreshold:Go,connectionDragThreshold:Ko,viewport:Zo,onViewportChange:Qo,width:Uo,height:Jo,colorMode:er="light",debug:tr,onScroll:Ke,ariaLabelConfig:nr,zIndexMode:Zt="basic",...sr},or){const mt=Kt||"1",rr=Vi(er),ir=I.useCallback(Qt=>{Qt.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Ke==null||Ke(Qt)},[Ke]);return h.jsx("div",{"data-testid":"rf__wrapper",...sr,onScroll:ir,style:{...qo,...cc},ref:or,className:re(["react-flow",o,rr]),id:Kt,role:"application",children:h.jsxs(ac,{nodes:e,edges:t,width:Uo,height:Jo,fitView:Xt,fitViewOptions:qt,minZoom:Ee,maxZoom:De,nodeOrigin:Le,nodeExtent:pt,zIndexMode:Zt,children:[h.jsx(oc,{onInit:f,onNodeClick:a,onEdgeClick:d,onNodeMouseEnter:b,onNodeMouseMove:u,onNodeMouseLeave:v,onNodeContextMenu:j,onNodeDoubleClick:E,nodeTypes:r,edgeTypes:i,connectionLineType:H,connectionLineStyle:O,connectionLineComponent:W,connectionLineContainerStyle:K,selectionKeyCode:Q,selectionOnDrag:B,selectionMode:q,deleteKeyCode:Z,multiSelectionKeyCode:G,panActivationKeyCode:U,zoomActivationKeyCode:X,onlyRenderVisibleElements:ne,defaultViewport:Ge,translateExtent:Yt,minZoom:Ee,maxZoom:De,preventScrolling:so,zoomOnScroll:ro,zoomOnPinch:io,zoomOnDoubleClick:uo,panOnScroll:ao,panOnScrollSpeed:co,panOnScrollMode:lo,panOnDrag:fo,onPaneClick:go,onPaneMouseEnter:ho,onPaneMouseMove:po,onPaneMouseLeave:mo,onPaneScroll:xo,onPaneContextMenu:yo,paneClickDistance:wo,nodeClickDistance:bo,onSelectionContextMenu:z,onSelectionStart:_,onSelectionEnd:k,onReconnect:No,onReconnectStart:Eo,onReconnectEnd:So,onEdgeContextMenu:Co,onEdgeDoubleClick:Mo,onEdgeMouseEnter:jo,onEdgeMouseMove:Io,onEdgeMouseLeave:ko,reconnectRadius:Ao,defaultMarkerColor:oo,noDragClassName:$o,noWheelClassName:Lo,noPanClassName:Wt,rfId:mt,disableKeyboardA11y:Gt,nodeExtent:pt,viewport:Zo,onViewportChange:Qo}),h.jsx(Bi,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:m,onConnectStart:g,onConnectEnd:w,onClickConnectStart:x,onClickConnectEnd:y,nodesDraggable:ie,autoPanOnNodeFocus:fe,nodesConnectable:de,nodesFocusable:xe,edgesFocusable:ze,edgesReconnectable:He,elementsSelectable:ht,elevateNodesOnSelect:Ro,elevateEdgesOnSelect:Bo,minZoom:Ee,maxZoom:De,nodeExtent:pt,onNodesChange:_o,onEdgesChange:Po,snapToGrid:Y,snapGrid:te,connectionMode:V,translateExtent:Yt,connectOnClick:zo,defaultEdgeOptions:To,fitView:Xt,fitViewOptions:qt,onNodesDelete:D,onEdgesDelete:C,onDelete:S,onNodeDragStart:M,onNodeDrag:N,onNodeDragStop:A,onSelectionDrag:$,onSelectionDragStart:L,onSelectionDragStop:T,onMove:p,onMoveStart:c,onMoveEnd:l,noPanClassName:Wt,nodeOrigin:Le,rfId:mt,autoPanOnConnect:Vo,autoPanOnNodeDrag:Fo,autoPanSpeed:Oo,onError:Xo,connectionRadius:Yo,isValidConnection:Wo,selectNodesOnDrag:ee,nodeDragThreshold:Go,connectionDragThreshold:Ko,onBeforeDelete:R,debug:tr,ariaLabelConfig:nr,zIndexMode:Zt}),h.jsx(Hi,{onSelectionChange:P}),vo,h.jsx(_i,{proOptions:Do,position:Ho}),h.jsx(Ai,{rfId:mt,disableKeyboardA11y:Gt})]})})}var Kc=As(lc);function Zc(e){const[t,n]=I.useState(e),s=I.useCallback(o=>n(r=>Is(o,r)),[]);return[t,n,s]}function Qc(e){const[t,n]=I.useState(e),s=I.useCallback(o=>n(r=>ks(o,r)),[]);return[t,n,s]}function dc({dimensions:e,lineWidth:t,variant:n,className:s}){return h.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:re(["react-flow__background-pattern",n,s])})}function uc({radius:e,className:t}){return h.jsx("circle",{cx:e,cy:e,r:e,className:re(["react-flow__background-pattern","dots",t])})}var me;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(me||(me={}));const fc={[me.Dots]:1,[me.Lines]:1,[me.Cross]:6},gc=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function eo({id:e,variant:t=me.Dots,gap:n=20,size:s,lineWidth:o=1,offset:r=0,color:i,bgColor:a,style:d,className:f,patternClassName:p}){const c=I.useRef(null),{transform:l,patternId:m}=J(gc,se),g=s||fc[t],w=t===me.Dots,x=t===me.Cross,y=Array.isArray(n)?n:[n,n],b=[y[0]*l[2]||1,y[1]*l[2]||1],u=g*l[2],v=Array.isArray(r)?r:[r,r],j=x?[u,u]:b,E=[v[0]*l[2]||1+j[0]/2,v[1]*l[2]||1+j[1]/2],M=`${m}${e||""}`;return h.jsxs("svg",{className:re(["react-flow__background",f]),style:{...d,...ft,"--xy-background-color-props":a,"--xy-background-pattern-color-props":i},ref:c,"data-testid":"rf__background",children:[h.jsx("pattern",{id:M,x:l[0]%b[0],y:l[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:w?h.jsx(uc,{radius:u/2,className:p}):h.jsx(dc,{dimensions:j,lineWidth:o,variant:t,className:p})}),h.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${M})`})]})}eo.displayName="Background";const Uc=I.memo(eo);function hc(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:h.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function pc(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:h.jsx("path",{d:"M0 0h32v4.2H0z"})})}function mc(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:h.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function xc(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function yc(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function et({children:e,className:t,...n}){return h.jsx("button",{type:"button",className:re(["react-flow__controls-button",t]),...n,children:e})}const wc=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function to({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:o,onZoomIn:r,onZoomOut:i,onFitView:a,onInteractiveChange:d,className:f,children:p,position:c="bottom-left",orientation:l="vertical","aria-label":m}){const g=oe(),{isInteractive:w,minZoomReached:x,maxZoomReached:y,ariaLabelConfig:b}=J(wc,se),{zoomIn:u,zoomOut:v,fitView:j}=Ft(),E=()=>{u(),r==null||r()},M=()=>{v(),i==null||i()},N=()=>{j(o),a==null||a()},A=()=>{g.setState({nodesDraggable:!w,nodesConnectable:!w,elementsSelectable:!w}),d==null||d(!w)},D=l==="horizontal"?"horizontal":"vertical";return h.jsxs(ut,{className:re(["react-flow__controls",D,f]),position:c,style:e,"data-testid":"rf__controls","aria-label":m??b["controls.ariaLabel"],children:[t&&h.jsxs(h.Fragment,{children:[h.jsx(et,{onClick:E,className:"react-flow__controls-zoomin",title:b["controls.zoomIn.ariaLabel"],"aria-label":b["controls.zoomIn.ariaLabel"],disabled:y,children:h.jsx(hc,{})}),h.jsx(et,{onClick:M,className:"react-flow__controls-zoomout",title:b["controls.zoomOut.ariaLabel"],"aria-label":b["controls.zoomOut.ariaLabel"],disabled:x,children:h.jsx(pc,{})})]}),n&&h.jsx(et,{className:"react-flow__controls-fitview",onClick:N,title:b["controls.fitView.ariaLabel"],"aria-label":b["controls.fitView.ariaLabel"],children:h.jsx(mc,{})}),s&&h.jsx(et,{className:"react-flow__controls-interactive",onClick:A,title:b["controls.interactive.ariaLabel"],"aria-label":b["controls.interactive.ariaLabel"],children:w?h.jsx(yc,{}):h.jsx(xc,{})}),p]})}to.displayName="Controls";const Jc=I.memo(to);function bc({id:e,x:t,y:n,width:s,height:o,style:r,color:i,strokeColor:a,strokeWidth:d,className:f,borderRadius:p,shapeRendering:c,selected:l,onClick:m}){const{background:g,backgroundColor:w}=r||{},x=i||g||w;return h.jsx("rect",{className:re(["react-flow__minimap-node",{selected:l},f]),x:t,y:n,rx:p,ry:p,width:s,height:o,style:{fill:x,stroke:a,strokeWidth:d},shapeRendering:c,onClick:m?y=>m(y,e):void 0})}const vc=I.memo(bc),Nc=e=>e.nodes.map(t=>t.id),Mt=e=>e instanceof Function?e:()=>e;function Ec({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:o,nodeComponent:r=vc,onClick:i}){const a=J(Nc,se),d=Mt(t),f=Mt(e),p=Mt(n),c=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return h.jsx(h.Fragment,{children:a.map(l=>h.jsx(Cc,{id:l,nodeColorFunc:d,nodeStrokeColorFunc:f,nodeClassNameFunc:p,nodeBorderRadius:s,nodeStrokeWidth:o,NodeComponent:r,onClick:i,shapeRendering:c},l))})}function Sc({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:o,nodeStrokeWidth:r,shapeRendering:i,NodeComponent:a,onClick:d}){const{node:f,x:p,y:c,width:l,height:m}=J(g=>{const{internals:w}=g.nodeLookup.get(e),x=w.userNode,{x:y,y:b}=w.positionAbsolute,{width:u,height:v}=ue(x);return{node:x,x:y,y:b,width:u,height:v}},se);return!f||f.hidden||!ns(f)?null:h.jsx(a,{x:p,y:c,width:l,height:m,style:f.style,selected:!!f.selected,className:s(f),color:t(f),borderRadius:o,strokeColor:n(f),strokeWidth:r,shapeRendering:i,onClick:d,id:f.id})}const Cc=I.memo(Sc);var Mc=I.memo(Ec);const jc=200,Ic=150,kc=e=>!e.hidden,Ac=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ts(We(e.nodeLookup,{filter:kc}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},_c="react-flow__minimap-desc";function no({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:o="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:a,bgColor:d,maskColor:f,maskStrokeColor:p,maskStrokeWidth:c,position:l="bottom-right",onClick:m,onNodeClick:g,pannable:w=!1,zoomable:x=!1,ariaLabel:y,inversePan:b,zoomStep:u=1,offsetScale:v=5}){const j=oe(),E=I.useRef(null),{boundingRect:M,viewBB:N,rfId:A,panZoom:D,translateExtent:C,flowWidth:S,flowHeight:P,ariaLabelConfig:L}=J(Ac,se),$=(e==null?void 0:e.width)??jc,T=(e==null?void 0:e.height)??Ic,z=M.width/$,_=M.height/T,k=Math.max(z,_),R=k*$,V=k*T,H=v*k,O=M.x-(R-M.width)/2-H,W=M.y-(V-M.height)/2-H,K=R+H*2,Z=V+H*2,Q=`${_c}-${A}`,B=I.useRef(0),q=I.useRef();B.current=k,I.useEffect(()=>{if(E.current&&D)return q.current=ri({domNode:E.current,panZoom:D,getTransform:()=>j.getState().transform,getViewScale:()=>B.current}),()=>{var Y;(Y=q.current)==null||Y.destroy()}},[D]),I.useEffect(()=>{var Y;(Y=q.current)==null||Y.update({translateExtent:C,width:S,height:P,inversePan:b,pannable:w,zoomStep:u,zoomable:x})},[w,x,b,u,C,S,P]);const U=m?Y=>{var ee;const[te,ne]=((ee=q.current)==null?void 0:ee.pointer(Y))||[0,0];m(Y,{x:te,y:ne})}:void 0,G=g?I.useCallback((Y,te)=>{const ne=j.getState().nodeLookup.get(te).internals.userNode;g(Y,ne)},[]):void 0,X=y??L["minimap.ariaLabel"];return h.jsx(ut,{position:l,style:{...e,"--xy-minimap-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-background-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-color-props":typeof p=="string"?p:void 0,"--xy-minimap-mask-stroke-width-props":typeof c=="number"?c*k:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:re(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:h.jsxs("svg",{width:$,height:T,viewBox:`${O} ${W} ${K} ${Z}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Q,ref:E,onClick:U,children:[X&&h.jsx("title",{id:Q,children:X}),h.jsx(Mc,{onClick:G,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:a}),h.jsx("path",{className:"react-flow__minimap-mask",d:`M${O-H},${W-H}h${K+H*2}v${Z+H*2}h${-K-H*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}no.displayName="MiniMap";const el=I.memo(no),Pc=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,$c={[$e.Line]:"right",[$e.Handle]:"bottom-right"};function Lc({nodeId:e,position:t,variant:n=$e.Handle,className:s,style:o=void 0,children:r,color:i,minWidth:a=10,minHeight:d=10,maxWidth:f=Number.MAX_VALUE,maxHeight:p=Number.MAX_VALUE,keepAspectRatio:c=!1,resizeDirection:l,autoScale:m=!0,shouldResize:g,onResizeStart:w,onResize:x,onResizeEnd:y}){const b=Ls(),u=typeof e=="string"?e:b,v=oe(),j=I.useRef(null),E=n===$e.Handle,M=J(I.useCallback(Pc(E&&m),[E,m]),se),N=I.useRef(null),A=t??$c[n];I.useEffect(()=>{if(!(!j.current||!u))return N.current||(N.current=wi({domNode:j.current,nodeId:u,getStoreItems:()=>{const{nodeLookup:C,transform:S,snapGrid:P,snapToGrid:L,nodeOrigin:$,domNode:T}=v.getState();return{nodeLookup:C,transform:S,snapGrid:P,snapToGrid:L,nodeOrigin:$,paneDomNode:T}},onChange:(C,S)=>{const{triggerNodeChanges:P,nodeLookup:L,parentLookup:$,nodeOrigin:T}=v.getState(),z=[],_={x:C.x,y:C.y},k=L.get(u);if(k&&k.expandParent&&k.parentId){const R=k.origin??T,V=C.width??k.measured.width??0,H=C.height??k.measured.height??0,O={id:k.id,parentId:k.parentId,rect:{width:V,height:H,...ss({x:C.x??k.position.x,y:C.y??k.position.y},{width:V,height:H},k.parentId,L,R)}},W=Vt([O],L,$,T);z.push(...W),_.x=C.x?Math.max(R[0]*V,C.x):void 0,_.y=C.y?Math.max(R[1]*H,C.y):void 0}if(_.x!==void 0&&_.y!==void 0){const R={id:u,type:"position",position:{..._}};z.push(R)}if(C.width!==void 0&&C.height!==void 0){const V={id:u,type:"dimensions",resizing:!0,setAttributes:l?l==="horizontal"?"width":"height":!0,dimensions:{width:C.width,height:C.height}};z.push(V)}for(const R of S){const V={...R,type:"position"};z.push(V)}P(z)},onEnd:({width:C,height:S})=>{const P={id:u,type:"dimensions",resizing:!1,dimensions:{width:C,height:S}};v.getState().triggerNodeChanges([P])}})),N.current.update({controlPosition:A,boundaries:{minWidth:a,minHeight:d,maxWidth:f,maxHeight:p},keepAspectRatio:c,resizeDirection:l,onResizeStart:w,onResize:x,onResizeEnd:y,shouldResize:g}),()=>{var C;(C=N.current)==null||C.destroy()}},[A,a,d,f,p,c,w,x,y,g]);const D=A.split("-");return h.jsx("div",{className:re(["react-flow__resize-control","nodrag",...D,n,s]),ref:j,style:{...o,scale:M,...i&&{[E?"backgroundColor":"borderColor"]:i}},children:r})}I.memo(Lc);const Vn={critical:"bg-red-500/20 text-red-400 border-red-500",high:"bg-orange-500/20 text-orange-400 border-orange-500",medium:"bg-yellow-500/20 text-yellow-400 border-yellow-500",low:"bg-green-500/20 text-green-400 border-green-500",info:"bg-blue-500/20 text-blue-400 border-blue-500"},zc={pending:"bg-gray-500/20 text-gray-400",accepted:"bg-green-500/20 text-green-400",rejected:"bg-red-500/20 text-red-400",running:"bg-blue-500/20 text-blue-400",completed:"bg-emerald-500/20 text-emerald-400",failed:"bg-red-500/20 text-red-400"},Hc=({className:e})=>h.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:h.jsx("path",{d:"M18 15l-6-6-6 6"})}),Dc=({className:e})=>h.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:h.jsx("path",{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"})}),Tc=({className:e})=>h.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[h.jsx("circle",{cx:"11",cy:"11",r:"8"}),h.jsx("path",{d:"m21 21-4.35-4.35"})]}),Rc=({className:e})=>h.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[h.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),h.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),h.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),Bc=({className:e})=>h.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[h.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),h.jsx("polyline",{points:"17 8 12 3 7 8"}),h.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),Vc={reconnaissance:Xn,initial_access:xr,execution:mr,persistence:en,privilege_escalation:Hc,defense_evasion:en,credential_access:Dc,discovery:Tc,lateral_movement:Wn,collection:Rc,exfiltration:Bc,impact:pr},tl=({topology:e,topologyId:t,scanId:n,engagementId:s,onClose:o})=>{const r=lr(),[i,a]=I.useState(null),[d,f]=I.useState(!1),[p,c]=I.useState(!1),{data:l,isLoading:m}=Ut({queryKey:["red-team-recommendations",t,n],queryFn:()=>Se.getRecommendations({topology_id:t,scan_id:n}).then(N=>N.data),enabled:d}),{data:g}=Ut({queryKey:["red-team-summary",t,n],queryFn:()=>Se.getSummary({topology_id:t,scan_id:n}).then(N=>N.data),enabled:d&&!!(l!=null&&l.length)}),w=Ze({mutationFn:()=>Se.analyzeTopology({topology:e,topology_id:t,scan_id:n,engagement_id:s,max_recommendations:20}),onSuccess:N=>{f(!0),ye.success(`Generated ${N.data.recommendations.length} recommendations`),r.invalidateQueries({queryKey:["red-team-recommendations"]}),r.invalidateQueries({queryKey:["red-team-summary"]})},onError:N=>{ye.error(`Analysis failed: ${N.message}`)}}),x=Ze({mutationFn:({id:N,status:A})=>Se.updateStatus(N,{status:A}),onSuccess:()=>{r.invalidateQueries({queryKey:["red-team-recommendations"]}),r.invalidateQueries({queryKey:["red-team-summary"]})},onError:N=>{ye.error(`Failed to update: ${N.message}`)}}),y=Ze({mutationFn:()=>Se.acceptAll(t),onSuccess:N=>{ye.success(N.data.message),r.invalidateQueries({queryKey:["red-team-recommendations"]}),r.invalidateQueries({queryKey:["red-team-summary"]})},onError:N=>{ye.error(`Failed: ${N.message}`)}}),b=Ze({mutationFn:()=>Se.rejectAll(t),onSuccess:N=>{ye.success(N.data.message),r.invalidateQueries({queryKey:["red-team-recommendations"]}),r.invalidateQueries({queryKey:["red-team-summary"]})},onError:N=>{ye.error(`Failed: ${N.message}`)}}),u=I.useCallback(()=>{c(!0),w.mutate()},[w]),v=I.useCallback(N=>{x.mutate({id:N,status:"accepted"})},[x]),j=I.useCallback(N=>{x.mutate({id:N,status:"rejected"})},[x]),E=I.useCallback(N=>{a(A=>A===N?null:N)},[]),M=(l==null?void 0:l.filter(N=>N.status==="pending").length)??0;return h.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 shadow-xl overflow-hidden",children:[h.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-cyan-600/20 to-purple-600/20 border-b border-gray-700",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:h.jsx(wt,{className:"w-5 h-5 text-cyan-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI Red Team Advisor"}),h.jsx("p",{className:"text-xs text-gray-400",children:"Powered by Claude AI"})]})]}),o&&h.jsx("button",{onClick:o,className:"p-1 hover:bg-gray-700 rounded",children:h.jsx(Jt,{className:"w-5 h-5 text-gray-400"})})]})}),h.jsx("div",{className:"p-4",children:d?m?h.jsxs("div",{className:"text-center py-8",children:[h.jsx(bt,{className:"w-8 h-8 text-cyan-400 mx-auto mb-4 animate-spin"}),h.jsx("p",{className:"text-gray-400",children:"Loading recommendations..."})]}):h.jsxs("div",{children:[g&&h.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-900/50 rounded-lg",children:[h.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[h.jsxs("span",{className:"text-gray-400",children:[h.jsx("span",{className:"text-white font-medium",children:g.total})," total"]}),h.jsxs("span",{className:"text-yellow-400",children:[h.jsx("span",{className:"font-medium",children:g.pending})," pending"]}),h.jsxs("span",{className:"text-green-400",children:[h.jsx("span",{className:"font-medium",children:g.accepted})," accepted"]}),h.jsxs("span",{className:"text-red-400",children:[h.jsx("span",{className:"font-medium",children:g.rejected})," rejected"]})]}),M>0&&h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsxs(Me,{size:"sm",variant:"outline",onClick:()=>y.mutate(),disabled:y.isPending,className:"text-green-400 border-green-500 hover:bg-green-500/20",children:[h.jsx(hr,{className:"w-3 h-3 mr-1"}),"Accept All"]}),h.jsxs(Me,{size:"sm",variant:"outline",onClick:()=>b.mutate(),disabled:b.isPending,className:"text-red-400 border-red-500 hover:bg-red-500/20",children:[h.jsx(Jt,{className:"w-3 h-3 mr-1"}),"Reject All"]})]})]}),h.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto pr-1",children:l==null?void 0:l.map(N=>h.jsx(Fc,{recommendation:N,expanded:i===N.id,onToggle:()=>E(N.id),onAccept:()=>v(N.id),onReject:()=>j(N.id),isUpdating:x.isPending},N.id))}),h.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:h.jsx(Me,{size:"sm",variant:"outline",onClick:u,disabled:w.isPending,className:"w-full",children:w.isPending?h.jsxs(h.Fragment,{children:[h.jsx(bt,{className:"w-4 h-4 mr-2 animate-spin"}),"Analyzing..."]}):h.jsxs(h.Fragment,{children:[h.jsx(wt,{className:"w-4 h-4 mr-2"}),"Re-analyze Topology"]})})})]}):h.jsxs("div",{className:"text-center py-8",children:[h.jsx(gr,{className:"w-12 h-12 text-cyan-400 mx-auto mb-4"}),h.jsx("h4",{className:"text-lg font-medium text-white mb-2",children:"Analyze Network Topology"}),h.jsx("p",{className:"text-sm text-gray-400 mb-6 max-w-md mx-auto",children:"Let AI analyze your network topology and generate targeted red team recommendations based on detected devices, services, and security zones."}),h.jsx(Me,{onClick:u,disabled:w.isPending,className:"bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-cyan-500 hover:to-purple-500",children:w.isPending?h.jsxs(h.Fragment,{children:[h.jsx(bt,{className:"w-4 h-4 mr-2 animate-spin"}),"Analyzing..."]}):h.jsxs(h.Fragment,{children:[h.jsx(wt,{className:"w-4 h-4 mr-2"}),"Generate Recommendations"]})}),h.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:[e.nodes.length," nodes, ",e.edges.length," connections"]})]})})]})},Fc=({recommendation:e,expanded:t,onToggle:n,onAccept:s,onReject:o,isUpdating:r})=>{const i=Vc[e.action_category]||Xn,a=e.status==="pending";return h.jsxs("div",{className:`rounded-lg border transition-all ${t?"bg-gray-900/70 border-cyan-500/50":"bg-gray-900/30 border-gray-700 hover:border-gray-600"}`,children:[h.jsxs("div",{className:"flex items-center gap-3 p-3 cursor-pointer",onClick:n,children:[h.jsx("div",{className:`p-2 rounded-lg ${Vn[e.risk_level]}`,children:h.jsx(i,{className:"w-4 h-4"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"font-medium text-white truncate",children:e.title}),h.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${zc[e.status]}`,children:e.status})]}),h.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mt-0.5",children:[h.jsx("span",{children:e.target_ip||e.target_hostname||e.target_node_id}),e.mitre_technique_id&&h.jsxs(h.Fragment,{children:[h.jsx("span",{className:"text-gray-600",children:"|"}),h.jsx("span",{className:"text-cyan-400",children:e.mitre_technique_id})]}),e.estimated_time_minutes&&h.jsxs(h.Fragment,{children:[h.jsx("span",{className:"text-gray-600",children:"|"}),h.jsx(yr,{className:"w-3 h-3"}),h.jsxs("span",{children:[e.estimated_time_minutes,"m"]})]})]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:`px-2 py-1 rounded text-xs border ${Vn[e.risk_level]}`,children:e.risk_level}),t?h.jsx(wr,{className:"w-4 h-4 text-gray-400"}):h.jsx(Wn,{className:"w-4 h-4 text-gray-400"})]})]}),t&&h.jsx("div",{className:"px-3 pb-3 border-t border-gray-700/50",children:h.jsxs("div",{className:"pt-3 space-y-3",children:[h.jsxs("div",{children:[h.jsx("h5",{className:"text-xs font-medium text-gray-400 mb-1",children:"Description"}),h.jsx("p",{className:"text-sm text-gray-300",children:e.description})]}),e.rationale&&h.jsxs("div",{children:[h.jsx("h5",{className:"text-xs font-medium text-gray-400 mb-1",children:"Rationale"}),h.jsx("p",{className:"text-sm text-gray-300",children:e.rationale})]}),e.mitre_technique_name&&h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx("span",{className:"text-gray-400",children:"MITRE ATT&CK:"}),h.jsx("span",{className:"text-cyan-400",children:e.mitre_technique_id}),h.jsxs("span",{className:"text-gray-300",children:["- ",e.mitre_technique_name]}),e.mitre_tactic&&h.jsxs("span",{className:"text-gray-500",children:["(",e.mitre_tactic,")"]})]}),e.command_template&&h.jsxs("div",{children:[h.jsxs("h5",{className:"text-xs font-medium text-gray-400 mb-1 flex items-center gap-1",children:[h.jsx(br,{className:"w-3 h-3"}),"Command Template"]}),h.jsx("code",{className:"block text-xs bg-gray-800 text-green-400 p-2 rounded font-mono overflow-x-auto",children:e.command_template})]}),e.tool_name&&h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx("span",{className:"text-gray-400",children:"Tool:"}),h.jsx("span",{className:"px-2 py-0.5 bg-gray-800 text-gray-300 rounded text-xs",children:e.tool_name})]}),a&&h.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-700/50",children:[h.jsxs(Me,{size:"sm",onClick:d=>{d.stopPropagation(),s()},disabled:r,className:"flex-1 bg-green-600 hover:bg-green-500",children:[h.jsx(vt,{className:"w-4 h-4 mr-1"}),"Accept"]}),h.jsxs(Me,{size:"sm",variant:"outline",onClick:d=>{d.stopPropagation(),o()},disabled:r,className:"flex-1 text-red-400 border-red-500 hover:bg-red-500/20",children:[h.jsx(tn,{className:"w-4 h-4 mr-1"}),"Reject"]})]}),!a&&h.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-700/50",children:[e.status==="accepted"&&h.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[h.jsx(vt,{className:"w-4 h-4"}),"Accepted ",e.accepted_at&&`on ${new Date(e.accepted_at).toLocaleDateString()}`]}),e.status==="rejected"&&h.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[h.jsx(tn,{className:"w-4 h-4"}),"Rejected ",e.rejected_at&&`on ${new Date(e.rejected_at).toLocaleDateString()}`]}),e.status==="completed"&&h.jsxs("div",{className:"flex items-center gap-2 text-emerald-400 text-sm",children:[h.jsx(vt,{className:"w-4 h-4"}),"Completed"]})]})]})})]})};export{Uc as B,Jc as C,ot as H,tt as M,ut as P,tl as R,Qc as a,me as b,el as c,F as d,ic as e,Ft as f,Dr as g,Kc as i,Zc as u};
