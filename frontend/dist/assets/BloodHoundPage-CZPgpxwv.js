import{b as T,u as _,d as w,j as e}from"./vendor-state-BjT_zREg.js";import{r as o,R as U}from"./vendor-react-5KxtEOLM.js";import{B as b,aa as f,b7 as h,ap as E,w as K,e as P,y as j,p as B,ac as H,K as R,ar as S,cg as N,S as $,b2 as C,$ as A,a0 as F}from"./vendor-ui-CfSMq23b.js";import{L as I}from"./Layout-C_2au5Vm.js";import{u as M,E as z}from"./useRequireEngagement-PpLJuw5s.js";import{ab as g,B as k}from"./index-CJ_zz9jP.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";const Q=({onUpload:s,isUploading:r,hasEngagement:d})=>{const[n,i]=o.useState(!1),t=U.useRef(null),c=o.useCallback(l=>{l.preventDefault(),l.stopPropagation(),l.type==="dragenter"||l.type==="dragover"?i(!0):l.type==="dragleave"&&i(!1)},[]),u=o.useCallback(l=>{l.preventDefault(),l.stopPropagation(),i(!1),l.dataTransfer.files&&l.dataTransfer.files[0]&&s(l.dataTransfer.files[0])},[s]),p=l=>{l.target.files&&l.target.files[0]&&s(l.target.files[0])};return e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${n?"border-primary bg-primary/10":"border-slate-300 dark:border-slate-600 hover:border-primary"}`,onDragEnter:c,onDragLeave:c,onDragOver:c,onDrop:u,children:[e.jsx("input",{ref:t,type:"file",accept:".zip,.json",onChange:p,className:"hidden"}),e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-lg font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Drop SharpHound data here"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Supports .zip archives and individual .json files"}),e.jsx(k,{onClick:()=>{var l;return(l=t.current)==null?void 0:l.click()},disabled:r||!d,variant:"primary",children:r?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Select File"]})})]})},O=({path:s})=>{const[r,d]=o.useState(!1);return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>d(!r),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(h,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:s.start_node.name}),e.jsx(A,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"font-medium text-red-500",children:s.end_node.name})]}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[s.length," steps | Risk Score: ",s.risk_score]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.risk_score>=80?"bg-red-500/20 text-red-500":s.risk_score>=50?"bg-orange-500/20 text-orange-500":"bg-yellow-500/20 text-yellow-500"}`,children:s.risk_score>=80?"Critical":s.risk_score>=50?"High":"Medium"}),e.jsx(A,{className:`h-5 w-5 text-slate-400 transition-transform ${r?"rotate-90":""}`})]})]}),r&&e.jsxs("div",{className:"mt-4 space-y-3",children:[s.path.map((n,i)=>e.jsx("div",{className:"flex items-start gap-3 pl-4 border-l-2 border-slate-300 dark:border-slate-600",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:n.from_node.name}),e.jsx("span",{className:"px-2 py-0.5 bg-primary/20 text-primary rounded text-xs",children:n.relationship}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:n.to_node.name})]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:n.abuse_info}),n.opsec_considerations&&e.jsxs("p",{className:"text-xs text-orange-500 mt-1",children:["OPSEC: ",n.opsec_considerations]})]})},i)),s.techniques.length>0&&e.jsxs("div",{className:"pt-3 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-2",children:"MITRE ATT&CK:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.techniques.map((n,i)=>e.jsxs("a",{href:`https://attack.mitre.org/techniques/${n.replace(".","/")}`,target:"_blank",rel:"noopener noreferrer",className:"px-2 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-xs text-slate-600 dark:text-slate-400 hover:bg-primary/20 hover:text-primary flex items-center gap-1",children:[n,e.jsx(F,{className:"h-3 w-3"})]},i))})]})]})]})},D=({users:s})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"User"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Domain"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"SPNs"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Admin"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Password Set"})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:r.name})]})}),e.jsx("td",{className:"py-2 px-3 text-sm text-slate-600 dark:text-slate-400",children:r.domain}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.service_principal_names.slice(0,2).map((d,n)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-xs",children:d.length>30?d.substring(0,30)+"...":d},n)),r.service_principal_names.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-xs",children:["+",r.service_principal_names.length-2," more"]})]})}),e.jsx("td",{className:"py-2 px-3",children:r.is_admin?e.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-500 rounded text-xs",children:"Admin"}):e.jsx("span",{className:"text-slate-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-sm text-slate-600 dark:text-slate-400",children:r.password_last_set||"Unknown"})]},r.object_id))})]})}),G=({importData:s,onClose:r})=>{const[d,n]=o.useState("paths"),i=[{id:"paths",label:"Attack Paths",icon:h,count:s.attack_paths.length},{id:"kerberos",label:"Kerberoastable",icon:R,count:s.kerberoastable_users.length},{id:"asrep",label:"AS-REP Roastable",icon:S,count:s.asrep_roastable_users.length},{id:"delegation",label:"Unconstrained Delegation",icon:j,count:s.unconstrained_delegation.length},{id:"targets",label:"High-Value Targets",icon:N,count:s.high_value_targets.length}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:s.domain}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Imported ",new Date(s.created_at).toLocaleString()]})]}),e.jsx(k,{variant:"secondary",onClick:r,children:"Back to List"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Users"})]}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:s.statistics.total_users})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Computers"})]}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:s.statistics.total_computers})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Groups"})]}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:s.statistics.total_groups})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-slate-400 mb-1",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Sessions"})]}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:s.statistics.total_sessions})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-500 mb-1",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Domain Admins"})]}),e.jsx("p",{className:"text-xl font-semibold text-red-500",children:s.statistics.domain_admins})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-500 mb-1",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Attack Paths"})]}),e.jsx("p",{className:"text-xl font-semibold text-orange-500",children:s.statistics.attack_paths_found})]})]}),e.jsx("div",{className:"border-b border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex gap-4 overflow-x-auto",children:i.map(t=>e.jsxs("button",{onClick:()=>n(t.id),className:`flex items-center gap-2 px-4 py-2 border-b-2 transition-colors whitespace-nowrap ${d===t.id?"border-primary text-primary":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.label,e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-xs",children:t.count})]},t.id))})}),e.jsxs("div",{children:[d==="paths"&&e.jsx("div",{className:"space-y-3",children:s.attack_paths.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:"No attack paths found"}):s.attack_paths.map(t=>e.jsx(O,{path:t},t.id))}),d==="kerberos"&&e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:s.kerberoastable_users.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:"No Kerberoastable users found"}):e.jsx(D,{users:s.kerberoastable_users})}),d==="asrep"&&e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg overflow-hidden",children:s.asrep_roastable_users.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:"No AS-REP roastable users found"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"User"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Domain"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Enabled"}),e.jsx("th",{className:"text-left py-2 px-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Admin"})]})}),e.jsx("tbody",{children:s.asrep_roastable_users.map(t=>e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-800",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:t.name})]})}),e.jsx("td",{className:"py-2 px-3 text-sm text-slate-600 dark:text-slate-400",children:t.domain}),e.jsx("td",{className:"py-2 px-3",children:t.is_enabled?e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-500 rounded text-xs",children:"Yes"}):e.jsx("span",{className:"px-2 py-0.5 bg-slate-500/20 text-slate-500 rounded text-xs",children:"No"})}),e.jsx("td",{className:"py-2 px-3",children:t.is_admin?e.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-500 rounded text-xs",children:"Admin"}):e.jsx("span",{className:"text-slate-400",children:"-"})})]},t.object_id))})]})}),d==="delegation"&&e.jsx("div",{className:"grid gap-3",children:s.unconstrained_delegation.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:"No unconstrained delegation found"}):s.unconstrained_delegation.map(t=>e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.is_dc?"bg-red-500/20":"bg-orange-500/20"}`,children:e.jsx(j,{className:`h-5 w-5 ${t.is_dc?"text-red-500":"text-orange-500"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-300",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[t.object_type," | ",t.domain]})]})]}),t.is_dc&&e.jsx("span",{className:"px-2 py-1 bg-red-500/20 text-red-500 rounded text-xs",children:"Domain Controller"})]},t.object_id))}),d==="targets"&&e.jsx("div",{className:"grid gap-3",children:s.high_value_targets.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-8",children:"No high-value targets found"}):s.high_value_targets.map(t=>e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500/20 rounded-lg",children:e.jsx(N,{className:"h-5 w-5 text-yellow-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-300",children:t.name}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t.reason})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[t.paths_to_target," paths"]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.object_type})]})]},t.object_id))})]})]})},te=()=>{var v,y;const s=T(),[r,d]=o.useState(null),{hasEngagement:n}=M(),{data:i,isLoading:t}=_({queryKey:["bloodhound-imports"],queryFn:()=>g.listImports()}),{data:c,isLoading:u}=_({queryKey:["bloodhound-import",r],queryFn:()=>g.getImport(r),enabled:!!r}),p=w({mutationFn:a=>g.uploadData(a),onSuccess:a=>{b.success(a.data.message),s.invalidateQueries({queryKey:["bloodhound-imports"]})},onError:a=>{var x,m;b.error(((m=(x=a.response)==null?void 0:x.data)==null?void 0:m.message)||"Upload failed")}}),l=w({mutationFn:a=>g.deleteImport(a),onSuccess:()=>{b.success("Import deleted"),s.invalidateQueries({queryKey:["bloodhound-imports"]}),d(null)},onError:a=>{var x,m;b.error(((m=(x=a.response)==null?void 0:x.data)==null?void 0:m.message)||"Delete failed")}}),q=a=>{p.mutate(a)},L=a=>{confirm("Are you sure you want to delete this import?")&&l.mutate(a)};return r&&(c!=null&&c.data)?e.jsx(I,{children:e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(f,{className:"h-8 w-8 text-primary animate-spin"})}):e.jsx(G,{importData:c.data,onClose:()=>d(null)})})}):e.jsx(I,{children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(h,{className:"h-6 w-6 text-primary"})}),"BloodHound Integration"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Import SharpHound data and analyze Active Directory attack paths"})]}),e.jsx(z,{toolName:"BloodHound Integration",className:"mb-6"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white mb-4",children:"Import SharpHound Data"}),e.jsx(Q,{onUpload:q,isUploading:p.isPending,hasEngagement:n})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx("div",{className:"p-4 border-b border-light-border dark:border-dark-border",children:e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Previous Imports"})}),t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(f,{className:"h-8 w-8 text-primary animate-spin"})}):(y=(v=i==null?void 0:i.data)==null?void 0:v.imports)!=null&&y.length?e.jsx("div",{className:"divide-y divide-light-border dark:divide-dark-border",children:i.data.imports.map(a=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer flex-1",onClick:()=>d(a.id),children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(K,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-300",children:a.domain}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),a.statistics.total_users," users"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3 w-3"}),a.statistics.total_computers," computers"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"}),a.statistics.attack_paths_found," paths"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),new Date(a.created_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${a.status==="completed"?"bg-green-500/20 text-green-500":a.status==="processing"?"bg-yellow-500/20 text-yellow-500":"bg-red-500/20 text-red-500"}`,children:a.status}),e.jsx(k,{variant:"ghost",size:"sm",onClick:x=>{x.stopPropagation(),L(a.id)},children:e.jsx(H,{className:"h-4 w-4 text-red-500"})})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12 text-slate-500 dark:text-slate-400",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No imports yet. Upload SharpHound data to get started."})]})]})]})})};export{te as default};
