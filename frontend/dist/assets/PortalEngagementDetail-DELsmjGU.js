import{j as e}from"./vendor-state-BXNPjUwt.js";import{i as f,r as s,L as c}from"./vendor-react-5KxtEOLM.js";import{P as d}from"./PortalLayout-Bj17qdPQ.js";import{aw as x}from"./index-t7VPhhr8.js";import{aO as j}from"./vendor-ui-DGSzT-Xm.js";import"./vendor-utils-DfRopTPV.js";const N={pending:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",in_progress:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",completed:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300"};function L(){const{id:a}=f(),[r,g]=s.useState(null),[m,b]=s.useState(!0),[l,h]=s.useState(""),[n,i]=s.useState(null);s.useEffect(()=>{a&&o()},[a]);const o=async()=>{if(a)try{const t=await x.getById(a);g(t.data)}catch(t){h("Failed to load engagement"),console.error(t)}finally{b(!1)}},u=async(t,p)=>{if(a){i(t.id);try{await x.updateMilestone(a,t.id,{status:p}),o()}catch(k){console.error("Failed to update milestone:",k)}finally{i(null)}}};return m?e.jsx(d,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}):l||!r?e.jsx(d,{children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 p-4 rounded-lg",children:l||"Engagement not found"})}):e.jsx(d,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{to:"/portal/engagements",className:"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white",children:e.jsx(j,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:r.engagement.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Status"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white capitalize",children:r.engagement.status.replace("_"," ")})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Scans"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:r.scan_count})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Vulnerabilities"}),e.jsx(c,{to:`/portal/vulnerabilities?engagement_id=${a}`,className:"text-lg font-semibold text-primary hover:text-primary-dark",children:r.vulnerability_count})]})]}),r.engagement.scope&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Scope"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 whitespace-pre-wrap",children:r.engagement.scope})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:"Milestones"}),r.milestones.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No milestones defined"}):e.jsx("div",{className:"space-y-4",children:r.milestones.map(t=>e.jsx("div",{className:"border border-light-border dark:border-dark-border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-white",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:t.description}),t.due_date&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-2",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${N[t.status]||"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-300"}`,children:t.status}),t.status!=="completed"&&e.jsx("button",{onClick:()=>u(t,"completed"),disabled:n===t.id,className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-xs rounded disabled:opacity-50 transition-colors",children:n===t.id?"...":"Complete"})]})]})},t.id))})]})]})})}export{L as default};
