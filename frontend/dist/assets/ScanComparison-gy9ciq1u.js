import{j as e}from"./vendor-state-DdX3IZQk.js";import{r as x}from"./vendor-react-Da1CiaFS.js";import{B as u,n as G,bu as X,o as H,N as L,S as J,A as je,as as be,b as P,z as B,a2 as v,_ as j,aw as S,ah as Y,al as A,aj as q,ad as Ne}from"./vendor-ui-eP5rASc6.js";import{q as we,C as m,L as W,B as _e,b as Q,W as Z,X as ye}from"./index-CAHqSsrb.js";import{R as V,j as D,k as ee,C as se,T as I,L as te,B as fe,t as Ce,X as Se,Y as $e,h as ke}from"./vendor-charts-DQXNY-Mg.js";const g={added:"#22c55e",removed:"#ef4444",changed:"#eab308",newVulns:"#ef4444",resolved:"#22c55e"},Be=()=>{const[f,ae]=x.useState([]),[re,T]=x.useState(!0),[b,le]=x.useState(""),[N,ne]=x.useState(""),[ce,O]=x.useState(!1),[r,F]=x.useState(null),[U,C]=x.useState(new Set),[h,w]=x.useState("all"),[M,z]=x.useState(!1);x.useEffect(()=>{de()},[]);const de=async()=>{T(!0);try{const c=(await we.getAll()).data.filter(o=>o.status==="completed").sort((o,a)=>new Date(a.created_at).getTime()-new Date(o.created_at).getTime());ae(c)}catch(s){u.error("Failed to load scans"),console.error(s)}finally{T(!1)}},ie=async()=>{var s,c;if(!b||!N){u.error("Please select two scans to compare");return}if(b===N){u.error("Please select two different scans");return}O(!0),F(null),C(new Set);try{const o=await ye.compare(b,N);F(o.data),u.success("Comparison completed")}catch(o){const a=o;u.error(((c=(s=a.response)==null?void 0:s.data)==null?void 0:c.error)||"Failed to compare scans"),console.error(o)}finally{O(!1)}},oe=s=>{const c=new Set(U);c.has(s)?c.delete(s):c.add(s),C(c)},xe=()=>{if(r){const s=r.diff.host_changes.map(c=>c.ip);C(new Set(s))}},me=()=>{C(new Set)},he=s=>{switch(s){case"NewService":return e.jsx(v,{className:"h-3 w-3 text-green-400"});case"ServiceRemoved":return e.jsx(j,{className:"h-3 w-3 text-red-400"});case"ServiceChanged":case"VersionChanged":return e.jsx(S,{className:"h-3 w-3 text-yellow-400"});default:return null}},pe=s=>{switch(s){case"NewService":return"New Service";case"ServiceRemoved":return"Service Removed";case"ServiceChanged":return"Service Changed";case"VersionChanged":return"Version Changed";default:return s}},$=x.useMemo(()=>r?r.diff.host_changes.filter(s=>h==="all"?!0:h==="added"?s.new_ports.length>0||s.new_vulnerabilities.length>0:h==="removed"?s.closed_ports.length>0||s.resolved_vulnerabilities.length>0:h==="changed"?s.service_changes.length>0||s.os_change!==null:!0):[],[r,h]),k=x.useMemo(()=>{if(!r)return[];const{summary:s}=r.diff;return[{name:"New Hosts",value:s.total_new_hosts,color:g.added},{name:"Removed Hosts",value:s.total_removed_hosts,color:g.removed},{name:"Changed Hosts",value:s.total_hosts_changed,color:g.changed}].filter(c=>c.value>0)},[r]),ge=x.useMemo(()=>{if(!r)return[];const{summary:s}=r.diff;return[{name:"New Ports",value:s.total_new_ports,fill:g.added},{name:"Closed Ports",value:s.total_closed_ports,fill:g.removed},{name:"Service Changes",value:s.total_service_changes,fill:g.changed}]},[r]),E=x.useMemo(()=>{if(!r)return[];const{summary:s}=r.diff;return[{name:"New Vulnerabilities",value:s.total_new_vulnerabilities,color:g.newVulns},{name:"Resolved",value:s.total_resolved_vulnerabilities,color:g.resolved}].filter(c=>c.value>0)},[r]),R=async s=>{if(r){z(!0);try{let c,o,a;const{scan1:p,scan2:_,diff:d}=r;if(s==="json")c=JSON.stringify(r,null,2),o=`scan-comparison-${p.id.slice(0,8)}-vs-${_.id.slice(0,8)}.json`,a="application/json";else if(s==="csv"){const t=[];t.push("Type,IP/Host,Port,Protocol,Details,Severity"),d.new_hosts.forEach(n=>{t.push(`New Host,${n},,,"New host discovered in scan 2",`)}),d.removed_hosts.forEach(n=>{t.push(`Removed Host,${n},,,"Host no longer present in scan 2",`)}),d.host_changes.forEach(n=>{n.new_ports.forEach(l=>{var i;t.push(`New Port,${n.ip},${l.port},${l.protocol},"${((i=l.service)==null?void 0:i.name)||"Unknown"}",`)}),n.closed_ports.forEach(l=>{var i;t.push(`Closed Port,${n.ip},${l.port},${l.protocol},"${((i=l.service)==null?void 0:i.name)||"Unknown"}",`)}),n.new_vulnerabilities.forEach(l=>{t.push(`New Vulnerability,${n.ip},,,"${l.title.replace(/"/g,'""')}",${l.severity}`)}),n.resolved_vulnerabilities.forEach(l=>{t.push(`Resolved Vulnerability,${n.ip},,,"${l.title.replace(/"/g,'""')}",${l.severity}`)}),n.service_changes.forEach(l=>{const i=`${l.old_service||"None"} -> ${l.new_service||"None"}`;t.push(`Service Change,${n.ip},${l.port},${l.protocol},"${i}",`)})}),c=t.join(`
`),o=`scan-comparison-${p.id.slice(0,8)}-vs-${_.id.slice(0,8)}.csv`,a="text/csv"}else{const t=[];t.push("# Scan Comparison Report"),t.push(""),t.push("## Scan Details"),t.push(""),t.push("| Scan | Name | Date |"),t.push("|------|------|------|"),t.push(`| Baseline (A) | ${p.name} | ${new Date(p.created_at).toLocaleString()} |`),t.push(`| Comparison (B) | ${_.name} | ${new Date(_.created_at).toLocaleString()} |`),t.push(""),t.push("## Summary"),t.push(""),t.push("| Metric | Count |"),t.push("|--------|-------|"),t.push(`| New Hosts | ${d.summary.total_new_hosts} |`),t.push(`| Removed Hosts | ${d.summary.total_removed_hosts} |`),t.push(`| Changed Hosts | ${d.summary.total_hosts_changed} |`),t.push(`| New Ports | ${d.summary.total_new_ports} |`),t.push(`| Closed Ports | ${d.summary.total_closed_ports} |`),t.push(`| New Vulnerabilities | ${d.summary.total_new_vulnerabilities} |`),t.push(`| Resolved Vulnerabilities | ${d.summary.total_resolved_vulnerabilities} |`),t.push(`| Service Changes | ${d.summary.total_service_changes} |`),t.push(""),d.new_hosts.length>0&&(t.push("## New Hosts"),t.push(""),d.new_hosts.forEach(n=>{t.push(`- ${n}`)}),t.push("")),d.removed_hosts.length>0&&(t.push("## Removed Hosts"),t.push(""),d.removed_hosts.forEach(n=>{t.push(`- ${n}`)}),t.push("")),d.host_changes.length>0&&(t.push("## Host Changes"),t.push(""),d.host_changes.forEach(n=>{t.push(`### ${n.ip}${n.hostname?` (${n.hostname})`:""}`),t.push(""),n.new_ports.length>0&&(t.push("**New Ports:**"),n.new_ports.forEach(l=>{var i;t.push(`- ${l.port}/${l.protocol} - ${((i=l.service)==null?void 0:i.name)||"Unknown"}`)}),t.push("")),n.closed_ports.length>0&&(t.push("**Closed Ports:**"),n.closed_ports.forEach(l=>{var i;t.push(`- ${l.port}/${l.protocol} - ${((i=l.service)==null?void 0:i.name)||"Unknown"}`)}),t.push("")),n.new_vulnerabilities.length>0&&(t.push("**New Vulnerabilities:**"),n.new_vulnerabilities.forEach(l=>{t.push(`- [${l.severity}] ${l.cve_id||l.title}`)}),t.push("")),n.resolved_vulnerabilities.length>0&&(t.push("**Resolved Vulnerabilities:**"),n.resolved_vulnerabilities.forEach(l=>{t.push(`- [${l.severity}] ${l.cve_id||l.title}`)}),t.push("")),n.service_changes.length>0&&(t.push("**Service Changes:**"),n.service_changes.forEach(l=>{const i=l.old_version?` ${l.old_version}`:"",ve=l.new_version?` ${l.new_version}`:"";t.push(`- Port ${l.port}: ${l.old_service||"None"}${i} -> ${l.new_service||"None"}${ve}`)}),t.push("")),n.os_change&&(t.push("**OS Change:**"),t.push(`- ${n.os_change.old_os} (${n.os_change.old_confidence}%) -> ${n.os_change.new_os} (${n.os_change.new_confidence}%)`),t.push(""))})),t.push("---"),t.push(`*Generated on ${new Date().toLocaleString()}*`),c=t.join(`
`),o=`scan-comparison-${p.id.slice(0,8)}-vs-${_.id.slice(0,8)}.md`,a="text/markdown"}const ue=new Blob([c],{type:a}),K=URL.createObjectURL(ue),y=document.createElement("a");y.href=K,y.download=o,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(K),u.success(`Comparison exported as ${s.toUpperCase()}`)}catch(c){console.error("Export error:",c),u.error("Failed to export comparison")}finally{z(!1)}}};return re?e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(W,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Compare Scans"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Select two completed scans to compare their results and identify changes in hosts, ports, services, and vulnerabilities."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Baseline Scan (A - Older)"}),e.jsxs("select",{value:b,onChange:s=>le(s.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),f.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",new Date(s.created_at).toLocaleString()]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Comparison Scan (B - Newer)"}),e.jsxs("select",{value:N,onChange:s=>ne(s.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),f.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",new Date(s.created_at).toLocaleString()]},s.id))]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:[e.jsx(X,{className:"inline h-3 w-3 mr-1"}),"Changes are shown relative to the baseline scan (A to B)"]}),e.jsxs(_e,{variant:"primary",onClick:ie,loading:ce,disabled:!b||!N||b===N,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Compare Scans"]})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(m,{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),"Host Changes"]}),k.length>0?e.jsx(V,{width:"100%",height:180,children:e.jsxs(D,{children:[e.jsx(ee,{data:k,cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,paddingAngle:2,dataKey:"value",children:k.map((s,c)=>e.jsx(se,{fill:s.color},`cell-${c}`))}),e.jsx(I,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155"},labelStyle:{color:"#f8fafc"}}),e.jsx(te,{wrapperStyle:{fontSize:"12px"},formatter:s=>e.jsx("span",{className:"text-slate-300",children:s})})]})}):e.jsx("div",{className:"h-[180px] flex items-center justify-center text-slate-500 text-sm",children:"No host changes detected"})]}),e.jsxs(m,{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-primary"}),"Port & Service Changes"]}),e.jsx(V,{width:"100%",height:180,children:e.jsxs(fe,{data:ge,layout:"vertical",children:[e.jsx(Ce,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(Se,{type:"number",tick:{fill:"#94a3b8",fontSize:11}}),e.jsx($e,{dataKey:"name",type:"category",tick:{fill:"#94a3b8",fontSize:11},width:100}),e.jsx(I,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155"},labelStyle:{color:"#f8fafc"}}),e.jsx(ke,{dataKey:"value",radius:[0,4,4,0]})]})})]}),e.jsxs(m,{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-primary"}),"Vulnerability Changes"]}),E.length>0?e.jsx(V,{width:"100%",height:180,children:e.jsxs(D,{children:[e.jsx(ee,{data:E,cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,paddingAngle:2,dataKey:"value",children:E.map((s,c)=>e.jsx(se,{fill:s.color},`cell-${c}`))}),e.jsx(I,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155"},labelStyle:{color:"#f8fafc"}}),e.jsx(te,{wrapperStyle:{fontSize:"12px"},formatter:s=>e.jsx("span",{className:"text-slate-300",children:s})})]})}):e.jsx("div",{className:"h-[180px] flex items-center justify-center text-slate-500 text-sm",children:"No vulnerability changes detected"})]})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Comparison Summary"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-dark-bg border border-dark-border rounded-lg hover:border-primary transition-colors",onClick:()=>{const s=document.getElementById("export-dropdown");s&&s.classList.toggle("hidden")},disabled:M,children:M?e.jsx(W,{}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-slate-300",children:"Export"}),e.jsx(P,{className:"h-3 w-3 text-slate-400"})]})}),e.jsxs("div",{id:"export-dropdown",className:"hidden absolute right-0 mt-1 w-40 bg-dark-surface border border-dark-border rounded-lg shadow-xl z-10",children:[e.jsxs("button",{onClick:()=>{var s;R("json"),(s=document.getElementById("export-dropdown"))==null||s.classList.add("hidden")},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover transition-colors rounded-t-lg",children:[e.jsx(B,{className:"h-4 w-4"}),"JSON"]}),e.jsxs("button",{onClick:()=>{var s;R("csv"),(s=document.getElementById("export-dropdown"))==null||s.classList.add("hidden")},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover transition-colors",children:[e.jsx(B,{className:"h-4 w-4"}),"CSV"]}),e.jsxs("button",{onClick:()=>{var s;R("markdown"),(s=document.getElementById("export-dropdown"))==null||s.classList.add("hidden")},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-300 hover:bg-dark-hover transition-colors rounded-b-lg",children:[e.jsx(B,{className:"h-4 w-4"}),"Markdown"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-3 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Baseline (A)"}),e.jsx("p",{className:"text-sm text-slate-300 font-medium",children:r.scan1.name}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(r.scan1.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Comparison (B)"}),e.jsx("p",{className:"text-sm text-slate-300 font-medium",children:r.scan2.name}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(r.scan2.created_at).toLocaleString()})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(v,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Hosts"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:r.diff.summary.total_new_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(j,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Removed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:r.diff.summary.total_removed_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(S,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Changed"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:r.diff.summary.total_hosts_changed})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(L,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Ports"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:r.diff.summary.total_new_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(L,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Closed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:r.diff.summary.total_closed_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Y,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Vulns"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:r.diff.summary.total_new_vulnerabilities})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(A,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:r.diff.summary.total_resolved_vulnerabilities})]})]})]}),r.diff.new_hosts.length>0&&e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"h-5 w-5 text-green-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["New Hosts (",r.diff.new_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.diff.new_hosts.map(s=>e.jsx("span",{className:"px-3 py-1.5 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 font-mono text-sm",children:s},s))})]}),r.diff.removed_hosts.length>0&&e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(j,{className:"h-5 w-5 text-red-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Removed Hosts (",r.diff.removed_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.diff.removed_hosts.map(s=>e.jsx("span",{className:"px-3 py-1.5 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 font-mono text-sm",children:s},s))})]}),r.diff.host_changes.length>0&&e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Host Changes (",$.length,h!=="all"&&` of ${r.diff.host_changes.length}`,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-dark-bg rounded-lg p-1 border border-dark-border",children:[e.jsx("button",{onClick:()=>w("all"),className:`px-3 py-1 text-xs rounded-md transition-colors ${h==="all"?"bg-primary text-white":"text-slate-400 hover:text-white"}`,children:"All"}),e.jsxs("button",{onClick:()=>w("added"),className:`px-3 py-1 text-xs rounded-md transition-colors ${h==="added"?"bg-green-500 text-white":"text-slate-400 hover:text-green-400"}`,children:[e.jsx(v,{className:"h-3 w-3 inline mr-1"}),"Added"]}),e.jsxs("button",{onClick:()=>w("removed"),className:`px-3 py-1 text-xs rounded-md transition-colors ${h==="removed"?"bg-red-500 text-white":"text-slate-400 hover:text-red-400"}`,children:[e.jsx(j,{className:"h-3 w-3 inline mr-1"}),"Removed"]}),e.jsxs("button",{onClick:()=>w("changed"),className:`px-3 py-1 text-xs rounded-md transition-colors ${h==="changed"?"bg-yellow-500 text-white":"text-slate-400 hover:text-yellow-400"}`,children:[e.jsx(S,{className:"h-3 w-3 inline mr-1"}),"Changed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:xe,className:"px-2 py-1 text-xs text-slate-400 hover:text-white transition-colors",title:"Expand all",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx("button",{onClick:me,className:"px-2 py-1 text-xs text-slate-400 hover:text-white transition-colors",title:"Collapse all",children:e.jsx(q,{className:"h-4 w-4"})})]})]})]}),e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:$.map(s=>{const c=U.has(s.ip);return s.new_ports.length>0||s.closed_ports.length>0||s.new_vulnerabilities.length>0||s.resolved_vulnerabilities.length>0||s.service_changes.length>0||s.os_change!==null?e.jsxs("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:[e.jsxs("button",{onClick:()=>oe(s.ip),className:"w-full flex items-center justify-between p-4 hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx(P,{className:"h-4 w-4 text-slate-400"}):e.jsx(q,{className:"h-4 w-4 text-slate-400"}),e.jsx(H,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-mono text-white",children:s.ip}),s.hostname&&e.jsxs("span",{className:"text-sm text-slate-400",children:["(",s.hostname,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.new_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["+",s.new_ports.length," ports"]}),s.closed_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["-",s.closed_ports.length," ports"]}),s.new_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["+",s.new_vulnerabilities.length," vulns"]}),s.resolved_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["-",s.resolved_vulnerabilities.length," vulns"]}),s.service_changes.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-yellow-500/20 border border-yellow-500/30 rounded text-xs text-yellow-400",children:[s.service_changes.length," svc changes"]})]})]}),c&&e.jsxs("div",{className:"border-t border-dark-border p-4 space-y-4",children:[s.os_change&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-2",children:"Operating System Change"}),e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-sm text-red-400",children:[s.os_change.old_os," (",s.os_change.old_confidence,"% confidence)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-sm text-green-400",children:[s.os_change.new_os," (",s.os_change.new_confidence,"% confidence)"]})]})]})]}),s.new_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-green-400"}),"New Open Ports (",s.new_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.new_ports.map(a=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-green-400",children:[a.port,"/",a.protocol]}),a.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[a.service.name,a.service.version&&` ${a.service.version}`]})]},a.port))})]}),s.closed_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-red-400"}),"Closed Ports (",s.closed_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.closed_ports.map(a=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-red-400",children:[a.port,"/",a.protocol]}),a.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[a.service.name,a.service.version&&` ${a.service.version}`]})]},a.port))})]}),s.service_changes.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-yellow-400"}),"Service Changes (",s.service_changes.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.service_changes.map((a,p)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-white",children:[a.port,"/",a.protocol]}),e.jsxs("div",{className:"flex items-center gap-2",children:[he(a.change_type),e.jsx("span",{className:"text-xs text-yellow-400",children:pe(a.change_type)})]})]}),a.old_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[a.old_service,a.old_version&&` ${a.old_version}`]})]}),a.new_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-green-400",children:[a.new_service,a.new_version&&` ${a.new_version}`]})]})]},p))})]}),s.new_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-red-400"}),"New Vulnerabilities (",s.new_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.new_vulnerabilities.map((a,p)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:a.cve_id||a.title}),e.jsx(Q,{variant:"severity",type:Z(a.severity),children:a.severity})]}),e.jsx("p",{className:"text-xs text-slate-400",children:a.description}),a.affected_service&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Service: ",a.affected_service]})]},p))})]}),s.resolved_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-green-400"}),"Resolved Vulnerabilities (",s.resolved_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.resolved_vulnerabilities.map((a,p)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1 opacity-75",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-green-400 line-through",children:a.cve_id||a.title}),e.jsx(Q,{variant:"severity",type:Z(a.severity),children:a.severity})]}),e.jsx("p",{className:"text-xs text-slate-500",children:a.description})]},p))})]})]})]},s.ip):null})}),$.length===0&&h!=="all"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ne,{className:"h-8 w-8 text-slate-500 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400",children:"No hosts match the current filter"}),e.jsx("button",{onClick:()=>w("all"),className:"mt-2 text-primary hover:underline text-sm",children:"Clear filter"})]})]}),r.diff.new_hosts.length===0&&r.diff.removed_hosts.length===0&&r.diff.host_changes.length===0&&e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-white font-medium mb-2",children:"No Changes Detected"}),e.jsx("p",{className:"text-sm text-slate-400",children:"The selected scans have identical results"})]})})]}),!r&&f.length===0&&e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No completed scans available"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Complete at least two scans to use the comparison feature"})]})}),!r&&f.length>=2&&e.jsx(m,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Select two scans above to compare"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"See what changed between scan runs"})]})})]})};export{Be as S};
