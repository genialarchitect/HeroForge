import{e as K,u as F,f as M,j as e}from"./vendor-state-oFDmcCcB.js";import{r as i,R as ge}from"./vendor-react-5KxtEOLM.js";import{d as V,$ as B,w as Z,F as y,s as Ne,t as ee,aU as ve,B as w,aI as we,ch as ye,O as se,a8 as te,a9 as ae,c9 as ne,a7 as le,X as re,a0 as Se,L as X,az as ke,m as Y,aa as I,V as Ce,cz as ie,aO as Re,ac as Fe,p as Te,i as Ie,g as Le,D as _e}from"./vendor-ui-BlFJDRaq.js";import{B as C,r as S,b as Ee}from"./index-DU1ke8Sf.js";import{L as Pe}from"./Layout-U2SG3QMf.js";import{L as W}from"./LoadingSpinner-Cy32pNXE.js";import{S as $e}from"./ScheduledReports-DOkK_w9m.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BwTKtS0m.js";import"./Card-Diy4jxHS.js";import"./Badge-DPBIV1xM.js";import"./ConfirmationDialog-C1KfPD_c.js";const G=[{id:"Table of Contents",label:"Table of Contents",description:"Navigation index for the report",defaultInTemplates:["technical","compliance"]},{id:"Executive Summary",label:"Executive Summary",description:"High-level overview for stakeholders",defaultInTemplates:["executive","technical","compliance"]},{id:"Risk Overview",label:"Risk Overview",description:"Risk assessment and severity breakdown",defaultInTemplates:["executive","technical"]},{id:"Host Inventory",label:"Host Inventory",description:"List of discovered hosts and systems",defaultInTemplates:["technical"]},{id:"Port Analysis",label:"Port Analysis",description:"Open ports and network services",defaultInTemplates:["technical"]},{id:"Vulnerability Findings",label:"Vulnerability Findings",description:"Detailed vulnerability analysis",defaultInTemplates:["executive","technical","compliance"]},{id:"Service Enumeration",label:"Service Enumeration",description:"Service detection and version information",defaultInTemplates:["technical"]},{id:"Secret Findings",label:"Secret Findings",description:"Exposed credentials and sensitive data",defaultInTemplates:["technical"]},{id:"Screenshots",label:"Screenshots",description:"Visual evidence of findings",defaultInTemplates:["technical","compliance"]},{id:"Remediation Recommendations",label:"Remediation Recommendations",description:"Prioritized fix recommendations",defaultInTemplates:["executive","technical","compliance"]},{id:"Compliance Mapping",label:"Compliance Mapping",description:"Map findings to compliance frameworks",defaultInTemplates:["compliance"]},{id:"Appendix",label:"Appendix",description:"Technical details and raw data",defaultInTemplates:["technical"]}];G.reduce((t,l)=>(t[l.id]=l.label,t),{});function E(t){return G.filter(l=>l.defaultInTemplates.includes(t)).map(l=>l.id)}const ce=[{id:"executive",name:"Executive",description:"High-level summary for leadership",supportsFormats:["pdf","html"]},{id:"technical",name:"Technical",description:"Detailed findings for security teams",supportsFormats:["pdf","html","json","markdown"]},{id:"compliance",name:"Compliance",description:"Audit-ready with framework mappings",supportsFormats:["pdf","html","csv"]}];function qe(t){return ce.find(l=>l.id===t)}const v=[{id:"scan",label:"Select Scan",icon:e.jsx(Z,{className:"w-4 h-4"})},{id:"template",label:"Choose Template",icon:e.jsx(we,{className:"w-4 h-4"})},{id:"customize",label:"Customize",icon:e.jsx(ye,{className:"w-4 h-4"})},{id:"generate",label:"Generate",icon:e.jsx(ee,{className:"w-4 h-4"})}],ze={pdf:e.jsx(ne,{className:"w-4 h-4 text-red-400"}),html:e.jsx(ae,{className:"w-4 h-4 text-orange-400"}),json:e.jsx(te,{className:"w-4 h-4 text-blue-400"}),markdown:e.jsx(se,{className:"w-4 h-4 text-slate-400"}),csv:e.jsx(y,{className:"w-4 h-4 text-green-400"})};function Oe({onReportCreated:t,initialScanId:l}){const f=K(),[r,h]=i.useState("scan"),[d,b]=i.useState(l||""),[a,g]=i.useState("technical"),[x,N]=i.useState("pdf"),[o,m]=i.useState(""),[n,j]=i.useState(""),[p,R]=i.useState(!0),[u,P]=i.useState([]),[$,de]=i.useState(!0),[U,oe]=i.useState(""),[H,me]=i.useState(!0),[Q,xe]=i.useState(!0),{data:k,isLoading:he}=F({queryKey:["scans-for-report"],queryFn:async()=>(await Ee.getAll()).data}),{data:q}=F({queryKey:["report-templates"],queryFn:async()=>(await S.getTemplates()).data});i.useEffect(()=>{p&&P(E(a))},[a,p]),i.useEffect(()=>{if(d&&k){const s=k.find(c=>c.id===d);s&&m(`${s.name} - Report`)}},[d,k]);const z=qe(a),O=q==null?void 0:q.find(s=>s.id===a),L=(O==null?void 0:O.supports_formats)||(z==null?void 0:z.supportsFormats)||["pdf","html","json"];i.useEffect(()=>{L.includes(x)||N(L[0])},[L,x]);const D=M({mutationFn:s=>S.create(s),onSuccess:()=>{w.success("Report generation started"),f.invalidateQueries({queryKey:["reports"]}),t()},onError:s=>{var c,_;w.error(((_=(c=s.response)==null?void 0:c.data)==null?void 0:_.error)||"Failed to create report")}}),J=(k||[]).filter(s=>s.status==="completed"),pe=()=>{switch(r){case"scan":return!!d;case"template":return!!a&&!!x;case"customize":return(p||u.length>0)&&o.trim().length>0;case"generate":return!0;default:return!1}},ue=()=>{const s=v.findIndex(c=>c.id===r);s<v.length-1&&h(v[s+1].id)},je=()=>{const s=v.findIndex(c=>c.id===r);s>0&&h(v[s-1].id)},fe=()=>{const s=p?E(a):u;D.mutate({scan_id:d,name:o.trim(),description:n.trim()||void 0,format:x,template_id:a,sections:s,options:{include_branding:$,company_name:U.trim()||void 0,include_charts:H,include_screenshots:Q}})},be=s=>{P(c=>c.includes(s)?c.filter(_=>_!==s):[...c,s])},A=k==null?void 0:k.find(s=>s.id===d),T=v.findIndex(s=>s.id===r);return e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsx("div",{className:"flex items-center justify-between",children:v.map((s,c)=>e.jsxs(ge.Fragment,{children:[e.jsxs("button",{onClick:()=>{c<T&&h(s.id)},disabled:c>T,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${r===s.id?"bg-cyan-500/20 text-cyan-400":c<T?"text-slate-400 hover:text-white cursor-pointer":"text-slate-600 cursor-not-allowed"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ${c<T?"bg-cyan-500 text-white":r===s.id?"bg-cyan-500/30 text-cyan-400 border border-cyan-500":"bg-slate-700 text-slate-500"}`,children:c<T?e.jsx(V,{className:"w-3 h-3"}):c+1}),e.jsx("span",{className:"hidden sm:inline text-sm",children:s.label})]}),c<v.length-1&&e.jsx(B,{className:"w-4 h-4 text-slate-600"})]},s.id))})}),e.jsxs("div",{className:"p-6",children:[r==="scan"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Select a Completed Scan"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Choose a scan to generate a report from. Only completed scans are shown."})]}),he?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(W,{})}):J.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-400",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No completed scans available"}),e.jsx("p",{className:"text-sm mt-1",children:"Run a scan first to generate reports"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:J.map(s=>e.jsx("button",{onClick:()=>b(s.id),className:`w-full p-4 rounded-lg border text-left transition-all ${d===s.id?"bg-cyan-500/10 border-cyan-500/50":"bg-slate-700/50 border-slate-600 hover:border-slate-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(s.created_at).toLocaleString()})]}),d===s.id&&e.jsx(V,{className:"w-5 h-5 text-cyan-400"})]})},s.id))})]}),r==="template"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Choose Report Template"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Select a template that matches your audience and requirements."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:ce.map(s=>e.jsxs("button",{onClick:()=>g(s.id),className:`p-4 rounded-lg border text-left transition-all ${a===s.id?"bg-cyan-500/10 border-cyan-500/50":"bg-slate-700/50 border-slate-600 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium text-white mb-1",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.description}),e.jsx("div",{className:"flex gap-1 mt-2",children:s.supportsFormats.map(c=>e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-600 rounded text-xs text-slate-300 uppercase",children:c},c))})]},s.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Output Format"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(s=>e.jsxs("button",{onClick:()=>N(s),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-all ${x===s?"bg-cyan-500/20 border-cyan-500/50 text-cyan-400":"bg-slate-700 border-slate-600 text-slate-300 hover:border-slate-500"}`,children:[ze[s]||e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{className:"uppercase",children:s})]},s))})]})]}),r==="customize"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Customize Report"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Configure the report name, sections, and options."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Name *"}),e.jsx("input",{type:"text",value:o,onChange:s=>m(s.target.value),placeholder:"Security Assessment Report",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description (optional)"}),e.jsx("textarea",{value:n,onChange:s=>j(s.target.value),placeholder:"Brief description of the assessment...",rows:2,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsx("div",{className:"p-4 bg-slate-700/50 rounded-lg border border-slate-600",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>{R(s.target.checked),s.target.checked&&P(E(a))},className:"w-4 h-4 rounded bg-slate-600 border-slate-500 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"Use template defaults"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Include all sections recommended for the ",a," template"]})]})]})}),!p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Sections"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:G.map(s=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${u.includes(s.id)?"bg-cyan-500/10 border-cyan-500/50":"bg-slate-700/50 border-slate-600 hover:border-slate-500"}`,children:[e.jsx("input",{type:"checkbox",checked:u.includes(s.id),onChange:()=>be(s.id),className:"w-4 h-4 rounded bg-slate-600 border-slate-500 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white",children:s.label}),s.description&&e.jsx("p",{className:"text-xs text-slate-500",children:s.description})]})]},s.id))})]}),e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"flex items-center gap-2 cursor-pointer text-sm text-slate-400 hover:text-white",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Advanced Options",e.jsx(B,{className:"w-4 h-4 transition-transform group-open:rotate-90"})]}),e.jsxs("div",{className:"mt-4 space-y-4 p-4 bg-slate-700/30 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:s=>de(s.target.checked),className:"w-4 h-4 rounded bg-slate-600 border-slate-500 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Include company branding"})]}),$&&e.jsx("input",{type:"text",value:U,onChange:s=>oe(s.target.value),placeholder:"Company name for branding",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:s=>me(s.target.checked),className:"w-4 h-4 rounded bg-slate-600 border-slate-500 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Include charts and visualizations"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Q,onChange:s=>xe(s.target.checked),className:"w-4 h-4 rounded bg-slate-600 border-slate-500 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Include screenshots"})]})]})]})]}),r==="generate"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Review & Generate"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Review your settings and generate the report."})]}),e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Scan:"}),e.jsx("span",{className:"text-white font-medium",children:A==null?void 0:A.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Report Name:"}),e.jsx("span",{className:"text-white font-medium",children:o})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Template:"}),e.jsx("span",{className:"text-white font-medium capitalize",children:a})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Format:"}),e.jsx("span",{className:"text-white font-medium uppercase",children:x})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Sections:"}),e.jsx("span",{className:"text-white font-medium",children:p?`${E(a).length} (template defaults)`:`${u.length} selected`})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-lg",children:[e.jsx(ee,{className:"w-5 h-5 text-cyan-400"}),e.jsx("p",{className:"text-sm text-cyan-300",children:"Report generation typically takes a few moments. You'll be notified when it's ready."})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-700 flex items-center justify-between",children:[e.jsx("div",{children:r!=="scan"&&e.jsxs(C,{variant:"secondary",onClick:je,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsx("div",{children:r!=="generate"?e.jsxs(C,{onClick:ue,disabled:!pe(),children:["Next",e.jsx(B,{className:"w-4 h-4 ml-2"})]}):e.jsx(C,{onClick:fe,disabled:D.isPending,children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"sm",className:"mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Generate Report"]})})})]})]})}function De({report:t,onClose:l,onDownload:f}){const[r,h]=i.useState("preview"),{data:d,isLoading:b,error:a}=F({queryKey:["reportPreview",t.id],queryFn:async()=>{const m=await fetch(`/api/reports/${t.id}/preview`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!m.ok)throw new Error("Failed to load preview");return m.text()},enabled:r==="preview"}),{data:g,isLoading:x,error:N}=F({queryKey:["reportJson",t.id],queryFn:async()=>(await S.getById(t.id)).data,enabled:r==="json"});i.useEffect(()=>{const m=n=>{n.key==="Escape"&&l()};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[l]),i.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]);const o=m=>{m.target===m.currentTarget&&l()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:o,children:e.jsxs("div",{className:"relative w-full h-full max-w-6xl max-h-[90vh] m-4 bg-slate-800 rounded-lg shadow-2xl flex flex-col overflow-hidden border border-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{className:"w-5 h-5 text-cyan-400"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-400",children:[t.format.toUpperCase()," â€¢ ",t.template_id]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>f(t.id),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(le,{className:"w-4 h-4"}),"Download"]}),e.jsx("button",{onClick:l,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex border-b border-slate-600",children:[e.jsxs("button",{onClick:()=>h("preview"),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium transition-colors ${r==="preview"?"text-cyan-400 border-b-2 border-cyan-400 bg-slate-700/50":"text-slate-400 hover:text-white hover:bg-slate-700/30"}`,children:[e.jsx(Se,{className:"w-4 h-4"}),"Preview"]}),e.jsxs("button",{onClick:()=>h("json"),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium transition-colors ${r==="json"?"text-cyan-400 border-b-2 border-cyan-400 bg-slate-700/50":"text-slate-400 hover:text-white hover:bg-slate-700/30"}`,children:[e.jsx(se,{className:"w-4 h-4"}),"JSON Data"]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[r==="preview"&&e.jsxs("div",{className:"h-full",children:[b&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(X,{className:"w-8 h-8 text-cyan-400 animate-spin"})}),a&&e.jsx("div",{className:"flex items-center justify-center h-full text-red-400",children:e.jsx("p",{children:"Failed to load preview. Please try downloading the report directly."})}),d&&e.jsx("iframe",{srcDoc:d,title:"Report Preview",className:"w-full h-full border-0",sandbox:"allow-same-origin"})]}),r==="json"&&e.jsxs("div",{className:"p-4 h-full",children:[x&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(X,{className:"w-8 h-8 text-cyan-400 animate-spin"})}),N&&e.jsx("div",{className:"flex items-center justify-center h-full text-red-400",children:e.jsx("p",{children:"Failed to load report data."})}),g&&e.jsx("pre",{className:"bg-slate-900 rounded-lg p-4 overflow-auto h-full text-sm text-slate-300 font-mono",children:JSON.stringify(g,null,2)})]})]})]})})}const Ae=t=>{switch(t.toLowerCase()){case"completed":return e.jsx(Le,{className:"w-4 h-4 text-green-400"});case"failed":return e.jsx(Ie,{className:"w-4 h-4 text-red-400"});case"generating":return e.jsx(I,{className:"w-4 h-4 text-cyan-400 animate-spin"});default:return e.jsx(Te,{className:"w-4 h-4 text-yellow-400"})}},Be=t=>{switch(t.toLowerCase()){case"pdf":return e.jsx(ne,{className:"w-4 h-4 text-red-400"});case"html":return e.jsx(ae,{className:"w-4 h-4 text-orange-400"});case"json":return e.jsx(te,{className:"w-4 h-4 text-blue-400"});default:return e.jsx(y,{className:"w-4 h-4 text-slate-400"})}},Ke=t=>t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`:"-";function Me({report:t,onClose:l}){const f=K(),[r,h]=i.useState(t.operator_notes||""),[d,b]=i.useState(!1),{data:a,isLoading:g}=F({queryKey:["report-notes",t.id],queryFn:async()=>(await S.getNotes(t.id)).data});i.useEffect(()=>{a&&h(a.operator_notes||"")},[a]);const x=M({mutationFn:()=>S.updateNotes(t.id,{operator_notes:r}),onSuccess:()=>{w.success("Notes saved"),b(!1),f.invalidateQueries({queryKey:["report-notes",t.id]}),f.invalidateQueries({queryKey:["reports"]})},onError:()=>w.error("Failed to save notes")}),N=()=>{x.mutate()};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:l}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-lg bg-slate-800 border-l border-slate-700 shadow-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Operator Notes"})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-900/50",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Report"}),e.jsx("p",{className:"text-white font-medium",children:t.name}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:g?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(I,{className:"w-6 h-6 text-cyan-400 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Assessment Notes"}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Add notes about the assessment, methodology, or observations. These notes will be included in regenerated reports."}),e.jsx("textarea",{value:r,onChange:o=>{h(o.target.value),b(!0)},placeholder:"Enter operator notes for this report...",className:"w-full h-64 bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 resize-none"})]}),(a==null?void 0:a.finding_notes)&&a.finding_notes.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Finding-Specific Notes (",a.finding_notes.length,")"]}),e.jsx("div",{className:"space-y-2",children:a.finding_notes.map(o=>e.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg border border-slate-700",children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-1",children:["Finding: ",o.finding_id]}),e.jsx("p",{className:"text-sm text-slate-300",children:o.notes}),e.jsx("p",{className:"text-xs text-slate-600 mt-1",children:new Date(o.created_at).toLocaleString()})]},o.id))})]}),(a==null?void 0:a.operator_notes_updated_at)&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Last updated: ",new Date(a.operator_notes_updated_at).toLocaleString()]})]})}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-slate-500",children:d?"Unsaved changes":"No changes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"secondary",onClick:l,children:"Cancel"}),e.jsxs(C,{onClick:N,disabled:!d||x.isPending,children:[x.isPending?e.jsx(I,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Save Notes"]})]})]})})]})})]})}function ts(){const[t,l]=i.useState("reports"),[f,r]=i.useState(null),[h,d]=i.useState(null),b=K(),{data:a,isLoading:g,refetch:x}=F({queryKey:["reports"],queryFn:async()=>(await S.getAll()).data,refetchInterval:n=>{const j=n.state.data;return(j==null?void 0:j.some(R=>R.status==="generating"))?5e3:!1}}),N=M({mutationFn:n=>S.delete(n),onSuccess:()=>{w.success("Report deleted"),b.invalidateQueries({queryKey:["reports"]})},onError:()=>w.error("Failed to delete report")}),o=async n=>{try{const p=(await S.download(n.id)).data,R=window.URL.createObjectURL(p),u=document.createElement("a");u.href=R,u.download=`${n.name}.${n.format}`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(R),document.body.removeChild(u),w.success("Report downloaded")}catch{w.error("Failed to download report")}},m=a||[];return e.jsxs(Pe,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(y,{className:"w-7 h-7 text-cyan-400"}),"Report Generator"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Generate professional PDF, HTML, and JSON reports from scan results"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 border-b border-slate-700",children:[e.jsx("button",{onClick:()=>l("reports"),className:`pb-3 px-1 border-b-2 transition-colors ${t==="reports"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:"Reports"})]})}),e.jsx("button",{onClick:()=>l("scheduled"),className:`pb-3 px-1 border-b-2 transition-colors ${t==="scheduled"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"Scheduled"})]})}),e.jsx("button",{onClick:()=>l("create"),className:`pb-3 px-1 border-b-2 transition-colors ${t==="create"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Create"})]})})]}),t==="reports"&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generated Reports"}),e.jsx(C,{variant:"secondary",size:"sm",onClick:()=>x(),children:e.jsx(I,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:g?e.jsx("div",{className:"p-8 text-center",children:e.jsx(I,{className:"w-8 h-8 text-cyan-400 animate-spin mx-auto"})}):m.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No reports generated yet"}),e.jsxs(C,{variant:"secondary",className:"mt-4",onClick:()=>l("create"),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Create Your First Report"]})]}):m.map(n=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Ae(n.status),Be(n.format),e.jsx("span",{className:"text-white font-medium",children:n.name})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-slate-400",children:[e.jsx("span",{children:new Date(n.created_at).toLocaleString()}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"capitalize",children:n.template_id}),n.file_size&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"|"}),e.jsx("span",{children:Ke(n.file_size)})]})]}),n.error_message&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-sm text-red-400",children:[e.jsx(Ce,{className:"w-3 h-3"}),n.error_message]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(n),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Operator Notes",children:e.jsx(ie,{className:`w-4 h-4 ${n.operator_notes?"text-yellow-400":"text-slate-400"}`})}),n.status==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(n),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Preview",children:e.jsx(Re,{className:"w-4 h-4 text-slate-400 hover:text-cyan-400"})}),e.jsx("button",{onClick:()=>o(n),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Download",children:e.jsx(le,{className:"w-4 h-4 text-cyan-400"})})]}),e.jsx("button",{onClick:()=>{confirm("Delete this report?")&&N.mutate(n.id)},className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",children:e.jsx(Fe,{className:"w-4 h-4 text-slate-400 hover:text-red-400"})})]})]})},n.id))})]}),t==="scheduled"&&e.jsx($e,{}),t==="create"&&e.jsx("div",{className:"max-w-3xl",children:e.jsx(Oe,{onReportCreated:()=>{l("reports"),b.invalidateQueries({queryKey:["reports"]})}})}),f&&e.jsx(Me,{report:f,onClose:()=>r(null)}),h&&e.jsx(De,{report:h,onClose:()=>d(null),onDownload:n=>{const j=a==null?void 0:a.find(p=>p.id===n);j&&o(j),d(null)}})]})}export{ts as default};
