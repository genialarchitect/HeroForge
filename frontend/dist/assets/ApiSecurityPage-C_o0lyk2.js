import{j as e}from"./vendor-state-oFDmcCcB.js";import{r as t}from"./vendor-react-5KxtEOLM.js";import{B as i,S as A,aa as re,ac as ne,$ as ie,a as G,Z as ce,V as le,z as oe,G as H}from"./vendor-ui-BlFJDRaq.js";import{L as de}from"./Layout-U2SG3QMf.js";import{u as xe,E as me}from"./useRequireEngagement-BnB2aMti.js";import{a3 as h,B as f,I as w}from"./index-DU1ke8Sf.js";import{C as o}from"./Card-Diy4jxHS.js";import{B as J}from"./Badge-DPBIV1xM.js";import{C as g}from"./Checkbox-DmG7AQe6.js";import{L as P}from"./LoadingSpinner-Cy32pNXE.js";import"./vendor-markdown-BwTKtS0m.js";import"./vendor-utils-DfRopTPV.js";const _e=()=>{const{hasEngagement:T}=xe(),[E,Z]=t.useState([]),[a,L]=t.useState(null),[I,R]=t.useState([]),[D,B]=t.useState([]),[S,K]=t.useState([]),[Q,F]=t.useState(!1),[r,O]=t.useState(!1),[p,U]=t.useState(!1),[x,y]=t.useState("scans"),[d,_]=t.useState(""),[C,$]=t.useState(""),[b,z]=t.useState(""),[v,k]=t.useState(""),[u,V]=t.useState("none"),[q,W]=t.useState(""),[n,m]=t.useState({test_auth_bypass:!0,test_injection:!0,test_rate_limit:!0,test_cors:!0,test_bola:!0,test_bfla:!1,discover_endpoints:!0});t.useEffect(()=>{N()},[]),t.useEffect(()=>{a&&Y(a.id)},[a]);const N=async()=>{F(!0);try{const s=await h.listScans();Z(s.data)}catch{i.error("Failed to load scans")}finally{F(!1)}},Y=async s=>{try{const[c,l]=await Promise.all([h.getEndpoints(s),h.getFindings(s)]);R(c.data),B(l.data)}catch{i.error("Failed to load scan details")}},X=async s=>{var c,l;if(s.preventDefault(),!d.trim()){i.error("Please enter a target URL");return}if(!C.trim()){i.error("Please enter a scan name");return}try{new URL(d)}catch{i.error("Please enter a valid URL");return}O(!0);try{const j=u!=="none"?{auth_type:u,credentials:u==="bearer"?{token:q}:{}}:void 0;await h.startScan({name:C.trim(),target_url:d.trim(),spec_type:b||void 0,spec_content:v||void 0,auth_config:j,scan_options:n}),i.success("API security scan started"),_(""),$(""),k(""),y("scans"),N()}catch(j){const ae=j;i.error(((l=(c=ae.response)==null?void 0:c.data)==null?void 0:l.error)||"Failed to start scan")}finally{O(!1)}},ee=async()=>{var s,c;if(!d.trim()){i.error("Please enter a target URL");return}U(!0);try{const l=await h.discoverEndpoints({target_url:d.trim(),spec_type:b||void 0,spec_content:v||void 0});K(l.data.endpoints),l.data.endpoints.length===0?i.info("No endpoints discovered"):i.success(`Discovered ${l.data.endpoints.length} endpoints`)}catch(l){const j=l;i.error(((c=(s=j.response)==null?void 0:s.data)==null?void 0:c.error)||"Failed to discover endpoints")}finally{U(!1)}},se=async s=>{if(confirm("Are you sure you want to delete this scan?"))try{await h.deleteScan(s),i.success("Scan deleted"),(a==null?void 0:a.id)===s&&(L(null),R([]),B([])),N()}catch{i.error("Failed to delete scan")}},te=s=>{switch(s.toLowerCase()){case"critical":return"critical";case"high":return"high";case"medium":return"medium";default:return"low"}},M=s=>{switch(s.toUpperCase()){case"GET":return"bg-green-500/20 text-green-400";case"POST":return"bg-blue-500/20 text-blue-400";case"PUT":return"bg-yellow-500/20 text-yellow-400";case"DELETE":return"bg-red-500/20 text-red-400";case"PATCH":return"bg-purple-500/20 text-purple-400";default:return"bg-gray-500/20 text-gray-400"}};return e.jsx(de,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(A,{className:"w-8 h-8 text-cyan-500"}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"API Security Scanner"})]}),e.jsx("p",{className:"text-gray-400",children:"Test APIs for security vulnerabilities including authentication bypass, injection, and CORS issues"})]}),e.jsx(me,{toolName:"API Security Scanner",className:"mb-6"}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-700 pb-2",children:[e.jsx("button",{onClick:()=>y("scans"),className:`px-4 py-2 rounded-t-lg transition-colors ${x==="scans"?"bg-gray-800 text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:"Scan History"}),e.jsx("button",{onClick:()=>y("new"),className:`px-4 py-2 rounded-t-lg transition-colors ${x==="new"?"bg-gray-800 text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:"New Scan"}),e.jsx("button",{onClick:()=>y("discover"),className:`px-4 py-2 rounded-t-lg transition-colors ${x==="discover"?"bg-gray-800 text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:"Discover Endpoints"})]}),x==="scans"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(o,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Scans"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:N,children:e.jsx(re,{className:"w-4 h-4"})})]}),Q?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(P,{})}):E.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No scans yet"}):e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsxs("div",{onClick:()=>L(s),className:`p-3 rounded-lg cursor-pointer transition-colors ${(a==null?void 0:a.id)===s.id?"bg-cyan-500/20 border border-cyan-500/50":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.name}),e.jsx(J,{type:s.status==="completed"?"completed":s.status==="failed"?"failed":"running",children:s.status})]}),e.jsx("p",{className:"text-sm text-gray-400 truncate mt-1",children:s.target_url}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:[s.endpoints_discovered," endpoints"]}),e.jsxs("span",{children:[s.findings_count," findings"]})]})]},s.id))})]})})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-400",children:a.target_url})]}),e.jsx(f,{variant:"danger",size:"sm",onClick:()=>se(a.id),children:e.jsx(ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:a.endpoints_discovered}),e.jsx("p",{className:"text-sm text-gray-400",children:"Endpoints"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:a.endpoints_tested}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tested"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:a.findings_count}),e.jsx("p",{className:"text-sm text-gray-400",children:"Findings"})]})]})]})}),e.jsx(o,{children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Security Findings"}),D.length===0?e.jsx("p",{className:"text-gray-400 text-center py-4",children:"No findings"}):e.jsx("div",{className:"space-y-3",children:D.map(s=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{type:te(s.severity),children:s.severity}),e.jsx("span",{className:"text-sm text-gray-500",children:s.finding_type})]}),e.jsx("h4",{className:"font-medium text-white",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s.description}),s.owasp_category&&e.jsx("p",{className:"text-xs text-cyan-400 mt-2",children:s.owasp_category})]}),e.jsx(ie,{className:"w-5 h-5 text-gray-500"})]}),s.remediation&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-400",children:[e.jsx("span",{className:"text-cyan-400",children:"Remediation:"})," ",s.remediation]})})]},s.id))})]})}),e.jsx(o,{children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Discovered Endpoints"}),I.length===0?e.jsx("p",{className:"text-gray-400 text-center py-4",children:"No endpoints discovered"}):e.jsx("div",{className:"space-y-2",children:I.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-800 rounded",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${M(s.method)}`,children:s.method}),e.jsx("span",{className:"text-white font-mono text-sm flex-1",children:s.path}),s.auth_required===1&&e.jsx(G,{className:"w-4 h-4 text-yellow-500"}),s.tested===1&&e.jsx("span",{className:"text-xs text-green-400",children:"Tested"})]},s.id))})]})})]}):e.jsx(o,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(A,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Select a scan to view details"})]})})})]}),x==="new"&&e.jsx(o,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ce,{className:"w-6 h-6 text-cyan-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Start API Security Scan"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Scan an API for security vulnerabilities"})]})]}),e.jsxs("div",{className:"mb-4 p-4 bg-yellow-900/20 border border-yellow-600/50 rounded-lg flex items-start gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-200",children:[e.jsx("strong",{children:"Security Notice:"})," Only scan APIs you own or have explicit permission to test. Unauthorized scanning may be illegal."]})]}),e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Scan Name *"}),e.jsx(w,{value:C,onChange:s=>$(s.target.value),placeholder:"My API Scan",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Target URL *"}),e.jsx(w,{value:d,onChange:s=>_(s.target.value),placeholder:"https://api.example.com",disabled:r})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"API Specification Type"}),e.jsxs("select",{value:b,onChange:s=>z(s.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",disabled:r,children:[e.jsx("option",{value:"",children:"Auto-detect"}),e.jsx("option",{value:"openapi3",children:"OpenAPI 3.x"}),e.jsx("option",{value:"swagger2",children:"Swagger 2.0"}),e.jsx("option",{value:"postman",children:"Postman Collection"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Authentication Type"}),e.jsxs("select",{value:u,onChange:s=>V(s.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",disabled:r,children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"bearer",children:"Bearer Token"}),e.jsx("option",{value:"basic",children:"Basic Auth"}),e.jsx("option",{value:"api_key",children:"API Key"})]})]})]}),u==="bearer"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Bearer Token"}),e.jsx(w,{type:"password",value:q,onChange:s=>W(s.target.value),placeholder:"Enter your JWT or Bearer token",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"API Specification (JSON/YAML)"}),e.jsx("textarea",{value:v,onChange:s=>k(s.target.value),placeholder:"Paste OpenAPI/Swagger spec here (optional)",className:"w-full h-32 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 font-mono text-sm",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Security Tests"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(g,{id:"test_auth",checked:n.test_auth_bypass,onChange:s=>m({...n,test_auth_bypass:s}),label:"Authentication Bypass",disabled:r}),e.jsx(g,{id:"test_injection",checked:n.test_injection,onChange:s=>m({...n,test_injection:s}),label:"Injection Testing (SQLi, Command)",disabled:r}),e.jsx(g,{id:"test_rate",checked:n.test_rate_limit,onChange:s=>m({...n,test_rate_limit:s}),label:"Rate Limit Testing",disabled:r}),e.jsx(g,{id:"test_cors",checked:n.test_cors,onChange:s=>m({...n,test_cors:s}),label:"CORS Misconfiguration",disabled:r}),e.jsx(g,{id:"test_bola",checked:n.test_bola,onChange:s=>m({...n,test_bola:s}),label:"Broken Object Level Auth (BOLA)",disabled:r}),e.jsx(g,{id:"discover",checked:n.discover_endpoints,onChange:s=>m({...n,discover_endpoints:s}),label:"Discover Endpoints",disabled:r})]})]}),e.jsx("div",{className:"flex gap-3 pt-4",children:e.jsx(f,{type:"submit",disabled:r||!T,children:r?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm"}),"Starting Scan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"Start API Security Scan"]})})})]})]})}),x==="discover"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(o,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(oe,{className:"w-6 h-6 text-cyan-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Discover API Endpoints"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Find API endpoints from a URL or specification"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Target URL *"}),e.jsx(w,{value:d,onChange:s=>_(s.target.value),placeholder:"https://api.example.com",disabled:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Specification Type"}),e.jsxs("select",{value:b,onChange:s=>z(s.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",disabled:p,children:[e.jsx("option",{value:"",children:"Auto-detect"}),e.jsx("option",{value:"openapi3",children:"OpenAPI 3.x"}),e.jsx("option",{value:"swagger2",children:"Swagger 2.0"}),e.jsx("option",{value:"postman",children:"Postman Collection"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"API Specification (optional)"}),e.jsx("textarea",{value:v,onChange:s=>k(s.target.value),placeholder:"Paste OpenAPI/Swagger spec here",className:"w-full h-32 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 font-mono text-sm",disabled:p})]}),e.jsx(f,{onClick:ee,disabled:p||!T,children:p?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm"}),"Discovering..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),"Discover Endpoints"]})})]})]})}),e.jsx(o,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4",children:["Discovered Endpoints (",S.length,")"]}),S.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No endpoints discovered yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enter a URL and click Discover"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:S.map((s,c)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-800 rounded",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${M(s.method)}`,children:s.method}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-white font-mono text-sm block truncate",children:s.path}),s.summary&&e.jsx("span",{className:"text-xs text-gray-500",children:s.summary})]}),s.auth_required&&e.jsx(G,{className:"w-4 h-4 text-yellow-500"}),s.parameters_count>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.parameters_count," params"]})]},c))})]})})]})]})})};export{_e as default};
