import{j as e}from"./vendor-state-DdX3IZQk.js";import{r as f}from"./vendor-react-Da1CiaFS.js";import{aY as A,bv as y,at as D,aD as Q,au as W,d as B,aH as g,aG as w,bh as $,ax as T,ae as v,aq as I,S as ee,bR as se,aJ as ae,bG as F,l as G,U as te,ao as re}from"./vendor-ui-wM19Qo8C.js";import{Z as le,c as h,f as P}from"./index-Rw7kmjn5.js";function U(a){return+le(a)<Date.now()}const ce={assignment:G,work:F,review:ae,verification:g,cab_approval:se,deployment:ee,closure:I},H=a=>{switch(a.toLowerCase()){case"completed":return"text-green-400 bg-green-900/30";case"active":return"text-cyan-400 bg-cyan-900/30";case"pending":return"text-gray-400 bg-gray-700/50";case"rejected":return"text-red-400 bg-red-900/30";case"skipped":return"text-yellow-400 bg-yellow-900/30";case"on_hold":return"text-orange-400 bg-orange-900/30";case"cancelled":return"text-gray-500 bg-gray-800";default:return"text-gray-400 bg-gray-700/50"}},de=a=>{switch(a.toLowerCase()){case"completed":return g;case"active":return v;case"rejected":return w;case"on_hold":return $;case"cancelled":return T;default:return D}},pe=({instance:a,onApprove:d,onReject:p,onAdvance:t,onHold:u,onResume:N,onCancel:j,canApprove:x=!0,isLoading:r=!1})=>{const[i,b]=f.useState(""),[_,L]=f.useState(!0),[O,X]=f.useState(null),[l,q]=f.useState(null),C=a.status==="active",E=a.status==="on_hold",c=a.stage_instances.find(n=>n.stage_id===a.current_stage_id),o=async(n,s)=>{if(s){q(n);try{await s()}finally{q(null)}}},Y=()=>{d&&o("approve",()=>d(i||void 0)),b("")},z=()=>{if(!i.trim()){alert("Please provide a reason for rejection");return}p&&o("reject",()=>p(i)),b("")},J=()=>{t&&o("advance",()=>t(i||void 0)),b("")},M=()=>{const n=[...a.stage_instances].sort((s,S)=>s.stage.stage_order-S.stage.stage_order);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gray-700"}),e.jsx("div",{className:"space-y-4",children:n.map((s,S)=>{const k=O===s.id,R=s.stage_id===a.current_stage_id,V=de(s.status),Z=ce[s.stage.stage_type]||F,K=H(s.status);return e.jsxs("div",{className:"relative pl-14",children:[e.jsx("div",{className:`absolute left-4 w-5 h-5 rounded-full flex items-center justify-center ${R?"bg-cyan-500 ring-4 ring-cyan-500/30":s.status==="completed"?"bg-green-500":"bg-gray-600"}`,children:e.jsx(V,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:`bg-gray-800 rounded-lg border ${R?"border-cyan-500":"border-gray-700"}`,children:[e.jsxs("button",{onClick:()=>X(k?null:s.id),className:"w-full p-4 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:s.stage.name}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${K}`,children:s.status.replace("_"," ")}),s.sla_breached&&e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium text-red-400 bg-red-900/30",children:"SLA Breached"})]}),e.jsx("div",{className:"text-sm text-gray-400",children:s.stage.description||`Stage ${S+1} of ${n.length}`})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[s.sla_deadline&&e.jsxs("div",{className:`text-sm ${U(new Date(s.sla_deadline))?"text-red-400":"text-gray-400"}`,children:[e.jsx(D,{className:"w-4 h-4 inline mr-1"}),h(new Date(s.sla_deadline),{addSuffix:!0})]}),s.stage.required_approvals>0&&e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx(G,{className:"w-4 h-4 inline mr-1"}),s.approvals_received,"/",s.stage.required_approvals]}),k?e.jsx(W,{className:"w-5 h-5 text-gray-400"}):e.jsx(B,{className:"w-5 h-5 text-gray-400"})]})]}),k&&e.jsxs("div",{className:"px-4 pb-4 border-t border-gray-700 mt-2 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Entered:"}),e.jsx("span",{className:"ml-2 text-white",children:P(new Date(s.entered_at),"PPp")})]}),s.completed_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Completed:"}),e.jsx("span",{className:"ml-2 text-white",children:P(new Date(s.completed_at),"PPp")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Stage Type:"}),e.jsx("span",{className:"ml-2 text-white capitalize",children:s.stage.stage_type.replace("_"," ")})]}),s.stage.approver_role&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Approver Role:"}),e.jsx("span",{className:"ml-2 text-white",children:s.stage.approver_role})]})]}),s.approvals.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Approvals"}),e.jsx("div",{className:"space-y-2",children:s.approvals.map(m=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-gray-700/50 rounded",children:[m.approved?e.jsx(g,{className:"w-4 h-4 text-green-400 mt-0.5"}):e.jsx(w,{className:"w-4 h-4 text-red-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-white",children:m.username}),e.jsx("span",{className:"text-xs text-gray-400",children:h(new Date(m.created_at),{addSuffix:!0})})]}),m.comment&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:m.comment})]})]},m.id))})]}),s.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-400",children:s.notes})]})]})]})]},s.id)})})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[a.template.name,e.jsx("span",{className:`px-2 py-0.5 rounded text-sm ${H(a.status)}`,children:a.status.replace("_"," ")})]}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Started ",h(new Date(a.started_at),{addSuffix:!0}),a.completed_at&&e.jsxs(e.Fragment,{children:[" ","- Completed"," ",h(new Date(a.completed_at),{addSuffix:!0})]})]})]}),a.notes&&e.jsxs("div",{className:"bg-gray-800 rounded px-3 py-2 max-w-xs",children:[e.jsx(A,{className:"w-4 h-4 text-gray-400 inline mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:a.notes})]})]}),C&&c&&e.jsxs("div",{className:"bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-cyan-300 font-medium",children:"Current Stage:"}),e.jsx("span",{className:"text-white",children:a.current_stage.name})]}),c.sla_deadline&&e.jsxs("div",{className:`text-sm ${U(new Date(c.sla_deadline))?"text-red-400":"text-gray-400"}`,children:[e.jsx(D,{className:"w-4 h-4 inline mr-1"}),"SLA:"," ",h(new Date(c.sla_deadline),{addSuffix:!0}),c.sla_breached&&e.jsxs("span",{className:"ml-2 text-red-400",children:[e.jsx(Q,{className:"w-4 h-4 inline"})," Breached"]})]})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-4",children:"Workflow Progress"}),M()]}),(C||E)&&x&&e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("button",{onClick:()=>L(!_),className:"flex items-center justify-between w-full text-left",children:[e.jsx("span",{className:"font-medium text-white",children:"Actions"}),_?e.jsx(W,{className:"w-5 h-5 text-gray-400"}):e.jsx(B,{className:"w-5 h-5 text-gray-400"})]}),_&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Comment (optional for approve, required for reject)"}),e.jsx("textarea",{value:i,onChange:n=>b(n.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500",rows:2,placeholder:"Add a comment..."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[C&&e.jsxs(e.Fragment,{children:[c&&c.stage.required_approvals>0&&d&&e.jsxs("button",{onClick:Y,disabled:r||l!==null,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded disabled:opacity-50",children:[e.jsx(g,{className:"w-4 h-4"}),l==="approve"?"Approving...":"Approve"]}),c&&c.stage.required_approvals===0&&t&&e.jsxs("button",{onClick:J,disabled:r||l!==null,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded disabled:opacity-50",children:[e.jsx(y,{className:"w-4 h-4"}),l==="advance"?"Advancing...":"Advance"]}),p&&e.jsxs("button",{onClick:z,disabled:r||l!==null,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded disabled:opacity-50",children:[e.jsx(w,{className:"w-4 h-4"}),l==="reject"?"Rejecting...":"Reject"]}),u&&e.jsxs("button",{onClick:()=>o("hold",()=>u(i||void 0)),disabled:r||l!==null,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-50",children:[e.jsx($,{className:"w-4 h-4"}),l==="hold"?"Holding...":"Put on Hold"]}),j&&e.jsxs("button",{onClick:()=>o("cancel",()=>j(i||void 0)),disabled:r||l!==null,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded disabled:opacity-50",children:[e.jsx(T,{className:"w-4 h-4"}),l==="cancel"?"Cancelling...":"Cancel Workflow"]})]}),E&&N&&e.jsxs("button",{onClick:()=>o("resume",N),disabled:r||l!==null,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded disabled:opacity-50",children:[e.jsx(v,{className:"w-4 h-4"}),l==="resume"?"Resuming...":"Resume Workflow"]})]})]})]})]})},ne=a=>{switch(a.toLowerCase()){case"started":return v;case"advanced":return y;case"approved":return g;case"rejected":return w;case"completed":return g;case"cancelled":return T;case"on_hold":return $;case"resumed":return v;case"sent_back":return re;default:return y}},ie=a=>{switch(a.toLowerCase()){case"approved":case"completed":return"text-green-400 bg-green-900/30";case"rejected":case"cancelled":return"text-red-400 bg-red-900/30";case"on_hold":case"sent_back":return"text-orange-400 bg-orange-900/30";case"started":case"resumed":case"advanced":return"text-cyan-400 bg-cyan-900/30";default:return"text-gray-400 bg-gray-700"}},xe=a=>a.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()),ue=({transitions:a,stageNames:d={}})=>{if(a.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No workflow history yet"})]});const p=[...a].sort((t,u)=>new Date(u.created_at).getTime()-new Date(t.created_at).getTime());return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-2 bottom-2 w-0.5 bg-gray-700"}),e.jsx("div",{className:"space-y-4",children:p.map((t,u)=>{const N=ne(t.action),j=ie(t.action),x=t.from_stage_id?d[t.from_stage_id]:null,r=d[t.to_stage_id];return e.jsxs("div",{className:"relative pl-10",children:[e.jsx("div",{className:`absolute left-2 w-5 h-5 rounded-full flex items-center justify-center ${j}`,children:e.jsx(N,{className:"w-3 h-3"})}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-sm font-medium ${j}`,children:xe(t.action)}),x&&r&&x!==r&&e.jsxs("span",{className:"ml-2 text-sm text-gray-400",children:[x," ",e.jsx(y,{className:"w-4 h-4 inline mx-1"})," ",r]}),!x&&r&&e.jsx("span",{className:"ml-2 text-sm text-gray-400",children:r})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm text-gray-400",title:P(new Date(t.created_at),"PPpp"),children:h(new Date(t.created_at),{addSuffix:!0})})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[e.jsx(te,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.username})]}),t.comment&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-700/50 rounded",children:[e.jsx(A,{className:"w-4 h-4 text-gray-500 inline mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:t.comment})]})]})]},t.id)})})]})};export{pe as W,ue as a,U as i};
