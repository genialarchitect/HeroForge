import{j as e}from"./vendor-state-BjT_zREg.js";import{r as c,i as ae,u as le}from"./vendor-react-5KxtEOLM.js";import{au as O,a9 as Q,v as G,l as F,_,O as D,bL as ie,Z as ee,$ as Z,f as re,bd as ne,S as W,ar as ce,p as de,B as A,af as H,A as xe,b6 as q,a2 as X}from"./vendor-ui-CaTPr3iI.js";import{L as M}from"./Layout-DF6EApG0.js";import{u as me,E as oe}from"./useRequireEngagement-BVGhnOgO.js";import{Y as T,B as v,b as J}from"./index-BgPDfr41.js";import{C as x}from"./Card-CV6m9jT5.js";import{L as z}from"./LoadingSpinner-DiN0bg1Z.js";import{B as b}from"./Badge-Bi3Nk-Vg.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";const he=({pathId:l,pathName:N})=>{const[t,C]=c.useState(null),[P,w]=c.useState(!1),[u,f]=c.useState(!1),[p,a]=c.useState({narrative:!0,mitre:!1,impact:!1,blocking:!1,risk:!1}),m=c.useCallback(async()=>{w(!0);try{const s=await T.getInterpretation(l);C(s.data)}catch{C(null)}finally{w(!1)}},[l]);c.useEffect(()=>{m()},[m]);const o=async(s=!1)=>{var i,d,y,S,E;f(!0);try{const k=await T.interpretPath(l,{force:s});C(k.data),A.success("AI interpretation generated successfully")}catch(k){const R=k;(y=(d=(i=R.response)==null?void 0:i.data)==null?void 0:d.error)!=null&&y.includes("already exists")?A.info("Interpretation already exists. Use regenerate to update."):A.error(((E=(S=R.response)==null?void 0:S.data)==null?void 0:E.error)||"Failed to generate interpretation")}finally{f(!1)}},h=s=>{a(i=>({...i,[s]:!i[s]}))},j=s=>s>=80?"text-red-400":s>=60?"text-orange-400":s>=40?"text-yellow-400":"text-green-400",n=s=>{const i={Critical:"critical",High:"high",Medium:"medium",Low:"low"};return e.jsx(b,{type:i[s]||"medium",children:s})};return P?e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2 text-slate-400",children:"Loading interpretation..."})]})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(O,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI Interpretation"}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Generated: ",new Date(t.generated_at).toLocaleString()]})]})]}),e.jsxs(v,{variant:"secondary",onClick:()=>o(!0),disabled:u,children:[u?e.jsx(z,{}):e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Regenerate"})]})]})}),e.jsxs(x,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-dark-bg/50 transition-colors",onClick:()=>h("narrative"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-red-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Attack Narrative"})]}),p.narrative?e.jsx(F,{className:"h-5 w-5 text-slate-400"}):e.jsx(_,{className:"h-5 w-5 text-slate-400"})]}),p.narrative&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 mb-2",children:"Summary"}),e.jsx("p",{className:"text-white",children:t.narrative.summary})]}),e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Attacker Perspective"]}),e.jsx("p",{className:"text-slate-300",children:t.narrative.attacker_perspective})]}),e.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-orange-400 mb-2 flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Potential Consequences"]}),e.jsx("p",{className:"text-slate-300",children:t.narrative.consequence_description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Attack Steps"}),e.jsx("div",{className:"space-y-3",children:t.narrative.attack_steps.map(s=>e.jsx("div",{className:"bg-dark-bg rounded-lg p-4 border-l-4 border-primary",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary text-sm font-bold flex items-center justify-center",children:s.step}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium mb-1",children:s.action}),e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:s.rationale}),e.jsx("div",{className:"text-xs text-slate-500 bg-dark-card rounded p-2",children:e.jsx("code",{children:s.technical_detail})}),s.vulnerabilities.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.vulnerabilities.map((i,d)=>e.jsx(b,{type:"high",children:i},d))})]})]})},s.step))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Attack Complexity:"}),e.jsx(b,{type:t.narrative.complexity==="Low"?"critical":t.narrative.complexity==="Medium"?"high":t.narrative.complexity==="High"?"medium":"low",children:t.narrative.complexity})]})]})]}),e.jsxs(x,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-dark-bg/50 transition-colors",onClick:()=>h("mitre"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-5 w-5 text-yellow-400"}),e.jsx("span",{className:"font-semibold text-white",children:"MITRE ATT&CK Mapping"}),e.jsxs(b,{type:"medium",children:[t.mitre_mapping.tactics.length," Tactics, ",t.mitre_mapping.techniques.length," Techniques"]})]}),p.mitre?e.jsx(F,{className:"h-5 w-5 text-slate-400"}):e.jsx(_,{className:"h-5 w-5 text-slate-400"})]}),p.mitre&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-dark-border pt-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Kill Chain Stages"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.mitre_mapping.kill_chain_stages.map(s=>e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-primary",children:["Stage ",s.stage]}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.name})]}),e.jsx("p",{className:"text-xs text-slate-400",children:s.description})]},s.stage))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Tactics"}),e.jsx("div",{className:"space-y-2",children:t.mitre_mapping.tactics.map(s=>e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(b,{type:"high",children:s.id}),e.jsx("span",{className:"font-medium text-white",children:s.name})]}),e.jsx("p",{className:"text-sm text-slate-400",children:s.description})]}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-cyan-300",children:e.jsx(Z,{className:"h-4 w-4"})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Techniques"}),e.jsx("div",{className:"space-y-2",children:t.mitre_mapping.techniques.map(s=>e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{type:"critical",children:s.id}),e.jsx("span",{className:"font-medium text-white",children:s.name})]}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-cyan-300",children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-1",children:s.description}),e.jsxs("p",{className:"text-xs text-primary",children:["Relevance: ",s.relevance]})]},s.id))})]})]})]}),e.jsxs(x,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-dark-bg/50 transition-colors",onClick:()=>h("impact"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-5 w-5 text-purple-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Business Impact"}),n(t.business_impact.level)]}),p.impact?e.jsx(F,{className:"h-5 w-5 text-slate-400"}):e.jsx(_,{className:"h-5 w-5 text-slate-400"})]}),p.impact&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-dark-border pt-4",children:[e.jsx("p",{className:"text-slate-300",children:t.business_impact.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Affected Functions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.business_impact.affected_functions.map((s,i)=>e.jsx(b,{type:"medium",children:s},i))})]}),t.business_impact.regulatory_implications.length>0&&e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Regulatory Implications"}),e.jsx("ul",{className:"space-y-1",children:t.business_impact.regulatory_implications.map((s,i)=>e.jsxs("li",{className:"text-sm text-slate-300 flex items-center gap-2",children:[e.jsx(_,{className:"h-3 w-3 text-primary"}),s]},i))})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Data at Risk"}),e.jsx("div",{className:"space-y-2",children:t.business_impact.data_at_risk.map((s,i)=>e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 flex items-start gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white",children:s.data_type}),e.jsx(b,{type:"high",children:s.classification})]}),e.jsx("p",{className:"text-sm text-slate-400",children:s.risk})]})]},i))})]}),t.business_impact.financial_impact&&e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-400 mb-3 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Estimated Financial Impact"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Minimum:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold text-white",children:["$",t.business_impact.financial_impact.min_estimate_usd.toLocaleString()]})]}),e.jsx("span",{className:"text-slate-500",children:"â€”"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Maximum:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold text-white",children:["$",t.business_impact.financial_impact.max_estimate_usd.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Confidence: ",t.business_impact.financial_impact.confidence]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:t.business_impact.financial_impact.cost_factors.map((s,i)=>e.jsx("span",{className:"text-xs bg-dark-bg px-2 py-1 rounded text-slate-300",children:s},i))})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Reputational Risk"}),e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:t.business_impact.reputational_risk.description}),t.business_impact.reputational_risk.potential_headlines.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Potential Headlines:"}),t.business_impact.reputational_risk.potential_headlines.map((s,i)=>e.jsxs("p",{className:"text-sm italic text-red-300",children:['"',s,'"']},i))]})]})]})]}),e.jsxs(x,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-dark-bg/50 transition-colors",onClick:()=>h("blocking"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-green-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Recommended Blocking Points"}),e.jsxs(b,{type:"low",children:[t.blocking_points.length," actions"]})]}),p.blocking?e.jsx(F,{className:"h-5 w-5 text-slate-400"}):e.jsx(_,{className:"h-5 w-5 text-slate-400"})]}),p.blocking&&e.jsx("div",{className:"px-4 pb-4 space-y-3 border-t border-dark-border pt-4",children:t.blocking_points.sort((s,i)=>s.priority-i.priority).map(s=>e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 border-l-4 border-green-500",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-green-500/20 text-green-400 text-sm font-bold flex items-center justify-center",children:s.priority}),e.jsx("span",{className:"font-medium text-white",children:s.action})]}),e.jsxs(b,{type:s.implementation_effort==="Low"?"low":s.implementation_effort==="Medium"?"medium":s.implementation_effort==="High"?"high":"critical",children:[s.implementation_effort," Effort"]})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:s.effectiveness}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.controls.map((i,d)=>e.jsx("span",{className:"text-xs bg-green-500/20 text-green-300 px-2 py-1 rounded",children:i},d))})]},s.step))})]}),e.jsxs(x,{className:"overflow-hidden",children:[e.jsxs("button",{className:"w-full p-4 flex items-center justify-between text-left hover:bg-dark-bg/50 transition-colors",onClick:()=>h("risk"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-5 w-5 text-blue-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Risk Assessment"}),e.jsxs("span",{className:`text-xl font-bold ${j(t.risk_assessment.risk_score)}`,children:[t.risk_assessment.risk_score.toFixed(0),"/100"]})]}),p.risk?e.jsx(F,{className:"h-5 w-5 text-slate-400"}):e.jsx(_,{className:"h-5 w-5 text-slate-400"})]}),p.risk&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Risk Score"}),e.jsx("p",{className:`text-2xl font-bold ${j(t.risk_assessment.risk_score)}`,children:t.risk_assessment.risk_score.toFixed(0)})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Exploitation Probability"}),e.jsxs("p",{className:`text-2xl font-bold ${j(t.risk_assessment.exploitation_probability)}`,children:[t.risk_assessment.exploitation_probability.toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Impact Score"}),e.jsx("p",{className:`text-2xl font-bold ${j(t.risk_assessment.impact_score)}`,children:t.risk_assessment.impact_score.toFixed(0)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-dark-bg rounded-lg p-4",children:[e.jsx(de,{className:"h-5 w-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Estimated Time to Exploit"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:t.risk_assessment.estimated_time_to_exploit})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Risk Factors"}),e.jsx("div",{className:"space-y-3",children:t.risk_assessment.risk_factors.map(s=>e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-white",children:s.name}),e.jsx("span",{className:`font-bold ${j(s.score)}`,children:s.score.toFixed(0)})]}),e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:s.description}),e.jsx("div",{className:"w-full bg-dark-card rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.score>=80?"bg-red-500":s.score>=60?"bg-orange-500":s.score>=40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${s.score}%`}})})]},s.name))})]}),e.jsxs("div",{className:`rounded-lg p-4 ${t.risk_assessment.risk_score>=80?"bg-red-500/10 border border-red-500/30":t.risk_assessment.risk_score>=60?"bg-orange-500/10 border border-orange-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[e.jsx("h4",{className:`text-sm font-semibold mb-2 ${t.risk_assessment.risk_score>=80?"text-red-400":t.risk_assessment.risk_score>=60?"text-orange-400":"text-yellow-400"}`,children:"Recommendation"}),e.jsx("p",{className:"text-slate-300",children:t.risk_assessment.recommendation})]})]})]})]}):e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"AI Interpretation Not Available"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:"Generate an AI interpretation to get a detailed narrative explanation of this attack path, including business impact analysis and recommended blocking points."}),e.jsx(v,{onClick:()=>o(!1),disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Generate AI Interpretation"]})})]})})},pe=({nodes:l,edges:N,onNodeClick:t})=>{const u=c.useMemo(()=>{if(l.length===0)return[];const a=l.filter(n=>n.node_type==="entry"),m=l.filter(n=>n.node_type==="pivot"),o=l.filter(n=>n.node_type==="target"),h=60,j=(800-h*2)/3;return l.map(n=>{let s=h,i=0,d=1,y=0;return n.node_type==="entry"?(s=h,d=a.length,y=a.indexOf(n)):n.node_type==="pivot"?(s=h+j,d=m.length,y=m.indexOf(n)):(s=h+j*2,d=o.length,y=o.indexOf(n)),i=d>1?(y-(d-1)/2)*80:0,{...n,x:n.position_x!==0?n.position_x+h:s,y:n.position_y!==0?n.position_y+200:200+i}})},[l]),f=a=>{switch(a){case"entry":return"#22c55e";case"target":return"#ef4444";case"pivot":default:return"#f59e0b"}},p=a=>u.find(m=>m.id===a);return e.jsxs("svg",{viewBox:"0 0 800 400",className:"w-full h-full",style:{minHeight:"300px"},children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#64748b"})})}),N.map(a=>{const m=p(a.source_node_id),o=p(a.target_node_id);return!m||!o?null:e.jsxs("g",{children:[e.jsx("line",{x1:m.x+30,y1:m.y,x2:o.x-30,y2:o.y,stroke:"#64748b",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),a.attack_technique&&e.jsx("text",{x:(m.x+o.x)/2,y:(m.y+o.y)/2-10,fill:"#94a3b8",fontSize:"10",textAnchor:"middle",children:a.technique_id||a.attack_technique.slice(0,20)})]},a.id)}),u.map(a=>{var m;return e.jsxs("g",{className:"cursor-pointer",onClick:()=>t==null?void 0:t(a),children:[e.jsx("circle",{cx:a.x,cy:a.y,r:30,fill:f(a.node_type),fillOpacity:"0.2",stroke:f(a.node_type),strokeWidth:"2"}),e.jsx("text",{x:a.x,y:a.y-5,fill:"white",fontSize:"11",textAnchor:"middle",fontWeight:"bold",children:a.service||((m=a.host_ip)==null?void 0:m.split(".").slice(-1)[0])||"?"}),e.jsx("text",{x:a.x,y:a.y+10,fill:"#94a3b8",fontSize:"9",textAnchor:"middle",children:a.port?`:${a.port}`:a.node_type}),a.vulnerability_ids.length>0&&e.jsx("circle",{cx:a.x+30-5,cy:a.y-30+5,r:"10",fill:"#ef4444"}),a.vulnerability_ids.length>0&&e.jsx("text",{x:a.x+30-5,y:a.y-30+9,fill:"white",fontSize:"9",textAnchor:"middle",children:a.vulnerability_ids.length})]},a.id)}),e.jsxs("g",{transform:"translate(680, 20)",children:[e.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"#22c55e",fillOpacity:"0.3",stroke:"#22c55e"}),e.jsx("text",{x:"25",y:"14",fill:"#94a3b8",fontSize:"10",children:"Entry"}),e.jsx("circle",{cx:"10",cy:"30",r:"8",fill:"#f59e0b",fillOpacity:"0.3",stroke:"#f59e0b"}),e.jsx("text",{x:"25",y:"34",fill:"#94a3b8",fontSize:"10",children:"Pivot"}),e.jsx("circle",{cx:"10",cy:"50",r:"8",fill:"#ef4444",fillOpacity:"0.3",stroke:"#ef4444"}),e.jsx("text",{x:"25",y:"54",fill:"#94a3b8",fontSize:"10",children:"Target"})]})]})},se=({level:l})=>{const N={critical:"critical",high:"high",medium:"medium",low:"low"};return e.jsx(b,{type:N[l],children:l.toUpperCase()})},je=({path:l,isSelected:N,onClick:t})=>e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-all ${N?"border-primary bg-primary/10":"border-dark-border bg-dark-card hover:border-slate-600"}`,onClick:t,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-white font-medium",children:l.name||`Path ${l.id.slice(0,8)}`})]}),e.jsx(se,{level:l.risk_level})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Length:"})," ",e.jsxs("span",{className:"text-white",children:[l.path_length," nodes"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"CVSS:"})," ",e.jsx("span",{className:"text-white",children:l.total_cvss.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Probability:"})," ",e.jsxs("span",{className:"text-white",children:[(l.probability*100).toFixed(0),"%"]})]})]})]}),Ae=()=>{var Y;const{scanId:l}=ae(),N=le(),{hasEngagement:t}=me(),[C,P]=c.useState(!0),[w,u]=c.useState(!1),[f,p]=c.useState(null),[a,m]=c.useState([]),[o,h]=c.useState([]),[j,n]=c.useState(null),[s,i]=c.useState(null),[d,y]=c.useState(null),[S,E]=c.useState(!1),[k,R]=c.useState(!1),[$,te]=c.useState(!1),V=c.useCallback(async()=>{if(P(!0),!l){try{const g=((await J.getAll()).data||[]).filter(B=>B.status==="completed");m(g)}catch(r){A.error("Failed to load scans"),console.error(r)}finally{P(!1)}return}try{const r=await J.getById(l);p(r.data);try{const g=await T.getByScan(l);h(g.data.paths),n(g.data.stats),R(g.data.paths.length>0),g.data.paths.length>0&&i(g.data.paths[0])}catch{h([]),n(null),R(!1)}}catch(r){A.error("Failed to load scan data"),console.error(r)}finally{P(!1)}},[l]);c.useEffect(()=>{V()},[V]);const U=async(r=!1)=>{var g,B;if(l){u(!0);try{const L=await T.analyze(l,{force:r});A.success(L.data.message);const I=await T.getByScan(l);h(I.data.paths),n(I.data.stats),R(!0),I.data.paths.length>0&&i(I.data.paths[0])}catch(L){const I=L;A.error(((B=(g=I.response)==null?void 0:g.data)==null?void 0:B.error)||"Analysis failed"),console.error(L)}finally{u(!1)}}},K=c.useMemo(()=>S?o.filter(r=>r.risk_level==="critical"||r.risk_level==="high"):o,[o,S]);return C?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})})}):l?f?e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(v,{variant:"secondary",onClick:()=>N(`/dashboard/${l}`),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Back to Scan"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6 text-primary"}),"Attack Path Analysis"]}),e.jsxs("p",{className:"text-slate-400",children:["Scan: ",f.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[k&&e.jsx(v,{variant:"secondary",onClick:()=>E(!S),children:S?"Show All":"Critical Only"}),e.jsx(v,{onClick:()=>U(k),disabled:w||f.status!=="completed"||!t,children:w?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),k?"Re-analyze":"Analyze"]})})]})]}),j&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(q,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:j.total_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:j.critical_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"Critical Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500/20 rounded-lg",children:e.jsx(ee,{className:"h-5 w-5 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:j.high_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"High Risk Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(G,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:j.total_nodes}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Nodes"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(W,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:((Y=j.avg_path_length)==null?void 0:Y.toFixed(1))||"N/A"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Avg Path Length"})]})]})})]}),k?o.length===0?e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(W,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Attack Paths Found"}),e.jsx("p",{className:"text-slate-400 max-w-md mx-auto",children:"The analysis did not identify any significant attack paths. This could mean the network is well-segmented or there are no vulnerable services that could be chained together."})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-3",children:["Attack Paths (",K.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto pr-2",children:K.map(r=>e.jsx(je,{path:r,isSelected:(s==null?void 0:s.id)===r.id,onClick:()=>{i(r),y(null)}},r.id))})]}),e.jsx("div",{className:"lg:col-span-2",children:s?e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.name||`Path ${s.id.slice(0,8)}`}),e.jsx(se,{level:s.risk_level})]}),e.jsx("div",{className:"bg-dark-bg rounded-lg border border-dark-border p-4 mb-4",children:e.jsx(pe,{nodes:s.nodes,edges:s.edges,onNodeClick:y})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Path Length"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[s.path_length," nodes"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Total CVSS"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:s.total_cvss.toFixed(1)})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Probability"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[(s.probability*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Nodes"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:s.nodes.length})]})]}),d&&e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 mb-4 border border-dark-border",children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Node Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"IP:"})," ",e.jsx("span",{className:"text-white",children:d.host_ip||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Port:"})," ",e.jsx("span",{className:"text-white",children:d.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Service:"})," ",e.jsx("span",{className:"text-white",children:d.service||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Type:"})," ",e.jsx("span",{className:"text-white capitalize",children:d.node_type})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"Vulnerabilities:"})," ",e.jsx("span",{className:"text-white",children:d.vulnerability_ids.length>0?d.vulnerability_ids.join(", "):"None"})]})]})]}),s.mitigation_steps.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-green-400"}),"Recommended Mitigations"]}),e.jsx("ul",{className:"space-y-2",children:s.mitigation_steps.map((r,g)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-300",children:[e.jsx(_,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),r]},g))})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-border",children:e.jsxs(v,{variant:$?"primary":"secondary",onClick:()=>te(!$),className:"w-full justify-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),$?"Hide AI Interpretation":"View AI Interpretation"]})})]}),$&&e.jsx("div",{className:"mt-4",children:e.jsx(he,{pathId:s.id,pathName:s.name})})]}):e.jsx(x,{className:"p-8 text-center",children:e.jsx("p",{className:"text-slate-400",children:"Select an attack path from the list to view details"})})})]}):e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(H,{className:"h-16 w-16 text-slate-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Attack Paths Analyzed"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:'Click the "Analyze" button to identify potential attack paths in your scan results. The analysis will build a graph of hosts and vulnerabilities to find possible attack chains.'}),f.status!=="completed"&&e.jsx("p",{className:"text-yellow-500 text-sm mb-4",children:"Note: The scan must be completed before analysis."}),e.jsx(v,{onClick:()=>U(!1),disabled:w||f.status!=="completed"||!t,className:"mx-auto",children:w?e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("span",{className:"ml-2",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Analyze Attack Paths"]})})]}),e.jsx(x,{className:"bg-blue-500/10 border-blue-500/30",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(X,{className:"h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-2",children:"About Attack Path Analysis"}),e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:"Attack path analysis identifies potential chains of vulnerabilities and misconfigurations that an attacker could exploit to move through your network. The analysis:"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-1 list-disc list-inside ml-4",children:[e.jsx("li",{children:"Builds a graph from discovered hosts, services, and vulnerabilities"}),e.jsx("li",{children:"Identifies entry points, pivot points, and target systems"}),e.jsx("li",{children:"Calculates risk scores based on CVSS, exploitability, and impact"}),e.jsx("li",{children:"Maps techniques to MITRE ATT&CK framework where applicable"}),e.jsx("li",{children:"Provides prioritized mitigation recommendations"})]})]})]})})]})}):e.jsx(M,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Scan Not Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"The requested scan could not be found."}),e.jsx(v,{onClick:()=>N("/dashboard"),children:"Go to Dashboard"})]})}):e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6 text-primary"}),"Attack Path Analysis"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Select a completed scan to analyze attack paths"})]}),e.jsx(oe,{toolName:"Attack Path Analysis",className:"mb-6"}),a.length===0?e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(H,{className:"h-16 w-16 text-slate-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Completed Scans Available"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:"You need to complete a network scan first before you can analyze attack paths. Run a scan with vulnerability detection enabled to get started."}),e.jsxs(v,{onClick:()=>N("/scan"),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Start New Scan"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(r=>e.jsxs(x,{className:"cursor-pointer hover:border-primary transition-all",onClick:()=>N(`/attack-paths/${r.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium text-white",children:r.name})]}),e.jsx(b,{type:r.status==="completed"?"low":"medium",children:r.status})]}),e.jsxs("div",{className:"text-sm text-slate-400 space-y-1",children:[e.jsxs("p",{children:["Targets: ",r.targets||"N/A"]}),e.jsxs("p",{children:["Created: ",new Date(r.created_at).toLocaleDateString()]}),r.total_hosts!==void 0&&e.jsxs("p",{children:["Hosts: ",r.total_hosts]})]}),e.jsxs("div",{className:"mt-3 flex items-center text-primary text-sm",children:[e.jsx("span",{children:"Analyze Attack Paths"}),e.jsx(_,{className:"h-4 w-4 ml-1"})]})]},r.id))})]})})};export{Ae as default};
