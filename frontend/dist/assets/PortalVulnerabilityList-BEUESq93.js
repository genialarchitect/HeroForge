import{j as e}from"./vendor-state-DdX3IZQk.js";import{d as S,r,L as P}from"./vendor-react-Da1CiaFS.js";import{P as _}from"./PortalLayout-DoVIPqs6.js";import{aj as C,ak as E}from"./index-llUvVj-b.js";import"./vendor-ui-auz1M_7a.js";import"./vendor-charts-WZ5jmfTB.js";const A={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-green-600 text-white",info:"bg-blue-600 text-white"},L={open:"bg-red-900/50 text-red-200",in_progress:"bg-blue-900/50 text-blue-200",pending_verification:"bg-yellow-900/50 text-yellow-200",resolved:"bg-green-900/50 text-green-200",accepted_risk:"bg-purple-900/50 text-purple-200"};function H(){const[l,c]=S(),[s,y]=r.useState(null),[j,b]=r.useState([]),[f,h]=r.useState(!0),[u,N]=r.useState(""),d=l.get("severity")||"",o=l.get("status")||"",x=l.get("engagement_id")||"",a=parseInt(l.get("page")||"1",10),g=20;r.useEffect(()=>{v()},[]),r.useEffect(()=>{w()},[d,o,x,a]);const v=async()=>{try{const t=await C.getAll();b(t.data)}catch(t){console.error("Failed to load engagements:",t)}},w=async()=>{h(!0);try{const t=await E.getAll({severity:d||void 0,status:o||void 0,engagement_id:x||void 0,limit:g,offset:(a-1)*g});y(t.data)}catch(t){N("Failed to load vulnerabilities"),console.error(t)}finally{h(!1)}},p=(t,i)=>{const n=new URLSearchParams(l);i?n.set(t,i):n.delete(t),n.delete("page"),c(n)},m=s?Math.ceil(s.stats.total/g):0;return e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Vulnerabilities"}),s&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:s.stats.total}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total"})]}),e.jsxs("div",{className:"bg-red-900/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-400",children:s.stats.critical}),e.jsx("p",{className:"text-sm text-gray-400",children:"Critical"})]}),e.jsxs("div",{className:"bg-orange-900/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-400",children:s.stats.high}),e.jsx("p",{className:"text-sm text-gray-400",children:"High"})]}),e.jsxs("div",{className:"bg-blue-900/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:s.stats.open}),e.jsx("p",{className:"text-sm text-gray-400",children:"Open"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("select",{value:d,onChange:t=>p("severity",t.target.value),className:"bg-gray-700 text-white px-4 py-2 rounded-lg border-0 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Severities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:o,onChange:t=>p("status",t.target.value),className:"bg-gray-700 text-white px-4 py-2 rounded-lg border-0 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"accepted_risk",children:"Accepted Risk"})]}),e.jsxs("select",{value:x,onChange:t=>p("engagement_id",t.target.value),className:"bg-gray-700 text-white px-4 py-2 rounded-lg border-0 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Engagements"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),u&&e.jsx("div",{className:"bg-red-900/50 text-red-200 p-4 rounded-lg",children:u}),f?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):(s==null?void 0:s.vulnerabilities.length)===0?e.jsx("div",{className:"bg-gray-800 rounded-lg p-8 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No vulnerabilities found"})}):e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase",children:"Title"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase",children:"Severity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase",children:"Host"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase",children:"CVSS"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:s==null?void 0:s.vulnerabilities.map(t=>{var i;return e.jsxs("tr",{className:"hover:bg-gray-750",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx(P,{to:`/portal/vulnerabilities/${t.id}`,className:"text-blue-400 hover:text-blue-300",children:t.title}),t.cve_ids&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.cve_ids})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${A[t.severity]||"bg-gray-600 text-gray-200"}`,children:t.severity})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${L[t.status]||"bg-gray-700 text-gray-300"}`,children:t.status.replace("_"," ")})}),e.jsxs("td",{className:"px-4 py-4 text-gray-300 text-sm",children:[t.host,t.port?`:${t.port}`:""]}),e.jsx("td",{className:"px-4 py-4 text-gray-300 text-sm",children:((i=t.cvss_score)==null?void 0:i.toFixed(1))||"-"})]},t.id)})})]})}),m>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>c(t=>(t.set("page",String(a-1)),t)),disabled:a<=1,className:"px-4 py-2 bg-gray-700 text-white rounded-lg disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"px-4 py-2 text-gray-400",children:["Page ",a," of ",m]}),e.jsx("button",{onClick:()=>c(t=>(t.set("page",String(a+1)),t)),disabled:a>=m,className:"px-4 py-2 bg-gray-700 text-white rounded-lg disabled:opacity-50",children:"Next"})]})]})})}export{H as default};
