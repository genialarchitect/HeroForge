import{j as e}from"./vendor-state-DdX3IZQk.js";import{u as T,r as n,L as C}from"./vendor-react-Da1CiaFS.js";import{T as j,d as _}from"./index-DQCmZyk2.js";import"./vendor-ui-ClyGCaTH.js";import"./vendor-charts-IB765B33.js";function U(){const p=T(),[c,y]=n.useState([]),[a,i]=n.useState([]),[h,m]=n.useState(!0),[u,o]=n.useState(null),[x,s]=n.useState(""),[l,d]=n.useState(""),[g,k]=n.useState(""),[S,b]=n.useState(!1);n.useEffect(()=>{E()},[x]);const E=async()=>{try{m(!0);const[t,r]=await Promise.all([j.engagements.getAll(x||void 0),j.customers.getAll()]);y(t.data),i(r.data)}catch(t){const r=t instanceof Error?t.message:"Failed to load engagements";o(r)}finally{m(!1)}},v=t=>{const r=a.find(f=>f.id===t);return(r==null?void 0:r.name)||"Unknown"},D=t=>{switch(t){case"in_progress":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"planning":return"bg-yellow-100 text-yellow-800";case"on_hold":return"bg-orange-100 text-orange-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},A=t=>{switch(t){case"pentest":return"Penetration Test";case"vuln_assessment":return"Vulnerability Assessment";case"red_team":return"Red Team";case"compliance_audit":return"Compliance Audit";case"consulting":return"Consulting";default:return t}},w=t=>t?new Date(t).toLocaleDateString():"-",P=t=>t===null?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(t),N=c.filter(t=>{const r=t.name.toLowerCase().includes(g.toLowerCase())||v(t.customer_id).toLowerCase().includes(g.toLowerCase()),f=!l||t.engagement_type===l;return r&&f});return h?e.jsx(_,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})})}):e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Engagements"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Manage all security engagements across customers"})]}),e.jsx("button",{onClick:()=>b(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:"+ New Engagement"})]}),u&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:u})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search engagements...",value:g,onChange:t=>k(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white"})}),e.jsxs("select",{value:x,onChange:t=>s(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:l,onChange:t=>d(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"pentest",children:"Penetration Test"}),e.jsx("option",{value:"vuln_assessment",children:"Vulnerability Assessment"}),e.jsx("option",{value:"red_team",children:"Red Team"}),e.jsx("option",{value:"compliance_audit",children:"Compliance Audit"}),e.jsx("option",{value:"consulting",children:"Consulting"})]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Engagement"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Budget"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:c.length===0?"No engagements yet. Create your first engagement!":"No engagements match your filters."})}):N.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>p(`/crm/customers/${t.customer_id}`),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),t.scope&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:t.scope})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(C,{to:`/crm/customers/${t.customer_id}`,className:"text-indigo-600 hover:text-indigo-900",onClick:r=>r.stopPropagation(),children:v(t.customer_id)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(t.engagement_type)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${D(t.status)}`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(t.start_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(t.end_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:P(t.budget)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(C,{to:`/crm/customers/${t.customer_id}`,className:"text-indigo-600 hover:text-indigo-900",onClick:r=>r.stopPropagation(),children:"View"})})]},t.id))})]})}),S&&e.jsx(F,{customers:a,onClose:()=>b(!1),onCreated:t=>{b(!1),p(`/crm/customers/${t.customer_id}`)}})]})})}function F({customers:p,onClose:c,onCreated:y}){const[a,i]=n.useState({customer_id:"",name:"",engagement_type:"pentest",status:"planning",scope:"",start_date:"",end_date:"",budget:void 0,notes:""}),[h,m]=n.useState(!1),[u,o]=n.useState(null),x=async s=>{if(s.preventDefault(),!a.name.trim()){o("Engagement name is required");return}if(!a.customer_id){o("Please select a customer");return}try{m(!0),o(null);const{customer_id:l,...d}=a,g=await j.engagements.create(l,{...d,start_date:d.start_date||void 0,end_date:d.end_date||void 0});y(g.data)}catch(l){const d=l instanceof Error?l.message:"Failed to create engagement";o(d)}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:c}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"New Engagement"}),u&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded p-3 text-red-800 text-sm",children:u}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Customer *"}),e.jsxs("select",{value:a.customer_id,onChange:s=>i({...a,customer_id:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",required:!0,children:[e.jsx("option",{value:"",children:"Select a customer"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>i({...a,name:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Type"}),e.jsxs("select",{value:a.engagement_type,onChange:s=>i({...a,engagement_type:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"pentest",children:"Penetration Test"}),e.jsx("option",{value:"vuln_assessment",children:"Vulnerability Assessment"}),e.jsx("option",{value:"red_team",children:"Red Team"}),e.jsx("option",{value:"compliance_audit",children:"Compliance Audit"}),e.jsx("option",{value:"consulting",children:"Consulting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:a.status||"planning",onChange:s=>i({...a,status:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",children:[e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),e.jsx("input",{type:"date",value:a.start_date||"",onChange:s=>i({...a,start_date:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Date"}),e.jsx("input",{type:"date",value:a.end_date||"",onChange:s=>i({...a,end_date:s.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Budget"}),e.jsx("input",{type:"number",value:a.budget||"",onChange:s=>i({...a,budget:s.target.value?parseFloat(s.target.value):void 0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"0.00",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Scope"}),e.jsx("textarea",{value:a.scope||"",onChange:s=>i({...a,scope:s.target.value}),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-900 bg-white",placeholder:"Define the engagement scope..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 disabled:opacity-50",children:h?"Creating...":"Create Engagement"})]})]})]})]})})}export{U as default};
