import{c as k,j as e}from"./vendor-state-BjT_zREg.js";import{r as f}from"./vendor-react-5KxtEOLM.js";import{a0 as B,c as A}from"./index-BwCSAD78.js";import{f as S,j,a9 as I,h as q,l as _,O as z,b as F}from"./vendor-ui-CaTPr3iI.js";const v=k()(B((a,l)=>({activeCustomer:null,activeEngagement:null,customers:[],engagements:[],isLoading:!1,setActiveCustomer:s=>{a({activeCustomer:s,activeEngagement:null,engagements:[]})},setActiveEngagement:s=>{a({activeEngagement:s})},setCustomers:s=>{a({customers:s});const i=l().activeCustomer;i&&!s.find(n=>n.id===i.id)&&a({activeCustomer:null,activeEngagement:null})},setEngagements:s=>{a({engagements:s});const i=l().activeEngagement;i&&!s.find(n=>n.id===i.id)&&a({activeEngagement:null})},setLoading:s=>a({isLoading:s}),clearEngagementContext:()=>{a({activeCustomer:null,activeEngagement:null,engagements:[]})},hasActiveEngagement:()=>{const s=l();return s.activeCustomer!==null&&s.activeEngagement!==null},getActiveContext:()=>{const s=l();return s.activeCustomer&&s.activeEngagement?{customerId:s.activeCustomer.id,engagementId:s.activeEngagement.id}:null}}),{name:"engagement-storage",partialize:a=>{var l,s;return{activeCustomerId:(l=a.activeCustomer)==null?void 0:l.id,activeEngagementId:(s=a.activeEngagement)==null?void 0:s.id}}})),T=({compact:a=!1,className:l="",onChange:s,engagementStatusFilter:i=["in_progress","planning"]})=>{const{activeCustomer:n,activeEngagement:r,customers:d,engagements:x,isLoading:o,setActiveCustomer:y,setActiveEngagement:N,setCustomers:R,setEngagements:$,setLoading:u}=v(),[b,h]=f.useState(null);f.useEffect(()=>{w()},[]),f.useEffect(()=>{n&&L(n.id)},[n==null?void 0:n.id]),f.useEffect(()=>{s==null||s(n,r)},[n,r,s]);const w=async()=>{try{u(!0),h(null);const t=await A.customers.getAll("active");R(t.data)}catch(t){console.error("Failed to load customers:",t),h("Failed to load customers")}finally{u(!1)}},L=async t=>{try{u(!0),h(null);const c=await A.engagements.getByCustomer(t),m=i.length>0?c.data.filter(g=>i.includes(g.status)):c.data;$(m)}catch(c){console.error("Failed to load engagements:",c),h("Failed to load engagements")}finally{u(!1)}},E=t=>{const c=t.target.value;if(c){const m=d.find(g=>g.id===c);y(m||null)}else y(null)},C=t=>{const c=t.target.value;if(c){const m=x.find(g=>g.id===c);N(m||null)}else N(null)},p=a?"px-2 py-1 text-sm bg-gray-800 border border-gray-700 rounded text-white focus:ring-2 focus:ring-cyan-500 focus:border-transparent":"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-transparent";return a?e.jsxs("div",{className:`flex items-center gap-2 ${l}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:(n==null?void 0:n.id)||"",onChange:E,disabled:o,className:p,children:[e.jsx("option",{value:"",children:"Select Customer"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:(r==null?void 0:r.id)||"",onChange:C,disabled:o||!n,className:p,children:[e.jsx("option",{value:"",children:"Select Engagement"}),x.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),o&&e.jsx(I,{className:"w-4 h-4 text-cyan-400 animate-spin"})]}):e.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-lg p-4 ${l}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(j,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-sm font-medium text-white",children:"Active Engagement"}),o&&e.jsx(I,{className:"w-4 h-4 text-cyan-400 animate-spin ml-auto"})]}),b&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm mb-3",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:b}),e.jsx("button",{onClick:w,className:"text-cyan-400 hover:text-cyan-300 underline ml-2",children:"Retry"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:(n==null?void 0:n.id)||"",onChange:E,disabled:o,className:`${p} pl-9 pr-8 appearance-none cursor-pointer`,children:[e.jsx("option",{value:"",children:"Select a customer..."}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(_,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Engagement"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:(r==null?void 0:r.id)||"",onChange:C,disabled:o||!n,className:`${p} pl-9 pr-8 appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("option",{value:"",children:n?x.length===0?"No active engagements":"Select an engagement...":"Select a customer first..."}),x.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.engagement_type,")"]},t.id))]}),e.jsx(_,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]})]}),r&&e.jsxs("div",{className:"mt-3 p-2 bg-gray-900/50 rounded border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Scope:"}),e.jsx("span",{className:"text-white truncate max-w-[200px]",title:r.scope||"Not defined",children:r.scope||"Not defined"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-gray-400",children:"Type:"}),e.jsx("span",{className:"text-cyan-400 capitalize",children:r.engagement_type.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:`capitalize ${r.status==="in_progress"?"text-green-400":r.status==="planning"?"text-yellow-400":"text-gray-400"}`,children:r.status.replace("_"," ")})]})]})]})]})},U=({toolName:a="this tool",showInlineSelector:l=!0,message:s,className:i=""})=>{const{activeCustomer:n,activeEngagement:r}=v();if(n&&r)return null;const d=`Select a customer and engagement before using ${a}. All scan results will be associated with the selected engagement.`;return e.jsx("div",{className:`bg-yellow-900/20 border border-yellow-600/30 rounded-lg p-4 ${i}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(z,{className:"w-6 h-6 text-yellow-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-400 mb-1",children:"Engagement Required"}),e.jsx("p",{className:"text-sm text-yellow-200/80 mb-4",children:s||d}),l&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx(T,{className:"lg:max-w-md"}),n&&!r&&e.jsxs("div",{className:"flex items-center text-sm text-yellow-200/60",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Now select an engagement to continue"]})]}),!l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-200/80",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"Use the engagement selector in the sidebar or header to set your active engagement."})]})]})]})})};function G(){const{activeCustomer:a,activeEngagement:l,hasActiveEngagement:s}=v(),i=s();return{hasEngagement:i,customerId:(a==null?void 0:a.id)??null,engagementId:(l==null?void 0:l.id)??null,customerName:(a==null?void 0:a.name)??null,engagementName:(l==null?void 0:l.name)??null,canStartScan:i,getEngagementContext:()=>a&&l?{customer_id:a.id,engagement_id:l.id}:null}}export{U as E,G as u};
