import{j as e}from"./vendor-state-BXNPjUwt.js";import{i as Z,u as K,r}from"./vendor-react-5KxtEOLM.js";import{B as P,af as z,v as B,_ as M,O as q,A as X,a9 as J,a_ as L,Z as Q,S as F,a2 as D}from"./vendor-ui-PizTOSgB.js";import{L as C}from"./Layout-CeExTnzB.js";import{C as x}from"./Card-D4UbjXYP.js";import{b as G,W as O,B as b}from"./index-DgePDh_X.js";import{L as I}from"./LoadingSpinner-p-Ub3czh.js";import{B as V}from"./Badge-B0_IBqp5.js";import"./Header-Dw99lsG2.js";import"./vendor-markdown-RN55YrVy.js";import"./vendor-utils-DfRopTPV.js";const ee=({nodes:l,edges:o,onNodeClick:N})=>{const p=r.useMemo(()=>{if(l.length===0)return[];const s=l.filter(t=>t.node_type==="entry"),i=l.filter(t=>t.node_type==="pivot"),n=l.filter(t=>t.node_type==="target"),c=60,f=(800-c*2)/3;return l.map(t=>{let j=c,h=0,g=1,m=0;return t.node_type==="entry"?(j=c,g=s.length,m=s.indexOf(t)):t.node_type==="pivot"?(j=c+f,g=i.length,m=i.indexOf(t)):(j=c+f*2,g=n.length,m=n.indexOf(t)),h=g>1?(m-(g-1)/2)*80:0,{...t,x:t.position_x!==0?t.position_x+c:j,y:t.position_y!==0?t.position_y+200:200+h}})},[l]),k=s=>{switch(s){case"entry":return"#22c55e";case"target":return"#ef4444";case"pivot":default:return"#f59e0b"}},v=s=>p.find(i=>i.id===s);return e.jsxs("svg",{viewBox:"0 0 800 400",className:"w-full h-full",style:{minHeight:"300px"},children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#64748b"})})}),o.map(s=>{const i=v(s.source_node_id),n=v(s.target_node_id);return!i||!n?null:e.jsxs("g",{children:[e.jsx("line",{x1:i.x+30,y1:i.y,x2:n.x-30,y2:n.y,stroke:"#64748b",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),s.attack_technique&&e.jsx("text",{x:(i.x+n.x)/2,y:(i.y+n.y)/2-10,fill:"#94a3b8",fontSize:"10",textAnchor:"middle",children:s.technique_id||s.attack_technique.slice(0,20)})]},s.id)}),p.map(s=>{var i;return e.jsxs("g",{className:"cursor-pointer",onClick:()=>N==null?void 0:N(s),children:[e.jsx("circle",{cx:s.x,cy:s.y,r:30,fill:k(s.node_type),fillOpacity:"0.2",stroke:k(s.node_type),strokeWidth:"2"}),e.jsx("text",{x:s.x,y:s.y-5,fill:"white",fontSize:"11",textAnchor:"middle",fontWeight:"bold",children:s.service||((i=s.host_ip)==null?void 0:i.split(".").slice(-1)[0])||"?"}),e.jsx("text",{x:s.x,y:s.y+10,fill:"#94a3b8",fontSize:"9",textAnchor:"middle",children:s.port?`:${s.port}`:s.node_type}),s.vulnerability_ids.length>0&&e.jsx("circle",{cx:s.x+30-5,cy:s.y-30+5,r:"10",fill:"#ef4444"}),s.vulnerability_ids.length>0&&e.jsx("text",{x:s.x+30-5,y:s.y-30+9,fill:"white",fontSize:"9",textAnchor:"middle",children:s.vulnerability_ids.length})]},s.id)}),e.jsxs("g",{transform:"translate(680, 20)",children:[e.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"#22c55e",fillOpacity:"0.3",stroke:"#22c55e"}),e.jsx("text",{x:"25",y:"14",fill:"#94a3b8",fontSize:"10",children:"Entry"}),e.jsx("circle",{cx:"10",cy:"30",r:"8",fill:"#f59e0b",fillOpacity:"0.3",stroke:"#f59e0b"}),e.jsx("text",{x:"25",y:"34",fill:"#94a3b8",fontSize:"10",children:"Pivot"}),e.jsx("circle",{cx:"10",cy:"50",r:"8",fill:"#ef4444",fillOpacity:"0.3",stroke:"#ef4444"}),e.jsx("text",{x:"25",y:"54",fill:"#94a3b8",fontSize:"10",children:"Target"})]})]})},U=({level:l})=>{const o={critical:"critical",high:"high",medium:"medium",low:"low"};return e.jsx(V,{type:o[l],children:l.toUpperCase()})},se=({path:l,isSelected:o,onClick:N})=>e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-all ${o?"border-primary bg-primary/10":"border-dark-border bg-dark-card hover:border-slate-600"}`,onClick:N,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-white font-medium",children:l.name||`Path ${l.id.slice(0,8)}`})]}),e.jsx(U,{level:l.risk_level})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Length:"})," ",e.jsxs("span",{className:"text-white",children:[l.path_length," nodes"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"CVSS:"})," ",e.jsx("span",{className:"text-white",children:l.total_cvss.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Probability:"})," ",e.jsxs("span",{className:"text-white",children:[(l.probability*100).toFixed(0),"%"]})]})]})]}),me=()=>{var E;const{scanId:l}=Z(),o=K(),[N,w]=r.useState(!0),[y,R]=r.useState(!1),[p,k]=r.useState(null),[v,s]=r.useState([]),[i,n]=r.useState([]),[c,f]=r.useState(null),[t,j]=r.useState(null),[h,g]=r.useState(null),[m,Y]=r.useState(!1),[S,T]=r.useState(!1),W=r.useCallback(async()=>{if(w(!0),!l){try{const d=((await G.getAll()).data||[]).filter(_=>_.status==="completed");s(d)}catch(a){P.error("Failed to load scans"),console.error(a)}finally{w(!1)}return}try{const a=await G.getById(l);k(a.data);try{const d=await O.getByScan(l);n(d.data.paths),f(d.data.stats),T(d.data.paths.length>0),d.data.paths.length>0&&j(d.data.paths[0])}catch{n([]),f(null),T(!1)}}catch(a){P.error("Failed to load scan data"),console.error(a)}finally{w(!1)}},[l]);r.useEffect(()=>{W()},[W]);const H=async(a=!1)=>{var d,_;if(l){R(!0);try{const A=await O.analyze(l,{force:a});P.success(A.data.message);const u=await O.getByScan(l);n(u.data.paths),f(u.data.stats),T(!0),u.data.paths.length>0&&j(u.data.paths[0])}catch(A){const u=A;P.error(((_=(d=u.response)==null?void 0:d.data)==null?void 0:_.error)||"Analysis failed"),console.error(A)}finally{R(!1)}}},$=r.useMemo(()=>m?i.filter(a=>a.risk_level==="critical"||a.risk_level==="high"):i,[i,m]);return N?e.jsx(C,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{})})}):l?p?e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(b,{variant:"secondary",onClick:()=>o(`/dashboard/${l}`),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Back to Scan"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(z,{className:"h-6 w-6 text-primary"}),"Attack Path Analysis"]}),e.jsxs("p",{className:"text-slate-400",children:["Scan: ",p.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S&&e.jsx(b,{variant:"secondary",onClick:()=>Y(!m),children:m?"Show All":"Critical Only"}),e.jsx(b,{onClick:()=>H(S),disabled:y||p.status!=="completed",children:y?e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx("span",{className:"ml-2",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),S?"Re-analyze":"Analyze"]})})]})]}),c&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:c.total_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(q,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:c.critical_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"Critical Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500/20 rounded-lg",children:e.jsx(Q,{className:"h-5 w-5 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:c.high_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"High Risk Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:c.total_nodes}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Nodes"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(F,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:((E=c.avg_path_length)==null?void 0:E.toFixed(1))||"N/A"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Avg Path Length"})]})]})})]}),S?i.length===0?e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(F,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Attack Paths Found"}),e.jsx("p",{className:"text-slate-400 max-w-md mx-auto",children:"The analysis did not identify any significant attack paths. This could mean the network is well-segmented or there are no vulnerable services that could be chained together."})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-3",children:["Attack Paths (",$.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto pr-2",children:$.map(a=>e.jsx(se,{path:a,isSelected:(t==null?void 0:t.id)===a.id,onClick:()=>{j(a),g(null)}},a.id))})]}),e.jsx("div",{className:"lg:col-span-2",children:t?e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.name||`Path ${t.id.slice(0,8)}`}),e.jsx(U,{level:t.risk_level})]}),e.jsx("div",{className:"bg-dark-bg rounded-lg border border-dark-border p-4 mb-4",children:e.jsx(ee,{nodes:t.nodes,edges:t.edges,onNodeClick:g})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Path Length"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[t.path_length," nodes"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Total CVSS"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:t.total_cvss.toFixed(1)})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Probability"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[(t.probability*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Nodes"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:t.nodes.length})]})]}),h&&e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 mb-4 border border-dark-border",children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Node Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"IP:"})," ",e.jsx("span",{className:"text-white",children:h.host_ip||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Port:"})," ",e.jsx("span",{className:"text-white",children:h.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Service:"})," ",e.jsx("span",{className:"text-white",children:h.service||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Type:"})," ",e.jsx("span",{className:"text-white capitalize",children:h.node_type})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"Vulnerabilities:"})," ",e.jsx("span",{className:"text-white",children:h.vulnerability_ids.length>0?h.vulnerability_ids.join(", "):"None"})]})]})]}),t.mitigation_steps.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-green-400"}),"Recommended Mitigations"]}),e.jsx("ul",{className:"space-y-2",children:t.mitigation_steps.map((a,d)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-300",children:[e.jsx(M,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),a]},d))})]})]}):e.jsx(x,{className:"p-8 text-center",children:e.jsx("p",{className:"text-slate-400",children:"Select an attack path from the list to view details"})})})]}):e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(z,{className:"h-16 w-16 text-slate-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Attack Paths Analyzed"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:'Click the "Analyze" button to identify potential attack paths in your scan results. The analysis will build a graph of hosts and vulnerabilities to find possible attack chains.'}),p.status!=="completed"&&e.jsx("p",{className:"text-yellow-500 text-sm mb-4",children:"Note: The scan must be completed before analysis."}),e.jsx(b,{onClick:()=>H(!1),disabled:y||p.status!=="completed",className:"mx-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx("span",{className:"ml-2",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Analyze Attack Paths"]})})]}),e.jsx(x,{className:"bg-blue-500/10 border-blue-500/30",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(D,{className:"h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-2",children:"About Attack Path Analysis"}),e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:"Attack path analysis identifies potential chains of vulnerabilities and misconfigurations that an attacker could exploit to move through your network. The analysis:"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-1 list-disc list-inside ml-4",children:[e.jsx("li",{children:"Builds a graph from discovered hosts, services, and vulnerabilities"}),e.jsx("li",{children:"Identifies entry points, pivot points, and target systems"}),e.jsx("li",{children:"Calculates risk scores based on CVSS, exploitability, and impact"}),e.jsx("li",{children:"Maps techniques to MITRE ATT&CK framework where applicable"}),e.jsx("li",{children:"Provides prioritized mitigation recommendations"})]})]})]})})]})}):e.jsx(C,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Scan Not Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"The requested scan could not be found."}),e.jsx(b,{onClick:()=>o("/dashboard"),children:"Go to Dashboard"})]})}):e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(z,{className:"h-6 w-6 text-primary"}),"Attack Path Analysis"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Select a completed scan to analyze attack paths"})]}),v.length===0?e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(z,{className:"h-16 w-16 text-slate-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Completed Scans Available"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:"You need to complete a network scan first before you can analyze attack paths. Run a scan with vulnerability detection enabled to get started."}),e.jsxs(b,{onClick:()=>o("/scan"),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Start New Scan"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(a=>e.jsxs(x,{className:"cursor-pointer hover:border-primary transition-all",onClick:()=>o(`/attack-paths/${a.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium text-white",children:a.name})]}),e.jsx(V,{type:a.status==="completed"?"low":"medium",children:a.status})]}),e.jsxs("div",{className:"text-sm text-slate-400 space-y-1",children:[e.jsxs("p",{children:["Targets: ",a.targets||"N/A"]}),e.jsxs("p",{children:["Created: ",new Date(a.created_at).toLocaleDateString()]}),a.total_hosts!==void 0&&e.jsxs("p",{children:["Hosts: ",a.total_hosts]})]}),e.jsxs("div",{className:"mt-3 flex items-center text-primary text-sm",children:[e.jsx("span",{children:"Analyze Attack Paths"}),e.jsx(M,{className:"h-4 w-4 ml-1"})]})]},a.id))})]})})};export{me as default};
