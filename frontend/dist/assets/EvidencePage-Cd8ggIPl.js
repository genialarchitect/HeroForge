import{j as e}from"./vendor-state-DdX3IZQk.js";import{r as i}from"./vendor-react-Da1CiaFS.js";import{a8 as H,E as me,S as V,al as Z,U as ke,aA as De,az as J,ay as re,aI as we,bD as se,_ as ye,V as Le,ai as he,P as ae,bf as ee,B as f,b9 as pe,aj as Ae,d as ce,ax as te,bA as Re,aV as K,bb as _e,ab as Te,m as Ue,aJ as Y,b6 as ze,ba as Me}from"./vendor-ui-Bpofv04e.js";import{B as S,b as j,a0 as Ve,H as be,d as Be}from"./index-CQBi_zXi.js";import"./vendor-charts-DIEgeIZG.js";function je(t){switch(t.type){case"scan_result":return"Scan Result";case"vulnerability_scan":return"Vulnerability Scan";case"policy_document":return"Policy Document";case"screenshot":return"Screenshot";case"manual_upload":return"Manual Upload";case"configuration_export":return"Configuration Export";case"audit_log":return"Audit Log";case"api_snapshot":return"API Snapshot";case"container_scan":return"Container Scan";case"cloud_security_posture":return"Cloud Security Posture";case"compliance_report":return"Compliance Report";default:return"Unknown"}}function Oe(t){switch(t){case"automated_scan":return"Automated Scan";case"scheduled_collection":return"Scheduled Collection";case"manual_upload":return"Manual Upload";case"external_import":return"External Import";case"api_integration":return"API Integration";case"derived":return"Derived";default:return"Unknown"}}const fe={active:{label:"Active",color:"green",icon:e.jsx(Le,{className:"h-4 w-4"})},pending_review:{label:"Pending Review",color:"yellow",icon:e.jsx(ye,{className:"h-4 w-4"})},approved:{label:"Approved",color:"green",icon:e.jsx(J,{className:"h-4 w-4"})},rejected:{label:"Rejected",color:"red",icon:e.jsx(re,{className:"h-4 w-4"})},superseded:{label:"Superseded",color:"blue",icon:e.jsx(se,{className:"h-4 w-4"})},archived:{label:"Archived",color:"gray",icon:e.jsx(se,{className:"h-4 w-4"})}},ve=({evidence:t,onView:a,onDelete:m,onStatusChange:h,compact:d=!1})=>{const o=fe[t.status]||fe.pending_review,v=Oe(t.collection_source),b=w=>new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return d?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-white text-sm",children:t.title}),e.jsx("p",{className:"text-xs text-slate-500",children:je(t.evidence_type)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:o.color,className:"flex items-center gap-1",children:[o.icon,e.jsx("span",{children:o.label})]}),a&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>a(t),children:e.jsx(me,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4 hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(H,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-sm text-slate-500",children:je(t.evidence_type)})]})]}),e.jsxs(S,{variant:o.color,className:"flex items-center gap-1",children:[o.icon,e.jsx("span",{children:o.label})]})]}),t.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.framework_ids.length," framework",t.framework_ids.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:b(t.collected_at)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:t.collected_by})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:v})]})]}),t.control_ids.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Controls:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.control_ids.slice(0,5).map(w=>e.jsx(S,{variant:"default",className:"text-xs",children:w},w)),t.control_ids.length>5&&e.jsxs(S,{variant:"default",className:"text-xs",children:["+",t.control_ids.length-5," more"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 pt-3 border-t border-light-border dark:border-dark-border",children:[e.jsxs("span",{children:["Version ",t.version]}),t.expires_at&&e.jsxs("span",{className:new Date(t.expires_at)<new Date?"text-red-500":"text-slate-500",children:["Expires: ",b(t.expires_at)]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-light-border dark:border-dark-border",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.status==="pending_review"&&h&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>h(t,"approved"),className:"text-green-600 border-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>h(t,"rejected"),className:"text-red-600 border-red-600 hover:bg-red-50",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Reject"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>a(t),children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"View"]}),m&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>m(t),className:"text-red-600 hover:text-red-700",children:e.jsx(we,{className:"h-4 w-4"})})]})]})]})},He=[{value:"policy_document",label:"Policy Document"},{value:"manual_upload",label:"Manual Upload"},{value:"screenshot",label:"Screenshot"},{value:"configuration",label:"Configuration"},{value:"log_extract",label:"Log Extract"},{value:"attestation",label:"Attestation"},{value:"training_record",label:"Training Record"},{value:"change_record",label:"Change Record"}],Ie=[{value:30,label:"30 days"},{value:90,label:"90 days"},{value:180,label:"180 days"},{value:365,label:"1 year"},{value:730,label:"2 years"},{value:1095,label:"3 years"},{value:0,label:"Indefinite"}],We=({onSubmit:t,onCancel:a,frameworks:m=[],controls:h=[]})=>{const[d,o]=i.useState(""),[v,b]=i.useState(""),[w,F]=i.useState("manual_upload"),[y,c]=i.useState([]),[g,p]=i.useState([]),[T,u]=i.useState(365),[E,P]=i.useState(""),[l,$]=i.useState(!1),A=y.length>0?h.filter(n=>y.includes(n.framework_id)):h,Q=n=>{c(C=>C.includes(n)?C.filter(_=>_!==n):[...C,n]),p(C=>C.filter(_=>{const U=h.find(B=>B.id===_);return U&&(y.includes(U.framework_id)||!C.includes(n))}))},D=n=>{p(C=>C.includes(n)?C.filter(_=>_!==n):[...C,n])},L=async n=>{if(n.preventDefault(),!d.trim()){f.error("Please enter a title");return}if(y.length===0){f.error("Please select at least one framework");return}if(g.length===0){f.error("Please select at least one control");return}$(!0);try{const C={title:d.trim(),description:v.trim()||void 0,evidence_type:w,framework_ids:y,control_ids:g,params:{retention_days:T>0?T:void 0,content:E.trim()?{text:E.trim()}:void 0}};await t(C),f.success("Evidence created successfully"),o(""),b(""),F("manual_upload"),c([]),p([]),u(365),P("")}catch{f.error("Failed to create evidence")}finally{$(!1)}};return e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:d,onChange:n=>o(n.target.value),placeholder:"Enter evidence title",className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:v,onChange:n=>b(n.target.value),placeholder:"Enter a description of this evidence",rows:3,className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Evidence Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:w,onChange:n=>F(n.target.value),className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:He.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(V,{className:"inline h-4 w-4 mr-1"}),"Frameworks ",e.jsx("span",{className:"text-red-500",children:"*"})]}),m.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(n=>e.jsxs("button",{type:"button",onClick:()=>Q(n.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${y.includes(n.id)?"bg-primary text-white":"bg-light-hover dark:bg-dark-hover text-slate-700 dark:text-slate-300 hover:bg-primary/20"}`,children:[y.includes(n.id)?e.jsx(he,{className:"inline h-3 w-3 mr-1"}):e.jsx(ae,{className:"inline h-3 w-3 mr-1"}),n.name]},n.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No frameworks available"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Controls ",e.jsx("span",{className:"text-red-500",children:"*"})]}),A.length>0?e.jsx("div",{className:"max-h-48 overflow-y-auto border border-light-border dark:border-dark-border rounded-lg p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:A.map(n=>e.jsx("button",{type:"button",onClick:()=>D(n.id),className:`px-2 py-1 rounded text-xs font-medium transition-colors ${g.includes(n.id)?"bg-primary text-white":"bg-light-hover dark:bg-dark-hover text-slate-700 dark:text-slate-300 hover:bg-primary/20"}`,children:n.id},n.id))})}):e.jsx("p",{className:"text-sm text-slate-500",children:y.length===0?"Select a framework first":"No controls available for selected frameworks"}),g.length>0&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[g.length," control",g.length!==1?"s":""," selected"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Retention Period"}),e.jsx("select",{value:T,onChange:n=>u(parseInt(n.target.value)),className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:Ie.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Content (Optional)"}),e.jsx("textarea",{value:E,onChange:n=>P(n.target.value),placeholder:"Enter evidence content or notes",rows:4,className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-light-border dark:border-dark-border",children:[a&&e.jsx(j,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:l,children:l?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Create Evidence"]})})]})]})},x=Ve.create({baseURL:"/api"});x.interceptors.request.use(t=>{const a=localStorage.getItem("token");return a&&(t.headers.Authorization=`Bearer ${a}`),t});const R={list:t=>{const a=new URLSearchParams;t!=null&&t.control_id&&a.append("control_id",t.control_id),t!=null&&t.framework_id&&a.append("framework_id",t.framework_id),t!=null&&t.evidence_type&&a.append("evidence_type",t.evidence_type),t!=null&&t.status&&a.append("status",t.status),t!=null&&t.collection_source&&a.append("collection_source",t.collection_source),(t==null?void 0:t.include_expired)!==void 0&&a.append("include_expired",t.include_expired.toString()),(t==null?void 0:t.include_superseded)!==void 0&&a.append("include_superseded",t.include_superseded.toString()),(t==null?void 0:t.limit)!==void 0&&a.append("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&a.append("offset",t.offset.toString());const m=a.toString();return x.get(`/evidence${m?`?${m}`:""}`)},create:t=>x.post("/evidence",t),get:t=>x.get(`/evidence/${t}`),delete:t=>x.delete(`/evidence/${t}`),updateStatus:(t,a)=>x.put(`/evidence/${t}/status`,a),getHistory:t=>x.get(`/evidence/${t}/history`),getVersionHistory:t=>x.get(`/evidence/${t}/versions`),compareVersions:(t,a)=>x.get(`/evidence/${t}/compare/${a}`),rollback:(t,a)=>x.post(`/evidence/${t}/rollback`,{target_version_id:a}),collect:t=>x.post("/evidence/collect",t),getSummary:(t,a)=>x.get(`/evidence/summary/${t}/${a}`),getControlSummary:(t,a)=>x.get(`/evidence/summary/${a}/${t}`),getForControl:(t,a)=>x.get(`/controls/${t}/${a}/evidence`),getMappings:(t,a,m)=>{const h=new URLSearchParams;t&&h.append("evidence_id",t),a&&h.append("control_id",a),m&&h.append("framework_id",m);const d=h.toString();return x.get(`/evidence/mappings${d?`?${d}`:""}`)},createMapping:t=>x.post("/evidence/mappings",t),updateMapping:(t,a)=>x.patch(`/evidence/mappings/${t}`,a),deleteMapping:t=>x.delete(`/evidence/mappings/${t}`),mappings:{list:t=>{const a=new URLSearchParams;t!=null&&t.framework_id&&a.append("framework_id",t.framework_id),t!=null&&t.control_id&&a.append("control_id",t.control_id),t!=null&&t.evidence_id&&a.append("evidence_id",t.evidence_id);const m=a.toString();return x.get(`/evidence/mappings${m?`?${m}`:""}`)},create:t=>x.post("/evidence/mappings",t),delete:t=>x.delete(`/evidence/mappings/${t}`)},getSchedules:()=>x.get("/evidence/schedules"),createSchedule:t=>x.post("/evidence/schedules",t),updateSchedule:(t,a)=>x.put(`/evidence/schedules/${t}`,a),deleteSchedule:t=>x.delete(`/evidence/schedules/${t}`),schedules:{list:()=>x.get("/evidence/schedules"),create:t=>x.post("/evidence/schedules",t),update:(t,a)=>x.put(`/evidence/schedules/${t}`,a),delete:t=>x.delete(`/evidence/schedules/${t}`)}},Ne={active:{label:"Active",color:"green",icon:e.jsx(J,{className:"h-4 w-4"})},pending_review:{label:"Pending Review",color:"yellow",icon:e.jsx(ye,{className:"h-4 w-4"})},approved:{label:"Approved",color:"green",icon:e.jsx(J,{className:"h-4 w-4"})},rejected:{label:"Rejected",color:"red",icon:e.jsx(re,{className:"h-4 w-4"})},superseded:{label:"Superseded",color:"blue",icon:e.jsx(se,{className:"h-4 w-4"})},archived:{label:"Archived",color:"gray",icon:e.jsx(se,{className:"h-4 w-4"})}},Je=({evidence:t,onClose:a,onStatusChange:m})=>{const[h,d]=i.useState([]),[o,v]=i.useState(!1),[b,w]=i.useState(!1),[F,y]=i.useState(!0),[c,g]=i.useState(!1),p=Ne[t.status]||Ne.pending_review;i.useEffect(()=>{b&&h.length===0&&T()},[b]);const T=async()=>{v(!0);try{const l=await R.getHistory(t.id);d(l.data.versions||[])}catch(l){console.error("Failed to load versions:",l)}finally{v(!1)}},u=l=>new Date(l).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=l=>({scan_result:"Scan Result",vulnerability_scan:"Vulnerability Scan",policy_document:"Policy Document",configuration_export:"Configuration Export",audit_log:"Audit Log",screenshot:"Screenshot",manual_upload:"Manual Upload",api_snapshot:"API Snapshot",container_scan:"Container Scan",cloud_security_posture:"Cloud Security Posture",compliance_report:"Compliance Report"})[l.type]||l.type,P=()=>{const l=t.content;if(!l||l.content_type==="none")return e.jsx("p",{className:"text-slate-500 italic",children:"No content available"});switch(l.content_type){case"text":return e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-slate-700 dark:text-slate-300 bg-light-hover dark:bg-dark-hover p-3 rounded-lg overflow-x-auto",children:l.text});case"json":return e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-slate-700 dark:text-slate-300 bg-light-hover dark:bg-dark-hover p-3 rounded-lg overflow-x-auto font-mono",children:JSON.stringify(l.data,null,2)});case"external_url":return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Re,{className:"h-4 w-4 text-primary"}),e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:l.url})]});case"file":return e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[e.jsxs("p",{children:["File: ",l.file_path]}),e.jsxs("p",{children:["Type: ",l.mime_type]}),e.jsxs("p",{children:["Size: ",(l.size_bytes||0).toLocaleString()," bytes"]})]});default:return e.jsx("p",{className:"text-slate-500 italic",children:"Content type not supported for display"})}};return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between p-4 border-b border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(H,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-sm text-slate-500",children:E(t.evidence_type)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:p.color,className:"flex items-center gap-1",children:[p.icon,e.jsx("span",{children:p.label})]}),a&&e.jsx(j,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(he,{className:"h-4 w-4"})})]})]}),t.description&&e.jsx("div",{className:"p-4 border-b border-light-border dark:border-dark-border",children:e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:t.description})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Collected At"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx(Z,{className:"h-4 w-4"}),u(t.collected_at)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Collected By"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx(ke,{className:"h-4 w-4"}),t.collected_by]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Version"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx(pe,{className:"h-4 w-4"}),"Version ",t.version]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Expires"}),e.jsxs("div",{className:`flex items-center gap-1 text-sm ${t.expires_at&&new Date(t.expires_at)<new Date?"text-red-500":"text-slate-700 dark:text-slate-300"}`,children:[e.jsx(Z,{className:"h-4 w-4"}),t.expires_at?u(t.expires_at):"Never"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-2 flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),"Frameworks"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.framework_ids.map(l=>e.jsx(S,{variant:"blue",children:l},l))})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-2 flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),"Controls"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.control_ids.slice(0,10).map(l=>e.jsx(S,{variant:"default",children:l},l)),t.control_ids.length>10&&e.jsxs(S,{variant:"default",children:["+",t.control_ids.length-10," more"]})]})]})]}),e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("button",{onClick:()=>y(!F),className:"w-full flex items-center justify-between p-3 hover:bg-light-hover dark:hover:bg-dark-hover transition-colors",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Content"}),F?e.jsx(ce,{className:"h-4 w-4 text-slate-500"}):e.jsx(te,{className:"h-4 w-4 text-slate-500"})]}),F&&e.jsx("div",{className:"p-3 border-t border-light-border dark:border-dark-border",children:P()})]}),e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("button",{onClick:()=>g(!c),className:"w-full flex items-center justify-between p-3 hover:bg-light-hover dark:hover:bg-dark-hover transition-colors",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Technical Details"}),c?e.jsx(ce,{className:"h-4 w-4 text-slate-500"}):e.jsx(te,{className:"h-4 w-4 text-slate-500"})]}),c&&e.jsxs("div",{className:"p-3 border-t border-light-border dark:border-dark-border space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"ID:"}),e.jsx("span",{className:"font-mono text-slate-700 dark:text-slate-300",children:t.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Content Hash:"}),e.jsx("span",{className:"font-mono text-slate-700 dark:text-slate-300 truncate max-w-xs",children:t.content_hash})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Collection Source:"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.collection_source.replace("_"," ")})]}),t.metadata.period_start&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Period Start:"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:u(t.metadata.period_start)})]}),t.metadata.period_end&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Period End:"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:u(t.metadata.period_end)})]}),Object.keys(t.metadata.tags||{}).length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Object.entries(t.metadata.tags).map(([l,$])=>e.jsxs(S,{variant:"gray",children:[l,": ",$]},l))})]})]})]}),e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("button",{onClick:()=>w(!b),className:"w-full flex items-center justify-between p-3 hover:bg-light-hover dark:hover:bg-dark-hover transition-colors",children:[e.jsxs("span",{className:"font-medium text-slate-700 dark:text-slate-300 flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Version History"]}),b?e.jsx(ce,{className:"h-4 w-4 text-slate-500"}):e.jsx(te,{className:"h-4 w-4 text-slate-500"})]}),b&&e.jsx("div",{className:"p-3 border-t border-light-border dark:border-dark-border",children:o?e.jsx("p",{className:"text-sm text-slate-500",children:"Loading versions..."}):h.length>0?e.jsx("div",{className:"space-y-2",children:h.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-light-hover dark:bg-dark-hover rounded",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-sm text-slate-700 dark:text-slate-300",children:["Version ",l.version]}),l.content_summary&&e.jsx("p",{className:"text-xs text-slate-500",children:l.content_summary}),l.change_description&&e.jsx("p",{className:"text-xs text-slate-400 italic",children:l.change_description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:[l.content_size.toLocaleString()," bytes"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:u(l.created_at)})]})]},l.evidence_id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No version history available"})})]})]}),t.status==="pending_review"&&m&&e.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t border-light-border dark:border-dark-border",children:[e.jsxs(j,{variant:"outline",onClick:()=>m(t,"approved"),className:"text-green-600 border-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(j,{variant:"outline",onClick:()=>m(t,"rejected"),className:"text-red-600 border-red-600 hover:bg-red-50",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})},Qe=[{value:"automated_scan",label:"Automated Scan"},{value:"scheduled_collection",label:"Scheduled Collection"},{value:"api_integration",label:"API Integration"}],xe=[{value:"0 0 * * *",label:"Daily at midnight"},{value:"0 0 * * 0",label:"Weekly on Sunday"},{value:"0 0 1 * *",label:"Monthly on 1st"},{value:"0 0 1 */3 *",label:"Quarterly"},{value:"0 0 1 1 *",label:"Yearly on Jan 1"},{value:"0 */6 * * *",label:"Every 6 hours"},{value:"0 0 * * 1-5",label:"Weekdays at midnight"}],Ge=({schedule:t,onSubmit:a,onCancel:m,frameworks:h=[],controls:d=[]})=>{const[o,v]=i.useState((t==null?void 0:t.name)||""),[b,w]=i.useState((t==null?void 0:t.description)||""),[F,y]=i.useState((t==null?void 0:t.collection_source)||"scheduled_collection"),[c,g]=i.useState((t==null?void 0:t.cron_expression)||"0 0 * * *"),[p,T]=i.useState((t==null?void 0:t.framework_ids)||[]),[u,E]=i.useState((t==null?void 0:t.control_ids)||[]),[P,l]=i.useState((t==null?void 0:t.enabled)??!0),[$,A]=i.useState(!1),[Q,D]=i.useState(""),L=!!t,n=p.length>0?d.filter(r=>p.includes(r.framework_id)):d;i.useEffect(()=>{const r=xe.find(N=>N.value===c);D((r==null?void 0:r.value)||"custom")},[c]);const C=r=>{T(N=>N.includes(r)?N.filter(M=>M!==r):[...N,r])},_=r=>{E(N=>N.includes(r)?N.filter(M=>M!==r):[...N,r])},U=r=>{D(r),r!=="custom"&&g(r)},B=async r=>{if(r.preventDefault(),!o.trim()){f.error("Please enter a name");return}if(!c.trim()){f.error("Please enter a cron expression");return}if(p.length===0){f.error("Please select at least one framework");return}if(u.length===0){f.error("Please select at least one control");return}A(!0);try{if(L){const N={name:o.trim(),description:b.trim()||void 0,cron_expression:c.trim(),framework_ids:p,control_ids:u,enabled:P};await a(N),f.success("Schedule updated successfully")}else{const N={name:o.trim(),description:b.trim()||void 0,collection_source:F,cron_expression:c.trim(),framework_ids:p,control_ids:u};await a(N),f.success("Schedule created successfully")}}catch{f.error(L?"Failed to update schedule":"Failed to create schedule")}finally{A(!1)}},le=r=>{const N=xe.find(G=>G.value===r);if(N)return N.label;const M=r.split(" ");if(M.length!==5)return"Custom schedule";const[ne,O,I,q,ie]=M;return ne==="0"&&O==="0"&&I==="*"&&q==="*"&&ie==="*"?"Daily at midnight":"Custom schedule"};return e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Schedule Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o,onChange:r=>v(r.target.value),placeholder:"Enter schedule name",className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:b,onChange:r=>w(r.target.value),placeholder:"Enter a description for this schedule",rows:2,className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none"})]}),!L&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Collection Source ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:F,onChange:r=>y(r.target.value),className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:Qe.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx(K,{className:"inline h-4 w-4 mr-1"}),"Schedule Frequency"]}),e.jsxs("select",{value:Q,onChange:r=>U(r.target.value),className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:[xe.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value)),e.jsx("option",{value:"custom",children:"Custom cron expression"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx(Z,{className:"inline h-4 w-4 mr-1"}),"Cron Expression ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c,onChange:r=>g(r.target.value),placeholder:"0 0 * * *",className:"w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary font-mono"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Schedule: ",le(c)]}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Format: minute hour day-of-month month day-of-week"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(V,{className:"inline h-4 w-4 mr-1"}),"Target Frameworks ",e.jsx("span",{className:"text-red-500",children:"*"})]}),h.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(r=>e.jsxs("button",{type:"button",onClick:()=>C(r.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${p.includes(r.id)?"bg-primary text-white":"bg-light-hover dark:bg-dark-hover text-slate-700 dark:text-slate-300 hover:bg-primary/20"}`,children:[p.includes(r.id)?e.jsx(he,{className:"inline h-3 w-3 mr-1"}):e.jsx(ae,{className:"inline h-3 w-3 mr-1"}),r.name]},r.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No frameworks available"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Target Controls ",e.jsx("span",{className:"text-red-500",children:"*"})]}),n.length>0?e.jsx("div",{className:"max-h-48 overflow-y-auto border border-light-border dark:border-dark-border rounded-lg p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(r=>e.jsx("button",{type:"button",onClick:()=>_(r.id),className:`px-2 py-1 rounded text-xs font-medium transition-colors ${u.includes(r.id)?"bg-primary text-white":"bg-light-hover dark:bg-dark-hover text-slate-700 dark:text-slate-300 hover:bg-primary/20"}`,children:r.id},r.id))})}):e.jsx("p",{className:"text-sm text-slate-500",children:p.length===0?"Select a framework first":"No controls available for selected frameworks"}),u.length>0&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[u.length," control",u.length!==1?"s":""," selected"]})]}),L&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:P,onChange:r=>l(r.target.checked),className:"h-4 w-4 rounded border-light-border dark:border-dark-border text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"enabled",className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Schedule enabled"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-light-border dark:border-dark-border",children:[m&&e.jsx(j,{type:"button",variant:"outline",onClick:m,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:$,children:$?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),L?"Update Schedule":"Create Schedule"]})})]})]})},Xe=t=>t>=.8?"green":t>=.5?"yellow":t>0?"red":"gray",Ye=t=>t>=.8?"Strong":t>=.5?"Partial":t>0?"Weak":"None",Ke=({summary:t,onViewEvidence:a,compact:m=!1})=>{const h=Math.round(t.coverage_score*100),d=Xe(t.coverage_score),o=Ye(t.coverage_score),v=b=>new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return m?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg hover:border-primary/50 transition-colors cursor-pointer",onClick:()=>a==null?void 0:a(t.control_id,t.framework_id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d==="green"?"bg-green-500":d==="yellow"?"bg-yellow-500":d==="red"?"bg-red-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-slate-900 dark:text-white",children:t.control_id}),e.jsx("p",{className:"text-xs text-slate-500",children:t.framework_id})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:[h,"%"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.total_evidence," items"]})]}),e.jsx(S,{variant:d,children:o})]})]}):e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(V,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:t.control_id}),e.jsx("p",{className:"text-sm text-slate-500",children:t.framework_id})]})]}),e.jsxs(S,{variant:d,className:"text-lg px-3 py-1",children:[h,"% ",o]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Evidence Coverage"}),e.jsxs("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:[h,"%"]})]}),e.jsx("div",{className:"w-full bg-light-hover dark:bg-dark-hover rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${d==="green"?"bg-green-500":d==="yellow"?"bg-yellow-500":d==="red"?"bg-red-500":"bg-gray-400"}`,style:{width:`${h}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-light-hover dark:bg-dark-hover rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-green-600 mb-1",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{className:"font-bold",children:t.active_evidence})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Active"})]}),e.jsxs("div",{className:"text-center p-2 bg-light-hover dark:bg-dark-hover rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-blue-600 mb-1",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"font-bold",children:t.total_evidence})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Total"})]}),e.jsxs("div",{className:"text-center p-2 bg-light-hover dark:bg-dark-hover rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-600 mb-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"font-bold",children:t.days_since_collection??"-"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Days Since"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm pt-3 border-t border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-1 text-slate-500",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{children:t.is_current?"Current":"Needs Update"})]}),t.latest_collection&&e.jsxs("span",{className:"text-slate-500",children:["Last collected: ",v(t.latest_collection)]})]}),a&&e.jsx("button",{onClick:()=>a(t.control_id,t.framework_id),className:"w-full mt-3 px-3 py-2 text-sm text-primary bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors",children:"View Evidence"})]})},Ze=({summaries:t,onViewEvidence:a})=>{const m=t.reduce((d,o)=>(d[o.framework_id]||(d[o.framework_id]=[]),d[o.framework_id].push(o),d),{}),h=Object.entries(m).map(([d,o])=>{const v=o.reduce((c,g)=>c+g.coverage_score,0)/o.length,b=o.reduce((c,g)=>c+g.total_evidence,0),w=o.filter(c=>c.coverage_score>=.8).length,F=o.filter(c=>c.coverage_score>=.5&&c.coverage_score<.8).length,y=o.filter(c=>c.coverage_score===0).length;return{frameworkId:d,controls:o,avgCoverage:v,totalEvidence:b,fullyCovered:w,partiallyCovered:F,noCoverage:y}});return e.jsx("div",{className:"space-y-6",children:h.map(d=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:d.frameworkId}),e.jsxs(S,{variant:"default",children:[d.controls.length," controls"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:["Avg Coverage: ",Math.round(d.avgCoverage*100),"%"]}),e.jsxs("span",{className:"text-green-600",children:[d.fullyCovered," strong"]}),e.jsxs("span",{className:"text-yellow-600",children:[d.partiallyCovered," partial"]}),e.jsxs("span",{className:"text-gray-500",children:[d.noCoverage," none"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:d.controls.map(o=>e.jsx(Ke,{summary:o,onViewEvidence:a,compact:!0},`${o.framework_id}-${o.control_id}`))})]},d.frameworkId))})},rt=()=>{const[t,a]=i.useState("library"),[m,h]=i.useState([]),[d,o]=i.useState([]),[v,b]=i.useState([]),[w,F]=i.useState([]),[y,c]=i.useState(!0),[g,p]=i.useState(null),[T,u]=i.useState(!1),[E,P]=i.useState(null),[l,$]=i.useState(""),[A,Q]=i.useState(""),[D,L]=i.useState(""),[n,C]=i.useState(""),[_,U]=i.useState(1),[B,le]=i.useState(0),r=12,[N,M]=i.useState([]);i.useEffect(()=>{ne()},[]),i.useEffect(()=>{t==="library"?O():t==="schedules"?I():t==="coverage"&&q()},[t,_,A,D,n]);const ne=async()=>{try{const s=await be.getFrameworks();b(s.data.frameworks||[]);const k=[];for(const z of s.data.frameworks||[])try{const W=((await be.getFrameworkControls(z.id)).data.controls||[]).map(X=>({id:X.id,name:X.title||X.id,framework_id:z.id}));k.push(...W)}catch{}F(k)}catch(s){console.error("Failed to load frameworks:",s)}},O=async()=>{c(!0);try{const s={limit:r,offset:(_-1)*r};A&&(s.status=A),D&&(s.framework_id=D),n&&(s.evidence_type=n);const k=await R.list(s);h(k.data.evidence||[]),le(k.data.total||0)}catch(s){console.error("Failed to load evidence:",s),f.error("Failed to load evidence")}finally{c(!1)}},I=async()=>{c(!0);try{const s=await R.getSchedules();o(s.data.schedules||[])}catch(s){console.error("Failed to load schedules:",s),f.error("Failed to load schedules")}finally{c(!1)}},q=async()=>{var s;c(!0);try{const k=[],z=D||((s=v[0])==null?void 0:s.id)||"";if(z){const ue=w.filter(W=>W.framework_id===z);for(const W of ue.slice(0,20))try{const X=await R.getControlSummary(W.id,z);k.push(X.data)}catch{k.push({control_id:W.id,framework_id:z,total_evidence:0,active_evidence:0,coverage_score:0,is_current:!1})}}M(k)}catch(k){console.error("Failed to load coverage:",k)}finally{c(!1)}},ie=async s=>{await R.collect({...s,params:s.params||{}}),O(),a("library")},G=async(s,k)=>{try{await R.updateStatus(s.id,{status:k}),f.success(`Evidence ${k==="approved"?"approved":"rejected"}`),O(),(g==null?void 0:g.id)===s.id&&p(null)}catch{f.error("Failed to update evidence status")}},ge=async s=>{if(confirm("Are you sure you want to delete this evidence?"))try{await R.delete(s.id),f.success("Evidence deleted"),O(),(g==null?void 0:g.id)===s.id&&p(null)}catch{f.error("Failed to delete evidence")}},Se=async s=>{await R.createSchedule(s),I(),u(!1)},Ce=async s=>{E&&(await R.updateSchedule(E.id,s),I(),P(null),u(!1))},Fe=async s=>{E?await Ce(s):await Se(s)},Ee=async s=>{if(confirm("Are you sure you want to delete this schedule?"))try{await R.deleteSchedule(s.id),f.success("Schedule deleted"),I()}catch{f.error("Failed to delete schedule")}},Pe=async(s,k)=>{L(k),a("library"),$(s)},de=l?m.filter(s=>{var k;return s.title.toLowerCase().includes(l.toLowerCase())||((k=s.description)==null?void 0:k.toLowerCase().includes(l.toLowerCase()))||s.control_ids.some(z=>z.toLowerCase().includes(l.toLowerCase()))}):m,oe=Math.ceil(B/r),$e=[{id:"library",label:"Evidence Library",icon:e.jsx(H,{className:"h-4 w-4"})},{id:"upload",label:"Upload",icon:e.jsx(ee,{className:"h-4 w-4"})},{id:"schedules",label:"Schedules",icon:e.jsx(K,{className:"h-4 w-4"})},{id:"coverage",label:"Control Mapping",icon:e.jsx(V,{className:"h-4 w-4"})}];return e.jsx(Be,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6 text-primary"}),"Compliance Evidence"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage evidence for compliance frameworks and controls"})]}),e.jsx("div",{className:"flex items-center gap-2 mb-6 border-b border-light-border dark:border-dark-border pb-2",children:$e.map(s=>e.jsxs("button",{onClick:()=>a(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${t===s.id?"bg-primary text-white":"text-slate-600 dark:text-slate-400 hover:bg-light-hover dark:hover:bg-dark-hover"}`,children:[s.icon,s.label]},s.id))}),t==="library"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 p-4 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",value:l,onChange:s=>$(s.target.value),placeholder:"Search evidence...",className:"w-full pl-10 pr-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary"})]})}),e.jsxs("select",{value:A,onChange:s=>{Q(s.target.value),U(1)},className:"px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending_review",children:"Pending Review"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"expired",children:"Expired"})]}),e.jsxs("select",{value:D,onChange:s=>{L(s.target.value),U(1)},className:"px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"All Frameworks"}),v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs(j,{variant:"outline",onClick:O,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),g?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-4",children:de.map(s=>e.jsx(ve,{evidence:s,onView:()=>p(s),onDelete:ge,onStatusChange:G,compact:!0},s.id))}),e.jsx(Je,{evidence:g,onClose:()=>p(null),onStatusChange:G})]}):y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Y,{className:"h-8 w-8 text-primary animate-spin"})}):de.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:de.map(s=>e.jsx(ve,{evidence:s,onView:()=>p(s),onDelete:ge,onStatusChange:G},s.id))}):e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(H,{className:"h-12 w-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-700 dark:text-slate-300 mb-2",children:"No evidence found"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Get started by uploading evidence or configuring automated collection."}),e.jsxs(j,{onClick:()=>a("upload"),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Upload Evidence"]})]}),oe>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("p",{className:"text-sm text-slate-500",children:["Showing ",(_-1)*r+1," - ",Math.min(_*r,B)," of"," ",B," items"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>U(_-1),disabled:_===1,children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Page ",_," of ",oe]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>U(_+1),disabled:_===oe,children:e.jsx(te,{className:"h-4 w-4"})})]})]})]}),t==="upload"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-primary"}),"Upload New Evidence"]}),e.jsx(We,{onSubmit:ie,onCancel:()=>a("library"),frameworks:v.map(s=>({id:s.id,name:s.name})),controls:w})]})}),t==="schedules"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Collection Schedules"}),e.jsxs(j,{onClick:()=>{P(null),u(!0)},children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"New Schedule"]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-primary"}),E?"Edit Schedule":"Create Schedule"]}),e.jsx(Ge,{schedule:E||void 0,onSubmit:Fe,onCancel:()=>{u(!1),P(null)},frameworks:v.map(s=>({id:s.id,name:s.name})),controls:w})]})}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Y,{className:"h-8 w-8 text-primary animate-spin"})}):d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.enabled?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800"}`,children:s.enabled?e.jsx(_e,{className:"h-5 w-5 text-green-600"}):e.jsx(Me,{className:"h-5 w-5 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(S,{variant:"default",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),s.cron_expression]}),e.jsxs(S,{variant:"blue",children:[s.framework_ids.length," framework",s.framework_ids.length!==1?"s":""]}),e.jsxs(S,{variant:"gray",children:[s.control_ids.length," control",s.control_ids.length!==1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:s.enabled?"green":"gray",children:s.enabled?"Active":"Disabled"}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{P(s),u(!0)},children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>Ee(s),className:"text-red-600",children:e.jsx(we,{className:"h-4 w-4"})})]})]}),s.last_run_at&&e.jsxs("p",{className:"text-xs text-slate-500 mt-3 pt-3 border-t border-light-border dark:border-dark-border",children:["Last run: ",new Date(s.last_run_at).toLocaleString(),s.next_run_at&&e.jsxs("span",{className:"ml-4",children:["Next run: ",new Date(s.next_run_at).toLocaleString()]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(K,{className:"h-12 w-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-700 dark:text-slate-300 mb-2",children:"No schedules configured"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Set up automated evidence collection schedules for your compliance controls."}),e.jsxs(j,{onClick:()=>{P(null),u(!0)},children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Create Schedule"]})]})]}),t==="coverage"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Framework:"}),e.jsx("select",{value:D,onChange:s=>{L(s.target.value)},className:"px-3 py-2 bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary",children:v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsxs(j,{variant:"outline",onClick:q,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Y,{className:"h-8 w-8 text-primary animate-spin"})}):N.length>0?e.jsx(Ze,{summaries:N,onViewEvidence:Pe}):e.jsxs("div",{className:"text-center py-12 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx(V,{className:"h-12 w-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-700 dark:text-slate-300 mb-2",children:"No coverage data"}),e.jsx("p",{className:"text-slate-500",children:"Select a framework to view evidence coverage by control."})]})]})]})})};export{rt as default};
