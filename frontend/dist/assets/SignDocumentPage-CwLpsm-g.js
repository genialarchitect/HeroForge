import{j as e}from"./vendor-state-oFDmcCcB.js";import{r as d,i as R,e as T,u as Y}from"./vendor-react-5KxtEOLM.js";import{cP as A,d as L,aa as M,V as $,g as k,i as C,S as P,F as z,B as p}from"./vendor-ui-BlFJDRaq.js";import{a as B,s as S}from"./legal-CwbboPqQ.js";import{S as H}from"./SignaturePad-x70KwPpv.js";import{D as O}from"./DocumentPreview-CW5PIR9v.js";import"./vendor-utils-DfRopTPV.js";const Q=({signerRole:m,signerEmail:j,onSubmit:o,onDecline:l,isSubmitting:s=!1,className:N=""})=>{const f=d.useRef(null),[x,w]=d.useState(""),[h,g]=d.useState(!1),[v,b]=d.useState(!0),[t,i]=d.useState(!1),[c,r]=d.useState(""),[n,y]=d.useState({}),D=()=>{const a={};return x.trim()?x.trim().length<2&&(a.name="Name must be at least 2 characters"):a.name="Please enter your legal name",v&&(a.signature="Please draw your signature"),h||(a.acknowledgment="You must acknowledge that this is a legally binding signature"),y(a),Object.keys(a).length===0},E=a=>{var _;if(a.preventDefault(),!D())return;const u=((_=f.current)==null?void 0:_.toDataURL())||"";o({signerName:x.trim(),signatureImage:u,acknowledgment:h})},F=()=>{var a;(a=f.current)==null||a.clear(),b(!0),y(u=>({...u,signature:void 0}))},I=()=>{c.trim()&&(l==null||l(c.trim()),i(!1))};return e.jsxs("div",{className:`bg-gray-800 rounded-lg p-6 ${N}`,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sign Document"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Signing as ",e.jsx("span",{className:"text-cyan-400",children:m})," (",j,")"]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"signerName",className:"block text-sm font-medium text-gray-300 mb-2",children:["Full Legal Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",id:"signerName",value:x,onChange:a=>{w(a.target.value),y(u=>({...u,name:void 0}))},className:`w-full px-4 py-2 bg-gray-700 border rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 ${n.name?"border-red-500":"border-gray-600"}`,placeholder:"Enter your full legal name",disabled:s}),n.name&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:n.name})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["Signature ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("button",{type:"button",onClick:F,className:"flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors",disabled:s,children:[e.jsx(A,{className:"w-4 h-4"}),"Clear"]})]}),e.jsx("div",{className:`border rounded-lg overflow-hidden ${n.signature?"border-red-500":"border-gray-600"}`,children:e.jsx(H,{ref:f,width:500,height:150,penColor:"#000000",backgroundColor:"#ffffff",onChange:a=>{b(a),a||y(u=>({...u,signature:void 0}))}})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Draw your signature using your mouse or touchscreen"}),n.signature&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:n.signature})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:a=>{g(a.target.checked),y(u=>({...u,acknowledgment:void 0}))},className:"mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-cyan-500 focus:ring-cyan-500 focus:ring-offset-gray-800",disabled:s}),e.jsx("span",{className:"text-sm text-gray-300",children:'I acknowledge that by clicking "Sign Document" I am agreeing to be legally bound by the terms of this document. My electronic signature has the same legal effect as a handwritten signature.'})]}),n.acknowledgment&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:n.acknowledgment})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-gray-700",children:[e.jsxs("button",{type:"submit",disabled:s,className:"flex items-center gap-2 px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(L,{className:"w-4 h-4"}),s?"Signing...":"Sign Document"]}),l&&e.jsx("button",{type:"button",onClick:()=>i(!0),disabled:s,className:"px-6 py-2 text-gray-300 hover:text-white transition-colors disabled:opacity-50",children:"Decline to Sign"})]})]}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Decline to Sign"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Please provide a reason for declining to sign this document."}),e.jsx("textarea",{value:c,onChange:a=>r(a.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500 resize-none",rows:3,placeholder:"Enter your reason..."}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[e.jsx("button",{onClick:I,disabled:!c.trim(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirm Decline"}),e.jsx("button",{onClick:()=>{i(!1),r("")},className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"})]})]})})]})},K=()=>{const{token:m}=R(),[j]=T();Y();const[o,l]=d.useState("loading"),[s,N]=d.useState(null),[f,x]=d.useState(!1),[w,h]=d.useState(""),g=j.get("email")||"";d.useEffect(()=>{(async()=>{var i,c;if(!m||!g){h("Invalid signing link. Please check your email for the correct link."),l("error");return}try{const r=await S.getDocument(m,g);N(r);const n=r.all_signatures.find(y=>y.signer_email===g);(n==null?void 0:n.status)==="signed"?l("already_signed"):(n==null?void 0:n.status)==="declined"?l("declined"):l("ready")}catch(r){console.error("Failed to load document:",r),((i=r.response)==null?void 0:i.status)===404?(h("This signing link is invalid or has expired."),l("expired")):((c=r.response)==null?void 0:c.status)===403?(h("You are not authorized to sign this document."),l("error")):(h("Failed to load document. Please try again later."),l("error"))}})()},[m,g]);const v=async t=>{var i,c;if(m){x(!0);try{const r=await S.submitSignature(m,{signer_email:g,signer_name:t.signerName,signature_image:t.signatureImage,acknowledgment:t.acknowledgment});p.success("Document signed successfully!"),l("signed")}catch(r){console.error("Failed to sign:",r),p.error(((c=(i=r.response)==null?void 0:i.data)==null?void 0:c.message)||"Failed to sign document")}finally{x(!1)}}},b=async t=>{var i,c;if(m){x(!0);try{await S.declineSignature(m,{signer_email:g,reason:t}),p.info("Signature declined"),l("declined")}catch(r){console.error("Failed to decline:",r),p.error(((c=(i=r.response)==null?void 0:i.data)==null?void 0:c.message)||"Failed to decline signature")}finally{x(!1)}}};return o==="loading"?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"w-10 h-10 text-cyan-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading document..."})]})}):o==="error"||o==="expired"?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-900/30 flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 text-red-400"})}),e.jsx("h1",{className:"text-xl font-bold text-white mb-2",children:o==="expired"?"Link Expired":"Error"}),e.jsx("p",{className:"text-gray-400 mb-6",children:w}),e.jsx("p",{className:"text-gray-500 text-sm",children:"If you believe this is an error, please contact the document sender."})]})}):o==="signed"||o==="already_signed"?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-900/30 flex items-center justify-center",children:e.jsx(k,{className:"w-8 h-8 text-green-400"})}),e.jsx("h1",{className:"text-xl font-bold text-white mb-2",children:o==="already_signed"?"Already Signed":"Document Signed"}),e.jsx("p",{className:"text-gray-400 mb-4",children:o==="already_signed"?"You have already signed this document.":"Thank you for signing! A copy will be sent to your email once all parties have signed."}),s&&e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4 text-left",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[e.jsx("strong",{children:"Document:"})," ",s.document_name]}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[e.jsx("strong",{children:"Engagement:"})," ",s.engagement_name]})]})]})}):o==="declined"?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-yellow-900/30 flex items-center justify-center",children:e.jsx(C,{className:"w-8 h-8 text-yellow-400"})}),e.jsx("h1",{className:"text-xl font-bold text-white mb-2",children:"Signature Declined"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"You have declined to sign this document. The document sender has been notified."}),s&&e.jsx("div",{className:"bg-gray-700/50 rounded-lg p-4 text-left",children:e.jsxs("p",{className:"text-sm text-gray-300",children:[e.jsx("strong",{children:"Document:"})," ",s.document_name]})})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-900",children:[e.jsx("header",{className:"bg-gray-800 border-b border-gray-700 px-6 py-4",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-cyan-600 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"HeroForge"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Secure Document Signing"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-300",children:s==null?void 0:s.customer_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s==null?void 0:s.engagement_name})]})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:s==null?void 0:s.document_name})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:s&&B(s.document_type)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Signing as: ",e.jsx("span",{className:"text-cyan-400",children:s==null?void 0:s.signer_role})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s==null?void 0:s.signer_email})]})]}),s&&s.all_signatures.length>1&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Signature Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.all_signatures.map((t,i)=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs ${t.status==="signed"?"bg-green-900/30 text-green-400":t.status==="declined"?"bg-red-900/30 text-red-400":"bg-gray-700 text-gray-400"}`,children:[t.status==="signed"?e.jsx(k,{className:"w-3 h-3"}):t.status==="declined"?e.jsx(C,{className:"w-3 h-3"}):e.jsx("div",{className:"w-3 h-3 rounded-full border border-current"}),t.signer_role,t.signer_email===g&&" (You)"]},i))})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Document Preview"}),e.jsx("div",{className:"max-h-[600px] overflow-y-auto rounded-lg",children:s&&e.jsx(O,{contentHtml:s.content_html,signatures:s.all_signatures.map(t=>({id:"",document_id:s.document_id,signer_type:t.signer_type,signer_role:t.signer_role,signer_name:t.signer_name,signer_email:t.signer_email,status:t.status,signed_at:t.signed_at,signed_ip:null,signature_image:null,decline_reason:null,signature_order:0})),showSignatureBlocks:!0})})]}),s&&e.jsx(Q,{signerRole:s.signer_role,signerEmail:s.signer_email,onSubmit:v,onDecline:b,isSubmitting:f}),e.jsx("div",{className:"mt-6 p-4 bg-gray-800/50 border border-gray-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-cyan-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("p",{className:"font-medium text-gray-300 mb-1",children:"Secure Signing"}),e.jsx("p",{children:"Your signature is protected using industry-standard encryption. We record your IP address and timestamp for legal verification purposes. This electronic signature is legally binding."})]})]})})]}),e.jsx("footer",{className:"mt-12 py-6 border-t border-gray-800",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 text-center text-xs text-gray-500",children:[e.jsx("p",{children:"Powered by HeroForge Security Platform"}),e.jsx("p",{className:"mt-1",children:"Questions about this document? Contact the sender or your account representative."})]})})]})};export{K as default};
