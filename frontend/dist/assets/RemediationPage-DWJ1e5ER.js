import{j as e}from"./vendor-state-DrZ0R9WI.js";import{r as i}from"./vendor-react-HUtzaQ-y.js";import{a as ae,z as v,o as he,g as pe,c as ye}from"./index-5QWMsp4c.js";import{B as m}from"./vendor-ui-BfvgsWUa.js";import"./vendor-charts-BXiKjFOL.js";const fe=({scanId:g,onVulnerabilityClick:D})=>{const[n,d]=i.useState([]),[B,R]=i.useState(!0),[c,b]=i.useState(null),[x,h]=i.useState(!1),[u,j]=i.useState(new Set),[V,A]=i.useState([]),[$,o]=i.useState(!1),[w,k]=i.useState(!1),[T,F]=i.useState(""),[_,S]=i.useState(""),M=[{id:"open",title:"Open",color:"bg-red-900/20 border-red-700"},{id:"in_progress",title:"In Progress",color:"bg-yellow-900/20 border-yellow-700"},{id:"pending_verification",title:"Pending Verification",color:"bg-blue-900/20 border-blue-700"},{id:"resolved",title:"Resolved",color:"bg-green-900/20 border-green-700"}];i.useEffect(()=>{N(),q()},[g]);const q=async()=>{try{const s=await ae.getUsers();A(s.data)}catch(s){console.debug("Could not load users list:",s)}},N=async()=>{try{if(R(!0),!g){d([]);return}const s=await v.list({scan_id:g});d(s.data)}catch(s){console.error("Failed to load vulnerabilities:",s)}finally{R(!1)}},J=(s,a)=>{b(a),s.dataTransfer.effectAllowed="move"},H=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},O=async(s,a)=>{if(s.preventDefault(),!(!c||c.status===a||x))try{h(!0),await v.update(c.id,{status:a}),await N(),b(null)}catch(y){console.error("Failed to update vulnerability status:",y)}finally{h(!1)}},W=()=>{b(null)},P=(s,a)=>{a.stopPropagation();const y=new Set(u);y.has(s)?y.delete(s):y.add(s),j(y)},L=async s=>{if(u.size!==0)try{h(!0),await v.bulkUpdate({vulnerability_ids:Array.from(u),status:s}),m.success(`Updated ${u.size} vulnerabilities to ${s.replace(/_/g," ")}`),j(new Set),await N()}catch(a){console.error("Failed to bulk update status:",a),m.error("Failed to update vulnerabilities")}finally{h(!1)}},p=async()=>{if(u.size!==0)try{h(!0),await v.bulkUpdate({vulnerability_ids:Array.from(u),assignee_id:T||void 0}),m.success(`Assigned ${u.size} vulnerabilities`),j(new Set),o(!1),F(""),await N()}catch(s){console.error("Failed to bulk assign:",s),m.error("Failed to assign vulnerabilities")}finally{h(!1)}},f=async()=>{if(!(u.size===0||!_))try{h(!0),await v.bulkUpdate({vulnerability_ids:Array.from(u),due_date:`${_}T00:00:00Z`}),m.success(`Updated due date for ${u.size} vulnerabilities`),j(new Set),k(!1),S(""),await N()}catch(s){console.error("Failed to bulk update due date:",s),m.error("Failed to update due dates")}finally{h(!1)}},K=()=>{j(new Set)},z=s=>n.filter(a=>a.status===s),Z=s=>{switch(s.toLowerCase()){case"critical":return"border-l-4 border-red-500";case"high":return"border-l-4 border-orange-500";case"medium":return"border-l-4 border-yellow-500";case"low":return"border-l-4 border-blue-500";default:return"border-l-4 border-gray-500"}},I=s=>{if(!s)return null;const a={critical:"bg-red-600 text-white",high:"bg-orange-600 text-white",medium:"bg-yellow-600 text-white",low:"bg-blue-600 text-white"};return e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${a[s.toLowerCase()]||"bg-gray-600 text-white"}`,children:s.charAt(0).toUpperCase()})};return B?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Remediation Board"}),e.jsxs("div",{className:"flex gap-2",children:[u.size>0&&e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded",children:[u.size," selected"]}),e.jsx("button",{onClick:N,className:"px-3 py-1 text-sm bg-gray-700 text-gray-300 rounded hover:bg-gray-600",children:"Refresh"})]})]}),u.size>0&&e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-gray-400 text-sm mr-2",children:"Bulk Actions:"}),e.jsx("button",{onClick:()=>L("in_progress"),disabled:x,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600",children:"Mark In Progress"}),e.jsx("button",{onClick:()=>L("pending_verification"),disabled:x,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600",children:"Mark Pending Verification"}),e.jsx("button",{onClick:()=>L("resolved"),disabled:x,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-600",children:"Mark Resolved"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:()=>o(!0),disabled:x,className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 disabled:bg-gray-600",children:"Assign"}),e.jsx("button",{onClick:()=>k(!0),disabled:x,className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-600",children:"Set Due Date"}),e.jsx("div",{className:"border-l border-gray-600 mx-2 h-6"}),e.jsx("button",{onClick:K,className:"px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-500",children:"Clear Selection"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(s=>e.jsxs("div",{className:`rounded-lg border-2 ${s.color} p-4 min-h-[400px] transition-colors ${c&&c.status!==s.id?"ring-2 ring-blue-500/50":""}`,onDragOver:H,onDrop:a=>O(a,s.id),children:[e.jsxs("h3",{className:"font-semibold text-lg mb-4 text-white flex justify-between items-center",children:[e.jsx("span",{children:s.title}),e.jsx("span",{className:"text-sm font-normal text-gray-400 bg-gray-800 px-2 py-0.5 rounded",children:z(s.id).length})]}),e.jsxs("div",{className:"space-y-2",children:[z(s.id).map(a=>e.jsxs("div",{draggable:!x&&!u.has(a.id),onDragStart:y=>J(y,a),onDragEnd:W,onClick:()=>D==null?void 0:D(a.id),className:`bg-gray-800 p-3 rounded shadow cursor-move hover:shadow-lg hover:bg-gray-750 transition-all ${Z(a.severity)} ${(c==null?void 0:c.id)===a.id?"opacity-50":""} ${x?"cursor-not-allowed":""} ${u.has(a.id)?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:u.has(a.id),onClick:y=>P(a.id,y),onChange:()=>{},className:"rounded border-gray-600 text-blue-600 focus:ring-blue-500 bg-gray-700"}),e.jsx("div",{className:"font-medium text-sm text-white truncate",children:a.vulnerability_id})]}),I(a.priority)]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 ml-6",children:a.host_ip}),a.port&&e.jsxs("div",{className:"text-xs text-gray-500 ml-6",children:["Port: ",a.port]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 ml-6",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${a.severity==="critical"?"bg-red-900/50 text-red-300":a.severity==="high"?"bg-orange-900/50 text-orange-300":a.severity==="medium"?"bg-yellow-900/50 text-yellow-300":"bg-blue-900/50 text-blue-300"}`,children:a.severity}),a.assignee_id&&e.jsx("span",{className:"text-xs text-gray-500",children:"Assigned"})]}),a.due_date&&e.jsxs("div",{className:`text-xs mt-1 ml-6 ${new Date(a.due_date)<new Date?"text-red-400":"text-gray-500"}`,children:["Due: ",new Date(a.due_date).toLocaleDateString()]}),a.estimated_effort&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 ml-6",children:["Est: ",a.estimated_effort,"h",a.actual_effort?` / Actual: ${a.actual_effort}h`:""]})]},a.id)),z(s.id).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No vulnerabilities"})]})]},s.id))}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-400 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Critical"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"High"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{children:"Low"})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Assign ",u.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Select Assignee"}),e.jsxs("select",{value:T,onChange:s=>F(s.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),V.map(s=>e.jsxs("option",{value:s.id,children:[s.username," (",s.email,")"]},s.id))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{o(!1),F("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:x,children:"Cancel"}),e.jsx("button",{onClick:p,disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:x?"Assigning...":"Assign"})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4",children:["Set Due Date for ",u.size," Vulnerabilities"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:_,onChange:s=>S(s.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{k(!1),S("")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",disabled:x,children:"Cancel"}),e.jsx("button",{onClick:f,disabled:x||!_,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:x?"Updating...":"Set Due Date"})]})]})})]}):e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Select a scan to view the remediation board"})},ve=({vulnerabilityId:g,onClose:D,onUpdate:n})=>{const[d,B]=i.useState(null),[R,c]=i.useState(!0),[b,x]=i.useState(!1),[h,u]=i.useState("info"),[j,V]=i.useState([]),[A,$]=i.useState(""),[o,w]=i.useState(""),[k,T]=i.useState(""),[F,_]=i.useState(""),[S,M]=i.useState(""),[q,N]=i.useState(""),[J,H]=i.useState(""),[O,W]=i.useState(""),[P,L]=i.useState(""),[p,f]=i.useState(!1),[K,z]=i.useState(!1),[Z,I]=i.useState(""),[s,a]=i.useState(!1),[y,G]=i.useState("still_vulnerable");i.useEffect(()=>{E(),re()},[g]);const re=async()=>{try{const t=await ae.getUsers();V(t.data)}catch(t){console.debug("Could not load users list:",t)}},E=async()=>{var t;try{c(!0);const l=await v.get(g);B(l.data),$(l.data.vulnerability.status),w(l.data.vulnerability.priority||"medium"),T(l.data.vulnerability.notes||""),_(l.data.vulnerability.assignee_id||""),M(((t=l.data.vulnerability.due_date)==null?void 0:t.split("T")[0])||""),N(l.data.vulnerability.remediation_steps||""),H(l.data.vulnerability.estimated_effort||""),W(l.data.vulnerability.actual_effort||"")}catch(l){console.error("Failed to load vulnerability detail:",l)}finally{c(!1)}},Q=async()=>{var t;if(d)try{f(!0),await v.update(g,{status:A!==d.vulnerability.status?A:void 0,priority:o!==(d.vulnerability.priority||"medium")?o:void 0,notes:k!==(d.vulnerability.notes||"")?k:void 0,assignee_id:F!==(d.vulnerability.assignee_id||"")&&F||void 0,due_date:S!==(((t=d.vulnerability.due_date)==null?void 0:t.split("T")[0])||"")&&S?`${S}T00:00:00Z`:void 0,remediation_steps:q!==(d.vulnerability.remediation_steps||"")?q:void 0,estimated_effort:typeof J=="number"?J:void 0,actual_effort:typeof O=="number"?O:void 0}),m.success("Vulnerability updated successfully"),await E(),x(!1),n==null||n()}catch(l){console.error("Failed to update vulnerability:",l),m.error("Failed to update vulnerability")}finally{f(!1)}},le=async()=>{try{f(!0),await v.markForVerification(g,{}),m.success("Vulnerability marked for verification"),await E(),n==null||n()}catch(t){console.error("Failed to mark for verification:",t),m.error("Failed to mark for verification")}finally{f(!1)}},ie=async t=>{if(t.preventDefault(),!!P.trim())try{f(!0),await v.addComment(g,P),L(""),m.success("Comment added"),await E()}catch(l){console.error("Failed to add comment:",l),m.error("Failed to add comment")}finally{f(!1)}},de=async()=>{var t,l;if(d){z(!0);try{const U=await he.createTicket(g);m.success(`JIRA ticket ${U.data.jira_ticket_key} created successfully!`),await E(),n==null||n()}catch(U){console.error("Failed to create JIRA ticket:",U);const ge=U;m.error(((l=(t=ge.response)==null?void 0:t.data)==null?void 0:l.error)||"Failed to create JIRA ticket")}finally{z(!1)}}},ne=async()=>{try{f(!0),await v.requestRetest(g,{notes:Z||void 0}),m.success("Retest requested successfully"),I(""),await E(),n==null||n()}catch(t){console.error("Failed to request retest:",t),m.error("Failed to request retest")}finally{f(!1)}},oe=async()=>{try{f(!0),await v.completeRetest(g,{result:y,notes:Z||void 0}),m.success(`Retest completed: ${y.replace(/_/g," ")}`),a(!1),I(""),G("still_vulnerable"),await E(),n==null||n()}catch(t){console.error("Failed to complete retest:",t),m.error("Failed to complete retest")}finally{f(!1)}},X=()=>{var t;d&&(x(!1),$(d.vulnerability.status),w(d.vulnerability.priority||"medium"),T(d.vulnerability.notes||""),_(d.vulnerability.assignee_id||""),M(((t=d.vulnerability.due_date)==null?void 0:t.split("T")[0])||""),N(d.vulnerability.remediation_steps||""),H(d.vulnerability.estimated_effort||""),W(d.vulnerability.actual_effort||""))},ce=t=>{const l="px-3 py-1 text-sm font-semibold rounded-full";switch(t.toLowerCase()){case"critical":return`${l} bg-red-900/50 text-red-300`;case"high":return`${l} bg-orange-900/50 text-orange-300`;case"medium":return`${l} bg-yellow-900/50 text-yellow-300`;case"low":return`${l} bg-blue-900/50 text-blue-300`;default:return`${l} bg-gray-700 text-gray-300`}},xe=t=>{const l="px-3 py-1 text-sm font-semibold rounded-full";switch(t){case"open":return`${l} bg-red-900/50 text-red-300`;case"in_progress":return`${l} bg-yellow-900/50 text-yellow-300`;case"pending_verification":return`${l} bg-blue-900/50 text-blue-300`;case"resolved":return`${l} bg-green-900/50 text-green-300`;case"false_positive":return`${l} bg-gray-700 text-gray-300`;case"accepted_risk":return`${l} bg-purple-900/50 text-purple-300`;default:return`${l} bg-gray-700 text-gray-300`}},Y=t=>t.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase()),ue=t=>{const l="px-3 py-1 text-sm font-semibold rounded-full";switch(t){case"remediated":return`${l} bg-green-900/50 text-green-300`;case"partially_remediated":return`${l} bg-yellow-900/50 text-yellow-300`;case"still_vulnerable":return`${l} bg-red-900/50 text-red-300`;default:return`${l} bg-blue-900/50 text-blue-300`}},C=t=>new Date(t).toLocaleString(),me=t=>t.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase()),be=()=>!d||!d.timeline||d.timeline.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No timeline events"}):e.jsx("div",{className:"space-y-4",children:d.timeline.map(t=>e.jsxs("div",{className:"border-l-2 border-blue-600 pl-4 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("div",{className:"font-medium text-white",children:t.username}),e.jsx("div",{className:"text-xs text-gray-400",children:C(t.created_at)})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:me(t.event_type)}),t.old_value&&t.new_value&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Changed from"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:t.old_value})," ","to"," ",e.jsx("span",{className:"font-mono bg-gray-800 px-1 rounded",children:t.new_value})]}),t.comment&&e.jsx("div",{className:"text-sm text-gray-300 mt-1",children:t.comment})]},t.id))});if(R)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-lg p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})});if(!d)return null;const{vulnerability:r,comments:ee,resolved_by_user:te,verified_by_user:se}=d;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-900 border-b border-gray-700 px-6 py-4 z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:r.vulnerability_id}),e.jsx("button",{onClick:D,className:"text-gray-400 hover:text-white text-2xl leading-none",children:"Ã—"})]}),e.jsx("div",{className:"flex gap-4 mt-4",children:[{id:"info",label:"Information"},{id:"remediation",label:"Remediation"},{id:"timeline",label:"Timeline"}].map(t=>e.jsx("button",{onClick:()=>u(t.id),className:`pb-2 px-1 border-b-2 transition-colors ${h===t.id?"border-blue-500 text-blue-400 font-semibold":"border-transparent text-gray-400 hover:text-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{className:"p-6",children:[h==="info"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Host"}),e.jsx("div",{className:"text-white",children:r.host_ip})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Port"}),e.jsx("div",{className:"text-white",children:r.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Severity"}),e.jsx("div",{children:e.jsx("span",{className:ce(r.severity),children:r.severity.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),b?e.jsxs("select",{value:A,onChange:t=>$(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"false_positive",children:"False Positive"}),e.jsx("option",{value:"accepted_risk",children:"Accepted Risk"})]}):e.jsx("span",{className:xe(r.status),children:Y(r.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Priority"}),b?e.jsxs("select",{value:o,onChange:t=>w(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}):e.jsx("div",{className:"text-white",children:(r.priority||"medium").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assignee"}),b?e.jsxs("select",{value:F,onChange:t=>_(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.username," (",t.email,")"]},t.id))]}):e.jsx("div",{className:"text-white",children:d!=null&&d.assignee?d.assignee.username:"Unassigned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Due Date"}),b?e.jsx("input",{type:"date",value:S,onChange:t=>M(t.target.value),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"}):e.jsx("div",{className:`text-white ${r.due_date&&new Date(r.due_date)<new Date?"text-red-400":""}`,children:r.due_date?new Date(r.due_date).toLocaleDateString():"Not set"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Created"}),e.jsx("div",{className:"text-gray-300",children:C(r.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Updated"}),e.jsx("div",{className:"text-gray-300",children:C(r.updated_at)})]}),r.resolved_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved At"}),e.jsx("div",{className:"text-gray-300",children:C(r.resolved_at)})]}),te&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Resolved By"}),e.jsx("div",{className:"text-gray-300",children:te.username})]})]}),r.verified_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified At"}),e.jsx("div",{className:"text-gray-300",children:C(r.verified_at)})]}),se&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"Verified By"}),e.jsx("div",{className:"text-gray-300",children:se.username})]})]})]}),r.retest_requested_at&&e.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-200 mb-3",children:"Retest Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Requested At"}),e.jsx("div",{className:"text-indigo-200",children:C(r.retest_requested_at)})]}),r.retest_completed_at?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Completed At"}),e.jsx("div",{className:"text-indigo-200",children:C(r.retest_completed_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Result"}),e.jsx("span",{className:ue(r.retest_result),children:Y(r.retest_result||"")})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-indigo-400 mb-1",children:"Status"}),e.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-yellow-900/50 text-yellow-300",children:"Pending Retest"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes"}),b?e.jsx("textarea",{value:k,onChange:t=>T(t.target.value),rows:4,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about this vulnerability..."}):e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap bg-gray-800 p-3 rounded-md",children:r.notes||"No notes"})]}),(r.jira_ticket_id||r.jira_ticket_key)&&e.jsx("div",{className:"bg-blue-900/30 border border-blue-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-300 mb-1",children:"JIRA Ticket"}),e.jsx("div",{className:"text-blue-200 font-semibold",children:r.jira_ticket_key})]}),r.jira_ticket_url&&e.jsxs("a",{href:r.jira_ticket_url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 inline-flex items-center gap-2",children:["View in JIRA",e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:b?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Q,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:p?"Saving...":"Save Changes"}),e.jsx("button",{onClick:X,disabled:p,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit"}),r.status==="in_progress"&&e.jsx("button",{onClick:le,disabled:p,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-600",children:"Mark for Verification"}),!r.jira_ticket_id&&e.jsx("button",{onClick:de,disabled:K,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-600 inline-flex items-center gap-2",children:K?"Creating...":"Create JIRA Ticket"}),!r.retest_requested_at&&r.status!=="resolved"&&e.jsx("button",{onClick:ne,disabled:p,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-600",children:"Request Retest"}),r.retest_requested_at&&!r.retest_completed_at&&e.jsx("button",{onClick:()=>a(!0),disabled:p,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:"Complete Retest"})]})})]}),h==="remediation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Estimated Effort (hours)"}),b?e.jsx("input",{type:"number",value:J,onChange:t=>H(t.target.value?parseInt(t.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:r.estimated_effort?`${r.estimated_effort} hours`:"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Actual Effort (hours)"}),b?e.jsx("input",{type:"number",value:O,onChange:t=>W(t.target.value?parseInt(t.target.value):""),className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Hours",min:"0"}):e.jsx("div",{className:"text-white",children:r.actual_effort?`${r.actual_effort} hours`:"Not set"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Remediation Steps"}),b?e.jsx("textarea",{value:q,onChange:t=>N(t.target.value),rows:10,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 font-mono text-sm",placeholder:"Enter detailed remediation steps (markdown supported)..."}):e.jsx("div",{className:"bg-gray-800 p-4 rounded-md whitespace-pre-wrap text-gray-300",children:r.remediation_steps||"No remediation steps defined"})]}),b&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Q,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:p?"Saving...":"Save Changes"}),e.jsx("button",{onClick:X,disabled:p,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600",children:"Cancel"})]}),!b&&e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit Remediation"})]}),h==="timeline"&&be()]}),e.jsxs("div",{className:"border-t border-gray-700 p-6 bg-gray-800/50",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Comments"}),e.jsxs("form",{onSubmit:ie,className:"mb-4",children:[e.jsx("textarea",{value:P,onChange:t=>L(t.target.value),rows:3,className:"block w-full rounded-md bg-gray-800 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 mb-2",placeholder:"Add a comment..."}),e.jsx("button",{type:"submit",disabled:p||!P.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-600",children:p?"Adding...":"Add Comment"})]}),e.jsx("div",{className:"space-y-4",children:ee.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No comments yet"}):ee.map(t=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-white",children:t.username}),e.jsx("div",{className:"text-sm text-gray-500",children:C(t.created_at)})]}),e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap",children:t.comment})]},t.id))})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Complete Retest"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Retest Result"}),e.jsxs("select",{value:y,onChange:t=>G(t.target.value),className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"still_vulnerable",children:"Still Vulnerable"}),e.jsx("option",{value:"remediated",children:"Remediated"}),e.jsx("option",{value:"partially_remediated",children:"Partially Remediated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:Z,onChange:t=>I(t.target.value),rows:3,className:"block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Add notes about the retest result..."})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 justify-end",children:[e.jsx("button",{onClick:()=>{a(!1),I(""),G("still_vulnerable")},className:"px-4 py-2 bg-gray-600 text-gray-200 rounded-md hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{onClick:oe,disabled:p,className:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:bg-gray-600",children:p?"Completing...":"Complete Retest"})]})]})})]})},Se=()=>{const[g,D]=i.useState([]),[n,d]=i.useState(),[B,R]=i.useState(null),[c,b]=i.useState(null),[x,h]=i.useState(!0);i.useEffect(()=>{u()},[]),i.useEffect(()=>{n&&j()},[n]);const u=async()=>{try{h(!0);const w=(await pe.getAll()).data.filter(k=>k.status==="completed");D(w),w.length>0&&!n&&d(w[0].id)}catch(o){console.error("Failed to load scans:",o)}finally{h(!1)}},j=async()=>{if(n)try{const o=await v.getStats(n);b(o.data)}catch(o){console.error("Failed to load stats:",o)}},V=o=>{R(o)},A=()=>{R(null)},$=()=>{j()};return e.jsxs(ye,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Remediation Workflow"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Track and manage vulnerability remediation progress with a Kanban-style board"})]}),e.jsxs("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Select Scan"}),e.jsxs("select",{value:n||"",onChange:o=>d(o.target.value||void 0),className:"w-full md:w-96 rounded-md bg-dark-bg border-dark-border text-white shadow-sm focus:border-primary focus:ring-primary",disabled:x,children:[e.jsx("option",{value:"",children:"Select a scan..."}),g.map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",new Date(o.created_at).toLocaleDateString()]},o.id))]})]}),c&&e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg px-4 py-2 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:c.total}),e.jsx("div",{className:"text-xs text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-severity-critical/20 rounded-lg px-4 py-2 text-center border border-severity-critical/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-critical",children:c.open}),e.jsx("div",{className:"text-xs text-slate-400",children:"Open"})]}),e.jsxs("div",{className:"bg-severity-medium/20 rounded-lg px-4 py-2 text-center border border-severity-medium/50",children:[e.jsx("div",{className:"text-2xl font-bold text-severity-medium",children:c.in_progress}),e.jsx("div",{className:"text-xs text-slate-400",children:"In Progress"})]}),e.jsxs("div",{className:"bg-status-completed/20 rounded-lg px-4 py-2 text-center border border-status-completed/50",children:[e.jsx("div",{className:"text-2xl font-bold text-status-completed",children:c.resolved}),e.jsx("div",{className:"text-xs text-slate-400",children:"Resolved"})]})]})]}),c&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"By Severity"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-critical"}),e.jsxs("span",{className:"text-slate-300",children:["Critical: ",c.critical]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-high"}),e.jsxs("span",{className:"text-slate-300",children:["High: ",c.high]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-medium"}),e.jsxs("span",{className:"text-slate-300",children:["Medium: ",c.medium]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-severity-low"}),e.jsxs("span",{className:"text-slate-300",children:["Low: ",c.low]})]})]})]})]}),e.jsx("div",{className:"bg-dark-surface rounded-lg p-6 border border-dark-border",children:x?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):g.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("p",{className:"text-lg mb-2",children:"No completed scans found"}),e.jsx("p",{className:"text-sm",children:"Run a scan with vulnerability detection enabled to see results here"})]}):e.jsx(fe,{scanId:n,onVulnerabilityClick:V})})]}),B&&e.jsx(ve,{vulnerabilityId:B,onClose:A,onUpdate:$})]})};export{Se as default};
