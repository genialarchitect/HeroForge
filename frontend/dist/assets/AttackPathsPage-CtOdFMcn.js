import{j as e}from"./vendor-state-DdX3IZQk.js";import{j as M,u as G,r as c}from"./vendor-react-Da1CiaFS.js";import{B as P,aq as H,bz as V,N as L,aE as D,z as B,Z as U,T as Z,S as z,ax as $,as as K}from"./vendor-ui-ByVwx60L.js";import{q as X,W as C,d as R,L as T,b as v,C as x,B as Y}from"./index-aES0iRGr.js";import"./vendor-charts-PHqIM6EN.js";const J=({nodes:t,edges:o,onNodeClick:p})=>{const m=c.useMemo(()=>{if(t.length===0)return[];const s=t.filter(a=>a.node_type==="entry"),i=t.filter(a=>a.node_type==="pivot"),n=t.filter(a=>a.node_type==="target"),l=60,f=(800-l*2)/3;return t.map(a=>{let g=l,u=0,N=1,h=0;return a.node_type==="entry"?(g=l,N=s.length,h=s.indexOf(a)):a.node_type==="pivot"?(g=l+f,N=i.length,h=i.indexOf(a)):(g=l+f*2,N=n.length,h=n.indexOf(a)),u=N>1?(h-(N-1)/2)*80:0,{...a,x:a.position_x!==0?a.position_x+l:g,y:a.position_y!==0?a.position_y+200:200+u}})},[t]),w=s=>{switch(s){case"entry":return"#22c55e";case"target":return"#ef4444";case"pivot":default:return"#f59e0b"}},j=s=>m.find(i=>i.id===s);return e.jsxs("svg",{viewBox:"0 0 800 400",className:"w-full h-full",style:{minHeight:"300px"},children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#64748b"})})}),o.map(s=>{const i=j(s.source_node_id),n=j(s.target_node_id);return!i||!n?null:e.jsxs("g",{children:[e.jsx("line",{x1:i.x+30,y1:i.y,x2:n.x-30,y2:n.y,stroke:"#64748b",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),s.attack_technique&&e.jsx("text",{x:(i.x+n.x)/2,y:(i.y+n.y)/2-10,fill:"#94a3b8",fontSize:"10",textAnchor:"middle",children:s.technique_id||s.attack_technique.slice(0,20)})]},s.id)}),m.map(s=>{var i;return e.jsxs("g",{className:"cursor-pointer",onClick:()=>p==null?void 0:p(s),children:[e.jsx("circle",{cx:s.x,cy:s.y,r:30,fill:w(s.node_type),fillOpacity:"0.2",stroke:w(s.node_type),strokeWidth:"2"}),e.jsx("text",{x:s.x,y:s.y-5,fill:"white",fontSize:"11",textAnchor:"middle",fontWeight:"bold",children:s.service||((i=s.host_ip)==null?void 0:i.split(".").slice(-1)[0])||"?"}),e.jsx("text",{x:s.x,y:s.y+10,fill:"#94a3b8",fontSize:"9",textAnchor:"middle",children:s.port?`:${s.port}`:s.node_type}),s.vulnerability_ids.length>0&&e.jsx("circle",{cx:s.x+30-5,cy:s.y-30+5,r:"10",fill:"#ef4444"}),s.vulnerability_ids.length>0&&e.jsx("text",{x:s.x+30-5,y:s.y-30+9,fill:"white",fontSize:"9",textAnchor:"middle",children:s.vulnerability_ids.length})]},s.id)}),e.jsxs("g",{transform:"translate(680, 20)",children:[e.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"#22c55e",fillOpacity:"0.3",stroke:"#22c55e"}),e.jsx("text",{x:"25",y:"14",fill:"#94a3b8",fontSize:"10",children:"Entry"}),e.jsx("circle",{cx:"10",cy:"30",r:"8",fill:"#f59e0b",fillOpacity:"0.3",stroke:"#f59e0b"}),e.jsx("text",{x:"25",y:"34",fill:"#94a3b8",fontSize:"10",children:"Pivot"}),e.jsx("circle",{cx:"10",cy:"50",r:"8",fill:"#ef4444",fillOpacity:"0.3",stroke:"#ef4444"}),e.jsx("text",{x:"25",y:"54",fill:"#94a3b8",fontSize:"10",children:"Target"})]})]})},q=({level:t})=>{const o={critical:"critical",high:"high",medium:"medium",low:"low"};return e.jsx(Y,{type:o[t],children:t.toUpperCase()})},Q=({path:t,isSelected:o,onClick:p})=>e.jsxs("div",{className:`p-4 rounded-lg border cursor-pointer transition-all ${o?"border-primary bg-primary/10":"border-dark-border bg-dark-card hover:border-slate-600"}`,onClick:p,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-white font-medium",children:t.name||`Path ${t.id.slice(0,8)}`})]}),e.jsx(q,{level:t.risk_level})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Length:"})," ",e.jsxs("span",{className:"text-white",children:[t.path_length," nodes"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"CVSS:"})," ",e.jsx("span",{className:"text-white",children:t.total_cvss.toFixed(1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Probability:"})," ",e.jsxs("span",{className:"text-white",children:[(t.probability*100).toFixed(0),"%"]})]})]})]}),ie=()=>{var W;const{scanId:t}=M(),o=G(),[p,_]=c.useState(!0),[y,S]=c.useState(!1),[m,w]=c.useState(null),[j,s]=c.useState([]),[i,n]=c.useState(null),[l,f]=c.useState(null),[a,g]=c.useState(null),[u,N]=c.useState(!1),[h,A]=c.useState(!1),F=c.useCallback(async()=>{if(t){_(!0);try{const r=await X.getById(t);w(r.data);try{const d=await C.getByScan(t);s(d.data.paths),n(d.data.stats),A(d.data.paths.length>0),d.data.paths.length>0&&f(d.data.paths[0])}catch{s([]),n(null),A(!1)}}catch(r){P.error("Failed to load scan data"),console.error(r)}finally{_(!1)}}},[t]);c.useEffect(()=>{F()},[F]);const O=async(r=!1)=>{var d,E;if(t){S(!0);try{const k=await C.analyze(t,{force:r});P.success(k.data.message);const b=await C.getByScan(t);s(b.data.paths),n(b.data.stats),A(!0),b.data.paths.length>0&&f(b.data.paths[0])}catch(k){const b=k;P.error(((E=(d=b.response)==null?void 0:d.data)==null?void 0:E.error)||"Analysis failed"),console.error(k)}finally{S(!1)}}},I=c.useMemo(()=>u?j.filter(r=>r.risk_level==="critical"||r.risk_level==="high"):j,[j,u]);return p?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(T,{})})}):m?e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(v,{variant:"secondary",onClick:()=>o(`/dashboard/${t}`),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to Scan"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(L,{className:"h-6 w-6 text-primary"}),"Attack Path Analysis"]}),e.jsxs("p",{className:"text-slate-400",children:["Scan: ",m.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsx(v,{variant:"secondary",onClick:()=>N(!u),children:u?"Show All":"Critical Only"}),e.jsx(v,{onClick:()=>O(h),disabled:y||m.status!=="completed",children:y?e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("span",{className:"ml-2",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),h?"Re-analyze":"Analyze"]})})]})]}),i&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:i.total_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(H,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:i.critical_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"Critical Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500/20 rounded-lg",children:e.jsx(U,{className:"h-5 w-5 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:i.high_paths}),e.jsx("p",{className:"text-xs text-slate-400",children:"High Risk Paths"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(Z,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:i.total_nodes}),e.jsx("p",{className:"text-xs text-slate-400",children:"Total Nodes"})]})]})}),e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(z,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:((W=i.avg_path_length)==null?void 0:W.toFixed(1))||"N/A"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Avg Path Length"})]})]})})]}),h?j.length===0?e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(z,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Attack Paths Found"}),e.jsx("p",{className:"text-slate-400 max-w-md mx-auto",children:"The analysis did not identify any significant attack paths. This could mean the network is well-segmented or there are no vulnerable services that could be chained together."})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-3",children:["Attack Paths (",I.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto pr-2",children:I.map(r=>e.jsx(Q,{path:r,isSelected:(l==null?void 0:l.id)===r.id,onClick:()=>{f(r),g(null)}},r.id))})]}),e.jsx("div",{className:"lg:col-span-2",children:l?e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:l.name||`Path ${l.id.slice(0,8)}`}),e.jsx(q,{level:l.risk_level})]}),e.jsx("div",{className:"bg-dark-bg rounded-lg border border-dark-border p-4 mb-4",children:e.jsx(J,{nodes:l.nodes,edges:l.edges,onNodeClick:g})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Path Length"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[l.path_length," nodes"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Total CVSS"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:l.total_cvss.toFixed(1)})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Probability"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[(l.probability*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Nodes"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:l.nodes.length})]})]}),a&&e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 mb-4 border border-dark-border",children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Node Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"IP:"})," ",e.jsx("span",{className:"text-white",children:a.host_ip||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Port:"})," ",e.jsx("span",{className:"text-white",children:a.port||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Service:"})," ",e.jsx("span",{className:"text-white",children:a.service||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Type:"})," ",e.jsx("span",{className:"text-white capitalize",children:a.node_type})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"Vulnerabilities:"})," ",e.jsx("span",{className:"text-white",children:a.vulnerability_ids.length>0?a.vulnerability_ids.join(", "):"None"})]})]})]}),l.mitigation_steps.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-green-400"}),"Recommended Mitigations"]}),e.jsx("ul",{className:"space-y-2",children:l.mitigation_steps.map((r,d)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-300",children:[e.jsx(K,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),r]},d))})]})]}):e.jsx(x,{className:"p-8 text-center",children:e.jsx("p",{className:"text-slate-400",children:"Select an attack path from the list to view details"})})})]}):e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(L,{className:"h-16 w-16 text-slate-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Attack Paths Analyzed"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:'Click the "Analyze" button to identify potential attack paths in your scan results. The analysis will build a graph of hosts and vulnerabilities to find possible attack chains.'}),m.status!=="completed"&&e.jsx("p",{className:"text-yellow-500 text-sm mb-4",children:"Note: The scan must be completed before analysis."}),e.jsx(v,{onClick:()=>O(!1),disabled:y||m.status!=="completed",className:"mx-auto",children:y?e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("span",{className:"ml-2",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Analyze Attack Paths"]})})]}),e.jsx(x,{className:"bg-blue-500/10 border-blue-500/30",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx($,{className:"h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-400 mb-2",children:"About Attack Path Analysis"}),e.jsx("p",{className:"text-sm text-slate-300 mb-2",children:"Attack path analysis identifies potential chains of vulnerabilities and misconfigurations that an attacker could exploit to move through your network. The analysis:"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-1 list-disc list-inside ml-4",children:[e.jsx("li",{children:"Builds a graph from discovered hosts, services, and vulnerabilities"}),e.jsx("li",{children:"Identifies entry points, pivot points, and target systems"}),e.jsx("li",{children:"Calculates risk scores based on CVSS, exploitability, and impact"}),e.jsx("li",{children:"Maps techniques to MITRE ATT&CK framework where applicable"}),e.jsx("li",{children:"Provides prioritized mitigation recommendations"})]})]})]})})]})}):e.jsx(R,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Scan Not Found"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"The requested scan could not be found."}),e.jsx(v,{onClick:()=>o("/dashboard"),children:"Go to Dashboard"})]})})};export{ie as default};
