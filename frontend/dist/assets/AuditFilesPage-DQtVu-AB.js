import{b as U,u as _,d as D,j as e}from"./vendor-state-BjT_zREg.js";import{r as o}from"./vendor-react-5KxtEOLM.js";import{B as v,a1 as q,b1 as A,y as M,F as I,bK as $,a6 as R,aN as P,X as K,at as B,a$ as V,U as E,ay as Q,p as H,S as O,bg as X}from"./vendor-ui-CaTPr3iI.js";import{M as c}from"./index-BgPDfr41.js";import{L as Y}from"./Layout-DF6EApG0.js";import{A as G}from"./AcasNavigation-Di6tGQ3Z.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const p={listFiles:s=>c.get("/api/audit-files",{params:s}).then(t=>t.data),getFile:s=>c.get(`/api/audit-files/${s}`).then(t=>t.data),downloadFile:s=>c.get(`/api/audit-files/${s}/download`,{responseType:"blob"}).then(t=>t.data),getVersionHistory:s=>c.get(`/api/audit-files/${s}/versions`).then(t=>t.data),getCustodyChain:s=>c.get(`/api/audit-files/${s}/custody`).then(t=>t.data),archiveFile:s=>c.post(`/api/audit-files/${s}/archive`).then(t=>t.data),restoreFile:s=>c.post(`/api/audit-files/${s}/restore`).then(t=>t.data),generateCkl:s=>c.post("/api/audit-files/generate/ckl",s).then(t=>t.data),generateArf:s=>c.post("/api/audit-files/generate/arf",s).then(t=>t.data),importCkl:s=>c.post("/api/audit-files/import/ckl",s).then(t=>t.data),importArf:s=>c.post("/api/audit-files/import/arf",s).then(t=>t.data),listRetentionPolicies:()=>c.get("/api/audit-files/retention-policies").then(s=>s.data)},T=({type:s})=>{const t={ckl:"bg-green-900/50 text-green-400",arf:"bg-purple-900/50 text-purple-400",xccdf:"bg-cyan-900/50 text-cyan-400",oval:"bg-amber-900/50 text-amber-400"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs uppercase font-medium ${t[s]||"bg-gray-700"}`,children:s})},w=s=>s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`,J=({isOpen:s,onClose:t,fileType:d,onSuccess:m})=>{const[i,l]=o.useState(null),[j,y]=o.useState(""),[x,r]=o.useState(!1),N=o.useRef(null),h=async()=>{var n,g;if(i){r(!0);try{const b=await i.text(),f=btoa(b);await(d==="ckl"?p.importCkl:p.importArf)({filename:i.name,content:f,system_id:j||void 0}),v.success(`${d.toUpperCase()} file imported successfully`),m(),t(),l(null),y("")}catch(b){v.error(((g=(n=b.response)==null?void 0:n.data)==null?void 0:g.error)||"Import failed")}finally{r(!1)}}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-100",children:["Import ",d.toUpperCase()," File"]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-200",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:N,type:"file",accept:".ckl,.xml",onChange:n=>{var g;return l(((g=n.target.files)==null?void 0:g[0])||null)},className:"hidden"}),e.jsxs("button",{onClick:()=>{var n;return(n=N.current)==null?void 0:n.click()},className:"flex flex-col items-center w-full",children:[e.jsx(A,{className:"w-12 h-12 mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-400",children:i?i.name:`Click to select ${d.toUpperCase()} file`}),i&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:w(i.size)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"System ID (optional)"}),e.jsx("input",{type:"text",value:j,onChange:n=>y(n.target.value),placeholder:"e.g., SYS-001",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:!i||x,className:"px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-500 disabled:opacity-50",children:x?"Importing...":"Import"})]})]})]})}):null},W=({file:s,onClose:t,onDownload:d,onArchive:m,onRestore:i})=>{const[l,j]=o.useState("info"),{data:y=[]}=_({queryKey:["audit-file-versions",s==null?void 0:s.id],queryFn:()=>s?p.getVersionHistory(s.id):Promise.resolve([]),enabled:!!s&&l==="versions"}),{data:x=[]}=_({queryKey:["audit-file-custody",s==null?void 0:s.id],queryFn:()=>s?p.getCustodyChain(s.id):Promise.resolve([]),enabled:!!s&&l==="custody"});return s?e.jsxs("div",{className:"fixed inset-y-0 right-0 w-96 bg-gray-800 border-l border-gray-700 shadow-xl z-40 overflow-y-auto",children:[e.jsx("div",{className:"p-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:"File Details"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-200",children:e.jsx(K,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{type:s.file_type}),e.jsx("span",{className:"text-gray-200 font-medium truncate",children:s.filename})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(s.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",children:[e.jsx(R,{className:"w-4 h-4"}),"Download"]}),s.is_archived?e.jsxs("button",{onClick:()=>i(s.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-green-600/20 text-green-400 rounded hover:bg-green-600/30",children:[e.jsx(B,{className:"w-4 h-4"}),"Restore"]}):e.jsxs("button",{onClick:()=>m(s.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-amber-600/20 text-amber-400 rounded hover:bg-amber-600/30",children:[e.jsx($,{className:"w-4 h-4"}),"Archive"]})]}),e.jsx("div",{className:"flex border-b border-gray-700",children:["info","versions","custody"].map(r=>e.jsx("button",{onClick:()=>j(r),className:`px-4 py-2 text-sm capitalize ${l===r?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-gray-200"}`,children:r},r))}),l==="info"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{icon:e.jsx(V,{}),label:"SHA-256",value:s.sha256_hash.substring(0,16)+"..."}),e.jsx(u,{icon:e.jsx(I,{}),label:"Size",value:w(s.file_size)}),e.jsx(u,{icon:e.jsx(E,{}),label:"Created By",value:s.created_by}),e.jsx(u,{icon:e.jsx(Q,{}),label:"Created",value:new Date(s.created_at).toLocaleString()}),e.jsx(u,{icon:e.jsx(H,{}),label:"Version",value:`v${s.version}`}),s.framework&&e.jsx(u,{icon:e.jsx(O,{}),label:"Framework",value:s.framework}),s.system_id&&e.jsx(u,{icon:e.jsx(X,{}),label:"System ID",value:s.system_id}),s.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-400 block mb-1",children:"Notes"}),e.jsx("p",{className:"text-gray-200 text-sm bg-gray-700 p-2 rounded",children:s.notes})]})]}),l==="versions"&&e.jsx("div",{className:"space-y-2",children:y.length===0?e.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"No version history"}):y.map(r=>e.jsxs("div",{className:"p-3 bg-gray-700 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-200 font-medium",children:["v",r.version]}),e.jsx("span",{className:"text-gray-400 text-sm",children:new Date(r.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[w(r.file_size)," - ",r.created_by]}),r.change_notes&&e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:r.change_notes})]},r.id))}),l==="custody"&&e.jsx("div",{className:"space-y-2",children:x.length===0?e.jsx("p",{className:"text-gray-400 text-sm text-center py-4",children:"No custody events"}):x.map(r=>e.jsxs("div",{className:"p-3 bg-gray-700 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-200 capitalize",children:r.event_type}),e.jsx("span",{className:"text-gray-400 text-sm",children:new Date(r.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:["By: ",r.actor,r.ip_address&&` from ${r.ip_address}`]}),r.description&&e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:r.description})]},r.id))})]})]}):null},u=({icon:s,label:t,value:d})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-gray-400 w-5 h-5",children:s}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:t}),e.jsx("div",{className:"text-sm text-gray-200",children:d})]})]}),ce=()=>{const s=U(),[t,d]=o.useState(""),[m,i]=o.useState(""),[l,j]=o.useState(!1),[y,x]=o.useState(null),[r,N]=o.useState(null),{data:h=[],isLoading:n}=_({queryKey:["audit-files",m,l],queryFn:()=>p.listFiles({...m&&{file_type:m},include_archived:l?"true":"false"})}),g=D({mutationFn:p.archiveFile,onSuccess:()=>{s.invalidateQueries({queryKey:["audit-files"]}),v.success("File archived")}}),b=D({mutationFn:p.restoreFile,onSuccess:()=>{s.invalidateQueries({queryKey:["audit-files"]}),v.success("File restored")}}),f=async a=>{try{const F=await p.downloadFile(a),k=h.find(z=>z.id===a),L=window.URL.createObjectURL(F),S=document.createElement("a");S.href=L,S.download=(k==null?void 0:k.filename)||`audit_file_${a}`,S.click(),window.URL.revokeObjectURL(L)}catch{v.error("Failed to download file")}},C=h.filter(a=>a.filename.toLowerCase().includes(t.toLowerCase()));return e.jsx(Y,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-8 h-8 text-cyan-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-100",children:"Audit File Library"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Manage CKL, ARF, and SCAP audit files with chain of custody tracking"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N("ckl"),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500",children:[e.jsx(A,{className:"w-4 h-4"}),"Import CKL"]}),e.jsxs("button",{onClick:()=>N("arf"),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-500",children:[e.jsx(A,{className:"w-4 h-4"}),"Import ARF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-100",children:h.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Files"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:h.filter(a=>a.file_type==="ckl").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"CKL Files"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:h.filter(a=>a.file_type==="arf").length}),e.jsx("div",{className:"text-sm text-gray-400",children:"ARF Files"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:h.filter(a=>a.is_archived).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Archived"})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:t,onChange:a=>d(a.target.value),placeholder:"Search files...",className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded text-gray-200 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("select",{value:m,onChange:a=>i(a.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded text-gray-200 focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"ckl",children:"CKL"}),e.jsx("option",{value:"arf",children:"ARF"}),e.jsx("option",{value:"xccdf",children:"XCCDF"}),e.jsx("option",{value:"oval",children:"OVAL"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:a=>j(a.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-gray-700"}),"Show Archived"]})]}),n?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading..."}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"w-12 h-12 mx-auto mb-4 text-gray-600"}),e.jsx("p",{className:"text-gray-400",children:"No audit files found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Import CKL or ARF files to get started"})]}):e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"File"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"System"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Created"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm text-gray-400",children:"Version"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:C.map(a=>e.jsxs("tr",{className:`hover:bg-gray-700/50 cursor-pointer ${a.is_archived?"opacity-60":""}`,onClick:()=>x(a),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.is_archived&&e.jsx($,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-gray-200",children:a.filename})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(T,{type:a.file_type})}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:w(a.file_size)}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:a.system_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(a.created_at).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-gray-400",children:["v",a.version]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",onClick:F=>F.stopPropagation(),children:[e.jsx("button",{onClick:()=>f(a.id),className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"Download",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(a),className:"p-2 text-gray-400 hover:text-cyan-400 rounded",title:"View Details",children:e.jsx(P,{className:"w-4 h-4"})})]})})]},a.id))})]})}),e.jsx(W,{file:y,onClose:()=>x(null),onDownload:f,onArchive:a=>g.mutate(a),onRestore:a=>b.mutate(a)}),r&&e.jsx(J,{isOpen:!0,onClose:()=>N(null),fileType:r,onSuccess:()=>s.invalidateQueries({queryKey:["audit-files"]})})]})})};export{ce as default};
