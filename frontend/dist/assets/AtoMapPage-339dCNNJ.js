import{j as e}from"./vendor-state-GQ86PG8z.js";import{r as f}from"./vendor-react-5KxtEOLM.js";import{S as U,aT as J,a6 as he,l as V,a7 as K,br as Q,bs as ue,F as ge,bt as be,U as je,v as X,at as Ne,ax as ee,B as I,_ as te,X as se,z as ye,bu as _,k as ve,bv as fe,C as Y,a9 as Ce,bn as we,O as Se,i as Ae,g as Ie}from"./vendor-ui-B4zQTbMA.js";import{L as B}from"./Layout-DjSyneCz.js";import{C as R}from"./Card-CdUZgaxw.js";import{B as M,L as ae}from"./index-DXyI7EZp.js";import{L as q}from"./LoadingSpinner--aI8dJBd.js";import"./Header-Syz3QTqA.js";import"./vendor-markdown-BzaehZQJ.js";import"./vendor-utils-DfRopTPV.js";const Z=[{id:"AC",name:"Access Control",abbreviation:"AC"},{id:"AT",name:"Awareness and Training",abbreviation:"AT"},{id:"AU",name:"Audit and Accountability",abbreviation:"AU"},{id:"CA",name:"Assessment, Authorization, and Monitoring",abbreviation:"CA"},{id:"CM",name:"Configuration Management",abbreviation:"CM"},{id:"CP",name:"Contingency Planning",abbreviation:"CP"},{id:"IA",name:"Identification and Authentication",abbreviation:"IA"},{id:"IR",name:"Incident Response",abbreviation:"IR"},{id:"MA",name:"Maintenance",abbreviation:"MA"},{id:"MP",name:"Media Protection",abbreviation:"MP"},{id:"PE",name:"Physical and Environmental Protection",abbreviation:"PE"},{id:"PL",name:"Planning",abbreviation:"PL"},{id:"PM",name:"Program Management",abbreviation:"PM"},{id:"PS",name:"Personnel Security",abbreviation:"PS"},{id:"PT",name:"PII Processing and Transparency",abbreviation:"PT"},{id:"RA",name:"Risk Assessment",abbreviation:"RA"},{id:"SA",name:"System and Services Acquisition",abbreviation:"SA"},{id:"SC",name:"System and Communications Protection",abbreviation:"SC"},{id:"SI",name:"System and Information Integrity",abbreviation:"SI"},{id:"SR",name:"Supply Chain Risk Management",abbreviation:"SR"}],ke=n=>{switch(n){case"Compliant":return e.jsx(Ie,{className:"w-4 h-4 text-green-400"});case"NonCompliant":return e.jsx(Ae,{className:"w-4 h-4 text-red-400"});case"PartiallyCompliant":return e.jsx(Se,{className:"w-4 h-4 text-yellow-400"});case"NotApplicable":return e.jsx(we,{className:"w-4 h-4 text-gray-400"});case"NotAssessed":return e.jsx(Y,{className:"w-4 h-4 text-blue-400"});case"ManualOverride":return e.jsx(Ce,{className:"w-4 h-4 text-purple-400"});default:return e.jsx(Y,{className:"w-4 h-4 text-gray-400"})}},z=n=>{let d=0,t=0,a=0,o=0,c=0,x=0;const N=j=>{switch(x++,j.status){case"Compliant":d++;break;case"NonCompliant":t++;break;case"PartiallyCompliant":a++;break;case"NotAssessed":o++;break;case"NotApplicable":c++;break}j.children&&j.children.forEach(N)};return n.forEach(N),{compliantCount:d,nonCompliantCount:t,partialCount:a,notAssessedCount:o,notApplicableCount:c,total:x}},G=n=>z(n),W=n=>{let d=0,t=0,a=0;return n.forEach(o=>{const c=z(o.controls),x=c.total-c.notApplicableCount-c.notAssessedCount;d+=x,t+=c.compliantCount,a+=c.partialCount}),d===0?0:Math.round((t+a*.5)/d*100)},H=()=>{const n=Z.map((a,o)=>{const c=Math.floor(Math.random()*10)+5,x=[];for(let j=1;j<=c;j++){const w=Math.random();let S;w<.5?S="Compliant":w<.65?S="PartiallyCompliant":w<.75?S="NonCompliant":w<.85?S="NotAssessed":S="NotApplicable";const C=Math.random()<.4?Math.floor(Math.random()*3)+1:0,i=[];for(let g=1;g<=C;g++){const O=Math.random();let r;O<.5?r="Compliant":O<.65?r="PartiallyCompliant":O<.75?r="NonCompliant":O<.85?r="NotAssessed":r="NotApplicable",i.push({id:`${a.id}-${j}(${g})`,controlId:`${a.abbreviation}-${j}(${g})`,title:`${a.name} Control ${j} Enhancement ${g}`,status:r,evidenceCount:r==="Compliant"?Math.floor(Math.random()*3)+1:0,poamId:r==="NonCompliant"?`POA&M-${Math.floor(Math.random()*100)+1}`:void 0,lastAssessed:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString().split("T")[0],parentId:`${a.id}-${j}`})}x.push({id:`${a.id}-${j}`,controlId:`${a.abbreviation}-${j}`,title:`${a.name} Control ${j}`,status:S,evidenceCount:S==="Compliant"?Math.floor(Math.random()*5)+1:0,poamId:S==="NonCompliant"?`POA&M-${Math.floor(Math.random()*100)+1}`:void 0,lastAssessed:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString().split("T")[0],children:i.length>0?i:void 0})}const N=G(x);return{id:a.id,name:a.name,abbreviation:a.abbreviation,controls:x,order:o,...N}}),d=a=>{let o=0;return a.forEach(c=>{c.poamId&&o++,c.children&&(o+=d(c.children))}),o},t=n.reduce((a,o)=>a+d(o.controls),0);return{systemName:"Sample Information System",systemId:"SYS-2024-001",organization:"Sample Organization",authorizingOfficial:"Jane Smith, CISO",assessmentDate:new Date().toISOString().split("T")[0],targetAtoDate:new Date(Date.now()+2160*60*60*1e3).toISOString().split("T")[0],baseline:"Moderate",framework:"NIST 800-53 Rev 5",controlFamilies:n,overallScore:W(n),poamCount:t}},ne=({control:n,depth:d,expandedControls:t,onToggleControl:a,onEditControl:o})=>{const c=n.children&&n.children.length>0,x=t.has(n.id);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`border-t border-gray-700 ${d>0?"bg-gray-800/50":""}`,children:[e.jsx("td",{className:"py-2",style:{paddingLeft:`${d*24+8}px`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx("button",{onClick:()=>a(n.id),className:"p-0.5 hover:bg-gray-700 rounded",children:x?e.jsx(V,{className:"w-4 h-4 text-gray-400"}):e.jsx(te,{className:"w-4 h-4 text-gray-400"})}):e.jsx("span",{className:"w-5"}),e.jsx("span",{className:"font-mono text-cyan-400",children:n.controlId})]})}),e.jsx("td",{className:"py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[ke(n.status),e.jsx("span",{className:"text-gray-300",children:n.status})]})}),e.jsx("td",{className:"py-2 text-gray-400",children:n.evidenceCount>0?`${n.evidenceCount} items`:"-"}),e.jsx("td",{className:"py-2",children:n.poamId?e.jsx("span",{className:"text-red-400 font-mono",children:n.poamId}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"py-2 text-gray-400",children:n.lastAssessed||"-"}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>o(n),className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-cyan-400",title:"Edit control",children:e.jsx(fe,{className:"w-4 h-4"})})})]}),c&&x&&n.children.map(N=>e.jsx(ne,{control:N,depth:d+1,expandedControls:t,onToggleControl:a,onEditControl:o},N.id))]})},Me=({family:n,expanded:d,onToggle:t,expandedControls:a,onToggleControl:o,onEditControl:c,isDragging:x,onDragStart:N,onDragOver:j,onDrop:w,onDragEnd:S})=>{const C=z(n.controls),i=C.total,g=i>0?C.compliantCount/i*100:0,O=i>0?C.partialCount/i*100:0,r=i>0?C.nonCompliantCount/i*100:0,y=i>0?C.notAssessedCount/i*100:0,P=i>0?C.notApplicableCount/i*100:0;return e.jsxs("div",{className:`bg-gray-800 rounded-lg border border-gray-700 overflow-hidden print:break-inside-avoid transition-all ${x?"opacity-50 border-cyan-500":""}`,draggable:!0,onDragStart:v=>N(v,n.id),onDragOver:j,onDrop:v=>w(v,n.id),onDragEnd:S,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"px-2 py-4 cursor-grab active:cursor-grabbing hover:bg-gray-700 print:hidden",title:"Drag to reorder",children:e.jsx(ee,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("button",{onClick:t,className:"flex-1 p-4 flex items-center justify-between hover:bg-gray-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-700 flex items-center justify-center font-bold text-cyan-400",children:n.abbreviation}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-white",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:[i," controls"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 rounded bg-green-500/20 text-green-400",children:C.compliantCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-yellow-500/20 text-yellow-400",children:C.partialCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-red-500/20 text-red-400",children:C.nonCompliantCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-blue-500/20 text-blue-400",children:C.notAssessedCount})]}),d?e.jsx(V,{className:"w-5 h-5 text-gray-400"}):e.jsx(te,{className:"w-5 h-5 text-gray-400"})]})]})]}),e.jsxs("div",{className:"h-2 flex",children:[e.jsx("div",{className:"bg-green-500",style:{width:`${g}%`}}),e.jsx("div",{className:"bg-yellow-500",style:{width:`${O}%`}}),e.jsx("div",{className:"bg-red-500",style:{width:`${r}%`}}),e.jsx("div",{className:"bg-blue-500",style:{width:`${y}%`}}),e.jsx("div",{className:"bg-gray-500",style:{width:`${P}%`}})]}),d&&e.jsx("div",{className:"p-4 border-t border-gray-700 bg-gray-850",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 text-left",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Control"}),e.jsx("th",{className:"pb-2 font-medium",children:"Status"}),e.jsx("th",{className:"pb-2 font-medium",children:"Evidence"}),e.jsx("th",{className:"pb-2 font-medium",children:"POA&M"}),e.jsx("th",{className:"pb-2 font-medium",children:"Last Assessed"}),e.jsx("th",{className:"pb-2 font-medium w-10"})]})}),e.jsx("tbody",{children:n.controls.map(v=>e.jsx(ne,{control:v,depth:0,expandedControls:a,onToggleControl:o,onEditControl:c},v.id))})]})})]})},Oe=({control:n,onClose:d,onSave:t})=>{const[a,o]=f.useState(n);if(f.useEffect(()=>{o(n)},[n]),!n||!a)return null;const c=()=>{t(a),d()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:hidden",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Control"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-white",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Control ID"}),e.jsx("div",{className:"text-white font-mono",children:a.controlId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:a.status,onChange:x=>o({...a,status:x.target.value}),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white",children:[e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"PartiallyCompliant",children:"Partially Compliant"}),e.jsx("option",{value:"NonCompliant",children:"Non-Compliant"}),e.jsx("option",{value:"NotAssessed",children:"Not Assessed"}),e.jsx("option",{value:"NotApplicable",children:"Not Applicable"}),e.jsx("option",{value:"ManualOverride",children:"Manual Override"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Evidence Count"}),e.jsx("input",{type:"number",min:"0",value:a.evidenceCount,onChange:x=>o({...a,evidenceCount:parseInt(x.target.value)||0}),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"POA&M ID"}),e.jsx("input",{type:"text",value:a.poamId||"",onChange:x=>o({...a,poamId:x.target.value||void 0}),placeholder:"e.g., POA&M-001",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes||"",onChange:x=>o({...a,notes:x.target.value||void 0}),placeholder:"Assessment notes...",rows:3,className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assessor"}),e.jsx("input",{type:"text",value:a.assessor||"",onChange:x=>o({...a,assessor:x.target.value||void 0}),placeholder:"Assessor name",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:[e.jsx(M,{variant:"secondary",onClick:d,children:"Cancel"}),e.jsxs(M,{onClick:c,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})})},Pe=({atoData:n,onAction:d})=>{const[t,a]=f.useState(!1),[o,c]=f.useState(""),[x,N]=f.useState([]),[j,w]=f.useState(!1),S=async()=>{if(!o.trim()||!n)return;const i=o;c(""),N(g=>[...g,{role:"user",content:i}]),w(!0);try{const g=await ae.post("/api/ato-map/zeus",{prompt:i,context:{systemName:n.systemName,overallScore:n.overallScore,poamCount:n.poamCount,families:n.controlFamilies.map(r=>({id:r.id,name:r.name,stats:z(r.controls)}))}}),O=g.data.message||"Action completed.";N(r=>[...r,{role:"assistant",content:O}]),g.data.action&&(d(g.data.action),I.success("Zeus action applied"))}catch(g){console.error("Zeus error:",g);const O=g instanceof Error?g.message:"Unknown error";N(r=>[...r,{role:"assistant",content:`I encountered an error processing your request. You can still use me to help analyze the ATO data or suggest actions. Error: ${O}`}])}finally{w(!1)}},C=[{label:"Analyze gaps",prompt:"What are the main compliance gaps in this ATO assessment?"},{label:"Prioritize POA&Ms",prompt:"Help me prioritize the POA&M items by risk."},{label:"Generate summary",prompt:"Generate an executive summary of the current ATO status."},{label:"Recommend actions",prompt:"What controls should I focus on to improve the overall score?"}];return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-6 right-6 p-4 bg-purple-600 hover:bg-purple-500 rounded-full shadow-lg z-40 print:hidden transition-colors",title:"Ask Zeus AI Assistant",children:e.jsx(_,{className:"w-6 h-6 text-white"})}),t&&e.jsxs("div",{className:"fixed bottom-6 right-6 w-96 bg-gray-800 rounded-lg shadow-xl border border-gray-700 z-50 print:hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Zeus AI Assistant"})]}),e.jsx("button",{onClick:()=>a(!1),className:"text-gray-400 hover:text-white",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"h-64 overflow-y-auto p-4 space-y-3",children:[x.length===0&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-2 text-purple-400/50"}),e.jsx("p",{className:"text-sm",children:"Ask me about your ATO assessment or use quick actions below."})]}),x.map((i,g)=>e.jsx("div",{className:`p-3 rounded-lg ${i.role==="user"?"bg-cyan-500/20 text-cyan-100 ml-8":"bg-gray-700 text-gray-100 mr-8"}`,children:i.content},g)),j&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(q,{}),e.jsx("span",{className:"text-sm",children:"Zeus is thinking..."})]})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-700",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:C.map((i,g)=>e.jsx("button",{onClick:()=>c(i.prompt),className:"px-2 py-1 text-xs bg-gray-700 hover:bg-gray-600 rounded text-gray-300",children:i.label},g))})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:i=>c(i.target.value),onKeyDown:i=>i.key==="Enter"&&S(),placeholder:"Ask Zeus...",className:"flex-1 p-2 bg-gray-900 border border-gray-600 rounded-lg text-white text-sm",disabled:j}),e.jsx(M,{onClick:S,disabled:j||!o.trim(),children:e.jsx(ve,{className:"w-4 h-4"})})]})})]})]})},Ee=({isOpen:n,onClose:d,onImport:t})=>{const[a,o]=f.useState("heroforge"),[c,x]=f.useState(""),[N,j]=f.useState(!1),w=f.useRef(null);if(!n)return null;const S=async r=>{var P;const y=(P=r.target.files)==null?void 0:P[0];if(y){j(!0);try{const v=await y.text();if(a==="json"){const m=JSON.parse(v),A=g(m);t(A),I.success("ATO Map data imported successfully"),d()}else if(a==="csv"){const m=O(v);t(m),I.success("CSV data imported successfully"),d()}}catch(v){console.error("Import error:",v),I.error("Failed to import data. Please check the file format.")}finally{j(!1)}}},C=()=>{try{const r=JSON.parse(c),y=g(r);t(y),I.success("ATO Map data imported successfully"),d()}catch(r){console.error("JSON parse error:",r),I.error("Invalid JSON format")}},i=async()=>{j(!0);try{const r=await ae.get("/api/ato-map");if(r.data&&r.data.controlFamilies)t(r.data),I.success("Loaded compliance data from HeroForge"),d();else{const y=H();t(y),I.success("Loaded sample compliance data"),d()}}catch(r){console.error("Load error:",r);const y=H();t(y),I.info("Loaded sample data (API not available)"),d()}finally{j(!1)}},g=r=>{const y=new Map,P=new Map;Z.forEach(m=>y.set(m.id,[])),r.controls.forEach(m=>{const A=m.controlId,b=A.split("-")[0].toUpperCase(),E={id:A,controlId:A,title:`Control ${A}`,status:m.status||"NotAssessed",evidenceCount:m.evidenceCount||0,poamId:m.poamId,notes:m.notes,parentId:m.parentId},L=A.match(/^([A-Z]+-\d+)\(\d+\)$/);if(L||m.parentId){const T=m.parentId||L[1];P.has(T)||P.set(T,[]),P.get(T).push(E)}else y.has(b)&&y.get(b).push(E)}),y.forEach(m=>{m.forEach(A=>{const b=P.get(A.controlId);b&&b.length>0&&(A.children=b)})});const v=Z.map((m,A)=>{const b=y.get(m.id)||[],E=G(b);return{id:m.id,name:m.name,abbreviation:m.abbreviation,controls:b,order:A,...E}}).filter(m=>m.controls.length>0);return{systemName:r.systemName||"Imported System",organization:r.organization,baseline:r.baseline||"Moderate",framework:"NIST 800-53 Rev 5",controlFamilies:v,overallScore:W(v),poamCount:v.reduce((m,A)=>{let b=0;const E=L=>{L.forEach(T=>{T.poamId&&b++,T.children&&E(T.children)})};return E(A.controls),m+b},0)}},O=r=>{const y=r.trim().split(`
`),P=y[0].split(",").map(m=>m.trim().toLowerCase()),v=[];for(let m=1;m<y.length;m++){const A=y[m].split(",").map(E=>E.trim()),b={};P.forEach((E,L)=>{b[E]=A[L]||""}),v.push({controlId:b.control_id||b.controlid||b.control||"",status:b.status||"NotAssessed",evidenceCount:parseInt(b.evidence_count||b.evidence||"0",10),poamId:b.poam_id||b.poam||void 0,notes:b.notes||void 0,parentId:b.parent_id||b.parentid||void 0})}return g({controls:v})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:hidden",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Import ATO Map Data"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Load compliance assessment data"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>o("heroforge"),className:`flex-1 p-4 rounded-lg border ${a==="heroforge"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(U,{className:"w-6 h-6 mx-auto mb-2 text-cyan-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"HeroForge Data"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Load from scans"})]}),e.jsxs("button",{onClick:()=>o("json"),className:`flex-1 p-4 rounded-lg border ${a==="json"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(K,{className:"w-6 h-6 mx-auto mb-2 text-yellow-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"JSON File"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Import JSON"})]}),e.jsxs("button",{onClick:()=>o("csv"),className:`flex-1 p-4 rounded-lg border ${a==="csv"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(Q,{className:"w-6 h-6 mx-auto mb-2 text-green-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"CSV File"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Import spreadsheet"})]})]}),a==="heroforge"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-16 h-16 mx-auto mb-4 text-cyan-400"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Load compliance assessment data from your HeroForge scans and manual assessments."}),e.jsx(M,{onClick:i,disabled:N,children:N?e.jsx(q,{}):"Load HeroForge Data"})]}),a==="json"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"file",ref:w,accept:".json",onChange:S,className:"hidden"}),e.jsxs(M,{variant:"secondary",onClick:()=>{var r;return(r=w.current)==null?void 0:r.click()},className:"w-full",disabled:N,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Upload JSON File"]})]}),e.jsx("div",{className:"text-center text-gray-500 my-4",children:"— or paste JSON below —"}),e.jsx("textarea",{value:c,onChange:r=>x(r.target.value),placeholder:'{"systemName": "My System", "controls": [{"controlId": "AC-1", "status": "Compliant"}]}',className:"w-full h-40 p-3 bg-gray-900 border border-gray-600 rounded-lg text-gray-300 font-mono text-sm"}),e.jsx(M,{onClick:C,className:"mt-4 w-full",disabled:!c.trim(),children:"Import JSON"})]}),a==="csv"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Expected CSV format:"}),e.jsxs("code",{className:"text-xs text-cyan-400",children:["control_id,status,evidence_count,poam_id,notes,parent_id",e.jsx("br",{}),"AC-1,Compliant,3,,Reviewed annually,",e.jsx("br",{}),"AC-1(1),Compliant,1,,Enhancement 1,AC-1",e.jsx("br",{}),"AC-2,NonCompliant,0,POA&M-001,Needs remediation,"]})]}),e.jsx("input",{type:"file",ref:w,accept:".csv",onChange:S,className:"hidden"}),e.jsxs(M,{onClick:()=>{var r;return(r=w.current)==null?void 0:r.click()},className:"w-full",disabled:N,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Upload CSV File"]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:e.jsx(M,{variant:"secondary",onClick:d,children:"Cancel"})})]})})},Be=()=>{const[n,d]=f.useState(!0),[t,a]=f.useState(null),[o,c]=f.useState(new Set),[x,N]=f.useState(new Set),[j,w]=f.useState(!1),[S,C]=f.useState(null),[i,g]=f.useState(null),[O,r]=f.useState(null),y=f.useRef(null);f.useEffect(()=>{d(!0),setTimeout(()=>{a(H()),d(!1)},500)},[]);const P=s=>{const l=new Set(o);l.has(s)?l.delete(s):l.add(s),c(l)},v=s=>{const l=new Set(x);l.has(s)?l.delete(s):l.add(s),N(l)},m=()=>{if(t){c(new Set(t.controlFamilies.map(l=>l.id)));const s=[];t.controlFamilies.forEach(l=>{l.controls.forEach(p=>{p.children&&p.children.length>0&&s.push(p.id)})}),N(new Set(s))}},A=()=>{c(new Set),N(new Set)},b=(s,l)=>{g(l),s.dataTransfer.effectAllowed="move"},E=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},L=(s,l)=>{if(s.preventDefault(),!i||!t||i===l)return;const p=[...t.controlFamilies],u=p.findIndex(D=>D.id===i),h=p.findIndex(D=>D.id===l);if(u===-1||h===-1)return;const[F]=p.splice(u,1);p.splice(h,0,F),p.forEach((D,k)=>{D.order=k}),a({...t,controlFamilies:p}),I.success("Control family order updated")},T=()=>{g(null)},re=()=>{window.print()},le=()=>{if(!t)return;const s={exportDate:new Date().toISOString(),...t},l=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),p=URL.createObjectURL(l),u=document.createElement("a");u.href=p,u.download=`ato-map-${t.systemName.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),I.success("ATO Map exported as JSON")},oe=()=>{if(!t)return;const s=[["Control Family","Control ID","Parent ID","Status","Evidence Count","POA&M ID","Last Assessed","Notes"]],l=(D,k,xe)=>{s.push([D,k.controlId,xe||"",k.status,String(k.evidenceCount),k.poamId||"",k.lastAssessed||"",k.notes||""]),k.children&&k.children.forEach(pe=>l(D,pe,k.controlId))};t.controlFamilies.forEach(D=>{D.controls.forEach(k=>l(D.name,k))});const p=s.map(D=>D.map(k=>`"${k}"`).join(",")).join(`
`),u=new Blob([p],{type:"text/csv"}),h=URL.createObjectURL(u),F=document.createElement("a");F.href=h,F.download=`ato-map-${t.systemName.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(h),I.success("ATO Map exported as CSV")},ie=s=>{a(s)},ce=s=>{C(s)},de=s=>{if(!t)return;const l=u=>u.map(h=>h.id===s.id?{...s,children:h.children}:h.children?{...h,children:l(h.children)}:h),p=t.controlFamilies.map(u=>({...u,controls:l(u.controls)}));p.forEach(u=>{const h=G(u.controls);Object.assign(u,h)}),a({...t,controlFamilies:p,overallScore:W(p)}),I.success(`Control ${s.controlId} updated`)},me=s=>{if(t)switch(console.log("Zeus action:",s),s.type){case"update_status":if(s.controlId&&s.newStatus){const l=u=>u.map(h=>h.controlId===s.controlId?{...h,status:s.newStatus,notes:s.notes||h.notes}:h.children&&h.children.length>0?{...h,children:l(h.children)}:h),p=t.controlFamilies.map(u=>({...u,controls:l(u.controls)}));a({...t,controlFamilies:p}),I.success(`Control ${s.controlId} updated to ${s.newStatus}`)}break;case"bulk_update":if(s.targetStatus&&s.newStatus){const l=u=>u.map(h=>{const F=h.status===s.targetStatus?{...h,status:s.newStatus,notes:s.notes||h.notes}:h;return h.children&&h.children.length>0?{...F,children:l(h.children)}:F}),p=t.controlFamilies.map(u=>s.familyId&&u.id!==s.familyId?u:{...u,controls:l(u.controls)});a({...t,controlFamilies:p}),I.success(`Bulk updated ${s.targetStatus} controls to ${s.newStatus}`)}break;case"focus_family":if(s.familyId){c(p=>new Set([...p,s.familyId]));const l=document.getElementById(`family-${s.familyId}`);l&&l.scrollIntoView({behavior:"smooth",block:"start"}),I.info(`Focused on ${s.familyId} family`)}break;case"highlight_status":s.targetStatus&&(r(s.targetStatus),I.info(`Highlighting ${s.targetStatus} controls`));break;case"export":I.info("Opening export options...");break;default:console.log("Unknown Zeus action type:",s.type)}};if(n)return e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{})})});if(!t)return e.jsx(B,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No ATO Map Data"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Import compliance data to generate the ATO map."}),e.jsxs(M,{onClick:()=>w(!0),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Import Data"]})]})});const $=t.controlFamilies.reduce((s,l)=>{const p=z(l.controls);return{total:s.total+p.total,compliant:s.compliant+p.compliantCount,partial:s.partial+p.partialCount,nonCompliant:s.nonCompliant+p.nonCompliantCount,notAssessed:s.notAssessed+p.notAssessedCount}},{total:0,compliant:0,partial:0,nonCompliant:0,notAssessed:0});return e.jsxs(B,{children:[e.jsxs("div",{ref:y,className:"ato-map-container",children:[e.jsxs("div",{className:"hidden print:block mb-8 text-center border-b-2 border-gray-300 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Authority to Operate (ATO) Assessment Map"}),e.jsx("p",{className:"text-gray-600",children:t.systemName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Generated: ",new Date().toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6 print:hidden",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(U,{className:"w-8 h-8 text-cyan-400"}),"ATO Assessment Map"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Authority to Operate control assessment visualization"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"secondary",onClick:()=>w(!0),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Import"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(M,{variant:"secondary",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Export",e.jsx(V,{className:"w-4 h-4 ml-2"})]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsxs("button",{onClick:le,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Export as JSON"]}),e.jsxs("button",{onClick:oe,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Export as CSV"]})]})]}),e.jsxs(M,{onClick:re,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Print"]})]})]}),e.jsxs(R,{className:"mb-6 print:shadow-none print:border print:border-gray-300",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(ge,{className:"w-4 h-4"}),"System Name"]}),e.jsx("div",{className:"text-white font-semibold",children:t.systemName}),t.systemId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.systemId]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(be,{className:"w-4 h-4"}),"Organization"]}),e.jsx("div",{className:"text-white font-semibold",children:t.organization||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(je,{className:"w-4 h-4"}),"Authorizing Official"]}),e.jsx("div",{className:"text-white font-semibold",children:t.authorizingOfficial||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(X,{className:"w-4 h-4"}),"Baseline"]}),e.jsx("div",{className:"text-white font-semibold",children:t.baseline}),e.jsx("div",{className:"text-xs text-gray-500",children:t.framework})]})]}),e.jsxs("div",{className:"border-t border-gray-700 px-6 py-4 flex items-center justify-between bg-gray-800/50 print:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Assessment Date:"}),e.jsx("span",{className:"text-white",children:t.assessmentDate||"Ongoing"})]}),t.targetAtoDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-gray-400",children:"Target ATO:"}),e.jsx("span",{className:"text-cyan-400",children:t.targetAtoDate})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:t.poamCount>0&&e.jsxs("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:[t.poamCount," POA&M Items"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(R,{className:"md:col-span-2 print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-6xl font-bold mb-2",style:{color:t.overallScore>=80?"#22c55e":t.overallScore>=60?"#eab308":t.overallScore>=40?"#f97316":"#ef4444"},children:[t.overallScore,"%"]}),e.jsx("div",{className:"text-gray-400",children:"Overall Compliance Score"}),e.jsx("div",{className:"mt-4 h-3 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${t.overallScore}%`,backgroundColor:t.overallScore>=80?"#22c55e":t.overallScore>=60?"#eab308":t.overallScore>=40?"#f97316":"#ef4444"}})})]})}),e.jsx(R,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:$.compliant}),e.jsx("div",{className:"text-sm text-gray-400",children:"Compliant"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.total>0?Math.round($.compliant/$.total*100):0,"%"]})]})}),e.jsx(R,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:$.partial}),e.jsx("div",{className:"text-sm text-gray-400",children:"Partial"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.total>0?Math.round($.partial/$.total*100):0,"%"]})]})}),e.jsx(R,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-400",children:$.nonCompliant}),e.jsx("div",{className:"text-sm text-gray-400",children:"Non-Compliant"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[$.total>0?Math.round($.nonCompliant/$.total*100):0,"%"]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 text-sm print:text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-500"}),e.jsx("span",{className:"text-gray-300",children:"Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-500"}),e.jsx("span",{className:"text-gray-300",children:"Partially Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-gray-300",children:"Non-Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500"}),e.jsx("span",{className:"text-gray-300",children:"Not Assessed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gray-500"}),e.jsx("span",{className:"text-gray-300",children:"Not Applicable"})]}),e.jsxs("div",{className:"ml-auto flex gap-2 print:hidden",children:[e.jsx(M,{variant:"secondary",size:"sm",onClick:m,children:"Expand All"}),e.jsx(M,{variant:"secondary",size:"sm",onClick:A,children:"Collapse All"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2 flex items-center gap-2 print:hidden",children:[e.jsx(ee,{className:"w-4 h-4"}),"Drag control families to reorder"]}),e.jsx("div",{className:"space-y-4",children:t.controlFamilies.map(s=>e.jsx(Me,{family:s,expanded:o.has(s.id),onToggle:()=>P(s.id),expandedControls:x,onToggleControl:v,onEditControl:ce,isDragging:i===s.id,onDragStart:b,onDragOver:E,onDrop:L,onDragEnd:T},s.id))}),e.jsxs("div",{className:"hidden print:block mt-8 pt-4 border-t border-gray-300 text-center text-sm text-gray-500",children:[e.jsx("p",{children:"Generated by HeroForge Security Assessment Platform"}),e.jsxs("p",{children:["Report Date: ",new Date().toLocaleString()]})]})]}),e.jsx(Ee,{isOpen:j,onClose:()=>w(!1),onImport:ie}),e.jsx(Oe,{control:S,onClose:()=>C(null),onSave:de}),e.jsx(Pe,{atoData:t,onAction:me}),e.jsx("style",{children:`
        @media print {
          body {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
          }
          .ato-map-container {
            padding: 0;
            max-width: none;
          }
          .bg-gray-800, .bg-gray-900 {
            background-color: white !important;
          }
          .text-white, .text-gray-300 {
            color: black !important;
          }
          .text-gray-400, .text-gray-500 {
            color: #666 !important;
          }
          .border-gray-700 {
            border-color: #ccc !important;
          }
        }
      `})]})};export{Be as default};
