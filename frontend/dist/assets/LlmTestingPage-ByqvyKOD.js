import{b as Y,u as k,d as _,j as e}from"./vendor-state-BjT_zREg.js";import{r as v}from"./vendor-react-5KxtEOLM.js";import{B as l,be as M,a9 as P,F,av as R,O as q,g as B,v as E,aY as I,m as T,ab as J,H as W,a6 as Z,X as ee,N as se,aq as te,a4 as ae,a as re,p as ie,i as le}from"./vendor-ui-C4nf_tR6.js";import{L as ne}from"./Layout-DQwy8A8G.js";import{C as n}from"./Card-CV6m9jT5.js";import{as as x,B as o}from"./index-RI0GBk2h.js";import{B as N}from"./Badge-Bi3Nk-Vg.js";import{L as de}from"./LoadingSpinner-CV5u9ki8.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";const fe=()=>{const[p,C]=v.useState("dashboard"),[d,z]=v.useState(null),[h,D]=v.useState([]),[K,b]=v.useState(!1),[r,u]=v.useState({name:"",endpoint:"",model_type:"openai",description:"",api_key:""}),y=Y(),j=[{name:"Prompt Injection",icon:e.jsx(se,{className:"h-5 w-5"}),color:"text-red-500",description:"Test for malicious prompt injection attacks",testCount:25,passRate:82},{name:"Jailbreak Attempts",icon:e.jsx(te,{className:"h-5 w-5"}),color:"text-orange-500",description:"Bypass safety guardrails and content filters",testCount:18,passRate:91},{name:"Data Extraction",icon:e.jsx(q,{className:"h-5 w-5"}),color:"text-yellow-500",description:"Attempt to extract training data or sensitive information",testCount:12,passRate:94},{name:"Context Manipulation",icon:e.jsx(ae,{className:"h-5 w-5"}),color:"text-purple-500",description:"Manipulate conversation context for unintended behavior",testCount:9,passRate:88},{name:"Encoding Attacks",icon:e.jsx(re,{className:"h-5 w-5"}),color:"text-blue-500",description:"Use encoding techniques to bypass filters",testCount:7,passRate:96}],{data:c,isLoading:O}=k({queryKey:["llm-targets"],queryFn:async()=>{try{return(await x.getLLMTargets({limit:100})).data}catch{return[]}}}),L=_({mutationFn:async s=>(await x.createLLMTarget(s)).data,onSuccess:()=>{y.invalidateQueries({queryKey:["llm-targets"]}),l.success("Target created successfully"),b(!1),u({name:"",endpoint:"",model_type:"openai",description:"",api_key:""})},onError:()=>{l.error("Failed to create target")}}),Q=_({mutationFn:async s=>{await x.deleteLLMTarget(s)},onSuccess:()=>{y.invalidateQueries({queryKey:["llm-targets"]}),l.success("Target deleted")},onError:()=>{l.error("Failed to delete target")}}),{data:a}=k({queryKey:["llm-test-runs"],queryFn:async()=>{try{return(await x.getLLMTests({limit:50})).data.map(t=>({id:t.id,target_id:t.id,target_name:t.target_name,total_tests:t.tests_run||0,passed:t.tests_run-(t.vulnerabilities_found||0),failed:t.vulnerabilities_found||0,vulnerabilities_found:t.vulnerabilities_found||0,status:t.status==="completed"?"completed":t.status==="running"?"running":"failed",started_at:t.started_at||t.created_at,completed_at:t.completed_at}))}catch{return[]}}}),{data:g}=k({queryKey:["llm-test-results",d],queryFn:async()=>{if(!d)return[];try{const t=(await x.getLLMTest(d)).data;return(await x.getTestCases({enabled_only:!0})).data.slice(0,10).map((i,f)=>({id:i.id||String(f),test_name:i.name,category:i.category,status:t.vulnerabilities_found>0&&f<t.vulnerabilities_found?"failed":"passed",severity:i.severity||"medium",vulnerability_found:t.vulnerabilities_found>0&&f<t.vulnerabilities_found,response:i.description||"Test completed",execution_time:Math.random()*2,timestamp:t.completed_at||t.created_at}))}catch{return[]}},enabled:!!d}),S=_({mutationFn:async s=>{const t=c==null?void 0:c.find(i=>i.id===s.target_id);return{run_id:(await x.startLLMTest({target_name:(t==null?void 0:t.name)||"Test Target",target_type:(t==null?void 0:t.model_type)||"LLM",target_config:{endpoint:t==null?void 0:t.endpoint,categories:s.categories},test_type:s.categories.join(",")})).data.id,total_tests:h.reduce((i,f)=>{const w=j.find(X=>X.name===f);return i+((w==null?void 0:w.testCount)||0)},0)}},onSuccess:s=>{y.invalidateQueries({queryKey:["llm-test-runs"]}),l.success(`Test run started: ${s.total_tests} tests queued`),C("results")},onError:()=>{l.error("Failed to start test run")}}),G=()=>{if(!d){l.error("Please select a target");return}if(h.length===0){l.error("Please select at least one test category");return}S.mutate({target_id:d,categories:h})},$=()=>{if(!r.name.trim()){l.error("Please enter a target name");return}if(!r.endpoint.trim()){l.error("Please enter an endpoint URL");return}L.mutate({name:r.name.trim(),endpoint:r.endpoint.trim(),model_type:r.model_type,description:r.description.trim()||void 0,api_key:r.api_key.trim()||void 0})},V=s=>{D(t=>t.includes(s)?t.filter(m=>m!==s):[...t,s])},A=s=>{switch(s){case"passed":return e.jsx(B,{className:"h-4 w-4 text-green-400"});case"failed":return e.jsx(le,{className:"h-4 w-4 text-red-400"});case"running":return e.jsx(P,{className:"h-4 w-4 text-blue-400 animate-spin"});default:return e.jsx(ie,{className:"h-4 w-4 text-slate-400"})}},H=j.reduce((s,t)=>s+t.testCount,0),U=(a==null?void 0:a.reduce((s,t)=>s+t.total_tests,0))||0;return e.jsxs(ne,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(M,{className:"h-8 w-8 text-primary"}),"LLM Security Testing"]}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Test AI and LLM applications for security vulnerabilities"})]}),e.jsxs(o,{variant:"primary",onClick:()=>y.invalidateQueries(),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(n,{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Built-in Tests"}),e.jsx(F,{className:"h-4 w-4 text-purple-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:H}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Across 5 categories"})]}),e.jsxs(n,{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Tests Run"}),e.jsx(R,{className:"h-4 w-4 text-blue-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:U}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[(a==null?void 0:a.length)||0," test runs"]})]}),e.jsxs(n,{className:"bg-gradient-to-br from-red-500/10 to-red-600/10 border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Vulnerabilities"}),e.jsx(q,{className:"h-4 w-4 text-red-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:(a==null?void 0:a.reduce((s,t)=>s+t.vulnerabilities_found,0))||0}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Found in testing"})]}),e.jsxs(n,{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Pass Rate"}),e.jsx(B,{className:"h-4 w-4 text-green-400"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white",children:[a&&a.length>0?Math.round(a.reduce((s,t)=>s+t.passed,0)/a.reduce((s,t)=>s+t.total_tests,0)*100):0,"%"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Average across all runs"})]})]}),e.jsx("div",{className:"flex items-center gap-2 border-b border-dark-border",children:[{id:"dashboard",label:"Dashboard",icon:e.jsx(R,{className:"h-4 w-4"})},{id:"targets",label:"Targets",icon:e.jsx(E,{className:"h-4 w-4"})},{id:"run-test",label:"Run Tests",icon:e.jsx(I,{className:"h-4 w-4"})},{id:"results",label:"Results",icon:e.jsx(F,{className:"h-4 w-4"})}].map(s=>e.jsxs("button",{onClick:()=>C(s.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors border-b-2 ${p===s.id?"text-primary border-primary":"text-slate-400 border-transparent hover:text-white hover:border-slate-600"}`,children:[s.icon,s.label]},s.id))}),p==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Test Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(s=>e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-5 hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`${s.color}`,children:s.icon}),e.jsxs("span",{className:"text-xs font-medium px-2 py-1 bg-slate-700 text-slate-300 rounded",children:[s.testCount," tests"]})]}),e.jsx("h4",{className:"font-semibold text-white mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:s.description}),s.passRate!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Pass Rate:"}),e.jsxs("span",{className:"font-medium text-green-400",children:[s.passRate,"%"]})]})]},s.name))})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Recent Test Runs"}),e.jsxs(N,{variant:"info",children:[(a==null?void 0:a.length)||0," runs"]})]}),e.jsxs("div",{className:"space-y-3",children:[a==null?void 0:a.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[A(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.target_name}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(s.started_at).toLocaleString()})]})]}),e.jsx(N,{variant:s.status==="completed"?"success":"info",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Tests"}),e.jsx("div",{className:"text-white font-medium",children:s.total_tests})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Passed"}),e.jsx("div",{className:"text-green-400 font-medium",children:s.passed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Failed"}),e.jsx("div",{className:"text-red-400 font-medium",children:s.failed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Vulnerabilities"}),e.jsx("div",{className:"text-orange-400 font-medium",children:s.vulnerabilities_found})]})]})]},s.id)),(!a||a.length===0)&&e.jsx("div",{className:"text-center py-8 text-slate-500",children:'No test runs yet. Go to "Run Tests" to start testing.'})]})]})]}),p==="targets"&&e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"LLM Targets"}),e.jsxs(o,{variant:"primary",size:"sm",onClick:()=>b(!0),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Target"]})]}),O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(de,{})}):c&&c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.endpoint})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"info",children:s.model_type}),e.jsx("button",{onClick:()=>Q.mutate(s.id),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors",title:"Delete target",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Added: ",new Date(s.created_at).toLocaleString()]}),s.description&&e.jsx("span",{className:"text-slate-400",children:s.description})]})]},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"No LLM targets configured yet"}),e.jsxs(o,{variant:"primary",size:"sm",onClick:()=>b(!0),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Your First Target"]})]})]}),p==="run-test"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Target"}),e.jsx("div",{className:"space-y-2",children:c==null?void 0:c.map(s=>e.jsxs("button",{onClick:()=>z(s.id),className:`w-full p-4 rounded-lg border transition-colors text-left ${d===s.id?"bg-primary/20 border-primary text-white":"bg-dark-bg border-dark-border text-slate-300 hover:border-primary"}`,children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.endpoint})]},s.id))})]}),e.jsxs(n,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Test Categories"}),e.jsx("div",{className:"space-y-2 mb-6",children:j.map(s=>e.jsxs("button",{onClick:()=>V(s.name),className:`w-full p-4 rounded-lg border transition-colors text-left ${h.includes(s.name)?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-primary"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s.color,children:s.icon}),e.jsx("span",{className:"font-medium text-white",children:s.name})]}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s.testCount," tests"]})]}),e.jsx("p",{className:"text-sm text-slate-400",children:s.description})]},s.name))}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border mb-4",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"Tests to run:"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:h.reduce((s,t)=>{const m=j.find(i=>i.name===t);return s+((m==null?void 0:m.testCount)||0)},0)})]}),e.jsxs(o,{variant:"primary",className:"w-full",onClick:G,loading:S.isPending,disabled:!d||h.length===0,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Run Tests"]})]})]}),p==="results"&&e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Test Results"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"secondary",size:"sm",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(o,{variant:"secondary",size:"sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[g==null?void 0:g.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[A(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.test_name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.category})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:s.vulnerability_found?"danger":"success",children:s.vulnerability_found?"Vulnerable":"Secure"}),e.jsx(N,{variant:"warning",children:s.severity})]})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded border border-dark-border mb-2",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Response:"}),e.jsx("div",{className:"text-sm text-slate-300",children:s.response})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Execution time: ",s.execution_time.toFixed(2),"s"]}),e.jsx("span",{children:new Date(s.timestamp).toLocaleString()})]})]},s.id)),(!g||g.length===0)&&!d&&e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Select a target to view test results"})]})]})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg w-full max-w-lg p-6 m-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Add LLM Target"}),e.jsx("button",{onClick:()=>b(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(ee,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Target Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>u({...r,name:s.target.value}),placeholder:"e.g., GPT-4 Production API",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"API Endpoint *"}),e.jsx("input",{type:"url",value:r.endpoint,onChange:s=>u({...r,endpoint:s.target.value}),placeholder:"e.g., https://api.openai.com/v1/chat/completions",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Model Type"}),e.jsxs("select",{value:r.model_type,onChange:s=>u({...r,model_type:s.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"openai",children:"OpenAI (GPT)"}),e.jsx("option",{value:"anthropic",children:"Anthropic (Claude)"}),e.jsx("option",{value:"google",children:"Google (Gemini)"}),e.jsx("option",{value:"azure",children:"Azure OpenAI"}),e.jsx("option",{value:"huggingface",children:"Hugging Face"}),e.jsx("option",{value:"custom",children:"Custom LLM"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"API Key (Optional)"}),e.jsx("input",{type:"password",value:r.api_key,onChange:s=>u({...r,api_key:s.target.value}),placeholder:"sk-...",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Required for testing protected endpoints"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description (Optional)"}),e.jsx("textarea",{value:r.description,onChange:s=>u({...r,description:s.target.value}),placeholder:"Brief description of this target...",rows:2,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary resize-none"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6",children:[e.jsx(o,{variant:"secondary",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(o,{variant:"primary",onClick:$,loading:L.isPending,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Target"]})]})]})})]})};export{fe as default};
