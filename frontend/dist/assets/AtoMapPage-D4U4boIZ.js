import{j as e}from"./vendor-state-BjT_zREg.js";import{r as v}from"./vendor-react-5KxtEOLM.js";import{S as J,b1 as _,a6 as Ne,l as q,a7 as Q,bx as ee,ak as ve,F as we,by as Ce,U as Se,v as Y,ay as Ae,aC as te,B as S,_ as se,X as ae,z as Ie,ag as Z,bt as ne,k as ke,bz as Me,C as K,a9 as Oe,O as Ee,i as De,g as Pe}from"./vendor-ui-CaTPr3iI.js";import{L as B}from"./Layout-hU69iu7X.js";import{C as z}from"./Card-CV6m9jT5.js";import{B as E,N as L}from"./index--6GUYD2o.js";import{L as G}from"./LoadingSpinner-DiN0bg1Z.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";const H=[{id:"AC",name:"Access Control",abbreviation:"AC"},{id:"AT",name:"Awareness and Training",abbreviation:"AT"},{id:"AU",name:"Audit and Accountability",abbreviation:"AU"},{id:"CA",name:"Assessment, Authorization, and Monitoring",abbreviation:"CA"},{id:"CM",name:"Configuration Management",abbreviation:"CM"},{id:"CP",name:"Contingency Planning",abbreviation:"CP"},{id:"IA",name:"Identification and Authentication",abbreviation:"IA"},{id:"IR",name:"Incident Response",abbreviation:"IR"},{id:"MA",name:"Maintenance",abbreviation:"MA"},{id:"MP",name:"Media Protection",abbreviation:"MP"},{id:"PE",name:"Physical and Environmental Protection",abbreviation:"PE"},{id:"PL",name:"Planning",abbreviation:"PL"},{id:"PM",name:"Program Management",abbreviation:"PM"},{id:"PS",name:"Personnel Security",abbreviation:"PS"},{id:"PT",name:"PII Processing and Transparency",abbreviation:"PT"},{id:"RA",name:"Risk Assessment",abbreviation:"RA"},{id:"SA",name:"System and Services Acquisition",abbreviation:"SA"},{id:"SC",name:"System and Communications Protection",abbreviation:"SC"},{id:"SI",name:"System and Information Integrity",abbreviation:"SI"},{id:"SR",name:"Supply Chain Risk Management",abbreviation:"SR"}],$e=n=>{switch(n){case"Compliant":return e.jsx(Pe,{className:"w-4 h-4 text-green-400"});case"NonCompliant":return e.jsx(De,{className:"w-4 h-4 text-red-400"});case"PartiallyCompliant":return e.jsx(Ee,{className:"w-4 h-4 text-yellow-400"});case"NotApplicable":return e.jsx(ne,{className:"w-4 h-4 text-gray-400"});case"NotAssessed":return e.jsx(K,{className:"w-4 h-4 text-blue-400"});case"ManualOverride":return e.jsx(Oe,{className:"w-4 h-4 text-purple-400"});default:return e.jsx(K,{className:"w-4 h-4 text-gray-400"})}},U=n=>{let p=0,s=0,a=0,d=0,m=0,h=0;const w=j=>{switch(h++,j.status){case"Compliant":p++;break;case"NonCompliant":s++;break;case"PartiallyCompliant":a++;break;case"NotAssessed":d++;break;case"NotApplicable":m++;break}j.children&&j.children.forEach(w)};return n.forEach(w),{compliantCount:p,nonCompliantCount:s,partialCount:a,notAssessedCount:d,notApplicableCount:m,total:h}},W=n=>U(n),X=n=>{let p=0,s=0,a=0;return n.forEach(d=>{const m=U(d.controls),h=m.total-m.notApplicableCount-m.notAssessedCount;p+=h,s+=m.compliantCount,a+=m.partialCount}),p===0?0:Math.round((s+a*.5)/p*100)},V=()=>{const n=H.map((a,d)=>{const m=Math.floor(Math.random()*10)+5,h=[];for(let j=1;j<=m;j++){const A=Math.random();let I;A<.5?I="Compliant":A<.65?I="PartiallyCompliant":A<.75?I="NonCompliant":A<.85?I="NotAssessed":I="NotApplicable";const C=Math.random()<.4?Math.floor(Math.random()*3)+1:0,f=[];for(let k=1;k<=C;k++){const F=Math.random();let o;F<.5?o="Compliant":F<.65?o="PartiallyCompliant":F<.75?o="NonCompliant":F<.85?o="NotAssessed":o="NotApplicable",f.push({id:`${a.id}-${j}(${k})`,controlId:`${a.abbreviation}-${j}(${k})`,title:`${a.name} Control ${j} Enhancement ${k}`,status:o,evidenceCount:o==="Compliant"?Math.floor(Math.random()*3)+1:0,poamId:o==="NonCompliant"?`POA&M-${Math.floor(Math.random()*100)+1}`:void 0,lastAssessed:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString().split("T")[0],parentId:`${a.id}-${j}`})}h.push({id:`${a.id}-${j}`,controlId:`${a.abbreviation}-${j}`,title:`${a.name} Control ${j}`,status:I,evidenceCount:I==="Compliant"?Math.floor(Math.random()*5)+1:0,poamId:I==="NonCompliant"?`POA&M-${Math.floor(Math.random()*100)+1}`:void 0,lastAssessed:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString().split("T")[0],children:f.length>0?f:void 0})}const w=W(h);return{id:a.id,name:a.name,abbreviation:a.abbreviation,controls:h,order:d,...w}}),p=a=>{let d=0;return a.forEach(m=>{m.poamId&&d++,m.children&&(d+=p(m.children))}),d},s=n.reduce((a,d)=>a+p(d.controls),0);return{systemName:"Sample Information System",systemId:"SYS-2024-001",organization:"Sample Organization",authorizingOfficial:"Jane Smith, CISO",assessmentDate:new Date().toISOString().split("T")[0],targetAtoDate:new Date(Date.now()+2160*60*60*1e3).toISOString().split("T")[0],baseline:"Moderate",framework:"NIST 800-53 Rev 5",controlFamilies:n,overallScore:X(n),poamCount:s}},re=({control:n,depth:p,expandedControls:s,onToggleControl:a,onEditControl:d})=>{const m=n.children&&n.children.length>0,h=s.has(n.id);return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`border-t border-gray-700 ${p>0?"bg-gray-800/50":""}`,children:[e.jsx("td",{className:"py-2",style:{paddingLeft:`${p*24+8}px`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx("button",{onClick:()=>a(n.id),className:"p-0.5 hover:bg-gray-700 rounded",children:h?e.jsx(q,{className:"w-4 h-4 text-gray-400"}):e.jsx(se,{className:"w-4 h-4 text-gray-400"})}):e.jsx("span",{className:"w-5"}),e.jsx("span",{className:"font-mono text-cyan-400",children:n.controlId})]})}),e.jsx("td",{className:"py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[$e(n.status),e.jsx("span",{className:"text-gray-300",children:n.status})]})}),e.jsx("td",{className:"py-2 text-gray-400",children:n.evidenceCount>0?`${n.evidenceCount} items`:"-"}),e.jsx("td",{className:"py-2",children:n.poamId?e.jsx("span",{className:"text-red-400 font-mono",children:n.poamId}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"py-2 text-gray-400",children:n.lastAssessed||"-"}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>d(n),className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-cyan-400",title:"Edit control",children:e.jsx(Me,{className:"w-4 h-4"})})})]}),m&&h&&n.children.map(w=>e.jsx(re,{control:w,depth:p+1,expandedControls:s,onToggleControl:a,onEditControl:d},w.id))]})},Fe=({family:n,expanded:p,onToggle:s,expandedControls:a,onToggleControl:d,onEditControl:m,isDragging:h,onDragStart:w,onDragOver:j,onDrop:A,onDragEnd:I})=>{const C=U(n.controls),f=C.total,k=f>0?C.compliantCount/f*100:0,F=f>0?C.partialCount/f*100:0,o=f>0?C.nonCompliantCount/f*100:0,N=f>0?C.notAssessedCount/f*100:0,y=f>0?C.notApplicableCount/f*100:0;return e.jsxs("div",{className:`bg-gray-800 rounded-lg border border-gray-700 overflow-hidden print:break-inside-avoid transition-all ${h?"opacity-50 border-cyan-500":""}`,draggable:!0,onDragStart:c=>w(c,n.id),onDragOver:j,onDrop:c=>A(c,n.id),onDragEnd:I,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"px-2 py-4 cursor-grab active:cursor-grabbing hover:bg-gray-700 print:hidden",title:"Drag to reorder",children:e.jsx(te,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("button",{onClick:s,className:"flex-1 p-4 flex items-center justify-between hover:bg-gray-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-700 flex items-center justify-center font-bold text-cyan-400",children:n.abbreviation}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-white",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:[f," controls"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 rounded bg-green-500/20 text-green-400",children:C.compliantCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-yellow-500/20 text-yellow-400",children:C.partialCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-red-500/20 text-red-400",children:C.nonCompliantCount}),e.jsx("span",{className:"px-2 py-1 rounded bg-blue-500/20 text-blue-400",children:C.notAssessedCount})]}),p?e.jsx(q,{className:"w-5 h-5 text-gray-400"}):e.jsx(se,{className:"w-5 h-5 text-gray-400"})]})]})]}),e.jsxs("div",{className:"h-2 flex",children:[e.jsx("div",{className:"bg-green-500",style:{width:`${k}%`}}),e.jsx("div",{className:"bg-yellow-500",style:{width:`${F}%`}}),e.jsx("div",{className:"bg-red-500",style:{width:`${o}%`}}),e.jsx("div",{className:"bg-blue-500",style:{width:`${N}%`}}),e.jsx("div",{className:"bg-gray-500",style:{width:`${y}%`}})]}),p&&e.jsx("div",{className:"p-4 border-t border-gray-700 bg-gray-850",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 text-left",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Control"}),e.jsx("th",{className:"pb-2 font-medium",children:"Status"}),e.jsx("th",{className:"pb-2 font-medium",children:"Evidence"}),e.jsx("th",{className:"pb-2 font-medium",children:"POA&M"}),e.jsx("th",{className:"pb-2 font-medium",children:"Last Assessed"}),e.jsx("th",{className:"pb-2 font-medium w-10"})]})}),e.jsx("tbody",{children:n.controls.map(c=>e.jsx(re,{control:c,depth:0,expandedControls:a,onToggleControl:d,onEditControl:m},c.id))})]})})]})},Te=({control:n,onClose:p,onSave:s})=>{const[a,d]=v.useState(n);if(v.useEffect(()=>{d(n)},[n]),!n||!a)return null;const m=()=>{s(a),p()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:hidden",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Control"}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-white",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Control ID"}),e.jsx("div",{className:"text-white font-mono",children:a.controlId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:a.status,onChange:h=>d({...a,status:h.target.value}),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white",children:[e.jsx("option",{value:"Compliant",children:"Compliant"}),e.jsx("option",{value:"PartiallyCompliant",children:"Partially Compliant"}),e.jsx("option",{value:"NonCompliant",children:"Non-Compliant"}),e.jsx("option",{value:"NotAssessed",children:"Not Assessed"}),e.jsx("option",{value:"NotApplicable",children:"Not Applicable"}),e.jsx("option",{value:"ManualOverride",children:"Manual Override"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Evidence Count"}),e.jsx("input",{type:"number",min:"0",value:a.evidenceCount,onChange:h=>d({...a,evidenceCount:parseInt(h.target.value)||0}),className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"POA&M ID"}),e.jsx("input",{type:"text",value:a.poamId||"",onChange:h=>d({...a,poamId:h.target.value||void 0}),placeholder:"e.g., POA&M-001",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes||"",onChange:h=>d({...a,notes:h.target.value||void 0}),placeholder:"Assessment notes...",rows:3,className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Assessor"}),e.jsx("input",{type:"text",value:a.assessor||"",onChange:h=>d({...a,assessor:h.target.value||void 0}),placeholder:"Assessor name",className:"w-full p-2 bg-gray-900 border border-gray-600 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:[e.jsx(E,{variant:"secondary",onClick:p,children:"Cancel"}),e.jsxs(E,{onClick:m,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})})},Re=({atoData:n,onAction:p})=>{const[s,a]=v.useState(!1),[d,m]=v.useState(!1),[h,w]=v.useState(""),[j,A]=v.useState([]),[I,C]=v.useState(!1),f=async()=>{if(!h.trim()||!n)return;const y=h;w(""),A(c=>[...c,{role:"user",content:y}]),C(!0);try{const c=await L.post("/api/ato-map/zeus",{prompt:y,context:{systemName:n.systemName,overallScore:n.overallScore,poamCount:n.poamCount,families:n.controlFamilies.map(x=>({id:x.id,name:x.name,stats:U(x.controls)}))}}),i=c.data.message||"Action completed.";A(x=>[...x,{role:"assistant",content:i}]),c.data.action&&(p(c.data.action),S.success("Zeus action applied"))}catch(c){console.error("Zeus error:",c);const i=c instanceof Error?c.message:"Unknown error";A(x=>[...x,{role:"assistant",content:`I encountered an error processing your request. You can still use me to help analyze the ATO data or suggest actions. Error: ${i}`}])}finally{C(!1)}},k=[{label:"Analyze gaps",prompt:"What are the main compliance gaps in this ATO assessment?"},{label:"Prioritize POA&Ms",prompt:"Help me prioritize the POA&M items by risk."},{label:"Generate summary",prompt:"Generate an executive summary of the current ATO status."},{label:"Recommend actions",prompt:"What controls should I focus on to improve the overall score?"}],F=()=>{a(!0),m(!1)},o=()=>{m(!0)},N=()=>{a(!1),m(!1)};return!s||d?e.jsxs("button",{onClick:F,className:`fixed bottom-6 right-6 p-4 rounded-full shadow-lg z-40 print:hidden transition-all ${d?"bg-purple-500 hover:bg-purple-400 ring-2 ring-purple-300 ring-offset-2 ring-offset-gray-900":"bg-purple-600 hover:bg-purple-500"}`,title:d?"Restore Zeus":"Ask Zeus AI Assistant",children:[e.jsx(Z,{className:"w-6 h-6 text-white"}),d&&j.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-cyan-400 rounded-full animate-pulse"})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed bottom-6 right-6 w-96 bg-gray-800 rounded-lg shadow-xl border border-gray-700 z-50 print:hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Zeus AI Assistant"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:o,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Minimize",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:N,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Close",children:e.jsx(ae,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"h-64 overflow-y-auto p-4 space-y-3",children:[j.length===0&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto mb-2 text-purple-400/50"}),e.jsx("p",{className:"text-sm",children:"Ask me about your ATO assessment or use quick actions below."})]}),j.map((y,c)=>e.jsx("div",{className:`p-3 rounded-lg ${y.role==="user"?"bg-cyan-500/20 text-cyan-100 ml-8":"bg-gray-700 text-gray-100 mr-8"}`,children:y.content},c)),I&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(G,{}),e.jsx("span",{className:"text-sm",children:"Zeus is thinking..."})]})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-700",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:k.map((y,c)=>e.jsx("button",{onClick:()=>w(y.prompt),className:"px-2 py-1 text-xs bg-gray-700 hover:bg-gray-600 rounded text-gray-300",children:y.label},c))})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:y=>w(y.target.value),onKeyDown:y=>y.key==="Enter"&&f(),placeholder:"Ask Zeus...",className:"flex-1 p-2 bg-gray-900 border border-gray-600 rounded-lg text-white text-sm",disabled:I}),e.jsx(E,{onClick:f,disabled:I||!h.trim(),children:e.jsx(ke,{className:"w-4 h-4"})})]})})]})})},Le=({isOpen:n,onClose:p,onImport:s})=>{const[a,d]=v.useState("heroforge"),[m,h]=v.useState(""),[w,j]=v.useState(!1),A=v.useRef(null);if(!n)return null;const I=async o=>{var y;const N=(y=o.target.files)==null?void 0:y[0];if(N){j(!0);try{const c=await N.text();if(a==="json"){const i=JSON.parse(c),x=k(i);s(x),S.success("ATO Map data imported successfully"),p()}else if(a==="csv"){const i=F(c);s(i),S.success("CSV data imported successfully"),p()}}catch(c){console.error("Import error:",c),S.error("Failed to import data. Please check the file format.")}finally{j(!1)}}},C=()=>{try{const o=JSON.parse(m),N=k(o);s(N),S.success("ATO Map data imported successfully"),p()}catch(o){console.error("JSON parse error:",o),S.error("Invalid JSON format")}},f=async()=>{j(!0);try{const o=await L.get("/api/ato-map");if(o.data&&o.data.controlFamilies)s(o.data),S.success("Loaded compliance data from HeroForge"),p();else{const N=V();s(N),S.success("Loaded sample compliance data"),p()}}catch(o){console.error("Load error:",o);const N=V();s(N),S.info("Loaded sample data (API not available)"),p()}finally{j(!1)}},k=o=>{const N=new Map,y=new Map;H.forEach(i=>N.set(i.id,[])),o.controls.forEach(i=>{const x=i.controlId,b=x.split("-")[0].toUpperCase(),D={id:x,controlId:x,title:`Control ${x}`,status:i.status||"NotAssessed",evidenceCount:i.evidenceCount||0,poamId:i.poamId,notes:i.notes,parentId:i.parentId},R=x.match(/^([A-Z]+-\d+)\(\d+\)$/);if(R||i.parentId){const T=i.parentId||R[1];y.has(T)||y.set(T,[]),y.get(T).push(D)}else N.has(b)&&N.get(b).push(D)}),N.forEach(i=>{i.forEach(x=>{const b=y.get(x.controlId);b&&b.length>0&&(x.children=b)})});const c=H.map((i,x)=>{const b=N.get(i.id)||[],D=W(b);return{id:i.id,name:i.name,abbreviation:i.abbreviation,controls:b,order:x,...D}}).filter(i=>i.controls.length>0);return{systemName:o.systemName||"Imported System",organization:o.organization,baseline:o.baseline||"Moderate",framework:"NIST 800-53 Rev 5",controlFamilies:c,overallScore:X(c),poamCount:c.reduce((i,x)=>{let b=0;const D=R=>{R.forEach(T=>{T.poamId&&b++,T.children&&D(T.children)})};return D(x.controls),i+b},0)}},F=o=>{const N=o.trim().split(`
`),y=N[0].split(",").map(i=>i.trim().toLowerCase()),c=[];for(let i=1;i<N.length;i++){const x=N[i].split(",").map(D=>D.trim()),b={};y.forEach((D,R)=>{b[D]=x[R]||""}),c.push({controlId:b.control_id||b.controlid||b.control||"",status:b.status||"NotAssessed",evidenceCount:parseInt(b.evidence_count||b.evidence||"0",10),poamId:b.poam_id||b.poam||void 0,notes:b.notes||void 0,parentId:b.parent_id||b.parentid||void 0})}return k({controls:c})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 print:hidden",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Import ATO Map Data"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Load compliance assessment data"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>d("heroforge"),className:`flex-1 p-4 rounded-lg border ${a==="heroforge"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(J,{className:"w-6 h-6 mx-auto mb-2 text-cyan-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"HeroForge Data"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Load from scans"})]}),e.jsxs("button",{onClick:()=>d("json"),className:`flex-1 p-4 rounded-lg border ${a==="json"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(Q,{className:"w-6 h-6 mx-auto mb-2 text-yellow-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"JSON File"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Import JSON"})]}),e.jsxs("button",{onClick:()=>d("csv"),className:`flex-1 p-4 rounded-lg border ${a==="csv"?"border-cyan-500 bg-cyan-500/10":"border-gray-600 hover:border-gray-500"}`,children:[e.jsx(ee,{className:"w-6 h-6 mx-auto mb-2 text-green-400"}),e.jsx("div",{className:"text-sm font-medium text-white",children:"CSV File"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Import spreadsheet"})]})]}),a==="heroforge"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-cyan-400"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Load compliance assessment data from your HeroForge scans and manual assessments."}),e.jsx(E,{onClick:f,disabled:w,children:w?e.jsx(G,{}):"Load HeroForge Data"})]}),a==="json"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"file",ref:A,accept:".json",onChange:I,className:"hidden"}),e.jsxs(E,{variant:"secondary",onClick:()=>{var o;return(o=A.current)==null?void 0:o.click()},className:"w-full",disabled:w,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Upload JSON File"]})]}),e.jsx("div",{className:"text-center text-gray-500 my-4",children:"— or paste JSON below —"}),e.jsx("textarea",{value:m,onChange:o=>h(o.target.value),placeholder:'{"systemName": "My System", "controls": [{"controlId": "AC-1", "status": "Compliant"}]}',className:"w-full h-40 p-3 bg-gray-900 border border-gray-600 rounded-lg text-gray-300 font-mono text-sm"}),e.jsx(E,{onClick:C,className:"mt-4 w-full",disabled:!m.trim(),children:"Import JSON"})]}),a==="csv"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Expected CSV format:"}),e.jsxs("code",{className:"text-xs text-cyan-400",children:["control_id,status,evidence_count,poam_id,notes,parent_id",e.jsx("br",{}),"AC-1,Compliant,3,,Reviewed annually,",e.jsx("br",{}),"AC-1(1),Compliant,1,,Enhancement 1,AC-1",e.jsx("br",{}),"AC-2,NonCompliant,0,POA&M-001,Needs remediation,"]})]}),e.jsx("input",{type:"file",ref:A,accept:".csv",onChange:I,className:"hidden"}),e.jsxs(E,{onClick:()=>{var o;return(o=A.current)==null?void 0:o.click()},className:"w-full",disabled:w,children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Upload CSV File"]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-3",children:e.jsx(E,{variant:"secondary",onClick:p,children:"Cancel"})})]})})},Ge=()=>{const[n,p]=v.useState(!0),[s,a]=v.useState(null),[d,m]=v.useState(new Set),[h,w]=v.useState(new Set),[j,A]=v.useState(!1),[I,C]=v.useState(null),[f,k]=v.useState(null),[F,o]=v.useState(null),[N,y]=v.useState([]),[c,i]=v.useState(""),[x,b]=v.useState("real"),D=v.useRef(null);v.useEffect(()=>{(async()=>{try{const r=await L.get("/api/engagements"),l=r.data.engagements||r.data||[];y(l),l.length>0&&i(l[0].id)}catch(r){console.error("Failed to fetch engagements:",r),b("sample")}})()},[]),v.useEffect(()=>{(async()=>{var r;p(!0);try{let l;c&&x==="real"?l=await L.get(`/api/ato-map/engagement/${c}`):x==="real"?l=await L.get("/api/ato-map"):l=await L.get("/api/ato-map/sample");const g=l.data;!((r=g.controlFamilies)==null?void 0:r.some($=>$.controls.some(M=>M.status!=="NotAssessed")))&&x==="real"&&S.info("No assessment data found. Showing framework controls for assessment."),a(g)}catch(l){console.error("Failed to fetch ATO data:",l),S.warning("Could not load assessment data. Using sample data."),a(V()),b("sample")}finally{p(!1)}})()},[c,x]);const R=t=>{const r=new Set(d);r.has(t)?r.delete(t):r.add(t),m(r)},T=t=>{const r=new Set(h);r.has(t)?r.delete(t):r.add(t),w(r)},le=()=>{if(s){m(new Set(s.controlFamilies.map(r=>r.id)));const t=[];s.controlFamilies.forEach(r=>{r.controls.forEach(l=>{l.children&&l.children.length>0&&t.push(l.id)})}),w(new Set(t))}},oe=()=>{m(new Set),w(new Set)},ie=(t,r)=>{k(r),t.dataTransfer.effectAllowed="move"},ce=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},de=(t,r)=>{if(t.preventDefault(),!f||!s||f===r)return;const l=[...s.controlFamilies],g=l.findIndex(M=>M.id===f),u=l.findIndex(M=>M.id===r);if(g===-1||u===-1)return;const[$]=l.splice(g,1);l.splice(u,0,$),l.forEach((M,O)=>{M.order=O}),a({...s,controlFamilies:l}),S.success("Control family order updated")},me=()=>{k(null)},xe=()=>{window.print()},pe=()=>{if(!s)return;const t={exportDate:new Date().toISOString(),...s},r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(r),g=document.createElement("a");g.href=l,g.download=`ato-map-${s.systemName.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(l),S.success("ATO Map exported as JSON")},he=()=>{if(!s)return;const t=[["Control Family","Control ID","Parent ID","Status","Evidence Count","POA&M ID","Last Assessed","Notes"]],r=(M,O,ye)=>{t.push([M,O.controlId,ye||"",O.status,String(O.evidenceCount),O.poamId||"",O.lastAssessed||"",O.notes||""]),O.children&&O.children.forEach(fe=>r(M,fe,O.controlId))};s.controlFamilies.forEach(M=>{M.controls.forEach(O=>r(M.name,O))});const l=t.map(M=>M.map(O=>`"${O}"`).join(",")).join(`
`),g=new Blob([l],{type:"text/csv"}),u=URL.createObjectURL(g),$=document.createElement("a");$.href=u,$.download=`ato-map-${s.systemName.replace(/\s+/g,"-").toLowerCase()}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(u),S.success("ATO Map exported as CSV")},ge=t=>{a(t)},ue=t=>{C(t)},be=t=>{if(!s)return;const r=g=>g.map(u=>u.id===t.id?{...t,children:u.children}:u.children?{...u,children:r(u.children)}:u),l=s.controlFamilies.map(g=>({...g,controls:r(g.controls)}));l.forEach(g=>{const u=W(g.controls);Object.assign(g,u)}),a({...s,controlFamilies:l,overallScore:X(l)}),S.success(`Control ${t.controlId} updated`)},je=t=>{if(s)switch(console.log("Zeus action:",t),t.type){case"update_status":if(t.controlId&&t.newStatus){const r=g=>g.map(u=>u.controlId===t.controlId?{...u,status:t.newStatus,notes:t.notes||u.notes}:u.children&&u.children.length>0?{...u,children:r(u.children)}:u),l=s.controlFamilies.map(g=>({...g,controls:r(g.controls)}));a({...s,controlFamilies:l}),S.success(`Control ${t.controlId} updated to ${t.newStatus}`)}break;case"bulk_update":if(t.targetStatus&&t.newStatus){const r=g=>g.map(u=>{const $=u.status===t.targetStatus?{...u,status:t.newStatus,notes:t.notes||u.notes}:u;return u.children&&u.children.length>0?{...$,children:r(u.children)}:$}),l=s.controlFamilies.map(g=>t.familyId&&g.id!==t.familyId?g:{...g,controls:r(g.controls)});a({...s,controlFamilies:l}),S.success(`Bulk updated ${t.targetStatus} controls to ${t.newStatus}`)}break;case"focus_family":if(t.familyId){m(l=>new Set([...l,t.familyId]));const r=document.getElementById(`family-${t.familyId}`);r&&r.scrollIntoView({behavior:"smooth",block:"start"}),S.info(`Focused on ${t.familyId} family`)}break;case"highlight_status":t.targetStatus&&(o(t.targetStatus),S.info(`Highlighting ${t.targetStatus} controls`));break;case"export":S.info("Opening export options...");break;default:console.log("Unknown Zeus action type:",t.type)}};if(n)return e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{})})});if(!s)return e.jsx(B,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No ATO Map Data"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Import compliance data to generate the ATO map."}),e.jsxs(E,{onClick:()=>A(!0),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Import Data"]})]})});const P=s.controlFamilies.reduce((t,r)=>{const l=U(r.controls);return{total:t.total+l.total,compliant:t.compliant+l.compliantCount,partial:t.partial+l.partialCount,nonCompliant:t.nonCompliant+l.nonCompliantCount,notAssessed:t.notAssessed+l.notAssessedCount}},{total:0,compliant:0,partial:0,nonCompliant:0,notAssessed:0});return e.jsxs(B,{children:[e.jsxs("div",{ref:D,className:"ato-map-container",children:[e.jsxs("div",{className:"hidden print:block mb-8 text-center border-b-2 border-gray-300 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Authority to Operate (ATO) Assessment Map"}),e.jsx("p",{className:"text-gray-600",children:s.systemName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Generated: ",new Date().toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6 print:hidden",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(J,{className:"w-8 h-8 text-cyan-400"}),"ATO Assessment Map"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Authority to Operate control assessment visualization"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"secondary",onClick:()=>A(!0),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Import"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(E,{variant:"secondary",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Export",e.jsx(q,{className:"w-4 h-4 ml-2"})]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsxs("button",{onClick:pe,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Export as JSON"]}),e.jsxs("button",{onClick:he,className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Export as CSV"]})]})]}),e.jsxs(E,{onClick:xe,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Print"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6 print:hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Engagement:"}),e.jsxs("select",{value:c,onChange:t=>i(t.target.value),className:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white text-sm min-w-[200px]",disabled:x==="sample",children:[e.jsx("option",{value:"",children:"All Assessments"}),N.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.customer_name?`(${t.customer_name})`:""]},t.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Data Source:"}),e.jsxs("div",{className:"flex bg-gray-800 rounded-lg border border-gray-600 overflow-hidden",children:[e.jsx("button",{onClick:()=>b("real"),className:`px-3 py-2 text-sm ${x==="real"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Real Data"}),e.jsx("button",{onClick:()=>b("sample"),className:`px-3 py-2 text-sm ${x==="sample"?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:"Sample Data"})]})]}),x==="sample"&&e.jsx("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded",children:"Using sample data - no real assessments loaded"}),x==="real"&&N.length===0&&e.jsx("span",{className:"text-xs text-orange-400 bg-orange-500/10 px-2 py-1 rounded",children:"No engagements found - create an engagement to load real data"})]}),e.jsxs(z,{className:"mb-6 print:shadow-none print:border print:border-gray-300",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(we,{className:"w-4 h-4"}),"System Name"]}),e.jsx("div",{className:"text-white font-semibold",children:s.systemName}),s.systemId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.systemId]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Organization"]}),e.jsx("div",{className:"text-white font-semibold",children:s.organization||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(Se,{className:"w-4 h-4"}),"Authorizing Official"]}),e.jsx("div",{className:"text-white font-semibold",children:s.authorizingOfficial||"Not specified"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(Y,{className:"w-4 h-4"}),"Baseline"]}),e.jsx("div",{className:"text-white font-semibold",children:s.baseline}),e.jsx("div",{className:"text-xs text-gray-500",children:s.framework})]})]}),e.jsxs("div",{className:"border-t border-gray-700 px-6 py-4 flex items-center justify-between bg-gray-800/50 print:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Assessment Date:"}),e.jsx("span",{className:"text-white",children:s.assessmentDate||"Ongoing"})]}),s.targetAtoDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-gray-400",children:"Target ATO:"}),e.jsx("span",{className:"text-cyan-400",children:s.targetAtoDate})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:s.poamCount>0&&e.jsxs("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:[s.poamCount," POA&M Items"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(z,{className:"md:col-span-2 print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-6xl font-bold mb-2",style:{color:s.overallScore>=80?"#22c55e":s.overallScore>=60?"#eab308":s.overallScore>=40?"#f97316":"#ef4444"},children:[s.overallScore,"%"]}),e.jsx("div",{className:"text-gray-400",children:"Overall Compliance Score"}),e.jsx("div",{className:"mt-4 h-3 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${s.overallScore}%`,backgroundColor:s.overallScore>=80?"#22c55e":s.overallScore>=60?"#eab308":s.overallScore>=40?"#f97316":"#ef4444"}})})]})}),e.jsx(z,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:P.compliant}),e.jsx("div",{className:"text-sm text-gray-400",children:"Compliant"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[P.total>0?Math.round(P.compliant/P.total*100):0,"%"]})]})}),e.jsx(z,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:P.partial}),e.jsx("div",{className:"text-sm text-gray-400",children:"Partial"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[P.total>0?Math.round(P.partial/P.total*100):0,"%"]})]})}),e.jsx(z,{className:"print:shadow-none print:border print:border-gray-300",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-400",children:P.nonCompliant}),e.jsx("div",{className:"text-sm text-gray-400",children:"Non-Compliant"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[P.total>0?Math.round(P.nonCompliant/P.total*100):0,"%"]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 text-sm print:text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-500"}),e.jsx("span",{className:"text-gray-300",children:"Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-500"}),e.jsx("span",{className:"text-gray-300",children:"Partially Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-gray-300",children:"Non-Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500"}),e.jsx("span",{className:"text-gray-300",children:"Not Assessed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gray-500"}),e.jsx("span",{className:"text-gray-300",children:"Not Applicable"})]}),e.jsxs("div",{className:"ml-auto flex gap-2 print:hidden",children:[e.jsx(E,{variant:"secondary",size:"sm",onClick:le,children:"Expand All"}),e.jsx(E,{variant:"secondary",size:"sm",onClick:oe,children:"Collapse All"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2 flex items-center gap-2 print:hidden",children:[e.jsx(te,{className:"w-4 h-4"}),"Drag control families to reorder"]}),e.jsx("div",{className:"space-y-4",children:s.controlFamilies.map(t=>e.jsx(Fe,{family:t,expanded:d.has(t.id),onToggle:()=>R(t.id),expandedControls:h,onToggleControl:T,onEditControl:ue,isDragging:f===t.id,onDragStart:ie,onDragOver:ce,onDrop:de,onDragEnd:me},t.id))}),e.jsxs("div",{className:"hidden print:block mt-8 pt-4 border-t border-gray-300 text-center text-sm text-gray-500",children:[e.jsx("p",{children:"Generated by HeroForge Security Assessment Platform"}),e.jsxs("p",{children:["Report Date: ",new Date().toLocaleString()]})]})]}),e.jsx(Le,{isOpen:j,onClose:()=>A(!1),onImport:ge}),e.jsx(Te,{control:I,onClose:()=>C(null),onSave:be}),e.jsx(Re,{atoData:s,onAction:je}),e.jsx("style",{children:`
        @media print {
          body {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
          }
          .ato-map-container {
            padding: 0;
            max-width: none;
          }
          .bg-gray-800, .bg-gray-900 {
            background-color: white !important;
          }
          .text-white, .text-gray-300 {
            color: black !important;
          }
          .text-gray-400, .text-gray-500 {
            color: #666 !important;
          }
          .border-gray-700 {
            border-color: #ccc !important;
          }
        }
      `})]})};export{Ge as default};
