import{j as e}from"./vendor-state-BeiY7NuG.js";import{r as c}from"./vendor-react-B7quoyFx.js";import{d as ne,C as v,L,I as M,B as j,a as G,b as q,t as se,s as Z,f as Je,n as Y,e as Ke,g as qe,u as He,h as re,m as le,i as oe,j as ee,k as te,c as Ve}from"./index-CLUXwptY.js";import{B as l,U as he,S as V,a6 as fe,al as ue,k as ae,a as ye,q as z,g as ze,s as Ae,u as Pe,am as Ge,an as Ye,P as Q,ao as Be,m as W,T as ve,ae as $,X as ie,F as We,aj as de,ap as Qe,aq as Xe,ar as Ie,w as J,as as Ze,at as we,au as pe,A as es,av as B,M as me,N as _e,d as ge,J as je,H as ss,R as ts,j as as,aw as rs,x as be,ax as ke,D as ls,K as ce,f as Fe,y as Te,ay as Ee,az as ns,aA as cs}from"./vendor-ui-CIfVO3s3.js";import"./vendor-charts-Bc9tqyL6.js";const is=()=>{var o;const[d,F]=c.useState(null),[T,h]=c.useState(!0),[g,w]=c.useState(!1),[f,C]=c.useState(!1),[i,y]=c.useState(""),[t,p]=c.useState(!1),[P,b]=c.useState(""),[N,I]=c.useState(""),[m,u]=c.useState("");c.useEffect(()=>{_()},[]);const _=async()=>{h(!0);try{const a=await ne.me();F(a.data),y(a.data.email||"")}catch(a){l.error("Failed to load profile"),console.error(a)}finally{h(!1)}},r=async a=>{var k,s;if(a.preventDefault(),!i.trim()){l.error("Email is required");return}w(!0);try{const x=await ne.updateProfile({email:i.trim()});F(x.data),l.success("Profile updated successfully")}catch(x){l.error(((s=(k=x.response)==null?void 0:k.data)==null?void 0:s.error)||"Failed to update profile")}finally{w(!1)}},S=async a=>{var k,s;if(a.preventDefault(),!P||!N){l.error("All password fields are required");return}if(N.length<6){l.error("New password must be at least 6 characters");return}if(N!==m){l.error("Passwords do not match");return}C(!0);try{await ne.changePassword({current_password:P,new_password:N}),l.success("Password changed successfully"),p(!1),b(""),I(""),u("")}catch(x){l.error(((s=(k=x.response)==null?void 0:k.data)==null?void 0:s.error)||"Failed to change password")}finally{C(!1)}},n=a=>a?new Date(a).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A";return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(he,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Profile Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-dark-bg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(he,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Username"}),e.jsx("p",{className:"text-white font-medium",children:d==null?void 0:d.username})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(V,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Roles"}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:((o=d==null?void 0:d.roles)==null?void 0:o.map(a=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-primary/20 text-primary rounded capitalize",children:a},a)))||e.jsx("span",{className:"text-slate-400",children:"No roles"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(fe,{className:"h-5 w-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Member Since"}),e.jsx("p",{className:"text-white",children:n(d==null?void 0:d.created_at)})]})]})]}),e.jsx("form",{onSubmit:r,className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300 mb-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Email Address"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(M,{type:"email",value:i,onChange:a=>y(a.target.value),placeholder:"your@email.com",className:"flex-1"}),e.jsxs(j,{type:"submit",variant:"primary",loading:g,disabled:g||i===(d==null?void 0:d.email),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Save"]})]})]})})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-6 w-6 text-yellow-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Security"})]}),!t&&e.jsx(j,{variant:"secondary",onClick:()=>p(!0),children:"Change Password"})]}),t?e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx(M,{label:"Current Password",type:"password",value:P,onChange:a=>b(a.target.value),placeholder:"Enter current password"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"New Password",type:"password",value:N,onChange:a=>I(a.target.value),placeholder:"Enter new password"}),e.jsx(M,{label:"Confirm New Password",type:"password",value:m,onChange:a=>u(a.target.value),placeholder:"Confirm new password"})]}),N&&m&&N!==m&&e.jsx("p",{className:"text-sm text-red-400",children:"Passwords do not match"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:()=>{p(!1),b(""),I(""),u("")},children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",loading:f,disabled:f||!P||!N||N!==m,children:"Update Password"})]})]}):e.jsx("p",{className:"text-slate-400",children:"Keep your account secure by using a strong, unique password."})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(V,{className:"h-6 w-6 text-green-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Account Status"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(d==null?void 0:d.is_active)!==!1?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-white",children:(d==null?void 0:d.is_active)!==!1?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Your account is in good standing."})]})]})},ds=[{id:"admin",name:"Admin",description:"Full system access"},{id:"user",name:"User",description:"Standard user access"},{id:"auditor",name:"Auditor",description:"Read-only access to all scans"},{id:"viewer",name:"Viewer",description:"Limited view access"}],os=()=>{const[d,F]=c.useState([]),[T,h]=c.useState([]),[g,w]=c.useState(!0),[f,C]=c.useState(!1),[i,y]=c.useState(new Set),[t,p]=c.useState(!1),[P,b]=c.useState(!0);c.useEffect(()=>{N()},[]);const N=async()=>{var a;w(!0);try{const k=await G.getUsers();F(k.data),b(!0)}catch(k){((a=k.response)==null?void 0:a.status)===403?b(!1):l.error("Failed to load users"),console.error(k)}finally{w(!1)}},I=async()=>{C(!0);try{const a=await G.getAuditLogs(50);h(a.data)}catch(a){l.error("Failed to load audit logs"),console.error(a)}finally{C(!1)}},m=a=>{const k=new Set(i);k.has(a)?k.delete(a):k.add(a),y(k)},u=async a=>{var k,s;try{await G.updateUser(a.id,{is_active:!a.is_active}),l.success(`User ${a.is_active?"deactivated":"activated"}`),N()}catch(x){l.error(((s=(k=x.response)==null?void 0:k.data)==null?void 0:s.error)||"Failed to update user")}},_=async a=>{var k,s;if(confirm(`Are you sure you want to delete user "${a.username}"? This cannot be undone.`))try{await G.deleteUser(a.id),l.success("User deleted"),N()}catch(x){l.error(((s=(k=x.response)==null?void 0:k.data)==null?void 0:s.error)||"Failed to delete user")}},r=async(a,k)=>{var s,x;try{await G.assignRole(a,k),l.success("Role assigned"),N()}catch(A){l.error(((x=(s=A.response)==null?void 0:s.data)==null?void 0:x.error)||"Failed to assign role")}},S=async(a,k)=>{var s,x;try{await G.removeRole(a,k),l.success("Role removed"),N()}catch(A){l.error(((x=(s=A.response)==null?void 0:s.data)==null?void 0:x.error)||"Failed to remove role")}},n=a=>new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),o=a=>{switch(a){case"admin":return"bg-red-500/20 text-red-400 border-red-500/30";case"user":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"auditor":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"viewer":return"bg-slate-500/20 text-slate-400 border-slate-500/30";default:return"bg-slate-500/20 text-slate-400 border-slate-500/30"}};return g?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):P?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"User Management"})]}),e.jsxs(q,{variant:"status",type:"completed",children:[d.length," users"]})]}),e.jsx("div",{className:"space-y-3",children:d.map(a=>{const k=i.has(a.id),s=a.roles||[];return e.jsxs("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-dark-hover transition-colors",onClick:()=>m(a.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"text-slate-400",children:k?e.jsx(Ae,{className:"h-4 w-4"}):e.jsx(Pe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a.is_active!==!1?"bg-green-400":"bg-red-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:a.username}),e.jsx("p",{className:"text-sm text-slate-400",children:a.email})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex gap-1",children:s.map(x=>e.jsx("span",{className:`px-2 py-0.5 text-xs rounded border capitalize ${o(x)}`,children:x},x))}),e.jsx("span",{className:"text-xs text-slate-500",children:a.created_at?n(a.created_at):"N/A"})]})]}),k&&e.jsxs("div",{className:"border-t border-dark-border p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Manage Roles"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:ds.map(x=>{const A=s.includes(x.id);return e.jsxs("button",{onClick:U=>{U.stopPropagation(),A?S(a.id,x.id):r(a.id,x.id)},className:`p-3 rounded-lg border text-left transition-colors ${A?"bg-primary/20 border-primary/50 text-primary":"bg-dark-surface border-dark-border text-slate-400 hover:border-primary/30"}`,children:[e.jsx("p",{className:"font-medium text-sm capitalize",children:x.name}),e.jsx("p",{className:"text-xs opacity-75",children:x.description})]},x.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-border",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(j,{variant:a.is_active!==!1?"secondary":"primary",size:"sm",onClick:x=>{x.stopPropagation(),u(a)},children:a.is_active!==!1?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Activate"]})})}),e.jsxs(j,{variant:"secondary",size:"sm",onClick:x=>{x.stopPropagation(),_(a)},className:"text-red-400 hover:text-red-300 hover:bg-red-500/10",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})]},a.id)})})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"h-6 w-6 text-purple-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Audit Logs"})]}),e.jsx(j,{variant:"secondary",onClick:()=>{p(!t),!t&&T.length===0&&I()},children:t?"Hide Logs":"Show Logs"})]}),t&&e.jsx(e.Fragment,{children:f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{})}):T.length===0?e.jsx("p",{className:"text-slate-400 text-center py-8",children:"No audit logs found"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:T.map(a=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-dark-bg rounded-lg text-sm",children:[e.jsx(W,{className:"h-4 w-4 text-slate-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-white",children:a.action}),a.target_type&&e.jsxs("span",{className:"text-slate-400",children:["on ",a.target_type]}),a.target_id&&e.jsx("span",{className:"text-xs text-slate-500 font-mono truncate max-w-32",children:a.target_id})]}),a.details&&e.jsx("p",{className:"text-xs text-slate-500 mt-1 truncate",children:a.details})]}),e.jsx("span",{className:"text-xs text-slate-500 whitespace-nowrap",children:n(a.created_at)})]},a.id))})}),!t&&e.jsx("p",{className:"text-slate-400",children:"View a log of administrative actions performed in the system."})]})]}):e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"h-12 w-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-slate-400",children:"You don't have permission to access the administration panel."}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Contact an administrator if you need elevated access."})]})})},xe=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899","#6366f1","#64748b"],ms=()=>{const[d,F]=c.useState([]),[T,h]=c.useState(!0),[g,w]=c.useState(!1),[f,C]=c.useState(null),[i,y]=c.useState({name:"",description:"",targets:"",color:xe[0]});c.useEffect(()=>{t()},[]);const t=async()=>{h(!0);try{const m=await se.getAll();F(m.data)}catch(m){l.error("Failed to load target groups"),console.error(m)}finally{h(!1)}},p=()=>{y({name:"",description:"",targets:"",color:xe[0]}),C(null),w(!1)},P=m=>{const u=JSON.parse(m.targets||"[]");y({name:m.name,description:m.description||"",targets:u.join(`
`),color:m.color}),C(m.id),w(!0)},b=async m=>{var _,r;m.preventDefault();const u=i.targets.split(`
`).map(S=>S.trim()).filter(S=>S.length>0);if(!i.name.trim()){l.error("Name is required");return}if(u.length===0){l.error("At least one target is required");return}try{f?(await se.update(f,{name:i.name,description:i.description||void 0,targets:u,color:i.color}),l.success("Target group updated")):(await se.create({name:i.name,description:i.description||void 0,targets:u,color:i.color}),l.success("Target group created")),p(),t()}catch(S){l.error(((r=(_=S.response)==null?void 0:_.data)==null?void 0:r.error)||"Failed to save target group")}},N=async(m,u)=>{var _,r;if(confirm(`Delete target group "${u}"?`))try{await se.delete(m),l.success("Target group deleted"),t()}catch(S){l.error(((r=(_=S.response)==null?void 0:_.data)==null?void 0:r.error)||"Failed to delete")}},I=m=>{try{return JSON.parse(m||"[]")}catch{return[]}};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Target Groups"})]}),!g&&e.jsxs(j,{variant:"primary",onClick:()=>w(!0),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"New Group"]})]})}),g&&e.jsx(v,{children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:f?"Edit Target Group":"Create Target Group"}),e.jsx("button",{type:"button",onClick:p,className:"text-slate-400 hover:text-white",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:i.name,onChange:m=>y({...i,name:m.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Production Servers"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Color"}),e.jsx("div",{className:"flex gap-2",children:xe.map(m=>e.jsx("button",{type:"button",onClick:()=>y({...i,color:m}),className:`w-8 h-8 rounded-full border-2 transition-all ${i.color===m?"border-white scale-110":"border-transparent"}`,style:{backgroundColor:m}},m))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:i.description,onChange:m=>y({...i,description:m.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Optional description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Targets (one per line)"}),e.jsx("textarea",{value:i.targets,onChange:m=>y({...i,targets:m.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm",rows:5,placeholder:`192.168.1.0/24
10.0.0.1
example.com`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:p,children:"Cancel"}),e.jsxs(j,{type:"submit",variant:"primary",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),f?"Update":"Create"]})]})]})}),d.length===0&&!g?e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No target groups yet"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create groups to organize your scan targets"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(m=>{const u=I(m.targets);return e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:m.color}}),e.jsx("h4",{className:"font-medium text-white",children:m.name})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>P(m),className:"p-1.5 text-slate-400 hover:text-primary transition-colors",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N(m.id,m.name),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors",children:e.jsx(Q,{className:"h-4 w-4"})})]})]}),m.description&&e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:m.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-slate-500 uppercase tracking-wide",children:[u.length," target",u.length!==1?"s":""]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.slice(0,5).map((_,r)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-dark-bg rounded text-slate-300 font-mono",children:_},r)),u.length>5&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-dark-bg rounded text-slate-500",children:["+",u.length-5," more"]})]})]})]},m.id)})})]})},Se={name:"",description:"",schedule_type:"daily",schedule_value:"02:00",targets:"",port_range_start:1,port_range_end:1e3,threads:100,enable_os_detection:!0,enable_service_detection:!0,enable_vuln_scan:!0,enable_enumeration:!1},Ce=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],xs=()=>{const[d,F]=c.useState([]),[T,h]=c.useState([]),[g,w]=c.useState(!0),[f,C]=c.useState(!1),[i,y]=c.useState(null),[t,p]=c.useState(Se),[P,b]=c.useState(0),[N,I]=c.useState(1);c.useEffect(()=>{m()},[]);const m=async()=>{w(!0);try{const[s,x]=await Promise.all([Z.getAll(),se.getAll()]);F(s.data),h(x.data)}catch(s){l.error("Failed to load scheduled scans"),console.error(s)}finally{w(!1)}},u=()=>{p(Se),y(null),C(!1),b(0),I(1)},_=s=>{const x=JSON.parse(s.config);if(p({name:s.name,description:s.description||"",schedule_type:s.schedule_type,schedule_value:s.schedule_value,targets:x.targets.join(`
`),port_range_start:x.port_range[0],port_range_end:x.port_range[1],threads:x.threads,enable_os_detection:x.enable_os_detection,enable_service_detection:x.enable_service_detection,enable_vuln_scan:x.enable_vuln_scan,enable_enumeration:x.enable_enumeration}),s.schedule_type==="weekly"){const A=s.schedule_value.split(" ");A.length>=2&&b(parseInt(A[1])||0)}else if(s.schedule_type==="monthly"){const A=s.schedule_value.split(" ");A.length>=2&&I(parseInt(A[1])||1)}y(s.id),C(!0)},r=()=>{const s=t.schedule_value.includes(":")?t.schedule_value:"02:00";switch(t.schedule_type){case"daily":return s;case"weekly":return`${s} ${P}`;case"monthly":return`${s} ${N}`;default:return s}},S=async s=>{var O,X;s.preventDefault();const x=t.targets.split(`
`).map(K=>K.trim()).filter(K=>K.length>0);if(!t.name.trim()){l.error("Name is required");return}if(x.length===0){l.error("At least one target is required");return}const A={targets:x,port_range:[t.port_range_start,t.port_range_end],threads:t.threads,enable_os_detection:t.enable_os_detection,enable_service_detection:t.enable_service_detection,enable_vuln_scan:t.enable_vuln_scan,enable_enumeration:t.enable_enumeration},U=r();try{i?(await Z.update(i,{name:t.name,description:t.description||void 0,config:A,schedule_type:t.schedule_type,schedule_value:U}),l.success("Scheduled scan updated")):(await Z.create({name:t.name,description:t.description||void 0,config:A,schedule_type:t.schedule_type,schedule_value:U}),l.success("Scheduled scan created")),u(),m()}catch(K){l.error(((X=(O=K.response)==null?void 0:O.data)==null?void 0:X.error)||"Failed to save scheduled scan")}},n=async s=>{var x,A;try{await Z.update(s.id,{is_active:!s.is_active}),l.success(`Scheduled scan ${s.is_active?"paused":"activated"}`),m()}catch(U){l.error(((A=(x=U.response)==null?void 0:x.data)==null?void 0:A.error)||"Failed to update")}},o=async(s,x)=>{var A,U;if(confirm(`Delete scheduled scan "${x}"?`))try{await Z.delete(s),l.success("Scheduled scan deleted"),m()}catch(O){l.error(((U=(A=O.response)==null?void 0:A.data)==null?void 0:U.error)||"Failed to delete")}},a=s=>{const x=JSON.parse(s.targets||"[]");p(A=>({...A,targets:x.join(`
`)}))},k=s=>{const x=s.schedule_value.split(" "),A=x[0];switch(s.schedule_type){case"daily":return`Daily at ${A}`;case"weekly":return`Every ${Ce[parseInt(x[1])||0]} at ${A}`;case"monthly":return`Monthly on day ${x[1]||1} at ${A}`;default:return s.schedule_value}};return g?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scheduled Scans"})]}),!f&&e.jsxs(j,{variant:"primary",onClick:()=>C(!0),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"New Schedule"]})]})}),f&&e.jsx(v,{children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:i?"Edit Scheduled Scan":"Create Scheduled Scan"}),e.jsx("button",{type:"button",onClick:u,className:"text-slate-400 hover:text-white",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>p({...t,name:s.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Daily Network Scan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:t.description,onChange:s=>p({...t,description:s.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Optional description"})]})]}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"})," Schedule"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Frequency"}),e.jsxs("select",{value:t.schedule_type,onChange:s=>p({...t,schedule_type:s.target.value}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.schedule_type==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Day of Week"}),e.jsx("select",{value:P,onChange:s=>b(parseInt(s.target.value)),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:Ce.map((s,x)=>e.jsx("option",{value:x,children:s},s))})]}),t.schedule_type==="monthly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Day of Month"}),e.jsx("select",{value:N,onChange:s=>I(parseInt(s.target.value)),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white",children:Array.from({length:28},(s,x)=>x+1).map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Time (UTC)"}),e.jsx("input",{type:"time",value:t.schedule_value.split(" ")[0],onChange:s=>p({...t,schedule_value:s.target.value}),className:"w-full bg-dark-surface border border-dark-border rounded-lg px-3 py-2 text-white"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Targets (one per line)"}),T.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Use group:"}),T.slice(0,3).map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:"px-2 py-0.5 text-xs rounded border border-dark-border text-slate-400 hover:text-white hover:border-primary",style:{borderLeftColor:s.color,borderLeftWidth:3},children:s.name},s.id))]})]}),e.jsx("textarea",{value:t.targets,onChange:s=>p({...t,targets:s.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm",rows:4,placeholder:`192.168.1.0/24
10.0.0.1`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Port Start"}),e.jsx("input",{type:"number",value:t.port_range_start,onChange:s=>p({...t,port_range_start:parseInt(s.target.value)||1}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",min:1,max:65535})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Port End"}),e.jsx("input",{type:"number",value:t.port_range_end,onChange:s=>p({...t,port_range_end:parseInt(s.target.value)||1e3}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",min:1,max:65535})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Threads"}),e.jsx("input",{type:"number",value:t.threads,onChange:s=>p({...t,threads:parseInt(s.target.value)||100}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white",min:1,max:1e3})]})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:[{key:"enable_os_detection",label:"OS Detection"},{key:"enable_service_detection",label:"Service Detection"},{key:"enable_vuln_scan",label:"Vulnerability Scan"},{key:"enable_enumeration",label:"Enumeration"}].map(({key:s,label:x})=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t[s],onChange:A=>p({...t,[s]:A.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-bg text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-slate-300",children:x})]},s))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:u,children:"Cancel"}),e.jsxs(j,{type:"submit",variant:"primary",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),i?"Update":"Create"]})]})]})}),d.length===0&&!f?e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No scheduled scans"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create automated recurring scans"})]})}):e.jsx("div",{className:"space-y-3",children:d.map(s=>{const x=JSON.parse(s.config);return e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.is_active?"bg-green-500/20":"bg-slate-500/20"}`,children:e.jsx(W,{className:`h-5 w-5 ${s.is_active?"text-green-400":"text-slate-400"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-white",children:s.name}),e.jsx(q,{variant:"status",type:s.is_active?"completed":"pending",children:s.is_active?"Active":"Paused"})]}),e.jsx("p",{className:"text-sm text-slate-400",children:k(s)}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[x.targets.length," target",x.targets.length!==1?"s":""," | Ports ",x.port_range[0],"-",x.port_range[1]," |",s.run_count," runs",s.last_run_at&&e.jsxs(e.Fragment,{children:[" | Last run ",Je(new Date(s.last_run_at))," ago"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(s),className:`p-2 rounded transition-colors ${s.is_active?"text-yellow-400 hover:bg-yellow-500/20":"text-green-400 hover:bg-green-500/20"}`,title:s.is_active?"Pause":"Activate",children:s.is_active?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(s),className:"p-2 text-slate-400 hover:text-primary transition-colors",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>o(s.id,s.name),className:"p-2 text-slate-400 hover:text-red-400 transition-colors",children:e.jsx(Q,{className:"h-4 w-4"})})]})]})},s.id)})})]})},hs=()=>{const[d,F]=c.useState(null),[T,h]=c.useState(!0),[g,w]=c.useState(!1),[f,C]=c.useState(!1),[i,y]=c.useState(!1),[t,p]=c.useState({email_on_scan_complete:!1,email_on_critical_vuln:!0,email_address:"",slack_webhook_url:"",teams_webhook_url:""});c.useEffect(()=>{P()},[]);const P=async()=>{var m;h(!0);try{const u=await Y.getSettings();F(u.data),p({email_on_scan_complete:u.data.email_on_scan_complete,email_on_critical_vuln:u.data.email_on_critical_vuln,email_address:u.data.email_address||"",slack_webhook_url:u.data.slack_webhook_url||"",teams_webhook_url:u.data.teams_webhook_url||""})}catch(u){((m=u.response)==null?void 0:m.status)!==404&&(l.error("Failed to load notification settings"),console.error(u))}finally{h(!1)}},b=async m=>{var u,_;if(m.preventDefault(),(t.email_on_scan_complete||t.email_on_critical_vuln)&&!t.email_address){l.error("Email address is required when notifications are enabled");return}w(!0);try{const r=await Y.updateSettings(t);F(r.data),l.success("Notification settings saved")}catch(r){l.error(((_=(u=r.response)==null?void 0:u.data)==null?void 0:_.error)||"Failed to save settings")}finally{w(!1)}},N=async()=>{var m,u;if(!t.slack_webhook_url){l.error("Please enter a Slack webhook URL first");return}C(!0);try{t.slack_webhook_url!==(d==null?void 0:d.slack_webhook_url)&&await Y.updateSettings({slack_webhook_url:t.slack_webhook_url});const _=await Y.testSlack();l.success(_.data.message)}catch(_){l.error(((u=(m=_.response)==null?void 0:m.data)==null?void 0:u.error)||"Failed to send test message")}finally{C(!1)}},I=async()=>{var m,u;if(!t.teams_webhook_url){l.error("Please enter a Teams webhook URL first");return}y(!0);try{t.teams_webhook_url!==(d==null?void 0:d.teams_webhook_url)&&await Y.updateSettings({teams_webhook_url:t.teams_webhook_url});const _=await Y.testTeams();l.success(_.data.message)}catch(_){l.error(((u=(m=_.response)==null?void 0:m.data)==null?void 0:u.error)||"Failed to send test message")}finally{y(!1)}};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Notification Settings"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Notification Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"email",value:t.email_address,onChange:m=>p({...t,email_address:m.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg pl-10 pr-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"your@email.com"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Email address where notifications will be sent"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300",children:"Email Notifications"}),e.jsxs("label",{className:"flex items-start gap-4 p-4 bg-dark-bg rounded-lg border border-dark-border cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:t.email_on_scan_complete,onChange:m=>p({...t,email_on_scan_complete:m.target.checked}),className:"mt-1 w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"font-medium text-white",children:"Scan Completion"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Receive an email when any of your scans complete, including a summary of findings"})]})]}),e.jsxs("label",{className:"flex items-start gap-4 p-4 bg-dark-bg rounded-lg border border-dark-border cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:t.email_on_critical_vuln,onChange:m=>p({...t,email_on_critical_vuln:m.target.checked}),className:"mt-1 w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"font-medium text-white",children:"Critical Vulnerabilities"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Get immediate alerts when critical or high severity vulnerabilities are discovered"})]})]})]}),e.jsx("div",{className:"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"h-5 w-5 text-blue-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-200",children:"Email notifications require SMTP to be configured on the server."}),e.jsx("p",{className:"text-xs text-blue-300/70 mt-1",children:"Contact your administrator if you're not receiving emails."})]})]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-dark-border",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Webhook Integrations"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Slack Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:t.slack_webhook_url,onChange:m=>p({...t,slack_webhook_url:m.target.value}),className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"https://hooks.slack.com/services/YOUR/WEBHOOK/URL"}),e.jsx(j,{type:"button",variant:"secondary",onClick:N,disabled:!t.slack_webhook_url||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx("span",{className:"ml-2",children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Test"]})})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Send scan notifications to a Slack channel. Create a webhook at"," ",e.jsx("a",{href:"https://api.slack.com/messaging/webhooks",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Slack Incoming Webhooks"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Microsoft Teams Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:t.teams_webhook_url,onChange:m=>p({...t,teams_webhook_url:m.target.value}),className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"https://outlook.office.com/webhook/YOUR/WEBHOOK/URL"}),e.jsx(j,{type:"button",variant:"secondary",onClick:I,disabled:!t.teams_webhook_url||i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx("span",{className:"ml-2",children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Test"]})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Send scan notifications to a Teams channel. Create a webhook in your Teams channel connectors."})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{type:"submit",variant:"primary",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Save Settings"]})})})]})]}),d&&e.jsxs(v,{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"Current Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Scan Complete Emails:"}),e.jsx("span",{className:`ml-2 ${d.email_on_scan_complete?"text-green-400":"text-slate-400"}`,children:d.email_on_scan_complete?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Critical Vuln Alerts:"}),e.jsx("span",{className:`ml-2 ${d.email_on_critical_vuln?"text-green-400":"text-slate-400"}`,children:d.email_on_critical_vuln?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-500",children:"Last Updated:"}),e.jsx("span",{className:"ml-2 text-slate-300",children:new Date(d.updated_at).toLocaleString()})]})]})]})]})},us=()=>{const[d,F]=c.useState([]),[T,h]=c.useState(!0),[g,w]=c.useState(""),[f,C]=c.useState(""),[i,y]=c.useState(!1),[t,p]=c.useState(null),[P,b]=c.useState(new Set);c.useEffect(()=>{N()},[]);const N=async()=>{h(!0);try{const S=(await Ke.getAll()).data.filter(n=>n.status==="completed");F(S)}catch(r){l.error("Failed to load scans"),console.error(r)}finally{h(!1)}},I=async()=>{var r,S;if(!g||!f){l.error("Please select two scans to compare");return}if(g===f){l.error("Please select two different scans");return}y(!0);try{const n=await qe.compare(g,f);p(n.data),l.success("Comparison completed")}catch(n){l.error(((S=(r=n.response)==null?void 0:r.data)==null?void 0:S.error)||"Failed to compare scans"),console.error(n)}finally{y(!1)}},m=r=>{const S=new Set(P);S.has(r)?S.delete(r):S.add(r),b(S)},u=r=>{switch(r){case"NewService":return e.jsx($,{className:"h-3 w-3 text-green-400"});case"ServiceRemoved":return e.jsx(B,{className:"h-3 w-3 text-red-400"});case"ServiceChanged":case"VersionChanged":return e.jsx(me,{className:"h-3 w-3 text-yellow-400"});default:return null}},_=r=>{switch(r){case"NewService":return"New Service";case"ServiceRemoved":return"Service Removed";case"ServiceChanged":return"Service Changed";case"VersionChanged":return"Version Changed";default:return r}};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Compare Scans"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Select two completed scans to compare their results and identify changes in hosts, ports, services, and vulnerabilities."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Baseline Scan (Older)"}),e.jsxs("select",{value:g,onChange:r=>w(r.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),d.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - ",new Date(r.created_at).toLocaleString()]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Comparison Scan (Newer)"}),e.jsxs("select",{value:f,onChange:r=>C(r.target.value),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a scan..."}),d.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - ",new Date(r.created_at).toLocaleString()]},r.id))]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{variant:"primary",onClick:I,loading:i,disabled:!g||!f||g===f,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Compare Scans"]})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(es,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Comparison Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Hosts"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:t.diff.summary.total_new_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(B,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Removed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:t.diff.summary.total_removed_hosts})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(me,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Changed"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:t.diff.summary.total_hosts_changed})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_e,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Ports"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:t.diff.summary.total_new_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_e,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Closed"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:t.diff.summary.total_closed_ports})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(z,{className:"h-4 w-4 text-red-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"New Vulns"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:t.diff.summary.total_new_vulnerabilities})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:t.diff.summary.total_resolved_vulnerabilities})]})]})]}),t.diff.new_hosts.length>0&&e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($,{className:"h-5 w-5 text-green-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["New Hosts (",t.diff.new_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.diff.new_hosts.map(r=>e.jsx("span",{className:"px-3 py-1.5 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 font-mono text-sm",children:r},r))})]}),t.diff.removed_hosts.length>0&&e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"h-5 w-5 text-red-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Removed Hosts (",t.diff.removed_hosts.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.diff.removed_hosts.map(r=>e.jsx("span",{className:"px-3 py-1.5 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 font-mono text-sm",children:r},r))})]}),t.diff.host_changes.length>0&&e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ge,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Host Changes (",t.diff.host_changes.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:t.diff.host_changes.map(r=>{const S=P.has(r.ip);return r.new_ports.length>0||r.closed_ports.length>0||r.new_vulnerabilities.length>0||r.resolved_vulnerabilities.length>0||r.service_changes.length>0||r.os_change!==null?e.jsxs("div",{className:"bg-dark-bg rounded-lg border border-dark-border overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(r.ip),className:"w-full flex items-center justify-between p-4 hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[S?e.jsx(Ae,{className:"h-4 w-4 text-slate-400"}):e.jsx(Pe,{className:"h-4 w-4 text-slate-400"}),e.jsx(ge,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-mono text-white",children:r.ip}),r.hostname&&e.jsxs("span",{className:"text-sm text-slate-400",children:["(",r.hostname,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.new_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["+",r.new_ports.length," ports"]}),r.closed_ports.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["-",r.closed_ports.length," ports"]}),r.new_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-xs text-red-400",children:["+",r.new_vulnerabilities.length," vulns"]}),r.resolved_vulnerabilities.length>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400",children:["-",r.resolved_vulnerabilities.length," vulns"]})]})]}),S&&e.jsxs("div",{className:"border-t border-dark-border p-4 space-y-4",children:[r.os_change&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-slate-300 mb-2",children:"Operating System Change"}),e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-sm text-red-400",children:[r.os_change.old_os," (",r.os_change.old_confidence,"% confidence)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-sm text-green-400",children:[r.os_change.new_os," (",r.os_change.new_confidence,"% confidence)"]})]})]})]}),r.new_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-green-400"}),"New Open Ports (",r.new_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:r.new_ports.map(o=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-green-400",children:[o.port,"/",o.protocol]}),o.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[o.service.name,o.service.version&&` ${o.service.version}`]})]},o.port))})]}),r.closed_ports.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-red-400"}),"Closed Ports (",r.closed_ports.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:r.closed_ports.map(o=>e.jsxs("div",{className:"bg-dark-surface rounded p-2 flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-red-400",children:[o.port,"/",o.protocol]}),o.service&&e.jsxs("span",{className:"text-xs text-slate-400",children:[o.service.name,o.service.version&&` ${o.service.version}`]})]},o.port))})]}),r.service_changes.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-yellow-400"}),"Service Changes (",r.service_changes.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.service_changes.map((o,a)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-mono text-sm text-white",children:[o.port,"/",o.protocol]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u(o.change_type),e.jsx("span",{className:"text-xs text-yellow-400",children:_(o.change_type)})]})]}),o.old_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"h-3 w-3 text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[o.old_service,o.old_version&&` ${o.old_version}`]})]}),o.new_service&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($,{className:"h-3 w-3 text-green-400"}),e.jsxs("span",{className:"text-green-400",children:[o.new_service,o.new_version&&` ${o.new_version}`]})]})]},a))})]}),r.new_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-red-400"}),"New Vulnerabilities (",r.new_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.new_vulnerabilities.map((o,a)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:o.cve_id||o.title}),e.jsx(q,{variant:"severity",type:o.severity.toLowerCase(),children:o.severity})]}),e.jsx("p",{className:"text-xs text-slate-400",children:o.description}),o.affected_service&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Service: ",o.affected_service]})]},a))})]}),r.resolved_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-green-400"}),"Resolved Vulnerabilities (",r.resolved_vulnerabilities.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.resolved_vulnerabilities.map((o,a)=>e.jsxs("div",{className:"bg-dark-surface rounded p-3 space-y-1 opacity-75",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-green-400 line-through",children:o.cve_id||o.title}),e.jsx(q,{variant:"severity",type:o.severity.toLowerCase(),children:o.severity})]}),e.jsx("p",{className:"text-xs text-slate-500",children:o.description})]},a))})]})]})]},r.ip):null})})]}),t.diff.new_hosts.length===0&&t.diff.removed_hosts.length===0&&t.diff.host_changes.length===0&&e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"h-12 w-12 text-green-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-white font-medium mb-2",children:"No Changes Detected"}),e.jsx("p",{className:"text-sm text-slate-400",children:"The selected scans have identical results"})]})})]}),!t&&d.length===0&&e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No completed scans available"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Complete at least two scans to use the comparison feature"})]})})]})},ps=()=>{const[d,F]=c.useState([]),[T,h]=c.useState(!0),[g,w]=c.useState(!1),[f,C]=c.useState(null),[i,y]=c.useState({name:"",description:""}),[t,p]=c.useState(new Set),{addScan:P}=He();c.useEffect(()=>{b()},[]);const b=async()=>{h(!0);try{const n=await re.getAll();F(n.data)}catch(n){l.error("Failed to load templates"),console.error(n)}finally{h(!1)}},N=()=>{y({name:"",description:""}),C(null),w(!1)},I=n=>{y({name:n.name,description:n.description||""}),C(n.id),w(!0)},m=async n=>{var o,a;if(n.preventDefault(),!i.name.trim()){l.error("Name is required");return}if(!f){l.error('Cannot create templates from this form. Use "Save as Template" in the scan form.');return}try{await re.update(f,{name:i.name,description:i.description||void 0}),l.success("Template updated"),N(),b()}catch(k){l.error(((a=(o=k.response)==null?void 0:o.data)==null?void 0:a.error)||"Failed to update template")}},u=async(n,o)=>{var a,k;if(confirm(`Delete template "${o}"?`))try{await re.delete(n),l.success("Template deleted"),b()}catch(s){l.error(((k=(a=s.response)==null?void 0:a.data)==null?void 0:k.error)||"Failed to delete")}},_=async(n,o)=>{var k,s;const a=prompt(`Enter name for new scan (based on "${o}"):`,`${o} - ${new Date().toLocaleDateString()}`);if(a){p(new Set([...t,n]));try{const x=await re.createScan(n,a);P(x.data),l.success("Scan started from template!")}catch(x){l.error(((s=(k=x.response)==null?void 0:k.data)==null?void 0:s.error)||"Failed to create scan")}finally{p(x=>{const A=new Set(x);return A.delete(n),A})}}},r=n=>{try{return JSON.parse(n)}catch{return null}},S=n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Scan Templates"})]}),e.jsx("div",{className:"text-sm text-slate-400",children:"Save scan configurations for quick reuse"})]})}),g&&e.jsx(v,{children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Edit Template"}),e.jsx("button",{type:"button",onClick:N,className:"text-slate-400 hover:text-white",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:i.name,onChange:n=>y({...i,name:n.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Production Network Template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:n=>y({...i,description:n.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",rows:3,placeholder:"Optional description"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:N,children:"Cancel"}),e.jsxs(j,{type:"submit",variant:"primary",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Update"]})]})]})}),d.length===0&&!g?e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No scan templates yet"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:'Save scan configurations using "Save as Template" when creating a scan'})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:d.map(n=>{const o=r(n.config),a=t.has(n.id);return e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white text-lg",children:n.name}),n.description&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:n.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>I(n),className:"p-1.5 text-slate-400 hover:text-primary transition-colors",title:"Edit template",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>u(n.id,n.name),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors",title:"Delete template",children:e.jsx(Q,{className:"h-4 w-4"})})]})]}),o&&e.jsxs("div",{className:"space-y-2 border-t border-dark-border pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-slate-500"}),e.jsxs("span",{className:"text-slate-400",children:[o.targets.length," target",o.targets.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-slate-500"}),e.jsxs("span",{className:"text-slate-400",children:["Ports: ",o.port_range[0],"-",o.port_range[1]]})]}),o.scan_type&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-slate-500"}),e.jsx("span",{className:"text-slate-400 capitalize",children:o.scan_type.replace("_"," ")})]}),o.enable_enumeration&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4 text-slate-500"}),e.jsxs("span",{className:"text-slate-400",children:["Enumeration: ",o.enum_depth||"light"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[o.enable_os_detection&&e.jsx(q,{variant:"status",type:"completed",children:"OS Detection"}),o.enable_service_detection&&e.jsx(q,{variant:"status",type:"completed",children:"Services"}),o.enable_vuln_scan&&e.jsx(q,{variant:"status",type:"running",children:"Vuln Scan"}),o.enable_enumeration&&e.jsx(q,{variant:"status",type:"pending",children:"Enumeration"})]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-dark-border pt-4",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["Created ",S(n.created_at)]}),e.jsxs(j,{variant:"primary",size:"sm",onClick:()=>_(n.id,n.name),loading:a,disabled:a,children:[e.jsx(rs,{className:"h-4 w-4 mr-1.5"}),"Create Scan"]})]})]})},n.id)})})]})},gs=()=>{const[d,F]=c.useState(!1),[T,h]=c.useState(!0),[g,w]=c.useState("idle"),[f,C]=c.useState(""),[i,y]=c.useState(""),[t,p]=c.useState([]),[P,b]=c.useState(""),[N,I]=c.useState(!1),[m,u]=c.useState(!1),[_,r]=c.useState(""),[S,n]=c.useState(""),[o,a]=c.useState(!1),[k,s]=c.useState(!1),[x,A]=c.useState(""),[U,O]=c.useState(""),[X,K]=c.useState(!1);c.useEffect(()=>{Re()},[]);const Re=async()=>{h(!0);try{const E=await ne.me();F(E.data.mfa_enabled||!1)}catch(E){console.error("Failed to check MFA status:",E)}finally{h(!1)}},Le=async()=>{var E,D;try{const R=await le.setup();C(R.data.secret),y(R.data.qr_code_url),p(R.data.recovery_codes),w("scan-qr")}catch(R){l.error(((D=(E=R.response)==null?void 0:E.data)==null?void 0:D.error)||"Failed to initialize MFA setup")}},De=async E=>{var D,R;if(E.preventDefault(),!P||P.length!==6){l.error("Please enter a valid 6-digit code");return}I(!0);try{await le.verifySetup({totp_code:P}),l.success("MFA enabled successfully!"),w("show-recovery"),F(!0)}catch(H){l.error(((R=(D=H.response)==null?void 0:D.data)==null?void 0:R.error)||"Invalid verification code")}finally{I(!1)}},Me=()=>{w("idle"),C(""),y(""),p([]),b("")},Ue=async E=>{var D,R;if(E.preventDefault(),!_||!S){l.error("Password and TOTP code are required");return}a(!0);try{await le.disable({password:_,totp_code:S}),l.success("MFA disabled successfully"),F(!1),u(!1),r(""),n("")}catch(H){l.error(((R=(D=H.response)==null?void 0:D.data)==null?void 0:R.error)||"Failed to disable MFA")}finally{a(!1)}},$e=async E=>{var D,R;if(E.preventDefault(),!x||!U){l.error("Password and TOTP code are required");return}K(!0);try{const H=await le.regenerateRecoveryCodes({password:x,totp_code:U});p(H.data.recovery_codes),l.success("Recovery codes regenerated successfully"),s(!1),A(""),O(""),w("show-recovery")}catch(H){l.error(((R=(D=H.response)==null?void 0:D.data)==null?void 0:R.error)||"Failed to regenerate recovery codes")}finally{K(!1)}},Ne=E=>{navigator.clipboard.writeText(E),l.success("Copied to clipboard")},Oe=()=>{const E=new Blob([t.join(`
`)],{type:"text/plain"}),D=URL.createObjectURL(E),R=document.createElement("a");R.href=D,R.download="heroforge-recovery-codes.txt",document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(D),l.success("Recovery codes downloaded")};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):g!=="idle"?e.jsx("div",{className:"space-y-6",children:e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Enable Two-Factor Authentication"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("span",{className:g==="scan-qr"?"text-primary":"",children:"1. Scan QR"}),e.jsx("span",{children:""}),e.jsx("span",{className:g==="verify-code"?"text-primary":"",children:"2. Verify"}),e.jsx("span",{children:""}),e.jsx("span",{className:g==="show-recovery"?"text-primary":"",children:"3. Save Codes"})]})]}),g==="scan-qr"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-dark-bg rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Step 1: Scan QR Code"}),e.jsx("p",{className:"text-slate-400 text-sm text-center mb-6 max-w-md",children:"Use an authenticator app like Google Authenticator, Authy, or 1Password to scan this QR code:"}),i&&e.jsx("div",{className:"bg-white p-4 rounded-lg mb-4",children:e.jsx("img",{src:i,alt:"MFA QR Code",className:"w-64 h-64"})}),e.jsxs("div",{className:"mt-4 w-full max-w-md",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Or enter this secret manually:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"text",value:f,readOnly:!0,className:"font-mono text-sm flex-1"}),e.jsx(j,{variant:"secondary",onClick:()=>Ne(f),children:e.jsx(be,{className:"h-4 w-4"})})]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{variant:"primary",onClick:()=>w("verify-code"),children:"Next: Verify Code"})})]}),g==="verify-code"&&e.jsxs("form",{onSubmit:De,className:"space-y-6",children:[e.jsx("div",{className:"bg-dark-bg rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ke,{className:"h-12 w-12 text-primary mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Step 2: Verify Your Code"}),e.jsx("p",{className:"text-slate-400 text-sm text-center mb-6 max-w-md",children:"Enter the 6-digit code from your authenticator app to confirm setup:"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx(M,{type:"text",value:P,onChange:E=>b(E.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center text-2xl tracking-widest font-mono",maxLength:6,autoFocus:!0})})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:()=>w("scan-qr"),children:"Back"}),e.jsx(j,{type:"submit",variant:"primary",loading:N,disabled:N||P.length!==6,children:"Verify & Enable MFA"})]})]}),g==="show-recovery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"h-6 w-6 text-yellow-400 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-yellow-400 mb-2",children:"Save Your Recovery Codes"}),e.jsx("p",{className:"text-slate-300 text-sm mb-4",children:"Store these recovery codes in a safe place. Each code can be used once to access your account if you lose your authenticator device."}),e.jsx("div",{className:"grid grid-cols-2 gap-2 bg-dark-bg rounded-lg p-4 font-mono text-sm mb-4",children:t.map((E,D)=>e.jsxs("div",{className:"text-white",children:[D+1,". ",E]},D))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"secondary",onClick:()=>Ne(t.join(`
`)),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Copy Codes"]}),e.jsxs(j,{variant:"secondary",onClick:Oe,children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"Download Codes"]})]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{variant:"primary",onClick:Me,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Finish Setup"]})})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(V,{className:"h-6 w-6 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Two-Factor Authentication"})]}),e.jsxs("div",{className:"flex items-start justify-between mb-6 p-4 bg-dark-bg rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[d?e.jsx(J,{className:"h-6 w-6 text-green-400 flex-shrink-0"}):e.jsx(z,{className:"h-6 w-6 text-yellow-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:d?"MFA Enabled":"MFA Disabled"}),e.jsx("p",{className:"text-sm text-slate-400",children:d?"Your account is protected with two-factor authentication.":"Enable MFA to add an extra layer of security to your account."})]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${d?"bg-green-400":"bg-yellow-400"}`})]}),d?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),e.jsx("h5",{className:"font-medium text-white",children:"Recovery Codes"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Generate new recovery codes if you've lost the originals or used them."}),e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>s(!0),children:"Regenerate Codes"})]}),e.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"h-5 w-5 text-red-400"}),e.jsx("h5",{className:"font-medium text-white",children:"Disable MFA"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Turn off two-factor authentication for your account."}),e.jsx(j,{variant:"danger",size:"sm",onClick:()=>u(!0),children:"Disable MFA"})]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[e.jsx("h5",{className:"text-white font-medium mb-2",children:"Why enable MFA?"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Adds an extra layer of security beyond your password"}),e.jsx("li",{children:"Prevents unauthorized access even if your password is compromised"}),e.jsx("li",{children:"Uses time-based codes from your smartphone"}),e.jsx("li",{children:"Industry standard for securing sensitive accounts"})]})]}),e.jsxs(j,{variant:"primary",onClick:Le,children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Enable Two-Factor Authentication"]})]})]}),m&&e.jsx(v,{children:e.jsxs("form",{onSubmit:Ue,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Disable Two-Factor Authentication"}),e.jsxs("button",{type:"button",onClick:()=>{u(!1),r(""),n("")},className:"text-slate-400 hover:text-white",children:[e.jsx("span",{className:"sr-only",children:"Close"}),""]})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-300",children:"Disabling MFA will make your account less secure. You'll need to provide your password and a TOTP code to confirm."})}),e.jsx(M,{label:"Password",type:"password",value:_,onChange:E=>r(E.target.value),placeholder:"Your account password",autoComplete:"current-password"}),e.jsx(M,{label:"TOTP Code",type:"text",value:S,onChange:E=>n(E.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center tracking-widest font-mono",maxLength:6}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:()=>{u(!1),r(""),n("")},children:"Cancel"}),e.jsx(j,{type:"submit",variant:"danger",loading:o,disabled:o||!_||S.length!==6,children:"Disable MFA"})]})]})}),k&&e.jsx(v,{children:e.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Regenerate Recovery Codes"}),e.jsxs("button",{type:"button",onClick:()=>{s(!1),A(""),O("")},className:"text-slate-400 hover:text-white",children:[e.jsx("span",{className:"sr-only",children:"Close"}),""]})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-300",children:"This will invalidate all existing recovery codes. Make sure to save the new codes in a safe place."})}),e.jsx(M,{label:"Password",type:"password",value:x,onChange:E=>A(E.target.value),placeholder:"Your account password",autoComplete:"current-password"}),e.jsx(M,{label:"TOTP Code",type:"text",value:U,onChange:E=>O(E.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center tracking-widest font-mono",maxLength:6}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:()=>{s(!1),A(""),O("")},children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",loading:X,disabled:X||!x||U.length!==6,children:"Generate New Codes"})]})]})})]})},js=()=>{const[d,F]=c.useState([]),[T,h]=c.useState(!0),[g,w]=c.useState(!1),[f,C]=c.useState(""),[i,y]=c.useState(!1),[t,p]=c.useState(null);c.useEffect(()=>{P()},[]);const P=async()=>{h(!0);try{const u=await oe.getAll();F(u.data)}catch(u){l.error("Failed to load API keys"),console.error(u)}finally{h(!1)}},b=async()=>{var u,_;if(!f.trim()){l.error("Please enter a name for the API key");return}y(!0);try{const r=await oe.create({name:f.trim()});p(r.data),C(""),await P(),l.success("API key created successfully")}catch(r){l.error(((_=(u=r.response)==null?void 0:u.data)==null?void 0:_.error)||"Failed to create API key")}finally{y(!1)}},N=async(u,_)=>{var r,S;if(confirm(`Are you sure you want to revoke the API key "${_}"? This action cannot be undone.`))try{await oe.delete(u),await P(),l.success("API key revoked successfully")}catch(n){l.error(((S=(r=n.response)==null?void 0:r.data)==null?void 0:S.error)||"Failed to revoke API key")}},I=u=>{navigator.clipboard.writeText(u),l.success("API key copied to clipboard")},m=()=>{p(null),w(!1)};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"API Keys"})]}),e.jsxs(j,{variant:"primary",onClick:()=>w(!0),className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Create API Key"]})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"API keys allow programmatic access to HeroForge. Keep your keys secure and never share them publicly."}),d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"h-12 w-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No API keys yet"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-3",children:d.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-white",children:u.name}),e.jsxs("code",{className:"px-2 py-1 bg-dark-surface rounded text-xs text-slate-400 font-mono",children:[u.prefix,"..."]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-3 w-3"}),"Created ",new Date(u.created_at).toLocaleDateString()]}),u.last_used_at&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),"Last used ",new Date(u.last_used_at).toLocaleDateString()]}),!u.last_used_at&&e.jsx("span",{className:"text-amber-500",children:"Never used"})]})]}),e.jsxs(j,{variant:"danger",size:"sm",onClick:()=>N(u.id,u.name),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Revoke"]})]},u.id))})]}),g&&!t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Create API Key"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:f,onChange:u=>C(u.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",autoFocus:!0}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Give your API key a descriptive name to remember where it's used"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx(j,{variant:"secondary",onClick:()=>{w(!1),C("")},children:"Cancel"}),e.jsx(j,{variant:"primary",onClick:b,disabled:i||!f.trim(),children:i?e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx("span",{className:"ml-2",children:"Creating..."})]}):"Create Key"})]})]})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg p-6 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(J,{className:"h-6 w-6 text-green-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"API Key Created Successfully"})]}),e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-amber-200 font-medium mb-2",children:"Important: Save your API key now!"}),e.jsx("p",{className:"text-xs text-amber-300/70",children:"This is the only time you'll see the full key. If you lose it, you'll need to create a new one."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-dark-bg border border-dark-border rounded-lg px-4 py-3 text-white font-mono text-sm break-all",children:t.key}),e.jsxs(j,{variant:"secondary",onClick:()=>I(t.key),className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Copy"]})]})]}),e.jsxs("div",{className:"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-200 mb-2",children:"Using your API key"}),e.jsx("p",{className:"text-xs text-blue-300/70 mb-3",children:"Include your API key in the X-API-Key header:"}),e.jsxs("code",{className:"block bg-dark-bg border border-dark-border rounded px-3 py-2 text-xs text-slate-300 font-mono",children:['curl -H "X-API-Key: ',t.key,'" https://heroforge.example.com/api/scans']})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(j,{variant:"primary",onClick:m,children:"Done"})})]})]})})]})},bs=()=>{const[d,F]=c.useState(!0),[T,h]=c.useState(!1),[g,w]=c.useState(!1),[f,C]=c.useState(!1),[i,y]=c.useState({jira_url:"",username:"",api_token:"",project_key:"",issue_type:"Task",default_assignee:"",enabled:!0}),[t,p]=c.useState([]),[P,b]=c.useState([]),[N,I]=c.useState(!1);c.useEffect(()=>{m()},[]);const m=async()=>{var n;F(!0);try{const o=await ee.getSettings();y(o.data),C(!0)}catch(o){((n=o.response)==null?void 0:n.status)===404?C(!1):console.error("Failed to load JIRA settings:",o)}finally{F(!1)}},u=async()=>{var n,o;if(!i.jira_url||!i.username||!i.api_token||!i.project_key){l.error("Please fill in all required fields");return}h(!0);try{await ee.updateSettings(i),l.success("JIRA settings saved successfully"),C(!0)}catch(a){console.error("Failed to save JIRA settings:",a),l.error(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.error)||"Failed to save JIRA settings")}finally{h(!1)}},_=async()=>{var n,o;if(!f){l.error("Please save your settings first");return}w(!0);try{await ee.testConnection(),l.success("JIRA connection successful!")}catch(a){console.error("JIRA connection failed:",a),l.error(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.error)||"JIRA connection failed")}finally{w(!1)}},r=async()=>{var n,o;if(!f){l.error("Please save your settings first");return}I(!0);try{const a=await ee.listProjects();p(a.data),l.success(`Loaded ${a.data.length} projects`)}catch(a){console.error("Failed to load projects:",a),l.error(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.error)||"Failed to load projects")}finally{I(!1)}},S=async()=>{var n,o;if(!f||!i.project_key){l.error("Please save your settings and select a project first");return}I(!0);try{const a=await ee.listIssueTypes();b(a.data),l.success(`Loaded ${a.data.length} issue types`)}catch(a){console.error("Failed to load issue types:",a),l.error(((o=(n=a.response)==null?void 0:n.data)==null?void 0:o.error)||"Failed to load issue types")}finally{I(!1)}};return d?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Fe,{className:"h-6 w-6 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"JIRA Integration"})]}),e.jsxs("div",{className:"space-y-4",children:[!f&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"JIRA Integration Not Configured"}),e.jsx("p",{children:"Configure your JIRA instance to automatically create tickets from vulnerabilities."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["JIRA URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(M,{type:"url",placeholder:"https://your-domain.atlassian.net",value:i.jira_url,onChange:n=>y({...i,jira_url:n.target.value})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Your JIRA instance URL (e.g., https://company.atlassian.net)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Username/Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(M,{type:"text",placeholder:"user@example.com",value:i.username,onChange:n=>y({...i,username:n.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["API Token ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(M,{type:"password",placeholder:"Your JIRA API token",value:i.api_token,onChange:n=>y({...i,api_token:n.target.value})}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Generate an API token at"," ",e.jsxs("a",{href:"https://id.atlassian.com/manage-profile/security/api-tokens",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 inline-flex items-center gap-1",children:["Atlassian Account Settings ",e.jsx(Te,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Project Key ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:t.length>0?e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:i.project_key,onChange:n=>y({...i,project_key:n.target.value}),children:[e.jsx("option",{value:"",children:"Select a project"}),t.map(n=>e.jsxs("option",{value:n.key,children:[n.name," (",n.key,")"]},n.key))]}):e.jsx(M,{type:"text",placeholder:"PROJECT",value:i.project_key,onChange:n=>y({...i,project_key:n.target.value})})}),e.jsx(j,{onClick:r,disabled:!f||N,variant:"secondary",children:N?"Loading...":"Load Projects"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Issue Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:P.length>0?e.jsx("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:i.issue_type,onChange:n=>y({...i,issue_type:n.target.value}),children:P.map(n=>e.jsx("option",{value:n.name,children:n.name},n.id))}):e.jsx(M,{type:"text",placeholder:"Task",value:i.issue_type,onChange:n=>y({...i,issue_type:n.target.value})})}),e.jsx(j,{onClick:S,disabled:!f||!i.project_key||N,variant:"secondary",children:N?"Loading...":"Load Types"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Assignee (optional)"}),e.jsx(M,{type:"text",placeholder:"username",value:i.default_assignee||"",onChange:n=>y({...i,default_assignee:n.target.value})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave empty for unassigned or enter a JIRA username"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"jira-enabled",checked:i.enabled,onChange:n=>y({...i,enabled:n.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"jira-enabled",className:"text-sm font-medium text-gray-700",children:"Enable JIRA integration"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{onClick:u,disabled:T,children:T?"Saving...":"Save Settings"}),e.jsx(j,{onClick:_,disabled:!f||g,variant:"secondary",children:g?"Testing...":"Test Connection"})]}),f&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"JIRA Integration Configured"}),e.jsx("p",{children:"You can now create JIRA tickets from vulnerabilities."})]})]})]})]}),e.jsxs(v,{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"How to Use JIRA Integration"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"1"})}),e.jsx("p",{children:"Configure your JIRA instance settings above and test the connection."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"2"})}),e.jsx("p",{children:"Navigate to any vulnerability in your scans."})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"3"})}),e.jsx("p",{children:'Click the "Create JIRA Ticket" button to automatically create an issue with vulnerability details.'})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-700 font-semibold text-xs",children:"4"})}),e.jsx("p",{children:"The vulnerability will be linked to the JIRA ticket, and you can track it in your JIRA project."})]})]})]})]})},fs=()=>{const[d,F]=c.useState([]),[T,h]=c.useState(!0),[g,w]=c.useState(!1),[f,C]=c.useState(null),[i,y]=c.useState(null);c.useEffect(()=>{t()},[]);const t=async()=>{h(!0);try{const b=await te.getSettings();F(b.data)}catch(b){l.error("Failed to load SIEM settings"),console.error(b)}finally{h(!1)}},p=async b=>{var N,I;y(b);try{const m=await te.testConnection(b);m.data.success?l.success("Connection test successful!"):l.error(`Connection test failed: ${m.data.message}`)}catch(m){l.error(((I=(N=m.response)==null?void 0:N.data)==null?void 0:I.error)||"Connection test failed")}finally{y(null)}},P=async b=>{var N,I;if(confirm("Are you sure you want to delete this SIEM integration?"))try{await te.deleteSettings(b),l.success("SIEM integration deleted"),t()}catch(m){l.error(((I=(N=m.response)==null?void 0:N.data)==null?void 0:I.error)||"Failed to delete SIEM integration")}};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"SIEM Integrations"})]}),e.jsxs(j,{variant:"primary",onClick:()=>w(!0),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Add Integration"]})]}),d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"h-12 w-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"No SIEM integrations configured"}),e.jsxs(j,{variant:"primary",onClick:()=>w(!0),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Add Your First Integration"]})]}):e.jsx("div",{className:"space-y-4",children:d.map(b=>e.jsx("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/20 text-primary rounded-md text-sm font-medium uppercase",children:b.siem_type}),b.enabled?e.jsxs("span",{className:"flex items-center gap-1 text-green-400 text-sm",children:[e.jsx(J,{className:"h-4 w-4"}),"Enabled"]}):e.jsxs("span",{className:"flex items-center gap-1 text-slate-500 text-sm",children:[e.jsx(ns,{className:"h-4 w-4"}),"Disabled"]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-500",children:"Endpoint:"}),e.jsx("span",{className:"text-white font-mono",children:b.endpoint_url})]}),b.protocol&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-500",children:"Protocol:"}),e.jsx("span",{className:"text-white uppercase",children:b.protocol})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.export_on_scan_complete,disabled:!0,className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary"}),e.jsx("span",{className:"text-slate-400",children:"Export on scan complete"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.export_on_critical_vuln,disabled:!0,className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary"}),e.jsx("span",{className:"text-slate-400",children:"Export critical vulnerabilities"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>p(b.id),disabled:i===b.id,children:i===b.id?e.jsx(L,{}):e.jsx(cs,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>C(b),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>P(b.id),children:e.jsx(Q,{className:"h-4 w-4 text-red-400"})})]})]})},b.id))})]}),e.jsxs(v,{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"About SIEM Integration"}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-400",children:[e.jsx("p",{children:"SIEM (Security Information and Event Management) integration allows HeroForge to automatically export scan results and vulnerability findings to your security monitoring platform."}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Syslog:"})," RFC 5424 compliant syslog over TCP/UDP"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Splunk:"})," Splunk HTTP Event Collector (HEC)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Elasticsearch:"})," Direct indexing via Bulk API"]})]})]})]}),(g||f)&&e.jsx(ys,{settings:f,onClose:()=>{w(!1),C(null)},onSave:()=>{w(!1),C(null),t()}})]})},ys=({settings:d,onClose:F,onSave:T})=>{const[h,g]=c.useState({siem_type:(d==null?void 0:d.siem_type)||"syslog",endpoint_url:(d==null?void 0:d.endpoint_url)||"",api_key:(d==null?void 0:d.api_key)||"",protocol:(d==null?void 0:d.protocol)||"tcp",enabled:(d==null?void 0:d.enabled)??!0,export_on_scan_complete:(d==null?void 0:d.export_on_scan_complete)??!1,export_on_critical_vuln:(d==null?void 0:d.export_on_critical_vuln)??!0}),[w,f]=c.useState(!1),C=async i=>{var y,t;if(i.preventDefault(),!h.endpoint_url){l.error("Endpoint URL is required");return}if(h.siem_type==="splunk"&&!h.api_key){l.error("API key is required for Splunk HEC");return}f(!0);try{if(d){const p={endpoint_url:h.endpoint_url,enabled:h.enabled,export_on_scan_complete:h.export_on_scan_complete,export_on_critical_vuln:h.export_on_critical_vuln};h.api_key&&(p.api_key=h.api_key),h.siem_type==="syslog"&&(p.protocol=h.protocol),await te.updateSettings(d.id,p),l.success("SIEM integration updated")}else{const p={siem_type:h.siem_type,endpoint_url:h.endpoint_url,enabled:h.enabled,export_on_scan_complete:h.export_on_scan_complete,export_on_critical_vuln:h.export_on_critical_vuln};h.api_key&&(p.api_key=h.api_key),h.siem_type==="syslog"&&(p.protocol=h.protocol),await te.createSettings(p),l.success("SIEM integration created")}T()}catch(p){l.error(((t=(y=p.response)==null?void 0:y.data)==null?void 0:t.error)||"Failed to save SIEM integration")}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-dark-border",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white",children:[d?"Edit":"Add"," SIEM Integration"]}),e.jsx("button",{onClick:F,className:"text-slate-400 hover:text-white",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-6",children:[!d&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"SIEM Type"}),e.jsxs("select",{value:h.siem_type,onChange:i=>g({...h,siem_type:i.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"syslog",children:"Syslog (RFC 5424)"}),e.jsx("option",{value:"splunk",children:"Splunk HEC"}),e.jsx("option",{value:"elasticsearch",children:"Elasticsearch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Endpoint URL"}),e.jsx("input",{type:"text",value:h.endpoint_url,onChange:i=>g({...h,endpoint_url:i.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:h.siem_type==="syslog"?"192.168.1.100:514":h.siem_type==="splunk"?"https://splunk.example.com:8088":"https://elasticsearch.example.com:9200"})]}),h.siem_type==="syslog"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Protocol"}),e.jsxs("select",{value:h.protocol,onChange:i=>g({...h,protocol:i.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"tcp",children:"TCP"}),e.jsx("option",{value:"udp",children:"UDP"})]})]}),(h.siem_type==="splunk"||h.siem_type==="elasticsearch")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[h.siem_type==="splunk"?"HEC Token":"API Key"," ",h.siem_type==="splunk"&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"password",value:h.api_key,onChange:i=>g({...h,api_key:i.target.value}),className:"w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:d?"(leave blank to keep current)":""})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.enabled,onChange:i=>g({...h,enabled:i.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsx("span",{className:"text-white",children:"Enable this integration"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.export_on_scan_complete,onChange:i=>g({...h,export_on_scan_complete:i.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsx("span",{className:"text-white",children:"Auto-export when scans complete"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.export_on_critical_vuln,onChange:i=>g({...h,export_on_critical_vuln:i.target.checked}),className:"w-4 h-4 rounded border-dark-border bg-dark-surface text-primary focus:ring-primary"}),e.jsx("span",{className:"text-white",children:"Auto-export critical vulnerabilities immediately"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:F,children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):e.jsxs("span",{children:[d?"Update":"Create"," Integration"]})})]})]})]})})},Ss=()=>{const[d,F]=c.useState("profile"),T=[{id:"profile",label:"Profile",icon:e.jsx(he,{className:"h-4 w-4"}),component:e.jsx(is,{})},{id:"security",label:"Security",icon:e.jsx(ye,{className:"h-4 w-4"}),component:e.jsx(gs,{})},{id:"api-keys",label:"API Keys",icon:e.jsx(ce,{className:"h-4 w-4"}),component:e.jsx(js,{})},{id:"administration",label:"Administration",icon:e.jsx(V,{className:"h-4 w-4"}),component:e.jsx(os,{})},{id:"target-groups",label:"Target Groups",icon:e.jsx(ve,{className:"h-4 w-4"}),component:e.jsx(ms,{})},{id:"scheduled-scans",label:"Scheduled Scans",icon:e.jsx(W,{className:"h-4 w-4"}),component:e.jsx(xs,{})},{id:"templates",label:"Scan Templates",icon:e.jsx(je,{className:"h-4 w-4"}),component:e.jsx(ps,{})},{id:"notifications",label:"Notifications",icon:e.jsx(Ie,{className:"h-4 w-4"}),component:e.jsx(hs,{})},{id:"jira-integration",label:"JIRA Integration",icon:e.jsx(Te,{className:"h-4 w-4"}),component:e.jsx(bs,{})},{id:"siem-integration",label:"SIEM Integration",icon:e.jsx(Ee,{className:"h-4 w-4"}),component:e.jsx(fs,{})},{id:"compare-scans",label:"Compare Scans",icon:e.jsx(pe,{className:"h-4 w-4"}),component:e.jsx(us,{})}],h=T.find(g=>g.id===d);return e.jsx(Ve,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Fe,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"})]}),e.jsx("p",{className:"text-slate-400",children:"Manage your profile, security, users, target groups, scheduled scans, templates, and notifications"})]}),e.jsx("div",{className:"flex gap-2 mb-6 border-b border-dark-border pb-2",children:T.map(g=>e.jsxs("button",{onClick:()=>F(g.id),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${d===g.id?"bg-dark-surface text-primary border-b-2 border-primary":"text-slate-400 hover:text-white hover:bg-dark-hover"}`,children:[g.icon,g.label]},g.id))}),e.jsx("div",{children:h==null?void 0:h.component})]})})};export{Ss as default};
