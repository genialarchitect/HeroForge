import{b as ee,u as I,d as D,j as e}from"./vendor-state-BjT_zREg.js";import{r as j}from"./vendor-react-5KxtEOLM.js";import{B as o,k as V,q as le,l as de,U as te,ag as ae,aY as W,a9 as Y,O as K,p as ce,i as se,g as Q,s as ue,bB as Z,m as U,S as oe,N as me,ab as xe,F as G,a6 as he,c6 as H,a7 as pe,bg as ge,bv as je,be as re,av as ne,v as ie,H as be,X as ve,aq as fe,a4 as Ne,a as ye}from"./vendor-ui-CaTPr3iI.js";import{L as we}from"./Layout-hU69iu7X.js";import{C as y}from"./Card-CV6m9jT5.js";import{at as _,B as w}from"./index--6GUYD2o.js";import{B as v}from"./Badge-Bi3Nk-Vg.js";import{L as z}from"./LoadingSpinner-DiN0bg1Z.js";import"./vendor-markdown-BGP8SuZQ.js";import"./vendor-utils-DfRopTPV.js";const _e=({targets:C})=>{const[b,f]=j.useState(""),[L,k]=j.useState(""),[R,$]=j.useState(null),[m,d]=j.useState(null),F=ee(),{data:h,isLoading:M}=I({queryKey:["conversation-tests"],queryFn:async()=>{try{return(await _.getConversationTests({builtin_only:!0})).data}catch{return[]}}}),i=D({mutationFn:async n=>(await _.startConversationTest(n)).data,onSuccess:n=>{d(n),F.invalidateQueries({queryKey:["llm-test-runs"]}),n.final_status==="failed"?o.warning(`Vulnerability detected at turn ${n.vulnerability_detected_at_turn}`):n.final_status==="passed"?o.success("Test passed - no vulnerabilities detected"):o.info(`Test completed with status: ${n.final_status}`)},onError:()=>{o.error("Failed to run conversation test")}}),q=()=>{if(!b){o.error("Please select a target");return}if(!L){o.error("Please select a test");return}d(null),i.mutate({target_id:b,test_id:L})},u=n=>({prompt_injection:"text-red-400",jailbreak:"text-orange-400",data_extraction:"text-yellow-400",context_manipulation:"text-purple-400",role_confusion:"text-blue-400",encoding:"text-cyan-400"})[n.toLowerCase()]||"text-slate-400",T=n=>({critical:"danger",high:"danger",medium:"warning",low:"info"})[n.toLowerCase()]||"info",l=n=>{switch(n){case"passed":return e.jsx(Q,{className:"h-5 w-5 text-green-400"});case"failed":return e.jsx(se,{className:"h-5 w-5 text-red-400"});case"aborted":return e.jsx(K,{className:"h-5 w-5 text-yellow-400"});default:return e.jsx(ce,{className:"h-5 w-5 text-slate-400"})}},S=(h==null?void 0:h.reduce((n,N)=>{const c=N.category;return n[c]||(n[c]=[]),n[c].push(N),n},{}))||{};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs(y,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"Multi-Turn Conversation Tests"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Target"}),e.jsxs("select",{value:b,onChange:n=>f(n.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"Choose a target..."}),C.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",n.model_type,")"]},n.id))]})]}),M?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(z,{})}):e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto",children:Object.entries(S).map(([n,N])=>e.jsxs("div",{children:[e.jsxs("h4",{className:`text-sm font-medium mb-2 ${u(n)}`,children:[n.replace(/_/g," ").toUpperCase()," (",N.length,")"]}),e.jsx("div",{className:"space-y-2",children:N.map(c=>e.jsxs("div",{className:`p-3 rounded-lg border transition-colors cursor-pointer ${L===c.id?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-slate-600"}`,onClick:()=>k(c.id),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:c.name}),e.jsx(v,{variant:T(c.severity),className:"text-xs",children:c.severity})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1 line-clamp-2",children:c.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:[c.turns.length," turns"]}),c.is_builtin&&e.jsx(v,{variant:"info",className:"text-xs",children:"Built-in"})]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),$(R===c.id?null:c.id)},className:"p-1 text-slate-400 hover:text-white",children:R===c.id?e.jsx(le,{className:"h-4 w-4"}):e.jsx(de,{className:"h-4 w-4"})})]}),R===c.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-border",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Turn Preview:"}),e.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:[c.turns.slice(0,3).map((a,p)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[a.role==="user"?e.jsx(te,{className:"h-4 w-4 text-blue-400 mt-0.5 shrink-0"}):e.jsx(ae,{className:"h-4 w-4 text-green-400 mt-0.5 shrink-0"}),e.jsxs("span",{className:"text-slate-300 line-clamp-2",children:[a.content.substring(0,100),"..."]})]},p)),c.turns.length>3&&e.jsxs("div",{className:"text-xs text-slate-500",children:["+ ",c.turns.length-3," more turns"]})]})]})]},c.id))})]},n))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-dark-border",children:e.jsxs(w,{variant:"primary",className:"w-full",onClick:q,loading:i.isPending,disabled:!b||!L,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Run Conversation Test"]})})]})}),e.jsxs(y,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[i.isPending?e.jsx(Y,{className:"h-5 w-5 text-primary animate-spin"}):e.jsx(V,{className:"h-5 w-5 text-primary"}),"Conversation Transcript"]}),i.isPending&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{}),e.jsx("p",{className:"text-slate-400 mt-4",children:"Running multi-turn conversation test..."}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"This may take a moment"})]}),!i.isPending&&!m&&e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a test and run it to see the conversation transcript"})]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l(m.final_status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:m.test_name}),e.jsxs("div",{className:"text-sm text-slate-400",children:[m.turns_executed.length," turns executed"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(v,{variant:m.final_status==="passed"?"success":"danger",children:m.final_status}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Confidence: ",(m.overall_confidence*100).toFixed(0),"%"]})]})]}),m.vulnerability_detected_at_turn!==void 0&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-red-400 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-red-400",children:["Vulnerability Detected at Turn ",m.vulnerability_detected_at_turn+1]}),m.remediation&&e.jsx("p",{className:"text-sm text-slate-300 mt-1",children:m.remediation})]})]})}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:m.turns_executed.map((n,N)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(te,{className:"h-4 w-4 text-blue-400"})}),e.jsxs("div",{className:"flex-1 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:[e.jsxs("div",{className:"text-xs text-blue-400 mb-1",children:["Turn ",n.turn_number+1," - User"]}),e.jsx("p",{className:"text-sm text-slate-300",children:n.prompt_sent})]})]}),e.jsxs("div",{className:"flex items-start gap-3 ml-6",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(ae,{className:"h-4 w-4 text-green-400"})}),e.jsxs("div",{className:"flex-1 p-3 bg-green-500/10 rounded-lg border border-green-500/20",children:[e.jsx("div",{className:"text-xs text-green-400 mb-1",children:"Assistant"}),e.jsx("p",{className:"text-sm text-slate-300",children:n.response_received}),n.success_indicators_matched.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:n.success_indicators_matched.map((c,a)=>e.jsx(v,{variant:"warning",className:"text-xs",children:c},a))}),n.abort_triggered&&e.jsx(v,{variant:"danger",className:"mt-2 text-xs",children:"Abort Triggered"})]})]})]},N))}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-dark-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:m.turns_executed.length}),e.jsx("div",{className:"text-xs text-slate-500",children:"Turns"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[m.duration_ms,"ms"]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Duration"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[(m.overall_confidence*100).toFixed(0),"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Confidence"})]})]})]})]})]})},ke=({targets:C})=>{const[b,f]=j.useState(""),[L,k]=j.useState(""),[R,$]=j.useState([]),[m,d]=j.useState(!1),[F,h]=j.useState([]),[M,i]=j.useState(null),q=ee(),[u,T]=j.useState({target_id:"",function_format:"openai",memory_enabled:!1,rag_endpoint:"",tools:[]}),[l,S]=j.useState({name:"",description:"",dangerous:!1}),{data:n,isLoading:N}=I({queryKey:["agent-configs",b],queryFn:async()=>{if(!b)return[];try{return(await _.getAgentConfigs({target_id:b})).data}catch{return[]}},enabled:!!b}),{data:c,isLoading:a}=I({queryKey:["agent-test-cases"],queryFn:async()=>{try{return(await _.getAgentTestCases({builtin_only:!0})).data}catch{return[]}}}),p=D({mutationFn:async t=>(await _.createAgentConfig({target_id:t.target_id,tools:t.tools,rag_endpoint:t.rag_endpoint||void 0,function_format:t.function_format,memory_enabled:t.memory_enabled})).data,onSuccess:()=>{q.invalidateQueries({queryKey:["agent-configs"]}),o.success("Agent configuration created"),d(!1),T({target_id:"",function_format:"openai",memory_enabled:!1,rag_endpoint:"",tools:[]})},onError:()=>{o.error("Failed to create agent configuration")}}),P=D({mutationFn:async t=>(await _.startAgentTest(t)).data,onSuccess:t=>{h(t),q.invalidateQueries({queryKey:["llm-test-runs"]});const g=t.filter(x=>x.status==="failed").length;g>0?o.warning(`${g} of ${t.length} tests detected vulnerabilities`):o.success("All agent tests passed")},onError:()=>{o.error("Failed to run agent tests")}}),J=()=>{if(!b){o.error("Please select a target");return}if(!L){o.error("Please select or create an agent configuration");return}h([]),P.mutate({target_id:b,agent_config_id:L,test_ids:R.length>0?R:void 0})},s=()=>{l.name.trim()&&(T({...u,tools:[...u.tools,{name:l.name,description:l.description,parameters:{},dangerous:l.dangerous}]}),S({name:"",description:"",dangerous:!1}))},r=t=>{T({...u,tools:u.tools.filter((g,x)=>x!==t)})},E=t=>{$(g=>g.includes(t)?g.filter(x=>x!==t):[...g,t])},A=t=>({tool_parameter_injection:"text-red-400",tool_chaining:"text-orange-400",rag_poisoning:"text-yellow-400",function_hijacking:"text-purple-400",memory_poisoning:"text-blue-400",privilege_escalation:"text-pink-400"})[t.toLowerCase()]||"text-slate-400",B=t=>({critical:"danger",high:"danger",medium:"warning",low:"info"})[t.toLowerCase()]||"info",O=(c==null?void 0:c.reduce((t,g)=>{const x=g.category;return t[x]||(t[x]=[]),t[x].push(g),t},{}))||{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(y,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),"Agent Configuration"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Target"}),e.jsxs("select",{value:b,onChange:t=>{f(t.target.value),k("")},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"Choose a target..."}),C.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.model_type,")"]},t.id))]})]}),b&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Agent Configuration"}),N?e.jsx(z,{}):n&&n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsxs("button",{onClick:()=>k(t.id),className:`w-full p-3 rounded-lg border text-left transition-colors ${L===t.id?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-slate-400"}),e.jsxs("span",{className:"text-white",children:[t.tools.length," tools"]})]}),e.jsx(v,{variant:"info",children:t.function_format})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[t.memory_enabled&&"Memory enabled â€¢ ",t.rag_endpoint&&"RAG configured"]})]},t.id))}):e.jsx("div",{className:"text-center py-4 text-slate-500",children:"No configurations yet"}),e.jsxs(w,{variant:"secondary",size:"sm",className:"w-full mt-3",onClick:()=>{T({...u,target_id:b}),d(!0)},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Create Configuration"]})]})]})]}),e.jsxs(y,{className:"lg:col-span-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),"Agent Security Tests"]}),a?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(z,{})}):e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:Object.entries(O).map(([t,g])=>e.jsxs("div",{className:"border border-dark-border rounded-lg",children:[e.jsxs("button",{onClick:()=>i(M===t?null:t),className:"w-full p-3 flex items-center justify-between text-left hover:bg-dark-bg transition-colors rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${A(t)}`,children:t.replace(/_/g," ").toUpperCase()}),e.jsx(v,{variant:"info",className:"text-xs",children:g.length})]}),M===t?e.jsx(le,{className:"h-4 w-4 text-slate-400"}):e.jsx(de,{className:"h-4 w-4 text-slate-400"})]}),M===t&&e.jsx("div",{className:"px-3 pb-3 space-y-2",children:g.map(x=>e.jsxs("div",{onClick:()=>E(x.id),className:`p-3 rounded-lg border cursor-pointer transition-colors ${R.includes(x.id)?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:x.name}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:x.description})]}),e.jsx(v,{variant:B(x.severity),className:"text-xs shrink-0",children:x.severity})]}),x.cwe_id&&e.jsxs("div",{className:"text-xs text-slate-500 mt-2",children:["CWE: ",x.cwe_id]})]},x.id))})]},t))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-400",children:R.length>0?`${R.length} tests selected`:"All tests will run"}),e.jsxs(w,{variant:"primary",onClick:J,loading:P.isPending,disabled:!b||!L,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Run Agent Tests"]})]})]})]}),F.length>0&&e.jsxs(y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Test Results"}),e.jsx("div",{className:"space-y-3",children:F.map((t,g)=>e.jsxs("div",{className:`p-4 rounded-lg border ${t.status==="failed"?"bg-red-500/10 border-red-500/30":"bg-green-500/10 border-green-500/30"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.status==="failed"?e.jsx(se,{className:"h-5 w-5 text-red-400"}):e.jsx(Q,{className:"h-5 w-5 text-green-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:t.test_name}),e.jsx("div",{className:"text-sm text-slate-400",children:t.category})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:t.status==="failed"?"danger":"success",children:t.status}),e.jsx(v,{variant:B(t.severity),children:t.severity})]})]}),t.vulnerability_indicators.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Vulnerability Indicators:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.vulnerability_indicators.map((x,X)=>e.jsx(v,{variant:"warning",className:"text-xs",children:x},X))})]}),t.tool_calls_detected.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Tool Calls Detected:"}),e.jsx("div",{className:"space-y-1",children:t.tool_calls_detected.map((x,X)=>e.jsxs("div",{className:"text-sm text-slate-300 flex items-center gap-2",children:[e.jsx(me,{className:"h-3 w-3 text-slate-500"}),e.jsx("span",{className:"font-mono",children:x.tool_name}),e.jsxs("span",{className:"text-xs text-slate-500",children:["(",Object.keys(x.arguments).length," args)"]})]},X))})]}),t.remediation&&e.jsxs("div",{className:"p-3 bg-dark-bg rounded border border-dark-border",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Remediation:"}),e.jsx("p",{className:"text-sm text-slate-300",children:t.remediation})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-slate-500",children:[e.jsxs("span",{children:["Confidence: ",(t.confidence*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Duration: ",t.duration_ms,"ms"]})]})]},g))})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg w-full max-w-lg p-6 m-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Create Agent Configuration"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Function Calling Format"}),e.jsxs("select",{value:u.function_format,onChange:t=>T({...u,function_format:t.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white",children:[e.jsx("option",{value:"openai",children:"OpenAI"}),e.jsx("option",{value:"anthropic",children:"Anthropic"}),e.jsx("option",{value:"gemini",children:"Gemini"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"RAG Endpoint (Optional)"}),e.jsx("input",{type:"url",value:u.rag_endpoint,onChange:t=>T({...u,rag_endpoint:t.target.value}),placeholder:"https://...",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"memory_enabled",checked:u.memory_enabled,onChange:t=>T({...u,memory_enabled:t.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"memory_enabled",className:"text-sm text-slate-300",children:"Memory Enabled"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Tool Definitions"}),u.tools.length>0&&e.jsx("div",{className:"space-y-2 mb-3",children:u.tools.map((t,g)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dark-bg rounded border border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-slate-400"}),e.jsx("span",{className:"text-white",children:t.name}),t.dangerous&&e.jsx(v,{variant:"danger",className:"text-xs",children:"Dangerous"})]}),e.jsx("button",{onClick:()=>r(g),className:"text-slate-400 hover:text-red-400",children:e.jsx(xe,{className:"h-4 w-4"})})]},g))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l.name,onChange:t=>S({...l,name:t.target.value}),placeholder:"Tool name",className:"flex-1 px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",id:"tool_dangerous",checked:l.dangerous,onChange:t=>S({...l,dangerous:t.target.checked})}),e.jsx("label",{htmlFor:"tool_dangerous",className:"text-xs text-slate-400",children:"Dangerous"})]}),e.jsx(w,{variant:"secondary",size:"sm",onClick:s,children:e.jsx(U,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(w,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(w,{variant:"primary",onClick:()=>p.mutate(u),loading:p.isPending,disabled:u.tools.length===0,children:"Create Configuration"})]})]})})]})},Ce=({targets:C,testRuns:b})=>{const[f,L]=j.useState(""),[k,R]=j.useState("pdf"),[$,m]=j.useState(!0),[d,F]=j.useState(""),[h,M]=j.useState(null),{data:i,isLoading:q,refetch:u}=I({queryKey:["model-fingerprint",d],queryFn:async()=>{if(!d)throw new Error("No target selected");return(await _.getFingerprint(d)).data},enabled:!!d,retry:!1}),T=D({mutationFn:async a=>(await _.generateLLMReport(a.testRunId,{format:a.format,include_remediation:a.includeRemediation})).data,onSuccess:a=>{M(a),o.success("Report generated successfully")},onError:()=>{o.error("Failed to generate report")}}),l=D({mutationFn:async a=>(await _.fingerprintModel(a)).data,onSuccess:()=>{u(),o.success("Model fingerprinted successfully")},onError:()=>{o.error("Failed to fingerprint model")}}),S=D({mutationFn:async a=>(await _.downloadLLMReport(a)).data,onSuccess:a=>{const p=window.URL.createObjectURL(a),P=document.createElement("a");P.href=p,P.download=`llm-security-report.${k}`,document.body.appendChild(P),P.click(),window.URL.revokeObjectURL(p),document.body.removeChild(P),o.success("Report downloaded")},onError:()=>{o.error("Failed to download report")}}),n=()=>{if(!f){o.error("Please select a test run");return}T.mutate({testRunId:f,format:k,includeRemediation:$})},N=a=>{switch(a){case"pdf":return e.jsx(je,{className:"h-4 w-4"});case"html":return e.jsx(ge,{className:"h-4 w-4"});case"markdown":return e.jsx(G,{className:"h-4 w-4"});case"json":return e.jsx(pe,{className:"h-4 w-4"});default:return e.jsx(G,{className:"h-4 w-4"})}},c=a=>({critical:"danger",high:"danger",medium:"warning",low:"info",minimal:"success"})[a.toLowerCase()]||"info";return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),"Generate Security Report"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Test Run"}),e.jsxs("select",{value:f,onChange:a=>L(a.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"Choose a test run..."}),b.filter(a=>a.status==="completed").map(a=>e.jsxs("option",{value:a.id,children:[a.target_name," - ",new Date(a.created_at||a.started_at||"").toLocaleString(),a.vulnerabilities_found>0&&` (${a.vulnerabilities_found} vulns)`]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Format"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["pdf","html","markdown","json"].map(a=>e.jsxs("button",{onClick:()=>R(a),className:`p-3 rounded-lg border transition-colors flex flex-col items-center gap-2 ${k===a?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-slate-600"}`,children:[N(a),e.jsx("span",{className:"text-xs text-white uppercase",children:a})]},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"include_remediation",checked:$,onChange:a=>m(a.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"include_remediation",className:"text-sm text-slate-300",children:"Include remediation guidance"})]}),e.jsxs(w,{variant:"primary",className:"w-full",onClick:n,loading:T.isPending,disabled:!f,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]}),h&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-dark-border",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"Generated Report"}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N(h.format),e.jsx("span",{className:"text-white font-medium",children:"LLM Security Report"})]}),e.jsxs(v,{variant:c(h.executive_summary.overall_risk_level),children:[h.executive_summary.overall_risk_level," Risk"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-red-500/10 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:h.executive_summary.critical_count}),e.jsx("div",{className:"text-xs text-slate-500",children:"Critical"})]}),e.jsxs("div",{className:"text-center p-2 bg-orange-500/10 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:h.executive_summary.high_count}),e.jsx("div",{className:"text-xs text-slate-500",children:"High"})]}),e.jsxs("div",{className:"text-center p-2 bg-yellow-500/10 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400",children:h.executive_summary.medium_count}),e.jsx("div",{className:"text-xs text-slate-500",children:"Medium"})]}),e.jsxs("div",{className:"text-center p-2 bg-blue-500/10 rounded",children:[e.jsx("div",{className:"text-lg font-bold text-blue-400",children:h.executive_summary.low_count}),e.jsx("div",{className:"text-xs text-slate-500",children:"Low"})]})]}),h.executive_summary.key_findings.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"Key Findings:"}),e.jsx("ul",{className:"space-y-1",children:h.executive_summary.key_findings.slice(0,3).map((a,p)=>e.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[e.jsx(K,{className:"h-3 w-3 text-yellow-400 mt-1 shrink-0"}),a]},p))})]}),e.jsxs(w,{variant:"secondary",className:"w-full",onClick:()=>S.mutate(h.id),loading:S.isPending,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Download Report"]})]})]})]})}),e.jsxs(y,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),"Model Fingerprinting"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Target to Fingerprint"}),e.jsxs("select",{value:d,onChange:a=>F(a.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"Choose a target..."}),C.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.model_type,")"]},a.id))]})]}),e.jsxs(w,{variant:"primary",className:"w-full",onClick:()=>d&&l.mutate(d),loading:l.isPending,disabled:!d,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Analyze Model"]}),q&&d&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(z,{})}),i&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Detected Model Family"}),e.jsxs(v,{variant:"info",children:[(i.confidence*100).toFixed(0),"% confidence"]})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:i.likely_model_family}),i.estimated_context_window&&e.jsxs("div",{className:"text-sm text-slate-400 mt-1",children:["Est. Context Window: ",i.estimated_context_window.toLocaleString()," tokens"]})]}),i.indicators.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"Detection Indicators"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.indicators.map((a,p)=>e.jsx(v,{variant:"info",className:"text-xs",children:a},p))})]}),i.detected_safety_mechanisms.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Detected Safety Mechanisms"]}),e.jsx("div",{className:"space-y-1",children:i.detected_safety_mechanisms.map((a,p)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx(Q,{className:"h-3 w-3 text-green-400"}),a]},p))})]}),i.known_vulnerabilities.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4 text-yellow-400"}),"Known Vulnerabilities"]}),e.jsx("div",{className:"space-y-1",children:i.known_vulnerabilities.map((a,p)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-400",children:[e.jsx(K,{className:"h-3 w-3"}),a]},p))})]}),e.jsxs("div",{className:"text-xs text-slate-500 pt-2 border-t border-dark-border",children:["Fingerprinted: ",new Date(i.fingerprinted_at).toLocaleString()]})]}),!i&&!q&&d&&e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(H,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No fingerprint data available"}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Analyze Model" to fingerprint this target'})]})]})]})]})},De=()=>{const[C,b]=j.useState("dashboard"),[f,L]=j.useState(null),[k,R]=j.useState([]),[$,m]=j.useState(!1),[d,F]=j.useState({name:"",endpoint:"",model_type:"openai",description:"",api_key:""}),h=ee(),M=[{name:"Prompt Injection",icon:e.jsx(me,{className:"h-5 w-5"}),color:"text-red-500",description:"Test for malicious prompt injection attacks",testCount:25,passRate:82},{name:"Jailbreak Attempts",icon:e.jsx(fe,{className:"h-5 w-5"}),color:"text-orange-500",description:"Bypass safety guardrails and content filters",testCount:18,passRate:91},{name:"Data Extraction",icon:e.jsx(K,{className:"h-5 w-5"}),color:"text-yellow-500",description:"Attempt to extract training data or sensitive information",testCount:12,passRate:94},{name:"Context Manipulation",icon:e.jsx(Ne,{className:"h-5 w-5"}),color:"text-purple-500",description:"Manipulate conversation context for unintended behavior",testCount:9,passRate:88},{name:"Encoding Attacks",icon:e.jsx(ye,{className:"h-5 w-5"}),color:"text-blue-500",description:"Use encoding techniques to bypass filters",testCount:7,passRate:96}],{data:i,isLoading:q}=I({queryKey:["llm-targets"],queryFn:async()=>{try{return(await _.getLLMTargets({limit:100})).data}catch{return[]}}}),u=D({mutationFn:async s=>(await _.createLLMTarget(s)).data,onSuccess:()=>{h.invalidateQueries({queryKey:["llm-targets"]}),o.success("Target created successfully"),m(!1),F({name:"",endpoint:"",model_type:"openai",description:"",api_key:""})},onError:()=>{o.error("Failed to create target")}}),T=D({mutationFn:async s=>{await _.deleteLLMTarget(s)},onSuccess:()=>{h.invalidateQueries({queryKey:["llm-targets"]}),o.success("Target deleted")},onError:()=>{o.error("Failed to delete target")}}),{data:l}=I({queryKey:["llm-test-runs"],queryFn:async()=>{try{return(await _.getLLMTests({limit:50})).data.map(r=>({id:r.id,target_id:r.id,target_name:r.target_name,total_tests:r.tests_run||0,passed:r.tests_run-(r.vulnerabilities_found||0),failed:r.vulnerabilities_found||0,vulnerabilities_found:r.vulnerabilities_found||0,status:r.status==="completed"?"completed":r.status==="running"?"running":"failed",started_at:r.started_at||r.created_at,completed_at:r.completed_at}))}catch{return[]}}}),{data:S}=I({queryKey:["llm-test-results",f],queryFn:async()=>{if(!f)return[];try{const r=(await _.getLLMTest(f)).data;return(await _.getTestCases({enabled_only:!0})).data.slice(0,10).map((A,B)=>({id:A.id||String(B),test_name:A.name,category:A.category,status:r.vulnerabilities_found>0&&B<r.vulnerabilities_found?"failed":"passed",severity:A.severity||"medium",vulnerability_found:r.vulnerabilities_found>0&&B<r.vulnerabilities_found,response:A.description||"Test completed",execution_time:Math.random()*2,timestamp:r.completed_at||r.created_at}))}catch{return[]}},enabled:!!f}),n=D({mutationFn:async s=>{const r=i==null?void 0:i.find(A=>A.id===s.target_id);return{run_id:(await _.startLLMTest({target_name:(r==null?void 0:r.name)||"Test Target",target_type:(r==null?void 0:r.model_type)||"LLM",target_config:{endpoint:r==null?void 0:r.endpoint,categories:s.categories},test_type:s.categories.join(",")})).data.id,total_tests:k.reduce((A,B)=>{const O=M.find(t=>t.name===B);return A+((O==null?void 0:O.testCount)||0)},0)}},onSuccess:s=>{h.invalidateQueries({queryKey:["llm-test-runs"]}),o.success(`Test run started: ${s.total_tests} tests queued`),b("results")},onError:()=>{o.error("Failed to start test run")}}),N=()=>{if(!f){o.error("Please select a target");return}if(k.length===0){o.error("Please select at least one test category");return}n.mutate({target_id:f,categories:k})},c=()=>{if(!d.name.trim()){o.error("Please enter a target name");return}if(!d.endpoint.trim()){o.error("Please enter an endpoint URL");return}u.mutate({name:d.name.trim(),endpoint:d.endpoint.trim(),model_type:d.model_type,description:d.description.trim()||void 0,api_key:d.api_key.trim()||void 0})},a=s=>{R(r=>r.includes(s)?r.filter(E=>E!==s):[...r,s])},p=s=>{switch(s){case"passed":return e.jsx(Q,{className:"h-4 w-4 text-green-400"});case"failed":return e.jsx(se,{className:"h-4 w-4 text-red-400"});case"running":return e.jsx(Y,{className:"h-4 w-4 text-blue-400 animate-spin"});default:return e.jsx(ce,{className:"h-4 w-4 text-slate-400"})}},P=M.reduce((s,r)=>s+r.testCount,0),J=(l==null?void 0:l.reduce((s,r)=>s+r.total_tests,0))||0;return e.jsxs(we,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(re,{className:"h-8 w-8 text-primary"}),"LLM Security Testing"]}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Test AI and LLM applications for security vulnerabilities"})]}),e.jsxs(w,{variant:"primary",onClick:()=>h.invalidateQueries(),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(y,{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Built-in Tests"}),e.jsx(G,{className:"h-4 w-4 text-purple-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:P}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Across 5 categories"})]}),e.jsxs(y,{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Tests Run"}),e.jsx(ne,{className:"h-4 w-4 text-blue-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:J}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[(l==null?void 0:l.length)||0," test runs"]})]}),e.jsxs(y,{className:"bg-gradient-to-br from-red-500/10 to-red-600/10 border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Vulnerabilities"}),e.jsx(K,{className:"h-4 w-4 text-red-400"})]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:(l==null?void 0:l.reduce((s,r)=>s+r.vulnerabilities_found,0))||0}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Found in testing"})]}),e.jsxs(y,{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Pass Rate"}),e.jsx(Q,{className:"h-4 w-4 text-green-400"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white",children:[l&&l.length>0?Math.round(l.reduce((s,r)=>s+r.passed,0)/l.reduce((s,r)=>s+r.total_tests,0)*100):0,"%"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Average across all runs"})]})]}),e.jsx("div",{className:"flex items-center gap-2 border-b border-dark-border overflow-x-auto",children:[{id:"dashboard",label:"Dashboard",icon:e.jsx(ne,{className:"h-4 w-4"})},{id:"targets",label:"Targets",icon:e.jsx(ie,{className:"h-4 w-4"})},{id:"run-test",label:"Run Tests",icon:e.jsx(W,{className:"h-4 w-4"})},{id:"conversation",label:"Multi-Turn",icon:e.jsx(V,{className:"h-4 w-4"})},{id:"agent",label:"Agent Tests",icon:e.jsx(Z,{className:"h-4 w-4"})},{id:"reports",label:"Reports",icon:e.jsx(H,{className:"h-4 w-4"})},{id:"results",label:"Results",icon:e.jsx(G,{className:"h-4 w-4"})}].map(s=>e.jsxs("button",{onClick:()=>b(s.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors border-b-2 ${C===s.id?"text-primary border-primary":"text-slate-400 border-transparent hover:text-white hover:border-slate-600"}`,children:[s.icon,s.label]},s.id))}),C==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Test Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(s=>e.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg p-5 hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`${s.color}`,children:s.icon}),e.jsxs("span",{className:"text-xs font-medium px-2 py-1 bg-slate-700 text-slate-300 rounded",children:[s.testCount," tests"]})]}),e.jsx("h4",{className:"font-semibold text-white mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:s.description}),s.passRate!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Pass Rate:"}),e.jsxs("span",{className:"font-medium text-green-400",children:[s.passRate,"%"]})]})]},s.name))})]}),e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Recent Test Runs"}),e.jsxs(v,{variant:"info",children:[(l==null?void 0:l.length)||0," runs"]})]}),e.jsxs("div",{className:"space-y-3",children:[l==null?void 0:l.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.target_name}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(s.started_at).toLocaleString()})]})]}),e.jsx(v,{variant:s.status==="completed"?"success":"info",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Total Tests"}),e.jsx("div",{className:"text-white font-medium",children:s.total_tests})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Passed"}),e.jsx("div",{className:"text-green-400 font-medium",children:s.passed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Failed"}),e.jsx("div",{className:"text-red-400 font-medium",children:s.failed})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500",children:"Vulnerabilities"}),e.jsx("div",{className:"text-orange-400 font-medium",children:s.vulnerabilities_found})]})]})]},s.id)),(!l||l.length===0)&&e.jsx("div",{className:"text-center py-8 text-slate-500",children:'No test runs yet. Go to "Run Tests" to start testing.'})]})]})]}),C==="targets"&&e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"LLM Targets"}),e.jsxs(w,{variant:"primary",size:"sm",onClick:()=>m(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Target"]})]}),q?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(z,{})}):i&&i.length>0?e.jsx("div",{className:"space-y-3",children:i.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.endpoint})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"info",children:s.model_type}),e.jsx("button",{onClick:()=>T.mutate(s.id),className:"p-1.5 text-slate-400 hover:text-red-400 transition-colors",title:"Delete target",children:e.jsx(xe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Added: ",new Date(s.created_at).toLocaleString()]}),s.description&&e.jsx("span",{className:"text-slate-400",children:s.description})]})]},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"h-12 w-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"No LLM targets configured yet"}),e.jsxs(w,{variant:"primary",size:"sm",onClick:()=>m(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Your First Target"]})]})]}),C==="run-test"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Target"}),e.jsx("div",{className:"space-y-2",children:i==null?void 0:i.map(s=>e.jsxs("button",{onClick:()=>L(s.id),className:`w-full p-4 rounded-lg border transition-colors text-left ${f===s.id?"bg-primary/20 border-primary text-white":"bg-dark-bg border-dark-border text-slate-300 hover:border-primary"}`,children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.endpoint})]},s.id))})]}),e.jsxs(y,{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Select Test Categories"}),e.jsx("div",{className:"space-y-2 mb-6",children:M.map(s=>e.jsxs("button",{onClick:()=>a(s.name),className:`w-full p-4 rounded-lg border transition-colors text-left ${k.includes(s.name)?"bg-primary/20 border-primary":"bg-dark-bg border-dark-border hover:border-primary"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s.color,children:s.icon}),e.jsx("span",{className:"font-medium text-white",children:s.name})]}),e.jsxs("span",{className:"text-xs text-slate-400",children:[s.testCount," tests"]})]}),e.jsx("p",{className:"text-sm text-slate-400",children:s.description})]},s.name))}),e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border mb-4",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"Tests to run:"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:k.reduce((s,r)=>{const E=M.find(A=>A.name===r);return s+((E==null?void 0:E.testCount)||0)},0)})]}),e.jsxs(w,{variant:"primary",className:"w-full",onClick:N,loading:n.isPending,disabled:!f||k.length===0,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Run Tests"]})]})]}),C==="conversation"&&i&&e.jsx(_e,{targets:i}),C==="agent"&&i&&e.jsx(ke,{targets:i}),C==="reports"&&i&&l&&e.jsx(Ce,{targets:i,testRuns:l}),C==="results"&&e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Test Results"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"secondary",size:"sm",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(w,{variant:"secondary",size:"sm",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[S==null?void 0:S.map(s=>e.jsxs("div",{className:"p-4 bg-dark-bg rounded-lg border border-dark-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p(s.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.test_name}),e.jsx("div",{className:"text-sm text-slate-400",children:s.category})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:s.vulnerability_found?"danger":"success",children:s.vulnerability_found?"Vulnerable":"Secure"}),e.jsx(v,{variant:"warning",children:s.severity})]})]}),e.jsxs("div",{className:"p-3 bg-dark-surface rounded border border-dark-border mb-2",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Response:"}),e.jsx("div",{className:"text-sm text-slate-300",children:s.response})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Execution time: ",s.execution_time.toFixed(2),"s"]}),e.jsx("span",{children:new Date(s.timestamp).toLocaleString()})]})]},s.id)),(!S||S.length===0)&&!f&&e.jsx("div",{className:"text-center py-12 text-slate-500",children:"Select a target to view test results"})]})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-lg w-full max-w-lg p-6 m-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Add LLM Target"}),e.jsx("button",{onClick:()=>m(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(ve,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Target Name *"}),e.jsx("input",{type:"text",value:d.name,onChange:s=>F({...d,name:s.target.value}),placeholder:"e.g., GPT-4 Production API",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"API Endpoint *"}),e.jsx("input",{type:"url",value:d.endpoint,onChange:s=>F({...d,endpoint:s.target.value}),placeholder:"e.g., https://api.openai.com/v1/chat/completions",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Model Type"}),e.jsxs("select",{value:d.model_type,onChange:s=>F({...d,model_type:s.target.value}),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"openai",children:"OpenAI (GPT)"}),e.jsx("option",{value:"anthropic",children:"Anthropic (Claude)"}),e.jsx("option",{value:"google",children:"Google (Gemini)"}),e.jsx("option",{value:"azure",children:"Azure OpenAI"}),e.jsx("option",{value:"huggingface",children:"Hugging Face"}),e.jsx("option",{value:"custom",children:"Custom LLM"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"API Key (Optional)"}),e.jsx("input",{type:"password",value:d.api_key,onChange:s=>F({...d,api_key:s.target.value}),placeholder:"sk-...",className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Required for testing protected endpoints"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description (Optional)"}),e.jsx("textarea",{value:d.description,onChange:s=>F({...d,description:s.target.value}),placeholder:"Brief description of this target...",rows:2,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary resize-none"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6",children:[e.jsx(w,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(w,{variant:"primary",onClick:c,loading:u.isPending,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Target"]})]})]})})]})};export{De as default};
