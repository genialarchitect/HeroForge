import{j as e}from"./vendor-state-CmPn7D-C.js";import{r as c,u as J,d as ce}from"./vendor-react-Da1CiaFS.js";import{q as W,bd as Y,a7 as oe,a4 as F,bo as de,S as $,X as z,aA as xe,af as X,v as D,aS as me,aY as he,a8 as pe,P as K,J as ue,B as x,L as q,$ as P,ag as ge,b6 as ye,o as U,p as fe,at as H,bp as je,bq as ve,b5 as G}from"./vendor-ui-Co93spXs.js";import{a as be,M as p,b as we,c as T,d as Ne}from"./index-1jRzuKaK.js";import{i as _e,W as ke,a as Se}from"./WorkflowHistory-CnR4BMWI.js";import"./vendor-charts-D04Aj3Lx.js";const O=[{value:"assignment",label:"Assignment",icon:W,description:"Assign to team member"},{value:"work",label:"Work",icon:Y,description:"Remediation work stage"},{value:"review",label:"Review",icon:oe,description:"Peer review stage"},{value:"verification",label:"Verification",icon:F,description:"Security team verification"},{value:"cab_approval",label:"CAB Approval",icon:de,description:"Change Advisory Board"},{value:"deployment",label:"Deployment",icon:$,description:"Deploy fix to production"},{value:"closure",label:"Closure",icon:z,description:"Final closure stage"}],Ce=({stage:l,index:u,onChange:d,onRemove:y,onMoveUp:f,onMoveDown:w,isFirst:k,isLast:o,availableRoles:j})=>{const m=(a,_)=>{d(u,{...l,[a]:_})},v=O.find(a=>a.value===l.stage_type),b=(v==null?void 0:v.icon)||Y;return e.jsx("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>f(u),disabled:k,className:"p-1 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx(xe,{className:"w-5 h-5 text-gray-500"}),e.jsx("button",{type:"button",onClick:()=>w(u),disabled:o,className:"p-1 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-cyan-400",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Stage ",u+1]})]}),e.jsx("button",{type:"button",onClick:()=>y(u),className:"ml-auto p-1 text-red-400 hover:text-red-300",title:"Remove stage",children:e.jsx(X,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Stage Name"}),e.jsx("input",{type:"text",value:l.name,onChange:a=>m("name",a.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500",placeholder:"e.g., Security Review"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Stage Type"}),e.jsx("select",{value:l.stage_type,onChange:a=>m("stage_type",a.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500",children:O.map(a=>e.jsxs("option",{value:a.value,children:[a.label," - ",a.description]},a.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description (optional)"}),e.jsx("input",{type:"text",value:l.description||"",onChange:a=>m("description",a.target.value||void 0),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500",placeholder:"Describe what happens in this stage..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1 flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),"Required Approvals"]}),e.jsx("input",{type:"number",min:"0",value:l.required_approvals,onChange:a=>m("required_approvals",parseInt(a.target.value)||0),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"0 = auto-advance"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1 flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),"SLA (hours)"]}),e.jsx("input",{type:"number",min:"0",value:l.sla_hours||"",onChange:a=>m("sla_hours",a.target.value?parseInt(a.target.value):void 0),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Approver Role"}),e.jsxs("select",{value:l.approver_role||"",onChange:a=>m("approver_role",a.target.value||void 0),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"",children:"Any authenticated user"}),j.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.notify_on_enter!==!1,onChange:a=>m("notify_on_enter",a.target.checked),className:"w-4 h-4 rounded border-gray-600 text-cyan-500 focus:ring-cyan-500 focus:ring-offset-gray-900"}),e.jsx(me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Notify on stage entry"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.notify_on_sla_breach!==!1,onChange:a=>m("notify_on_sla_breach",a.target.checked),className:"w-4 h-4 rounded border-gray-600 text-cyan-500 focus:ring-cyan-500 focus:ring-offset-gray-900"}),e.jsx(D,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Notify on SLA breach"})]})]})]})]})})},V={name:"",stage_type:"work",required_approvals:0,notify_on_enter:!0,notify_on_sla_breach:!0},Ae=({template:l,onSave:u,onCancel:d})=>{var S;const[y,f]=c.useState((l==null?void 0:l.name)||""),[w,k]=c.useState((l==null?void 0:l.description)||""),[o,j]=c.useState(((S=l==null?void 0:l.stages)==null?void 0:S.map(t=>({name:t.name,description:t.description||void 0,stage_type:t.stage_type,required_approvals:t.required_approvals,approver_role:t.approver_role||void 0,approver_user_ids:t.approver_user_ids?JSON.parse(t.approver_user_ids):void 0,sla_hours:t.sla_hours||void 0,notify_on_enter:t.notify_on_enter,notify_on_sla_breach:t.notify_on_sla_breach,auto_advance_conditions:t.auto_advance_conditions?JSON.parse(t.auto_advance_conditions):void 0})))||[{...V,name:"Initial Stage"}]),[m,v]=c.useState([]),[b,a]=c.useState(!1),[_,n]=c.useState([]);c.useEffect(()=>{be.getRoles().then(t=>{v(t.data.map(r=>r.name))}).catch(()=>{v(["admin","user","auditor","viewer"])})},[]);const N=()=>{j([...o,{...V,name:`Stage ${o.length+1}`}])},A=t=>{if(o.length<=1){x.error("Template must have at least one stage");return}j(o.filter((r,g)=>g!==t))},I=(t,r)=>{const g=[...o];g[t]=r,j(g)},i=t=>{if(t===0)return;const r=[...o];[r[t-1],r[t]]=[r[t],r[t-1]],j(r)},L=t=>{if(t===o.length-1)return;const r=[...o];[r[t],r[t+1]]=[r[t+1],r[t]],j(r)},B=()=>{const t=[];return y.trim()||t.push("Template name is required"),o.length===0&&t.push("Template must have at least one stage"),o.forEach((r,g)=>{r.name.trim()||t.push(`Stage ${g+1} must have a name`)}),n(t),t.length===0},R=async()=>{var t,r;if(B()){a(!0);try{const g={name:y,description:w||void 0,stages:o};let C;l?(C=(await p.templates.update(l.id,{name:y,description:w||void 0,stages:o})).data,x.success("Template updated successfully")):(C=(await p.templates.create(g)).data,x.success("Template created successfully")),u==null||u(C)}catch(g){const C=g;x.error(((r=(t=C.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to save template")}finally{a(!1)}}};return e.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:l?"Edit Workflow Template":"Create Workflow Template"}),d&&e.jsx("button",{onClick:d,className:"p-2 text-gray-400 hover:text-white",title:"Cancel",children:e.jsx(z,{className:"w-5 h-5"})})]}),_.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-500/50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:_.map((t,r)=>e.jsx("p",{className:"text-sm text-red-400",children:t},r))})]})}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Template Name *"}),e.jsx("input",{type:"text",value:y,onChange:t=>f(t.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 text-white focus:outline-none focus:border-cyan-500",placeholder:"e.g., Standard Remediation Workflow"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:w,onChange:t=>k(t.target.value),rows:2,className:"w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 text-white focus:outline-none focus:border-cyan-500",placeholder:"Describe when to use this workflow template..."})]})]}),e.jsx("div",{className:"mb-6 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Workflow stages are executed in order."}),e.jsx("p",{className:"text-blue-400",children:"Stages with required approvals > 0 will wait for approval before advancing. Use SLA hours to set deadlines for each stage."})]})]})}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-white",children:["Stages (",o.length,")"]}),e.jsxs("button",{type:"button",onClick:N,className:"flex items-center gap-2 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded text-sm",children:[e.jsx(K,{className:"w-4 h-4"}),"Add Stage"]})]}),e.jsx("div",{className:"space-y-3",children:o.map((t,r)=>e.jsx(Ce,{stage:t,index:r,onChange:I,onRemove:A,onMoveUp:i,onMoveDown:L,isFirst:r===0,isLast:r===o.length-1,availableRoles:m},r))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-700",children:[d&&e.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded",children:"Cancel"}),e.jsxs("button",{onClick:R,disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded disabled:opacity-50",children:[e.jsx(ue,{className:"w-4 h-4"}),b?"Saving...":l?"Update Template":"Create Template"]})]})]})},Te=({onViewWorkflow:l})=>{const u=J(),[d,y]=c.useState([]),[f,w]=c.useState(null),[k,o]=c.useState(!0),[j,m]=c.useState(!1),v=async()=>{try{const[n,N]=await Promise.all([p.getPendingApprovals(),p.getStats()]);y(n.data),w(N.data)}catch(n){x.error("Failed to load pending approvals"),console.error(n)}finally{o(!1),m(!1)}};c.useEffect(()=>{v()},[]);const b=()=>{m(!0),v()},a=n=>{l?l(n.instance_id,n.vulnerability_id):u(`/vulnerabilities/${n.vulnerability_id}?tab=workflow`)},_=n=>{switch(n.toLowerCase()){case"critical":return"critical";case"high":return"high";case"medium":return"medium";default:return"low"}};return k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[f&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Active Workflows"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:f.active_workflows})]}),e.jsx($,{className:"w-8 h-8 text-cyan-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:f.pending_approvals})]}),e.jsx(W,{className:"w-8 h-8 text-yellow-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Completed Today"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:f.completed_today})]}),e.jsx(F,{className:"w-8 h-8 text-green-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"SLA Breaches"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:f.sla_breaches})]}),e.jsx(P,{className:"w-8 h-8 text-red-400 opacity-50"})]})})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Pending Approvals"}),e.jsxs("button",{onClick:b,disabled:j,className:"flex items-center gap-2 px-3 py-1.5 text-sm text-gray-400 hover:text-white disabled:opacity-50",children:[e.jsx(ge,{className:`w-4 h-4 ${j?"animate-spin":""}`}),"Refresh"]})]}),d.length===0?e.jsxs("div",{className:"px-4 py-12 text-center",children:[e.jsx(F,{className:"w-12 h-12 text-green-400 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-gray-400",children:"No pending approvals"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"You're all caught up! Workflows needing your approval will appear here."})]}):e.jsx("div",{className:"divide-y divide-gray-700",children:d.map(n=>{const N=n.sla_breached||n.sla_deadline&&_e(new Date(n.sla_deadline));return e.jsx("div",{className:"p-4 hover:bg-gray-800/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-white",children:n.vulnerability_title}),e.jsx(we,{variant:"severity",type:_(n.severity),children:n.severity}),N&&e.jsxs("span",{className:"px-2 py-0.5 rounded text-xs font-medium text-red-400 bg-red-900/30 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),"SLA Breach"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),n.stage_name]}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsx("span",{className:"capitalize",children:n.stage_type.replace("_"," ")}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),n.approvals_received,"/",n.required_approvals," approvals"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),"Entered"," ",T(new Date(n.entered_at),{addSuffix:!0})]}),n.sla_deadline&&e.jsxs("span",{className:`flex items-center gap-1 ${N?"text-red-400":""}`,children:[e.jsx(P,{className:"w-4 h-4"}),"SLA"," ",T(new Date(n.sla_deadline),{addSuffix:!0})]})]})]}),e.jsxs("button",{onClick:()=>a(n),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded text-sm",children:["Review",e.jsx(ye,{className:"w-4 h-4"})]})]})},`${n.instance_id}-${n.stage_instance_id}`)})})]})]})},Ee=()=>{J();const[l,u]=ce(),[d,y]=c.useState(l.get("tab")||"approvals"),[f,w]=c.useState([]),[k,o]=c.useState(!0),[j,m]=c.useState(null),[v,b]=c.useState(!1),[a,_]=c.useState([]),[n,N]=c.useState(!0),[A,I]=c.useState("active"),[i,L]=c.useState(null),[B,R]=c.useState(!1);c.useEffect(()=>{u({tab:d})},[d,u]),c.useEffect(()=>{d==="templates"?S():d==="instances"&&t()},[d,A]);const S=async()=>{o(!0);try{const s=await p.templates.list();w(s.data)}catch(s){x.error("Failed to load workflow templates"),console.error(s)}finally{o(!1)}},t=async()=>{N(!0);try{const s=await p.instances.list(A!=="all"?{status:A}:void 0);_(s.data)}catch(s){x.error("Failed to load workflow instances"),console.error(s)}finally{N(!1)}},r=async s=>{R(!0);try{const h=await p.instances.get(s);L(h.data)}catch(h){x.error("Failed to load workflow details"),console.error(h)}finally{R(!1)}},g=async s=>{try{const h=await p.templates.get(s.id);m(h.data),b(!0)}catch(h){x.error("Failed to load template details"),console.error(h)}},C=async s=>{if(s.is_system){x.error("Cannot delete system templates");return}if(confirm(`Delete template "${s.name}"?`))try{await p.templates.delete(s.id),x.success("Template deleted"),S()}catch(h){x.error("Failed to delete template"),console.error(h)}},E=async s=>{if(s.is_system){x.error("Cannot modify system templates");return}try{await p.templates.update(s.id,{is_active:!s.is_active}),x.success(s.is_active?"Template deactivated":"Template activated"),S()}catch(h){x.error("Failed to update template"),console.error(h)}},Q=()=>{b(!1),m(null),S()},Z=async s=>{i&&(await p.stages.approve(i.id,{comment:s}),x.success("Stage approved"),r(i.id),t())},ee=async(s,h)=>{i&&(await p.stages.reject(i.id,{comment:s,restart_from_stage:h}),x.success("Stage rejected"),r(i.id),t())},se=async s=>{i&&(await p.stages.advance(i.id,s),x.success("Advanced to next stage"),r(i.id),t())},te=async s=>{i&&(await p.instances.hold(i.id,s),x.success("Workflow put on hold"),r(i.id),t())},ae=async()=>{i&&(await p.instances.resume(i.id),x.success("Workflow resumed"),r(i.id),t())},re=async s=>{i&&(await p.instances.cancel(i.id,s),x.success("Workflow cancelled"),r(i.id),t())},ne=s=>{switch(s.toLowerCase()){case"active":return"text-cyan-400 bg-cyan-900/30";case"completed":return"text-green-400 bg-green-900/30";case"cancelled":return"text-gray-400 bg-gray-700";case"on_hold":return"text-orange-400 bg-orange-900/30";case"rejected":return"text-red-400 bg-red-900/30";default:return"text-gray-400 bg-gray-700"}},le=()=>v?e.jsx(Ae,{template:j||void 0,onSave:Q,onCancel:()=>{b(!1),m(null)}}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Workflow Templates"}),e.jsxs("button",{onClick:()=>{m(null),b(!0)},className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded",children:[e.jsx(K,{className:"w-4 h-4"}),"New Template"]})]}),k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No workflow templates yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create your first template to define remediation workflows"})]}):e.jsx("div",{className:"grid gap-4",children:f.map(s=>e.jsx("div",{className:`bg-gray-800 rounded-lg border p-4 ${s.is_active?"border-gray-700":"border-gray-700 opacity-60"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-white",children:s.name}),s.is_system&&e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-purple-900/30 text-purple-400",children:"System"}),!s.is_active&&e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-gray-700 text-gray-400",children:"Inactive"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Created"," ",T(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s.is_system&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(s),className:"p-2 text-gray-400 hover:text-white",title:s.is_active?"Deactivate":"Activate",children:s.is_active?e.jsx(je,{className:"w-5 h-5 text-green-400"}):e.jsx(ve,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>g(s),className:"p-2 text-gray-400 hover:text-white",title:"Edit",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C(s),className:"p-2 text-gray-400 hover:text-red-400",title:"Delete",children:e.jsx(X,{className:"w-5 h-5"})})]}),s.is_system&&e.jsx("button",{onClick:()=>g(s),className:"p-2 text-gray-400 hover:text-white",title:"View",children:e.jsx(G,{className:"w-5 h-5"})})]})]})},s.id))})]}),ie=()=>{if(i){const s=i.stage_instances.reduce((h,M)=>(h[M.stage_id]=M.stage.name,h),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>L(null),className:"text-cyan-400 hover:text-cyan-300 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to list"]}),e.jsx(ke,{instance:i,onApprove:Z,onReject:ee,onAdvance:se,onHold:te,onResume:ae,onCancel:re,isLoading:B}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Workflow History"}),e.jsx(Se,{transitions:i.transitions,stageNames:s})]})]})}return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Workflow Instances"}),e.jsxs("select",{value:A,onChange:s=>I(s.target.value),className:"bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"all",children:"All"})]})]}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No workflow instances found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Start a workflow from a vulnerability to see it here"})]}):e.jsx("div",{className:"bg-gray-900 rounded-lg border border-gray-700 divide-y divide-gray-700",children:a.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-800/50 cursor-pointer transition-colors",onClick:()=>r(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-white",children:["Workflow #",s.id.slice(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${ne(s.status)}`,children:s.status.replace("_"," ")})]}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Started"," ",T(new Date(s.started_at),{addSuffix:!0}),s.completed_at&&e.jsxs(e.Fragment,{children:[" "," - Completed"," ",T(new Date(s.completed_at),{addSuffix:!0})]})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},s.id))})]})};return e.jsx(Ne,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(U,{className:"w-8 h-8 text-cyan-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Remediation Workflows"}),e.jsx("p",{className:"text-gray-400",children:"Manage approval chains and track remediation progress"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 border-b border-gray-700 mb-6",children:[e.jsxs("button",{onClick:()=>y("approvals"),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${d==="approvals"?"border-cyan-400 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:[e.jsx(D,{className:"w-5 h-5"}),"Pending Approvals"]}),e.jsxs("button",{onClick:()=>y("templates"),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${d==="templates"?"border-cyan-400 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:[e.jsx(fe,{className:"w-5 h-5"}),"Templates"]}),e.jsxs("button",{onClick:()=>y("instances"),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${d==="instances"?"border-cyan-400 text-cyan-400":"border-transparent text-gray-400 hover:text-white"}`,children:[e.jsx(H,{className:"w-5 h-5"}),"All Instances"]})]}),d==="approvals"&&e.jsx(Te,{}),d==="templates"&&le(),d==="instances"&&ie()]})})};export{Ee as WorkflowsPage,Ee as default};
