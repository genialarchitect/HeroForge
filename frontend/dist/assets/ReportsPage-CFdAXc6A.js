import{b as L,u as S,d as C,j as e}from"./vendor-state-BjT_zREg.js";import{r as c}from"./vendor-react-5KxtEOLM.js";import{F as w,ay as D,m as F,a9 as j,O as M,ci as A,a6 as O,ab as $,B as i,p as G,i as Q,g as U,a7 as H,a8 as J,bv as X,aY as Y,X as V,z as W}from"./vendor-ui-C4nf_tR6.js";import{B as v,r as b,C as R,b as Z}from"./index-RI0GBk2h.js";import{L as ee}from"./Layout-DQwy8A8G.js";import"./vendor-utils-DfRopTPV.js";import"./vendor-markdown-BGP8SuZQ.js";const se=a=>{switch(a.toLowerCase()){case"completed":return e.jsx(U,{className:"w-4 h-4 text-green-400"});case"failed":return e.jsx(Q,{className:"w-4 h-4 text-red-400"});case"generating":return e.jsx(j,{className:"w-4 h-4 text-cyan-400 animate-spin"});default:return e.jsx(G,{className:"w-4 h-4 text-yellow-400"})}},P=a=>{switch(a.toLowerCase()){case"pdf":return e.jsx(X,{className:"w-4 h-4 text-red-400"});case"html":return e.jsx(J,{className:"w-4 h-4 text-orange-400"});case"json":return e.jsx(H,{className:"w-4 h-4 text-blue-400"});default:return e.jsx(w,{className:"w-4 h-4 text-slate-400"})}},te=a=>a?a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(1)} MB`:"-";function ae({report:a,onClose:r}){const o=L(),[d,x]=c.useState(a.operator_notes||""),[m,l]=c.useState(!1),{data:n,isLoading:y}=S({queryKey:["report-notes",a.id],queryFn:async()=>(await b.getNotes(a.id)).data});c.useEffect(()=>{n&&x(n.operator_notes||"")},[n]);const u=C({mutationFn:()=>b.updateNotes(a.id,{operator_notes:d}),onSuccess:()=>{i.success("Notes saved"),l(!1),o.invalidateQueries({queryKey:["report-notes",a.id]}),o.invalidateQueries({queryKey:["reports"]})},onError:()=>i.error("Failed to save notes")}),g=()=>{u.mutate()};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:r}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-lg bg-slate-800 border-l border-slate-700 shadow-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Operator Notes"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(V,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-900/50",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Report"}),e.jsx("p",{className:"text-white font-medium",children:a.name}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(a.created_at).toLocaleString()})]}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:y?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(j,{className:"w-6 h-6 text-cyan-400 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Assessment Notes"}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Add notes about the assessment, methodology, or observations. These notes will be included in regenerated reports."}),e.jsx("textarea",{value:d,onChange:t=>{x(t.target.value),l(!0)},placeholder:"Enter operator notes for this report...",className:"w-full h-64 bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 resize-none"})]}),(n==null?void 0:n.finding_notes)&&n.finding_notes.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Finding-Specific Notes (",n.finding_notes.length,")"]}),e.jsx("div",{className:"space-y-2",children:n.finding_notes.map(t=>e.jsxs("div",{className:"p-3 bg-slate-900 rounded-lg border border-slate-700",children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-1",children:["Finding: ",t.finding_id]}),e.jsx("p",{className:"text-sm text-slate-300",children:t.notes}),e.jsx("p",{className:"text-xs text-slate-600 mt-1",children:new Date(t.created_at).toLocaleString()})]},t.id))})]}),(n==null?void 0:n.operator_notes_updated_at)&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Last updated: ",new Date(n.operator_notes_updated_at).toLocaleString()]})]})}),e.jsx("div",{className:"p-4 border-t border-slate-700 bg-slate-900/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-slate-500",children:m?"Unsaved changes":"No changes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"secondary",onClick:r,children:"Cancel"}),e.jsxs(v,{onClick:g,disabled:!m||u.isPending,children:[u.isPending?e.jsx(j,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(W,{className:"w-4 h-4 mr-2"}),"Save Notes"]})]})]})})]})})]})}function le({onReportCreated:a}){const[r,o]=c.useState(""),[d,x]=c.useState(""),[m,l]=c.useState(""),[n,y]=c.useState("pdf"),[u,g]=c.useState("technical"),[t,p]=c.useState([]),[N,f]=c.useState(!0),[h,E]=c.useState(""),{data:T,isLoading:I}=S({queryKey:["scans-for-report"],queryFn:async()=>(await Z.getAll()).data}),{data:re}=S({queryKey:["report-templates"],queryFn:async()=>(await b.getTemplates()).data}),_=C({mutationFn:s=>b.create(s),onSuccess:()=>{i.success("Report generation started"),a(),x(""),l(""),o("")},onError:s=>{var k,q;i.error(((q=(k=s.response)==null?void 0:k.data)==null?void 0:q.error)||"Failed to create report")}}),K=s=>{if(s.preventDefault(),!r){i.error("Please select a scan");return}_.mutate({scan_id:r,name:d||`Report - ${new Date().toLocaleDateString()}`,description:m||void 0,format:n,template_id:u,sections:t,options:{include_branding:N,company_name:h||void 0}})},z=(T||[]).filter(s=>s.status==="completed"),B=[{id:"toc",label:"Table of Contents"},{id:"executive",label:"Executive Summary"},{id:"risk",label:"Risk Overview"},{id:"hosts",label:"Host Inventory"},{id:"ports",label:"Port Analysis"},{id:"vulns",label:"Vulnerability Findings"},{id:"enumeration",label:"Service Enumeration"},{id:"remediation",label:"Remediation Recommendations"},{id:"appendix",label:"Appendix"}];return e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-cyan-400"}),"Generate Report"]}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Select Scan *"}),e.jsxs("select",{value:r,onChange:s=>o(s.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0,children:[e.jsx("option",{value:"",children:"Choose a completed scan..."}),z.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",new Date(s.created_at).toLocaleDateString(),")"]},s.id))]}),I&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Loading scans..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Name"}),e.jsx("input",{type:"text",value:d,onChange:s=>x(s.target.value),placeholder:"Monthly Security Assessment",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Description"}),e.jsx("textarea",{value:m,onChange:s=>l(s.target.value),placeholder:"Optional description...",rows:2,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Report Template"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"executive",label:"Executive",desc:"High-level summary"},{id:"technical",label:"Technical",desc:"Detailed findings"},{id:"compliance",label:"Compliance",desc:"Audit-ready"}].map(s=>e.jsxs("button",{type:"button",onClick:()=>g(s.id),className:`p-3 rounded-lg border text-left transition-colors ${u===s.id?"bg-cyan-500/20 border-cyan-500/50 text-cyan-400":"bg-slate-700 border-slate-600 text-slate-300 hover:border-slate-500"}`,children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-slate-400",children:s.desc})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Output Format"}),e.jsx("div",{className:"flex gap-2",children:["pdf","html","json"].map(s=>e.jsxs("button",{type:"button",onClick:()=>y(s),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${n===s?"bg-cyan-500/20 border-cyan-500/50 text-cyan-400":"bg-slate-700 border-slate-600 text-slate-300 hover:border-slate-500"}`,children:[P(s),e.jsx("span",{className:"uppercase",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Include Sections (leave empty for template defaults)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(s=>e.jsx("button",{type:"button",onClick:()=>{p(t.includes(s.id)?t.filter(k=>k!==s.id):[...t,s.id])},className:`px-2 py-1 rounded text-xs font-medium transition-colors ${t.includes(s.id)?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"bg-slate-700 text-slate-400 border border-slate-600 hover:border-slate-500"}`,children:s.label},s.id))})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-slate-700",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:s=>f(s.target.checked),className:"rounded bg-slate-700 border-slate-600 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Include company branding"})]}),N&&e.jsx("input",{type:"text",value:h,onChange:s=>E(s.target.value),placeholder:"Company name for branding",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsx(v,{type:"submit",disabled:_.isPending||!r,className:"w-full",children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 animate-spin mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Generate Report"]})})]})]})}function ne(){const a=L(),{data:r,isLoading:o}=S({queryKey:["scheduled-reports"],queryFn:async()=>(await R.getAll()).data}),d=C({mutationFn:l=>R.delete(l),onSuccess:()=>{i.success("Scheduled report deleted"),a.invalidateQueries({queryKey:["scheduled-reports"]})},onError:()=>i.error("Failed to delete scheduled report")}),x=C({mutationFn:l=>R.runNow(l),onSuccess:()=>{i.success("Report generation started"),a.invalidateQueries({queryKey:["reports"]})},onError:()=>i.error("Failed to run report")});if(o)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(j,{className:"w-8 h-8 text-cyan-400 animate-spin"})});const m=r||[];return e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Scheduled Reports"}),e.jsxs(v,{variant:"secondary",size:"sm",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"New Schedule"]})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:m.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(D,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No scheduled reports"}),e.jsx("p",{className:"text-sm mt-1",children:"Create a schedule to automatically generate reports"})]}):m.map(l=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.is_active?"bg-green-500":"bg-slate-500"}`}),e.jsx("span",{className:"text-white font-medium",children:l.name}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${l.is_active?"bg-green-500/20 text-green-400":"bg-slate-600 text-slate-400"}`,children:l.is_active?"Active":"Disabled"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-slate-400",children:[e.jsx("span",{children:l.schedule}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"uppercase",children:l.format}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"capitalize",children:l.report_type})]}),l.last_run_at&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Last run: ",new Date(l.last_run_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x.mutate(l.id),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Run now",children:e.jsx(Y,{className:"w-4 h-4 text-cyan-400"})}),e.jsx("button",{onClick:()=>{confirm("Delete this scheduled report?")&&d.mutate(l.id)},className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",children:e.jsx($,{className:"w-4 h-4 text-slate-400 hover:text-red-400"})})]})]})},l.id))})]})}function pe(){const[a,r]=c.useState("reports"),[o,d]=c.useState(null),x=L(),{data:m,isLoading:l,refetch:n}=S({queryKey:["reports"],queryFn:async()=>(await b.getAll()).data,refetchInterval:t=>{const p=t.state.data;return(p==null?void 0:p.some(f=>f.status==="generating"))?5e3:!1}}),y=C({mutationFn:t=>b.delete(t),onSuccess:()=>{i.success("Report deleted"),x.invalidateQueries({queryKey:["reports"]})},onError:()=>i.error("Failed to delete report")}),u=async t=>{try{const N=(await b.download(t.id)).data,f=window.URL.createObjectURL(N),h=document.createElement("a");h.href=f,h.download=`${t.name}.${t.format}`,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(f),document.body.removeChild(h),i.success("Report downloaded")}catch{i.error("Failed to download report")}},g=m||[];return e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(w,{className:"w-7 h-7 text-cyan-400"}),"Report Generator"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Generate professional PDF, HTML, and JSON reports from scan results"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 border-b border-slate-700",children:[e.jsx("button",{onClick:()=>r("reports"),className:`pb-3 px-1 border-b-2 transition-colors ${a==="reports"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:"Reports"})]})}),e.jsx("button",{onClick:()=>r("scheduled"),className:`pb-3 px-1 border-b-2 transition-colors ${a==="scheduled"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Scheduled"})]})}),e.jsx("button",{onClick:()=>r("create"),className:`pb-3 px-1 border-b-2 transition-colors ${a==="create"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Create"})]})})]}),a==="reports"&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generated Reports"}),e.jsx(v,{variant:"secondary",size:"sm",onClick:()=>n(),children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:l?e.jsx("div",{className:"p-8 text-center",children:e.jsx(j,{className:"w-8 h-8 text-cyan-400 animate-spin mx-auto"})}):g.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(w,{className:"w-12 h-12 mx-auto mb-3 text-slate-600"}),e.jsx("p",{children:"No reports generated yet"}),e.jsxs(v,{variant:"secondary",className:"mt-4",onClick:()=>r("create"),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Create Your First Report"]})]}):g.map(t=>e.jsx("div",{className:"p-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[se(t.status),P(t.format),e.jsx("span",{className:"text-white font-medium",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-slate-400",children:[e.jsx("span",{children:new Date(t.created_at).toLocaleString()}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"capitalize",children:t.template_id}),t.file_size&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"|"}),e.jsx("span",{children:te(t.file_size)})]})]}),t.error_message&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-sm text-red-400",children:[e.jsx(M,{className:"w-3 h-3"}),t.error_message]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(t),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Operator Notes",children:e.jsx(A,{className:`w-4 h-4 ${t.operator_notes?"text-yellow-400":"text-slate-400"}`})}),t.status==="completed"&&e.jsx("button",{onClick:()=>u(t),className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",title:"Download",children:e.jsx(O,{className:"w-4 h-4 text-cyan-400"})}),e.jsx("button",{onClick:()=>{confirm("Delete this report?")&&y.mutate(t.id)},className:"p-2 hover:bg-slate-600 rounded-lg transition-colors",children:e.jsx($,{className:"w-4 h-4 text-slate-400 hover:text-red-400"})})]})]})},t.id))})]}),a==="scheduled"&&e.jsx(ne,{}),a==="create"&&e.jsx("div",{className:"max-w-2xl",children:e.jsx(le,{onReportCreated:()=>{r("reports"),x.invalidateQueries({queryKey:["reports"]})}})}),o&&e.jsx(ae,{report:o,onClose:()=>d(null)})]})}export{pe as default};
